{"status":{"description":"","source_mpi":"","state":"ACTIVE","is_cloned":false,"message_list":[],"resources":{"service_definition_list":[{"port_list":[],"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"df29a57d-0c35-4ec6-bbb0-5c887c341550","name":"action_create","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"DAG","uuid":"5da03ede-40f3-4e32-94ee-bc827586df61","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"98f8161b_dag"}],"description":"","message_list":[],"uuid":"8eca21eb-942a-41ba-a6eb-af310476fb2b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"98f8161b_dag","uuid":"5da03ede-40f3-4e32-94ee-bc827586df61"},"name":"dade7481_runbook"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"eb41ad3c-60f6-42bc-b1ab-6b67126a842b","name":"action_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"DAG","uuid":"a4d4e83c-18b1-4406-9bf0-6b7f7d5bc36f","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"02628fa5_dag"}],"description":"","message_list":[],"uuid":"4d689b82-3e6e-43a7-a61f-78cf6d8be04c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"02628fa5_dag","uuid":"a4d4e83c-18b1-4406-9bf0-6b7f7d5bc36f"},"name":"59afb4f4_runbook"}},{"description":"System action for restarting an application","message_list":[],"uuid":"deb93bee-9539-4644-8cc9-9a3b1cf1b6ca","name":"action_restart","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"DAG","uuid":"e541e3c2-245e-4268-8b90-98510db16512","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"27dfdc04_dag"}],"description":"","message_list":[],"uuid":"718a8106-ced6-4188-b0e4-7a29e3d4d0ca","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"27dfdc04_dag","uuid":"e541e3c2-245e-4268-8b90-98510db16512"},"name":"4150545e_runbook"}},{"description":"System action for starting an application","message_list":[],"uuid":"9bf8f35f-ddb1-462f-939e-6ef93feee4d7","name":"action_start","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"DAG","uuid":"6be54844-9247-4685-beb3-8d4ae8f50844","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"8e5f51b4_dag"}],"description":"","message_list":[],"uuid":"df30efa0-47ec-4211-aeee-3f94f0510c54","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"8e5f51b4_dag","uuid":"6be54844-9247-4685-beb3-8d4ae8f50844"},"name":"11876906_runbook"}},{"description":"System action for stopping an application","message_list":[],"uuid":"3f77d9ec-cd63-4302-92a4-b3de18f5d670","name":"action_stop","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"DAG","uuid":"efc9f674-650e-4d3a-9c97-52c9a7f07cb5","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"1a17e568_dag"}],"description":"","message_list":[],"uuid":"8856982b-972a-4cad-8780-cbc8851d6937","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"1a17e568_dag","uuid":"efc9f674-650e-4d3a-9c97-52c9a7f07cb5"},"name":"d2728354_runbook"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"b2b33de7-2428-4f02-abb3-dbfa2b8e35ec","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"DAG","uuid":"eee177cc-89f8-42c0-a204-ac00a4eb75b0","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Service_Element_Delete_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"3fd525b4-2a07-40f7-bfa1-3fe2d7033a09"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"3fd525b4-2a07-40f7-bfa1-3fe2d7033a09","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Service_Element_Delete_9308dfa4_9a23_40bd_bc4c_ca6a65c25567"}],"description":"","message_list":[],"uuid":"c7bebd3d-fcb3-4c57-8354-db62df983f29","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"eee177cc-89f8-42c0-a204-ac00a4eb75b0"},"name":"SYS_GEN__Runbook_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567"}}],"message_list":[],"uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567","state":"ACTIVE","depends_on_list":[],"editables":{},"tier":"","singleton":false,"variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"5d4fdbda-fee6-4ac5-85a4-60d987310ea3","value":"","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{},"is_hidden":false,"type":"LOCAL","options":{},"name":"IQN"}],"name":"MSSQL"}],"substrate_definition_list":[{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"0881c743-5f64-4031-ab56-d6f6a75cf084","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"DAG","uuid":"82315832-08c3-41bd-aaaa-46ea56e193aa","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Provision_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"d9b93904-042b-498c-a477-217a5a7faad8"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_MSSQL_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"ed184ba8-caec-4ffd-866d-7b5b166cddd0"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Provision_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"d9b93904-042b-498c-a477-217a5a7faad8"},"edge_type":"inherent","type":"","uuid":"d2e4af32-fd9d-4d3a-a8d9-708c8aff0f1b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_MSSQL_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"ed184ba8-caec-4ffd-866d-7b5b166cddd0"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"PROVISION_NUTANIX","uuid":"d9b93904-042b-498c-a477-217a5a7faad8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"name":"MSSQL-@@{calm_unique}@@","categories":"","availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"099dbe61-2c00-4964-9567-f547ec224e10"},"type":""},{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"099dbe61-2c00-4964-9567-f547ec224e10"},"type":""}],"parent_reference":null,"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":6,"serial_port_list":[],"gpu_list":[],"memory_size_mib":6144,"power_state":"ON","hardware_clock_timezone":"","guest_customization":{"cloud_init":null,"type":"","sysprep":{"install_type":"PREPARED","unattend_xml":"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<unattend xmlns=\"urn:schemas-microsoft-com:unattend\">\n   <settings pass=\"specialize\">\n      <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Microsoft-Windows-Shell-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n         <ComputerName>@@{name}@@<\/ComputerName>\n         <RegisteredOrganization>Nutanix<\/RegisteredOrganization>\n         <RegisteredOwner>Acropolis<\/RegisteredOwner>\n         <TimeZone>UTC<\/TimeZone>\n      <\/component>\n      <component xmlns=\"\" name=\"Microsoft-Windows-TerminalServices-LocalSessionManager\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" processorArchitecture=\"amd64\">\n         <fDenyTSConnections>false<\/fDenyTSConnections>\n      <\/component>\n      <component xmlns=\"\" name=\"Microsoft-Windows-TerminalServices-RDP-WinStationExtensions\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" processorArchitecture=\"amd64\">\n         <UserAuthentication>0<\/UserAuthentication>\n      <\/component>\n      <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Networking-MPSSVC-Svc\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n         <FirewallGroups>\n            <FirewallGroup wcm:action=\"add\" wcm:keyValue=\"RemoteDesktop\">\n               <Active>true<\/Active>\n               <Profile>all<\/Profile>\n               <Group>@FirewallAPI.dll,-28752<\/Group>\n            <\/FirewallGroup>\n         <\/FirewallGroups>\n      <\/component>\n   <\/settings>\n   <settings pass=\"oobeSystem\">\n      <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Microsoft-Windows-Shell-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n         <UserAccounts>\n            <AdministratorPassword>\n               <Value>@@{LOCAL.secret}@@<\/Value>\n               <PlainText>true<\/PlainText>\n            <\/AdministratorPassword>\n         <\/UserAccounts>\n         <AutoLogon>\n            <Password>\n               <Value>@@{LOCAL.secret}@@<\/Value>\n               <PlainText>true<\/PlainText>\n            <\/Password>\n            <Enabled>true<\/Enabled>\n            <Username>Administrator<\/Username>\n         <\/AutoLogon>\n         <FirstLogonCommands>\n            <SynchronousCommand wcm:action=\"add\">\n               <CommandLine>cmd.exe \/c netsh firewall add portopening TCP 5985 \"Port 5985\"<\/CommandLine>\n               <Description>Win RM port open<\/Description>\n               <Order>1<\/Order>\n               <RequiresUserInput>true<\/RequiresUserInput>\n            <\/SynchronousCommand>\n         <\/FirstLogonCommands>\n         <OOBE>\n            <HideEULAPage>true<\/HideEULAPage>\n            <SkipMachineOOBE>true<\/SkipMachineOOBE>\n         <\/OOBE>\n      <\/component>\n      <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Microsoft-Windows-International-Core\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n         <InputLocale>en-US<\/InputLocale>\n         <SystemLocale>en-US<\/SystemLocale>\n         <UILanguageFallback>en-us<\/UILanguageFallback>\n         <UILanguage>en-US<\/UILanguage>\n         <UserLocale>en-US<\/UserLocale>\n      <\/component>\n   <\/settings>\n<\/unattend>","type":""}},"type":"","boot_config":{"boot_device":{"type":"","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"WindowsServer2016-Base","uuid":"98783d50-8925-46b1-bfe5-96f1ed17e66b"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}}},{"data_source_reference":{"kind":"image","type":"","name":"SQLServer2014SP2-FullSlipstream-x64-ENU","uuid":"5ad856b9-a81a-41dc-999c-a9da91ab8d73"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","device_type":"CDROM","disk_address":{"adapter_type":"IDE","device_index":0,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":51200,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":1,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":153600,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":2,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":307200,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":3,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":307200,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":4,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":102400,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":5,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":102400,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":6,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":204800,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":7,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":204800,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":8,"type":""}}}]}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Provision_46d333d1_e8a7_4b27_aa64_30ac70829596"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"ed184ba8-caec-4ffd-866d-7b5b166cddd0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_MSSQL_46d333d1_e8a7_4b27_aa64_30ac70829596"}],"description":"","message_list":[],"uuid":"70c13b00-fd35-4971-8c5c-cfc3723c834c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"82315832-08c3-41bd-aaaa-46ea56e193aa"},"name":"SYS_GEN__Runbook_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596"}},{"description":"System action for powering on an application","message_list":[],"uuid":"369f5bc4-24be-493a-839f-e29c6e4d4bca","name":"action_poweron","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"DAG","uuid":"434fbbee-a794-4e23-89bb-3c0404414b96","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOn_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"4e24f3e4-9015-4741-a6fe-c7ebba969b06"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_MSSQL_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"bd3e158b-f6b8-4869-ac7d-0ca3da8a37f3"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOn_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"4e24f3e4-9015-4741-a6fe-c7ebba969b06"},"edge_type":"inherent","type":"","uuid":"81baeca8-fe1f-4df6-bc72-614a17417a4e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_MSSQL_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"bd3e158b-f6b8-4869-ac7d-0ca3da8a37f3"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"4e24f3e4-9015-4741-a6fe-c7ebba969b06","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_PowerOn_46d333d1_e8a7_4b27_aa64_30ac70829596"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"bd3e158b-f6b8-4869-ac7d-0ca3da8a37f3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_MSSQL_46d333d1_e8a7_4b27_aa64_30ac70829596"}],"description":"","message_list":[],"uuid":"b9ae54c3-6d36-453c-96a0-40da4c315eb1","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"434fbbee-a794-4e23-89bb-3c0404414b96"},"name":"SYS_GEN__Runbook_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596"}},{"description":"System action for restarting an application","message_list":[],"uuid":"232ebf1c-b543-4e89-afa9-e83577d872d4","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"DAG","uuid":"0ebbd935-d3fd-4463-8163-f7e84e1a5eb7","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_Restart_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"12273d19-7480-43eb-b83c-06d5f86acb00"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_MSSQL_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"d9788f0f-1f7b-4e20-a0e0-4c8be0839fdc"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_Restart_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"12273d19-7480-43eb-b83c-06d5f86acb00"},"edge_type":"inherent","type":"","uuid":"00f26766-e805-4c0a-b981-bbc763e02b70","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_MSSQL_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"d9788f0f-1f7b-4e20-a0e0-4c8be0839fdc"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"12273d19-7480-43eb-b83c-06d5f86acb00","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_Restart_46d333d1_e8a7_4b27_aa64_30ac70829596"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"d9788f0f-1f7b-4e20-a0e0-4c8be0839fdc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_MSSQL_46d333d1_e8a7_4b27_aa64_30ac70829596"}],"description":"","message_list":[],"uuid":"c4e98bb1-9e34-481a-8f9f-1053b17f8ceb","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"0ebbd935-d3fd-4463-8163-f7e84e1a5eb7"},"name":"SYS_GEN__Runbook_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596"}},{"description":"System action for suspending an application","message_list":[],"uuid":"77441c76-0e77-4f61-a5cb-2312664348f3","name":"action_suspend","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"DAG","uuid":"1e6291c6-7a1f-4191-9d85-c90194d34dde","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596"}],"description":"","message_list":[],"uuid":"27ad0f5a-7c04-4e63-8e54-7d22c6125c91","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"1e6291c6-7a1f-4191-9d85-c90194d34dde"},"name":"SYS_GEN__Runbook_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596"}},{"description":"System action for modifying an application","message_list":[],"uuid":"5cf991a2-efc1-4f2a-b1aa-32ad6f023fd0","name":"action_modify","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"DAG","uuid":"8fd54a1d-4282-4335-b1bd-91b636c2eed1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596"}],"description":"","message_list":[],"uuid":"2aacde51-17fd-4d94-8de8-c527eb21303f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"8fd54a1d-4282-4335-b1bd-91b636c2eed1"},"name":"SYS_GEN__Runbook_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596"}},{"description":"System action for powering off an application","message_list":[],"uuid":"6deb5e84-7b5f-4321-b802-f76b1ea7f22a","name":"action_poweroff","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"DAG","uuid":"a0032375-50d9-43ee-af52-20764c0378e8","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOff_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"424c8ffd-4c9d-43c6-b43e-20c6815a61cf"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"424c8ffd-4c9d-43c6-b43e-20c6815a61cf","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_PowerOff_46d333d1_e8a7_4b27_aa64_30ac70829596"}],"description":"","message_list":[],"uuid":"7000cfcf-fa8e-40c9-a2fe-325b072d788d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"a0032375-50d9-43ee-af52-20764c0378e8"},"name":"SYS_GEN__Runbook_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"b102ea78-87e7-4be2-92fb-b37d5c0f8866","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"DAG","uuid":"ef984fe9-b846-489c-93bc-7fb96fbc5a40","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Delete_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"5af30a52-edf3-4391-9f7b-69380eafbc99"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"DELETE_NUTANIX","uuid":"5af30a52-edf3-4391-9f7b-69380eafbc99","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Delete_46d333d1_e8a7_4b27_aa64_30ac70829596"}],"description":"","message_list":[],"uuid":"481b0dd7-1a42-4caa-b4a2-e1b68df090d5","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"ef984fe9-b846-489c-93bc-7fb96fbc5a40"},"name":"SYS_GEN__Runbook_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"a262b912-d901-4b41-909e-d1de1cfc25de","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"DAG","uuid":"0566f273-c3e2-4703-9807-63dafaea8f5c","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Substrate_Element_Delete_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"f4cff3d1-5298-437b-a725-00e06cb04911"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"f4cff3d1-5298-437b-a725-00e06cb04911","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Substrate_Element_Delete_46d333d1_e8a7_4b27_aa64_30ac70829596"}],"description":"","message_list":[],"uuid":"65479eb1-82a9-4512-868f-a55ca00b2bd1","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"0566f273-c3e2-4703-9807-63dafaea8f5c"},"name":"SYS_GEN__Runbook_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596"}}],"message_list":[],"uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596","state":"ACTIVE","readiness_probe":{"connection_type":"POWERSHELL","retries":"5","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","connection_port":5985,"login_credential_local_reference":{"kind":"app_credential","name":"LOCAL","uuid":"04ca4ba7-eaed-4178-8880-c103539f07ec"}},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":null},"create_spec":{"name":true,"resources":{"nic_list":{"1":{"subnet_reference":true},"0":{"subnet_reference":true}},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"guest_customization":true,"disk_list":true}}},"os_type":"Windows","type":"AHV_VM","create_spec":{"name":"MSSQL-@@{calm_unique}@@","categories":"","availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"099dbe61-2c00-4964-9567-f547ec224e10"},"type":""},{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"099dbe61-2c00-4964-9567-f547ec224e10"},"type":""}],"parent_reference":null,"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":6,"serial_port_list":[],"gpu_list":[],"memory_size_mib":6144,"power_state":"ON","hardware_clock_timezone":"","guest_customization":{"cloud_init":null,"type":"","sysprep":{"install_type":"PREPARED","unattend_xml":"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<unattend xmlns=\"urn:schemas-microsoft-com:unattend\">\n   <settings pass=\"specialize\">\n      <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Microsoft-Windows-Shell-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n         <ComputerName>@@{name}@@<\/ComputerName>\n         <RegisteredOrganization>Nutanix<\/RegisteredOrganization>\n         <RegisteredOwner>Acropolis<\/RegisteredOwner>\n         <TimeZone>UTC<\/TimeZone>\n      <\/component>\n      <component xmlns=\"\" name=\"Microsoft-Windows-TerminalServices-LocalSessionManager\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" processorArchitecture=\"amd64\">\n         <fDenyTSConnections>false<\/fDenyTSConnections>\n      <\/component>\n      <component xmlns=\"\" name=\"Microsoft-Windows-TerminalServices-RDP-WinStationExtensions\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" processorArchitecture=\"amd64\">\n         <UserAuthentication>0<\/UserAuthentication>\n      <\/component>\n      <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Networking-MPSSVC-Svc\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n         <FirewallGroups>\n            <FirewallGroup wcm:action=\"add\" wcm:keyValue=\"RemoteDesktop\">\n               <Active>true<\/Active>\n               <Profile>all<\/Profile>\n               <Group>@FirewallAPI.dll,-28752<\/Group>\n            <\/FirewallGroup>\n         <\/FirewallGroups>\n      <\/component>\n   <\/settings>\n   <settings pass=\"oobeSystem\">\n      <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Microsoft-Windows-Shell-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n         <UserAccounts>\n            <AdministratorPassword>\n               <Value>@@{LOCAL.secret}@@<\/Value>\n               <PlainText>true<\/PlainText>\n            <\/AdministratorPassword>\n         <\/UserAccounts>\n         <AutoLogon>\n            <Password>\n               <Value>@@{LOCAL.secret}@@<\/Value>\n               <PlainText>true<\/PlainText>\n            <\/Password>\n            <Enabled>true<\/Enabled>\n            <Username>Administrator<\/Username>\n         <\/AutoLogon>\n         <FirstLogonCommands>\n            <SynchronousCommand wcm:action=\"add\">\n               <CommandLine>cmd.exe \/c netsh firewall add portopening TCP 5985 \"Port 5985\"<\/CommandLine>\n               <Description>Win RM port open<\/Description>\n               <Order>1<\/Order>\n               <RequiresUserInput>true<\/RequiresUserInput>\n            <\/SynchronousCommand>\n         <\/FirstLogonCommands>\n         <OOBE>\n            <HideEULAPage>true<\/HideEULAPage>\n            <SkipMachineOOBE>true<\/SkipMachineOOBE>\n         <\/OOBE>\n      <\/component>\n      <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Microsoft-Windows-International-Core\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n         <InputLocale>en-US<\/InputLocale>\n         <SystemLocale>en-US<\/SystemLocale>\n         <UILanguageFallback>en-us<\/UILanguageFallback>\n         <UILanguage>en-US<\/UILanguage>\n         <UserLocale>en-US<\/UserLocale>\n      <\/component>\n   <\/settings>\n<\/unattend>","type":""}},"type":"","boot_config":{"boot_device":{"type":"","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"WindowsServer2016-Base","uuid":"98783d50-8925-46b1-bfe5-96f1ed17e66b"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}}},{"data_source_reference":{"kind":"image","type":"","name":"SQLServer2014SP2-FullSlipstream-x64-ENU","uuid":"5ad856b9-a81a-41dc-999c-a9da91ab8d73"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","device_type":"CDROM","disk_address":{"adapter_type":"IDE","device_index":0,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":51200,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":1,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":153600,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":2,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":307200,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":3,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":307200,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":4,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":102400,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":5,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":102400,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":6,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":204800,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":7,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":204800,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":8,"type":""}}}]}},"variable_list":[],"name":"AHV_MSSQL"}],"credential_definition_list":[{"username":"administrator@mssql.com","description":"","state":"ACTIVE","message_list":[],"uuid":"241466f6-7a7e-4e0a-bc28-690d736f611d","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"editables":{},"type":"PASSWORD","name":"DOMAIN_CRED"},{"username":"administrator","description":"","state":"ACTIVE","message_list":[],"uuid":"04ca4ba7-eaed-4178-8880-c103539f07ec","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"editables":{},"type":"PASSWORD","name":"LOCAL"},{"username":"admin","description":"","state":"ACTIVE","message_list":[],"uuid":"9bdb79f7-8537-47ba-8b8e-4ebce73adc46","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"editables":{},"type":"PASSWORD","name":"PE_CREDS"},{"username":"mssql\\sqlservice","description":"","state":"ACTIVE","message_list":[],"uuid":"79ebe5ab-c3c8-45a6-b6cb-18eb8bf7d5af","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"editables":{},"type":"PASSWORD","name":"SQL_CREDS"}],"type":"USER","app_profile_list":[{"deployment_create_list":[{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"93bc64ed-a2d4-410b-ba42-d413938be305","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"retries":"0","description":"","type":"DAG","uuid":"acb42493-64f3-4529-9817-37fd8d280c44","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_2814f949_fa68_4ac9_8488_dd477093f961","uuid":"58de1ca4-dc5c-4dce-a002-1f31b2aa6796"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"0cbb9bf4-4771-498f-859c-c944c5261b4a"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"72999996-3566-41e2-8e4e-223d45add264"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"d4f6ebaa-7ab9-43b7-856d-f3f5be8bf1ba"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"1a4e50d5-5179-4d5f-a351-2cd54b9efc71"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"d4f6ebaa-7ab9-43b7-856d-f3f5be8bf1ba"},"edge_type":"inherent","type":"","uuid":"0f73adc9-8c2c-4c1b-b1fc-8edff086d5ef","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"1a4e50d5-5179-4d5f-a351-2cd54b9efc71"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"72999996-3566-41e2-8e4e-223d45add264"},"edge_type":"inherent","type":"","uuid":"503d95ae-b869-4293-83ab-b813a609b883","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"d4f6ebaa-7ab9-43b7-856d-f3f5be8bf1ba"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_2814f949_fa68_4ac9_8488_dd477093f961","uuid":"58de1ca4-dc5c-4dce-a002-1f31b2aa6796"},"edge_type":"inherent","type":"","uuid":"0d7a0259-9256-4497-b41f-cab435139e00","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"0cbb9bf4-4771-498f-859c-c944c5261b4a"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"0cbb9bf4-4771-498f-859c-c944c5261b4a"},"edge_type":"inherent","type":"","uuid":"8af1dc34-d01d-4ca9-9707-5ab20b7d874a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"72999996-3566-41e2-8e4e-223d45add264"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_2814f949_fa68_4ac9_8488_dd477093f961"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"58de1ca4-dc5c-4dce-a002-1f31b2aa6796","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_2814f949_fa68_4ac9_8488_dd477093f961"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0cbb9bf4-4771-498f-859c-c944c5261b4a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"70c13b00-fd35-4971-8c5c-cfc3723c834c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"72999996-3566-41e2-8e4e-223d45add264","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"377c5a20-74f5-4678-b830-91ac76185f82"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d4f6ebaa-7ab9-43b7-856d-f3f5be8bf1ba","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"dade7481_runbook","uuid":"8eca21eb-942a-41ba-a6eb-af310476fb2b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1a4e50d5-5179-4d5f-a351-2cd54b9efc71","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"11876906_runbook","uuid":"df30efa0-47ec-4211-aeee-3f94f0510c54"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567"}],"description":"","message_list":[],"uuid":"1cd83383-982b-4670-ad4b-f2ab0689f272","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_2814f949_fa68_4ac9_8488_dd477093f961","uuid":"acb42493-64f3-4529-9817-37fd8d280c44"},"name":"SYS_GEN__Runbook_Deployment_2814f949_fa68_4ac9_8488_dd477093f961"}},{"description":"System action for starting an application","message_list":[],"uuid":"19428ec0-7ee8-496f-b850-9a2ec3200086","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"retries":"0","description":"","type":"DAG","uuid":"0a6232b3-cc01-4070-8864-ac195745fda1","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"5121bc91-776b-4f52-ad61-9157e4b15878"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"8ff7efd6-8e53-499d-a9aa-cf77be0b11c8"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"5121bc91-776b-4f52-ad61-9157e4b15878"},"edge_type":"inherent","type":"","uuid":"b0966a44-b852-4733-b718-7ca48c494a67","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"8ff7efd6-8e53-499d-a9aa-cf77be0b11c8"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_2814f949_fa68_4ac9_8488_dd477093f961"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5121bc91-776b-4f52-ad61-9157e4b15878","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"b9ae54c3-6d36-453c-96a0-40da4c315eb1"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8ff7efd6-8e53-499d-a9aa-cf77be0b11c8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"11876906_runbook","uuid":"df30efa0-47ec-4211-aeee-3f94f0510c54"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567"}],"description":"","message_list":[],"uuid":"6506f2c9-b3d1-40fb-81fb-a4e0a9304a3c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_2814f949_fa68_4ac9_8488_dd477093f961","uuid":"0a6232b3-cc01-4070-8864-ac195745fda1"},"name":"SYS_GEN__Runbook_Deployment_2814f949_fa68_4ac9_8488_dd477093f961"}},{"description":"System action for restarting an application","message_list":[],"uuid":"41a7758d-f309-4588-b582-cf88e752da2d","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"retries":"0","description":"","type":"DAG","uuid":"d54fc951-c8db-4eb0-878b-60842a19249b","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"23377859-e6b6-4223-ba1c-a148d2189957"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"7c441aa4-ffca-4b7d-840c-b9d5c1f657a0"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"23377859-e6b6-4223-ba1c-a148d2189957"},"edge_type":"inherent","type":"","uuid":"5a444658-9820-4577-85bc-635467a74cbd","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"7c441aa4-ffca-4b7d-840c-b9d5c1f657a0"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_2814f949_fa68_4ac9_8488_dd477093f961"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"23377859-e6b6-4223-ba1c-a148d2189957","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"c4e98bb1-9e34-481a-8f9f-1053b17f8ceb"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"7c441aa4-ffca-4b7d-840c-b9d5c1f657a0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"4150545e_runbook","uuid":"718a8106-ced6-4188-b0e4-7a29e3d4d0ca"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567"}],"description":"","message_list":[],"uuid":"45d02d9d-c601-43d7-a677-297576176766","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_2814f949_fa68_4ac9_8488_dd477093f961","uuid":"d54fc951-c8db-4eb0-878b-60842a19249b"},"name":"SYS_GEN__Runbook_Deployment_2814f949_fa68_4ac9_8488_dd477093f961"}},{"description":"System action for stopping an application","message_list":[],"uuid":"651149db-e3e5-48ba-9e3e-1b27bf51ae39","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"retries":"0","description":"","type":"DAG","uuid":"3d5e6565-309e-47c5-86b5-c9b2d0903921","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"e6879f03-4b61-4ab8-8d93-b15813118b75"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"5c7029c0-7674-4396-b3e6-b72f5ceaa49d"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"e6879f03-4b61-4ab8-8d93-b15813118b75"},"edge_type":"inherent","type":"","uuid":"ecac9450-ef54-4463-80f6-35514dfffba5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"5c7029c0-7674-4396-b3e6-b72f5ceaa49d"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_2814f949_fa68_4ac9_8488_dd477093f961"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e6879f03-4b61-4ab8-8d93-b15813118b75","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d2728354_runbook","uuid":"8856982b-972a-4cad-8780-cbc8851d6937"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5c7029c0-7674-4396-b3e6-b72f5ceaa49d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"7000cfcf-fa8e-40c9-a2fe-325b072d788d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596"}],"description":"","message_list":[],"uuid":"3b4b6b30-66c8-48a0-a512-b03c78db9162","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_2814f949_fa68_4ac9_8488_dd477093f961","uuid":"3d5e6565-309e-47c5-86b5-c9b2d0903921"},"name":"SYS_GEN__Runbook_Deployment_2814f949_fa68_4ac9_8488_dd477093f961"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"cb471139-6788-40e4-a68a-6a8a2e92b978","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"retries":"0","description":"","type":"DAG","uuid":"0f7dfb1e-846e-4edd-889e-f5d47dd90906","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"c86af359-c86e-4382-b39f-aaa0afc97703"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"3206a59f-18a3-442c-b317-66d0d92e94f7"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"3e4a8d02-ca18-4c2e-a317-631aca68084a"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"863f891d-08c0-4582-9aeb-bbfb7839ef01"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_2814f949_fa68_4ac9_8488_dd477093f961","uuid":"e10481df-55e7-4963-a66e-51ddcce8a539"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"c86af359-c86e-4382-b39f-aaa0afc97703"},"edge_type":"inherent","type":"","uuid":"a8c1a6c5-6747-4c36-868c-08931ff8bed2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"3206a59f-18a3-442c-b317-66d0d92e94f7"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"3206a59f-18a3-442c-b317-66d0d92e94f7"},"edge_type":"inherent","type":"","uuid":"05d9cf94-a2ac-41c6-8e04-524e96e553c6","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"3e4a8d02-ca18-4c2e-a317-631aca68084a"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"863f891d-08c0-4582-9aeb-bbfb7839ef01"},"edge_type":"inherent","type":"","uuid":"b70d0a9c-2d6b-46d1-821e-aea84511bae6","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_2814f949_fa68_4ac9_8488_dd477093f961","uuid":"e10481df-55e7-4963-a66e-51ddcce8a539"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"3e4a8d02-ca18-4c2e-a317-631aca68084a"},"edge_type":"inherent","type":"","uuid":"a0b0dfa1-95b4-4637-93fd-3cb9e55be910","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"863f891d-08c0-4582-9aeb-bbfb7839ef01"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_2814f949_fa68_4ac9_8488_dd477093f961"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c86af359-c86e-4382-b39f-aaa0afc97703","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d2728354_runbook","uuid":"8856982b-972a-4cad-8780-cbc8851d6937"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3206a59f-18a3-442c-b317-66d0d92e94f7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"59afb4f4_runbook","uuid":"4d689b82-3e6e-43a7-a61f-78cf6d8be04c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3e4a8d02-ca18-4c2e-a317-631aca68084a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"01f2ccd5-4d04-494a-a049-53c84731026a"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"863f891d-08c0-4582-9aeb-bbfb7839ef01","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"481b0dd7-1a42-4caa-b4a2-e1b68df090d5"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"e10481df-55e7-4963-a66e-51ddcce8a539","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_2814f949_fa68_4ac9_8488_dd477093f961"}],"description":"","message_list":[],"uuid":"32d6a4b0-76ce-4b47-8cc4-235dea0bbfe8","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_2814f949_fa68_4ac9_8488_dd477093f961","uuid":"0f7dfb1e-846e-4edd-889e-f5d47dd90906"},"name":"SYS_GEN__Runbook_Deployment_2814f949_fa68_4ac9_8488_dd477093f961"}},{"description":"System action for scaleout","message_list":[],"uuid":"99f4674b-c56d-45ec-865b-5620503cc919","name":"action_scaleout","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"retries":"0","description":"","type":"DAG","uuid":"d56f860c-3e6a-4844-9557-a456dc016068","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scaleout_2814f949_fa68_4ac9_8488_dd477093f961","uuid":"6d29d457-595b-4868-9d92-94112b9c9f80"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_2814f949_fa68_4ac9_8488_dd477093f961"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"retries":"0","description":"","type":"SCALING","uuid":"6d29d457-595b-4868-9d92-94112b9c9f80","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scaleout_2814f949_fa68_4ac9_8488_dd477093f961"}],"description":"","message_list":[],"uuid":"dfdc8535-6dfc-477a-a7aa-5b55902baf6c","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"57d1cd04-9cb9-4e45-94d1-14c00ab4c78a","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_2814f949_fa68_4ac9_8488_dd477093f961","uuid":"d56f860c-3e6a-4844-9557-a456dc016068"},"name":"SYS_GEN__Runbook_Deployment_2814f949_fa68_4ac9_8488_dd477093f961"}},{"description":"System action for scalein","message_list":[],"uuid":"1235175a-e67c-4d4a-aa10-bf3c75c70c39","name":"action_scalein","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"retries":"0","description":"","type":"DAG","uuid":"e6f1e20d-9138-4bd9-9b33-3afa57d96f5d","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scalein_2814f949_fa68_4ac9_8488_dd477093f961","uuid":"853c9c5b-8840-46a9-8fdc-8039ee22dc71"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_2814f949_fa68_4ac9_8488_dd477093f961"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"retries":"0","description":"","type":"SCALING","uuid":"853c9c5b-8840-46a9-8fdc-8039ee22dc71","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scalein_2814f949_fa68_4ac9_8488_dd477093f961"}],"description":"","message_list":[],"uuid":"4fc7c18e-5433-4d01-a8bf-b36817db3bd8","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"490d18b5-662b-43e9-80f8-f797d0c60154","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_2814f949_fa68_4ac9_8488_dd477093f961","uuid":"e6f1e20d-9138-4bd9-9b33-3afa57d96f5d"},"name":"SYS_GEN__Runbook_Deployment_2814f949_fa68_4ac9_8488_dd477093f961"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"06d14b07-b931-4527-ae32-e821d25a13a7","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"retries":"0","description":"","type":"DAG","uuid":"cf6c6727-3d36-4810-9868-8a0de8ca2f5c","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"c8b6e9e5-02bc-4f09-927b-bd699f42fe8e"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"85f9ce27-583d-4d6e-b269-560a83c3333d"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"535f2c4e-8572-4a13-b5b8-be8179de0fb0"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_2814f949_fa68_4ac9_8488_dd477093f961","uuid":"03a1b50a-eb45-40cb-bd28-5ccfee0a8163"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"c8b6e9e5-02bc-4f09-927b-bd699f42fe8e"},"edge_type":"inherent","type":"","uuid":"93336e9a-123d-4e66-bf11-e16a358f6d8c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"85f9ce27-583d-4d6e-b269-560a83c3333d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"535f2c4e-8572-4a13-b5b8-be8179de0fb0"},"edge_type":"inherent","type":"","uuid":"3f175465-c79b-445e-964b-4ab63689ea49","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_2814f949_fa68_4ac9_8488_dd477093f961","uuid":"03a1b50a-eb45-40cb-bd28-5ccfee0a8163"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"85f9ce27-583d-4d6e-b269-560a83c3333d"},"edge_type":"inherent","type":"","uuid":"0cc6e6b3-d825-4d14-b371-25147fb053dc","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"535f2c4e-8572-4a13-b5b8-be8179de0fb0"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_2814f949_fa68_4ac9_8488_dd477093f961"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c8b6e9e5-02bc-4f09-927b-bd699f42fe8e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"c7bebd3d-fcb3-4c57-8354-db62df983f29"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"85f9ce27-583d-4d6e-b269-560a83c3333d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_9fa1acf4_bb3c_4ac6_be87_1f52537922be"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"535f2c4e-8572-4a13-b5b8-be8179de0fb0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"65479eb1-82a9-4512-868f-a55ca00b2bd1"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"03a1b50a-eb45-40cb-bd28-5ccfee0a8163","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_2814f949_fa68_4ac9_8488_dd477093f961"}],"description":"","message_list":[],"uuid":"760805d5-88d8-4423-8f24-99667ab9ab7f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_2814f949_fa68_4ac9_8488_dd477093f961","uuid":"cf6c6727-3d36-4810-9868-8a0de8ca2f5c"},"name":"SYS_GEN__Runbook_Deployment_2814f949_fa68_4ac9_8488_dd477093f961"}}],"message_list":[],"published_service_local_reference_list":[],"uuid":"2814f949-fa68-4ac9-8488-dd477093f961","min_replicas":"2","state":"ACTIVE","max_replicas":"2","depends_on_list":[],"editables":{"min_replicas":true,"max_replicas":true},"package_local_reference_list":[{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"}],"substrate_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"type":"GREENFIELD","options":{},"variable_list":[],"name":"5aed8000_deployment"}],"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"ee177387-515e-4e4f-b5dd-56d811046d36","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"8206ada8-4e20-405a-a4fd-fde80e191e05"},"retries":"0","description":"","type":"DAG","uuid":"20c8d47e-84d9-4fa9-99bb-911a9575bfeb","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_2814f949_fa68_4ac9_8488_dd477093f961","uuid":"5f25367e-1754-46e8-b3b9-f06702bddd5a"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"08f8fe93-f9ec-4cc0-b3e2-85c96c0f15d6"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"af794a91-7df2-4ef0-a339-40dd57945f04"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"7224c0ba-ca39-4549-8427-465b6a79ecec"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"45161aa5-a33a-49fd-a2fc-97377bceee0f"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"7224c0ba-ca39-4549-8427-465b6a79ecec"},"edge_type":"inherent","type":"","uuid":"7d9d12f8-5d94-4725-9fbd-db8661e2ecdd","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"45161aa5-a33a-49fd-a2fc-97377bceee0f"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"af794a91-7df2-4ef0-a339-40dd57945f04"},"edge_type":"inherent","type":"","uuid":"917e9aff-7673-4012-be3e-38a02522b7b8","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"7224c0ba-ca39-4549-8427-465b6a79ecec"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_2814f949_fa68_4ac9_8488_dd477093f961","uuid":"5f25367e-1754-46e8-b3b9-f06702bddd5a"},"edge_type":"inherent","type":"","uuid":"068aa5f3-897a-4a72-915f-a49300807fb5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"08f8fe93-f9ec-4cc0-b3e2-85c96c0f15d6"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"08f8fe93-f9ec-4cc0-b3e2-85c96c0f15d6"},"edge_type":"inherent","type":"","uuid":"cd43a035-ea7f-4a86-8492-39d2f75ecbd4","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"af794a91-7df2-4ef0-a339-40dd57945f04"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_8206ada8_4e20_405a_a4fd_fde80e191e05"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"5f25367e-1754-46e8-b3b9-f06702bddd5a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_2814f949_fa68_4ac9_8488_dd477093f961"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"08f8fe93-f9ec-4cc0-b3e2-85c96c0f15d6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"70c13b00-fd35-4971-8c5c-cfc3723c834c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"af794a91-7df2-4ef0-a339-40dd57945f04","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"377c5a20-74f5-4678-b830-91ac76185f82"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"7224c0ba-ca39-4549-8427-465b6a79ecec","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"dade7481_runbook","uuid":"8eca21eb-942a-41ba-a6eb-af310476fb2b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"45161aa5-a33a-49fd-a2fc-97377bceee0f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"11876906_runbook","uuid":"df30efa0-47ec-4211-aeee-3f94f0510c54"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567"}],"description":"","message_list":[],"uuid":"48ad21cd-ea1a-4a47-a3b1-83bbc1c1566a","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_8206ada8_4e20_405a_a4fd_fde80e191e05","uuid":"20c8d47e-84d9-4fa9-99bb-911a9575bfeb"},"name":"SYS_GEN__Runbook_Application_8206ada8_4e20_405a_a4fd_fde80e191e05"}},{"description":"System action for starting an application","message_list":[],"uuid":"4f246c50-dabb-4df1-ae46-6d01ed5ae55c","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"8206ada8-4e20-405a-a4fd-fde80e191e05"},"retries":"0","description":"","type":"DAG","uuid":"338a4632-9761-4f3c-85df-f3eef4135bac","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"8b05dd57-3c03-4c27-86e4-62a3886e790c"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"d248c8d0-566a-4193-a7cf-087b39e68d64"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"8b05dd57-3c03-4c27-86e4-62a3886e790c"},"edge_type":"inherent","type":"","uuid":"67fd462c-d5a3-44ce-abd0-1aabadebcaaf","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"d248c8d0-566a-4193-a7cf-087b39e68d64"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_8206ada8_4e20_405a_a4fd_fde80e191e05"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8b05dd57-3c03-4c27-86e4-62a3886e790c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"b9ae54c3-6d36-453c-96a0-40da4c315eb1"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d248c8d0-566a-4193-a7cf-087b39e68d64","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"11876906_runbook","uuid":"df30efa0-47ec-4211-aeee-3f94f0510c54"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567"}],"description":"","message_list":[],"uuid":"124b245b-5c2a-4e91-b1a8-90c6a1093703","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_8206ada8_4e20_405a_a4fd_fde80e191e05","uuid":"338a4632-9761-4f3c-85df-f3eef4135bac"},"name":"SYS_GEN__Runbook_Application_8206ada8_4e20_405a_a4fd_fde80e191e05"}},{"description":"System action for restarting an application","message_list":[],"uuid":"8f8351a8-4b95-4613-bbd4-d7d4c3cc8178","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"8206ada8-4e20-405a-a4fd-fde80e191e05"},"retries":"0","description":"","type":"DAG","uuid":"7d074b49-5a51-42d4-9a49-39b87d5d49eb","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"538ec625-4069-4852-beaf-363939817366"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"1ce066c2-fa23-4322-9024-d5c36618a1aa"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"538ec625-4069-4852-beaf-363939817366"},"edge_type":"inherent","type":"","uuid":"b0ce53a8-59de-4261-9597-43b4406b8a32","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"1ce066c2-fa23-4322-9024-d5c36618a1aa"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_8206ada8_4e20_405a_a4fd_fde80e191e05"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"538ec625-4069-4852-beaf-363939817366","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"c4e98bb1-9e34-481a-8f9f-1053b17f8ceb"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1ce066c2-fa23-4322-9024-d5c36618a1aa","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"4150545e_runbook","uuid":"718a8106-ced6-4188-b0e4-7a29e3d4d0ca"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567"}],"description":"","message_list":[],"uuid":"d81a31f8-9bce-4a1d-9f3b-a27c8ced8cac","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_8206ada8_4e20_405a_a4fd_fde80e191e05","uuid":"7d074b49-5a51-42d4-9a49-39b87d5d49eb"},"name":"SYS_GEN__Runbook_Application_8206ada8_4e20_405a_a4fd_fde80e191e05"}},{"description":"System action for stopping an application","message_list":[],"uuid":"26465d75-f409-42af-9ffc-337535e0e149","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"8206ada8-4e20-405a-a4fd-fde80e191e05"},"retries":"0","description":"","type":"DAG","uuid":"3790c244-9fac-4322-a7d4-811c932f210a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"aa0e5821-01fb-447d-bc78-591846cea9d3"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"e7b562ae-52c3-4a1f-b593-f52a9f3c8bf0"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"aa0e5821-01fb-447d-bc78-591846cea9d3"},"edge_type":"inherent","type":"","uuid":"99d53517-c4ae-450e-b333-9699816a3f20","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"e7b562ae-52c3-4a1f-b593-f52a9f3c8bf0"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_8206ada8_4e20_405a_a4fd_fde80e191e05"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"aa0e5821-01fb-447d-bc78-591846cea9d3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d2728354_runbook","uuid":"8856982b-972a-4cad-8780-cbc8851d6937"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e7b562ae-52c3-4a1f-b593-f52a9f3c8bf0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"7000cfcf-fa8e-40c9-a2fe-325b072d788d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596"}],"description":"","message_list":[],"uuid":"8a25311a-b3db-4691-8a4e-3666094fca89","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_8206ada8_4e20_405a_a4fd_fde80e191e05","uuid":"3790c244-9fac-4322-a7d4-811c932f210a"},"name":"SYS_GEN__Runbook_Application_8206ada8_4e20_405a_a4fd_fde80e191e05"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"c5e14439-034b-4600-b311-3e0b330a9ed4","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"8206ada8-4e20-405a-a4fd-fde80e191e05"},"retries":"0","description":"","type":"DAG","uuid":"9e0ae205-510c-4d89-a180-6aec326805cd","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"f617525f-18af-496b-a099-00227162ff1e"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"9e0d4f84-f319-42e2-8d72-b8ddc8a4b025"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"3cbf8708-3ded-4f9f-b34c-24ab33eb7c13"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"42f438cb-f240-4b2f-910e-51025e1647af"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_2814f949_fa68_4ac9_8488_dd477093f961","uuid":"964e9560-82b3-476a-8fa2-bb40307126b0"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"f617525f-18af-496b-a099-00227162ff1e"},"edge_type":"inherent","type":"","uuid":"fb9a92ab-630c-418c-b9ae-f303019d7614","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"9e0d4f84-f319-42e2-8d72-b8ddc8a4b025"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"9e0d4f84-f319-42e2-8d72-b8ddc8a4b025"},"edge_type":"inherent","type":"","uuid":"10916d9b-91eb-4083-ac33-f84e7777b317","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"3cbf8708-3ded-4f9f-b34c-24ab33eb7c13"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"42f438cb-f240-4b2f-910e-51025e1647af"},"edge_type":"inherent","type":"","uuid":"c9f97bc7-531c-48c2-8cc6-ad7fb9fb2325","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_2814f949_fa68_4ac9_8488_dd477093f961","uuid":"964e9560-82b3-476a-8fa2-bb40307126b0"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"3cbf8708-3ded-4f9f-b34c-24ab33eb7c13"},"edge_type":"inherent","type":"","uuid":"fbdf9063-c4a7-42f0-aa34-f09e02f2a431","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"42f438cb-f240-4b2f-910e-51025e1647af"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_8206ada8_4e20_405a_a4fd_fde80e191e05"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f617525f-18af-496b-a099-00227162ff1e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d2728354_runbook","uuid":"8856982b-972a-4cad-8780-cbc8851d6937"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"9e0d4f84-f319-42e2-8d72-b8ddc8a4b025","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"59afb4f4_runbook","uuid":"4d689b82-3e6e-43a7-a61f-78cf6d8be04c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3cbf8708-3ded-4f9f-b34c-24ab33eb7c13","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"01f2ccd5-4d04-494a-a049-53c84731026a"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"42f438cb-f240-4b2f-910e-51025e1647af","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"481b0dd7-1a42-4caa-b4a2-e1b68df090d5"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"964e9560-82b3-476a-8fa2-bb40307126b0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_2814f949_fa68_4ac9_8488_dd477093f961"}],"description":"","message_list":[],"uuid":"d8cf430b-9e0f-4387-b485-f051680190e4","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_8206ada8_4e20_405a_a4fd_fde80e191e05","uuid":"9e0ae205-510c-4d89-a180-6aec326805cd"},"name":"SYS_GEN__Runbook_Application_8206ada8_4e20_405a_a4fd_fde80e191e05"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"138163a6-8ee1-4d41-be20-3cabf99da8c2","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"8206ada8-4e20-405a-a4fd-fde80e191e05"},"retries":"0","description":"","type":"DAG","uuid":"30f326b7-d960-4522-9f33-8b5c9779e076","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"1ae970c1-02ca-4c4f-a5f9-e9f119733493"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"a9166a0c-f395-4a4f-a87a-ebb6b40961b1"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"7f8e102a-40e2-4260-a202-661fe81daa12"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_2814f949_fa68_4ac9_8488_dd477093f961","uuid":"c81d56b7-f010-47a5-bffa-115f19501e07"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"1ae970c1-02ca-4c4f-a5f9-e9f119733493"},"edge_type":"inherent","type":"","uuid":"76cc3f06-672a-46ab-8246-d8fd6d92ebd8","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"a9166a0c-f395-4a4f-a87a-ebb6b40961b1"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"7f8e102a-40e2-4260-a202-661fe81daa12"},"edge_type":"inherent","type":"","uuid":"aaa811d5-e06c-45aa-98f4-ba1f4780c509","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_2814f949_fa68_4ac9_8488_dd477093f961","uuid":"c81d56b7-f010-47a5-bffa-115f19501e07"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"a9166a0c-f395-4a4f-a87a-ebb6b40961b1"},"edge_type":"inherent","type":"","uuid":"5ac73417-c007-42ef-9387-edb51c58c29a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"7f8e102a-40e2-4260-a202-661fe81daa12"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_8206ada8_4e20_405a_a4fd_fde80e191e05"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1ae970c1-02ca-4c4f-a5f9-e9f119733493","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"c7bebd3d-fcb3-4c57-8354-db62df983f29"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"a9166a0c-f395-4a4f-a87a-ebb6b40961b1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_9fa1acf4_bb3c_4ac6_be87_1f52537922be"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"7f8e102a-40e2-4260-a202-661fe81daa12","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596","uuid":"65479eb1-82a9-4512-868f-a55ca00b2bd1"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_46d333d1_e8a7_4b27_aa64_30ac70829596"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"2814f949-fa68-4ac9-8488-dd477093f961"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"c81d56b7-f010-47a5-bffa-115f19501e07","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_2814f949_fa68_4ac9_8488_dd477093f961"}],"description":"","message_list":[],"uuid":"5caad6ac-f69b-4961-a8e8-c99e0609f790","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_8206ada8_4e20_405a_a4fd_fde80e191e05","uuid":"30f326b7-d960-4522-9f33-8b5c9779e076"},"name":"SYS_GEN__Runbook_Application_8206ada8_4e20_405a_a4fd_fde80e191e05"}}],"message_list":[],"uuid":"8206ada8-4e20-405a-a4fd-fde80e191e05","state":"ACTIVE","dependency_list":[],"variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"5d8d3fd9-7768-4596-b549-046841f1c87e","value":"10.46.6.4","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"AD_IP"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"b781c4a3-25f7-457c-8e9f-61239a318e5b","value":"http:\/\/download.microsoft.com\/download\/8\/e\/c\/8ec3a7d8-05b4-440a-a71e-ca3ee25fe057\/rktools.exe","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"BPG_RKTOOLS_URL"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"163053c0-a985-4b72-82ac-81d4926ab3c9","value":"default-container-69049036518763","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"CONTAINER_NAME"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"364cb6f2-6b0a-4289-ac38-58aeb4ef0925","value":"mssql.com","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"DOMAIN"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"ef143746-7142-40c7-86c3-103dac1a81d0","value":"NTNX-CLS1","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"FAILOVER_CLUSTER_NAME"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"d2571533-2be2-45be-aaea-446b7bc693e7","value":"10.46.6.9","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"FAILOVER_VIP"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"ba705ca6-2a72-4bf9-a600-0db16d456eed","value":"10.46.6.10","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"MSSQL_VIP"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"051f6919-1d7a-44a9-ac62-9706ca4d414f","value":"10.46.34.96","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"PE_DATA_SERVICE_IP"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"1f5702d8-54e6-43b7-b8e0-f840613d4e60","value":"10.46.34.95","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"PE_IP"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"33483d02-7fb6-443c-a66d-16594c27e92b","value":"NTNX-SQLCLS1","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"SQL_CLUSTER_NAME"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"d3f537d3-fe1b-47c9-bd38-724580ef010f","value":"XEN_VolumeGroup1","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"VG_NAME"}],"name":"Nutanix"}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"LOCAL","uuid":"04ca4ba7-eaed-4178-8880-c103539f07ec"},"package_definition_list":[{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"b2f87522-6441-49fe-8ed4-bc8345fee689","name":"action_install","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","description":"","type":"DAG","uuid":"b25be13e-eb60-4365-aba8-a3901bff9a07","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Install_Crb_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"24d3cd5f-a19b-4449-9a28-457c975295f7"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_INSTALL","uuid":"24d3cd5f-a19b-4449-9a28-457c975295f7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","description":"","type":"DAG","uuid":"8306d922-058c-4cfe-9b3b-90d62e9310c8","child_tasks_local_reference_list":[{"kind":"app_task","name":"Apply OS BPG","uuid":"16071347-c52b-4661-bf59-401a5fcf3fdd"},{"kind":"app_task","name":"Apply SQL BPG","uuid":"d2f0fa03-1a5f-4ef0-8c14-9b8b23de370c"},{"kind":"app_task","name":"Attach VG","uuid":"e88d7d4a-14ab-4d56-b1c8-8b312d3ab24e"},{"kind":"app_task","name":"Configure WSFC","uuid":"75430fc8-644c-4b88-a1bd-eb19424e9d4f"},{"kind":"app_task","name":"Connect Mount VG","uuid":"e6eda1d6-ddce-4885-89c4-d0eb240d2c29"},{"kind":"app_task","name":"Create AAG","uuid":"8847fcec-5aaf-4a08-bd24-c3056c425829"},{"kind":"app_task","name":"Create VG","uuid":"d6e3a93d-7d6c-44b8-a966-b96c22721a88"},{"kind":"app_task","name":"Enable AAG","uuid":"966ce7d9-1de9-4e2a-9e2a-139eef0c8d73"},{"kind":"app_task","name":"Get IQN","uuid":"776df270-5394-41ab-9284-c3caaf0a29f5"},{"kind":"app_task","name":"Install FC","uuid":"50209b45-54b0-4c13-9230-221bf892d2c9"},{"kind":"app_task","name":"Install SQL","uuid":"4a9daa04-2da2-4543-88dd-62bd661baf46"},{"kind":"app_task","name":"JoinDomain","uuid":"f54bbb0f-0f2d-422a-b098-98ca0e2776ee"},{"kind":"app_task","name":"Pre Requisites","uuid":"e47f135e-841a-4210-bd7d-3ff125796987"},{"kind":"app_task","name":"Sleep","uuid":"7d1bfcc7-d4f1-4d7d-9a64-71f6c493a623"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Apply OS BPG","uuid":"16071347-c52b-4661-bf59-401a5fcf3fdd"},"edge_type":"user_defined","type":"","uuid":"698cdfea-b158-4eec-ba38-a68dcc8e3ebb","to_task_reference":{"kind":"app_task","name":"Apply SQL BPG","uuid":"d2f0fa03-1a5f-4ef0-8c14-9b8b23de370c"}},{"from_task_reference":{"kind":"app_task","name":"Apply SQL BPG","uuid":"d2f0fa03-1a5f-4ef0-8c14-9b8b23de370c"},"edge_type":"user_defined","type":"","uuid":"a7765173-dbee-4b6c-968a-9ddd99eeb3ff","to_task_reference":{"kind":"app_task","name":"Enable AAG","uuid":"966ce7d9-1de9-4e2a-9e2a-139eef0c8d73"}},{"from_task_reference":{"kind":"app_task","name":"Attach VG","uuid":"e88d7d4a-14ab-4d56-b1c8-8b312d3ab24e"},"edge_type":"user_defined","type":"","uuid":"98a82d46-d12d-4918-bcf7-59f3b3ed1378","to_task_reference":{"kind":"app_task","name":"Connect Mount VG","uuid":"e6eda1d6-ddce-4885-89c4-d0eb240d2c29"}},{"from_task_reference":{"kind":"app_task","name":"Configure WSFC","uuid":"75430fc8-644c-4b88-a1bd-eb19424e9d4f"},"edge_type":"user_defined","type":"","uuid":"e4126daf-0bde-4896-8afb-36a8fa89d8ac","to_task_reference":{"kind":"app_task","name":"Install SQL","uuid":"4a9daa04-2da2-4543-88dd-62bd661baf46"}},{"from_task_reference":{"kind":"app_task","name":"Connect Mount VG","uuid":"e6eda1d6-ddce-4885-89c4-d0eb240d2c29"},"edge_type":"user_defined","type":"","uuid":"69a0a0ad-ea55-444a-ab1b-e39ef1eecdc5","to_task_reference":{"kind":"app_task","name":"Install FC","uuid":"50209b45-54b0-4c13-9230-221bf892d2c9"}},{"from_task_reference":{"kind":"app_task","name":"Create VG","uuid":"d6e3a93d-7d6c-44b8-a966-b96c22721a88"},"edge_type":"user_defined","type":"","uuid":"83dd7d3b-0f55-4000-ac65-df97dae23911","to_task_reference":{"kind":"app_task","name":"Get IQN","uuid":"776df270-5394-41ab-9284-c3caaf0a29f5"}},{"from_task_reference":{"kind":"app_task","name":"Enable AAG","uuid":"966ce7d9-1de9-4e2a-9e2a-139eef0c8d73"},"edge_type":"user_defined","type":"","uuid":"dae4ae4b-b47c-4971-81ba-c1c6e3497c5c","to_task_reference":{"kind":"app_task","name":"Create AAG","uuid":"8847fcec-5aaf-4a08-bd24-c3056c425829"}},{"from_task_reference":{"kind":"app_task","name":"Get IQN","uuid":"776df270-5394-41ab-9284-c3caaf0a29f5"},"edge_type":"user_defined","type":"","uuid":"18d08e01-8c81-4e53-8c97-c9eebda67aea","to_task_reference":{"kind":"app_task","name":"Attach VG","uuid":"e88d7d4a-14ab-4d56-b1c8-8b312d3ab24e"}},{"from_task_reference":{"kind":"app_task","name":"Install FC","uuid":"50209b45-54b0-4c13-9230-221bf892d2c9"},"edge_type":"user_defined","type":"","uuid":"33ad2d9f-5df5-4e1e-a932-d2ee29cc52e6","to_task_reference":{"kind":"app_task","name":"Configure WSFC","uuid":"75430fc8-644c-4b88-a1bd-eb19424e9d4f"}},{"from_task_reference":{"kind":"app_task","name":"Install SQL","uuid":"4a9daa04-2da2-4543-88dd-62bd661baf46"},"edge_type":"user_defined","type":"","uuid":"5a660b92-3bb1-4b00-9fed-f2ebc11e6a7c","to_task_reference":{"kind":"app_task","name":"Apply OS BPG","uuid":"16071347-c52b-4661-bf59-401a5fcf3fdd"}},{"from_task_reference":{"kind":"app_task","name":"JoinDomain","uuid":"f54bbb0f-0f2d-422a-b098-98ca0e2776ee"},"edge_type":"user_defined","type":"","uuid":"92982bc3-2976-4af5-ab5e-242aefee9c09","to_task_reference":{"kind":"app_task","name":"Sleep","uuid":"7d1bfcc7-d4f1-4d7d-9a64-71f6c493a623"}},{"from_task_reference":{"kind":"app_task","name":"Pre Requisites","uuid":"e47f135e-841a-4210-bd7d-3ff125796987"},"edge_type":"user_defined","type":"","uuid":"cffecd10-421e-4edc-ac4e-428052bc2e2f","to_task_reference":{"kind":"app_task","name":"JoinDomain","uuid":"f54bbb0f-0f2d-422a-b098-98ca0e2776ee"}},{"from_task_reference":{"kind":"app_task","name":"Sleep","uuid":"7d1bfcc7-d4f1-4d7d-9a64-71f6c493a623"},"edge_type":"user_defined","type":"","uuid":"3cc2026a-076c-472f-9510-0dc68c312177","to_task_reference":{"kind":"app_task","name":"Create VG","uuid":"d6e3a93d-7d6c-44b8-a966-b96c22721a88"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ddaf74d2_dag"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"16071347-c52b-4661-bf59-401a5fcf3fdd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"$start_time = Get-Date\n\n$TempDirectory = \"C:\\Temp\"\n$RktTemp = \"$TempDirectory\\rktools.2003\"\n\n$url = \"@@{BPG_RKTOOLS_URL}@@\"\n$filePath = \"$TempDirectory\\rktools.exe\"\n\nNew-Item -ItemType Directory -Force -Path $TempDirectory\n(New-Object System.Net.WebClient).DownloadFile($url,$filePath)\n\n& $filePath \/Q \/T:\"$RktTemp\" \/C\n\nStart-Sleep 10\n\n$PackageName = \"rktools.2003\"\n$setupPath = \"C:\\Windows\\System32\\msiexec.exe\"\n$silentArgs = \"\/i $RktTemp\\rktools.msi \/qn\"\n$validExitCodes = @(0)\n\nWrite-Output \"Installing $PackageName....\"\n\n$install = Start-Process -FilePath $setupPath -ArgumentList $silentArgs -Wait -NoNewWindow -PassThru\n$install.WaitForExit()\n\n$exitCode = $install.ExitCode\n$install.Dispose()\n\nWrite-Output \"Command [`\"$setupPath`\" $silentArgs] exited with `'$exitCode`'.\"\nif ($validExitCodes -notcontains $exitCode) {\n\tWrite-Output \"Running [`\"$setupPath`\" $silentArgs] was not successful. Exit code was '$exitCode'. See log for possible error messages.\"\n\texit 1\n}\n\n# OS related tunning\n# Set Windows Power Options to High Performance\npowercfg -s 8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c\n\n#Grant Memory privileges to user \n$ntrights_cli = \"C:\\Program Files (x86)\\Windows Resource Kits\\Tools\\ntrights.exe\"\n& $ntrights_cli -u \"NT SERVICE\\MSSQLSERVER\" +r SeLockMemoryPrivilege\n& $ntrights_cli -u \"NT SERVICE\\MSSQLSERVER\" +r SeManageVolumePrivilege\n\nWrite-Output \"Time taken: $((Get-Date).Subtract($start_time).seconds) Second(s)\"","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"241466f6-7a7e-4e0a-bc28-690d736f611d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Apply OS BPG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"d2f0fa03-1a5f-4ef0-8c14-9b8b23de370c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"$start_time = Get-Date\n\n$TempDirectory = \"C:\\Temp\"\n$sqladdparms_cli = \"$TempDirectory\\Add-SqlServerStartupParameter.ps1\"\n$TSQLSCRIPTSDIR = \"$TempDirectory\\TSQL_Scripts\"\nNew-Item -ItemType Directory -Force -Path $TSQLSCRIPTSDIR\n  \nSet-Content -Path \"$sqladdparms_cli\" -Value '\nparam(\n    ## The parameter you wish to add\n    [Parameter(Mandatory = $true)]\n    $StartupParameter\n)\n\n$hklmRootNode = \"HKLM:\\SOFTWARE\\Microsoft\\Microsoft SQL Server\"\n\n$props = Get-ItemProperty \"$hklmRootNode\\Instance Names\\SQL\"\n$instances = $props.psobject.properties | ?{$_.Value -like \"MSSQL*\"} | select Value\n\n$instances | %{\n    $inst = $_.Value;\n    $regKey = \"$hklmRootNode\\$inst\\MSSQLServer\\Parameters\"\n    $props = Get-ItemProperty $regKey\n    $params = $props.psobject.properties | ?{$_.Name -like \"SQLArg*\"} | select Name, Value\n    #$params | ft -AutoSize\n    $hasFlag = $false\n    foreach ($param in $params) {\n        if($param.Value -eq $StartupParameter) {\n            $hasFlag = $true\n            break;\n        }\n    }\n    if (-not $hasFlag) {\n        \"Adding $StartupParameter\"\n        $newRegProp = \"SQLArg\"+($params.Count)\n        Set-ItemProperty -Path $regKey -Name $newRegProp -Value $StartupParameter\n    } else {\n        \"$StartupParameter already set\"\n    }\n}'\nSet-Content -Path \"$TSQLSCRIPTSDIR\\01-ChangeTempDB.sql\" -Value \"use master`r`n\ngo`r`n\nAlter database tempdb modify file (name = tempdev, filename = 'I:\\TEMPDB01\\tempdb01.mdf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb modify file (name = templog, filename = 'T:\\TempDB-logs01\\templog01.ldf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb ADD file (name = tempdev02, filename = 'I:\\TEMPDB01\\tempdb02.ndf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb ADD file (name = tempdev03, filename = 'J:\\TEMPDB02\\tempdb03.ndf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb ADD file (name = tempdev04, filename = 'J:\\TEMPDB02\\tempdb04.ndf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\n`r`n\nALTER DATABASE [tempdb] MODIFY FILE (NAME=N'tempdev', NEWNAME=N'tempdev01')`r`n\nGO`r`n\nALTER DATABASE [tempdb] MODIFY FILE (NAME=N'templog', NEWNAME=N'templog01')`r`n\nGO\"\n\nSet-Content -Path \"$TSQLSCRIPTSDIR\\02-IncreaseTempDB_logs.sql\" -Value \"Use master`r`n\ngo`r`n\nALTER DATABASE tempdb MODIFY FILE (NAME = templog01, filename = 'T:\\TempDB-logs01\\templog01.ldf', SIZE`r`n\n= 8096);`r`n\nGO`r`n\nALTER DATABASE tempdb MODIFY FILE (NAME = templog01, FILENAME = 'T:\\TempDB-logs01\\templog01.ldf', SIZE`r`n\n= 12288);`r`n\nGO\"\n\nSet-Content -Path \"$TSQLSCRIPTSDIR\\03-SQL_set_memory.sql\" -Value \"USE master;`r`n\nexec sp_configure 'show advanced options', 1;`r`n\nRECONFIGURE;`r`n\nGO`r`n\nDECLARE `r`n\n        @total_mem decimal (10,0),`r`n\n\t\t@min int,`r`n\n\t\t@max int`r`n\nSELECT `r`n\n   --SELECT (physical_memory_kb\/1024) AS Server_Physical_Memory_MB`r`n\n  @total_mem = (physical_memory_kb\/1024)`r`n\nFROM sys.dm_os_sys_info`r`n\n`r`n\nset @min = @total_mem * 0.1`r`n\nset @max = @total_mem * 0.85`r`n\nprint @min`r`n\nprint @max`r`n\n--print @total_mem`r`n\n`r`n\n`r`n\nEXEC sp_configure 'min server memory (MB)',@min`r`n\nEXEC sp_configure 'max server memory (MB)',@max`r`n\nRECONFIGURE\"\n\nSet-Content -Path \"$TSQLSCRIPTSDIR\\04-SQL-ChangeDefaultPaths.sql\" -Value \"USE [master]`r`n\nGO`r`n\n-- Change default location for data files`r`n\nEXEC xp_instance_regwrite`r`n\nN'HKEY_LOCAL_MACHINE',`r`n\nN'Software\\Microsoft\\MSSQLServer\\MSSQLServer',`r`n\nN'DefaultData',`r`n\nREG_SZ,`r`n\nN'G:\\SQLDATA01'`r`n\nGO`r`n\n-- Change default location for log files`r`n\nEXEC xp_instance_regwrite`r`n\nN'HKEY_LOCAL_MACHINE',`r`n\nN'Software\\Microsoft\\MSSQLServer\\MSSQLServer',`r`n\nN'DefaultLog',`r`n\nREG_SZ,`r`n\nN'L:\\UserDB-logs01'`r`n\nGO`r`n\n-- Change default location for backups`r`n\nEXEC xp_instance_regwrite`r`n\nN'HKEY_LOCAL_MACHINE',`r`n\nN'Software\\Microsoft\\MSSQLServer\\MSSQLServer',`r`n\nN'BackupDirectory',`r`n\nREG_SZ,`r`n\nN'R:\\SQLBACK'`r`n\nGO\"\n\n#create directories\nmkdir G:\\SQLDATA01\\\nmkdir H:\\SQLDATA02\\\nmkdir I:\\TEMPDB01\\\nmkdir J:\\TEMPDB02\\\nmkdir L:\\UserDB-logs01\\\nmkdir T:\\TempDB-logs01\\\nmkdir R:\\SQLBACK\n\n#ADD SQL T parameters \n#T1117 This parameter forces MS SQL Server to grow all database files uniformly\n#T1118 This parameter forces MS SQL Server to use full extents only\n& $sqladdparms_cli '-T1117'\n& $sqladdparms_cli '-T1118'\nrestart-service MSSQL* -force\n\n#import powershell SQL module\nimport-module \"sqlps\" -DisableNameChecking\n\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\01-ChangeTempDB.sql\"\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\02-IncreaseTempDB_logs.sql\"\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\03-SQL_set_memory.sql\"\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\04-SQL-ChangeDefaultPaths.sql\"\n\n#Delete original SQL temp files\nstop-service MSSQL* \nStart-Sleep 5\nrm \"F:\\MSSQL\\MSSQL12.MSSQLSERVER\\MSSQL\\DATA\\temp*\"\n\nstart-service MSSQL* \nwmic useraccount get sid\nWrite-Output \"Time taken: $((Get-Date).Subtract($start_time).seconds) Second(s)\"","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"241466f6-7a7e-4e0a-bc28-690d736f611d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Apply SQL BPG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"e88d7d4a-14ab-4d56-b1c8-8b312d3ab24e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"static","type":"","command_line_args":"","exit_status":[],"script":"#script\nprism_ip = '@@{PE_IP}@@'\nusername = '@@{PE_CREDS.username}@@'\npassword = '@@{PE_CREDS.secret}@@'\nvgname = '@@{VG_NAME}@@'\nvg_uuid = ''\nIQN='@@{IQN}@@'\n\napi_url = \"https:\/\/\" + prism_ip + \":9440\/PrismGateway\/services\/rest\/v2.0\/\"\n\nprint \"INFO: Attaching VG {} to node.\".format(vgname)\n\n# -*- Check volume group existance\n\ntry:\n  check_vg_url = api_url + \"volume_groups\"\n  response = urlreq(check_vg_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\n  vgs = json.loads(response.content)\n  for vg in vgs['entities']:\n    if vg['name'] == vgname:\n      vg_uuid = vg['uuid']\nexcept Exception as e:\n\tprint \"ERROR: Failed to get volume group, check volume group or check username\/password\"\n\tprint e.message\n\texit(1)\n    \nif vg_uuid == '':\n  print \"ERROR: Volume group with name {} doesn't exists\".format(vgname)\n  exit(1)\n\n# -*- Attach Volume Group\n\nattach_vg_url = api_url + \"volume_groups\/\" + vg_uuid + \"\/open\"\npayload = {\n  \"iscsi_client\": {\n    \"client_address\": IQN\n  },\n  \"operation\": \"ATTACH\"\n}\n\nresponse = urlreq(attach_vg_url, verb='POST', auth=\"BASIC\", user=username, passwd=password, params=json.dumps(payload), verify=False)\nif response.status_code != 201:\n\tprint \"ERROR: Attaching vg '{}' failed.\".format(vgname)\n\nattach_status = json.loads(response.content)\nif attach_status['value']:\n  print \"INFO: Attaching vg '{}' Successful.\".format(vgname)\nelse:\n  print \"ERROR: Attaching vg '{}' failed.\".format(vgname)"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Attach VG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"75430fc8-644c-4b88-a1bd-eb19424e9d4f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"if (\"@@{calm_array_index}@@\" -ne \"0\"){\n\texit\n}\n\n$FailOverClusterName='@@{FAILOVER_CLUSTER_NAME}@@'\n$FailOverVIP='@@{FAILOVER_VIP}@@'\n$Nodes=\"@@{calm_array_address}@@\".split(',')\n\n# -*- Test Failover Cluster\n\nif(Test-Cluster -Node $Nodes){\n\tWrite-Output \"INFO: Test-Cluster Success.\"\n}\nelse\n{\n\tWrite-Output \"ERROR: Test-Cluster Failed.\"\n    exit 1\n}\n\nforeach ( $node in $(\"@@{calm_array_address}@@\".split(',')) ){Test-WSMan $node}\n\n# -*- Create Failover Cluster\n\nNew-Cluster -Name $FailOverClusterName -Node $Nodes -StaticAddress $FailOverVIP\n\n# -*- Rename Cluster Disks\n$ClusterDisks =  Get-CimInstance -ClassName MSCluster_Resource -Namespace root\/mscluster -Filter \"type = 'Physical Disk'\"\nforeach ($Disk in $ClusterDisks) {\n$DiskResource = Get-CimAssociatedInstance -InputObject $Disk -ResultClass MSCluster_DiskPartition\n\tif (-not ($DiskResource.VolumeLabel -eq $Disk.Name)) {\n\t\tInvoke-CimMethod -InputObject $Disk -MethodName Rename -Arguments @{newName = $DiskResource.VolumeLabel}\n  \t}\n}"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure WSFC"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"e6eda1d6-ddce-4885-89c4-d0eb240d2c29","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"New-IscsiTargetPortal -TargetPortalAddress @@{PE_DATA_SERVICE_IP}@@\nGet-IscsiTarget | Connect-IscsiTarget -IsPersistent $true\n\n#Initialize Disks\nif (((Get-Disk -Number 1 -ErrorAction SilentlyContinue).HealthStatus -eq \"Healthy\") -and ((Get-Disk -Number 2 -ErrorAction SilentlyContinue).HealthStatus -eq \"Healthy\")) {\n\tGet-Disk -Number 1 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 2 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 3 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 4 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 5 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 6 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 7 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 8 | Initialize-Disk -ErrorAction SilentlyContinue\n\tNew-Partition -DiskNumber 1 -UseMaximumSize -DriveLetter F -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -FileSystem NTFS -NewFileSystemLabel \"SQLINSTALL\" \n\tNew-Partition -DiskNumber 2 -UseMaximumSize -DriveLetter R -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"SQLBCK\"\n\tNew-Partition -DiskNumber 3 -UseMaximumSize -DriveLetter G -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"DATA01\" \n\tNew-Partition -DiskNumber 4 -UseMaximumSize -DriveLetter H -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"DATA02\"\n    New-Partition -DiskNumber 5 -UseMaximumSize -DriveLetter I -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"TEMPDB01\" \n\tNew-Partition -DiskNumber 6 -UseMaximumSize -DriveLetter J -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"TEMPDB02\"\n    New-Partition -DiskNumber 7 -UseMaximumSize -DriveLetter T -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"TEMPDBLOG01\" \n\tNew-Partition -DiskNumber 8 -UseMaximumSize -DriveLetter L -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"ULOG01\"\n\n} else {\n\tWrite-Output \"Disks does not exists or not healthy.`nIf you havent added disks please add 8 disk.\"\n\texit 1\n}\n\nif (\"@@{calm_array_index}@@\" -eq \"0\"){\n  if ((Get-Disk -Number 9 -ErrorAction SilentlyContinue).HealthStatus -eq \"Healthy\"){\n      Get-Disk -Number 9 | Initialize-Disk -ErrorAction SilentlyContinue\n      New-Partition -DiskNumber 9 -UseMaximumSize -DriveLetter W -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -FileSystem NTFS -NewFileSystemLabel \"Witness\" \n  } else {\n      Write-Output \"Witness Disk does not exists or not healthy.`nIf you havent added disks please add a volume group and attach.`n `t - Witness : 1GB\"\n      exit 1\n  }\n}\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Connect Mount VG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"8847fcec-5aaf-4a08-bd24-c3056c425829","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"if (\"$(Get-ClusterNode | where {$_.Id -eq 1} | select -ExpandProperty Name)\" -ne \"$(hostname)\"){\n\texit\n}\n$AGName = '@@{SQL_CLUSTER_NAME}@@'\n$PrimaryNode = $(hostname)\n$IP = '@@{MSSQL_VIP}@@\/255.255.255.0'\n$replicas = @()\n\n$cname = (Get-Cluster -name $PrimaryNode).name\n$nodes = (get-clusternode -Cluster $cname).name\n\n$sqlperms = @\"\nuse [master];\nGRANT ALTER ANY AVAILABILITY GROUP TO [NT AUTHORITY\\SYSTEM];\nGRANT CONNECT SQL TO [NT AUTHORITY\\SYSTEM];\nGRANT VIEW SERVER STATE TO [NT AUTHORITY\\SYSTEM];\n\"@\n\nforeach($node in $nodes)\n{\n\tInvoke-Sqlcmd -ServerInstance $node -Database master -Query $sqlperms\n\t$replicas += New-SqlAvailabilityReplica -Name $node -EndpointUrl \"TCP:\/\/$($node):5022\" -AvailabilityMode \"SynchronousCommit\" -FailoverMode \"Automatic\" -AsTemplate -Version 12 \n}\n\n\nNew-SqlAvailabilityGroup -Name $AGName -Path \"SQLSERVER:\\SQL\\$PrimaryNode\\DEFAULT\" -AvailabilityReplica $replicas\n$nodes | Where-Object {$_ -ne $PrimaryNode} | ForEach-Object {Join-SqlAvailabilityGroup -path \"SQLSERVER:\\SQL\\$_\\DEFAULT\" -Name $AGName}\nNew-SqlAvailabilityGroupListener -Name $AGName -staticIP $IP -Port 1433 -Path \"SQLSERVER:\\Sql\\$PrimaryNode\\DEFAULT\\AvailabilityGroups\\$AGName\"\n","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"241466f6-7a7e-4e0a-bc28-690d736f611d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Create AAG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"d6e3a93d-7d6c-44b8-a966-b96c22721a88","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"static","type":"","command_line_args":"","exit_status":[],"script":"#script\n\nif \"@@{calm_array_index}@@\" != \"0\":\n  exit(0)\nprism_ip = '@@{PE_IP}@@'\nusername = '@@{PE_CREDS.username}@@'\npassword = '@@{PE_CREDS.secret}@@'\nstorage_container_name = '@@{CONTAINER_NAME}@@'\nstorage_container_uuid = ''\nvgname = '@@{VG_NAME}@@'\n\napi_url = \"https:\/\/\" + prism_ip + \":9440\/PrismGateway\/services\/rest\/v2.0\/\"\n\nprint \"INFO: Retrieving storage container uuid for: {}.\".format(storage_container_name)\n\n# -*- Get Container UUID\n\nget_container_uuid_url = api_url + \"storage_containers\"\ntry:\n  response = urlreq(get_container_uuid_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\n  storage_containers = json.loads(response.content)\n  for container in storage_containers['entities']:\n    if container['name'] == storage_container_name:\n      storage_container_uuid = container['storage_container_uuid']\nexcept Exception as e:\n\tprint \"ERROR: Failed to get storage container uuid, check storage container name or check username\/password\"\n\tprint e.message\n\texit(1)\n\nprint \"INFO: storage container uuid is: {}.\".format(storage_container_uuid)\n\n# -*- Check volume group existance\n\ncheck_vg_url = api_url + \"volume_groups\"\nresponse = urlreq(check_vg_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\nvgs = json.loads(response.content)\nfor vg in vgs['entities']:\n  if vg['name'] == vgname:\n    print \"ERROR: Volume group with name {} already exists.\".format(vgname)\n    exit(1)\n\nprint \"INFO: Creating volume group '{}'.\".format(vgname)\n\n# -*- Create Volume Group\n\ncreate_vg_url = api_url + \"volume_groups\"\npayload = {\n\t\"disk_list\": [{\n\t\t\"create_config\": {\n\t\t\t\"size\": 1073741824,\n\t\t\t\"storage_container_uuid\": storage_container_uuid\n\t\t},\n\t\t\"index\": 0\n\t}],\n\t\"is_shared\": True,\n\t\"name\": vgname\n}\n\nresponse = urlreq(create_vg_url, verb='POST', auth=\"BASIC\", user=username, passwd=password, params=json.dumps(payload), verify=False)\nif response.status_code != 201:\n\tprint \"ERROR: creation of volume group '{}' failed.\".format(vgname)\n\nvg_create_status = json.loads(response.content)\ntask_uuid = vg_create_status['task_uuid']\n\nsleep(5)\n\ncheck_vg_creation_url = api_url + \"tasks\/\" + task_uuid\nresponse = response = urlreq(check_vg_creation_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\nvg_create_status = json.loads(response.content)\n\nif vg_create_status['progress_status'] != \"Succeeded\":\n\tprint \"ERROR: creation of volume group '{}' failed.\".format(vgname)\n\texit(1)\nelse:\n\tprint \"INFO: creation of volume group '{}' Successful.\".format(vgname)"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Create VG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"966ce7d9-1de9-4e2a-9e2a-139eef0c8d73","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"# -*- Variable for T-SQL command\n$netbios = \"@@{DOMAIN}@@\".Split(\".\")[0].ToUpper()\n$createLogin = \"CREATE LOGIN [$netbios\\sqlservice] FROM WINDOWS; \" \n$grantConnectPermissions = \"GRANT CONNECT ON ENDPOINT::Endpoint_AG TO [$netbios\\sqlservice];\"\n\nEnable-SqlAlwaysOn -ServerInstance $(hostname) -Force \nNew-SqlHADREndpoint -Path \"SQLSERVER:\\SQL\\$(hostname)\\DEFAULT\" -Name \"Endpoint_AG\" -Port 5022 -EncryptionAlgorithm Aes -Encryption Required \nSet-SqlHADREndpoint -Path \"SQLSERVER:\\SQL\\$(hostname)\\DEFAULT\\Endpoints\\Endpoint_AG\" -State Started\nInvoke-SqlCmd -Server $(hostname) -Query $createLogin\nInvoke-SqlCmd -Server $(hostname) -Query $grantConnectPermissions","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"241466f6-7a7e-4e0a-bc28-690d736f611d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Enable AAG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"776df270-5394-41ab-9284-c3caaf0a29f5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"Write-Output \"IQN=$((Get-InitiatorPort).NodeAddress)\"","eval_variables":["IQN"],"eval_scope":"local","type":"","script_type":"npsscript"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Get IQN"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"50209b45-54b0-4c13-9230-221bf892d2c9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"Install-WindowsFeature -Name Failover-Clustering -IncludeManagementTools\n\nif (-not (get-WindowsFeature -Name Failover-Clustering -ErrorAction SilentlyContinue | select -ExpandProperty Installed)){\n\tWrite-output \"Failover Clustering is not installed\"\n\texit 1\n}"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Install FC"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"4a9daa04-2da2-4543-88dd-62bd661baf46","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"#Install-WindowsFeature -IncludeAllSubFeature -ErrorAction Stop \"Net-Framework-Core\"\n$DOMAINNAME=(Get-WmiObject Win32_ComputerSystem).Domain\n$setupDriveLetter = \"D:\"\n$setupPath = \"$setupDriveLetter\\setup.exe\"\n$silentArgs = \"\/IACCEPTSQLSERVERLICENSETERMS \/Q \/ACTION=install \/FEATURES=SQLENGINE,FULLTEXT,SSMS,ADV_SSMS \/AGTSVCACCOUNT=`\"@@{SQL_CREDS.username}@@`\" \/AGTSVCPASSWORD=@@{SQL_CREDS.secret}@@ \/SQLSVCACCOUNT=`\"@@{SQL_CREDS.username}@@`\" \/SQLSVCPASSWORD=@@{SQL_CREDS.secret}@@ \/SQLSYSADMINACCOUNTS=`\"$DOMAINNAME\\Domain Admins`\" \/ISSVCACCOUNT=`\"@@{SQL_CREDS.username}@@`\" \/ISSVCPASSWORD=@@{SQL_CREDS.secret}@@ \/ASSYSADMINACCOUNTS=`\"@@{SQL_CREDS.username}@@`\" \/INSTANCEID=MSSQLSERVER \/INSTANCENAME=MSSQLSERVER \/UPDATEENABLED=True \/UPDATESOURCE=`\"C:\\Temp`\" \/INDICATEPROGRESS \/TCPENABLED=1 \/INSTALLSQLDATADIR=`\"F:\\MSSQL`\" \/SQLUSERDBLOGDIR=`\"L:\\MSSQL`\" \/SQLTEMPDBLOGDIR=`\"T:\\MSSQL`\"\"\n$validExitCodes = @(0)\n\n$install = Start-Process -FilePath $setupPath -ArgumentList $silentArgs -Wait -NoNewWindow -PassThru\n$install.WaitForExit()\n$exitCode = $install.ExitCode\n$install.Dispose()\n\nWrite-Output \"SQL Failover Cluster Installation exited with `'$exitCode`'.\"\nif ($validExitCodes -notcontains $exitCode) {\n\tWrite-Output \"Running [`\"$setupPath`\" $silentArgs] was not successful. Exit code was '$exitCode'. See log for possible error messages.\"\n\texit 1\n}"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Install SQL"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"f54bbb0f-0f2d-422a-b098-98ca0e2776ee","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"##############################################\n# Name        : JoinDomain\n# Author      : K Sarat Kumar\n# Version     : 1.0\n# Description : Script is used to join to domain.\n##############################################\n\nfunction JointoDomain {\n  [CmdletBinding()]\n  Param(\n      [parameter(Mandatory=$true)]\n      [string]$DomainName,\n      [parameter(Mandatory=$false)]\n      [string]$OU,\n      [parameter(Mandatory=$true)]\n      [string]$Username,\n      [parameter(Mandatory=$true)]\n      [string]$Password,\n      [parameter(Mandatory=$true)]\n      [string]$Server\n  )\n  $adapter = Get-NetAdapter | ? {$_.Status -eq \"up\"}\n  $adapter | Set-DnsClientServerAddress -ServerAddresses $Server\n\n  if ($env:computername  -eq $env:userdomain) {\n    Write-Host \"Not in domain\"\n    #$adminname = \"$DomainName\\$Username\"\n    $adminname = \"$Username\"\n    $adminpassword = ConvertTo-SecureString -asPlainText -Force -String \"$Password\"\n    Write-Host \"$adminname , $password\"\n    $credential = New-Object System.Management.Automation.PSCredential($adminname,$adminpassword)\n    Add-computer -DomainName $DomainName -Credential $credential -force -Options JoinWithNewName,AccountCreate -PassThru -ErrorAction Stop\n  } else {\n     Write-Host \"Already in domain\"\n  }\n}\n\nJointoDomain -DomainName \"@@{DOMAIN}@@\" -Username \"@@{DOMAIN_CRED.username}@@\" -Password \"@@{DOMAIN_CRED.secret}@@\" -Server \"@@{AD_IP}@@\"\n\nRestart-Computer -Force -AsJob\nexit 0\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"JoinDomain"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","description":"","type":"EXEC","uuid":"e47f135e-841a-4210-bd7d-3ff125796987","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"##############################################\n# Name        : Pre-requisites\n# Author      : K Sarat Kumar\n# Version     : 1.0\n# Description : Script is used to join to domain.\n##############################################\n\n# -*- Pre-requisite to enable credssp and set 'Server' role\nEnable-WSManCredSSP -Role Server -Force\n\n# -*- Enabling and starting 'msiscsi'\nSet-Service -Name msiscsi -StartupType Automatic\nStart-Service msiscsi\n\n# -*- Change first Ehternet adapter name to 'Production'\nGet-NetAdapter -Name \"Ethernet\" | Rename-NetAdapter -NewName \"Production\" -ErrorAction SilentlyContinue\n\n# -*- Download SQL Updates\n$TempDirectory = \"C:\\Temp\"\nNew-Item -ItemType Directory -Force -Path $TempDirectory\n(New-Object System.Net.WebClient).DownloadFile(\"http:\/\/10.46.1.165\/ISOs\/SQLServer2014-KB4052725-x64.exe\",\"$TempDirectory\\SQLServer2014-KB4052725-x64.exe\")\nSet-NetFirewallProfile -Profile Domain,Public,Private -Enabled False\n\nInstall-WindowsFeature -IncludeAllSubFeature -ErrorAction Stop \"Net-Framework-Core\"\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Pre Requisites"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"7d1bfcc7-d4f1-4d7d-9a64-71f6c493a623","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"static","type":"","command_line_args":"","exit_status":[],"script":"#script\nsleep(65)"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Sleep"}],"description":"","message_list":[],"uuid":"6646e873-42d2-40fa-88dc-d421a1b7acea","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"ddaf74d2_dag","uuid":"8306d922-058c-4cfe-9b3b-90d62e9310c8"},"name":"0561ade3_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","description":"","type":"DAG","uuid":"379374aa-a125-452b-8f3f-96ddfe9d061b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"7bf7eecb_dag"}],"description":"","message_list":[],"uuid":"5999dedb-3661-42af-a916-57dfa19f849d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"7bf7eecb_dag","uuid":"379374aa-a125-452b-8f3f-96ddfe9d061b"},"name":"f564b0c1_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Install_Crb_9fa1acf4_bb3c_4ac6_be87_1f52537922be"}],"description":"","message_list":[],"uuid":"377c5a20-74f5-4678-b830-91ac76185f82","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"b25be13e-eb60-4365-aba8-a3901bff9a07"},"name":"SYS_GEN__Runbook_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be"}},{"description":"System action for creating an application","message_list":[],"uuid":"072a8849-7f47-41c8-bb9e-4e5a33589b95","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","description":"","type":"DAG","uuid":"5076b949-192e-4fb1-990e-7d14a4f6de32","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"62ceaa8e-eef6-463f-ae18-289a3cc661f9"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"51970a1b-aa52-4f2d-84bf-eeb54afbbccb"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"235d5746-f892-45f9-bc15-3e8a0497029c"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"51970a1b-aa52-4f2d-84bf-eeb54afbbccb"},"edge_type":"inherent","type":"","uuid":"bdbe0cd2-2b57-4b1b-94a3-8aab7fc32885","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"235d5746-f892-45f9-bc15-3e8a0497029c"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"62ceaa8e-eef6-463f-ae18-289a3cc661f9"},"edge_type":"inherent","type":"","uuid":"9aa93575-3155-4d1c-aecc-b5509b5529ab","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"51970a1b-aa52-4f2d-84bf-eeb54afbbccb"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"62ceaa8e-eef6-463f-ae18-289a3cc661f9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"377c5a20-74f5-4678-b830-91ac76185f82"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"51970a1b-aa52-4f2d-84bf-eeb54afbbccb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"dade7481_runbook","uuid":"8eca21eb-942a-41ba-a6eb-af310476fb2b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"235d5746-f892-45f9-bc15-3e8a0497029c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"11876906_runbook","uuid":"df30efa0-47ec-4211-aeee-3f94f0510c54"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567"}],"description":"","message_list":[],"uuid":"c9d4acfd-8767-4e8e-af00-ada85c950fec","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"5076b949-192e-4fb1-990e-7d14a4f6de32"},"name":"SYS_GEN__Runbook_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be"}},{"description":"System action for uninstalling an application","message_list":[],"uuid":"4642aa06-c0ed-48b4-bd05-bbb9e94f2965","name":"action_uninstall","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","description":"","type":"DAG","uuid":"ff322fc8-d567-4e91-9d4f-dcccd07101b3","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Uninstall_Crb_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"45625457-54a3-4a47-a125-2edbd060dec4"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_UNINSTALL","uuid":"45625457-54a3-4a47-a125-2edbd060dec4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","description":"","type":"DAG","uuid":"8306d922-058c-4cfe-9b3b-90d62e9310c8","child_tasks_local_reference_list":[{"kind":"app_task","name":"Apply OS BPG","uuid":"16071347-c52b-4661-bf59-401a5fcf3fdd"},{"kind":"app_task","name":"Apply SQL BPG","uuid":"d2f0fa03-1a5f-4ef0-8c14-9b8b23de370c"},{"kind":"app_task","name":"Attach VG","uuid":"e88d7d4a-14ab-4d56-b1c8-8b312d3ab24e"},{"kind":"app_task","name":"Configure WSFC","uuid":"75430fc8-644c-4b88-a1bd-eb19424e9d4f"},{"kind":"app_task","name":"Connect Mount VG","uuid":"e6eda1d6-ddce-4885-89c4-d0eb240d2c29"},{"kind":"app_task","name":"Create AAG","uuid":"8847fcec-5aaf-4a08-bd24-c3056c425829"},{"kind":"app_task","name":"Create VG","uuid":"d6e3a93d-7d6c-44b8-a966-b96c22721a88"},{"kind":"app_task","name":"Enable AAG","uuid":"966ce7d9-1de9-4e2a-9e2a-139eef0c8d73"},{"kind":"app_task","name":"Get IQN","uuid":"776df270-5394-41ab-9284-c3caaf0a29f5"},{"kind":"app_task","name":"Install FC","uuid":"50209b45-54b0-4c13-9230-221bf892d2c9"},{"kind":"app_task","name":"Install SQL","uuid":"4a9daa04-2da2-4543-88dd-62bd661baf46"},{"kind":"app_task","name":"JoinDomain","uuid":"f54bbb0f-0f2d-422a-b098-98ca0e2776ee"},{"kind":"app_task","name":"Pre Requisites","uuid":"e47f135e-841a-4210-bd7d-3ff125796987"},{"kind":"app_task","name":"Sleep","uuid":"7d1bfcc7-d4f1-4d7d-9a64-71f6c493a623"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Apply OS BPG","uuid":"16071347-c52b-4661-bf59-401a5fcf3fdd"},"edge_type":"user_defined","type":"","uuid":"698cdfea-b158-4eec-ba38-a68dcc8e3ebb","to_task_reference":{"kind":"app_task","name":"Apply SQL BPG","uuid":"d2f0fa03-1a5f-4ef0-8c14-9b8b23de370c"}},{"from_task_reference":{"kind":"app_task","name":"Apply SQL BPG","uuid":"d2f0fa03-1a5f-4ef0-8c14-9b8b23de370c"},"edge_type":"user_defined","type":"","uuid":"a7765173-dbee-4b6c-968a-9ddd99eeb3ff","to_task_reference":{"kind":"app_task","name":"Enable AAG","uuid":"966ce7d9-1de9-4e2a-9e2a-139eef0c8d73"}},{"from_task_reference":{"kind":"app_task","name":"Attach VG","uuid":"e88d7d4a-14ab-4d56-b1c8-8b312d3ab24e"},"edge_type":"user_defined","type":"","uuid":"98a82d46-d12d-4918-bcf7-59f3b3ed1378","to_task_reference":{"kind":"app_task","name":"Connect Mount VG","uuid":"e6eda1d6-ddce-4885-89c4-d0eb240d2c29"}},{"from_task_reference":{"kind":"app_task","name":"Configure WSFC","uuid":"75430fc8-644c-4b88-a1bd-eb19424e9d4f"},"edge_type":"user_defined","type":"","uuid":"e4126daf-0bde-4896-8afb-36a8fa89d8ac","to_task_reference":{"kind":"app_task","name":"Install SQL","uuid":"4a9daa04-2da2-4543-88dd-62bd661baf46"}},{"from_task_reference":{"kind":"app_task","name":"Connect Mount VG","uuid":"e6eda1d6-ddce-4885-89c4-d0eb240d2c29"},"edge_type":"user_defined","type":"","uuid":"69a0a0ad-ea55-444a-ab1b-e39ef1eecdc5","to_task_reference":{"kind":"app_task","name":"Install FC","uuid":"50209b45-54b0-4c13-9230-221bf892d2c9"}},{"from_task_reference":{"kind":"app_task","name":"Create VG","uuid":"d6e3a93d-7d6c-44b8-a966-b96c22721a88"},"edge_type":"user_defined","type":"","uuid":"83dd7d3b-0f55-4000-ac65-df97dae23911","to_task_reference":{"kind":"app_task","name":"Get IQN","uuid":"776df270-5394-41ab-9284-c3caaf0a29f5"}},{"from_task_reference":{"kind":"app_task","name":"Enable AAG","uuid":"966ce7d9-1de9-4e2a-9e2a-139eef0c8d73"},"edge_type":"user_defined","type":"","uuid":"dae4ae4b-b47c-4971-81ba-c1c6e3497c5c","to_task_reference":{"kind":"app_task","name":"Create AAG","uuid":"8847fcec-5aaf-4a08-bd24-c3056c425829"}},{"from_task_reference":{"kind":"app_task","name":"Get IQN","uuid":"776df270-5394-41ab-9284-c3caaf0a29f5"},"edge_type":"user_defined","type":"","uuid":"18d08e01-8c81-4e53-8c97-c9eebda67aea","to_task_reference":{"kind":"app_task","name":"Attach VG","uuid":"e88d7d4a-14ab-4d56-b1c8-8b312d3ab24e"}},{"from_task_reference":{"kind":"app_task","name":"Install FC","uuid":"50209b45-54b0-4c13-9230-221bf892d2c9"},"edge_type":"user_defined","type":"","uuid":"33ad2d9f-5df5-4e1e-a932-d2ee29cc52e6","to_task_reference":{"kind":"app_task","name":"Configure WSFC","uuid":"75430fc8-644c-4b88-a1bd-eb19424e9d4f"}},{"from_task_reference":{"kind":"app_task","name":"Install SQL","uuid":"4a9daa04-2da2-4543-88dd-62bd661baf46"},"edge_type":"user_defined","type":"","uuid":"5a660b92-3bb1-4b00-9fed-f2ebc11e6a7c","to_task_reference":{"kind":"app_task","name":"Apply OS BPG","uuid":"16071347-c52b-4661-bf59-401a5fcf3fdd"}},{"from_task_reference":{"kind":"app_task","name":"JoinDomain","uuid":"f54bbb0f-0f2d-422a-b098-98ca0e2776ee"},"edge_type":"user_defined","type":"","uuid":"92982bc3-2976-4af5-ab5e-242aefee9c09","to_task_reference":{"kind":"app_task","name":"Sleep","uuid":"7d1bfcc7-d4f1-4d7d-9a64-71f6c493a623"}},{"from_task_reference":{"kind":"app_task","name":"Pre Requisites","uuid":"e47f135e-841a-4210-bd7d-3ff125796987"},"edge_type":"user_defined","type":"","uuid":"cffecd10-421e-4edc-ac4e-428052bc2e2f","to_task_reference":{"kind":"app_task","name":"JoinDomain","uuid":"f54bbb0f-0f2d-422a-b098-98ca0e2776ee"}},{"from_task_reference":{"kind":"app_task","name":"Sleep","uuid":"7d1bfcc7-d4f1-4d7d-9a64-71f6c493a623"},"edge_type":"user_defined","type":"","uuid":"3cc2026a-076c-472f-9510-0dc68c312177","to_task_reference":{"kind":"app_task","name":"Create VG","uuid":"d6e3a93d-7d6c-44b8-a966-b96c22721a88"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ddaf74d2_dag"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"16071347-c52b-4661-bf59-401a5fcf3fdd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"$start_time = Get-Date\n\n$TempDirectory = \"C:\\Temp\"\n$RktTemp = \"$TempDirectory\\rktools.2003\"\n\n$url = \"@@{BPG_RKTOOLS_URL}@@\"\n$filePath = \"$TempDirectory\\rktools.exe\"\n\nNew-Item -ItemType Directory -Force -Path $TempDirectory\n(New-Object System.Net.WebClient).DownloadFile($url,$filePath)\n\n& $filePath \/Q \/T:\"$RktTemp\" \/C\n\nStart-Sleep 10\n\n$PackageName = \"rktools.2003\"\n$setupPath = \"C:\\Windows\\System32\\msiexec.exe\"\n$silentArgs = \"\/i $RktTemp\\rktools.msi \/qn\"\n$validExitCodes = @(0)\n\nWrite-Output \"Installing $PackageName....\"\n\n$install = Start-Process -FilePath $setupPath -ArgumentList $silentArgs -Wait -NoNewWindow -PassThru\n$install.WaitForExit()\n\n$exitCode = $install.ExitCode\n$install.Dispose()\n\nWrite-Output \"Command [`\"$setupPath`\" $silentArgs] exited with `'$exitCode`'.\"\nif ($validExitCodes -notcontains $exitCode) {\n\tWrite-Output \"Running [`\"$setupPath`\" $silentArgs] was not successful. Exit code was '$exitCode'. See log for possible error messages.\"\n\texit 1\n}\n\n# OS related tunning\n# Set Windows Power Options to High Performance\npowercfg -s 8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c\n\n#Grant Memory privileges to user \n$ntrights_cli = \"C:\\Program Files (x86)\\Windows Resource Kits\\Tools\\ntrights.exe\"\n& $ntrights_cli -u \"NT SERVICE\\MSSQLSERVER\" +r SeLockMemoryPrivilege\n& $ntrights_cli -u \"NT SERVICE\\MSSQLSERVER\" +r SeManageVolumePrivilege\n\nWrite-Output \"Time taken: $((Get-Date).Subtract($start_time).seconds) Second(s)\"","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"241466f6-7a7e-4e0a-bc28-690d736f611d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Apply OS BPG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"d2f0fa03-1a5f-4ef0-8c14-9b8b23de370c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"$start_time = Get-Date\n\n$TempDirectory = \"C:\\Temp\"\n$sqladdparms_cli = \"$TempDirectory\\Add-SqlServerStartupParameter.ps1\"\n$TSQLSCRIPTSDIR = \"$TempDirectory\\TSQL_Scripts\"\nNew-Item -ItemType Directory -Force -Path $TSQLSCRIPTSDIR\n  \nSet-Content -Path \"$sqladdparms_cli\" -Value '\nparam(\n    ## The parameter you wish to add\n    [Parameter(Mandatory = $true)]\n    $StartupParameter\n)\n\n$hklmRootNode = \"HKLM:\\SOFTWARE\\Microsoft\\Microsoft SQL Server\"\n\n$props = Get-ItemProperty \"$hklmRootNode\\Instance Names\\SQL\"\n$instances = $props.psobject.properties | ?{$_.Value -like \"MSSQL*\"} | select Value\n\n$instances | %{\n    $inst = $_.Value;\n    $regKey = \"$hklmRootNode\\$inst\\MSSQLServer\\Parameters\"\n    $props = Get-ItemProperty $regKey\n    $params = $props.psobject.properties | ?{$_.Name -like \"SQLArg*\"} | select Name, Value\n    #$params | ft -AutoSize\n    $hasFlag = $false\n    foreach ($param in $params) {\n        if($param.Value -eq $StartupParameter) {\n            $hasFlag = $true\n            break;\n        }\n    }\n    if (-not $hasFlag) {\n        \"Adding $StartupParameter\"\n        $newRegProp = \"SQLArg\"+($params.Count)\n        Set-ItemProperty -Path $regKey -Name $newRegProp -Value $StartupParameter\n    } else {\n        \"$StartupParameter already set\"\n    }\n}'\nSet-Content -Path \"$TSQLSCRIPTSDIR\\01-ChangeTempDB.sql\" -Value \"use master`r`n\ngo`r`n\nAlter database tempdb modify file (name = tempdev, filename = 'I:\\TEMPDB01\\tempdb01.mdf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb modify file (name = templog, filename = 'T:\\TempDB-logs01\\templog01.ldf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb ADD file (name = tempdev02, filename = 'I:\\TEMPDB01\\tempdb02.ndf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb ADD file (name = tempdev03, filename = 'J:\\TEMPDB02\\tempdb03.ndf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb ADD file (name = tempdev04, filename = 'J:\\TEMPDB02\\tempdb04.ndf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\n`r`n\nALTER DATABASE [tempdb] MODIFY FILE (NAME=N'tempdev', NEWNAME=N'tempdev01')`r`n\nGO`r`n\nALTER DATABASE [tempdb] MODIFY FILE (NAME=N'templog', NEWNAME=N'templog01')`r`n\nGO\"\n\nSet-Content -Path \"$TSQLSCRIPTSDIR\\02-IncreaseTempDB_logs.sql\" -Value \"Use master`r`n\ngo`r`n\nALTER DATABASE tempdb MODIFY FILE (NAME = templog01, filename = 'T:\\TempDB-logs01\\templog01.ldf', SIZE`r`n\n= 8096);`r`n\nGO`r`n\nALTER DATABASE tempdb MODIFY FILE (NAME = templog01, FILENAME = 'T:\\TempDB-logs01\\templog01.ldf', SIZE`r`n\n= 12288);`r`n\nGO\"\n\nSet-Content -Path \"$TSQLSCRIPTSDIR\\03-SQL_set_memory.sql\" -Value \"USE master;`r`n\nexec sp_configure 'show advanced options', 1;`r`n\nRECONFIGURE;`r`n\nGO`r`n\nDECLARE `r`n\n        @total_mem decimal (10,0),`r`n\n\t\t@min int,`r`n\n\t\t@max int`r`n\nSELECT `r`n\n   --SELECT (physical_memory_kb\/1024) AS Server_Physical_Memory_MB`r`n\n  @total_mem = (physical_memory_kb\/1024)`r`n\nFROM sys.dm_os_sys_info`r`n\n`r`n\nset @min = @total_mem * 0.1`r`n\nset @max = @total_mem * 0.85`r`n\nprint @min`r`n\nprint @max`r`n\n--print @total_mem`r`n\n`r`n\n`r`n\nEXEC sp_configure 'min server memory (MB)',@min`r`n\nEXEC sp_configure 'max server memory (MB)',@max`r`n\nRECONFIGURE\"\n\nSet-Content -Path \"$TSQLSCRIPTSDIR\\04-SQL-ChangeDefaultPaths.sql\" -Value \"USE [master]`r`n\nGO`r`n\n-- Change default location for data files`r`n\nEXEC xp_instance_regwrite`r`n\nN'HKEY_LOCAL_MACHINE',`r`n\nN'Software\\Microsoft\\MSSQLServer\\MSSQLServer',`r`n\nN'DefaultData',`r`n\nREG_SZ,`r`n\nN'G:\\SQLDATA01'`r`n\nGO`r`n\n-- Change default location for log files`r`n\nEXEC xp_instance_regwrite`r`n\nN'HKEY_LOCAL_MACHINE',`r`n\nN'Software\\Microsoft\\MSSQLServer\\MSSQLServer',`r`n\nN'DefaultLog',`r`n\nREG_SZ,`r`n\nN'L:\\UserDB-logs01'`r`n\nGO`r`n\n-- Change default location for backups`r`n\nEXEC xp_instance_regwrite`r`n\nN'HKEY_LOCAL_MACHINE',`r`n\nN'Software\\Microsoft\\MSSQLServer\\MSSQLServer',`r`n\nN'BackupDirectory',`r`n\nREG_SZ,`r`n\nN'R:\\SQLBACK'`r`n\nGO\"\n\n#create directories\nmkdir G:\\SQLDATA01\\\nmkdir H:\\SQLDATA02\\\nmkdir I:\\TEMPDB01\\\nmkdir J:\\TEMPDB02\\\nmkdir L:\\UserDB-logs01\\\nmkdir T:\\TempDB-logs01\\\nmkdir R:\\SQLBACK\n\n#ADD SQL T parameters \n#T1117 This parameter forces MS SQL Server to grow all database files uniformly\n#T1118 This parameter forces MS SQL Server to use full extents only\n& $sqladdparms_cli '-T1117'\n& $sqladdparms_cli '-T1118'\nrestart-service MSSQL* -force\n\n#import powershell SQL module\nimport-module \"sqlps\" -DisableNameChecking\n\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\01-ChangeTempDB.sql\"\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\02-IncreaseTempDB_logs.sql\"\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\03-SQL_set_memory.sql\"\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\04-SQL-ChangeDefaultPaths.sql\"\n\n#Delete original SQL temp files\nstop-service MSSQL* \nStart-Sleep 5\nrm \"F:\\MSSQL\\MSSQL12.MSSQLSERVER\\MSSQL\\DATA\\temp*\"\n\nstart-service MSSQL* \nwmic useraccount get sid\nWrite-Output \"Time taken: $((Get-Date).Subtract($start_time).seconds) Second(s)\"","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"241466f6-7a7e-4e0a-bc28-690d736f611d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Apply SQL BPG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"e88d7d4a-14ab-4d56-b1c8-8b312d3ab24e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"static","type":"","command_line_args":"","exit_status":[],"script":"#script\nprism_ip = '@@{PE_IP}@@'\nusername = '@@{PE_CREDS.username}@@'\npassword = '@@{PE_CREDS.secret}@@'\nvgname = '@@{VG_NAME}@@'\nvg_uuid = ''\nIQN='@@{IQN}@@'\n\napi_url = \"https:\/\/\" + prism_ip + \":9440\/PrismGateway\/services\/rest\/v2.0\/\"\n\nprint \"INFO: Attaching VG {} to node.\".format(vgname)\n\n# -*- Check volume group existance\n\ntry:\n  check_vg_url = api_url + \"volume_groups\"\n  response = urlreq(check_vg_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\n  vgs = json.loads(response.content)\n  for vg in vgs['entities']:\n    if vg['name'] == vgname:\n      vg_uuid = vg['uuid']\nexcept Exception as e:\n\tprint \"ERROR: Failed to get volume group, check volume group or check username\/password\"\n\tprint e.message\n\texit(1)\n    \nif vg_uuid == '':\n  print \"ERROR: Volume group with name {} doesn't exists\".format(vgname)\n  exit(1)\n\n# -*- Attach Volume Group\n\nattach_vg_url = api_url + \"volume_groups\/\" + vg_uuid + \"\/open\"\npayload = {\n  \"iscsi_client\": {\n    \"client_address\": IQN\n  },\n  \"operation\": \"ATTACH\"\n}\n\nresponse = urlreq(attach_vg_url, verb='POST', auth=\"BASIC\", user=username, passwd=password, params=json.dumps(payload), verify=False)\nif response.status_code != 201:\n\tprint \"ERROR: Attaching vg '{}' failed.\".format(vgname)\n\nattach_status = json.loads(response.content)\nif attach_status['value']:\n  print \"INFO: Attaching vg '{}' Successful.\".format(vgname)\nelse:\n  print \"ERROR: Attaching vg '{}' failed.\".format(vgname)"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Attach VG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"75430fc8-644c-4b88-a1bd-eb19424e9d4f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"if (\"@@{calm_array_index}@@\" -ne \"0\"){\n\texit\n}\n\n$FailOverClusterName='@@{FAILOVER_CLUSTER_NAME}@@'\n$FailOverVIP='@@{FAILOVER_VIP}@@'\n$Nodes=\"@@{calm_array_address}@@\".split(',')\n\n# -*- Test Failover Cluster\n\nif(Test-Cluster -Node $Nodes){\n\tWrite-Output \"INFO: Test-Cluster Success.\"\n}\nelse\n{\n\tWrite-Output \"ERROR: Test-Cluster Failed.\"\n    exit 1\n}\n\nforeach ( $node in $(\"@@{calm_array_address}@@\".split(',')) ){Test-WSMan $node}\n\n# -*- Create Failover Cluster\n\nNew-Cluster -Name $FailOverClusterName -Node $Nodes -StaticAddress $FailOverVIP\n\n# -*- Rename Cluster Disks\n$ClusterDisks =  Get-CimInstance -ClassName MSCluster_Resource -Namespace root\/mscluster -Filter \"type = 'Physical Disk'\"\nforeach ($Disk in $ClusterDisks) {\n$DiskResource = Get-CimAssociatedInstance -InputObject $Disk -ResultClass MSCluster_DiskPartition\n\tif (-not ($DiskResource.VolumeLabel -eq $Disk.Name)) {\n\t\tInvoke-CimMethod -InputObject $Disk -MethodName Rename -Arguments @{newName = $DiskResource.VolumeLabel}\n  \t}\n}"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure WSFC"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"e6eda1d6-ddce-4885-89c4-d0eb240d2c29","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"New-IscsiTargetPortal -TargetPortalAddress @@{PE_DATA_SERVICE_IP}@@\nGet-IscsiTarget | Connect-IscsiTarget -IsPersistent $true\n\n#Initialize Disks\nif (((Get-Disk -Number 1 -ErrorAction SilentlyContinue).HealthStatus -eq \"Healthy\") -and ((Get-Disk -Number 2 -ErrorAction SilentlyContinue).HealthStatus -eq \"Healthy\")) {\n\tGet-Disk -Number 1 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 2 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 3 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 4 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 5 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 6 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 7 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 8 | Initialize-Disk -ErrorAction SilentlyContinue\n\tNew-Partition -DiskNumber 1 -UseMaximumSize -DriveLetter F -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -FileSystem NTFS -NewFileSystemLabel \"SQLINSTALL\" \n\tNew-Partition -DiskNumber 2 -UseMaximumSize -DriveLetter R -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"SQLBCK\"\n\tNew-Partition -DiskNumber 3 -UseMaximumSize -DriveLetter G -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"DATA01\" \n\tNew-Partition -DiskNumber 4 -UseMaximumSize -DriveLetter H -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"DATA02\"\n    New-Partition -DiskNumber 5 -UseMaximumSize -DriveLetter I -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"TEMPDB01\" \n\tNew-Partition -DiskNumber 6 -UseMaximumSize -DriveLetter J -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"TEMPDB02\"\n    New-Partition -DiskNumber 7 -UseMaximumSize -DriveLetter T -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"TEMPDBLOG01\" \n\tNew-Partition -DiskNumber 8 -UseMaximumSize -DriveLetter L -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"ULOG01\"\n\n} else {\n\tWrite-Output \"Disks does not exists or not healthy.`nIf you havent added disks please add 8 disk.\"\n\texit 1\n}\n\nif (\"@@{calm_array_index}@@\" -eq \"0\"){\n  if ((Get-Disk -Number 9 -ErrorAction SilentlyContinue).HealthStatus -eq \"Healthy\"){\n      Get-Disk -Number 9 | Initialize-Disk -ErrorAction SilentlyContinue\n      New-Partition -DiskNumber 9 -UseMaximumSize -DriveLetter W -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -FileSystem NTFS -NewFileSystemLabel \"Witness\" \n  } else {\n      Write-Output \"Witness Disk does not exists or not healthy.`nIf you havent added disks please add a volume group and attach.`n `t - Witness : 1GB\"\n      exit 1\n  }\n}\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Connect Mount VG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"8847fcec-5aaf-4a08-bd24-c3056c425829","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"if (\"$(Get-ClusterNode | where {$_.Id -eq 1} | select -ExpandProperty Name)\" -ne \"$(hostname)\"){\n\texit\n}\n$AGName = '@@{SQL_CLUSTER_NAME}@@'\n$PrimaryNode = $(hostname)\n$IP = '@@{MSSQL_VIP}@@\/255.255.255.0'\n$replicas = @()\n\n$cname = (Get-Cluster -name $PrimaryNode).name\n$nodes = (get-clusternode -Cluster $cname).name\n\n$sqlperms = @\"\nuse [master];\nGRANT ALTER ANY AVAILABILITY GROUP TO [NT AUTHORITY\\SYSTEM];\nGRANT CONNECT SQL TO [NT AUTHORITY\\SYSTEM];\nGRANT VIEW SERVER STATE TO [NT AUTHORITY\\SYSTEM];\n\"@\n\nforeach($node in $nodes)\n{\n\tInvoke-Sqlcmd -ServerInstance $node -Database master -Query $sqlperms\n\t$replicas += New-SqlAvailabilityReplica -Name $node -EndpointUrl \"TCP:\/\/$($node):5022\" -AvailabilityMode \"SynchronousCommit\" -FailoverMode \"Automatic\" -AsTemplate -Version 12 \n}\n\n\nNew-SqlAvailabilityGroup -Name $AGName -Path \"SQLSERVER:\\SQL\\$PrimaryNode\\DEFAULT\" -AvailabilityReplica $replicas\n$nodes | Where-Object {$_ -ne $PrimaryNode} | ForEach-Object {Join-SqlAvailabilityGroup -path \"SQLSERVER:\\SQL\\$_\\DEFAULT\" -Name $AGName}\nNew-SqlAvailabilityGroupListener -Name $AGName -staticIP $IP -Port 1433 -Path \"SQLSERVER:\\Sql\\$PrimaryNode\\DEFAULT\\AvailabilityGroups\\$AGName\"\n","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"241466f6-7a7e-4e0a-bc28-690d736f611d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Create AAG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"d6e3a93d-7d6c-44b8-a966-b96c22721a88","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"static","type":"","command_line_args":"","exit_status":[],"script":"#script\n\nif \"@@{calm_array_index}@@\" != \"0\":\n  exit(0)\nprism_ip = '@@{PE_IP}@@'\nusername = '@@{PE_CREDS.username}@@'\npassword = '@@{PE_CREDS.secret}@@'\nstorage_container_name = '@@{CONTAINER_NAME}@@'\nstorage_container_uuid = ''\nvgname = '@@{VG_NAME}@@'\n\napi_url = \"https:\/\/\" + prism_ip + \":9440\/PrismGateway\/services\/rest\/v2.0\/\"\n\nprint \"INFO: Retrieving storage container uuid for: {}.\".format(storage_container_name)\n\n# -*- Get Container UUID\n\nget_container_uuid_url = api_url + \"storage_containers\"\ntry:\n  response = urlreq(get_container_uuid_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\n  storage_containers = json.loads(response.content)\n  for container in storage_containers['entities']:\n    if container['name'] == storage_container_name:\n      storage_container_uuid = container['storage_container_uuid']\nexcept Exception as e:\n\tprint \"ERROR: Failed to get storage container uuid, check storage container name or check username\/password\"\n\tprint e.message\n\texit(1)\n\nprint \"INFO: storage container uuid is: {}.\".format(storage_container_uuid)\n\n# -*- Check volume group existance\n\ncheck_vg_url = api_url + \"volume_groups\"\nresponse = urlreq(check_vg_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\nvgs = json.loads(response.content)\nfor vg in vgs['entities']:\n  if vg['name'] == vgname:\n    print \"ERROR: Volume group with name {} already exists.\".format(vgname)\n    exit(1)\n\nprint \"INFO: Creating volume group '{}'.\".format(vgname)\n\n# -*- Create Volume Group\n\ncreate_vg_url = api_url + \"volume_groups\"\npayload = {\n\t\"disk_list\": [{\n\t\t\"create_config\": {\n\t\t\t\"size\": 1073741824,\n\t\t\t\"storage_container_uuid\": storage_container_uuid\n\t\t},\n\t\t\"index\": 0\n\t}],\n\t\"is_shared\": True,\n\t\"name\": vgname\n}\n\nresponse = urlreq(create_vg_url, verb='POST', auth=\"BASIC\", user=username, passwd=password, params=json.dumps(payload), verify=False)\nif response.status_code != 201:\n\tprint \"ERROR: creation of volume group '{}' failed.\".format(vgname)\n\nvg_create_status = json.loads(response.content)\ntask_uuid = vg_create_status['task_uuid']\n\nsleep(5)\n\ncheck_vg_creation_url = api_url + \"tasks\/\" + task_uuid\nresponse = response = urlreq(check_vg_creation_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\nvg_create_status = json.loads(response.content)\n\nif vg_create_status['progress_status'] != \"Succeeded\":\n\tprint \"ERROR: creation of volume group '{}' failed.\".format(vgname)\n\texit(1)\nelse:\n\tprint \"INFO: creation of volume group '{}' Successful.\".format(vgname)"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Create VG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"966ce7d9-1de9-4e2a-9e2a-139eef0c8d73","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"# -*- Variable for T-SQL command\n$netbios = \"@@{DOMAIN}@@\".Split(\".\")[0].ToUpper()\n$createLogin = \"CREATE LOGIN [$netbios\\sqlservice] FROM WINDOWS; \" \n$grantConnectPermissions = \"GRANT CONNECT ON ENDPOINT::Endpoint_AG TO [$netbios\\sqlservice];\"\n\nEnable-SqlAlwaysOn -ServerInstance $(hostname) -Force \nNew-SqlHADREndpoint -Path \"SQLSERVER:\\SQL\\$(hostname)\\DEFAULT\" -Name \"Endpoint_AG\" -Port 5022 -EncryptionAlgorithm Aes -Encryption Required \nSet-SqlHADREndpoint -Path \"SQLSERVER:\\SQL\\$(hostname)\\DEFAULT\\Endpoints\\Endpoint_AG\" -State Started\nInvoke-SqlCmd -Server $(hostname) -Query $createLogin\nInvoke-SqlCmd -Server $(hostname) -Query $grantConnectPermissions","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"241466f6-7a7e-4e0a-bc28-690d736f611d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Enable AAG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"776df270-5394-41ab-9284-c3caaf0a29f5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"Write-Output \"IQN=$((Get-InitiatorPort).NodeAddress)\"","eval_variables":["IQN"],"eval_scope":"local","type":"","script_type":"npsscript"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Get IQN"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"50209b45-54b0-4c13-9230-221bf892d2c9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"Install-WindowsFeature -Name Failover-Clustering -IncludeManagementTools\n\nif (-not (get-WindowsFeature -Name Failover-Clustering -ErrorAction SilentlyContinue | select -ExpandProperty Installed)){\n\tWrite-output \"Failover Clustering is not installed\"\n\texit 1\n}"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Install FC"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"4a9daa04-2da2-4543-88dd-62bd661baf46","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"#Install-WindowsFeature -IncludeAllSubFeature -ErrorAction Stop \"Net-Framework-Core\"\n$DOMAINNAME=(Get-WmiObject Win32_ComputerSystem).Domain\n$setupDriveLetter = \"D:\"\n$setupPath = \"$setupDriveLetter\\setup.exe\"\n$silentArgs = \"\/IACCEPTSQLSERVERLICENSETERMS \/Q \/ACTION=install \/FEATURES=SQLENGINE,FULLTEXT,SSMS,ADV_SSMS \/AGTSVCACCOUNT=`\"@@{SQL_CREDS.username}@@`\" \/AGTSVCPASSWORD=@@{SQL_CREDS.secret}@@ \/SQLSVCACCOUNT=`\"@@{SQL_CREDS.username}@@`\" \/SQLSVCPASSWORD=@@{SQL_CREDS.secret}@@ \/SQLSYSADMINACCOUNTS=`\"$DOMAINNAME\\Domain Admins`\" \/ISSVCACCOUNT=`\"@@{SQL_CREDS.username}@@`\" \/ISSVCPASSWORD=@@{SQL_CREDS.secret}@@ \/ASSYSADMINACCOUNTS=`\"@@{SQL_CREDS.username}@@`\" \/INSTANCEID=MSSQLSERVER \/INSTANCENAME=MSSQLSERVER \/UPDATEENABLED=True \/UPDATESOURCE=`\"C:\\Temp`\" \/INDICATEPROGRESS \/TCPENABLED=1 \/INSTALLSQLDATADIR=`\"F:\\MSSQL`\" \/SQLUSERDBLOGDIR=`\"L:\\MSSQL`\" \/SQLTEMPDBLOGDIR=`\"T:\\MSSQL`\"\"\n$validExitCodes = @(0)\n\n$install = Start-Process -FilePath $setupPath -ArgumentList $silentArgs -Wait -NoNewWindow -PassThru\n$install.WaitForExit()\n$exitCode = $install.ExitCode\n$install.Dispose()\n\nWrite-Output \"SQL Failover Cluster Installation exited with `'$exitCode`'.\"\nif ($validExitCodes -notcontains $exitCode) {\n\tWrite-Output \"Running [`\"$setupPath`\" $silentArgs] was not successful. Exit code was '$exitCode'. See log for possible error messages.\"\n\texit 1\n}"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Install SQL"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"f54bbb0f-0f2d-422a-b098-98ca0e2776ee","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"##############################################\n# Name        : JoinDomain\n# Author      : K Sarat Kumar\n# Version     : 1.0\n# Description : Script is used to join to domain.\n##############################################\n\nfunction JointoDomain {\n  [CmdletBinding()]\n  Param(\n      [parameter(Mandatory=$true)]\n      [string]$DomainName,\n      [parameter(Mandatory=$false)]\n      [string]$OU,\n      [parameter(Mandatory=$true)]\n      [string]$Username,\n      [parameter(Mandatory=$true)]\n      [string]$Password,\n      [parameter(Mandatory=$true)]\n      [string]$Server\n  )\n  $adapter = Get-NetAdapter | ? {$_.Status -eq \"up\"}\n  $adapter | Set-DnsClientServerAddress -ServerAddresses $Server\n\n  if ($env:computername  -eq $env:userdomain) {\n    Write-Host \"Not in domain\"\n    #$adminname = \"$DomainName\\$Username\"\n    $adminname = \"$Username\"\n    $adminpassword = ConvertTo-SecureString -asPlainText -Force -String \"$Password\"\n    Write-Host \"$adminname , $password\"\n    $credential = New-Object System.Management.Automation.PSCredential($adminname,$adminpassword)\n    Add-computer -DomainName $DomainName -Credential $credential -force -Options JoinWithNewName,AccountCreate -PassThru -ErrorAction Stop\n  } else {\n     Write-Host \"Already in domain\"\n  }\n}\n\nJointoDomain -DomainName \"@@{DOMAIN}@@\" -Username \"@@{DOMAIN_CRED.username}@@\" -Password \"@@{DOMAIN_CRED.secret}@@\" -Server \"@@{AD_IP}@@\"\n\nRestart-Computer -Force -AsJob\nexit 0\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"JoinDomain"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","description":"","type":"EXEC","uuid":"e47f135e-841a-4210-bd7d-3ff125796987","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"##############################################\n# Name        : Pre-requisites\n# Author      : K Sarat Kumar\n# Version     : 1.0\n# Description : Script is used to join to domain.\n##############################################\n\n# -*- Pre-requisite to enable credssp and set 'Server' role\nEnable-WSManCredSSP -Role Server -Force\n\n# -*- Enabling and starting 'msiscsi'\nSet-Service -Name msiscsi -StartupType Automatic\nStart-Service msiscsi\n\n# -*- Change first Ehternet adapter name to 'Production'\nGet-NetAdapter -Name \"Ethernet\" | Rename-NetAdapter -NewName \"Production\" -ErrorAction SilentlyContinue\n\n# -*- Download SQL Updates\n$TempDirectory = \"C:\\Temp\"\nNew-Item -ItemType Directory -Force -Path $TempDirectory\n(New-Object System.Net.WebClient).DownloadFile(\"http:\/\/10.46.1.165\/ISOs\/SQLServer2014-KB4052725-x64.exe\",\"$TempDirectory\\SQLServer2014-KB4052725-x64.exe\")\nSet-NetFirewallProfile -Profile Domain,Public,Private -Enabled False\n\nInstall-WindowsFeature -IncludeAllSubFeature -ErrorAction Stop \"Net-Framework-Core\"\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Pre Requisites"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"7d1bfcc7-d4f1-4d7d-9a64-71f6c493a623","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"static","type":"","command_line_args":"","exit_status":[],"script":"#script\nsleep(65)"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Sleep"}],"description":"","message_list":[],"uuid":"6646e873-42d2-40fa-88dc-d421a1b7acea","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"ddaf74d2_dag","uuid":"8306d922-058c-4cfe-9b3b-90d62e9310c8"},"name":"0561ade3_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","description":"","type":"DAG","uuid":"379374aa-a125-452b-8f3f-96ddfe9d061b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"7bf7eecb_dag"}],"description":"","message_list":[],"uuid":"5999dedb-3661-42af-a916-57dfa19f849d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"7bf7eecb_dag","uuid":"379374aa-a125-452b-8f3f-96ddfe9d061b"},"name":"f564b0c1_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Uninstall_Crb_9fa1acf4_bb3c_4ac6_be87_1f52537922be"}],"description":"","message_list":[],"uuid":"01f2ccd5-4d04-494a-a049-53c84731026a","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"ff322fc8-d567-4e91-9d4f-dcccd07101b3"},"name":"SYS_GEN__Runbook_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"14a82027-18eb-4d68-b5d7-cb5586be2a19","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","description":"","type":"DAG","uuid":"ad8f7dcb-7adb-4417-8249-62c41b636a95","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"8452bbdc-8cd4-4274-b96e-714ea1559e44"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"3327c745-add9-4e72-9b2f-94d84afbd003"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"1a4e015c-4f30-4091-8343-fe3827d19022"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"8452bbdc-8cd4-4274-b96e-714ea1559e44"},"edge_type":"inherent","type":"","uuid":"af47c9c9-55b1-46ca-9d3f-79d26bbf1e9a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"3327c745-add9-4e72-9b2f-94d84afbd003"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"3327c745-add9-4e72-9b2f-94d84afbd003"},"edge_type":"inherent","type":"","uuid":"b1b77aab-42cc-40ac-8d56-f3b31d595f30","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"1a4e015c-4f30-4091-8343-fe3827d19022"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8452bbdc-8cd4-4274-b96e-714ea1559e44","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d2728354_runbook","uuid":"8856982b-972a-4cad-8780-cbc8851d6937"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3327c745-add9-4e72-9b2f-94d84afbd003","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"59afb4f4_runbook","uuid":"4d689b82-3e6e-43a7-a61f-78cf6d8be04c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1a4e015c-4f30-4091-8343-fe3827d19022","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"01f2ccd5-4d04-494a-a049-53c84731026a"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be"}],"description":"","message_list":[],"uuid":"83f72f51-7bd2-468e-be3a-59ea10106793","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"ad8f7dcb-7adb-4417-8249-62c41b636a95"},"name":"SYS_GEN__Runbook_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"51f8ea8d-7877-4505-b19f-973a093bf973","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","description":"","type":"DAG","uuid":"9699f1ec-e3a3-4cfc-9e48-324fef1aa1d2","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"624c4140-3839-41cf-82f1-e0a6ff2bade2"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"0a447c85-e3c6-4f28-a00a-c05e0b23bf2f"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"624c4140-3839-41cf-82f1-e0a6ff2bade2"},"edge_type":"inherent","type":"","uuid":"68a56aec-8bb2-4407-a674-4766a9bd251e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"0a447c85-e3c6-4f28-a00a-c05e0b23bf2f"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"624c4140-3839-41cf-82f1-e0a6ff2bade2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"c7bebd3d-fcb3-4c57-8354-db62df983f29"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"0a447c85-e3c6-4f28-a00a-c05e0b23bf2f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_9fa1acf4_bb3c_4ac6_be87_1f52537922be"}],"description":"","message_list":[],"uuid":"bf071f65-e7a2-4b29-89b5-47aba3230b28","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"9699f1ec-e3a3-4cfc-9e48-324fef1aa1d2"},"name":"SYS_GEN__Runbook_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be"}},{"description":"System action for starting an application","message_list":[],"uuid":"998e799c-7b38-4188-897d-725e838b3f16","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","description":"","type":"DAG","uuid":"1a7e55d5-6b49-4d03-b73d-b050cad473fc","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"2a2b1a77-9ed1-47b3-92da-f1536e6a722f"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2a2b1a77-9ed1-47b3-92da-f1536e6a722f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"11876906_runbook","uuid":"df30efa0-47ec-4211-aeee-3f94f0510c54"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567"}],"description":"","message_list":[],"uuid":"7f9f2e6a-d71e-4704-b714-6b68ab3dd096","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"1a7e55d5-6b49-4d03-b73d-b050cad473fc"},"name":"SYS_GEN__Runbook_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be"}},{"description":"System action for restarting an application","message_list":[],"uuid":"ae7bee03-942d-41c3-a1b1-009d55ee7f09","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","description":"","type":"DAG","uuid":"af85afa3-154e-4519-8b73-8210741a85b8","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"b8ddb9e8-2a02-4707-9385-c2d3d9a686ef"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b8ddb9e8-2a02-4707-9385-c2d3d9a686ef","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"4150545e_runbook","uuid":"718a8106-ced6-4188-b0e4-7a29e3d4d0ca"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567"}],"description":"","message_list":[],"uuid":"2842be41-ba05-4212-a667-a2b7c37385f6","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"af85afa3-154e-4519-8b73-8210741a85b8"},"name":"SYS_GEN__Runbook_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be"}},{"description":"System action for stopping an application","message_list":[],"uuid":"fe9dc2c2-0fcc-4932-95de-1d4a326458f6","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","description":"","type":"DAG","uuid":"9d848048-949f-4278-aea1-cb9ebc9db4bc","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567","uuid":"58bcb1f8-82eb-44f3-ac0f-f2f2165707ce"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"58bcb1f8-82eb-44f3-ac0f-f2f2165707ce","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d2728354_runbook","uuid":"8856982b-972a-4cad-8780-cbc8851d6937"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_9308dfa4_9a23_40bd_bc4c_ca6a65c25567"}],"description":"","message_list":[],"uuid":"3a7f4ecd-90ee-4ea8-a471-678d00707f6b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be","uuid":"9d848048-949f-4278-aea1-cb9ebc9db4bc"},"name":"SYS_GEN__Runbook_Package_9fa1acf4_bb3c_4ac6_be87_1f52537922be"}}],"message_list":[],"service_local_reference_list":[{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"}],"uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be","state":"ACTIVE","version":"","editables":{},"type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","description":"","type":"DAG","uuid":"8306d922-058c-4cfe-9b3b-90d62e9310c8","child_tasks_local_reference_list":[{"kind":"app_task","name":"Apply OS BPG","uuid":"16071347-c52b-4661-bf59-401a5fcf3fdd"},{"kind":"app_task","name":"Apply SQL BPG","uuid":"d2f0fa03-1a5f-4ef0-8c14-9b8b23de370c"},{"kind":"app_task","name":"Attach VG","uuid":"e88d7d4a-14ab-4d56-b1c8-8b312d3ab24e"},{"kind":"app_task","name":"Configure WSFC","uuid":"75430fc8-644c-4b88-a1bd-eb19424e9d4f"},{"kind":"app_task","name":"Connect Mount VG","uuid":"e6eda1d6-ddce-4885-89c4-d0eb240d2c29"},{"kind":"app_task","name":"Create AAG","uuid":"8847fcec-5aaf-4a08-bd24-c3056c425829"},{"kind":"app_task","name":"Create VG","uuid":"d6e3a93d-7d6c-44b8-a966-b96c22721a88"},{"kind":"app_task","name":"Enable AAG","uuid":"966ce7d9-1de9-4e2a-9e2a-139eef0c8d73"},{"kind":"app_task","name":"Get IQN","uuid":"776df270-5394-41ab-9284-c3caaf0a29f5"},{"kind":"app_task","name":"Install FC","uuid":"50209b45-54b0-4c13-9230-221bf892d2c9"},{"kind":"app_task","name":"Install SQL","uuid":"4a9daa04-2da2-4543-88dd-62bd661baf46"},{"kind":"app_task","name":"JoinDomain","uuid":"f54bbb0f-0f2d-422a-b098-98ca0e2776ee"},{"kind":"app_task","name":"Pre Requisites","uuid":"e47f135e-841a-4210-bd7d-3ff125796987"},{"kind":"app_task","name":"Sleep","uuid":"7d1bfcc7-d4f1-4d7d-9a64-71f6c493a623"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Apply OS BPG","uuid":"16071347-c52b-4661-bf59-401a5fcf3fdd"},"edge_type":"user_defined","type":"","uuid":"698cdfea-b158-4eec-ba38-a68dcc8e3ebb","to_task_reference":{"kind":"app_task","name":"Apply SQL BPG","uuid":"d2f0fa03-1a5f-4ef0-8c14-9b8b23de370c"}},{"from_task_reference":{"kind":"app_task","name":"Apply SQL BPG","uuid":"d2f0fa03-1a5f-4ef0-8c14-9b8b23de370c"},"edge_type":"user_defined","type":"","uuid":"a7765173-dbee-4b6c-968a-9ddd99eeb3ff","to_task_reference":{"kind":"app_task","name":"Enable AAG","uuid":"966ce7d9-1de9-4e2a-9e2a-139eef0c8d73"}},{"from_task_reference":{"kind":"app_task","name":"Attach VG","uuid":"e88d7d4a-14ab-4d56-b1c8-8b312d3ab24e"},"edge_type":"user_defined","type":"","uuid":"98a82d46-d12d-4918-bcf7-59f3b3ed1378","to_task_reference":{"kind":"app_task","name":"Connect Mount VG","uuid":"e6eda1d6-ddce-4885-89c4-d0eb240d2c29"}},{"from_task_reference":{"kind":"app_task","name":"Configure WSFC","uuid":"75430fc8-644c-4b88-a1bd-eb19424e9d4f"},"edge_type":"user_defined","type":"","uuid":"e4126daf-0bde-4896-8afb-36a8fa89d8ac","to_task_reference":{"kind":"app_task","name":"Install SQL","uuid":"4a9daa04-2da2-4543-88dd-62bd661baf46"}},{"from_task_reference":{"kind":"app_task","name":"Connect Mount VG","uuid":"e6eda1d6-ddce-4885-89c4-d0eb240d2c29"},"edge_type":"user_defined","type":"","uuid":"69a0a0ad-ea55-444a-ab1b-e39ef1eecdc5","to_task_reference":{"kind":"app_task","name":"Install FC","uuid":"50209b45-54b0-4c13-9230-221bf892d2c9"}},{"from_task_reference":{"kind":"app_task","name":"Create VG","uuid":"d6e3a93d-7d6c-44b8-a966-b96c22721a88"},"edge_type":"user_defined","type":"","uuid":"83dd7d3b-0f55-4000-ac65-df97dae23911","to_task_reference":{"kind":"app_task","name":"Get IQN","uuid":"776df270-5394-41ab-9284-c3caaf0a29f5"}},{"from_task_reference":{"kind":"app_task","name":"Enable AAG","uuid":"966ce7d9-1de9-4e2a-9e2a-139eef0c8d73"},"edge_type":"user_defined","type":"","uuid":"dae4ae4b-b47c-4971-81ba-c1c6e3497c5c","to_task_reference":{"kind":"app_task","name":"Create AAG","uuid":"8847fcec-5aaf-4a08-bd24-c3056c425829"}},{"from_task_reference":{"kind":"app_task","name":"Get IQN","uuid":"776df270-5394-41ab-9284-c3caaf0a29f5"},"edge_type":"user_defined","type":"","uuid":"18d08e01-8c81-4e53-8c97-c9eebda67aea","to_task_reference":{"kind":"app_task","name":"Attach VG","uuid":"e88d7d4a-14ab-4d56-b1c8-8b312d3ab24e"}},{"from_task_reference":{"kind":"app_task","name":"Install FC","uuid":"50209b45-54b0-4c13-9230-221bf892d2c9"},"edge_type":"user_defined","type":"","uuid":"33ad2d9f-5df5-4e1e-a932-d2ee29cc52e6","to_task_reference":{"kind":"app_task","name":"Configure WSFC","uuid":"75430fc8-644c-4b88-a1bd-eb19424e9d4f"}},{"from_task_reference":{"kind":"app_task","name":"Install SQL","uuid":"4a9daa04-2da2-4543-88dd-62bd661baf46"},"edge_type":"user_defined","type":"","uuid":"5a660b92-3bb1-4b00-9fed-f2ebc11e6a7c","to_task_reference":{"kind":"app_task","name":"Apply OS BPG","uuid":"16071347-c52b-4661-bf59-401a5fcf3fdd"}},{"from_task_reference":{"kind":"app_task","name":"JoinDomain","uuid":"f54bbb0f-0f2d-422a-b098-98ca0e2776ee"},"edge_type":"user_defined","type":"","uuid":"92982bc3-2976-4af5-ab5e-242aefee9c09","to_task_reference":{"kind":"app_task","name":"Sleep","uuid":"7d1bfcc7-d4f1-4d7d-9a64-71f6c493a623"}},{"from_task_reference":{"kind":"app_task","name":"Pre Requisites","uuid":"e47f135e-841a-4210-bd7d-3ff125796987"},"edge_type":"user_defined","type":"","uuid":"cffecd10-421e-4edc-ac4e-428052bc2e2f","to_task_reference":{"kind":"app_task","name":"JoinDomain","uuid":"f54bbb0f-0f2d-422a-b098-98ca0e2776ee"}},{"from_task_reference":{"kind":"app_task","name":"Sleep","uuid":"7d1bfcc7-d4f1-4d7d-9a64-71f6c493a623"},"edge_type":"user_defined","type":"","uuid":"3cc2026a-076c-472f-9510-0dc68c312177","to_task_reference":{"kind":"app_task","name":"Create VG","uuid":"d6e3a93d-7d6c-44b8-a966-b96c22721a88"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ddaf74d2_dag"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"16071347-c52b-4661-bf59-401a5fcf3fdd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"$start_time = Get-Date\n\n$TempDirectory = \"C:\\Temp\"\n$RktTemp = \"$TempDirectory\\rktools.2003\"\n\n$url = \"@@{BPG_RKTOOLS_URL}@@\"\n$filePath = \"$TempDirectory\\rktools.exe\"\n\nNew-Item -ItemType Directory -Force -Path $TempDirectory\n(New-Object System.Net.WebClient).DownloadFile($url,$filePath)\n\n& $filePath \/Q \/T:\"$RktTemp\" \/C\n\nStart-Sleep 10\n\n$PackageName = \"rktools.2003\"\n$setupPath = \"C:\\Windows\\System32\\msiexec.exe\"\n$silentArgs = \"\/i $RktTemp\\rktools.msi \/qn\"\n$validExitCodes = @(0)\n\nWrite-Output \"Installing $PackageName....\"\n\n$install = Start-Process -FilePath $setupPath -ArgumentList $silentArgs -Wait -NoNewWindow -PassThru\n$install.WaitForExit()\n\n$exitCode = $install.ExitCode\n$install.Dispose()\n\nWrite-Output \"Command [`\"$setupPath`\" $silentArgs] exited with `'$exitCode`'.\"\nif ($validExitCodes -notcontains $exitCode) {\n\tWrite-Output \"Running [`\"$setupPath`\" $silentArgs] was not successful. Exit code was '$exitCode'. See log for possible error messages.\"\n\texit 1\n}\n\n# OS related tunning\n# Set Windows Power Options to High Performance\npowercfg -s 8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c\n\n#Grant Memory privileges to user \n$ntrights_cli = \"C:\\Program Files (x86)\\Windows Resource Kits\\Tools\\ntrights.exe\"\n& $ntrights_cli -u \"NT SERVICE\\MSSQLSERVER\" +r SeLockMemoryPrivilege\n& $ntrights_cli -u \"NT SERVICE\\MSSQLSERVER\" +r SeManageVolumePrivilege\n\nWrite-Output \"Time taken: $((Get-Date).Subtract($start_time).seconds) Second(s)\"","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"241466f6-7a7e-4e0a-bc28-690d736f611d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Apply OS BPG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"d2f0fa03-1a5f-4ef0-8c14-9b8b23de370c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"$start_time = Get-Date\n\n$TempDirectory = \"C:\\Temp\"\n$sqladdparms_cli = \"$TempDirectory\\Add-SqlServerStartupParameter.ps1\"\n$TSQLSCRIPTSDIR = \"$TempDirectory\\TSQL_Scripts\"\nNew-Item -ItemType Directory -Force -Path $TSQLSCRIPTSDIR\n  \nSet-Content -Path \"$sqladdparms_cli\" -Value '\nparam(\n    ## The parameter you wish to add\n    [Parameter(Mandatory = $true)]\n    $StartupParameter\n)\n\n$hklmRootNode = \"HKLM:\\SOFTWARE\\Microsoft\\Microsoft SQL Server\"\n\n$props = Get-ItemProperty \"$hklmRootNode\\Instance Names\\SQL\"\n$instances = $props.psobject.properties | ?{$_.Value -like \"MSSQL*\"} | select Value\n\n$instances | %{\n    $inst = $_.Value;\n    $regKey = \"$hklmRootNode\\$inst\\MSSQLServer\\Parameters\"\n    $props = Get-ItemProperty $regKey\n    $params = $props.psobject.properties | ?{$_.Name -like \"SQLArg*\"} | select Name, Value\n    #$params | ft -AutoSize\n    $hasFlag = $false\n    foreach ($param in $params) {\n        if($param.Value -eq $StartupParameter) {\n            $hasFlag = $true\n            break;\n        }\n    }\n    if (-not $hasFlag) {\n        \"Adding $StartupParameter\"\n        $newRegProp = \"SQLArg\"+($params.Count)\n        Set-ItemProperty -Path $regKey -Name $newRegProp -Value $StartupParameter\n    } else {\n        \"$StartupParameter already set\"\n    }\n}'\nSet-Content -Path \"$TSQLSCRIPTSDIR\\01-ChangeTempDB.sql\" -Value \"use master`r`n\ngo`r`n\nAlter database tempdb modify file (name = tempdev, filename = 'I:\\TEMPDB01\\tempdb01.mdf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb modify file (name = templog, filename = 'T:\\TempDB-logs01\\templog01.ldf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb ADD file (name = tempdev02, filename = 'I:\\TEMPDB01\\tempdb02.ndf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb ADD file (name = tempdev03, filename = 'J:\\TEMPDB02\\tempdb03.ndf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb ADD file (name = tempdev04, filename = 'J:\\TEMPDB02\\tempdb04.ndf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\n`r`n\nALTER DATABASE [tempdb] MODIFY FILE (NAME=N'tempdev', NEWNAME=N'tempdev01')`r`n\nGO`r`n\nALTER DATABASE [tempdb] MODIFY FILE (NAME=N'templog', NEWNAME=N'templog01')`r`n\nGO\"\n\nSet-Content -Path \"$TSQLSCRIPTSDIR\\02-IncreaseTempDB_logs.sql\" -Value \"Use master`r`n\ngo`r`n\nALTER DATABASE tempdb MODIFY FILE (NAME = templog01, filename = 'T:\\TempDB-logs01\\templog01.ldf', SIZE`r`n\n= 8096);`r`n\nGO`r`n\nALTER DATABASE tempdb MODIFY FILE (NAME = templog01, FILENAME = 'T:\\TempDB-logs01\\templog01.ldf', SIZE`r`n\n= 12288);`r`n\nGO\"\n\nSet-Content -Path \"$TSQLSCRIPTSDIR\\03-SQL_set_memory.sql\" -Value \"USE master;`r`n\nexec sp_configure 'show advanced options', 1;`r`n\nRECONFIGURE;`r`n\nGO`r`n\nDECLARE `r`n\n        @total_mem decimal (10,0),`r`n\n\t\t@min int,`r`n\n\t\t@max int`r`n\nSELECT `r`n\n   --SELECT (physical_memory_kb\/1024) AS Server_Physical_Memory_MB`r`n\n  @total_mem = (physical_memory_kb\/1024)`r`n\nFROM sys.dm_os_sys_info`r`n\n`r`n\nset @min = @total_mem * 0.1`r`n\nset @max = @total_mem * 0.85`r`n\nprint @min`r`n\nprint @max`r`n\n--print @total_mem`r`n\n`r`n\n`r`n\nEXEC sp_configure 'min server memory (MB)',@min`r`n\nEXEC sp_configure 'max server memory (MB)',@max`r`n\nRECONFIGURE\"\n\nSet-Content -Path \"$TSQLSCRIPTSDIR\\04-SQL-ChangeDefaultPaths.sql\" -Value \"USE [master]`r`n\nGO`r`n\n-- Change default location for data files`r`n\nEXEC xp_instance_regwrite`r`n\nN'HKEY_LOCAL_MACHINE',`r`n\nN'Software\\Microsoft\\MSSQLServer\\MSSQLServer',`r`n\nN'DefaultData',`r`n\nREG_SZ,`r`n\nN'G:\\SQLDATA01'`r`n\nGO`r`n\n-- Change default location for log files`r`n\nEXEC xp_instance_regwrite`r`n\nN'HKEY_LOCAL_MACHINE',`r`n\nN'Software\\Microsoft\\MSSQLServer\\MSSQLServer',`r`n\nN'DefaultLog',`r`n\nREG_SZ,`r`n\nN'L:\\UserDB-logs01'`r`n\nGO`r`n\n-- Change default location for backups`r`n\nEXEC xp_instance_regwrite`r`n\nN'HKEY_LOCAL_MACHINE',`r`n\nN'Software\\Microsoft\\MSSQLServer\\MSSQLServer',`r`n\nN'BackupDirectory',`r`n\nREG_SZ,`r`n\nN'R:\\SQLBACK'`r`n\nGO\"\n\n#create directories\nmkdir G:\\SQLDATA01\\\nmkdir H:\\SQLDATA02\\\nmkdir I:\\TEMPDB01\\\nmkdir J:\\TEMPDB02\\\nmkdir L:\\UserDB-logs01\\\nmkdir T:\\TempDB-logs01\\\nmkdir R:\\SQLBACK\n\n#ADD SQL T parameters \n#T1117 This parameter forces MS SQL Server to grow all database files uniformly\n#T1118 This parameter forces MS SQL Server to use full extents only\n& $sqladdparms_cli '-T1117'\n& $sqladdparms_cli '-T1118'\nrestart-service MSSQL* -force\n\n#import powershell SQL module\nimport-module \"sqlps\" -DisableNameChecking\n\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\01-ChangeTempDB.sql\"\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\02-IncreaseTempDB_logs.sql\"\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\03-SQL_set_memory.sql\"\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\04-SQL-ChangeDefaultPaths.sql\"\n\n#Delete original SQL temp files\nstop-service MSSQL* \nStart-Sleep 5\nrm \"F:\\MSSQL\\MSSQL12.MSSQLSERVER\\MSSQL\\DATA\\temp*\"\n\nstart-service MSSQL* \nwmic useraccount get sid\nWrite-Output \"Time taken: $((Get-Date).Subtract($start_time).seconds) Second(s)\"","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"241466f6-7a7e-4e0a-bc28-690d736f611d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Apply SQL BPG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"e88d7d4a-14ab-4d56-b1c8-8b312d3ab24e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"static","type":"","command_line_args":"","exit_status":[],"script":"#script\nprism_ip = '@@{PE_IP}@@'\nusername = '@@{PE_CREDS.username}@@'\npassword = '@@{PE_CREDS.secret}@@'\nvgname = '@@{VG_NAME}@@'\nvg_uuid = ''\nIQN='@@{IQN}@@'\n\napi_url = \"https:\/\/\" + prism_ip + \":9440\/PrismGateway\/services\/rest\/v2.0\/\"\n\nprint \"INFO: Attaching VG {} to node.\".format(vgname)\n\n# -*- Check volume group existance\n\ntry:\n  check_vg_url = api_url + \"volume_groups\"\n  response = urlreq(check_vg_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\n  vgs = json.loads(response.content)\n  for vg in vgs['entities']:\n    if vg['name'] == vgname:\n      vg_uuid = vg['uuid']\nexcept Exception as e:\n\tprint \"ERROR: Failed to get volume group, check volume group or check username\/password\"\n\tprint e.message\n\texit(1)\n    \nif vg_uuid == '':\n  print \"ERROR: Volume group with name {} doesn't exists\".format(vgname)\n  exit(1)\n\n# -*- Attach Volume Group\n\nattach_vg_url = api_url + \"volume_groups\/\" + vg_uuid + \"\/open\"\npayload = {\n  \"iscsi_client\": {\n    \"client_address\": IQN\n  },\n  \"operation\": \"ATTACH\"\n}\n\nresponse = urlreq(attach_vg_url, verb='POST', auth=\"BASIC\", user=username, passwd=password, params=json.dumps(payload), verify=False)\nif response.status_code != 201:\n\tprint \"ERROR: Attaching vg '{}' failed.\".format(vgname)\n\nattach_status = json.loads(response.content)\nif attach_status['value']:\n  print \"INFO: Attaching vg '{}' Successful.\".format(vgname)\nelse:\n  print \"ERROR: Attaching vg '{}' failed.\".format(vgname)"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Attach VG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"75430fc8-644c-4b88-a1bd-eb19424e9d4f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"if (\"@@{calm_array_index}@@\" -ne \"0\"){\n\texit\n}\n\n$FailOverClusterName='@@{FAILOVER_CLUSTER_NAME}@@'\n$FailOverVIP='@@{FAILOVER_VIP}@@'\n$Nodes=\"@@{calm_array_address}@@\".split(',')\n\n# -*- Test Failover Cluster\n\nif(Test-Cluster -Node $Nodes){\n\tWrite-Output \"INFO: Test-Cluster Success.\"\n}\nelse\n{\n\tWrite-Output \"ERROR: Test-Cluster Failed.\"\n    exit 1\n}\n\nforeach ( $node in $(\"@@{calm_array_address}@@\".split(',')) ){Test-WSMan $node}\n\n# -*- Create Failover Cluster\n\nNew-Cluster -Name $FailOverClusterName -Node $Nodes -StaticAddress $FailOverVIP\n\n# -*- Rename Cluster Disks\n$ClusterDisks =  Get-CimInstance -ClassName MSCluster_Resource -Namespace root\/mscluster -Filter \"type = 'Physical Disk'\"\nforeach ($Disk in $ClusterDisks) {\n$DiskResource = Get-CimAssociatedInstance -InputObject $Disk -ResultClass MSCluster_DiskPartition\n\tif (-not ($DiskResource.VolumeLabel -eq $Disk.Name)) {\n\t\tInvoke-CimMethod -InputObject $Disk -MethodName Rename -Arguments @{newName = $DiskResource.VolumeLabel}\n  \t}\n}"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure WSFC"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"e6eda1d6-ddce-4885-89c4-d0eb240d2c29","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"New-IscsiTargetPortal -TargetPortalAddress @@{PE_DATA_SERVICE_IP}@@\nGet-IscsiTarget | Connect-IscsiTarget -IsPersistent $true\n\n#Initialize Disks\nif (((Get-Disk -Number 1 -ErrorAction SilentlyContinue).HealthStatus -eq \"Healthy\") -and ((Get-Disk -Number 2 -ErrorAction SilentlyContinue).HealthStatus -eq \"Healthy\")) {\n\tGet-Disk -Number 1 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 2 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 3 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 4 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 5 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 6 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 7 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 8 | Initialize-Disk -ErrorAction SilentlyContinue\n\tNew-Partition -DiskNumber 1 -UseMaximumSize -DriveLetter F -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -FileSystem NTFS -NewFileSystemLabel \"SQLINSTALL\" \n\tNew-Partition -DiskNumber 2 -UseMaximumSize -DriveLetter R -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"SQLBCK\"\n\tNew-Partition -DiskNumber 3 -UseMaximumSize -DriveLetter G -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"DATA01\" \n\tNew-Partition -DiskNumber 4 -UseMaximumSize -DriveLetter H -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"DATA02\"\n    New-Partition -DiskNumber 5 -UseMaximumSize -DriveLetter I -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"TEMPDB01\" \n\tNew-Partition -DiskNumber 6 -UseMaximumSize -DriveLetter J -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"TEMPDB02\"\n    New-Partition -DiskNumber 7 -UseMaximumSize -DriveLetter T -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"TEMPDBLOG01\" \n\tNew-Partition -DiskNumber 8 -UseMaximumSize -DriveLetter L -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"ULOG01\"\n\n} else {\n\tWrite-Output \"Disks does not exists or not healthy.`nIf you havent added disks please add 8 disk.\"\n\texit 1\n}\n\nif (\"@@{calm_array_index}@@\" -eq \"0\"){\n  if ((Get-Disk -Number 9 -ErrorAction SilentlyContinue).HealthStatus -eq \"Healthy\"){\n      Get-Disk -Number 9 | Initialize-Disk -ErrorAction SilentlyContinue\n      New-Partition -DiskNumber 9 -UseMaximumSize -DriveLetter W -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -FileSystem NTFS -NewFileSystemLabel \"Witness\" \n  } else {\n      Write-Output \"Witness Disk does not exists or not healthy.`nIf you havent added disks please add a volume group and attach.`n `t - Witness : 1GB\"\n      exit 1\n  }\n}\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Connect Mount VG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"8847fcec-5aaf-4a08-bd24-c3056c425829","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"if (\"$(Get-ClusterNode | where {$_.Id -eq 1} | select -ExpandProperty Name)\" -ne \"$(hostname)\"){\n\texit\n}\n$AGName = '@@{SQL_CLUSTER_NAME}@@'\n$PrimaryNode = $(hostname)\n$IP = '@@{MSSQL_VIP}@@\/255.255.255.0'\n$replicas = @()\n\n$cname = (Get-Cluster -name $PrimaryNode).name\n$nodes = (get-clusternode -Cluster $cname).name\n\n$sqlperms = @\"\nuse [master];\nGRANT ALTER ANY AVAILABILITY GROUP TO [NT AUTHORITY\\SYSTEM];\nGRANT CONNECT SQL TO [NT AUTHORITY\\SYSTEM];\nGRANT VIEW SERVER STATE TO [NT AUTHORITY\\SYSTEM];\n\"@\n\nforeach($node in $nodes)\n{\n\tInvoke-Sqlcmd -ServerInstance $node -Database master -Query $sqlperms\n\t$replicas += New-SqlAvailabilityReplica -Name $node -EndpointUrl \"TCP:\/\/$($node):5022\" -AvailabilityMode \"SynchronousCommit\" -FailoverMode \"Automatic\" -AsTemplate -Version 12 \n}\n\n\nNew-SqlAvailabilityGroup -Name $AGName -Path \"SQLSERVER:\\SQL\\$PrimaryNode\\DEFAULT\" -AvailabilityReplica $replicas\n$nodes | Where-Object {$_ -ne $PrimaryNode} | ForEach-Object {Join-SqlAvailabilityGroup -path \"SQLSERVER:\\SQL\\$_\\DEFAULT\" -Name $AGName}\nNew-SqlAvailabilityGroupListener -Name $AGName -staticIP $IP -Port 1433 -Path \"SQLSERVER:\\Sql\\$PrimaryNode\\DEFAULT\\AvailabilityGroups\\$AGName\"\n","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"241466f6-7a7e-4e0a-bc28-690d736f611d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Create AAG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"d6e3a93d-7d6c-44b8-a966-b96c22721a88","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"static","type":"","command_line_args":"","exit_status":[],"script":"#script\n\nif \"@@{calm_array_index}@@\" != \"0\":\n  exit(0)\nprism_ip = '@@{PE_IP}@@'\nusername = '@@{PE_CREDS.username}@@'\npassword = '@@{PE_CREDS.secret}@@'\nstorage_container_name = '@@{CONTAINER_NAME}@@'\nstorage_container_uuid = ''\nvgname = '@@{VG_NAME}@@'\n\napi_url = \"https:\/\/\" + prism_ip + \":9440\/PrismGateway\/services\/rest\/v2.0\/\"\n\nprint \"INFO: Retrieving storage container uuid for: {}.\".format(storage_container_name)\n\n# -*- Get Container UUID\n\nget_container_uuid_url = api_url + \"storage_containers\"\ntry:\n  response = urlreq(get_container_uuid_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\n  storage_containers = json.loads(response.content)\n  for container in storage_containers['entities']:\n    if container['name'] == storage_container_name:\n      storage_container_uuid = container['storage_container_uuid']\nexcept Exception as e:\n\tprint \"ERROR: Failed to get storage container uuid, check storage container name or check username\/password\"\n\tprint e.message\n\texit(1)\n\nprint \"INFO: storage container uuid is: {}.\".format(storage_container_uuid)\n\n# -*- Check volume group existance\n\ncheck_vg_url = api_url + \"volume_groups\"\nresponse = urlreq(check_vg_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\nvgs = json.loads(response.content)\nfor vg in vgs['entities']:\n  if vg['name'] == vgname:\n    print \"ERROR: Volume group with name {} already exists.\".format(vgname)\n    exit(1)\n\nprint \"INFO: Creating volume group '{}'.\".format(vgname)\n\n# -*- Create Volume Group\n\ncreate_vg_url = api_url + \"volume_groups\"\npayload = {\n\t\"disk_list\": [{\n\t\t\"create_config\": {\n\t\t\t\"size\": 1073741824,\n\t\t\t\"storage_container_uuid\": storage_container_uuid\n\t\t},\n\t\t\"index\": 0\n\t}],\n\t\"is_shared\": True,\n\t\"name\": vgname\n}\n\nresponse = urlreq(create_vg_url, verb='POST', auth=\"BASIC\", user=username, passwd=password, params=json.dumps(payload), verify=False)\nif response.status_code != 201:\n\tprint \"ERROR: creation of volume group '{}' failed.\".format(vgname)\n\nvg_create_status = json.loads(response.content)\ntask_uuid = vg_create_status['task_uuid']\n\nsleep(5)\n\ncheck_vg_creation_url = api_url + \"tasks\/\" + task_uuid\nresponse = response = urlreq(check_vg_creation_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\nvg_create_status = json.loads(response.content)\n\nif vg_create_status['progress_status'] != \"Succeeded\":\n\tprint \"ERROR: creation of volume group '{}' failed.\".format(vgname)\n\texit(1)\nelse:\n\tprint \"INFO: creation of volume group '{}' Successful.\".format(vgname)"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Create VG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"966ce7d9-1de9-4e2a-9e2a-139eef0c8d73","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"# -*- Variable for T-SQL command\n$netbios = \"@@{DOMAIN}@@\".Split(\".\")[0].ToUpper()\n$createLogin = \"CREATE LOGIN [$netbios\\sqlservice] FROM WINDOWS; \" \n$grantConnectPermissions = \"GRANT CONNECT ON ENDPOINT::Endpoint_AG TO [$netbios\\sqlservice];\"\n\nEnable-SqlAlwaysOn -ServerInstance $(hostname) -Force \nNew-SqlHADREndpoint -Path \"SQLSERVER:\\SQL\\$(hostname)\\DEFAULT\" -Name \"Endpoint_AG\" -Port 5022 -EncryptionAlgorithm Aes -Encryption Required \nSet-SqlHADREndpoint -Path \"SQLSERVER:\\SQL\\$(hostname)\\DEFAULT\\Endpoints\\Endpoint_AG\" -State Started\nInvoke-SqlCmd -Server $(hostname) -Query $createLogin\nInvoke-SqlCmd -Server $(hostname) -Query $grantConnectPermissions","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"241466f6-7a7e-4e0a-bc28-690d736f611d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Enable AAG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"776df270-5394-41ab-9284-c3caaf0a29f5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"Write-Output \"IQN=$((Get-InitiatorPort).NodeAddress)\"","eval_variables":["IQN"],"eval_scope":"local","type":"","script_type":"npsscript"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Get IQN"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"50209b45-54b0-4c13-9230-221bf892d2c9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"Install-WindowsFeature -Name Failover-Clustering -IncludeManagementTools\n\nif (-not (get-WindowsFeature -Name Failover-Clustering -ErrorAction SilentlyContinue | select -ExpandProperty Installed)){\n\tWrite-output \"Failover Clustering is not installed\"\n\texit 1\n}"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Install FC"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"4a9daa04-2da2-4543-88dd-62bd661baf46","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"#Install-WindowsFeature -IncludeAllSubFeature -ErrorAction Stop \"Net-Framework-Core\"\n$DOMAINNAME=(Get-WmiObject Win32_ComputerSystem).Domain\n$setupDriveLetter = \"D:\"\n$setupPath = \"$setupDriveLetter\\setup.exe\"\n$silentArgs = \"\/IACCEPTSQLSERVERLICENSETERMS \/Q \/ACTION=install \/FEATURES=SQLENGINE,FULLTEXT,SSMS,ADV_SSMS \/AGTSVCACCOUNT=`\"@@{SQL_CREDS.username}@@`\" \/AGTSVCPASSWORD=@@{SQL_CREDS.secret}@@ \/SQLSVCACCOUNT=`\"@@{SQL_CREDS.username}@@`\" \/SQLSVCPASSWORD=@@{SQL_CREDS.secret}@@ \/SQLSYSADMINACCOUNTS=`\"$DOMAINNAME\\Domain Admins`\" \/ISSVCACCOUNT=`\"@@{SQL_CREDS.username}@@`\" \/ISSVCPASSWORD=@@{SQL_CREDS.secret}@@ \/ASSYSADMINACCOUNTS=`\"@@{SQL_CREDS.username}@@`\" \/INSTANCEID=MSSQLSERVER \/INSTANCENAME=MSSQLSERVER \/UPDATEENABLED=True \/UPDATESOURCE=`\"C:\\Temp`\" \/INDICATEPROGRESS \/TCPENABLED=1 \/INSTALLSQLDATADIR=`\"F:\\MSSQL`\" \/SQLUSERDBLOGDIR=`\"L:\\MSSQL`\" \/SQLTEMPDBLOGDIR=`\"T:\\MSSQL`\"\"\n$validExitCodes = @(0)\n\n$install = Start-Process -FilePath $setupPath -ArgumentList $silentArgs -Wait -NoNewWindow -PassThru\n$install.WaitForExit()\n$exitCode = $install.ExitCode\n$install.Dispose()\n\nWrite-Output \"SQL Failover Cluster Installation exited with `'$exitCode`'.\"\nif ($validExitCodes -notcontains $exitCode) {\n\tWrite-Output \"Running [`\"$setupPath`\" $silentArgs] was not successful. Exit code was '$exitCode'. See log for possible error messages.\"\n\texit 1\n}"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Install SQL"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"f54bbb0f-0f2d-422a-b098-98ca0e2776ee","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"##############################################\n# Name        : JoinDomain\n# Author      : K Sarat Kumar\n# Version     : 1.0\n# Description : Script is used to join to domain.\n##############################################\n\nfunction JointoDomain {\n  [CmdletBinding()]\n  Param(\n      [parameter(Mandatory=$true)]\n      [string]$DomainName,\n      [parameter(Mandatory=$false)]\n      [string]$OU,\n      [parameter(Mandatory=$true)]\n      [string]$Username,\n      [parameter(Mandatory=$true)]\n      [string]$Password,\n      [parameter(Mandatory=$true)]\n      [string]$Server\n  )\n  $adapter = Get-NetAdapter | ? {$_.Status -eq \"up\"}\n  $adapter | Set-DnsClientServerAddress -ServerAddresses $Server\n\n  if ($env:computername  -eq $env:userdomain) {\n    Write-Host \"Not in domain\"\n    #$adminname = \"$DomainName\\$Username\"\n    $adminname = \"$Username\"\n    $adminpassword = ConvertTo-SecureString -asPlainText -Force -String \"$Password\"\n    Write-Host \"$adminname , $password\"\n    $credential = New-Object System.Management.Automation.PSCredential($adminname,$adminpassword)\n    Add-computer -DomainName $DomainName -Credential $credential -force -Options JoinWithNewName,AccountCreate -PassThru -ErrorAction Stop\n  } else {\n     Write-Host \"Already in domain\"\n  }\n}\n\nJointoDomain -DomainName \"@@{DOMAIN}@@\" -Username \"@@{DOMAIN_CRED.username}@@\" -Password \"@@{DOMAIN_CRED.secret}@@\" -Server \"@@{AD_IP}@@\"\n\nRestart-Computer -Force -AsJob\nexit 0\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"JoinDomain"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","description":"","type":"EXEC","uuid":"e47f135e-841a-4210-bd7d-3ff125796987","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"##############################################\n# Name        : Pre-requisites\n# Author      : K Sarat Kumar\n# Version     : 1.0\n# Description : Script is used to join to domain.\n##############################################\n\n# -*- Pre-requisite to enable credssp and set 'Server' role\nEnable-WSManCredSSP -Role Server -Force\n\n# -*- Enabling and starting 'msiscsi'\nSet-Service -Name msiscsi -StartupType Automatic\nStart-Service msiscsi\n\n# -*- Change first Ehternet adapter name to 'Production'\nGet-NetAdapter -Name \"Ethernet\" | Rename-NetAdapter -NewName \"Production\" -ErrorAction SilentlyContinue\n\n# -*- Download SQL Updates\n$TempDirectory = \"C:\\Temp\"\nNew-Item -ItemType Directory -Force -Path $TempDirectory\n(New-Object System.Net.WebClient).DownloadFile(\"http:\/\/10.46.1.165\/ISOs\/SQLServer2014-KB4052725-x64.exe\",\"$TempDirectory\\SQLServer2014-KB4052725-x64.exe\")\nSet-NetFirewallProfile -Profile Domain,Public,Private -Enabled False\n\nInstall-WindowsFeature -IncludeAllSubFeature -ErrorAction Stop \"Net-Framework-Core\"\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Pre Requisites"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","description":"","type":"EXEC","uuid":"7d1bfcc7-d4f1-4d7d-9a64-71f6c493a623","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"static","type":"","command_line_args":"","exit_status":[],"script":"#script\nsleep(65)"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Sleep"}],"description":"","message_list":[],"uuid":"6646e873-42d2-40fa-88dc-d421a1b7acea","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"ddaf74d2_dag","uuid":"8306d922-058c-4cfe-9b3b-90d62e9310c8"},"name":"0561ade3_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","description":"","type":"DAG","uuid":"379374aa-a125-452b-8f3f-96ddfe9d061b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"7bf7eecb_dag"}],"description":"","message_list":[],"uuid":"5999dedb-3661-42af-a916-57dfa19f849d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"7bf7eecb_dag","uuid":"379374aa-a125-452b-8f3f-96ddfe9d061b"},"name":"f564b0c1_runbook"}},"variable_list":[],"name":"AHV MSSQL Package"}]},"name":"MSSQL AAG"},"spec":{"name":"MSSQL AAG","resources":{"service_definition_list":[{"singleton":false,"name":"MSSQL","action_list":[{"description":"System action for creating an application","name":"action_create","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567","name":"MSSQL"},"retries":"0","description":"","uuid":"5da03ede-40f3-4e32-94ee-bc827586df61","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"98f8161b_dag"}],"description":"","uuid":"8eca21eb-942a-41ba-a6eb-af310476fb2b","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"98f8161b_dag","uuid":"5da03ede-40f3-4e32-94ee-bc827586df61"},"name":"dade7481_runbook"},"type":"system","uuid":"df29a57d-0c35-4ec6-bbb0-5c887c341550"},{"description":"System action for deleting an application. Deletes created VMs as well","name":"action_delete","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567","name":"MSSQL"},"retries":"0","description":"","uuid":"a4d4e83c-18b1-4406-9bf0-6b7f7d5bc36f","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"02628fa5_dag"}],"description":"","uuid":"4d689b82-3e6e-43a7-a61f-78cf6d8be04c","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"02628fa5_dag","uuid":"a4d4e83c-18b1-4406-9bf0-6b7f7d5bc36f"},"name":"59afb4f4_runbook"},"type":"system","uuid":"eb41ad3c-60f6-42bc-b1ab-6b67126a842b"},{"description":"System action for restarting an application","name":"action_restart","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567","name":"MSSQL"},"retries":"0","description":"","uuid":"e541e3c2-245e-4268-8b90-98510db16512","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"27dfdc04_dag"}],"description":"","uuid":"718a8106-ced6-4188-b0e4-7a29e3d4d0ca","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"27dfdc04_dag","uuid":"e541e3c2-245e-4268-8b90-98510db16512"},"name":"4150545e_runbook"},"type":"system","uuid":"deb93bee-9539-4644-8cc9-9a3b1cf1b6ca"},{"description":"System action for starting an application","name":"action_start","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567","name":"MSSQL"},"retries":"0","description":"","uuid":"6be54844-9247-4685-beb3-8d4ae8f50844","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"8e5f51b4_dag"}],"description":"","uuid":"df30efa0-47ec-4211-aeee-3f94f0510c54","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"8e5f51b4_dag","uuid":"6be54844-9247-4685-beb3-8d4ae8f50844"},"name":"11876906_runbook"},"type":"system","uuid":"9bf8f35f-ddb1-462f-939e-6ef93feee4d7"},{"description":"System action for stopping an application","name":"action_stop","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567","name":"MSSQL"},"retries":"0","description":"","uuid":"efc9f674-650e-4d3a-9c97-52c9a7f07cb5","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"1a17e568_dag"}],"description":"","uuid":"8856982b-972a-4cad-8780-cbc8851d6937","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"1a17e568_dag","uuid":"efc9f674-650e-4d3a-9c97-52c9a7f07cb5"},"name":"d2728354_runbook"},"type":"system","uuid":"3f77d9ec-cd63-4302-92a4-b3de18f5d670"}],"description":"","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567","port_list":[],"tier":"","variable_list":[{"val_type":"STRING","uuid":"5d4fdbda-fee6-4ac5-85a4-60d987310ea3","name":"IQN","value":"","label":"","attrs":{"type":""},"type":"LOCAL","description":""}],"depends_on_list":[]}],"substrate_definition_list":[{"name":"AHV_MSSQL","action_list":[],"uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596","readiness_probe":{"connection_type":"POWERSHELL","retries":"5","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","connection_port":5985,"login_credential_local_reference":{"kind":"app_credential","name":"LOCAL","uuid":"04ca4ba7-eaed-4178-8880-c103539f07ec"}},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":null},"create_spec":{"name":true,"resources":{"nic_list":{"1":{"subnet_reference":true},"0":{"subnet_reference":true}},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"guest_customization":true,"disk_list":true}}},"os_type":"Windows","type":"AHV_VM","create_spec":{"name":"MSSQL-@@{calm_unique}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"099dbe61-2c00-4964-9567-f547ec224e10"},"type":""},{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"099dbe61-2c00-4964-9567-f547ec224e10"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":6,"gpu_list":[],"memory_size_mib":6144,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":null,"type":"","sysprep":{"install_type":"PREPARED","unattend_xml":"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<unattend xmlns=\"urn:schemas-microsoft-com:unattend\">\n   <settings pass=\"specialize\">\n      <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Microsoft-Windows-Shell-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n         <ComputerName>@@{name}@@<\/ComputerName>\n         <RegisteredOrganization>Nutanix<\/RegisteredOrganization>\n         <RegisteredOwner>Acropolis<\/RegisteredOwner>\n         <TimeZone>UTC<\/TimeZone>\n      <\/component>\n      <component xmlns=\"\" name=\"Microsoft-Windows-TerminalServices-LocalSessionManager\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" processorArchitecture=\"amd64\">\n         <fDenyTSConnections>false<\/fDenyTSConnections>\n      <\/component>\n      <component xmlns=\"\" name=\"Microsoft-Windows-TerminalServices-RDP-WinStationExtensions\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" processorArchitecture=\"amd64\">\n         <UserAuthentication>0<\/UserAuthentication>\n      <\/component>\n      <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Networking-MPSSVC-Svc\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n         <FirewallGroups>\n            <FirewallGroup wcm:action=\"add\" wcm:keyValue=\"RemoteDesktop\">\n               <Active>true<\/Active>\n               <Profile>all<\/Profile>\n               <Group>@FirewallAPI.dll,-28752<\/Group>\n            <\/FirewallGroup>\n         <\/FirewallGroups>\n      <\/component>\n   <\/settings>\n   <settings pass=\"oobeSystem\">\n      <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Microsoft-Windows-Shell-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n         <UserAccounts>\n            <AdministratorPassword>\n               <Value>@@{LOCAL.secret}@@<\/Value>\n               <PlainText>true<\/PlainText>\n            <\/AdministratorPassword>\n         <\/UserAccounts>\n         <AutoLogon>\n            <Password>\n               <Value>@@{LOCAL.secret}@@<\/Value>\n               <PlainText>true<\/PlainText>\n            <\/Password>\n            <Enabled>true<\/Enabled>\n            <Username>Administrator<\/Username>\n         <\/AutoLogon>\n         <FirstLogonCommands>\n            <SynchronousCommand wcm:action=\"add\">\n               <CommandLine>cmd.exe \/c netsh firewall add portopening TCP 5985 \"Port 5985\"<\/CommandLine>\n               <Description>Win RM port open<\/Description>\n               <Order>1<\/Order>\n               <RequiresUserInput>true<\/RequiresUserInput>\n            <\/SynchronousCommand>\n         <\/FirstLogonCommands>\n         <OOBE>\n            <HideEULAPage>true<\/HideEULAPage>\n            <SkipMachineOOBE>true<\/SkipMachineOOBE>\n         <\/OOBE>\n      <\/component>\n      <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Microsoft-Windows-International-Core\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n         <InputLocale>en-US<\/InputLocale>\n         <SystemLocale>en-US<\/SystemLocale>\n         <UILanguageFallback>en-us<\/UILanguageFallback>\n         <UILanguage>en-US<\/UILanguage>\n         <UserLocale>en-US<\/UserLocale>\n      <\/component>\n   <\/settings>\n<\/unattend>","type":""}},"power_state":"ON","type":"","account_uuid":"efc034e3-b50e-4a48-b02d-25036aeb8bd3","boot_config":{"boot_device":{"type":"","disk_address":{"device_index":0,"adapter_type":"SCSI"}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","name":"WindowsServer2016-Base","uuid":"98783d50-8925-46b1-bfe5-96f1ed17e66b"},"device_properties":{"device_type":"DISK","disk_address":{"device_index":0,"adapter_type":"SCSI"}}},{"data_source_reference":{"kind":"image","name":"SQLServer2014SP2-FullSlipstream-x64-ENU","uuid":"5ad856b9-a81a-41dc-999c-a9da91ab8d73"},"device_properties":{"device_type":"CDROM","disk_address":{"device_index":0,"adapter_type":"IDE"}}},{"device_properties":{"device_type":"DISK","disk_address":{"device_index":1,"adapter_type":"SCSI"}},"disk_size_mib":51200},{"device_properties":{"device_type":"DISK","disk_address":{"device_index":2,"adapter_type":"SCSI"}},"disk_size_mib":153600},{"device_properties":{"device_type":"DISK","disk_address":{"device_index":3,"adapter_type":"SCSI"}},"disk_size_mib":307200},{"device_properties":{"device_type":"DISK","disk_address":{"device_index":4,"adapter_type":"SCSI"}},"disk_size_mib":307200},{"device_properties":{"device_type":"DISK","disk_address":{"device_index":5,"adapter_type":"SCSI"}},"disk_size_mib":102400},{"device_properties":{"device_type":"DISK","disk_address":{"device_index":6,"adapter_type":"SCSI"}},"disk_size_mib":102400},{"device_properties":{"device_type":"DISK","disk_address":{"device_index":7,"adapter_type":"SCSI"}},"disk_size_mib":204800},{"device_properties":{"device_type":"DISK","disk_address":{"device_index":8,"adapter_type":"SCSI"}},"disk_size_mib":204800}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[],"description":""}],"credential_definition_list":[{"username":"administrator@mssql.com","uuid":"241466f6-7a7e-4e0a-bc28-690d736f611d","name":"DOMAIN_CRED","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{"uuid":"fc781629-5cea-4600-9725-5436d673c64f"}}},"type":"PASSWORD","description":""},{"username":"administrator","uuid":"04ca4ba7-eaed-4178-8880-c103539f07ec","name":"LOCAL","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{"uuid":"1da8c23b-99f9-435b-9484-da93e147f941"}}},"type":"PASSWORD","description":""},{"username":"admin","uuid":"9bdb79f7-8537-47ba-8b8e-4ebce73adc46","name":"PE_CREDS","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{"uuid":"ae957e16-97e3-4ef0-b3a4-3f618d4c1c44"}}},"type":"PASSWORD","description":""},{"username":"mssql\\sqlservice","uuid":"79ebe5ab-c3c8-45a6-b6cb-18eb8bf7d5af","name":"SQL_CREDS","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{"uuid":"88610a48-9b2d-422e-b4bb-d36ea5ab5e8e"}}},"type":"PASSWORD","description":""}],"type":"USER","app_profile_list":[{"deployment_create_list":[{"name":"5aed8000_deployment","action_list":[],"package_local_reference_list":[{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"}],"description":"","depends_on_list":[],"min_replicas":"2","max_replicas":"2","published_service_local_reference_list":[],"editables":{"min_replicas":true,"max_replicas":true},"substrate_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"46d333d1-e8a7-4b27-aa64-30ac70829596"},"type":"GREENFIELD","variable_list":[],"uuid":"2814f949-fa68-4ac9-8488-dd477093f961"}],"description":"","action_list":[],"name":"Nutanix","variable_list":[{"val_type":"STRING","uuid":"5d8d3fd9-7768-4596-b549-046841f1c87e","name":"AD_IP","value":"10.46.6.4","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","description":""},{"val_type":"STRING","uuid":"b781c4a3-25f7-457c-8e9f-61239a318e5b","name":"BPG_RKTOOLS_URL","value":"http:\/\/download.microsoft.com\/download\/8\/e\/c\/8ec3a7d8-05b4-440a-a71e-ca3ee25fe057\/rktools.exe","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","description":""},{"val_type":"STRING","uuid":"163053c0-a985-4b72-82ac-81d4926ab3c9","name":"CONTAINER_NAME","value":"default-container-69049036518763","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","description":""},{"val_type":"STRING","uuid":"364cb6f2-6b0a-4289-ac38-58aeb4ef0925","name":"DOMAIN","value":"mssql.com","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","description":""},{"val_type":"STRING","uuid":"ef143746-7142-40c7-86c3-103dac1a81d0","name":"FAILOVER_CLUSTER_NAME","value":"NTNX-CLS1","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","description":""},{"val_type":"STRING","uuid":"d2571533-2be2-45be-aaea-446b7bc693e7","name":"FAILOVER_VIP","value":"10.46.6.9","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","description":""},{"val_type":"STRING","uuid":"ba705ca6-2a72-4bf9-a600-0db16d456eed","name":"MSSQL_VIP","value":"10.46.6.10","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","description":""},{"val_type":"STRING","uuid":"051f6919-1d7a-44a9-ac62-9706ca4d414f","name":"PE_DATA_SERVICE_IP","value":"10.46.34.96","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","description":""},{"val_type":"STRING","uuid":"1f5702d8-54e6-43b7-b8e0-f840613d4e60","name":"PE_IP","value":"10.46.34.95","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","description":""},{"val_type":"STRING","uuid":"33483d02-7fb6-443c-a66d-16594c27e92b","name":"SQL_CLUSTER_NAME","value":"NTNX-SQLCLS1","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","description":""},{"val_type":"STRING","uuid":"d3f537d3-fe1b-47c9-bd38-724580ef010f","name":"VG_NAME","value":"XEN_VolumeGroup1","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","description":""}],"uuid":"8206ada8-4e20-405a-a4fd-fde80e191e05"}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"LOCAL","uuid":"04ca4ba7-eaed-4178-8880-c103539f07ec"},"package_definition_list":[{"uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be","action_list":[],"service_local_reference_list":[{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"}],"name":"AHV MSSQL Package","version":"","type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","name":"Apply OS BPG","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"$start_time = Get-Date\n\n$TempDirectory = \"C:\\Temp\"\n$RktTemp = \"$TempDirectory\\rktools.2003\"\n\n$url = \"@@{BPG_RKTOOLS_URL}@@\"\n$filePath = \"$TempDirectory\\rktools.exe\"\n\nNew-Item -ItemType Directory -Force -Path $TempDirectory\n(New-Object System.Net.WebClient).DownloadFile($url,$filePath)\n\n& $filePath \/Q \/T:\"$RktTemp\" \/C\n\nStart-Sleep 10\n\n$PackageName = \"rktools.2003\"\n$setupPath = \"C:\\Windows\\System32\\msiexec.exe\"\n$silentArgs = \"\/i $RktTemp\\rktools.msi \/qn\"\n$validExitCodes = @(0)\n\nWrite-Output \"Installing $PackageName....\"\n\n$install = Start-Process -FilePath $setupPath -ArgumentList $silentArgs -Wait -NoNewWindow -PassThru\n$install.WaitForExit()\n\n$exitCode = $install.ExitCode\n$install.Dispose()\n\nWrite-Output \"Command [`\"$setupPath`\" $silentArgs] exited with `'$exitCode`'.\"\nif ($validExitCodes -notcontains $exitCode) {\n\tWrite-Output \"Running [`\"$setupPath`\" $silentArgs] was not successful. Exit code was '$exitCode'. See log for possible error messages.\"\n\texit 1\n}\n\n# OS related tunning\n# Set Windows Power Options to High Performance\npowercfg -s 8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c\n\n#Grant Memory privileges to user \n$ntrights_cli = \"C:\\Program Files (x86)\\Windows Resource Kits\\Tools\\ntrights.exe\"\n& $ntrights_cli -u \"NT SERVICE\\MSSQLSERVER\" +r SeLockMemoryPrivilege\n& $ntrights_cli -u \"NT SERVICE\\MSSQLSERVER\" +r SeManageVolumePrivilege\n\nWrite-Output \"Time taken: $((Get-Date).Subtract($start_time).seconds) Second(s)\"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"241466f6-7a7e-4e0a-bc28-690d736f611d"},"type":"","command_line_args":"","script_type":"npsscript"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"16071347-c52b-4661-bf59-401a5fcf3fdd"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","name":"Apply SQL BPG","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"$start_time = Get-Date\n\n$TempDirectory = \"C:\\Temp\"\n$sqladdparms_cli = \"$TempDirectory\\Add-SqlServerStartupParameter.ps1\"\n$TSQLSCRIPTSDIR = \"$TempDirectory\\TSQL_Scripts\"\nNew-Item -ItemType Directory -Force -Path $TSQLSCRIPTSDIR\n  \nSet-Content -Path \"$sqladdparms_cli\" -Value '\nparam(\n    ## The parameter you wish to add\n    [Parameter(Mandatory = $true)]\n    $StartupParameter\n)\n\n$hklmRootNode = \"HKLM:\\SOFTWARE\\Microsoft\\Microsoft SQL Server\"\n\n$props = Get-ItemProperty \"$hklmRootNode\\Instance Names\\SQL\"\n$instances = $props.psobject.properties | ?{$_.Value -like \"MSSQL*\"} | select Value\n\n$instances | %{\n    $inst = $_.Value;\n    $regKey = \"$hklmRootNode\\$inst\\MSSQLServer\\Parameters\"\n    $props = Get-ItemProperty $regKey\n    $params = $props.psobject.properties | ?{$_.Name -like \"SQLArg*\"} | select Name, Value\n    #$params | ft -AutoSize\n    $hasFlag = $false\n    foreach ($param in $params) {\n        if($param.Value -eq $StartupParameter) {\n            $hasFlag = $true\n            break;\n        }\n    }\n    if (-not $hasFlag) {\n        \"Adding $StartupParameter\"\n        $newRegProp = \"SQLArg\"+($params.Count)\n        Set-ItemProperty -Path $regKey -Name $newRegProp -Value $StartupParameter\n    } else {\n        \"$StartupParameter already set\"\n    }\n}'\nSet-Content -Path \"$TSQLSCRIPTSDIR\\01-ChangeTempDB.sql\" -Value \"use master`r`n\ngo`r`n\nAlter database tempdb modify file (name = tempdev, filename = 'I:\\TEMPDB01\\tempdb01.mdf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb modify file (name = templog, filename = 'T:\\TempDB-logs01\\templog01.ldf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb ADD file (name = tempdev02, filename = 'I:\\TEMPDB01\\tempdb02.ndf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb ADD file (name = tempdev03, filename = 'J:\\TEMPDB02\\tempdb03.ndf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb ADD file (name = tempdev04, filename = 'J:\\TEMPDB02\\tempdb04.ndf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\n`r`n\nALTER DATABASE [tempdb] MODIFY FILE (NAME=N'tempdev', NEWNAME=N'tempdev01')`r`n\nGO`r`n\nALTER DATABASE [tempdb] MODIFY FILE (NAME=N'templog', NEWNAME=N'templog01')`r`n\nGO\"\n\nSet-Content -Path \"$TSQLSCRIPTSDIR\\02-IncreaseTempDB_logs.sql\" -Value \"Use master`r`n\ngo`r`n\nALTER DATABASE tempdb MODIFY FILE (NAME = templog01, filename = 'T:\\TempDB-logs01\\templog01.ldf', SIZE`r`n\n= 8096);`r`n\nGO`r`n\nALTER DATABASE tempdb MODIFY FILE (NAME = templog01, FILENAME = 'T:\\TempDB-logs01\\templog01.ldf', SIZE`r`n\n= 12288);`r`n\nGO\"\n\nSet-Content -Path \"$TSQLSCRIPTSDIR\\03-SQL_set_memory.sql\" -Value \"USE master;`r`n\nexec sp_configure 'show advanced options', 1;`r`n\nRECONFIGURE;`r`n\nGO`r`n\nDECLARE `r`n\n        @total_mem decimal (10,0),`r`n\n\t\t@min int,`r`n\n\t\t@max int`r`n\nSELECT `r`n\n   --SELECT (physical_memory_kb\/1024) AS Server_Physical_Memory_MB`r`n\n  @total_mem = (physical_memory_kb\/1024)`r`n\nFROM sys.dm_os_sys_info`r`n\n`r`n\nset @min = @total_mem * 0.1`r`n\nset @max = @total_mem * 0.85`r`n\nprint @min`r`n\nprint @max`r`n\n--print @total_mem`r`n\n`r`n\n`r`n\nEXEC sp_configure 'min server memory (MB)',@min`r`n\nEXEC sp_configure 'max server memory (MB)',@max`r`n\nRECONFIGURE\"\n\nSet-Content -Path \"$TSQLSCRIPTSDIR\\04-SQL-ChangeDefaultPaths.sql\" -Value \"USE [master]`r`n\nGO`r`n\n-- Change default location for data files`r`n\nEXEC xp_instance_regwrite`r`n\nN'HKEY_LOCAL_MACHINE',`r`n\nN'Software\\Microsoft\\MSSQLServer\\MSSQLServer',`r`n\nN'DefaultData',`r`n\nREG_SZ,`r`n\nN'G:\\SQLDATA01'`r`n\nGO`r`n\n-- Change default location for log files`r`n\nEXEC xp_instance_regwrite`r`n\nN'HKEY_LOCAL_MACHINE',`r`n\nN'Software\\Microsoft\\MSSQLServer\\MSSQLServer',`r`n\nN'DefaultLog',`r`n\nREG_SZ,`r`n\nN'L:\\UserDB-logs01'`r`n\nGO`r`n\n-- Change default location for backups`r`n\nEXEC xp_instance_regwrite`r`n\nN'HKEY_LOCAL_MACHINE',`r`n\nN'Software\\Microsoft\\MSSQLServer\\MSSQLServer',`r`n\nN'BackupDirectory',`r`n\nREG_SZ,`r`n\nN'R:\\SQLBACK'`r`n\nGO\"\n\n#create directories\nmkdir G:\\SQLDATA01\\\nmkdir H:\\SQLDATA02\\\nmkdir I:\\TEMPDB01\\\nmkdir J:\\TEMPDB02\\\nmkdir L:\\UserDB-logs01\\\nmkdir T:\\TempDB-logs01\\\nmkdir R:\\SQLBACK\n\n#ADD SQL T parameters \n#T1117 This parameter forces MS SQL Server to grow all database files uniformly\n#T1118 This parameter forces MS SQL Server to use full extents only\n& $sqladdparms_cli '-T1117'\n& $sqladdparms_cli '-T1118'\nrestart-service MSSQL* -force\n\n#import powershell SQL module\nimport-module \"sqlps\" -DisableNameChecking\n\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\01-ChangeTempDB.sql\"\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\02-IncreaseTempDB_logs.sql\"\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\03-SQL_set_memory.sql\"\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\04-SQL-ChangeDefaultPaths.sql\"\n\n#Delete original SQL temp files\nstop-service MSSQL* \nStart-Sleep 5\nrm \"F:\\MSSQL\\MSSQL12.MSSQLSERVER\\MSSQL\\DATA\\temp*\"\n\nstart-service MSSQL* \nwmic useraccount get sid\nWrite-Output \"Time taken: $((Get-Date).Subtract($start_time).seconds) Second(s)\"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"241466f6-7a7e-4e0a-bc28-690d736f611d"},"type":"","command_line_args":"","script_type":"npsscript"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"d2f0fa03-1a5f-4ef0-8c14-9b8b23de370c"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","name":"Attach VG","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"static","type":"","command_line_args":"","exit_status":[],"script":"#script\nprism_ip = '@@{PE_IP}@@'\nusername = '@@{PE_CREDS.username}@@'\npassword = '@@{PE_CREDS.secret}@@'\nvgname = '@@{VG_NAME}@@'\nvg_uuid = ''\nIQN='@@{IQN}@@'\n\napi_url = \"https:\/\/\" + prism_ip + \":9440\/PrismGateway\/services\/rest\/v2.0\/\"\n\nprint \"INFO: Attaching VG {} to node.\".format(vgname)\n\n# -*- Check volume group existance\n\ntry:\n  check_vg_url = api_url + \"volume_groups\"\n  response = urlreq(check_vg_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\n  vgs = json.loads(response.content)\n  for vg in vgs['entities']:\n    if vg['name'] == vgname:\n      vg_uuid = vg['uuid']\nexcept Exception as e:\n\tprint \"ERROR: Failed to get volume group, check volume group or check username\/password\"\n\tprint e.message\n\texit(1)\n    \nif vg_uuid == '':\n  print \"ERROR: Volume group with name {} doesn't exists\".format(vgname)\n  exit(1)\n\n# -*- Attach Volume Group\n\nattach_vg_url = api_url + \"volume_groups\/\" + vg_uuid + \"\/open\"\npayload = {\n  \"iscsi_client\": {\n    \"client_address\": IQN\n  },\n  \"operation\": \"ATTACH\"\n}\n\nresponse = urlreq(attach_vg_url, verb='POST', auth=\"BASIC\", user=username, passwd=password, params=json.dumps(payload), verify=False)\nif response.status_code != 201:\n\tprint \"ERROR: Attaching vg '{}' failed.\".format(vgname)\n\nattach_status = json.loads(response.content)\nif attach_status['value']:\n  print \"INFO: Attaching vg '{}' Successful.\".format(vgname)\nelse:\n  print \"ERROR: Attaching vg '{}' failed.\".format(vgname)"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"e88d7d4a-14ab-4d56-b1c8-8b312d3ab24e"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","name":"Configure WSFC","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"if (\"@@{calm_array_index}@@\" -ne \"0\"){\n\texit\n}\n\n$FailOverClusterName='@@{FAILOVER_CLUSTER_NAME}@@'\n$FailOverVIP='@@{FAILOVER_VIP}@@'\n$Nodes=\"@@{calm_array_address}@@\".split(',')\n\n# -*- Test Failover Cluster\n\nif(Test-Cluster -Node $Nodes){\n\tWrite-Output \"INFO: Test-Cluster Success.\"\n}\nelse\n{\n\tWrite-Output \"ERROR: Test-Cluster Failed.\"\n    exit 1\n}\n\nforeach ( $node in $(\"@@{calm_array_address}@@\".split(',')) ){Test-WSMan $node}\n\n# -*- Create Failover Cluster\n\nNew-Cluster -Name $FailOverClusterName -Node $Nodes -StaticAddress $FailOverVIP\n\n# -*- Rename Cluster Disks\n$ClusterDisks =  Get-CimInstance -ClassName MSCluster_Resource -Namespace root\/mscluster -Filter \"type = 'Physical Disk'\"\nforeach ($Disk in $ClusterDisks) {\n$DiskResource = Get-CimAssociatedInstance -InputObject $Disk -ResultClass MSCluster_DiskPartition\n\tif (-not ($DiskResource.VolumeLabel -eq $Disk.Name)) {\n\t\tInvoke-CimMethod -InputObject $Disk -MethodName Rename -Arguments @{newName = $DiskResource.VolumeLabel}\n  \t}\n}"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"75430fc8-644c-4b88-a1bd-eb19424e9d4f"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","name":"Connect Mount VG","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"New-IscsiTargetPortal -TargetPortalAddress @@{PE_DATA_SERVICE_IP}@@\nGet-IscsiTarget | Connect-IscsiTarget -IsPersistent $true\n\n#Initialize Disks\nif (((Get-Disk -Number 1 -ErrorAction SilentlyContinue).HealthStatus -eq \"Healthy\") -and ((Get-Disk -Number 2 -ErrorAction SilentlyContinue).HealthStatus -eq \"Healthy\")) {\n\tGet-Disk -Number 1 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 2 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 3 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 4 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 5 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 6 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 7 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 8 | Initialize-Disk -ErrorAction SilentlyContinue\n\tNew-Partition -DiskNumber 1 -UseMaximumSize -DriveLetter F -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -FileSystem NTFS -NewFileSystemLabel \"SQLINSTALL\" \n\tNew-Partition -DiskNumber 2 -UseMaximumSize -DriveLetter R -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"SQLBCK\"\n\tNew-Partition -DiskNumber 3 -UseMaximumSize -DriveLetter G -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"DATA01\" \n\tNew-Partition -DiskNumber 4 -UseMaximumSize -DriveLetter H -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"DATA02\"\n    New-Partition -DiskNumber 5 -UseMaximumSize -DriveLetter I -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"TEMPDB01\" \n\tNew-Partition -DiskNumber 6 -UseMaximumSize -DriveLetter J -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"TEMPDB02\"\n    New-Partition -DiskNumber 7 -UseMaximumSize -DriveLetter T -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"TEMPDBLOG01\" \n\tNew-Partition -DiskNumber 8 -UseMaximumSize -DriveLetter L -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"ULOG01\"\n\n} else {\n\tWrite-Output \"Disks does not exists or not healthy.`nIf you havent added disks please add 8 disk.\"\n\texit 1\n}\n\nif (\"@@{calm_array_index}@@\" -eq \"0\"){\n  if ((Get-Disk -Number 9 -ErrorAction SilentlyContinue).HealthStatus -eq \"Healthy\"){\n      Get-Disk -Number 9 | Initialize-Disk -ErrorAction SilentlyContinue\n      New-Partition -DiskNumber 9 -UseMaximumSize -DriveLetter W -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -FileSystem NTFS -NewFileSystemLabel \"Witness\" \n  } else {\n      Write-Output \"Witness Disk does not exists or not healthy.`nIf you havent added disks please add a volume group and attach.`n `t - Witness : 1GB\"\n      exit 1\n  }\n}\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"e6eda1d6-ddce-4885-89c4-d0eb240d2c29"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","name":"Create AAG","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"if (\"$(Get-ClusterNode | where {$_.Id -eq 1} | select -ExpandProperty Name)\" -ne \"$(hostname)\"){\n\texit\n}\n$AGName = '@@{SQL_CLUSTER_NAME}@@'\n$PrimaryNode = $(hostname)\n$IP = '@@{MSSQL_VIP}@@\/255.255.255.0'\n$replicas = @()\n\n$cname = (Get-Cluster -name $PrimaryNode).name\n$nodes = (get-clusternode -Cluster $cname).name\n\n$sqlperms = @\"\nuse [master];\nGRANT ALTER ANY AVAILABILITY GROUP TO [NT AUTHORITY\\SYSTEM];\nGRANT CONNECT SQL TO [NT AUTHORITY\\SYSTEM];\nGRANT VIEW SERVER STATE TO [NT AUTHORITY\\SYSTEM];\n\"@\n\nforeach($node in $nodes)\n{\n\tInvoke-Sqlcmd -ServerInstance $node -Database master -Query $sqlperms\n\t$replicas += New-SqlAvailabilityReplica -Name $node -EndpointUrl \"TCP:\/\/$($node):5022\" -AvailabilityMode \"SynchronousCommit\" -FailoverMode \"Automatic\" -AsTemplate -Version 12 \n}\n\n\nNew-SqlAvailabilityGroup -Name $AGName -Path \"SQLSERVER:\\SQL\\$PrimaryNode\\DEFAULT\" -AvailabilityReplica $replicas\n$nodes | Where-Object {$_ -ne $PrimaryNode} | ForEach-Object {Join-SqlAvailabilityGroup -path \"SQLSERVER:\\SQL\\$_\\DEFAULT\" -Name $AGName}\nNew-SqlAvailabilityGroupListener -Name $AGName -staticIP $IP -Port 1433 -Path \"SQLSERVER:\\Sql\\$PrimaryNode\\DEFAULT\\AvailabilityGroups\\$AGName\"\n","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"241466f6-7a7e-4e0a-bc28-690d736f611d"},"type":"","command_line_args":"","script_type":"npsscript"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"8847fcec-5aaf-4a08-bd24-c3056c425829"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","name":"Create VG","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"static","type":"","command_line_args":"","exit_status":[],"script":"#script\n\nif \"@@{calm_array_index}@@\" != \"0\":\n  exit(0)\nprism_ip = '@@{PE_IP}@@'\nusername = '@@{PE_CREDS.username}@@'\npassword = '@@{PE_CREDS.secret}@@'\nstorage_container_name = '@@{CONTAINER_NAME}@@'\nstorage_container_uuid = ''\nvgname = '@@{VG_NAME}@@'\n\napi_url = \"https:\/\/\" + prism_ip + \":9440\/PrismGateway\/services\/rest\/v2.0\/\"\n\nprint \"INFO: Retrieving storage container uuid for: {}.\".format(storage_container_name)\n\n# -*- Get Container UUID\n\nget_container_uuid_url = api_url + \"storage_containers\"\ntry:\n  response = urlreq(get_container_uuid_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\n  storage_containers = json.loads(response.content)\n  for container in storage_containers['entities']:\n    if container['name'] == storage_container_name:\n      storage_container_uuid = container['storage_container_uuid']\nexcept Exception as e:\n\tprint \"ERROR: Failed to get storage container uuid, check storage container name or check username\/password\"\n\tprint e.message\n\texit(1)\n\nprint \"INFO: storage container uuid is: {}.\".format(storage_container_uuid)\n\n# -*- Check volume group existance\n\ncheck_vg_url = api_url + \"volume_groups\"\nresponse = urlreq(check_vg_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\nvgs = json.loads(response.content)\nfor vg in vgs['entities']:\n  if vg['name'] == vgname:\n    print \"ERROR: Volume group with name {} already exists.\".format(vgname)\n    exit(1)\n\nprint \"INFO: Creating volume group '{}'.\".format(vgname)\n\n# -*- Create Volume Group\n\ncreate_vg_url = api_url + \"volume_groups\"\npayload = {\n\t\"disk_list\": [{\n\t\t\"create_config\": {\n\t\t\t\"size\": 1073741824,\n\t\t\t\"storage_container_uuid\": storage_container_uuid\n\t\t},\n\t\t\"index\": 0\n\t}],\n\t\"is_shared\": True,\n\t\"name\": vgname\n}\n\nresponse = urlreq(create_vg_url, verb='POST', auth=\"BASIC\", user=username, passwd=password, params=json.dumps(payload), verify=False)\nif response.status_code != 201:\n\tprint \"ERROR: creation of volume group '{}' failed.\".format(vgname)\n\nvg_create_status = json.loads(response.content)\ntask_uuid = vg_create_status['task_uuid']\n\nsleep(5)\n\ncheck_vg_creation_url = api_url + \"tasks\/\" + task_uuid\nresponse = response = urlreq(check_vg_creation_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\nvg_create_status = json.loads(response.content)\n\nif vg_create_status['progress_status'] != \"Succeeded\":\n\tprint \"ERROR: creation of volume group '{}' failed.\".format(vgname)\n\texit(1)\nelse:\n\tprint \"INFO: creation of volume group '{}' Successful.\".format(vgname)"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"d6e3a93d-7d6c-44b8-a966-b96c22721a88"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","name":"Enable AAG","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"# -*- Variable for T-SQL command\n$netbios = \"@@{DOMAIN}@@\".Split(\".\")[0].ToUpper()\n$createLogin = \"CREATE LOGIN [$netbios\\sqlservice] FROM WINDOWS; \" \n$grantConnectPermissions = \"GRANT CONNECT ON ENDPOINT::Endpoint_AG TO [$netbios\\sqlservice];\"\n\nEnable-SqlAlwaysOn -ServerInstance $(hostname) -Force \nNew-SqlHADREndpoint -Path \"SQLSERVER:\\SQL\\$(hostname)\\DEFAULT\" -Name \"Endpoint_AG\" -Port 5022 -EncryptionAlgorithm Aes -Encryption Required \nSet-SqlHADREndpoint -Path \"SQLSERVER:\\SQL\\$(hostname)\\DEFAULT\\Endpoints\\Endpoint_AG\" -State Started\nInvoke-SqlCmd -Server $(hostname) -Query $createLogin\nInvoke-SqlCmd -Server $(hostname) -Query $grantConnectPermissions","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"241466f6-7a7e-4e0a-bc28-690d736f611d"},"type":"","command_line_args":"","script_type":"npsscript"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"966ce7d9-1de9-4e2a-9e2a-139eef0c8d73"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","name":"Get IQN","type":"SET_VARIABLE","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"Write-Output \"IQN=$((Get-InitiatorPort).NodeAddress)\"","eval_variables":["IQN"],"eval_scope":"local","type":"","script_type":"npsscript"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"776df270-5394-41ab-9284-c3caaf0a29f5"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","name":"Install FC","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"Install-WindowsFeature -Name Failover-Clustering -IncludeManagementTools\n\nif (-not (get-WindowsFeature -Name Failover-Clustering -ErrorAction SilentlyContinue | select -ExpandProperty Installed)){\n\tWrite-output \"Failover Clustering is not installed\"\n\texit 1\n}"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"50209b45-54b0-4c13-9230-221bf892d2c9"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","name":"Install SQL","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"#Install-WindowsFeature -IncludeAllSubFeature -ErrorAction Stop \"Net-Framework-Core\"\n$DOMAINNAME=(Get-WmiObject Win32_ComputerSystem).Domain\n$setupDriveLetter = \"D:\"\n$setupPath = \"$setupDriveLetter\\setup.exe\"\n$silentArgs = \"\/IACCEPTSQLSERVERLICENSETERMS \/Q \/ACTION=install \/FEATURES=SQLENGINE,FULLTEXT,SSMS,ADV_SSMS \/AGTSVCACCOUNT=`\"@@{SQL_CREDS.username}@@`\" \/AGTSVCPASSWORD=@@{SQL_CREDS.secret}@@ \/SQLSVCACCOUNT=`\"@@{SQL_CREDS.username}@@`\" \/SQLSVCPASSWORD=@@{SQL_CREDS.secret}@@ \/SQLSYSADMINACCOUNTS=`\"$DOMAINNAME\\Domain Admins`\" \/ISSVCACCOUNT=`\"@@{SQL_CREDS.username}@@`\" \/ISSVCPASSWORD=@@{SQL_CREDS.secret}@@ \/ASSYSADMINACCOUNTS=`\"@@{SQL_CREDS.username}@@`\" \/INSTANCEID=MSSQLSERVER \/INSTANCENAME=MSSQLSERVER \/UPDATEENABLED=True \/UPDATESOURCE=`\"C:\\Temp`\" \/INDICATEPROGRESS \/TCPENABLED=1 \/INSTALLSQLDATADIR=`\"F:\\MSSQL`\" \/SQLUSERDBLOGDIR=`\"L:\\MSSQL`\" \/SQLTEMPDBLOGDIR=`\"T:\\MSSQL`\"\"\n$validExitCodes = @(0)\n\n$install = Start-Process -FilePath $setupPath -ArgumentList $silentArgs -Wait -NoNewWindow -PassThru\n$install.WaitForExit()\n$exitCode = $install.ExitCode\n$install.Dispose()\n\nWrite-Output \"SQL Failover Cluster Installation exited with `'$exitCode`'.\"\nif ($validExitCodes -notcontains $exitCode) {\n\tWrite-Output \"Running [`\"$setupPath`\" $silentArgs] was not successful. Exit code was '$exitCode'. See log for possible error messages.\"\n\texit 1\n}"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"4a9daa04-2da2-4543-88dd-62bd661baf46"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","name":"JoinDomain","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"##############################################\n# Name        : JoinDomain\n# Author      : K Sarat Kumar\n# Version     : 1.0\n# Description : Script is used to join to domain.\n##############################################\n\nfunction JointoDomain {\n  [CmdletBinding()]\n  Param(\n      [parameter(Mandatory=$true)]\n      [string]$DomainName,\n      [parameter(Mandatory=$false)]\n      [string]$OU,\n      [parameter(Mandatory=$true)]\n      [string]$Username,\n      [parameter(Mandatory=$true)]\n      [string]$Password,\n      [parameter(Mandatory=$true)]\n      [string]$Server\n  )\n  $adapter = Get-NetAdapter | ? {$_.Status -eq \"up\"}\n  $adapter | Set-DnsClientServerAddress -ServerAddresses $Server\n\n  if ($env:computername  -eq $env:userdomain) {\n    Write-Host \"Not in domain\"\n    #$adminname = \"$DomainName\\$Username\"\n    $adminname = \"$Username\"\n    $adminpassword = ConvertTo-SecureString -asPlainText -Force -String \"$Password\"\n    Write-Host \"$adminname , $password\"\n    $credential = New-Object System.Management.Automation.PSCredential($adminname,$adminpassword)\n    Add-computer -DomainName $DomainName -Credential $credential -force -Options JoinWithNewName,AccountCreate -PassThru -ErrorAction Stop\n  } else {\n     Write-Host \"Already in domain\"\n  }\n}\n\nJointoDomain -DomainName \"@@{DOMAIN}@@\" -Username \"@@{DOMAIN_CRED.username}@@\" -Password \"@@{DOMAIN_CRED.secret}@@\" -Server \"@@{AD_IP}@@\"\n\nRestart-Computer -Force -AsJob\nexit 0\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"f54bbb0f-0f2d-422a-b098-98ca0e2776ee"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","name":"Pre Requisites","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"##############################################\n# Name        : Pre-requisites\n# Author      : K Sarat Kumar\n# Version     : 1.0\n# Description : Script is used to join to domain.\n##############################################\n\n# -*- Pre-requisite to enable credssp and set 'Server' role\nEnable-WSManCredSSP -Role Server -Force\n\n# -*- Enabling and starting 'msiscsi'\nSet-Service -Name msiscsi -StartupType Automatic\nStart-Service msiscsi\n\n# -*- Change first Ehternet adapter name to 'Production'\nGet-NetAdapter -Name \"Ethernet\" | Rename-NetAdapter -NewName \"Production\" -ErrorAction SilentlyContinue\n\n# -*- Download SQL Updates\n$TempDirectory = \"C:\\Temp\"\nNew-Item -ItemType Directory -Force -Path $TempDirectory\n(New-Object System.Net.WebClient).DownloadFile(\"http:\/\/10.46.1.165\/ISOs\/SQLServer2014-KB4052725-x64.exe\",\"$TempDirectory\\SQLServer2014-KB4052725-x64.exe\")\nSet-NetFirewallProfile -Profile Domain,Public,Private -Enabled False\n\nInstall-WindowsFeature -IncludeAllSubFeature -ErrorAction Stop \"Net-Framework-Core\"\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"e47f135e-841a-4210-bd7d-3ff125796987"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"9308dfa4-9a23-40bd-bc4c-ca6a65c25567"},"retries":"0","name":"Sleep","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"static","type":"","command_line_args":"","exit_status":[],"script":"#script\nsleep(65)"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"7d1bfcc7-d4f1-4d7d-9a64-71f6c493a623"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","name":"ddaf74d2_dag","type":"DAG","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Apply OS BPG","uuid":"16071347-c52b-4661-bf59-401a5fcf3fdd"},{"kind":"app_task","name":"Apply SQL BPG","uuid":"d2f0fa03-1a5f-4ef0-8c14-9b8b23de370c"},{"kind":"app_task","name":"Attach VG","uuid":"e88d7d4a-14ab-4d56-b1c8-8b312d3ab24e"},{"kind":"app_task","name":"Configure WSFC","uuid":"75430fc8-644c-4b88-a1bd-eb19424e9d4f"},{"kind":"app_task","name":"Connect Mount VG","uuid":"e6eda1d6-ddce-4885-89c4-d0eb240d2c29"},{"kind":"app_task","name":"Create AAG","uuid":"8847fcec-5aaf-4a08-bd24-c3056c425829"},{"kind":"app_task","name":"Create VG","uuid":"d6e3a93d-7d6c-44b8-a966-b96c22721a88"},{"kind":"app_task","name":"Enable AAG","uuid":"966ce7d9-1de9-4e2a-9e2a-139eef0c8d73"},{"kind":"app_task","name":"Get IQN","uuid":"776df270-5394-41ab-9284-c3caaf0a29f5"},{"kind":"app_task","name":"Install FC","uuid":"50209b45-54b0-4c13-9230-221bf892d2c9"},{"kind":"app_task","name":"Install SQL","uuid":"4a9daa04-2da2-4543-88dd-62bd661baf46"},{"kind":"app_task","name":"JoinDomain","uuid":"f54bbb0f-0f2d-422a-b098-98ca0e2776ee"},{"kind":"app_task","name":"Pre Requisites","uuid":"e47f135e-841a-4210-bd7d-3ff125796987"},{"kind":"app_task","name":"Sleep","uuid":"7d1bfcc7-d4f1-4d7d-9a64-71f6c493a623"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Apply OS BPG","uuid":"16071347-c52b-4661-bf59-401a5fcf3fdd"},"edge_type":"user_defined","type":"","uuid":"698cdfea-b158-4eec-ba38-a68dcc8e3ebb","to_task_reference":{"kind":"app_task","name":"Apply SQL BPG","uuid":"d2f0fa03-1a5f-4ef0-8c14-9b8b23de370c"}},{"from_task_reference":{"kind":"app_task","name":"Apply SQL BPG","uuid":"d2f0fa03-1a5f-4ef0-8c14-9b8b23de370c"},"edge_type":"user_defined","type":"","uuid":"a7765173-dbee-4b6c-968a-9ddd99eeb3ff","to_task_reference":{"kind":"app_task","name":"Enable AAG","uuid":"966ce7d9-1de9-4e2a-9e2a-139eef0c8d73"}},{"from_task_reference":{"kind":"app_task","name":"Attach VG","uuid":"e88d7d4a-14ab-4d56-b1c8-8b312d3ab24e"},"edge_type":"user_defined","type":"","uuid":"98a82d46-d12d-4918-bcf7-59f3b3ed1378","to_task_reference":{"kind":"app_task","name":"Connect Mount VG","uuid":"e6eda1d6-ddce-4885-89c4-d0eb240d2c29"}},{"from_task_reference":{"kind":"app_task","name":"Configure WSFC","uuid":"75430fc8-644c-4b88-a1bd-eb19424e9d4f"},"edge_type":"user_defined","type":"","uuid":"e4126daf-0bde-4896-8afb-36a8fa89d8ac","to_task_reference":{"kind":"app_task","name":"Install SQL","uuid":"4a9daa04-2da2-4543-88dd-62bd661baf46"}},{"from_task_reference":{"kind":"app_task","name":"Connect Mount VG","uuid":"e6eda1d6-ddce-4885-89c4-d0eb240d2c29"},"edge_type":"user_defined","type":"","uuid":"69a0a0ad-ea55-444a-ab1b-e39ef1eecdc5","to_task_reference":{"kind":"app_task","name":"Install FC","uuid":"50209b45-54b0-4c13-9230-221bf892d2c9"}},{"from_task_reference":{"kind":"app_task","name":"Create VG","uuid":"d6e3a93d-7d6c-44b8-a966-b96c22721a88"},"edge_type":"user_defined","type":"","uuid":"83dd7d3b-0f55-4000-ac65-df97dae23911","to_task_reference":{"kind":"app_task","name":"Get IQN","uuid":"776df270-5394-41ab-9284-c3caaf0a29f5"}},{"from_task_reference":{"kind":"app_task","name":"Enable AAG","uuid":"966ce7d9-1de9-4e2a-9e2a-139eef0c8d73"},"edge_type":"user_defined","type":"","uuid":"dae4ae4b-b47c-4971-81ba-c1c6e3497c5c","to_task_reference":{"kind":"app_task","name":"Create AAG","uuid":"8847fcec-5aaf-4a08-bd24-c3056c425829"}},{"from_task_reference":{"kind":"app_task","name":"Get IQN","uuid":"776df270-5394-41ab-9284-c3caaf0a29f5"},"edge_type":"user_defined","type":"","uuid":"18d08e01-8c81-4e53-8c97-c9eebda67aea","to_task_reference":{"kind":"app_task","name":"Attach VG","uuid":"e88d7d4a-14ab-4d56-b1c8-8b312d3ab24e"}},{"from_task_reference":{"kind":"app_task","name":"Install FC","uuid":"50209b45-54b0-4c13-9230-221bf892d2c9"},"edge_type":"user_defined","type":"","uuid":"33ad2d9f-5df5-4e1e-a932-d2ee29cc52e6","to_task_reference":{"kind":"app_task","name":"Configure WSFC","uuid":"75430fc8-644c-4b88-a1bd-eb19424e9d4f"}},{"from_task_reference":{"kind":"app_task","name":"Install SQL","uuid":"4a9daa04-2da2-4543-88dd-62bd661baf46"},"edge_type":"user_defined","type":"","uuid":"5a660b92-3bb1-4b00-9fed-f2ebc11e6a7c","to_task_reference":{"kind":"app_task","name":"Apply OS BPG","uuid":"16071347-c52b-4661-bf59-401a5fcf3fdd"}},{"from_task_reference":{"kind":"app_task","name":"JoinDomain","uuid":"f54bbb0f-0f2d-422a-b098-98ca0e2776ee"},"edge_type":"user_defined","type":"","uuid":"92982bc3-2976-4af5-ab5e-242aefee9c09","to_task_reference":{"kind":"app_task","name":"Sleep","uuid":"7d1bfcc7-d4f1-4d7d-9a64-71f6c493a623"}},{"from_task_reference":{"kind":"app_task","name":"Pre Requisites","uuid":"e47f135e-841a-4210-bd7d-3ff125796987"},"edge_type":"user_defined","type":"","uuid":"cffecd10-421e-4edc-ac4e-428052bc2e2f","to_task_reference":{"kind":"app_task","name":"JoinDomain","uuid":"f54bbb0f-0f2d-422a-b098-98ca0e2776ee"}},{"from_task_reference":{"kind":"app_task","name":"Sleep","uuid":"7d1bfcc7-d4f1-4d7d-9a64-71f6c493a623"},"edge_type":"user_defined","type":"","uuid":"3cc2026a-076c-472f-9510-0dc68c312177","to_task_reference":{"kind":"app_task","name":"Create VG","uuid":"d6e3a93d-7d6c-44b8-a966-b96c22721a88"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"8306d922-058c-4cfe-9b3b-90d62e9310c8"}],"name":"0561ade3_runbook","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"ddaf74d2_dag","uuid":"8306d922-058c-4cfe-9b3b-90d62e9310c8"},"uuid":"6646e873-42d2-40fa-88dc-d421a1b7acea"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"9fa1acf4-bb3c-4ac6-be87-1f52537922be"},"retries":"0","name":"7bf7eecb_dag","type":"DAG","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"379374aa-a125-452b-8f3f-96ddfe9d061b"}],"name":"f564b0c1_runbook","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"7bf7eecb_dag","uuid":"379374aa-a125-452b-8f3f-96ddfe9d061b"},"uuid":"5999dedb-3661-42af-a916-57dfa19f849d"}},"variable_list":[],"description":""}],"client_attrs":{"None":{"y":-40,"x":63},"2814f949-fa68-4ac9-8488-dd477093f961":{"y":-477,"x":-1158},"ddf91c58-e279-4274-8d8d-708c10847b35":{"y":-474.5,"x":-859.25},"341398c4-9eb0-4ec9-9002-66ac9fe09add":{"y":-469.5,"x":-587.25}}},"description":""},"api_version":"3.0","metadata":{"last_update_time":"1555439512310724","owner_reference":{"kind":"user","uuid":"00000000-0000-0000-0000-000000000000","name":"admin"},"kind":"blueprint","uuid":"8c2e024a-37f9-4ecc-8a3e-a0e868241f42","project_reference":{"kind":"project","name":"default","uuid":"209e0a42-6f2d-4999-9a9b-5aa705d25661"},"spec_version":13,"creation_time":"1555409505203993","name":"MSSQL AAG"}}