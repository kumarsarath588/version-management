{"status":{"description":"","source_mpi":"","state":"ACTIVE","is_cloned":false,"message_list":[],"resources":{"service_definition_list":[{"port_list":[],"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"b035bcb4-1bf9-4413-afa5-a40b760eacdc","name":"action_create","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"DAG","uuid":"7ba7ced6-5d29-4cef-ba32-ae65e33201d8","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"98f8161b_dag"}],"description":"","message_list":[],"uuid":"900ad31c-a000-48b9-b51c-b7c546c67434","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"98f8161b_dag","uuid":"7ba7ced6-5d29-4cef-ba32-ae65e33201d8"},"name":"dade7481_runbook"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"101c0df2-473c-435c-991e-99f1ecbb0223","name":"action_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"DAG","uuid":"c1850f1c-987a-4995-9bbc-5d48b03c12ca","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"02628fa5_dag"}],"description":"","message_list":[],"uuid":"448b8840-3dc8-408f-a3b3-75646791952c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"02628fa5_dag","uuid":"c1850f1c-987a-4995-9bbc-5d48b03c12ca"},"name":"59afb4f4_runbook"}},{"description":"System action for restarting an application","message_list":[],"uuid":"7c31fafc-f3d2-46f1-b371-a3c6ea9cadce","name":"action_restart","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"DAG","uuid":"37f61b09-731f-4a7c-8953-d990dbfc8b0a","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"27dfdc04_dag"}],"description":"","message_list":[],"uuid":"de0c2ef6-7931-43c2-8812-cf3ea6fcaca6","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"27dfdc04_dag","uuid":"37f61b09-731f-4a7c-8953-d990dbfc8b0a"},"name":"4150545e_runbook"}},{"description":"System action for starting an application","message_list":[],"uuid":"29c68c28-844c-4373-bb17-c41e12fb89a7","name":"action_start","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"DAG","uuid":"f6ffb5b0-2fe0-4461-8618-7343344dd0d5","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"8e5f51b4_dag"}],"description":"","message_list":[],"uuid":"e8e4abb3-204f-432b-afe9-944b40eb96ca","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"8e5f51b4_dag","uuid":"f6ffb5b0-2fe0-4461-8618-7343344dd0d5"},"name":"11876906_runbook"}},{"description":"System action for stopping an application","message_list":[],"uuid":"2a8dc4fe-174a-4fbb-aba7-bb6bf6e55019","name":"action_stop","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"DAG","uuid":"24e26d97-06d9-481a-984d-09b7ba2c4ebb","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"1a17e568_dag"}],"description":"","message_list":[],"uuid":"1f317491-b3c2-4dd3-bdc7-15aeb1e33b0a","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"1a17e568_dag","uuid":"24e26d97-06d9-481a-984d-09b7ba2c4ebb"},"name":"d2728354_runbook"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"e8120e0c-ef7e-4813-9987-d6fa27bbf06a","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"DAG","uuid":"49eafccc-9fc3-4ef7-89cd-4bb43ea1dde8","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Service_Element_Delete_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"245c6e44-9bf7-421f-a078-8056852da649"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"245c6e44-9bf7-421f-a078-8056852da649","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Service_Element_Delete_1fd5d9b1_a75f_4d28_98cd_2bea326d505b"}],"description":"","message_list":[],"uuid":"4ed53bef-cfce-4f7b-806c-e46e1fd8dcd5","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"49eafccc-9fc3-4ef7-89cd-4bb43ea1dde8"},"name":"SYS_GEN__Runbook_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b"}}],"message_list":[],"uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b","state":"ACTIVE","depends_on_list":[],"editables":{},"tier":"","singleton":false,"variable_list":[{"val_type":"STRING","description":"","message_list":[],"uuid":"167b49eb-fbc7-42f8-b8fa-97065080bb7d","value":"","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{},"type":"LOCAL","name":"IQN"}],"name":"MSSQL_AAG"}],"substrate_definition_list":[{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"02993f1d-d96d-4d57-a035-4446dc6cf793","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"DAG","uuid":"f00bcd4f-46bc-4666-bc64-cb1df3740767","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Provision_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"13b91487-0b3a-4c2f-9670-21d42cf4524e"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_MSSQL_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"ffd229a4-d333-4a93-8da6-26bc1269b00b"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Provision_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"13b91487-0b3a-4c2f-9670-21d42cf4524e"},"edge_type":"inherent","type":"","uuid":"7eb1e34b-6777-497e-85cc-dca4ab5d1dc9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_MSSQL_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"ffd229a4-d333-4a93-8da6-26bc1269b00b"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"PROVISION_NUTANIX","uuid":"13b91487-0b3a-4c2f-9670-21d42cf4524e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"name":"MSSQL-@@{calm_unique}@@","categories":"","availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"718f9bd2-7aed-43cb-9fae-fe984c162b57"},"type":""},{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"718f9bd2-7aed-43cb-9fae-fe984c162b57"},"type":""}],"parent_reference":null,"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"serial_port_list":[],"gpu_list":[],"memory_size_mib":4096,"power_state":"ON","hardware_clock_timezone":"","guest_customization":{"cloud_init":null,"type":"","sysprep":{"install_type":"PREPARED","unattend_xml":"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<unattend xmlns=\"urn:schemas-microsoft-com:unattend\">\n   <settings pass=\"specialize\">\n      <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Microsoft-Windows-Shell-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n         <ComputerName>@@{name}@@<\/ComputerName>\n         <RegisteredOrganization>Nutanix<\/RegisteredOrganization>\n         <RegisteredOwner>Acropolis<\/RegisteredOwner>\n         <TimeZone>UTC<\/TimeZone>\n      <\/component>\n      <component xmlns=\"\" name=\"Microsoft-Windows-TerminalServices-LocalSessionManager\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" processorArchitecture=\"amd64\">\n         <fDenyTSConnections>false<\/fDenyTSConnections>\n      <\/component>\n      <component xmlns=\"\" name=\"Microsoft-Windows-TerminalServices-RDP-WinStationExtensions\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" processorArchitecture=\"amd64\">\n         <UserAuthentication>0<\/UserAuthentication>\n      <\/component>\n      <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Networking-MPSSVC-Svc\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n         <FirewallGroups>\n            <FirewallGroup wcm:action=\"add\" wcm:keyValue=\"RemoteDesktop\">\n               <Active>true<\/Active>\n               <Profile>all<\/Profile>\n               <Group>@FirewallAPI.dll,-28752<\/Group>\n            <\/FirewallGroup>\n         <\/FirewallGroups>\n      <\/component>\n   <\/settings>\n   <settings pass=\"oobeSystem\">\n      <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Microsoft-Windows-Shell-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n         <UserAccounts>\n            <AdministratorPassword>\n               <Value>@@{LOCAL.secret}@@<\/Value>\n               <PlainText>true<\/PlainText>\n            <\/AdministratorPassword>\n         <\/UserAccounts>\n         <AutoLogon>\n            <Password>\n               <Value>@@{LOCAL.secret}@@<\/Value>\n               <PlainText>true<\/PlainText>\n            <\/Password>\n            <Enabled>true<\/Enabled>\n            <Username>Administrator<\/Username>\n         <\/AutoLogon>\n         <FirstLogonCommands>\n            <SynchronousCommand wcm:action=\"add\">\n               <CommandLine>cmd.exe \/c netsh firewall add portopening TCP 5985 \"Port 5985\"<\/CommandLine>\n               <Description>Win RM port open<\/Description>\n               <Order>1<\/Order>\n               <RequiresUserInput>true<\/RequiresUserInput>\n            <\/SynchronousCommand>\n         <\/FirstLogonCommands>\n         <OOBE>\n            <HideEULAPage>true<\/HideEULAPage>\n            <SkipMachineOOBE>true<\/SkipMachineOOBE>\n         <\/OOBE>\n      <\/component>\n      <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Microsoft-Windows-International-Core\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n         <InputLocale>en-US<\/InputLocale>\n         <SystemLocale>en-US<\/SystemLocale>\n         <UILanguageFallback>en-us<\/UILanguageFallback>\n         <UILanguage>en-US<\/UILanguage>\n         <UserLocale>en-US<\/UserLocale>\n      <\/component>\n   <\/settings>\n<\/unattend>","type":""}},"type":"","boot_config":{"boot_device":{"type":"","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"WindowsServer2016.qcow2","uuid":"5c93e8c5-cad2-4b3e-bdea-10062795634d"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}}},{"data_source_reference":{"kind":"image","type":"","name":"SQLServer2014SP2-FullSlipstream-x64-ENU","uuid":"a2b648c0-fb1f-4380-8371-07ebe54b00a3"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","device_type":"CDROM","disk_address":{"adapter_type":"IDE","device_index":1,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":51200,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":2,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":153600,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":3,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":307200,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":4,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":307200,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":5,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":102400,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":6,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":102400,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":7,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":204800,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":8,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":204800,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":9,"type":""}}}]}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Provision_f5f34d48_5ed8_4796_93b3_5e273294ea9d"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"ffd229a4-d333-4a93-8da6-26bc1269b00b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_MSSQL_f5f34d48_5ed8_4796_93b3_5e273294ea9d"}],"description":"","message_list":[],"uuid":"803758c0-9ee6-4ced-a11c-2a8d6cdd494d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"f00bcd4f-46bc-4666-bc64-cb1df3740767"},"name":"SYS_GEN__Runbook_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d"}},{"description":"System action for powering on an application","message_list":[],"uuid":"7dea6f15-def3-46d5-9081-c24935a2cfe2","name":"action_poweron","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"DAG","uuid":"8b77c4aa-ecae-48dd-a025-5d6cd5f72d06","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOn_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"91d696da-3d09-4072-8a95-c43bea23c699"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_MSSQL_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"28900156-d6fe-464f-8cbe-43032b94aad9"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOn_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"91d696da-3d09-4072-8a95-c43bea23c699"},"edge_type":"inherent","type":"","uuid":"3092eb9d-3467-4331-ac2b-a04dabcf1a1a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_MSSQL_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"28900156-d6fe-464f-8cbe-43032b94aad9"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"91d696da-3d09-4072-8a95-c43bea23c699","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_PowerOn_f5f34d48_5ed8_4796_93b3_5e273294ea9d"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"28900156-d6fe-464f-8cbe-43032b94aad9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_MSSQL_f5f34d48_5ed8_4796_93b3_5e273294ea9d"}],"description":"","message_list":[],"uuid":"97413935-3cdc-4194-948e-1dad64188b26","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"8b77c4aa-ecae-48dd-a025-5d6cd5f72d06"},"name":"SYS_GEN__Runbook_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d"}},{"description":"System action for restarting an application","message_list":[],"uuid":"ad8fb525-97da-434c-8438-391e92871b17","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"DAG","uuid":"94585f2d-f1a6-4bd7-891e-119fbb500661","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_Restart_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"4c1a464b-adb6-4489-8884-2ebe34f829a2"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_MSSQL_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"844887ab-02a5-4a15-9525-3748a4827501"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_Restart_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"4c1a464b-adb6-4489-8884-2ebe34f829a2"},"edge_type":"inherent","type":"","uuid":"0f62e878-ea56-4e8b-85c5-306c9ef852f8","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_MSSQL_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"844887ab-02a5-4a15-9525-3748a4827501"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"4c1a464b-adb6-4489-8884-2ebe34f829a2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_Restart_f5f34d48_5ed8_4796_93b3_5e273294ea9d"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"844887ab-02a5-4a15-9525-3748a4827501","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_MSSQL_f5f34d48_5ed8_4796_93b3_5e273294ea9d"}],"description":"","message_list":[],"uuid":"dcfcf74a-01dc-42e8-a6f8-3c7a1a0a06dc","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"94585f2d-f1a6-4bd7-891e-119fbb500661"},"name":"SYS_GEN__Runbook_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d"}},{"description":"System action for suspending an application","message_list":[],"uuid":"1f8b8cb9-a96f-4ac5-815e-8548989053db","name":"action_suspend","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"DAG","uuid":"e68f7031-5e9f-4916-90fe-99fbaa889b1a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d"}],"description":"","message_list":[],"uuid":"630ebcf6-8c6e-4d11-9882-23a4e0ea8222","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"e68f7031-5e9f-4916-90fe-99fbaa889b1a"},"name":"SYS_GEN__Runbook_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d"}},{"description":"System action for modifying an application","message_list":[],"uuid":"65defe6c-20a2-4f9d-90ae-654ef0508cd7","name":"action_modify","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"DAG","uuid":"bf20aade-cf54-41a9-9672-aeadf07332bd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d"}],"description":"","message_list":[],"uuid":"cd97ef79-c464-4fa4-afa3-1ad740914d52","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"bf20aade-cf54-41a9-9672-aeadf07332bd"},"name":"SYS_GEN__Runbook_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d"}},{"description":"System action for powering off an application","message_list":[],"uuid":"4f7fe0d5-9d79-4c44-ac94-71ad46ddc345","name":"action_poweroff","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"DAG","uuid":"536a3afe-d483-4f8c-ad81-aa11b35f4e2e","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOff_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"ef3e4a46-2f7a-4078-a12a-d3a058c8ddfe"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"ef3e4a46-2f7a-4078-a12a-d3a058c8ddfe","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_PowerOff_f5f34d48_5ed8_4796_93b3_5e273294ea9d"}],"description":"","message_list":[],"uuid":"bd69aa0d-b241-48f7-9acc-b1ec48547ed0","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"536a3afe-d483-4f8c-ad81-aa11b35f4e2e"},"name":"SYS_GEN__Runbook_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"e641b02f-a3cd-4b05-a643-1259fea203a9","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"DAG","uuid":"a10afb28-cc05-4891-b7b8-346054a81276","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Delete_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"2b2db1ba-05bc-4a38-a506-6b7bbd13c2b9"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"DELETE_NUTANIX","uuid":"2b2db1ba-05bc-4a38-a506-6b7bbd13c2b9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Delete_f5f34d48_5ed8_4796_93b3_5e273294ea9d"}],"description":"","message_list":[],"uuid":"a4c61fc7-d3f9-411a-b322-82f6b76cc227","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"a10afb28-cc05-4891-b7b8-346054a81276"},"name":"SYS_GEN__Runbook_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"0857b0ad-a767-4fc3-bf00-fba8d2d83917","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"DAG","uuid":"eae847c7-b20c-4cc6-9a59-81a7b445299a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Substrate_Element_Delete_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"05afa034-6815-4783-8c87-651048e0bad8"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"05afa034-6815-4783-8c87-651048e0bad8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Substrate_Element_Delete_f5f34d48_5ed8_4796_93b3_5e273294ea9d"}],"description":"","message_list":[],"uuid":"3391fbcd-aae2-434a-8082-32d9f729915b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"eae847c7-b20c-4cc6-9a59-81a7b445299a"},"name":"SYS_GEN__Runbook_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d"}}],"message_list":[],"uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d","state":"ACTIVE","readiness_probe":{"connection_type":"POWERSHELL","retries":"5","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"30","connection_port":5985,"login_credential_local_reference":{"kind":"app_credential","name":"LOCAL","uuid":"1306b8bf-61d0-49f7-b176-acaf383a01bc"}},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":null},"create_spec":{"name":true,"resources":{"nic_list":{},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"guest_customization":true,"disk_list":{}}}},"os_type":"Windows","type":"AHV_VM","create_spec":{"name":"MSSQL-@@{calm_unique}@@","categories":"","availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"718f9bd2-7aed-43cb-9fae-fe984c162b57"},"type":""},{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"718f9bd2-7aed-43cb-9fae-fe984c162b57"},"type":""}],"parent_reference":null,"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"serial_port_list":[],"gpu_list":[],"memory_size_mib":4096,"power_state":"ON","hardware_clock_timezone":"","guest_customization":{"cloud_init":null,"type":"","sysprep":{"install_type":"PREPARED","unattend_xml":"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<unattend xmlns=\"urn:schemas-microsoft-com:unattend\">\n   <settings pass=\"specialize\">\n      <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Microsoft-Windows-Shell-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n         <ComputerName>@@{name}@@<\/ComputerName>\n         <RegisteredOrganization>Nutanix<\/RegisteredOrganization>\n         <RegisteredOwner>Acropolis<\/RegisteredOwner>\n         <TimeZone>UTC<\/TimeZone>\n      <\/component>\n      <component xmlns=\"\" name=\"Microsoft-Windows-TerminalServices-LocalSessionManager\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" processorArchitecture=\"amd64\">\n         <fDenyTSConnections>false<\/fDenyTSConnections>\n      <\/component>\n      <component xmlns=\"\" name=\"Microsoft-Windows-TerminalServices-RDP-WinStationExtensions\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" processorArchitecture=\"amd64\">\n         <UserAuthentication>0<\/UserAuthentication>\n      <\/component>\n      <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Networking-MPSSVC-Svc\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n         <FirewallGroups>\n            <FirewallGroup wcm:action=\"add\" wcm:keyValue=\"RemoteDesktop\">\n               <Active>true<\/Active>\n               <Profile>all<\/Profile>\n               <Group>@FirewallAPI.dll,-28752<\/Group>\n            <\/FirewallGroup>\n         <\/FirewallGroups>\n      <\/component>\n   <\/settings>\n   <settings pass=\"oobeSystem\">\n      <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Microsoft-Windows-Shell-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n         <UserAccounts>\n            <AdministratorPassword>\n               <Value>@@{LOCAL.secret}@@<\/Value>\n               <PlainText>true<\/PlainText>\n            <\/AdministratorPassword>\n         <\/UserAccounts>\n         <AutoLogon>\n            <Password>\n               <Value>@@{LOCAL.secret}@@<\/Value>\n               <PlainText>true<\/PlainText>\n            <\/Password>\n            <Enabled>true<\/Enabled>\n            <Username>Administrator<\/Username>\n         <\/AutoLogon>\n         <FirstLogonCommands>\n            <SynchronousCommand wcm:action=\"add\">\n               <CommandLine>cmd.exe \/c netsh firewall add portopening TCP 5985 \"Port 5985\"<\/CommandLine>\n               <Description>Win RM port open<\/Description>\n               <Order>1<\/Order>\n               <RequiresUserInput>true<\/RequiresUserInput>\n            <\/SynchronousCommand>\n         <\/FirstLogonCommands>\n         <OOBE>\n            <HideEULAPage>true<\/HideEULAPage>\n            <SkipMachineOOBE>true<\/SkipMachineOOBE>\n         <\/OOBE>\n      <\/component>\n      <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Microsoft-Windows-International-Core\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n         <InputLocale>en-US<\/InputLocale>\n         <SystemLocale>en-US<\/SystemLocale>\n         <UILanguageFallback>en-us<\/UILanguageFallback>\n         <UILanguage>en-US<\/UILanguage>\n         <UserLocale>en-US<\/UserLocale>\n      <\/component>\n   <\/settings>\n<\/unattend>","type":""}},"type":"","boot_config":{"boot_device":{"type":"","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","type":"","name":"WindowsServer2016.qcow2","uuid":"5c93e8c5-cad2-4b3e-bdea-10062795634d"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}}},{"data_source_reference":{"kind":"image","type":"","name":"SQLServer2014SP2-FullSlipstream-x64-ENU","uuid":"a2b648c0-fb1f-4380-8371-07ebe54b00a3"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","device_type":"CDROM","disk_address":{"adapter_type":"IDE","device_index":1,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":51200,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":2,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":153600,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":3,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":307200,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":4,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":307200,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":5,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":102400,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":6,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":102400,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":7,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":204800,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":8,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":204800,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":9,"type":""}}}]}},"variable_list":[],"name":"AHV_MSSQL"}],"credential_definition_list":[{"username":"administrator@mssql.com","description":"","state":"ACTIVE","message_list":[],"uuid":"6d258f96-9d6e-4896-903c-6b803e848d61","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"editables":{},"type":"PASSWORD","name":"DOMAIN_CRED"},{"username":"administrator","description":"","state":"ACTIVE","message_list":[],"uuid":"1306b8bf-61d0-49f7-b176-acaf383a01bc","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"editables":{},"type":"PASSWORD","name":"LOCAL"},{"username":"admin","description":"","state":"ACTIVE","message_list":[],"uuid":"c5acd72f-caa6-4878-a584-4dbe9fefcd70","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"editables":{},"type":"PASSWORD","name":"PE_CREDS"},{"username":"mssql\\sqlservice","description":"","state":"ACTIVE","message_list":[],"uuid":"06f26a1e-076f-4840-afc2-4066d5842824","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"editables":{},"type":"PASSWORD","name":"SQL_CREDS"}],"type":"USER","app_profile_list":[{"deployment_create_list":[{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"0f0885f0-1a13-4397-b962-83cbfbf6991d","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"retries":"0","description":"","type":"DAG","uuid":"cfe2771d-e9ed-4d80-be53-0d3cfbe6662f","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_94e0cc1c_70cf_4bec_b743_42304577db9b","uuid":"37f15be2-5f9c-45e0-8a26-bb1d689e198b"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"ee468223-4e2f-4929-8e9e-615b14c9096a"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"51b33826-bbac-4798-b947-d6a1044493f8"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"0bb727ee-16af-4d27-8675-a7f95c138eef"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"f28be830-c7cc-40b7-b2e1-25663f8b16d7"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"0bb727ee-16af-4d27-8675-a7f95c138eef"},"edge_type":"inherent","type":"","uuid":"f5865787-fa72-4ef6-9b85-588c689a28e9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"f28be830-c7cc-40b7-b2e1-25663f8b16d7"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"51b33826-bbac-4798-b947-d6a1044493f8"},"edge_type":"inherent","type":"","uuid":"c94df1b4-fc87-467d-b6ad-7785699172bc","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"0bb727ee-16af-4d27-8675-a7f95c138eef"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"ee468223-4e2f-4929-8e9e-615b14c9096a"},"edge_type":"inherent","type":"","uuid":"d3f3bd8f-a708-4821-85dd-b79f6ecc5d6b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"51b33826-bbac-4798-b947-d6a1044493f8"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_94e0cc1c_70cf_4bec_b743_42304577db9b","uuid":"37f15be2-5f9c-45e0-8a26-bb1d689e198b"},"edge_type":"inherent","type":"","uuid":"ed407171-e366-41b6-aa71-aa08abe2f0e5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"ee468223-4e2f-4929-8e9e-615b14c9096a"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_94e0cc1c_70cf_4bec_b743_42304577db9b"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"37f15be2-5f9c-45e0-8a26-bb1d689e198b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_94e0cc1c_70cf_4bec_b743_42304577db9b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ee468223-4e2f-4929-8e9e-615b14c9096a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"803758c0-9ee6-4ced-a11c-2a8d6cdd494d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"51b33826-bbac-4798-b947-d6a1044493f8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"7933e3cf-3e96-4132-8db3-3db8419bccd1"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_88b567d7_7ed0_4362_900b_06aec7b77e32"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0bb727ee-16af-4d27-8675-a7f95c138eef","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"dade7481_runbook","uuid":"900ad31c-a000-48b9-b51c-b7c546c67434"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f28be830-c7cc-40b7-b2e1-25663f8b16d7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"11876906_runbook","uuid":"e8e4abb3-204f-432b-afe9-944b40eb96ca"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b"}],"description":"","message_list":[],"uuid":"0b95c825-1c93-4b49-9f3f-6df623c35457","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_94e0cc1c_70cf_4bec_b743_42304577db9b","uuid":"cfe2771d-e9ed-4d80-be53-0d3cfbe6662f"},"name":"SYS_GEN__Runbook_Deployment_94e0cc1c_70cf_4bec_b743_42304577db9b"}},{"description":"System action for starting an application","message_list":[],"uuid":"5132b106-86ec-424a-9b4b-508414f25631","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"retries":"0","description":"","type":"DAG","uuid":"e9b86bf9-5344-44d6-868a-4fbbd94ba7b5","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"cb75075e-1374-45b0-a76c-2755a3dc1ca1"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"136c2a7b-6f75-4d30-a010-e80b0c05d82a"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"cb75075e-1374-45b0-a76c-2755a3dc1ca1"},"edge_type":"inherent","type":"","uuid":"f84c96eb-95ce-4118-8ff8-a5bcc7525f07","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"136c2a7b-6f75-4d30-a010-e80b0c05d82a"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_94e0cc1c_70cf_4bec_b743_42304577db9b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"cb75075e-1374-45b0-a76c-2755a3dc1ca1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"97413935-3cdc-4194-948e-1dad64188b26"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"136c2a7b-6f75-4d30-a010-e80b0c05d82a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"11876906_runbook","uuid":"e8e4abb3-204f-432b-afe9-944b40eb96ca"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b"}],"description":"","message_list":[],"uuid":"1543adfe-8705-48b0-8b84-afa87fe62b4a","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_94e0cc1c_70cf_4bec_b743_42304577db9b","uuid":"e9b86bf9-5344-44d6-868a-4fbbd94ba7b5"},"name":"SYS_GEN__Runbook_Deployment_94e0cc1c_70cf_4bec_b743_42304577db9b"}},{"description":"System action for restarting an application","message_list":[],"uuid":"9381c067-ee0e-4e65-9330-8e0035b6935a","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"retries":"0","description":"","type":"DAG","uuid":"7c428570-4749-4650-a481-45953ef05327","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"327bd9e9-e920-470d-97af-257c13d91a88"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"83a9af40-44fa-442a-bc9f-e03378e28925"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"327bd9e9-e920-470d-97af-257c13d91a88"},"edge_type":"inherent","type":"","uuid":"249e8ff1-7a9f-477c-b891-28dd5526b52f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"83a9af40-44fa-442a-bc9f-e03378e28925"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_94e0cc1c_70cf_4bec_b743_42304577db9b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"327bd9e9-e920-470d-97af-257c13d91a88","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"dcfcf74a-01dc-42e8-a6f8-3c7a1a0a06dc"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"83a9af40-44fa-442a-bc9f-e03378e28925","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"4150545e_runbook","uuid":"de0c2ef6-7931-43c2-8812-cf3ea6fcaca6"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b"}],"description":"","message_list":[],"uuid":"b6d668d2-9940-4950-8a32-f88416716e6a","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_94e0cc1c_70cf_4bec_b743_42304577db9b","uuid":"7c428570-4749-4650-a481-45953ef05327"},"name":"SYS_GEN__Runbook_Deployment_94e0cc1c_70cf_4bec_b743_42304577db9b"}},{"description":"System action for stopping an application","message_list":[],"uuid":"bbf40769-f919-4b47-b691-9c6147f924d4","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"retries":"0","description":"","type":"DAG","uuid":"e3ebd1ea-e3d4-4349-862e-b164ad793038","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"3e173a78-c0eb-449b-aed9-9519277ae689"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"5d792b8c-1b4c-4821-b386-7a6be53c3841"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"3e173a78-c0eb-449b-aed9-9519277ae689"},"edge_type":"inherent","type":"","uuid":"d0b36d8a-da4a-46e1-a366-e04592c6bd34","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"5d792b8c-1b4c-4821-b386-7a6be53c3841"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_94e0cc1c_70cf_4bec_b743_42304577db9b"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3e173a78-c0eb-449b-aed9-9519277ae689","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d2728354_runbook","uuid":"1f317491-b3c2-4dd3-bdc7-15aeb1e33b0a"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5d792b8c-1b4c-4821-b386-7a6be53c3841","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"bd69aa0d-b241-48f7-9acc-b1ec48547ed0"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d"}],"description":"","message_list":[],"uuid":"0069105a-5064-483c-b4e4-3e7f058fb0b5","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_94e0cc1c_70cf_4bec_b743_42304577db9b","uuid":"e3ebd1ea-e3d4-4349-862e-b164ad793038"},"name":"SYS_GEN__Runbook_Deployment_94e0cc1c_70cf_4bec_b743_42304577db9b"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"34036728-a856-4434-869a-cb9d990a7876","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"retries":"0","description":"","type":"DAG","uuid":"c58de871-8fc4-4c27-b366-c3efad7b33a5","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"26b4045e-c0a1-49fb-a6a0-086ab6faf304"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"c8fa10d9-454a-40f5-9cbc-9452b237e0c7"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"bd705551-72d1-4247-8f5b-7520b66ce424"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"446b19b2-00b7-41d4-9720-2816920dea45"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_94e0cc1c_70cf_4bec_b743_42304577db9b","uuid":"cf447fb0-5619-4d45-bb6c-4217ba6c85b1"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"26b4045e-c0a1-49fb-a6a0-086ab6faf304"},"edge_type":"inherent","type":"","uuid":"8bc07076-d4aa-4a89-9478-52b37a9b3758","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"c8fa10d9-454a-40f5-9cbc-9452b237e0c7"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"c8fa10d9-454a-40f5-9cbc-9452b237e0c7"},"edge_type":"inherent","type":"","uuid":"33284f46-2bec-48c3-bfe7-97649e551986","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"bd705551-72d1-4247-8f5b-7520b66ce424"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"bd705551-72d1-4247-8f5b-7520b66ce424"},"edge_type":"inherent","type":"","uuid":"270ceb9d-bcd1-4f9d-962a-63525d641df2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"446b19b2-00b7-41d4-9720-2816920dea45"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"446b19b2-00b7-41d4-9720-2816920dea45"},"edge_type":"inherent","type":"","uuid":"cb933f5c-aded-43d0-9e3d-6d53e442ac05","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_94e0cc1c_70cf_4bec_b743_42304577db9b","uuid":"cf447fb0-5619-4d45-bb6c-4217ba6c85b1"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_94e0cc1c_70cf_4bec_b743_42304577db9b"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"26b4045e-c0a1-49fb-a6a0-086ab6faf304","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d2728354_runbook","uuid":"1f317491-b3c2-4dd3-bdc7-15aeb1e33b0a"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c8fa10d9-454a-40f5-9cbc-9452b237e0c7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"59afb4f4_runbook","uuid":"448b8840-3dc8-408f-a3b3-75646791952c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"bd705551-72d1-4247-8f5b-7520b66ce424","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"4fc28ca0-713b-41b8-a748-264edd42e8ff"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_88b567d7_7ed0_4362_900b_06aec7b77e32"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"446b19b2-00b7-41d4-9720-2816920dea45","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"a4c61fc7-d3f9-411a-b322-82f6b76cc227"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"cf447fb0-5619-4d45-bb6c-4217ba6c85b1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_94e0cc1c_70cf_4bec_b743_42304577db9b"}],"description":"","message_list":[],"uuid":"ebdf0729-2c6a-4b3d-8641-2b3ad9bca464","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_94e0cc1c_70cf_4bec_b743_42304577db9b","uuid":"c58de871-8fc4-4c27-b366-c3efad7b33a5"},"name":"SYS_GEN__Runbook_Deployment_94e0cc1c_70cf_4bec_b743_42304577db9b"}},{"description":"System action for scaleout","message_list":[],"uuid":"965906bb-8c9c-4573-851a-524fdb4e07a2","name":"action_scaleout","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"retries":"0","description":"","type":"DAG","uuid":"23243baf-fc68-4844-be4a-7bcb9bbabb19","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scaleout_94e0cc1c_70cf_4bec_b743_42304577db9b","uuid":"c30c684d-d2da-4b53-8817-75cac788b1bc"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_94e0cc1c_70cf_4bec_b743_42304577db9b"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"retries":"0","description":"","type":"SCALING","uuid":"c30c684d-d2da-4b53-8817-75cac788b1bc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scaleout_94e0cc1c_70cf_4bec_b743_42304577db9b"}],"description":"","message_list":[],"uuid":"103b2b15-3edf-451a-be5f-3f3edadce797","state":"ACTIVE","variable_list":[{"val_type":"STRING","description":"","message_list":[],"uuid":"e811d0d9-2715-405d-b0f8-dd060699c3b7","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"type":"LOCAL","name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_94e0cc1c_70cf_4bec_b743_42304577db9b","uuid":"23243baf-fc68-4844-be4a-7bcb9bbabb19"},"name":"SYS_GEN__Runbook_Deployment_94e0cc1c_70cf_4bec_b743_42304577db9b"}},{"description":"System action for scalein","message_list":[],"uuid":"bc3374f5-aaed-412e-bbf7-5af3dcc54e3c","name":"action_scalein","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"retries":"0","description":"","type":"DAG","uuid":"dc6fe842-6150-406a-a713-b31ffee1f785","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scalein_94e0cc1c_70cf_4bec_b743_42304577db9b","uuid":"cdf2292e-b99b-4682-bfd7-0b47ffd9f9cf"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_94e0cc1c_70cf_4bec_b743_42304577db9b"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"retries":"0","description":"","type":"SCALING","uuid":"cdf2292e-b99b-4682-bfd7-0b47ffd9f9cf","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scalein_94e0cc1c_70cf_4bec_b743_42304577db9b"}],"description":"","message_list":[],"uuid":"d37adc37-03a6-4231-8dbf-adec29cf3a89","state":"ACTIVE","variable_list":[{"val_type":"STRING","description":"","message_list":[],"uuid":"cc34ed29-cd66-481c-b67a-5401d537a607","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"type":"LOCAL","name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_94e0cc1c_70cf_4bec_b743_42304577db9b","uuid":"dc6fe842-6150-406a-a713-b31ffee1f785"},"name":"SYS_GEN__Runbook_Deployment_94e0cc1c_70cf_4bec_b743_42304577db9b"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"eb241106-c00a-4d65-b5e5-bd9ef66dd048","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"retries":"0","description":"","type":"DAG","uuid":"605bcc11-e8a4-4da1-b647-266db23485d1","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"d0fb51b1-425e-49aa-955f-77f18660b64b"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"c0929de1-3134-4fa3-83b0-46f3cb0654d5"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"e92f041c-6785-45f0-b555-576d0066f658"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_94e0cc1c_70cf_4bec_b743_42304577db9b","uuid":"5f010e70-d721-4bab-84be-defb3e9219aa"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"d0fb51b1-425e-49aa-955f-77f18660b64b"},"edge_type":"inherent","type":"","uuid":"bd1309cb-fa90-4a00-8879-f68a3decfa4e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"c0929de1-3134-4fa3-83b0-46f3cb0654d5"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"e92f041c-6785-45f0-b555-576d0066f658"},"edge_type":"inherent","type":"","uuid":"4e65a6e0-673c-4ce2-8b3b-990df6efdd4a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_94e0cc1c_70cf_4bec_b743_42304577db9b","uuid":"5f010e70-d721-4bab-84be-defb3e9219aa"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"c0929de1-3134-4fa3-83b0-46f3cb0654d5"},"edge_type":"inherent","type":"","uuid":"47bcf3d4-9e72-430d-beef-61a71b512dc7","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"e92f041c-6785-45f0-b555-576d0066f658"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_94e0cc1c_70cf_4bec_b743_42304577db9b"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d0fb51b1-425e-49aa-955f-77f18660b64b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"4ed53bef-cfce-4f7b-806c-e46e1fd8dcd5"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"c0929de1-3134-4fa3-83b0-46f3cb0654d5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_88b567d7_7ed0_4362_900b_06aec7b77e32"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e92f041c-6785-45f0-b555-576d0066f658","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"3391fbcd-aae2-434a-8082-32d9f729915b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"5f010e70-d721-4bab-84be-defb3e9219aa","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_94e0cc1c_70cf_4bec_b743_42304577db9b"}],"description":"","message_list":[],"uuid":"7229909b-aaff-4527-82a7-a9f9e76dd532","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_94e0cc1c_70cf_4bec_b743_42304577db9b","uuid":"605bcc11-e8a4-4da1-b647-266db23485d1"},"name":"SYS_GEN__Runbook_Deployment_94e0cc1c_70cf_4bec_b743_42304577db9b"}}],"message_list":[],"published_service_local_reference_list":[],"uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b","min_replicas":"2","state":"ACTIVE","max_replicas":"2","depends_on_list":[],"editables":{},"package_local_reference_list":[{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"}],"substrate_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"type":"GREENFIELD","options":{},"variable_list":[],"name":"5aed8000_deployment"}],"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"2bbbdaa8-006a-4d61-8a5c-d1b99d25ed61","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"54d19394-b546-4948-8fd6-cc869fabe45b"},"retries":"0","description":"","type":"DAG","uuid":"e66801a2-982b-4fdb-8983-23e9cf20b05d","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_94e0cc1c_70cf_4bec_b743_42304577db9b","uuid":"d621f1a6-d6b5-41df-8742-e71dde397028"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"1475050f-9428-47e5-af34-05a9ecf467f5"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"437b2f2e-1e50-494f-a4c1-8ee9e870836d"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"a88c9c91-2e9d-4f33-9c83-841b4ffc4acc"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"5873218c-722b-4755-a674-959bf174d403"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"a88c9c91-2e9d-4f33-9c83-841b4ffc4acc"},"edge_type":"inherent","type":"","uuid":"313dc966-7813-41ec-8296-4e01fccb1ddf","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"5873218c-722b-4755-a674-959bf174d403"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"437b2f2e-1e50-494f-a4c1-8ee9e870836d"},"edge_type":"inherent","type":"","uuid":"eeb76e88-4957-4efd-b0fa-b7e08d402e40","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"a88c9c91-2e9d-4f33-9c83-841b4ffc4acc"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"1475050f-9428-47e5-af34-05a9ecf467f5"},"edge_type":"inherent","type":"","uuid":"de49d318-15be-4d61-a0e2-962680fe8f75","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"437b2f2e-1e50-494f-a4c1-8ee9e870836d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_94e0cc1c_70cf_4bec_b743_42304577db9b","uuid":"d621f1a6-d6b5-41df-8742-e71dde397028"},"edge_type":"inherent","type":"","uuid":"d14c5dd0-8b08-4adb-bb44-7609b596f70a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"1475050f-9428-47e5-af34-05a9ecf467f5"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_54d19394_b546_4948_8fd6_cc869fabe45b"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"d621f1a6-d6b5-41df-8742-e71dde397028","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_94e0cc1c_70cf_4bec_b743_42304577db9b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1475050f-9428-47e5-af34-05a9ecf467f5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"803758c0-9ee6-4ced-a11c-2a8d6cdd494d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"437b2f2e-1e50-494f-a4c1-8ee9e870836d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"7933e3cf-3e96-4132-8db3-3db8419bccd1"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_88b567d7_7ed0_4362_900b_06aec7b77e32"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a88c9c91-2e9d-4f33-9c83-841b4ffc4acc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"dade7481_runbook","uuid":"900ad31c-a000-48b9-b51c-b7c546c67434"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5873218c-722b-4755-a674-959bf174d403","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"11876906_runbook","uuid":"e8e4abb3-204f-432b-afe9-944b40eb96ca"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b"}],"description":"","message_list":[],"uuid":"760f6d5d-b527-49f5-828e-9ad373fa5974","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_54d19394_b546_4948_8fd6_cc869fabe45b","uuid":"e66801a2-982b-4fdb-8983-23e9cf20b05d"},"name":"SYS_GEN__Runbook_Application_54d19394_b546_4948_8fd6_cc869fabe45b"}},{"description":"System action for starting an application","message_list":[],"uuid":"712e2971-d07e-4ecd-9165-b44b2e41b28d","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"54d19394-b546-4948-8fd6-cc869fabe45b"},"retries":"0","description":"","type":"DAG","uuid":"8a033a59-2334-4611-afe3-b00dbf7cf54a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"6fb05cfb-a1cd-4df1-a4cd-80599ae46bab"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"5aad2e0f-ef45-4f9a-8fb9-f7270887e8bf"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"6fb05cfb-a1cd-4df1-a4cd-80599ae46bab"},"edge_type":"inherent","type":"","uuid":"fce17c81-c4ec-4beb-9a2f-b482495dc058","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"5aad2e0f-ef45-4f9a-8fb9-f7270887e8bf"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_54d19394_b546_4948_8fd6_cc869fabe45b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6fb05cfb-a1cd-4df1-a4cd-80599ae46bab","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"97413935-3cdc-4194-948e-1dad64188b26"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5aad2e0f-ef45-4f9a-8fb9-f7270887e8bf","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"11876906_runbook","uuid":"e8e4abb3-204f-432b-afe9-944b40eb96ca"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b"}],"description":"","message_list":[],"uuid":"07ee4572-cfa9-428b-9f51-15262ed22a88","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_54d19394_b546_4948_8fd6_cc869fabe45b","uuid":"8a033a59-2334-4611-afe3-b00dbf7cf54a"},"name":"SYS_GEN__Runbook_Application_54d19394_b546_4948_8fd6_cc869fabe45b"}},{"description":"System action for restarting an application","message_list":[],"uuid":"0c16004a-186f-437c-87bf-d1af96cdaf8c","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"54d19394-b546-4948-8fd6-cc869fabe45b"},"retries":"0","description":"","type":"DAG","uuid":"857fd09c-8af8-43be-a7b4-3eb3c2ec687a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"df26f572-a3fb-4ec4-a479-f89c4ac7f02e"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"ce5b51c5-11df-4a83-ade6-9388b6882c11"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"df26f572-a3fb-4ec4-a479-f89c4ac7f02e"},"edge_type":"inherent","type":"","uuid":"3daffe1f-01c8-4513-8a71-5e15d9a35cb9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"ce5b51c5-11df-4a83-ade6-9388b6882c11"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_54d19394_b546_4948_8fd6_cc869fabe45b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"df26f572-a3fb-4ec4-a479-f89c4ac7f02e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"dcfcf74a-01dc-42e8-a6f8-3c7a1a0a06dc"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ce5b51c5-11df-4a83-ade6-9388b6882c11","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"4150545e_runbook","uuid":"de0c2ef6-7931-43c2-8812-cf3ea6fcaca6"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b"}],"description":"","message_list":[],"uuid":"df4f0d56-f798-4cb7-bda6-0c0d54df31c3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_54d19394_b546_4948_8fd6_cc869fabe45b","uuid":"857fd09c-8af8-43be-a7b4-3eb3c2ec687a"},"name":"SYS_GEN__Runbook_Application_54d19394_b546_4948_8fd6_cc869fabe45b"}},{"description":"System action for stopping an application","message_list":[],"uuid":"6e1ad9b7-e5c9-4156-ae7d-258be1391040","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"54d19394-b546-4948-8fd6-cc869fabe45b"},"retries":"0","description":"","type":"DAG","uuid":"af9221da-2adc-4d09-a61a-6cb94e674b74","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"bb438c3e-a5bc-46f4-92c1-d8395e7bbb5b"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"cb240193-bc15-4619-8568-15e3d8726d2f"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"bb438c3e-a5bc-46f4-92c1-d8395e7bbb5b"},"edge_type":"inherent","type":"","uuid":"18590fb1-a18d-49ba-a744-c1b966758e21","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"cb240193-bc15-4619-8568-15e3d8726d2f"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_54d19394_b546_4948_8fd6_cc869fabe45b"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"bb438c3e-a5bc-46f4-92c1-d8395e7bbb5b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d2728354_runbook","uuid":"1f317491-b3c2-4dd3-bdc7-15aeb1e33b0a"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"cb240193-bc15-4619-8568-15e3d8726d2f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"bd69aa0d-b241-48f7-9acc-b1ec48547ed0"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d"}],"description":"","message_list":[],"uuid":"b4a8d036-a8e7-4be0-8a34-8de86d1eb1fb","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_54d19394_b546_4948_8fd6_cc869fabe45b","uuid":"af9221da-2adc-4d09-a61a-6cb94e674b74"},"name":"SYS_GEN__Runbook_Application_54d19394_b546_4948_8fd6_cc869fabe45b"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"0e66d2ac-e91e-4963-a27a-313b05fe81be","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"54d19394-b546-4948-8fd6-cc869fabe45b"},"retries":"0","description":"","type":"DAG","uuid":"b63b0684-402d-4838-8308-cc3f7f1a75e8","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"0f895b7e-25ea-4e86-9d35-47291e4c2c12"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"dc1c453a-ff65-4279-8f8f-6c2df28e0695"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"2367485f-0e6a-4c70-bfb8-68c3e701e308"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"65f49d16-8d32-4c12-a96d-4cf44e9da461"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_94e0cc1c_70cf_4bec_b743_42304577db9b","uuid":"0a78aeda-1c9c-4374-adf8-49e0e897b0cc"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"0f895b7e-25ea-4e86-9d35-47291e4c2c12"},"edge_type":"inherent","type":"","uuid":"2d5a7eec-83b9-43c3-b5df-6373c0ea2241","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"dc1c453a-ff65-4279-8f8f-6c2df28e0695"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"dc1c453a-ff65-4279-8f8f-6c2df28e0695"},"edge_type":"inherent","type":"","uuid":"73495ae3-0b46-4506-ae80-2bd3e54b2ef7","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"2367485f-0e6a-4c70-bfb8-68c3e701e308"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"2367485f-0e6a-4c70-bfb8-68c3e701e308"},"edge_type":"inherent","type":"","uuid":"5149b44b-4de4-4b09-91a0-4d843b2cd752","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"65f49d16-8d32-4c12-a96d-4cf44e9da461"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"65f49d16-8d32-4c12-a96d-4cf44e9da461"},"edge_type":"inherent","type":"","uuid":"74256535-1b7e-4647-9499-a3a2f5c9c1f4","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_94e0cc1c_70cf_4bec_b743_42304577db9b","uuid":"0a78aeda-1c9c-4374-adf8-49e0e897b0cc"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_54d19394_b546_4948_8fd6_cc869fabe45b"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0f895b7e-25ea-4e86-9d35-47291e4c2c12","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d2728354_runbook","uuid":"1f317491-b3c2-4dd3-bdc7-15aeb1e33b0a"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"dc1c453a-ff65-4279-8f8f-6c2df28e0695","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"59afb4f4_runbook","uuid":"448b8840-3dc8-408f-a3b3-75646791952c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2367485f-0e6a-4c70-bfb8-68c3e701e308","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"4fc28ca0-713b-41b8-a748-264edd42e8ff"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_88b567d7_7ed0_4362_900b_06aec7b77e32"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"65f49d16-8d32-4c12-a96d-4cf44e9da461","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"a4c61fc7-d3f9-411a-b322-82f6b76cc227"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"0a78aeda-1c9c-4374-adf8-49e0e897b0cc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_94e0cc1c_70cf_4bec_b743_42304577db9b"}],"description":"","message_list":[],"uuid":"d2033b90-6822-464b-82d7-6c9fc0f308d6","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_54d19394_b546_4948_8fd6_cc869fabe45b","uuid":"b63b0684-402d-4838-8308-cc3f7f1a75e8"},"name":"SYS_GEN__Runbook_Application_54d19394_b546_4948_8fd6_cc869fabe45b"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"b03b3cb3-6693-493a-a00d-764f32f63506","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"54d19394-b546-4948-8fd6-cc869fabe45b"},"retries":"0","description":"","type":"DAG","uuid":"feaa9271-4137-45dd-a716-e0883b7a8e4b","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"f6faa0db-d91c-4b9e-ac49-0593ceb7b235"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"a31e9f16-e9ce-4490-94fa-da1d1686c51b"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"8a12cdab-8626-4932-9528-7622fc6b6d94"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_94e0cc1c_70cf_4bec_b743_42304577db9b","uuid":"ee7d43d2-69ff-4635-ae5e-6cd22d0c339a"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"f6faa0db-d91c-4b9e-ac49-0593ceb7b235"},"edge_type":"inherent","type":"","uuid":"1979b937-2f87-49cf-ba75-494edaa8f159","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"a31e9f16-e9ce-4490-94fa-da1d1686c51b"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"8a12cdab-8626-4932-9528-7622fc6b6d94"},"edge_type":"inherent","type":"","uuid":"a277468b-a411-4880-993a-834a0a4fcf71","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_94e0cc1c_70cf_4bec_b743_42304577db9b","uuid":"ee7d43d2-69ff-4635-ae5e-6cd22d0c339a"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"a31e9f16-e9ce-4490-94fa-da1d1686c51b"},"edge_type":"inherent","type":"","uuid":"a4dd96af-164a-4ee8-8128-e60bc5ac3e48","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"8a12cdab-8626-4932-9528-7622fc6b6d94"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_54d19394_b546_4948_8fd6_cc869fabe45b"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f6faa0db-d91c-4b9e-ac49-0593ceb7b235","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"4ed53bef-cfce-4f7b-806c-e46e1fd8dcd5"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"a31e9f16-e9ce-4490-94fa-da1d1686c51b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_88b567d7_7ed0_4362_900b_06aec7b77e32"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8a12cdab-8626-4932-9528-7622fc6b6d94","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d","uuid":"3391fbcd-aae2-434a-8082-32d9f729915b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_f5f34d48_5ed8_4796_93b3_5e273294ea9d"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"5aed8000_deployment","uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"ee7d43d2-69ff-4635-ae5e-6cd22d0c339a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_94e0cc1c_70cf_4bec_b743_42304577db9b"}],"description":"","message_list":[],"uuid":"1e791897-face-4432-8c2c-308dcaedb32f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_54d19394_b546_4948_8fd6_cc869fabe45b","uuid":"feaa9271-4137-45dd-a716-e0883b7a8e4b"},"name":"SYS_GEN__Runbook_Application_54d19394_b546_4948_8fd6_cc869fabe45b"}}],"message_list":[],"uuid":"54d19394-b546-4948-8fd6-cc869fabe45b","state":"ACTIVE","dependency_list":[],"variable_list":[{"val_type":"STRING","description":"","message_list":[],"uuid":"c5c2efe4-0d7d-414c-aa0e-9663105b30e4","value":"10.46.6.4","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"AD_IP"},{"val_type":"STRING","description":"","message_list":[],"uuid":"467de542-9f10-47ef-8ca9-a323c4abee51","value":"http:\/\/download.microsoft.com\/download\/8\/e\/c\/8ec3a7d8-05b4-440a-a71e-ca3ee25fe057\/rktools.exe","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"BPG_RKTOOLS_URL"},{"val_type":"STRING","description":"","message_list":[],"uuid":"9d436195-e583-4aaf-9e2b-6b9d6f128997","value":"default-container-71229","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"CONTAINER_NAME"},{"val_type":"STRING","description":"","message_list":[],"uuid":"4fb7334b-7f13-4285-9884-ce56a377364c","value":"mssql.com","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"DOMAIN"},{"val_type":"STRING","description":"","message_list":[],"uuid":"015b3141-4d26-4021-87cd-0c857afe4136","value":"NTNX-CLS01","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"FAILOVER_CLUSTER_NAME"},{"val_type":"STRING","description":"","message_list":[],"uuid":"ae8e0956-2314-4a5b-9e01-6f4ac3b50ed9","value":"10.46.136.9","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"FAILOVER_VIP"},{"val_type":"STRING","description":"","message_list":[],"uuid":"47cf9691-da0f-4d18-90be-bcf89885a8d0","value":"10.46.136.10","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"MSSQL_VIP"},{"val_type":"STRING","description":"","message_list":[],"uuid":"b0ffec11-870c-4343-a749-be5e129214b2","value":"10.46.32.5","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"PE_DATA_SERVICE_IP"},{"val_type":"STRING","description":"","message_list":[],"uuid":"ae991897-675b-4406-a214-c6f84f22c0fb","value":"10.46.32.4","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"PE_IP"},{"val_type":"STRING","description":"","message_list":[],"uuid":"fbef9d71-80e3-4d94-ab87-92d461f4bc51","value":"NTNX-SQLCLS01","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"SQL_CLUSTER_NAME"},{"val_type":"STRING","description":"","message_list":[],"uuid":"90c2a8e5-5a5c-41d8-b236-647e3f29cd51","value":"SQL_VolumeGroup01","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"VG_NAME"}],"name":"Nutanix"}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"LOCAL","uuid":"1306b8bf-61d0-49f7-b176-acaf383a01bc"},"package_definition_list":[{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"75aa2a8b-6361-4822-8f46-99dd7baad0fa","name":"action_install","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","description":"","type":"DAG","uuid":"b52eed11-0e52-4e9d-9db1-97fbd7fb20ce","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Install_Crb_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"69ae3979-bbf6-40e5-b462-28543295c8f7"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_88b567d7_7ed0_4362_900b_06aec7b77e32"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_INSTALL","uuid":"69ae3979-bbf6-40e5-b462-28543295c8f7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","description":"","type":"DAG","uuid":"0660260c-5415-4a23-90e0-ceb0af24dbfb","child_tasks_local_reference_list":[{"kind":"app_task","name":"Apply OS BPG","uuid":"c5c03e88-dd51-4252-ae67-bcece8e0ab3e"},{"kind":"app_task","name":"Apply SQL BPG","uuid":"dabbb680-d05c-408d-9063-310b308a0bfb"},{"kind":"app_task","name":"Attach VG","uuid":"28d71afc-ce41-4154-a78f-c05337f3f60b"},{"kind":"app_task","name":"Configure WSFC","uuid":"957b3f6a-bd01-479f-8635-ae43c7aea0fa"},{"kind":"app_task","name":"Connect Mount VG","uuid":"c3d7de2c-6488-4be0-82ce-01ddd8bea78b"},{"kind":"app_task","name":"Create AAG","uuid":"fc643ea4-2ad8-4e16-8171-67d254e23543"},{"kind":"app_task","name":"Create VG","uuid":"c48f54e3-eb21-4418-bd2d-f5623208e84a"},{"kind":"app_task","name":"Enable AAG","uuid":"7991a817-2640-4c3a-813a-611b3ae09452"},{"kind":"app_task","name":"Get IQN","uuid":"0f4471ce-096e-469e-9f69-c9339d1067f0"},{"kind":"app_task","name":"Install FC","uuid":"d8c7a910-e915-4093-8b29-9891952a2b60"},{"kind":"app_task","name":"Install SQL","uuid":"3229ae0a-055e-4faf-ad5e-d0935fdf98ad"},{"kind":"app_task","name":"JoinDomain","uuid":"39bb7402-9ada-4ee1-a348-ad63df7d1407"},{"kind":"app_task","name":"Pre Requisites","uuid":"64d06e54-4d78-42ea-b723-2d77cc9f3a18"},{"kind":"app_task","name":"Sleep","uuid":"113beadd-e1ca-43f8-8cbf-c65d49852086"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Apply OS BPG","uuid":"c5c03e88-dd51-4252-ae67-bcece8e0ab3e"},"edge_type":"user_defined","type":"","uuid":"2d34f974-796f-4404-aaf6-e219f16d8d48","to_task_reference":{"kind":"app_task","name":"Apply SQL BPG","uuid":"dabbb680-d05c-408d-9063-310b308a0bfb"}},{"from_task_reference":{"kind":"app_task","name":"Apply SQL BPG","uuid":"dabbb680-d05c-408d-9063-310b308a0bfb"},"edge_type":"user_defined","type":"","uuid":"c50d59ad-d9a3-4480-9373-9058e7c83326","to_task_reference":{"kind":"app_task","name":"Enable AAG","uuid":"7991a817-2640-4c3a-813a-611b3ae09452"}},{"from_task_reference":{"kind":"app_task","name":"Attach VG","uuid":"28d71afc-ce41-4154-a78f-c05337f3f60b"},"edge_type":"user_defined","type":"","uuid":"54f08b1a-952e-4bc9-bf97-c3c4d0888b2a","to_task_reference":{"kind":"app_task","name":"Connect Mount VG","uuid":"c3d7de2c-6488-4be0-82ce-01ddd8bea78b"}},{"from_task_reference":{"kind":"app_task","name":"Configure WSFC","uuid":"957b3f6a-bd01-479f-8635-ae43c7aea0fa"},"edge_type":"user_defined","type":"","uuid":"b606ee4a-ae92-4202-812b-3ba226cebe4f","to_task_reference":{"kind":"app_task","name":"Install SQL","uuid":"3229ae0a-055e-4faf-ad5e-d0935fdf98ad"}},{"from_task_reference":{"kind":"app_task","name":"Connect Mount VG","uuid":"c3d7de2c-6488-4be0-82ce-01ddd8bea78b"},"edge_type":"user_defined","type":"","uuid":"4f68e321-7344-4105-bd6c-cb4e096e234c","to_task_reference":{"kind":"app_task","name":"Install FC","uuid":"d8c7a910-e915-4093-8b29-9891952a2b60"}},{"from_task_reference":{"kind":"app_task","name":"Create VG","uuid":"c48f54e3-eb21-4418-bd2d-f5623208e84a"},"edge_type":"user_defined","type":"","uuid":"8779cffa-a21b-4237-b24c-840979efbcb3","to_task_reference":{"kind":"app_task","name":"Get IQN","uuid":"0f4471ce-096e-469e-9f69-c9339d1067f0"}},{"from_task_reference":{"kind":"app_task","name":"Enable AAG","uuid":"7991a817-2640-4c3a-813a-611b3ae09452"},"edge_type":"user_defined","type":"","uuid":"fe6eb75d-f47b-4dae-a3d6-15e080edc2a8","to_task_reference":{"kind":"app_task","name":"Create AAG","uuid":"fc643ea4-2ad8-4e16-8171-67d254e23543"}},{"from_task_reference":{"kind":"app_task","name":"Get IQN","uuid":"0f4471ce-096e-469e-9f69-c9339d1067f0"},"edge_type":"user_defined","type":"","uuid":"507f52e7-63aa-45fc-a20c-dab8161d202b","to_task_reference":{"kind":"app_task","name":"Attach VG","uuid":"28d71afc-ce41-4154-a78f-c05337f3f60b"}},{"from_task_reference":{"kind":"app_task","name":"Install FC","uuid":"d8c7a910-e915-4093-8b29-9891952a2b60"},"edge_type":"user_defined","type":"","uuid":"3e887ae6-5f7b-4131-959d-1f77a70860b6","to_task_reference":{"kind":"app_task","name":"Configure WSFC","uuid":"957b3f6a-bd01-479f-8635-ae43c7aea0fa"}},{"from_task_reference":{"kind":"app_task","name":"Install SQL","uuid":"3229ae0a-055e-4faf-ad5e-d0935fdf98ad"},"edge_type":"user_defined","type":"","uuid":"511c3306-d33d-46f8-b448-40bdeb29ca1c","to_task_reference":{"kind":"app_task","name":"Apply OS BPG","uuid":"c5c03e88-dd51-4252-ae67-bcece8e0ab3e"}},{"from_task_reference":{"kind":"app_task","name":"JoinDomain","uuid":"39bb7402-9ada-4ee1-a348-ad63df7d1407"},"edge_type":"user_defined","type":"","uuid":"811570cd-e8e9-4224-b0b8-f1192f6f4029","to_task_reference":{"kind":"app_task","name":"Sleep","uuid":"113beadd-e1ca-43f8-8cbf-c65d49852086"}},{"from_task_reference":{"kind":"app_task","name":"Pre Requisites","uuid":"64d06e54-4d78-42ea-b723-2d77cc9f3a18"},"edge_type":"user_defined","type":"","uuid":"ce840774-6c6d-4ab5-a88c-2e60adf14037","to_task_reference":{"kind":"app_task","name":"JoinDomain","uuid":"39bb7402-9ada-4ee1-a348-ad63df7d1407"}},{"from_task_reference":{"kind":"app_task","name":"Sleep","uuid":"113beadd-e1ca-43f8-8cbf-c65d49852086"},"edge_type":"user_defined","type":"","uuid":"e8d271d6-3557-4c67-bdaf-51f925debda2","to_task_reference":{"kind":"app_task","name":"Create VG","uuid":"c48f54e3-eb21-4418-bd2d-f5623208e84a"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ddaf74d2_dag"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"c5c03e88-dd51-4252-ae67-bcece8e0ab3e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"$start_time = Get-Date\n\n$TempDirectory = \"C:\\Temp\"\n$RktTemp = \"$TempDirectory\\rktools.2003\"\n\n$url = \"@@{BPG_RKTOOLS_URL}@@\"\n$filePath = \"$TempDirectory\\rktools.exe\"\n\nNew-Item -ItemType Directory -Force -Path $TempDirectory\n(New-Object System.Net.WebClient).DownloadFile($url,$filePath)\n\n& $filePath \/Q \/T:\"$RktTemp\" \/C\n\nStart-Sleep 10\n\n$PackageName = \"rktools.2003\"\n$setupPath = \"C:\\Windows\\System32\\msiexec.exe\"\n$silentArgs = \"\/i $RktTemp\\rktools.msi \/qn\"\n$validExitCodes = @(0)\n\nWrite-Output \"Installing $PackageName....\"\n\n$install = Start-Process -FilePath $setupPath -ArgumentList $silentArgs -Wait -NoNewWindow -PassThru\n$install.WaitForExit()\n\n$exitCode = $install.ExitCode\n$install.Dispose()\n\nWrite-Output \"Command [`\"$setupPath`\" $silentArgs] exited with `'$exitCode`'.\"\nif ($validExitCodes -notcontains $exitCode) {\n\tWrite-Output \"Running [`\"$setupPath`\" $silentArgs] was not successful. Exit code was '$exitCode'. See log for possible error messages.\"\n\texit 1\n}\n\n# OS related tunning\n# Set Windows Power Options to High Performance\npowercfg -s 8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c\n\n#Grant Memory privileges to user \n$ntrights_cli = \"C:\\Program Files (x86)\\Windows Resource Kits\\Tools\\ntrights.exe\"\n& $ntrights_cli -u \"NT SERVICE\\MSSQLSERVER\" +r SeLockMemoryPrivilege\n& $ntrights_cli -u \"NT SERVICE\\MSSQLSERVER\" +r SeManageVolumePrivilege\n\nWrite-Output \"Time taken: $((Get-Date).Subtract($start_time).seconds) Second(s)\"","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"6d258f96-9d6e-4896-903c-6b803e848d61"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Apply OS BPG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"dabbb680-d05c-408d-9063-310b308a0bfb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"$start_time = Get-Date\n\n$TempDirectory = \"C:\\Temp\"\n$sqladdparms_cli = \"$TempDirectory\\Add-SqlServerStartupParameter.ps1\"\n$TSQLSCRIPTSDIR = \"$TempDirectory\\TSQL_Scripts\"\nNew-Item -ItemType Directory -Force -Path $TSQLSCRIPTSDIR\n  \nSet-Content -Path \"$sqladdparms_cli\" -Value '\nparam(\n    ## The parameter you wish to add\n    [Parameter(Mandatory = $true)]\n    $StartupParameter\n)\n\n$hklmRootNode = \"HKLM:\\SOFTWARE\\Microsoft\\Microsoft SQL Server\"\n\n$props = Get-ItemProperty \"$hklmRootNode\\Instance Names\\SQL\"\n$instances = $props.psobject.properties | ?{$_.Value -like \"MSSQL*\"} | select Value\n\n$instances | %{\n    $inst = $_.Value;\n    $regKey = \"$hklmRootNode\\$inst\\MSSQLServer\\Parameters\"\n    $props = Get-ItemProperty $regKey\n    $params = $props.psobject.properties | ?{$_.Name -like \"SQLArg*\"} | select Name, Value\n    #$params | ft -AutoSize\n    $hasFlag = $false\n    foreach ($param in $params) {\n        if($param.Value -eq $StartupParameter) {\n            $hasFlag = $true\n            break;\n        }\n    }\n    if (-not $hasFlag) {\n        \"Adding $StartupParameter\"\n        $newRegProp = \"SQLArg\"+($params.Count)\n        Set-ItemProperty -Path $regKey -Name $newRegProp -Value $StartupParameter\n    } else {\n        \"$StartupParameter already set\"\n    }\n}'\nSet-Content -Path \"$TSQLSCRIPTSDIR\\01-ChangeTempDB.sql\" -Value \"use master`r`n\ngo`r`n\nAlter database tempdb modify file (name = tempdev, filename = 'I:\\TEMPDB01\\tempdb01.mdf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb modify file (name = templog, filename = 'T:\\TempDB-logs01\\templog01.ldf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb ADD file (name = tempdev02, filename = 'I:\\TEMPDB01\\tempdb02.ndf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb ADD file (name = tempdev03, filename = 'J:\\TEMPDB02\\tempdb03.ndf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb ADD file (name = tempdev04, filename = 'J:\\TEMPDB02\\tempdb04.ndf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\n`r`n\nALTER DATABASE [tempdb] MODIFY FILE (NAME=N'tempdev', NEWNAME=N'tempdev01')`r`n\nGO`r`n\nALTER DATABASE [tempdb] MODIFY FILE (NAME=N'templog', NEWNAME=N'templog01')`r`n\nGO\"\n\nSet-Content -Path \"$TSQLSCRIPTSDIR\\02-IncreaseTempDB_logs.sql\" -Value \"Use master`r`n\ngo`r`n\nALTER DATABASE tempdb MODIFY FILE (NAME = templog01, filename = 'T:\\TempDB-logs01\\templog01.ldf', SIZE`r`n\n= 8096);`r`n\nGO`r`n\nALTER DATABASE tempdb MODIFY FILE (NAME = templog01, FILENAME = 'T:\\TempDB-logs01\\templog01.ldf', SIZE`r`n\n= 12288);`r`n\nGO\"\n\nSet-Content -Path \"$TSQLSCRIPTSDIR\\03-SQL_set_memory.sql\" -Value \"USE master;`r`n\nexec sp_configure 'show advanced options', 1;`r`n\nRECONFIGURE;`r`n\nGO`r`n\nDECLARE `r`n\n        @total_mem decimal (10,0),`r`n\n\t\t@min int,`r`n\n\t\t@max int`r`n\nSELECT `r`n\n   --SELECT (physical_memory_kb\/1024) AS Server_Physical_Memory_MB`r`n\n  @total_mem = (physical_memory_kb\/1024)`r`n\nFROM sys.dm_os_sys_info`r`n\n`r`n\nset @min = @total_mem * 0.1`r`n\nset @max = @total_mem * 0.85`r`n\nprint @min`r`n\nprint @max`r`n\n--print @total_mem`r`n\n`r`n\n`r`n\nEXEC sp_configure 'min server memory (MB)',@min`r`n\nEXEC sp_configure 'max server memory (MB)',@max`r`n\nRECONFIGURE\"\n\nSet-Content -Path \"$TSQLSCRIPTSDIR\\04-SQL-ChangeDefaultPaths.sql\" -Value \"USE [master]`r`n\nGO`r`n\n-- Change default location for data files`r`n\nEXEC xp_instance_regwrite`r`n\nN'HKEY_LOCAL_MACHINE',`r`n\nN'Software\\Microsoft\\MSSQLServer\\MSSQLServer',`r`n\nN'DefaultData',`r`n\nREG_SZ,`r`n\nN'G:\\SQLDATA01'`r`n\nGO`r`n\n-- Change default location for log files`r`n\nEXEC xp_instance_regwrite`r`n\nN'HKEY_LOCAL_MACHINE',`r`n\nN'Software\\Microsoft\\MSSQLServer\\MSSQLServer',`r`n\nN'DefaultLog',`r`n\nREG_SZ,`r`n\nN'L:\\UserDB-logs01'`r`n\nGO`r`n\n-- Change default location for backups`r`n\nEXEC xp_instance_regwrite`r`n\nN'HKEY_LOCAL_MACHINE',`r`n\nN'Software\\Microsoft\\MSSQLServer\\MSSQLServer',`r`n\nN'BackupDirectory',`r`n\nREG_SZ,`r`n\nN'R:\\SQLBACK'`r`n\nGO\"\n\n#create directories\nmkdir G:\\SQLDATA01\\\nmkdir H:\\SQLDATA02\\\nmkdir I:\\TEMPDB01\\\nmkdir J:\\TEMPDB02\\\nmkdir L:\\UserDB-logs01\\\nmkdir T:\\TempDB-logs01\\\nmkdir R:\\SQLBACK\n\n#ADD SQL T parameters \n#T1117 This parameter forces MS SQL Server to grow all database files uniformly\n#T1118 This parameter forces MS SQL Server to use full extents only\n& $sqladdparms_cli '-T1117'\n& $sqladdparms_cli '-T1118'\nrestart-service MSSQL* -force\n\n#import powershell SQL module\nimport-module \"sqlps\" -DisableNameChecking\n\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\01-ChangeTempDB.sql\"\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\02-IncreaseTempDB_logs.sql\"\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\03-SQL_set_memory.sql\"\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\04-SQL-ChangeDefaultPaths.sql\"\n\n#Delete original SQL temp files\nstop-service MSSQL* \nStart-Sleep 5\nrm \"F:\\MSSQL\\MSSQL12.MSSQLSERVER\\MSSQL\\DATA\\temp*\"\n\nstart-service MSSQL* \nwmic useraccount get sid\nWrite-Output \"Time taken: $((Get-Date).Subtract($start_time).seconds) Second(s)\"","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"6d258f96-9d6e-4896-903c-6b803e848d61"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Apply SQL BPG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"28d71afc-ce41-4154-a78f-c05337f3f60b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"static","type":"","command_line_args":"","exit_status":[],"script":"#script\nprism_ip = '@@{PE_IP}@@'\nusername = '@@{PE_CREDS.username}@@'\npassword = '@@{PE_CREDS.secret}@@'\nvgname = '@@{VG_NAME}@@'\nvg_uuid = ''\nIQN='@@{IQN}@@'\n\napi_url = \"https:\/\/\" + prism_ip + \":9440\/PrismGateway\/services\/rest\/v2.0\/\"\n\nprint \"INFO: Attaching VG {} to node.\".format(vgname)\n\n# -*- Check volume group existance\n\ntry:\n  check_vg_url = api_url + \"volume_groups\"\n  response = urlreq(check_vg_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\n  vgs = json.loads(response.content)\n  for vg in vgs['entities']:\n    if vg['name'] == vgname:\n      vg_uuid = vg['uuid']\nexcept Exception as e:\n\tprint \"ERROR: Failed to get volume group, check volume group or check username\/password\"\n\tprint e.message\n\texit(1)\n    \nif vg_uuid == '':\n  print \"ERROR: Volume group with name {} doesn't exists\".format(vgname)\n  exit(1)\n\n# -*- Attach Volume Group\n\nattach_vg_url = api_url + \"volume_groups\/\" + vg_uuid + \"\/open\"\npayload = {\n  \"iscsi_client\": {\n    \"client_address\": IQN\n  },\n  \"operation\": \"ATTACH\"\n}\n\nresponse = urlreq(attach_vg_url, verb='POST', auth=\"BASIC\", user=username, passwd=password, params=json.dumps(payload), verify=False)\nif response.status_code != 201:\n\tprint \"ERROR: Attaching vg '{}' failed.\".format(vgname)\n\nattach_status = json.loads(response.content)\nif attach_status['value']:\n  print \"INFO: Attaching vg '{}' Successful.\".format(vgname)\nelse:\n  print \"ERROR: Attaching vg '{}' failed.\".format(vgname)"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Attach VG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"957b3f6a-bd01-479f-8635-ae43c7aea0fa","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"if (\"@@{calm_array_index}@@\" -ne \"0\"){\n\texit\n}\n\n$FailOverClusterName='@@{FAILOVER_CLUSTER_NAME}@@'\n$FailOverVIP='@@{FAILOVER_VIP}@@'\n$Nodes=\"@@{calm_array_address}@@\".split(',')\nWrite-Output \"INFO: Testing Failover Cluster.\"\n\n# -*- Test Failover Cluster\n\nif(Test-Cluster -Node $Nodes){\n\tWrite-Output \"INFO: Test-Cluster Success.\"\n}\nelse\n{\n\tWrite-Output \"ERROR: Test-Cluster Failed.\"\n    exit 1\n}\n\nforeach ( $node in $(\"@@{calm_array_address}@@\".split(',')) ){Test-WSMan $node}\n\n# -*- Create Failover Cluster\n\nNew-Cluster -Name $FailOverClusterName -Node $Nodes -StaticAddress $FailOverVIP\n\n# -*- Rename Cluster Disks\n$ClusterDisks =  Get-CimInstance -ClassName MSCluster_Resource -Namespace root\/mscluster -Filter \"type = 'Physical Disk'\"\nforeach ($Disk in $ClusterDisks) {\n$DiskResource = Get-CimAssociatedInstance -InputObject $Disk -ResultClass MSCluster_DiskPartition\n\tif (-not ($DiskResource.VolumeLabel -eq $Disk.Name)) {\n\t\tInvoke-CimMethod -InputObject $Disk -MethodName Rename -Arguments @{newName = $DiskResource.VolumeLabel}\n  \t}\n}","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"6d258f96-9d6e-4896-903c-6b803e848d61"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure WSFC"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"c3d7de2c-6488-4be0-82ce-01ddd8bea78b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"New-IscsiTargetPortal -TargetPortalAddress @@{PE_DATA_SERVICE_IP}@@\nGet-IscsiTarget | Connect-IscsiTarget -IsPersistent $true\n\n#Initialize Disks\nif (((Get-Disk -Number 1 -ErrorAction SilentlyContinue).HealthStatus -eq \"Healthy\") -and ((Get-Disk -Number 2 -ErrorAction SilentlyContinue).HealthStatus -eq \"Healthy\")) {\n\tGet-Disk -Number 1 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 2 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 3 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 4 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 5 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 6 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 7 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 8 | Initialize-Disk -ErrorAction SilentlyContinue\n\tNew-Partition -DiskNumber 1 -UseMaximumSize -DriveLetter F -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -FileSystem NTFS -NewFileSystemLabel \"SQLINSTALL\" \n\tNew-Partition -DiskNumber 2 -UseMaximumSize -DriveLetter R -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"SQLBCK\"\n\tNew-Partition -DiskNumber 3 -UseMaximumSize -DriveLetter G -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"DATA01\" \n\tNew-Partition -DiskNumber 4 -UseMaximumSize -DriveLetter H -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"DATA02\"\n    New-Partition -DiskNumber 5 -UseMaximumSize -DriveLetter I -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"TEMPDB01\" \n\tNew-Partition -DiskNumber 6 -UseMaximumSize -DriveLetter J -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"TEMPDB02\"\n    New-Partition -DiskNumber 7 -UseMaximumSize -DriveLetter T -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"TEMPDBLOG01\" \n\tNew-Partition -DiskNumber 8 -UseMaximumSize -DriveLetter L -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"ULOG01\"\n\n} else {\n\tWrite-Output \"Disks does not exists or not healthy.`nIf you havent added disks please add 8 disk.\"\n\texit 1\n}\n\nif (\"@@{calm_array_index}@@\" -eq \"0\"){\n  if ((Get-Disk -Number 9 -ErrorAction SilentlyContinue).HealthStatus -eq \"Healthy\"){\n      Get-Disk -Number 9 | Initialize-Disk -ErrorAction SilentlyContinue\n      New-Partition -DiskNumber 9 -UseMaximumSize -DriveLetter W -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -FileSystem NTFS -NewFileSystemLabel \"Witness\" \n  } else {\n      Write-Output \"Witness Disk does not exists or not healthy.`nIf you havent added disks please add a volume group and attach.`n `t - Witness : 1GB\"\n      exit 1\n  }\n}\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Connect Mount VG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"fc643ea4-2ad8-4e16-8171-67d254e23543","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"if (\"$(Get-ClusterNode | where {$_.Id -eq 1} | select -ExpandProperty Name)\" -ne \"$(hostname)\"){\n\texit\n}\n$AGName = '@@{SQL_CLUSTER_NAME}@@'\n$PrimaryNode = $(hostname)\n$IP = '@@{MSSQL_VIP}@@\/255.255.255.0'\n$replicas = @()\n\n$cname = (Get-Cluster -name $PrimaryNode).name\n$nodes = (get-clusternode -Cluster $cname).name\n\n$sqlperms = @\"\nuse [master];\nGRANT ALTER ANY AVAILABILITY GROUP TO [NT AUTHORITY\\SYSTEM];\nGRANT CONNECT SQL TO [NT AUTHORITY\\SYSTEM];\nGRANT VIEW SERVER STATE TO [NT AUTHORITY\\SYSTEM];\n\"@\n\nforeach($node in $nodes)\n{\n\tInvoke-Sqlcmd -ServerInstance $node -Database master -Query $sqlperms\n\t$replicas += New-SqlAvailabilityReplica -Name $node -EndpointUrl \"TCP:\/\/$($node):5022\" -AvailabilityMode \"SynchronousCommit\" -FailoverMode \"Automatic\" -AsTemplate -Version 12 \n}\n\n\nNew-SqlAvailabilityGroup -Name $AGName -Path \"SQLSERVER:\\SQL\\$PrimaryNode\\DEFAULT\" -AvailabilityReplica $replicas\n$nodes | Where-Object {$_ -ne $PrimaryNode} | ForEach-Object {Join-SqlAvailabilityGroup -path \"SQLSERVER:\\SQL\\$_\\DEFAULT\" -Name $AGName}\nNew-SqlAvailabilityGroupListener -Name $AGName -staticIP $IP -Port 1433 -Path \"SQLSERVER:\\Sql\\$PrimaryNode\\DEFAULT\\AvailabilityGroups\\$AGName\"\n","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"6d258f96-9d6e-4896-903c-6b803e848d61"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Create AAG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"c48f54e3-eb21-4418-bd2d-f5623208e84a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"static","type":"","command_line_args":"","exit_status":[],"script":"#script\n\nif \"@@{calm_array_index}@@\" != \"0\":\n  exit(0)\nprism_ip = '@@{PE_IP}@@'\nusername = '@@{PE_CREDS.username}@@'\npassword = '@@{PE_CREDS.secret}@@'\nstorage_container_name = '@@{CONTAINER_NAME}@@'\nstorage_container_uuid = ''\nvgname = '@@{VG_NAME}@@'\n\napi_url = \"https:\/\/\" + prism_ip + \":9440\/PrismGateway\/services\/rest\/v2.0\/\"\n\nprint \"INFO: Retrieving storage container uuid for: {}.\".format(storage_container_name)\n\n# -*- Get Container UUID\n\nget_container_uuid_url = api_url + \"storage_containers\"\ntry:\n  response = urlreq(get_container_uuid_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\n  storage_containers = json.loads(response.content)\n  for container in storage_containers['entities']:\n    if container['name'] == storage_container_name:\n      storage_container_uuid = container['storage_container_uuid']\nexcept Exception as e:\n\tprint \"ERROR: Failed to get storage container uuid, check storage container name or check username\/password\"\n\tprint e.message\n\texit(1)\n\nprint \"INFO: storage container uuid is: {}.\".format(storage_container_uuid)\n\n# -*- Check volume group existance\n\ncheck_vg_url = api_url + \"volume_groups\"\nresponse = urlreq(check_vg_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\nvgs = json.loads(response.content)\nfor vg in vgs['entities']:\n  if vg['name'] == vgname:\n    print \"ERROR: Volume group with name {} already exists.\".format(vgname)\n    exit(1)\n\nprint \"INFO: Creating volume group '{}'.\".format(vgname)\n\n# -*- Create Volume Group\n\ncreate_vg_url = api_url + \"volume_groups\"\npayload = {\n\t\"disk_list\": [{\n\t\t\"create_config\": {\n\t\t\t\"size\": 1073741824,\n\t\t\t\"storage_container_uuid\": storage_container_uuid\n\t\t},\n\t\t\"index\": 0\n\t}],\n\t\"is_shared\": True,\n\t\"name\": vgname\n}\n\nresponse = urlreq(create_vg_url, verb='POST', auth=\"BASIC\", user=username, passwd=password, params=json.dumps(payload), verify=False)\nif response.status_code != 201:\n\tprint \"ERROR: creation of volume group '{}' failed.\".format(vgname)\n\nvg_create_status = json.loads(response.content)\ntask_uuid = vg_create_status['task_uuid']\n\nsleep(5)\n\ncheck_vg_creation_url = api_url + \"tasks\/\" + task_uuid\nresponse = response = urlreq(check_vg_creation_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\nvg_create_status = json.loads(response.content)\n\nif vg_create_status['progress_status'] != \"Succeeded\":\n\tprint \"ERROR: creation of volume group '{}' failed.\".format(vgname)\n\texit(1)\nelse:\n\tprint \"INFO: creation of volume group '{}' Successful.\".format(vgname)"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Create VG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"7991a817-2640-4c3a-813a-611b3ae09452","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"# -*- Variable for T-SQL command\n$netbios = \"@@{DOMAIN}@@\".Split(\".\")[0].ToUpper()\n$createLogin = \"CREATE LOGIN [$netbios\\sqlservice] FROM WINDOWS; \" \n$grantConnectPermissions = \"GRANT CONNECT ON ENDPOINT::Endpoint_AG TO [$netbios\\sqlservice];\"\n\nEnable-SqlAlwaysOn -ServerInstance $(hostname) -Force \nNew-SqlHADREndpoint -Path \"SQLSERVER:\\SQL\\$(hostname)\\DEFAULT\" -Name \"Endpoint_AG\" -Port 5022 -EncryptionAlgorithm Aes -Encryption Required \nSet-SqlHADREndpoint -Path \"SQLSERVER:\\SQL\\$(hostname)\\DEFAULT\\Endpoints\\Endpoint_AG\" -State Started\nInvoke-SqlCmd -Server $(hostname) -Query $createLogin\nInvoke-SqlCmd -Server $(hostname) -Query $grantConnectPermissions","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"6d258f96-9d6e-4896-903c-6b803e848d61"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Enable AAG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"0f4471ce-096e-469e-9f69-c9339d1067f0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"Write-Output \"IQN=$((Get-InitiatorPort).NodeAddress)\"","eval_variables":["IQN"],"eval_scope":"local","type":"","script_type":"npsscript"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Get IQN"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"d8c7a910-e915-4093-8b29-9891952a2b60","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"Install-WindowsFeature -Name Failover-Clustering -IncludeManagementTools\n\nif (-not (get-WindowsFeature -Name Failover-Clustering -ErrorAction SilentlyContinue | select -ExpandProperty Installed)){\n\tWrite-output \"Failover Clustering is not installed\"\n\texit 1\n}"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Install FC"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"3229ae0a-055e-4faf-ad5e-d0935fdf98ad","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"Install-WindowsFeature -IncludeAllSubFeature -ErrorAction Stop \"Net-Framework-Core\"\n$DOMAINNAME=(Get-WmiObject Win32_ComputerSystem).Domain\n$setupDriveLetter = \"D:\"\n$setupPath = \"$setupDriveLetter\\setup.exe\"\n$silentArgs = \"\/IACCEPTSQLSERVERLICENSETERMS \/Q \/ACTION=install \/FEATURES=SQLENGINE,FULLTEXT,SSMS,ADV_SSMS \/AGTSVCACCOUNT=`\"@@{SQL_CREDS.username}@@`\" \/AGTSVCPASSWORD=@@{SQL_CREDS.secret}@@ \/SQLSVCACCOUNT=`\"@@{SQL_CREDS.username}@@`\" \/SQLSVCPASSWORD=@@{SQL_CREDS.secret}@@ \/SQLSYSADMINACCOUNTS=`\"$DOMAINNAME\\Domain Admins`\" \/ISSVCACCOUNT=`\"@@{SQL_CREDS.username}@@`\" \/ISSVCPASSWORD=@@{SQL_CREDS.secret}@@ \/ASSYSADMINACCOUNTS=`\"@@{SQL_CREDS.username}@@`\" \/INSTANCEID=MSSQLSERVER \/INSTANCENAME=MSSQLSERVER \/UPDATEENABLED=True \/UPDATESOURCE=`\"C:\\Temp`\" \/INDICATEPROGRESS \/TCPENABLED=1 \/INSTALLSQLDATADIR=`\"F:\\MSSQL`\" \/SQLUSERDBLOGDIR=`\"L:\\MSSQL`\" \/SQLTEMPDBLOGDIR=`\"T:\\MSSQL`\"\"\n$validExitCodes = @(0)\n\n$install = Start-Process -FilePath $setupPath -ArgumentList $silentArgs -Wait -NoNewWindow -PassThru\n$install.WaitForExit()\n$exitCode = $install.ExitCode\n$install.Dispose()\n\nWrite-Output \"SQL Failover Cluster Installation exited with `'$exitCode`'.\"\nif ($validExitCodes -notcontains $exitCode) {\n\tWrite-Output \"Running [`\"$setupPath`\" $silentArgs] was not successful. Exit code was '$exitCode'. See log for possible error messages.\"\n\texit 1\n}","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"6d258f96-9d6e-4896-903c-6b803e848d61"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Install SQL"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"39bb7402-9ada-4ee1-a348-ad63df7d1407","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"##############################################\n# Name        : JoinDomain\n# Author      : K Sarat Kumar\n# Version     : 1.0\n# Description : Script is used to join to domain.\n##############################################\n\nfunction JointoDomain {\n  [CmdletBinding()]\n  Param(\n      [parameter(Mandatory=$true)]\n      [string]$DomainName,\n      [parameter(Mandatory=$false)]\n      [string]$OU,\n      [parameter(Mandatory=$true)]\n      [string]$Username,\n      [parameter(Mandatory=$true)]\n      [string]$Password,\n      [parameter(Mandatory=$true)]\n      [string]$Server\n  )\n  $adapter = Get-NetAdapter | ? {$_.Status -eq \"up\"}\n  $adapter | Set-DnsClientServerAddress -ServerAddresses $Server\n\n  if ($env:computername  -eq $env:userdomain) {\n    Write-Host \"Not in domain\"\n    $adminname = \"$Username\"\n    $adminpassword = ConvertTo-SecureString -asPlainText -Force -String \"$Password\"\n    Write-Host \"$adminname , $password\"\n    $credential = New-Object System.Management.Automation.PSCredential($adminname,$adminpassword)\n    Add-computer -DomainName $DomainName -Credential $credential -force -Options JoinWithNewName,AccountCreate -PassThru -ErrorAction Stop\n  } else {\n     Write-Host \"Already in domain\"\n  }\n}\n\nJointoDomain -DomainName \"@@{DOMAIN}@@\" -Username \"@@{DOMAIN_CRED.username}@@\" -Password \"@@{DOMAIN_CRED.secret}@@\" -Server \"@@{AD_IP}@@\"\n\nRestart-Computer -Force -AsJob\nexit 0"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"JoinDomain"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","description":"","type":"EXEC","uuid":"64d06e54-4d78-42ea-b723-2d77cc9f3a18","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"##############################################\n# Name        : Pre-requisites\n# Author      : K Sarat Kumar\n# Version     : 1.0\n# Description : Script is used to join to domain.\n##############################################\n\n# -*- Pre-requisite to enable credssp and set 'Server' role\nEnable-WSManCredSSP -Role Server -Force\n\n# -*- Enabling and starting 'msiscsi'\nSet-Service -Name msiscsi -StartupType Automatic\nStart-Service msiscsi\n\n# -*- Change first Ehternet adapter name to 'Production'\nGet-NetAdapter -Name \"Ethernet\" | Rename-NetAdapter -NewName \"Production\" -ErrorAction SilentlyContinue\n\n# -*- Download SQL Updates\n$TempDirectory = \"C:\\Temp\"\nNew-Item -ItemType Directory -Force -Path $TempDirectory\n(New-Object System.Net.WebClient).DownloadFile(\"http:\/\/10.46.1.165\/data1\/ISOs\/SQLServer2014-KB4052725-x64.exe\",\"$TempDirectory\\SQLServer2014-KB4052725-x64.exe\")\nSet-NetFirewallProfile -Profile Domain,Public,Private -Enabled False"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Pre Requisites"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"113beadd-e1ca-43f8-8cbf-c65d49852086","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"static","type":"","command_line_args":"","exit_status":[],"script":"#script\nsleep(50)"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Sleep"}],"description":"","message_list":[],"uuid":"cf254e8d-da7c-40f5-8252-abea0d8d0e3d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"ddaf74d2_dag","uuid":"0660260c-5415-4a23-90e0-ceb0af24dbfb"},"name":"0561ade3_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","description":"","type":"DAG","uuid":"f1ec0a18-88a4-466c-9fe4-0e75ddf1d4e2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"7bf7eecb_dag"}],"description":"","message_list":[],"uuid":"80334a55-16d3-4e61-9608-44dc01af349b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"7bf7eecb_dag","uuid":"f1ec0a18-88a4-466c-9fe4-0e75ddf1d4e2"},"name":"f564b0c1_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Install_Crb_88b567d7_7ed0_4362_900b_06aec7b77e32"}],"description":"","message_list":[],"uuid":"7933e3cf-3e96-4132-8db3-3db8419bccd1","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"b52eed11-0e52-4e9d-9db1-97fbd7fb20ce"},"name":"SYS_GEN__Runbook_Package_88b567d7_7ed0_4362_900b_06aec7b77e32"}},{"description":"System action for creating an application","message_list":[],"uuid":"fe79d64c-6318-476c-b5ef-8618a0ec48b2","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","description":"","type":"DAG","uuid":"0d7777dc-9fc8-4318-bb35-ec0a2fbbe2e7","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"2ef40eaa-2880-40ee-b0ea-3df0fec86541"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"f0f0cf27-580e-4c90-af63-736ed728e449"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"038cb8af-42c3-4200-8ed9-260f6fb9d2c2"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"f0f0cf27-580e-4c90-af63-736ed728e449"},"edge_type":"inherent","type":"","uuid":"4b3e7928-d856-44c4-84cf-442870eb301a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"038cb8af-42c3-4200-8ed9-260f6fb9d2c2"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"2ef40eaa-2880-40ee-b0ea-3df0fec86541"},"edge_type":"inherent","type":"","uuid":"c395d5c0-fd1d-447a-8161-6f4116642f2d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"f0f0cf27-580e-4c90-af63-736ed728e449"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_88b567d7_7ed0_4362_900b_06aec7b77e32"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2ef40eaa-2880-40ee-b0ea-3df0fec86541","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"7933e3cf-3e96-4132-8db3-3db8419bccd1"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_88b567d7_7ed0_4362_900b_06aec7b77e32"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f0f0cf27-580e-4c90-af63-736ed728e449","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"dade7481_runbook","uuid":"900ad31c-a000-48b9-b51c-b7c546c67434"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"038cb8af-42c3-4200-8ed9-260f6fb9d2c2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"11876906_runbook","uuid":"e8e4abb3-204f-432b-afe9-944b40eb96ca"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b"}],"description":"","message_list":[],"uuid":"547616f3-5b51-407e-8ceb-11f484705dfc","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"0d7777dc-9fc8-4318-bb35-ec0a2fbbe2e7"},"name":"SYS_GEN__Runbook_Package_88b567d7_7ed0_4362_900b_06aec7b77e32"}},{"description":"System action for uninstalling an application","message_list":[],"uuid":"288bafd6-5c13-4b22-bcf0-b778719107c5","name":"action_uninstall","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","description":"","type":"DAG","uuid":"ade64943-7df0-4dc8-a9d0-2a7e320bdb0e","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Uninstall_Crb_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"f70fc797-f789-4b2b-839f-ad3783616f51"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_88b567d7_7ed0_4362_900b_06aec7b77e32"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_UNINSTALL","uuid":"f70fc797-f789-4b2b-839f-ad3783616f51","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","description":"","type":"DAG","uuid":"0660260c-5415-4a23-90e0-ceb0af24dbfb","child_tasks_local_reference_list":[{"kind":"app_task","name":"Apply OS BPG","uuid":"c5c03e88-dd51-4252-ae67-bcece8e0ab3e"},{"kind":"app_task","name":"Apply SQL BPG","uuid":"dabbb680-d05c-408d-9063-310b308a0bfb"},{"kind":"app_task","name":"Attach VG","uuid":"28d71afc-ce41-4154-a78f-c05337f3f60b"},{"kind":"app_task","name":"Configure WSFC","uuid":"957b3f6a-bd01-479f-8635-ae43c7aea0fa"},{"kind":"app_task","name":"Connect Mount VG","uuid":"c3d7de2c-6488-4be0-82ce-01ddd8bea78b"},{"kind":"app_task","name":"Create AAG","uuid":"fc643ea4-2ad8-4e16-8171-67d254e23543"},{"kind":"app_task","name":"Create VG","uuid":"c48f54e3-eb21-4418-bd2d-f5623208e84a"},{"kind":"app_task","name":"Enable AAG","uuid":"7991a817-2640-4c3a-813a-611b3ae09452"},{"kind":"app_task","name":"Get IQN","uuid":"0f4471ce-096e-469e-9f69-c9339d1067f0"},{"kind":"app_task","name":"Install FC","uuid":"d8c7a910-e915-4093-8b29-9891952a2b60"},{"kind":"app_task","name":"Install SQL","uuid":"3229ae0a-055e-4faf-ad5e-d0935fdf98ad"},{"kind":"app_task","name":"JoinDomain","uuid":"39bb7402-9ada-4ee1-a348-ad63df7d1407"},{"kind":"app_task","name":"Pre Requisites","uuid":"64d06e54-4d78-42ea-b723-2d77cc9f3a18"},{"kind":"app_task","name":"Sleep","uuid":"113beadd-e1ca-43f8-8cbf-c65d49852086"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Apply OS BPG","uuid":"c5c03e88-dd51-4252-ae67-bcece8e0ab3e"},"edge_type":"user_defined","type":"","uuid":"2d34f974-796f-4404-aaf6-e219f16d8d48","to_task_reference":{"kind":"app_task","name":"Apply SQL BPG","uuid":"dabbb680-d05c-408d-9063-310b308a0bfb"}},{"from_task_reference":{"kind":"app_task","name":"Apply SQL BPG","uuid":"dabbb680-d05c-408d-9063-310b308a0bfb"},"edge_type":"user_defined","type":"","uuid":"c50d59ad-d9a3-4480-9373-9058e7c83326","to_task_reference":{"kind":"app_task","name":"Enable AAG","uuid":"7991a817-2640-4c3a-813a-611b3ae09452"}},{"from_task_reference":{"kind":"app_task","name":"Attach VG","uuid":"28d71afc-ce41-4154-a78f-c05337f3f60b"},"edge_type":"user_defined","type":"","uuid":"54f08b1a-952e-4bc9-bf97-c3c4d0888b2a","to_task_reference":{"kind":"app_task","name":"Connect Mount VG","uuid":"c3d7de2c-6488-4be0-82ce-01ddd8bea78b"}},{"from_task_reference":{"kind":"app_task","name":"Configure WSFC","uuid":"957b3f6a-bd01-479f-8635-ae43c7aea0fa"},"edge_type":"user_defined","type":"","uuid":"b606ee4a-ae92-4202-812b-3ba226cebe4f","to_task_reference":{"kind":"app_task","name":"Install SQL","uuid":"3229ae0a-055e-4faf-ad5e-d0935fdf98ad"}},{"from_task_reference":{"kind":"app_task","name":"Connect Mount VG","uuid":"c3d7de2c-6488-4be0-82ce-01ddd8bea78b"},"edge_type":"user_defined","type":"","uuid":"4f68e321-7344-4105-bd6c-cb4e096e234c","to_task_reference":{"kind":"app_task","name":"Install FC","uuid":"d8c7a910-e915-4093-8b29-9891952a2b60"}},{"from_task_reference":{"kind":"app_task","name":"Create VG","uuid":"c48f54e3-eb21-4418-bd2d-f5623208e84a"},"edge_type":"user_defined","type":"","uuid":"8779cffa-a21b-4237-b24c-840979efbcb3","to_task_reference":{"kind":"app_task","name":"Get IQN","uuid":"0f4471ce-096e-469e-9f69-c9339d1067f0"}},{"from_task_reference":{"kind":"app_task","name":"Enable AAG","uuid":"7991a817-2640-4c3a-813a-611b3ae09452"},"edge_type":"user_defined","type":"","uuid":"fe6eb75d-f47b-4dae-a3d6-15e080edc2a8","to_task_reference":{"kind":"app_task","name":"Create AAG","uuid":"fc643ea4-2ad8-4e16-8171-67d254e23543"}},{"from_task_reference":{"kind":"app_task","name":"Get IQN","uuid":"0f4471ce-096e-469e-9f69-c9339d1067f0"},"edge_type":"user_defined","type":"","uuid":"507f52e7-63aa-45fc-a20c-dab8161d202b","to_task_reference":{"kind":"app_task","name":"Attach VG","uuid":"28d71afc-ce41-4154-a78f-c05337f3f60b"}},{"from_task_reference":{"kind":"app_task","name":"Install FC","uuid":"d8c7a910-e915-4093-8b29-9891952a2b60"},"edge_type":"user_defined","type":"","uuid":"3e887ae6-5f7b-4131-959d-1f77a70860b6","to_task_reference":{"kind":"app_task","name":"Configure WSFC","uuid":"957b3f6a-bd01-479f-8635-ae43c7aea0fa"}},{"from_task_reference":{"kind":"app_task","name":"Install SQL","uuid":"3229ae0a-055e-4faf-ad5e-d0935fdf98ad"},"edge_type":"user_defined","type":"","uuid":"511c3306-d33d-46f8-b448-40bdeb29ca1c","to_task_reference":{"kind":"app_task","name":"Apply OS BPG","uuid":"c5c03e88-dd51-4252-ae67-bcece8e0ab3e"}},{"from_task_reference":{"kind":"app_task","name":"JoinDomain","uuid":"39bb7402-9ada-4ee1-a348-ad63df7d1407"},"edge_type":"user_defined","type":"","uuid":"811570cd-e8e9-4224-b0b8-f1192f6f4029","to_task_reference":{"kind":"app_task","name":"Sleep","uuid":"113beadd-e1ca-43f8-8cbf-c65d49852086"}},{"from_task_reference":{"kind":"app_task","name":"Pre Requisites","uuid":"64d06e54-4d78-42ea-b723-2d77cc9f3a18"},"edge_type":"user_defined","type":"","uuid":"ce840774-6c6d-4ab5-a88c-2e60adf14037","to_task_reference":{"kind":"app_task","name":"JoinDomain","uuid":"39bb7402-9ada-4ee1-a348-ad63df7d1407"}},{"from_task_reference":{"kind":"app_task","name":"Sleep","uuid":"113beadd-e1ca-43f8-8cbf-c65d49852086"},"edge_type":"user_defined","type":"","uuid":"e8d271d6-3557-4c67-bdaf-51f925debda2","to_task_reference":{"kind":"app_task","name":"Create VG","uuid":"c48f54e3-eb21-4418-bd2d-f5623208e84a"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ddaf74d2_dag"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"c5c03e88-dd51-4252-ae67-bcece8e0ab3e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"$start_time = Get-Date\n\n$TempDirectory = \"C:\\Temp\"\n$RktTemp = \"$TempDirectory\\rktools.2003\"\n\n$url = \"@@{BPG_RKTOOLS_URL}@@\"\n$filePath = \"$TempDirectory\\rktools.exe\"\n\nNew-Item -ItemType Directory -Force -Path $TempDirectory\n(New-Object System.Net.WebClient).DownloadFile($url,$filePath)\n\n& $filePath \/Q \/T:\"$RktTemp\" \/C\n\nStart-Sleep 10\n\n$PackageName = \"rktools.2003\"\n$setupPath = \"C:\\Windows\\System32\\msiexec.exe\"\n$silentArgs = \"\/i $RktTemp\\rktools.msi \/qn\"\n$validExitCodes = @(0)\n\nWrite-Output \"Installing $PackageName....\"\n\n$install = Start-Process -FilePath $setupPath -ArgumentList $silentArgs -Wait -NoNewWindow -PassThru\n$install.WaitForExit()\n\n$exitCode = $install.ExitCode\n$install.Dispose()\n\nWrite-Output \"Command [`\"$setupPath`\" $silentArgs] exited with `'$exitCode`'.\"\nif ($validExitCodes -notcontains $exitCode) {\n\tWrite-Output \"Running [`\"$setupPath`\" $silentArgs] was not successful. Exit code was '$exitCode'. See log for possible error messages.\"\n\texit 1\n}\n\n# OS related tunning\n# Set Windows Power Options to High Performance\npowercfg -s 8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c\n\n#Grant Memory privileges to user \n$ntrights_cli = \"C:\\Program Files (x86)\\Windows Resource Kits\\Tools\\ntrights.exe\"\n& $ntrights_cli -u \"NT SERVICE\\MSSQLSERVER\" +r SeLockMemoryPrivilege\n& $ntrights_cli -u \"NT SERVICE\\MSSQLSERVER\" +r SeManageVolumePrivilege\n\nWrite-Output \"Time taken: $((Get-Date).Subtract($start_time).seconds) Second(s)\"","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"6d258f96-9d6e-4896-903c-6b803e848d61"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Apply OS BPG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"dabbb680-d05c-408d-9063-310b308a0bfb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"$start_time = Get-Date\n\n$TempDirectory = \"C:\\Temp\"\n$sqladdparms_cli = \"$TempDirectory\\Add-SqlServerStartupParameter.ps1\"\n$TSQLSCRIPTSDIR = \"$TempDirectory\\TSQL_Scripts\"\nNew-Item -ItemType Directory -Force -Path $TSQLSCRIPTSDIR\n  \nSet-Content -Path \"$sqladdparms_cli\" -Value '\nparam(\n    ## The parameter you wish to add\n    [Parameter(Mandatory = $true)]\n    $StartupParameter\n)\n\n$hklmRootNode = \"HKLM:\\SOFTWARE\\Microsoft\\Microsoft SQL Server\"\n\n$props = Get-ItemProperty \"$hklmRootNode\\Instance Names\\SQL\"\n$instances = $props.psobject.properties | ?{$_.Value -like \"MSSQL*\"} | select Value\n\n$instances | %{\n    $inst = $_.Value;\n    $regKey = \"$hklmRootNode\\$inst\\MSSQLServer\\Parameters\"\n    $props = Get-ItemProperty $regKey\n    $params = $props.psobject.properties | ?{$_.Name -like \"SQLArg*\"} | select Name, Value\n    #$params | ft -AutoSize\n    $hasFlag = $false\n    foreach ($param in $params) {\n        if($param.Value -eq $StartupParameter) {\n            $hasFlag = $true\n            break;\n        }\n    }\n    if (-not $hasFlag) {\n        \"Adding $StartupParameter\"\n        $newRegProp = \"SQLArg\"+($params.Count)\n        Set-ItemProperty -Path $regKey -Name $newRegProp -Value $StartupParameter\n    } else {\n        \"$StartupParameter already set\"\n    }\n}'\nSet-Content -Path \"$TSQLSCRIPTSDIR\\01-ChangeTempDB.sql\" -Value \"use master`r`n\ngo`r`n\nAlter database tempdb modify file (name = tempdev, filename = 'I:\\TEMPDB01\\tempdb01.mdf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb modify file (name = templog, filename = 'T:\\TempDB-logs01\\templog01.ldf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb ADD file (name = tempdev02, filename = 'I:\\TEMPDB01\\tempdb02.ndf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb ADD file (name = tempdev03, filename = 'J:\\TEMPDB02\\tempdb03.ndf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb ADD file (name = tempdev04, filename = 'J:\\TEMPDB02\\tempdb04.ndf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\n`r`n\nALTER DATABASE [tempdb] MODIFY FILE (NAME=N'tempdev', NEWNAME=N'tempdev01')`r`n\nGO`r`n\nALTER DATABASE [tempdb] MODIFY FILE (NAME=N'templog', NEWNAME=N'templog01')`r`n\nGO\"\n\nSet-Content -Path \"$TSQLSCRIPTSDIR\\02-IncreaseTempDB_logs.sql\" -Value \"Use master`r`n\ngo`r`n\nALTER DATABASE tempdb MODIFY FILE (NAME = templog01, filename = 'T:\\TempDB-logs01\\templog01.ldf', SIZE`r`n\n= 8096);`r`n\nGO`r`n\nALTER DATABASE tempdb MODIFY FILE (NAME = templog01, FILENAME = 'T:\\TempDB-logs01\\templog01.ldf', SIZE`r`n\n= 12288);`r`n\nGO\"\n\nSet-Content -Path \"$TSQLSCRIPTSDIR\\03-SQL_set_memory.sql\" -Value \"USE master;`r`n\nexec sp_configure 'show advanced options', 1;`r`n\nRECONFIGURE;`r`n\nGO`r`n\nDECLARE `r`n\n        @total_mem decimal (10,0),`r`n\n\t\t@min int,`r`n\n\t\t@max int`r`n\nSELECT `r`n\n   --SELECT (physical_memory_kb\/1024) AS Server_Physical_Memory_MB`r`n\n  @total_mem = (physical_memory_kb\/1024)`r`n\nFROM sys.dm_os_sys_info`r`n\n`r`n\nset @min = @total_mem * 0.1`r`n\nset @max = @total_mem * 0.85`r`n\nprint @min`r`n\nprint @max`r`n\n--print @total_mem`r`n\n`r`n\n`r`n\nEXEC sp_configure 'min server memory (MB)',@min`r`n\nEXEC sp_configure 'max server memory (MB)',@max`r`n\nRECONFIGURE\"\n\nSet-Content -Path \"$TSQLSCRIPTSDIR\\04-SQL-ChangeDefaultPaths.sql\" -Value \"USE [master]`r`n\nGO`r`n\n-- Change default location for data files`r`n\nEXEC xp_instance_regwrite`r`n\nN'HKEY_LOCAL_MACHINE',`r`n\nN'Software\\Microsoft\\MSSQLServer\\MSSQLServer',`r`n\nN'DefaultData',`r`n\nREG_SZ,`r`n\nN'G:\\SQLDATA01'`r`n\nGO`r`n\n-- Change default location for log files`r`n\nEXEC xp_instance_regwrite`r`n\nN'HKEY_LOCAL_MACHINE',`r`n\nN'Software\\Microsoft\\MSSQLServer\\MSSQLServer',`r`n\nN'DefaultLog',`r`n\nREG_SZ,`r`n\nN'L:\\UserDB-logs01'`r`n\nGO`r`n\n-- Change default location for backups`r`n\nEXEC xp_instance_regwrite`r`n\nN'HKEY_LOCAL_MACHINE',`r`n\nN'Software\\Microsoft\\MSSQLServer\\MSSQLServer',`r`n\nN'BackupDirectory',`r`n\nREG_SZ,`r`n\nN'R:\\SQLBACK'`r`n\nGO\"\n\n#create directories\nmkdir G:\\SQLDATA01\\\nmkdir H:\\SQLDATA02\\\nmkdir I:\\TEMPDB01\\\nmkdir J:\\TEMPDB02\\\nmkdir L:\\UserDB-logs01\\\nmkdir T:\\TempDB-logs01\\\nmkdir R:\\SQLBACK\n\n#ADD SQL T parameters \n#T1117 This parameter forces MS SQL Server to grow all database files uniformly\n#T1118 This parameter forces MS SQL Server to use full extents only\n& $sqladdparms_cli '-T1117'\n& $sqladdparms_cli '-T1118'\nrestart-service MSSQL* -force\n\n#import powershell SQL module\nimport-module \"sqlps\" -DisableNameChecking\n\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\01-ChangeTempDB.sql\"\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\02-IncreaseTempDB_logs.sql\"\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\03-SQL_set_memory.sql\"\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\04-SQL-ChangeDefaultPaths.sql\"\n\n#Delete original SQL temp files\nstop-service MSSQL* \nStart-Sleep 5\nrm \"F:\\MSSQL\\MSSQL12.MSSQLSERVER\\MSSQL\\DATA\\temp*\"\n\nstart-service MSSQL* \nwmic useraccount get sid\nWrite-Output \"Time taken: $((Get-Date).Subtract($start_time).seconds) Second(s)\"","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"6d258f96-9d6e-4896-903c-6b803e848d61"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Apply SQL BPG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"28d71afc-ce41-4154-a78f-c05337f3f60b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"static","type":"","command_line_args":"","exit_status":[],"script":"#script\nprism_ip = '@@{PE_IP}@@'\nusername = '@@{PE_CREDS.username}@@'\npassword = '@@{PE_CREDS.secret}@@'\nvgname = '@@{VG_NAME}@@'\nvg_uuid = ''\nIQN='@@{IQN}@@'\n\napi_url = \"https:\/\/\" + prism_ip + \":9440\/PrismGateway\/services\/rest\/v2.0\/\"\n\nprint \"INFO: Attaching VG {} to node.\".format(vgname)\n\n# -*- Check volume group existance\n\ntry:\n  check_vg_url = api_url + \"volume_groups\"\n  response = urlreq(check_vg_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\n  vgs = json.loads(response.content)\n  for vg in vgs['entities']:\n    if vg['name'] == vgname:\n      vg_uuid = vg['uuid']\nexcept Exception as e:\n\tprint \"ERROR: Failed to get volume group, check volume group or check username\/password\"\n\tprint e.message\n\texit(1)\n    \nif vg_uuid == '':\n  print \"ERROR: Volume group with name {} doesn't exists\".format(vgname)\n  exit(1)\n\n# -*- Attach Volume Group\n\nattach_vg_url = api_url + \"volume_groups\/\" + vg_uuid + \"\/open\"\npayload = {\n  \"iscsi_client\": {\n    \"client_address\": IQN\n  },\n  \"operation\": \"ATTACH\"\n}\n\nresponse = urlreq(attach_vg_url, verb='POST', auth=\"BASIC\", user=username, passwd=password, params=json.dumps(payload), verify=False)\nif response.status_code != 201:\n\tprint \"ERROR: Attaching vg '{}' failed.\".format(vgname)\n\nattach_status = json.loads(response.content)\nif attach_status['value']:\n  print \"INFO: Attaching vg '{}' Successful.\".format(vgname)\nelse:\n  print \"ERROR: Attaching vg '{}' failed.\".format(vgname)"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Attach VG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"957b3f6a-bd01-479f-8635-ae43c7aea0fa","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"if (\"@@{calm_array_index}@@\" -ne \"0\"){\n\texit\n}\n\n$FailOverClusterName='@@{FAILOVER_CLUSTER_NAME}@@'\n$FailOverVIP='@@{FAILOVER_VIP}@@'\n$Nodes=\"@@{calm_array_address}@@\".split(',')\nWrite-Output \"INFO: Testing Failover Cluster.\"\n\n# -*- Test Failover Cluster\n\nif(Test-Cluster -Node $Nodes){\n\tWrite-Output \"INFO: Test-Cluster Success.\"\n}\nelse\n{\n\tWrite-Output \"ERROR: Test-Cluster Failed.\"\n    exit 1\n}\n\nforeach ( $node in $(\"@@{calm_array_address}@@\".split(',')) ){Test-WSMan $node}\n\n# -*- Create Failover Cluster\n\nNew-Cluster -Name $FailOverClusterName -Node $Nodes -StaticAddress $FailOverVIP\n\n# -*- Rename Cluster Disks\n$ClusterDisks =  Get-CimInstance -ClassName MSCluster_Resource -Namespace root\/mscluster -Filter \"type = 'Physical Disk'\"\nforeach ($Disk in $ClusterDisks) {\n$DiskResource = Get-CimAssociatedInstance -InputObject $Disk -ResultClass MSCluster_DiskPartition\n\tif (-not ($DiskResource.VolumeLabel -eq $Disk.Name)) {\n\t\tInvoke-CimMethod -InputObject $Disk -MethodName Rename -Arguments @{newName = $DiskResource.VolumeLabel}\n  \t}\n}","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"6d258f96-9d6e-4896-903c-6b803e848d61"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure WSFC"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"c3d7de2c-6488-4be0-82ce-01ddd8bea78b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"New-IscsiTargetPortal -TargetPortalAddress @@{PE_DATA_SERVICE_IP}@@\nGet-IscsiTarget | Connect-IscsiTarget -IsPersistent $true\n\n#Initialize Disks\nif (((Get-Disk -Number 1 -ErrorAction SilentlyContinue).HealthStatus -eq \"Healthy\") -and ((Get-Disk -Number 2 -ErrorAction SilentlyContinue).HealthStatus -eq \"Healthy\")) {\n\tGet-Disk -Number 1 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 2 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 3 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 4 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 5 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 6 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 7 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 8 | Initialize-Disk -ErrorAction SilentlyContinue\n\tNew-Partition -DiskNumber 1 -UseMaximumSize -DriveLetter F -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -FileSystem NTFS -NewFileSystemLabel \"SQLINSTALL\" \n\tNew-Partition -DiskNumber 2 -UseMaximumSize -DriveLetter R -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"SQLBCK\"\n\tNew-Partition -DiskNumber 3 -UseMaximumSize -DriveLetter G -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"DATA01\" \n\tNew-Partition -DiskNumber 4 -UseMaximumSize -DriveLetter H -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"DATA02\"\n    New-Partition -DiskNumber 5 -UseMaximumSize -DriveLetter I -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"TEMPDB01\" \n\tNew-Partition -DiskNumber 6 -UseMaximumSize -DriveLetter J -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"TEMPDB02\"\n    New-Partition -DiskNumber 7 -UseMaximumSize -DriveLetter T -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"TEMPDBLOG01\" \n\tNew-Partition -DiskNumber 8 -UseMaximumSize -DriveLetter L -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"ULOG01\"\n\n} else {\n\tWrite-Output \"Disks does not exists or not healthy.`nIf you havent added disks please add 8 disk.\"\n\texit 1\n}\n\nif (\"@@{calm_array_index}@@\" -eq \"0\"){\n  if ((Get-Disk -Number 9 -ErrorAction SilentlyContinue).HealthStatus -eq \"Healthy\"){\n      Get-Disk -Number 9 | Initialize-Disk -ErrorAction SilentlyContinue\n      New-Partition -DiskNumber 9 -UseMaximumSize -DriveLetter W -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -FileSystem NTFS -NewFileSystemLabel \"Witness\" \n  } else {\n      Write-Output \"Witness Disk does not exists or not healthy.`nIf you havent added disks please add a volume group and attach.`n `t - Witness : 1GB\"\n      exit 1\n  }\n}\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Connect Mount VG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"fc643ea4-2ad8-4e16-8171-67d254e23543","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"if (\"$(Get-ClusterNode | where {$_.Id -eq 1} | select -ExpandProperty Name)\" -ne \"$(hostname)\"){\n\texit\n}\n$AGName = '@@{SQL_CLUSTER_NAME}@@'\n$PrimaryNode = $(hostname)\n$IP = '@@{MSSQL_VIP}@@\/255.255.255.0'\n$replicas = @()\n\n$cname = (Get-Cluster -name $PrimaryNode).name\n$nodes = (get-clusternode -Cluster $cname).name\n\n$sqlperms = @\"\nuse [master];\nGRANT ALTER ANY AVAILABILITY GROUP TO [NT AUTHORITY\\SYSTEM];\nGRANT CONNECT SQL TO [NT AUTHORITY\\SYSTEM];\nGRANT VIEW SERVER STATE TO [NT AUTHORITY\\SYSTEM];\n\"@\n\nforeach($node in $nodes)\n{\n\tInvoke-Sqlcmd -ServerInstance $node -Database master -Query $sqlperms\n\t$replicas += New-SqlAvailabilityReplica -Name $node -EndpointUrl \"TCP:\/\/$($node):5022\" -AvailabilityMode \"SynchronousCommit\" -FailoverMode \"Automatic\" -AsTemplate -Version 12 \n}\n\n\nNew-SqlAvailabilityGroup -Name $AGName -Path \"SQLSERVER:\\SQL\\$PrimaryNode\\DEFAULT\" -AvailabilityReplica $replicas\n$nodes | Where-Object {$_ -ne $PrimaryNode} | ForEach-Object {Join-SqlAvailabilityGroup -path \"SQLSERVER:\\SQL\\$_\\DEFAULT\" -Name $AGName}\nNew-SqlAvailabilityGroupListener -Name $AGName -staticIP $IP -Port 1433 -Path \"SQLSERVER:\\Sql\\$PrimaryNode\\DEFAULT\\AvailabilityGroups\\$AGName\"\n","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"6d258f96-9d6e-4896-903c-6b803e848d61"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Create AAG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"c48f54e3-eb21-4418-bd2d-f5623208e84a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"static","type":"","command_line_args":"","exit_status":[],"script":"#script\n\nif \"@@{calm_array_index}@@\" != \"0\":\n  exit(0)\nprism_ip = '@@{PE_IP}@@'\nusername = '@@{PE_CREDS.username}@@'\npassword = '@@{PE_CREDS.secret}@@'\nstorage_container_name = '@@{CONTAINER_NAME}@@'\nstorage_container_uuid = ''\nvgname = '@@{VG_NAME}@@'\n\napi_url = \"https:\/\/\" + prism_ip + \":9440\/PrismGateway\/services\/rest\/v2.0\/\"\n\nprint \"INFO: Retrieving storage container uuid for: {}.\".format(storage_container_name)\n\n# -*- Get Container UUID\n\nget_container_uuid_url = api_url + \"storage_containers\"\ntry:\n  response = urlreq(get_container_uuid_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\n  storage_containers = json.loads(response.content)\n  for container in storage_containers['entities']:\n    if container['name'] == storage_container_name:\n      storage_container_uuid = container['storage_container_uuid']\nexcept Exception as e:\n\tprint \"ERROR: Failed to get storage container uuid, check storage container name or check username\/password\"\n\tprint e.message\n\texit(1)\n\nprint \"INFO: storage container uuid is: {}.\".format(storage_container_uuid)\n\n# -*- Check volume group existance\n\ncheck_vg_url = api_url + \"volume_groups\"\nresponse = urlreq(check_vg_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\nvgs = json.loads(response.content)\nfor vg in vgs['entities']:\n  if vg['name'] == vgname:\n    print \"ERROR: Volume group with name {} already exists.\".format(vgname)\n    exit(1)\n\nprint \"INFO: Creating volume group '{}'.\".format(vgname)\n\n# -*- Create Volume Group\n\ncreate_vg_url = api_url + \"volume_groups\"\npayload = {\n\t\"disk_list\": [{\n\t\t\"create_config\": {\n\t\t\t\"size\": 1073741824,\n\t\t\t\"storage_container_uuid\": storage_container_uuid\n\t\t},\n\t\t\"index\": 0\n\t}],\n\t\"is_shared\": True,\n\t\"name\": vgname\n}\n\nresponse = urlreq(create_vg_url, verb='POST', auth=\"BASIC\", user=username, passwd=password, params=json.dumps(payload), verify=False)\nif response.status_code != 201:\n\tprint \"ERROR: creation of volume group '{}' failed.\".format(vgname)\n\nvg_create_status = json.loads(response.content)\ntask_uuid = vg_create_status['task_uuid']\n\nsleep(5)\n\ncheck_vg_creation_url = api_url + \"tasks\/\" + task_uuid\nresponse = response = urlreq(check_vg_creation_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\nvg_create_status = json.loads(response.content)\n\nif vg_create_status['progress_status'] != \"Succeeded\":\n\tprint \"ERROR: creation of volume group '{}' failed.\".format(vgname)\n\texit(1)\nelse:\n\tprint \"INFO: creation of volume group '{}' Successful.\".format(vgname)"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Create VG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"7991a817-2640-4c3a-813a-611b3ae09452","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"# -*- Variable for T-SQL command\n$netbios = \"@@{DOMAIN}@@\".Split(\".\")[0].ToUpper()\n$createLogin = \"CREATE LOGIN [$netbios\\sqlservice] FROM WINDOWS; \" \n$grantConnectPermissions = \"GRANT CONNECT ON ENDPOINT::Endpoint_AG TO [$netbios\\sqlservice];\"\n\nEnable-SqlAlwaysOn -ServerInstance $(hostname) -Force \nNew-SqlHADREndpoint -Path \"SQLSERVER:\\SQL\\$(hostname)\\DEFAULT\" -Name \"Endpoint_AG\" -Port 5022 -EncryptionAlgorithm Aes -Encryption Required \nSet-SqlHADREndpoint -Path \"SQLSERVER:\\SQL\\$(hostname)\\DEFAULT\\Endpoints\\Endpoint_AG\" -State Started\nInvoke-SqlCmd -Server $(hostname) -Query $createLogin\nInvoke-SqlCmd -Server $(hostname) -Query $grantConnectPermissions","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"6d258f96-9d6e-4896-903c-6b803e848d61"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Enable AAG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"0f4471ce-096e-469e-9f69-c9339d1067f0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"Write-Output \"IQN=$((Get-InitiatorPort).NodeAddress)\"","eval_variables":["IQN"],"eval_scope":"local","type":"","script_type":"npsscript"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Get IQN"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"d8c7a910-e915-4093-8b29-9891952a2b60","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"Install-WindowsFeature -Name Failover-Clustering -IncludeManagementTools\n\nif (-not (get-WindowsFeature -Name Failover-Clustering -ErrorAction SilentlyContinue | select -ExpandProperty Installed)){\n\tWrite-output \"Failover Clustering is not installed\"\n\texit 1\n}"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Install FC"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"3229ae0a-055e-4faf-ad5e-d0935fdf98ad","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"Install-WindowsFeature -IncludeAllSubFeature -ErrorAction Stop \"Net-Framework-Core\"\n$DOMAINNAME=(Get-WmiObject Win32_ComputerSystem).Domain\n$setupDriveLetter = \"D:\"\n$setupPath = \"$setupDriveLetter\\setup.exe\"\n$silentArgs = \"\/IACCEPTSQLSERVERLICENSETERMS \/Q \/ACTION=install \/FEATURES=SQLENGINE,FULLTEXT,SSMS,ADV_SSMS \/AGTSVCACCOUNT=`\"@@{SQL_CREDS.username}@@`\" \/AGTSVCPASSWORD=@@{SQL_CREDS.secret}@@ \/SQLSVCACCOUNT=`\"@@{SQL_CREDS.username}@@`\" \/SQLSVCPASSWORD=@@{SQL_CREDS.secret}@@ \/SQLSYSADMINACCOUNTS=`\"$DOMAINNAME\\Domain Admins`\" \/ISSVCACCOUNT=`\"@@{SQL_CREDS.username}@@`\" \/ISSVCPASSWORD=@@{SQL_CREDS.secret}@@ \/ASSYSADMINACCOUNTS=`\"@@{SQL_CREDS.username}@@`\" \/INSTANCEID=MSSQLSERVER \/INSTANCENAME=MSSQLSERVER \/UPDATEENABLED=True \/UPDATESOURCE=`\"C:\\Temp`\" \/INDICATEPROGRESS \/TCPENABLED=1 \/INSTALLSQLDATADIR=`\"F:\\MSSQL`\" \/SQLUSERDBLOGDIR=`\"L:\\MSSQL`\" \/SQLTEMPDBLOGDIR=`\"T:\\MSSQL`\"\"\n$validExitCodes = @(0)\n\n$install = Start-Process -FilePath $setupPath -ArgumentList $silentArgs -Wait -NoNewWindow -PassThru\n$install.WaitForExit()\n$exitCode = $install.ExitCode\n$install.Dispose()\n\nWrite-Output \"SQL Failover Cluster Installation exited with `'$exitCode`'.\"\nif ($validExitCodes -notcontains $exitCode) {\n\tWrite-Output \"Running [`\"$setupPath`\" $silentArgs] was not successful. Exit code was '$exitCode'. See log for possible error messages.\"\n\texit 1\n}","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"6d258f96-9d6e-4896-903c-6b803e848d61"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Install SQL"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"39bb7402-9ada-4ee1-a348-ad63df7d1407","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"##############################################\n# Name        : JoinDomain\n# Author      : K Sarat Kumar\n# Version     : 1.0\n# Description : Script is used to join to domain.\n##############################################\n\nfunction JointoDomain {\n  [CmdletBinding()]\n  Param(\n      [parameter(Mandatory=$true)]\n      [string]$DomainName,\n      [parameter(Mandatory=$false)]\n      [string]$OU,\n      [parameter(Mandatory=$true)]\n      [string]$Username,\n      [parameter(Mandatory=$true)]\n      [string]$Password,\n      [parameter(Mandatory=$true)]\n      [string]$Server\n  )\n  $adapter = Get-NetAdapter | ? {$_.Status -eq \"up\"}\n  $adapter | Set-DnsClientServerAddress -ServerAddresses $Server\n\n  if ($env:computername  -eq $env:userdomain) {\n    Write-Host \"Not in domain\"\n    $adminname = \"$Username\"\n    $adminpassword = ConvertTo-SecureString -asPlainText -Force -String \"$Password\"\n    Write-Host \"$adminname , $password\"\n    $credential = New-Object System.Management.Automation.PSCredential($adminname,$adminpassword)\n    Add-computer -DomainName $DomainName -Credential $credential -force -Options JoinWithNewName,AccountCreate -PassThru -ErrorAction Stop\n  } else {\n     Write-Host \"Already in domain\"\n  }\n}\n\nJointoDomain -DomainName \"@@{DOMAIN}@@\" -Username \"@@{DOMAIN_CRED.username}@@\" -Password \"@@{DOMAIN_CRED.secret}@@\" -Server \"@@{AD_IP}@@\"\n\nRestart-Computer -Force -AsJob\nexit 0"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"JoinDomain"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","description":"","type":"EXEC","uuid":"64d06e54-4d78-42ea-b723-2d77cc9f3a18","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"##############################################\n# Name        : Pre-requisites\n# Author      : K Sarat Kumar\n# Version     : 1.0\n# Description : Script is used to join to domain.\n##############################################\n\n# -*- Pre-requisite to enable credssp and set 'Server' role\nEnable-WSManCredSSP -Role Server -Force\n\n# -*- Enabling and starting 'msiscsi'\nSet-Service -Name msiscsi -StartupType Automatic\nStart-Service msiscsi\n\n# -*- Change first Ehternet adapter name to 'Production'\nGet-NetAdapter -Name \"Ethernet\" | Rename-NetAdapter -NewName \"Production\" -ErrorAction SilentlyContinue\n\n# -*- Download SQL Updates\n$TempDirectory = \"C:\\Temp\"\nNew-Item -ItemType Directory -Force -Path $TempDirectory\n(New-Object System.Net.WebClient).DownloadFile(\"http:\/\/10.46.1.165\/data1\/ISOs\/SQLServer2014-KB4052725-x64.exe\",\"$TempDirectory\\SQLServer2014-KB4052725-x64.exe\")\nSet-NetFirewallProfile -Profile Domain,Public,Private -Enabled False"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Pre Requisites"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"113beadd-e1ca-43f8-8cbf-c65d49852086","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"static","type":"","command_line_args":"","exit_status":[],"script":"#script\nsleep(50)"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Sleep"}],"description":"","message_list":[],"uuid":"cf254e8d-da7c-40f5-8252-abea0d8d0e3d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"ddaf74d2_dag","uuid":"0660260c-5415-4a23-90e0-ceb0af24dbfb"},"name":"0561ade3_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","description":"","type":"DAG","uuid":"f1ec0a18-88a4-466c-9fe4-0e75ddf1d4e2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"7bf7eecb_dag"}],"description":"","message_list":[],"uuid":"80334a55-16d3-4e61-9608-44dc01af349b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"7bf7eecb_dag","uuid":"f1ec0a18-88a4-466c-9fe4-0e75ddf1d4e2"},"name":"f564b0c1_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Uninstall_Crb_88b567d7_7ed0_4362_900b_06aec7b77e32"}],"description":"","message_list":[],"uuid":"4fc28ca0-713b-41b8-a748-264edd42e8ff","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"ade64943-7df0-4dc8-a9d0-2a7e320bdb0e"},"name":"SYS_GEN__Runbook_Package_88b567d7_7ed0_4362_900b_06aec7b77e32"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"30684814-f91e-4094-bf4d-0b5d3f4940d6","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","description":"","type":"DAG","uuid":"015ecf47-c1f2-41ce-b709-a31bb2cba48a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"4e3540c7-141a-4f62-bc5c-2f9915417d79"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"5c8a2a0a-45d4-4c14-9245-57a0c32ac083"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"1133bde6-cf12-4978-a80e-fecd74364fed"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"4e3540c7-141a-4f62-bc5c-2f9915417d79"},"edge_type":"inherent","type":"","uuid":"66026466-31b6-4eac-8dc1-b07294595cdd","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"5c8a2a0a-45d4-4c14-9245-57a0c32ac083"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"5c8a2a0a-45d4-4c14-9245-57a0c32ac083"},"edge_type":"inherent","type":"","uuid":"746b3eb9-0ef0-45fa-9016-ddbb80e3d738","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"1133bde6-cf12-4978-a80e-fecd74364fed"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_88b567d7_7ed0_4362_900b_06aec7b77e32"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4e3540c7-141a-4f62-bc5c-2f9915417d79","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d2728354_runbook","uuid":"1f317491-b3c2-4dd3-bdc7-15aeb1e33b0a"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5c8a2a0a-45d4-4c14-9245-57a0c32ac083","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"59afb4f4_runbook","uuid":"448b8840-3dc8-408f-a3b3-75646791952c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1133bde6-cf12-4978-a80e-fecd74364fed","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"4fc28ca0-713b-41b8-a748-264edd42e8ff"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_88b567d7_7ed0_4362_900b_06aec7b77e32"}],"description":"","message_list":[],"uuid":"0a1727f2-eb99-4e95-b0cd-cb4b9abf5904","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"015ecf47-c1f2-41ce-b709-a31bb2cba48a"},"name":"SYS_GEN__Runbook_Package_88b567d7_7ed0_4362_900b_06aec7b77e32"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"d5e85926-b1a0-48e7-8b9b-a0d22b1d9eca","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","description":"","type":"DAG","uuid":"3e17ae66-840b-45e3-a871-cc026161c590","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"5ecc69e9-c7e3-4213-b4ae-d2f3e8785cd5"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"8a354206-19ad-4074-a593-c09ef256902e"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"5ecc69e9-c7e3-4213-b4ae-d2f3e8785cd5"},"edge_type":"inherent","type":"","uuid":"74575e9c-73ea-4a16-b88d-9952e679f071","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"8a354206-19ad-4074-a593-c09ef256902e"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_88b567d7_7ed0_4362_900b_06aec7b77e32"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5ecc69e9-c7e3-4213-b4ae-d2f3e8785cd5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"4ed53bef-cfce-4f7b-806c-e46e1fd8dcd5"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"8a354206-19ad-4074-a593-c09ef256902e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_88b567d7_7ed0_4362_900b_06aec7b77e32"}],"description":"","message_list":[],"uuid":"2b4dc61b-7f3c-46d0-a01a-c4c4ea9fbe05","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"3e17ae66-840b-45e3-a871-cc026161c590"},"name":"SYS_GEN__Runbook_Package_88b567d7_7ed0_4362_900b_06aec7b77e32"}},{"description":"System action for starting an application","message_list":[],"uuid":"7a3d1d1e-6fa4-444c-84eb-16437a4fbae8","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","description":"","type":"DAG","uuid":"a02af299-dd0e-4e01-9bcf-63f09757a5ec","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"9ca4f2c6-2f55-4814-81da-4461a7cbb1c3"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_88b567d7_7ed0_4362_900b_06aec7b77e32"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"9ca4f2c6-2f55-4814-81da-4461a7cbb1c3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"11876906_runbook","uuid":"e8e4abb3-204f-432b-afe9-944b40eb96ca"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b"}],"description":"","message_list":[],"uuid":"fef9d0cc-462f-41d1-9c2b-e3c536aca67d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"a02af299-dd0e-4e01-9bcf-63f09757a5ec"},"name":"SYS_GEN__Runbook_Package_88b567d7_7ed0_4362_900b_06aec7b77e32"}},{"description":"System action for restarting an application","message_list":[],"uuid":"fef1f5b6-7dcd-442d-8c64-3326968a5d17","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","description":"","type":"DAG","uuid":"b76a743a-ffbc-4eac-bf01-3b5242759338","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"9daf4fda-652c-4214-af0c-cab34c209f2b"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_88b567d7_7ed0_4362_900b_06aec7b77e32"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"9daf4fda-652c-4214-af0c-cab34c209f2b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"4150545e_runbook","uuid":"de0c2ef6-7931-43c2-8812-cf3ea6fcaca6"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b"}],"description":"","message_list":[],"uuid":"befc9ce3-c637-41f4-84f8-1b79f9270e8e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"b76a743a-ffbc-4eac-bf01-3b5242759338"},"name":"SYS_GEN__Runbook_Package_88b567d7_7ed0_4362_900b_06aec7b77e32"}},{"description":"System action for stopping an application","message_list":[],"uuid":"d5dfc17b-0cfc-4a6c-bd3a-a691edc9ada0","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","description":"","type":"DAG","uuid":"2e4acd0c-93c8-4ccd-9b27-e68efba678e4","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b","uuid":"0910ef71-87d9-457c-a423-75fdfa5fbba5"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_88b567d7_7ed0_4362_900b_06aec7b77e32"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0910ef71-87d9-457c-a423-75fdfa5fbba5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d2728354_runbook","uuid":"1f317491-b3c2-4dd3-bdc7-15aeb1e33b0a"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_1fd5d9b1_a75f_4d28_98cd_2bea326d505b"}],"description":"","message_list":[],"uuid":"f7f1ed87-cd26-40ac-a589-edd0446a79b0","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_88b567d7_7ed0_4362_900b_06aec7b77e32","uuid":"2e4acd0c-93c8-4ccd-9b27-e68efba678e4"},"name":"SYS_GEN__Runbook_Package_88b567d7_7ed0_4362_900b_06aec7b77e32"}}],"message_list":[],"service_local_reference_list":[{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"}],"uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32","state":"ACTIVE","version":"","editables":{},"type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","description":"","type":"DAG","uuid":"0660260c-5415-4a23-90e0-ceb0af24dbfb","child_tasks_local_reference_list":[{"kind":"app_task","name":"Apply OS BPG","uuid":"c5c03e88-dd51-4252-ae67-bcece8e0ab3e"},{"kind":"app_task","name":"Apply SQL BPG","uuid":"dabbb680-d05c-408d-9063-310b308a0bfb"},{"kind":"app_task","name":"Attach VG","uuid":"28d71afc-ce41-4154-a78f-c05337f3f60b"},{"kind":"app_task","name":"Configure WSFC","uuid":"957b3f6a-bd01-479f-8635-ae43c7aea0fa"},{"kind":"app_task","name":"Connect Mount VG","uuid":"c3d7de2c-6488-4be0-82ce-01ddd8bea78b"},{"kind":"app_task","name":"Create AAG","uuid":"fc643ea4-2ad8-4e16-8171-67d254e23543"},{"kind":"app_task","name":"Create VG","uuid":"c48f54e3-eb21-4418-bd2d-f5623208e84a"},{"kind":"app_task","name":"Enable AAG","uuid":"7991a817-2640-4c3a-813a-611b3ae09452"},{"kind":"app_task","name":"Get IQN","uuid":"0f4471ce-096e-469e-9f69-c9339d1067f0"},{"kind":"app_task","name":"Install FC","uuid":"d8c7a910-e915-4093-8b29-9891952a2b60"},{"kind":"app_task","name":"Install SQL","uuid":"3229ae0a-055e-4faf-ad5e-d0935fdf98ad"},{"kind":"app_task","name":"JoinDomain","uuid":"39bb7402-9ada-4ee1-a348-ad63df7d1407"},{"kind":"app_task","name":"Pre Requisites","uuid":"64d06e54-4d78-42ea-b723-2d77cc9f3a18"},{"kind":"app_task","name":"Sleep","uuid":"113beadd-e1ca-43f8-8cbf-c65d49852086"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Apply OS BPG","uuid":"c5c03e88-dd51-4252-ae67-bcece8e0ab3e"},"edge_type":"user_defined","type":"","uuid":"2d34f974-796f-4404-aaf6-e219f16d8d48","to_task_reference":{"kind":"app_task","name":"Apply SQL BPG","uuid":"dabbb680-d05c-408d-9063-310b308a0bfb"}},{"from_task_reference":{"kind":"app_task","name":"Apply SQL BPG","uuid":"dabbb680-d05c-408d-9063-310b308a0bfb"},"edge_type":"user_defined","type":"","uuid":"c50d59ad-d9a3-4480-9373-9058e7c83326","to_task_reference":{"kind":"app_task","name":"Enable AAG","uuid":"7991a817-2640-4c3a-813a-611b3ae09452"}},{"from_task_reference":{"kind":"app_task","name":"Attach VG","uuid":"28d71afc-ce41-4154-a78f-c05337f3f60b"},"edge_type":"user_defined","type":"","uuid":"54f08b1a-952e-4bc9-bf97-c3c4d0888b2a","to_task_reference":{"kind":"app_task","name":"Connect Mount VG","uuid":"c3d7de2c-6488-4be0-82ce-01ddd8bea78b"}},{"from_task_reference":{"kind":"app_task","name":"Configure WSFC","uuid":"957b3f6a-bd01-479f-8635-ae43c7aea0fa"},"edge_type":"user_defined","type":"","uuid":"b606ee4a-ae92-4202-812b-3ba226cebe4f","to_task_reference":{"kind":"app_task","name":"Install SQL","uuid":"3229ae0a-055e-4faf-ad5e-d0935fdf98ad"}},{"from_task_reference":{"kind":"app_task","name":"Connect Mount VG","uuid":"c3d7de2c-6488-4be0-82ce-01ddd8bea78b"},"edge_type":"user_defined","type":"","uuid":"4f68e321-7344-4105-bd6c-cb4e096e234c","to_task_reference":{"kind":"app_task","name":"Install FC","uuid":"d8c7a910-e915-4093-8b29-9891952a2b60"}},{"from_task_reference":{"kind":"app_task","name":"Create VG","uuid":"c48f54e3-eb21-4418-bd2d-f5623208e84a"},"edge_type":"user_defined","type":"","uuid":"8779cffa-a21b-4237-b24c-840979efbcb3","to_task_reference":{"kind":"app_task","name":"Get IQN","uuid":"0f4471ce-096e-469e-9f69-c9339d1067f0"}},{"from_task_reference":{"kind":"app_task","name":"Enable AAG","uuid":"7991a817-2640-4c3a-813a-611b3ae09452"},"edge_type":"user_defined","type":"","uuid":"fe6eb75d-f47b-4dae-a3d6-15e080edc2a8","to_task_reference":{"kind":"app_task","name":"Create AAG","uuid":"fc643ea4-2ad8-4e16-8171-67d254e23543"}},{"from_task_reference":{"kind":"app_task","name":"Get IQN","uuid":"0f4471ce-096e-469e-9f69-c9339d1067f0"},"edge_type":"user_defined","type":"","uuid":"507f52e7-63aa-45fc-a20c-dab8161d202b","to_task_reference":{"kind":"app_task","name":"Attach VG","uuid":"28d71afc-ce41-4154-a78f-c05337f3f60b"}},{"from_task_reference":{"kind":"app_task","name":"Install FC","uuid":"d8c7a910-e915-4093-8b29-9891952a2b60"},"edge_type":"user_defined","type":"","uuid":"3e887ae6-5f7b-4131-959d-1f77a70860b6","to_task_reference":{"kind":"app_task","name":"Configure WSFC","uuid":"957b3f6a-bd01-479f-8635-ae43c7aea0fa"}},{"from_task_reference":{"kind":"app_task","name":"Install SQL","uuid":"3229ae0a-055e-4faf-ad5e-d0935fdf98ad"},"edge_type":"user_defined","type":"","uuid":"511c3306-d33d-46f8-b448-40bdeb29ca1c","to_task_reference":{"kind":"app_task","name":"Apply OS BPG","uuid":"c5c03e88-dd51-4252-ae67-bcece8e0ab3e"}},{"from_task_reference":{"kind":"app_task","name":"JoinDomain","uuid":"39bb7402-9ada-4ee1-a348-ad63df7d1407"},"edge_type":"user_defined","type":"","uuid":"811570cd-e8e9-4224-b0b8-f1192f6f4029","to_task_reference":{"kind":"app_task","name":"Sleep","uuid":"113beadd-e1ca-43f8-8cbf-c65d49852086"}},{"from_task_reference":{"kind":"app_task","name":"Pre Requisites","uuid":"64d06e54-4d78-42ea-b723-2d77cc9f3a18"},"edge_type":"user_defined","type":"","uuid":"ce840774-6c6d-4ab5-a88c-2e60adf14037","to_task_reference":{"kind":"app_task","name":"JoinDomain","uuid":"39bb7402-9ada-4ee1-a348-ad63df7d1407"}},{"from_task_reference":{"kind":"app_task","name":"Sleep","uuid":"113beadd-e1ca-43f8-8cbf-c65d49852086"},"edge_type":"user_defined","type":"","uuid":"e8d271d6-3557-4c67-bdaf-51f925debda2","to_task_reference":{"kind":"app_task","name":"Create VG","uuid":"c48f54e3-eb21-4418-bd2d-f5623208e84a"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ddaf74d2_dag"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"c5c03e88-dd51-4252-ae67-bcece8e0ab3e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"$start_time = Get-Date\n\n$TempDirectory = \"C:\\Temp\"\n$RktTemp = \"$TempDirectory\\rktools.2003\"\n\n$url = \"@@{BPG_RKTOOLS_URL}@@\"\n$filePath = \"$TempDirectory\\rktools.exe\"\n\nNew-Item -ItemType Directory -Force -Path $TempDirectory\n(New-Object System.Net.WebClient).DownloadFile($url,$filePath)\n\n& $filePath \/Q \/T:\"$RktTemp\" \/C\n\nStart-Sleep 10\n\n$PackageName = \"rktools.2003\"\n$setupPath = \"C:\\Windows\\System32\\msiexec.exe\"\n$silentArgs = \"\/i $RktTemp\\rktools.msi \/qn\"\n$validExitCodes = @(0)\n\nWrite-Output \"Installing $PackageName....\"\n\n$install = Start-Process -FilePath $setupPath -ArgumentList $silentArgs -Wait -NoNewWindow -PassThru\n$install.WaitForExit()\n\n$exitCode = $install.ExitCode\n$install.Dispose()\n\nWrite-Output \"Command [`\"$setupPath`\" $silentArgs] exited with `'$exitCode`'.\"\nif ($validExitCodes -notcontains $exitCode) {\n\tWrite-Output \"Running [`\"$setupPath`\" $silentArgs] was not successful. Exit code was '$exitCode'. See log for possible error messages.\"\n\texit 1\n}\n\n# OS related tunning\n# Set Windows Power Options to High Performance\npowercfg -s 8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c\n\n#Grant Memory privileges to user \n$ntrights_cli = \"C:\\Program Files (x86)\\Windows Resource Kits\\Tools\\ntrights.exe\"\n& $ntrights_cli -u \"NT SERVICE\\MSSQLSERVER\" +r SeLockMemoryPrivilege\n& $ntrights_cli -u \"NT SERVICE\\MSSQLSERVER\" +r SeManageVolumePrivilege\n\nWrite-Output \"Time taken: $((Get-Date).Subtract($start_time).seconds) Second(s)\"","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"6d258f96-9d6e-4896-903c-6b803e848d61"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Apply OS BPG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"dabbb680-d05c-408d-9063-310b308a0bfb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"$start_time = Get-Date\n\n$TempDirectory = \"C:\\Temp\"\n$sqladdparms_cli = \"$TempDirectory\\Add-SqlServerStartupParameter.ps1\"\n$TSQLSCRIPTSDIR = \"$TempDirectory\\TSQL_Scripts\"\nNew-Item -ItemType Directory -Force -Path $TSQLSCRIPTSDIR\n  \nSet-Content -Path \"$sqladdparms_cli\" -Value '\nparam(\n    ## The parameter you wish to add\n    [Parameter(Mandatory = $true)]\n    $StartupParameter\n)\n\n$hklmRootNode = \"HKLM:\\SOFTWARE\\Microsoft\\Microsoft SQL Server\"\n\n$props = Get-ItemProperty \"$hklmRootNode\\Instance Names\\SQL\"\n$instances = $props.psobject.properties | ?{$_.Value -like \"MSSQL*\"} | select Value\n\n$instances | %{\n    $inst = $_.Value;\n    $regKey = \"$hklmRootNode\\$inst\\MSSQLServer\\Parameters\"\n    $props = Get-ItemProperty $regKey\n    $params = $props.psobject.properties | ?{$_.Name -like \"SQLArg*\"} | select Name, Value\n    #$params | ft -AutoSize\n    $hasFlag = $false\n    foreach ($param in $params) {\n        if($param.Value -eq $StartupParameter) {\n            $hasFlag = $true\n            break;\n        }\n    }\n    if (-not $hasFlag) {\n        \"Adding $StartupParameter\"\n        $newRegProp = \"SQLArg\"+($params.Count)\n        Set-ItemProperty -Path $regKey -Name $newRegProp -Value $StartupParameter\n    } else {\n        \"$StartupParameter already set\"\n    }\n}'\nSet-Content -Path \"$TSQLSCRIPTSDIR\\01-ChangeTempDB.sql\" -Value \"use master`r`n\ngo`r`n\nAlter database tempdb modify file (name = tempdev, filename = 'I:\\TEMPDB01\\tempdb01.mdf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb modify file (name = templog, filename = 'T:\\TempDB-logs01\\templog01.ldf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb ADD file (name = tempdev02, filename = 'I:\\TEMPDB01\\tempdb02.ndf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb ADD file (name = tempdev03, filename = 'J:\\TEMPDB02\\tempdb03.ndf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb ADD file (name = tempdev04, filename = 'J:\\TEMPDB02\\tempdb04.ndf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\n`r`n\nALTER DATABASE [tempdb] MODIFY FILE (NAME=N'tempdev', NEWNAME=N'tempdev01')`r`n\nGO`r`n\nALTER DATABASE [tempdb] MODIFY FILE (NAME=N'templog', NEWNAME=N'templog01')`r`n\nGO\"\n\nSet-Content -Path \"$TSQLSCRIPTSDIR\\02-IncreaseTempDB_logs.sql\" -Value \"Use master`r`n\ngo`r`n\nALTER DATABASE tempdb MODIFY FILE (NAME = templog01, filename = 'T:\\TempDB-logs01\\templog01.ldf', SIZE`r`n\n= 8096);`r`n\nGO`r`n\nALTER DATABASE tempdb MODIFY FILE (NAME = templog01, FILENAME = 'T:\\TempDB-logs01\\templog01.ldf', SIZE`r`n\n= 12288);`r`n\nGO\"\n\nSet-Content -Path \"$TSQLSCRIPTSDIR\\03-SQL_set_memory.sql\" -Value \"USE master;`r`n\nexec sp_configure 'show advanced options', 1;`r`n\nRECONFIGURE;`r`n\nGO`r`n\nDECLARE `r`n\n        @total_mem decimal (10,0),`r`n\n\t\t@min int,`r`n\n\t\t@max int`r`n\nSELECT `r`n\n   --SELECT (physical_memory_kb\/1024) AS Server_Physical_Memory_MB`r`n\n  @total_mem = (physical_memory_kb\/1024)`r`n\nFROM sys.dm_os_sys_info`r`n\n`r`n\nset @min = @total_mem * 0.1`r`n\nset @max = @total_mem * 0.85`r`n\nprint @min`r`n\nprint @max`r`n\n--print @total_mem`r`n\n`r`n\n`r`n\nEXEC sp_configure 'min server memory (MB)',@min`r`n\nEXEC sp_configure 'max server memory (MB)',@max`r`n\nRECONFIGURE\"\n\nSet-Content -Path \"$TSQLSCRIPTSDIR\\04-SQL-ChangeDefaultPaths.sql\" -Value \"USE [master]`r`n\nGO`r`n\n-- Change default location for data files`r`n\nEXEC xp_instance_regwrite`r`n\nN'HKEY_LOCAL_MACHINE',`r`n\nN'Software\\Microsoft\\MSSQLServer\\MSSQLServer',`r`n\nN'DefaultData',`r`n\nREG_SZ,`r`n\nN'G:\\SQLDATA01'`r`n\nGO`r`n\n-- Change default location for log files`r`n\nEXEC xp_instance_regwrite`r`n\nN'HKEY_LOCAL_MACHINE',`r`n\nN'Software\\Microsoft\\MSSQLServer\\MSSQLServer',`r`n\nN'DefaultLog',`r`n\nREG_SZ,`r`n\nN'L:\\UserDB-logs01'`r`n\nGO`r`n\n-- Change default location for backups`r`n\nEXEC xp_instance_regwrite`r`n\nN'HKEY_LOCAL_MACHINE',`r`n\nN'Software\\Microsoft\\MSSQLServer\\MSSQLServer',`r`n\nN'BackupDirectory',`r`n\nREG_SZ,`r`n\nN'R:\\SQLBACK'`r`n\nGO\"\n\n#create directories\nmkdir G:\\SQLDATA01\\\nmkdir H:\\SQLDATA02\\\nmkdir I:\\TEMPDB01\\\nmkdir J:\\TEMPDB02\\\nmkdir L:\\UserDB-logs01\\\nmkdir T:\\TempDB-logs01\\\nmkdir R:\\SQLBACK\n\n#ADD SQL T parameters \n#T1117 This parameter forces MS SQL Server to grow all database files uniformly\n#T1118 This parameter forces MS SQL Server to use full extents only\n& $sqladdparms_cli '-T1117'\n& $sqladdparms_cli '-T1118'\nrestart-service MSSQL* -force\n\n#import powershell SQL module\nimport-module \"sqlps\" -DisableNameChecking\n\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\01-ChangeTempDB.sql\"\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\02-IncreaseTempDB_logs.sql\"\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\03-SQL_set_memory.sql\"\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\04-SQL-ChangeDefaultPaths.sql\"\n\n#Delete original SQL temp files\nstop-service MSSQL* \nStart-Sleep 5\nrm \"F:\\MSSQL\\MSSQL12.MSSQLSERVER\\MSSQL\\DATA\\temp*\"\n\nstart-service MSSQL* \nwmic useraccount get sid\nWrite-Output \"Time taken: $((Get-Date).Subtract($start_time).seconds) Second(s)\"","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"6d258f96-9d6e-4896-903c-6b803e848d61"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Apply SQL BPG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"28d71afc-ce41-4154-a78f-c05337f3f60b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"static","type":"","command_line_args":"","exit_status":[],"script":"#script\nprism_ip = '@@{PE_IP}@@'\nusername = '@@{PE_CREDS.username}@@'\npassword = '@@{PE_CREDS.secret}@@'\nvgname = '@@{VG_NAME}@@'\nvg_uuid = ''\nIQN='@@{IQN}@@'\n\napi_url = \"https:\/\/\" + prism_ip + \":9440\/PrismGateway\/services\/rest\/v2.0\/\"\n\nprint \"INFO: Attaching VG {} to node.\".format(vgname)\n\n# -*- Check volume group existance\n\ntry:\n  check_vg_url = api_url + \"volume_groups\"\n  response = urlreq(check_vg_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\n  vgs = json.loads(response.content)\n  for vg in vgs['entities']:\n    if vg['name'] == vgname:\n      vg_uuid = vg['uuid']\nexcept Exception as e:\n\tprint \"ERROR: Failed to get volume group, check volume group or check username\/password\"\n\tprint e.message\n\texit(1)\n    \nif vg_uuid == '':\n  print \"ERROR: Volume group with name {} doesn't exists\".format(vgname)\n  exit(1)\n\n# -*- Attach Volume Group\n\nattach_vg_url = api_url + \"volume_groups\/\" + vg_uuid + \"\/open\"\npayload = {\n  \"iscsi_client\": {\n    \"client_address\": IQN\n  },\n  \"operation\": \"ATTACH\"\n}\n\nresponse = urlreq(attach_vg_url, verb='POST', auth=\"BASIC\", user=username, passwd=password, params=json.dumps(payload), verify=False)\nif response.status_code != 201:\n\tprint \"ERROR: Attaching vg '{}' failed.\".format(vgname)\n\nattach_status = json.loads(response.content)\nif attach_status['value']:\n  print \"INFO: Attaching vg '{}' Successful.\".format(vgname)\nelse:\n  print \"ERROR: Attaching vg '{}' failed.\".format(vgname)"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Attach VG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"957b3f6a-bd01-479f-8635-ae43c7aea0fa","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"if (\"@@{calm_array_index}@@\" -ne \"0\"){\n\texit\n}\n\n$FailOverClusterName='@@{FAILOVER_CLUSTER_NAME}@@'\n$FailOverVIP='@@{FAILOVER_VIP}@@'\n$Nodes=\"@@{calm_array_address}@@\".split(',')\nWrite-Output \"INFO: Testing Failover Cluster.\"\n\n# -*- Test Failover Cluster\n\nif(Test-Cluster -Node $Nodes){\n\tWrite-Output \"INFO: Test-Cluster Success.\"\n}\nelse\n{\n\tWrite-Output \"ERROR: Test-Cluster Failed.\"\n    exit 1\n}\n\nforeach ( $node in $(\"@@{calm_array_address}@@\".split(',')) ){Test-WSMan $node}\n\n# -*- Create Failover Cluster\n\nNew-Cluster -Name $FailOverClusterName -Node $Nodes -StaticAddress $FailOverVIP\n\n# -*- Rename Cluster Disks\n$ClusterDisks =  Get-CimInstance -ClassName MSCluster_Resource -Namespace root\/mscluster -Filter \"type = 'Physical Disk'\"\nforeach ($Disk in $ClusterDisks) {\n$DiskResource = Get-CimAssociatedInstance -InputObject $Disk -ResultClass MSCluster_DiskPartition\n\tif (-not ($DiskResource.VolumeLabel -eq $Disk.Name)) {\n\t\tInvoke-CimMethod -InputObject $Disk -MethodName Rename -Arguments @{newName = $DiskResource.VolumeLabel}\n  \t}\n}","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"6d258f96-9d6e-4896-903c-6b803e848d61"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure WSFC"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"c3d7de2c-6488-4be0-82ce-01ddd8bea78b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"New-IscsiTargetPortal -TargetPortalAddress @@{PE_DATA_SERVICE_IP}@@\nGet-IscsiTarget | Connect-IscsiTarget -IsPersistent $true\n\n#Initialize Disks\nif (((Get-Disk -Number 1 -ErrorAction SilentlyContinue).HealthStatus -eq \"Healthy\") -and ((Get-Disk -Number 2 -ErrorAction SilentlyContinue).HealthStatus -eq \"Healthy\")) {\n\tGet-Disk -Number 1 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 2 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 3 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 4 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 5 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 6 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 7 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 8 | Initialize-Disk -ErrorAction SilentlyContinue\n\tNew-Partition -DiskNumber 1 -UseMaximumSize -DriveLetter F -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -FileSystem NTFS -NewFileSystemLabel \"SQLINSTALL\" \n\tNew-Partition -DiskNumber 2 -UseMaximumSize -DriveLetter R -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"SQLBCK\"\n\tNew-Partition -DiskNumber 3 -UseMaximumSize -DriveLetter G -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"DATA01\" \n\tNew-Partition -DiskNumber 4 -UseMaximumSize -DriveLetter H -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"DATA02\"\n    New-Partition -DiskNumber 5 -UseMaximumSize -DriveLetter I -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"TEMPDB01\" \n\tNew-Partition -DiskNumber 6 -UseMaximumSize -DriveLetter J -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"TEMPDB02\"\n    New-Partition -DiskNumber 7 -UseMaximumSize -DriveLetter T -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"TEMPDBLOG01\" \n\tNew-Partition -DiskNumber 8 -UseMaximumSize -DriveLetter L -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"ULOG01\"\n\n} else {\n\tWrite-Output \"Disks does not exists or not healthy.`nIf you havent added disks please add 8 disk.\"\n\texit 1\n}\n\nif (\"@@{calm_array_index}@@\" -eq \"0\"){\n  if ((Get-Disk -Number 9 -ErrorAction SilentlyContinue).HealthStatus -eq \"Healthy\"){\n      Get-Disk -Number 9 | Initialize-Disk -ErrorAction SilentlyContinue\n      New-Partition -DiskNumber 9 -UseMaximumSize -DriveLetter W -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -FileSystem NTFS -NewFileSystemLabel \"Witness\" \n  } else {\n      Write-Output \"Witness Disk does not exists or not healthy.`nIf you havent added disks please add a volume group and attach.`n `t - Witness : 1GB\"\n      exit 1\n  }\n}\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Connect Mount VG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"fc643ea4-2ad8-4e16-8171-67d254e23543","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"if (\"$(Get-ClusterNode | where {$_.Id -eq 1} | select -ExpandProperty Name)\" -ne \"$(hostname)\"){\n\texit\n}\n$AGName = '@@{SQL_CLUSTER_NAME}@@'\n$PrimaryNode = $(hostname)\n$IP = '@@{MSSQL_VIP}@@\/255.255.255.0'\n$replicas = @()\n\n$cname = (Get-Cluster -name $PrimaryNode).name\n$nodes = (get-clusternode -Cluster $cname).name\n\n$sqlperms = @\"\nuse [master];\nGRANT ALTER ANY AVAILABILITY GROUP TO [NT AUTHORITY\\SYSTEM];\nGRANT CONNECT SQL TO [NT AUTHORITY\\SYSTEM];\nGRANT VIEW SERVER STATE TO [NT AUTHORITY\\SYSTEM];\n\"@\n\nforeach($node in $nodes)\n{\n\tInvoke-Sqlcmd -ServerInstance $node -Database master -Query $sqlperms\n\t$replicas += New-SqlAvailabilityReplica -Name $node -EndpointUrl \"TCP:\/\/$($node):5022\" -AvailabilityMode \"SynchronousCommit\" -FailoverMode \"Automatic\" -AsTemplate -Version 12 \n}\n\n\nNew-SqlAvailabilityGroup -Name $AGName -Path \"SQLSERVER:\\SQL\\$PrimaryNode\\DEFAULT\" -AvailabilityReplica $replicas\n$nodes | Where-Object {$_ -ne $PrimaryNode} | ForEach-Object {Join-SqlAvailabilityGroup -path \"SQLSERVER:\\SQL\\$_\\DEFAULT\" -Name $AGName}\nNew-SqlAvailabilityGroupListener -Name $AGName -staticIP $IP -Port 1433 -Path \"SQLSERVER:\\Sql\\$PrimaryNode\\DEFAULT\\AvailabilityGroups\\$AGName\"\n","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"6d258f96-9d6e-4896-903c-6b803e848d61"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Create AAG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"c48f54e3-eb21-4418-bd2d-f5623208e84a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"static","type":"","command_line_args":"","exit_status":[],"script":"#script\n\nif \"@@{calm_array_index}@@\" != \"0\":\n  exit(0)\nprism_ip = '@@{PE_IP}@@'\nusername = '@@{PE_CREDS.username}@@'\npassword = '@@{PE_CREDS.secret}@@'\nstorage_container_name = '@@{CONTAINER_NAME}@@'\nstorage_container_uuid = ''\nvgname = '@@{VG_NAME}@@'\n\napi_url = \"https:\/\/\" + prism_ip + \":9440\/PrismGateway\/services\/rest\/v2.0\/\"\n\nprint \"INFO: Retrieving storage container uuid for: {}.\".format(storage_container_name)\n\n# -*- Get Container UUID\n\nget_container_uuid_url = api_url + \"storage_containers\"\ntry:\n  response = urlreq(get_container_uuid_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\n  storage_containers = json.loads(response.content)\n  for container in storage_containers['entities']:\n    if container['name'] == storage_container_name:\n      storage_container_uuid = container['storage_container_uuid']\nexcept Exception as e:\n\tprint \"ERROR: Failed to get storage container uuid, check storage container name or check username\/password\"\n\tprint e.message\n\texit(1)\n\nprint \"INFO: storage container uuid is: {}.\".format(storage_container_uuid)\n\n# -*- Check volume group existance\n\ncheck_vg_url = api_url + \"volume_groups\"\nresponse = urlreq(check_vg_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\nvgs = json.loads(response.content)\nfor vg in vgs['entities']:\n  if vg['name'] == vgname:\n    print \"ERROR: Volume group with name {} already exists.\".format(vgname)\n    exit(1)\n\nprint \"INFO: Creating volume group '{}'.\".format(vgname)\n\n# -*- Create Volume Group\n\ncreate_vg_url = api_url + \"volume_groups\"\npayload = {\n\t\"disk_list\": [{\n\t\t\"create_config\": {\n\t\t\t\"size\": 1073741824,\n\t\t\t\"storage_container_uuid\": storage_container_uuid\n\t\t},\n\t\t\"index\": 0\n\t}],\n\t\"is_shared\": True,\n\t\"name\": vgname\n}\n\nresponse = urlreq(create_vg_url, verb='POST', auth=\"BASIC\", user=username, passwd=password, params=json.dumps(payload), verify=False)\nif response.status_code != 201:\n\tprint \"ERROR: creation of volume group '{}' failed.\".format(vgname)\n\nvg_create_status = json.loads(response.content)\ntask_uuid = vg_create_status['task_uuid']\n\nsleep(5)\n\ncheck_vg_creation_url = api_url + \"tasks\/\" + task_uuid\nresponse = response = urlreq(check_vg_creation_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\nvg_create_status = json.loads(response.content)\n\nif vg_create_status['progress_status'] != \"Succeeded\":\n\tprint \"ERROR: creation of volume group '{}' failed.\".format(vgname)\n\texit(1)\nelse:\n\tprint \"INFO: creation of volume group '{}' Successful.\".format(vgname)"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Create VG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"7991a817-2640-4c3a-813a-611b3ae09452","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"# -*- Variable for T-SQL command\n$netbios = \"@@{DOMAIN}@@\".Split(\".\")[0].ToUpper()\n$createLogin = \"CREATE LOGIN [$netbios\\sqlservice] FROM WINDOWS; \" \n$grantConnectPermissions = \"GRANT CONNECT ON ENDPOINT::Endpoint_AG TO [$netbios\\sqlservice];\"\n\nEnable-SqlAlwaysOn -ServerInstance $(hostname) -Force \nNew-SqlHADREndpoint -Path \"SQLSERVER:\\SQL\\$(hostname)\\DEFAULT\" -Name \"Endpoint_AG\" -Port 5022 -EncryptionAlgorithm Aes -Encryption Required \nSet-SqlHADREndpoint -Path \"SQLSERVER:\\SQL\\$(hostname)\\DEFAULT\\Endpoints\\Endpoint_AG\" -State Started\nInvoke-SqlCmd -Server $(hostname) -Query $createLogin\nInvoke-SqlCmd -Server $(hostname) -Query $grantConnectPermissions","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"6d258f96-9d6e-4896-903c-6b803e848d61"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Enable AAG"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"0f4471ce-096e-469e-9f69-c9339d1067f0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"Write-Output \"IQN=$((Get-InitiatorPort).NodeAddress)\"","eval_variables":["IQN"],"eval_scope":"local","type":"","script_type":"npsscript"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Get IQN"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"d8c7a910-e915-4093-8b29-9891952a2b60","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"Install-WindowsFeature -Name Failover-Clustering -IncludeManagementTools\n\nif (-not (get-WindowsFeature -Name Failover-Clustering -ErrorAction SilentlyContinue | select -ExpandProperty Installed)){\n\tWrite-output \"Failover Clustering is not installed\"\n\texit 1\n}"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Install FC"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"3229ae0a-055e-4faf-ad5e-d0935fdf98ad","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"Install-WindowsFeature -IncludeAllSubFeature -ErrorAction Stop \"Net-Framework-Core\"\n$DOMAINNAME=(Get-WmiObject Win32_ComputerSystem).Domain\n$setupDriveLetter = \"D:\"\n$setupPath = \"$setupDriveLetter\\setup.exe\"\n$silentArgs = \"\/IACCEPTSQLSERVERLICENSETERMS \/Q \/ACTION=install \/FEATURES=SQLENGINE,FULLTEXT,SSMS,ADV_SSMS \/AGTSVCACCOUNT=`\"@@{SQL_CREDS.username}@@`\" \/AGTSVCPASSWORD=@@{SQL_CREDS.secret}@@ \/SQLSVCACCOUNT=`\"@@{SQL_CREDS.username}@@`\" \/SQLSVCPASSWORD=@@{SQL_CREDS.secret}@@ \/SQLSYSADMINACCOUNTS=`\"$DOMAINNAME\\Domain Admins`\" \/ISSVCACCOUNT=`\"@@{SQL_CREDS.username}@@`\" \/ISSVCPASSWORD=@@{SQL_CREDS.secret}@@ \/ASSYSADMINACCOUNTS=`\"@@{SQL_CREDS.username}@@`\" \/INSTANCEID=MSSQLSERVER \/INSTANCENAME=MSSQLSERVER \/UPDATEENABLED=True \/UPDATESOURCE=`\"C:\\Temp`\" \/INDICATEPROGRESS \/TCPENABLED=1 \/INSTALLSQLDATADIR=`\"F:\\MSSQL`\" \/SQLUSERDBLOGDIR=`\"L:\\MSSQL`\" \/SQLTEMPDBLOGDIR=`\"T:\\MSSQL`\"\"\n$validExitCodes = @(0)\n\n$install = Start-Process -FilePath $setupPath -ArgumentList $silentArgs -Wait -NoNewWindow -PassThru\n$install.WaitForExit()\n$exitCode = $install.ExitCode\n$install.Dispose()\n\nWrite-Output \"SQL Failover Cluster Installation exited with `'$exitCode`'.\"\nif ($validExitCodes -notcontains $exitCode) {\n\tWrite-Output \"Running [`\"$setupPath`\" $silentArgs] was not successful. Exit code was '$exitCode'. See log for possible error messages.\"\n\texit 1\n}","script_type":"npsscript","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"6d258f96-9d6e-4896-903c-6b803e848d61"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Install SQL"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"39bb7402-9ada-4ee1-a348-ad63df7d1407","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"##############################################\n# Name        : JoinDomain\n# Author      : K Sarat Kumar\n# Version     : 1.0\n# Description : Script is used to join to domain.\n##############################################\n\nfunction JointoDomain {\n  [CmdletBinding()]\n  Param(\n      [parameter(Mandatory=$true)]\n      [string]$DomainName,\n      [parameter(Mandatory=$false)]\n      [string]$OU,\n      [parameter(Mandatory=$true)]\n      [string]$Username,\n      [parameter(Mandatory=$true)]\n      [string]$Password,\n      [parameter(Mandatory=$true)]\n      [string]$Server\n  )\n  $adapter = Get-NetAdapter | ? {$_.Status -eq \"up\"}\n  $adapter | Set-DnsClientServerAddress -ServerAddresses $Server\n\n  if ($env:computername  -eq $env:userdomain) {\n    Write-Host \"Not in domain\"\n    $adminname = \"$Username\"\n    $adminpassword = ConvertTo-SecureString -asPlainText -Force -String \"$Password\"\n    Write-Host \"$adminname , $password\"\n    $credential = New-Object System.Management.Automation.PSCredential($adminname,$adminpassword)\n    Add-computer -DomainName $DomainName -Credential $credential -force -Options JoinWithNewName,AccountCreate -PassThru -ErrorAction Stop\n  } else {\n     Write-Host \"Already in domain\"\n  }\n}\n\nJointoDomain -DomainName \"@@{DOMAIN}@@\" -Username \"@@{DOMAIN_CRED.username}@@\" -Password \"@@{DOMAIN_CRED.secret}@@\" -Server \"@@{AD_IP}@@\"\n\nRestart-Computer -Force -AsJob\nexit 0"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"JoinDomain"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","description":"","type":"EXEC","uuid":"64d06e54-4d78-42ea-b723-2d77cc9f3a18","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"npsscript","type":"","command_line_args":"","exit_status":[],"script":"##############################################\n# Name        : Pre-requisites\n# Author      : K Sarat Kumar\n# Version     : 1.0\n# Description : Script is used to join to domain.\n##############################################\n\n# -*- Pre-requisite to enable credssp and set 'Server' role\nEnable-WSManCredSSP -Role Server -Force\n\n# -*- Enabling and starting 'msiscsi'\nSet-Service -Name msiscsi -StartupType Automatic\nStart-Service msiscsi\n\n# -*- Change first Ehternet adapter name to 'Production'\nGet-NetAdapter -Name \"Ethernet\" | Rename-NetAdapter -NewName \"Production\" -ErrorAction SilentlyContinue\n\n# -*- Download SQL Updates\n$TempDirectory = \"C:\\Temp\"\nNew-Item -ItemType Directory -Force -Path $TempDirectory\n(New-Object System.Net.WebClient).DownloadFile(\"http:\/\/10.46.1.165\/data1\/ISOs\/SQLServer2014-KB4052725-x64.exe\",\"$TempDirectory\\SQLServer2014-KB4052725-x64.exe\")\nSet-NetFirewallProfile -Profile Domain,Public,Private -Enabled False"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Pre Requisites"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL_AAG","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","description":"","type":"EXEC","uuid":"113beadd-e1ca-43f8-8cbf-c65d49852086","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"static","type":"","command_line_args":"","exit_status":[],"script":"#script\nsleep(50)"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Sleep"}],"description":"","message_list":[],"uuid":"cf254e8d-da7c-40f5-8252-abea0d8d0e3d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"ddaf74d2_dag","uuid":"0660260c-5415-4a23-90e0-ceb0af24dbfb"},"name":"0561ade3_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","description":"","type":"DAG","uuid":"f1ec0a18-88a4-466c-9fe4-0e75ddf1d4e2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"7bf7eecb_dag"}],"description":"","message_list":[],"uuid":"80334a55-16d3-4e61-9608-44dc01af349b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"7bf7eecb_dag","uuid":"f1ec0a18-88a4-466c-9fe4-0e75ddf1d4e2"},"name":"f564b0c1_runbook"}},"variable_list":[],"name":"AHV MSSQL Package"}]},"name":"MSSQL AAG"},"spec":{"name":"MSSQL AAG","resources":{"service_definition_list":[{"singleton":false,"name":"MSSQL_AAG","action_list":[{"description":"System action for creating an application","name":"action_create","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b","name":"MSSQL"},"retries":"0","description":"","uuid":"7ba7ced6-5d29-4cef-ba32-ae65e33201d8","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"98f8161b_dag"}],"description":"","uuid":"900ad31c-a000-48b9-b51c-b7c546c67434","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"98f8161b_dag","uuid":"7ba7ced6-5d29-4cef-ba32-ae65e33201d8"},"name":"dade7481_runbook"},"type":"system","uuid":"b035bcb4-1bf9-4413-afa5-a40b760eacdc"},{"description":"System action for deleting an application. Deletes created VMs as well","name":"action_delete","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b","name":"MSSQL"},"retries":"0","description":"","uuid":"c1850f1c-987a-4995-9bbc-5d48b03c12ca","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"02628fa5_dag"}],"description":"","uuid":"448b8840-3dc8-408f-a3b3-75646791952c","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"02628fa5_dag","uuid":"c1850f1c-987a-4995-9bbc-5d48b03c12ca"},"name":"59afb4f4_runbook"},"type":"system","uuid":"101c0df2-473c-435c-991e-99f1ecbb0223"},{"description":"System action for restarting an application","name":"action_restart","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b","name":"MSSQL"},"retries":"0","description":"","uuid":"37f61b09-731f-4a7c-8953-d990dbfc8b0a","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"27dfdc04_dag"}],"description":"","uuid":"de0c2ef6-7931-43c2-8812-cf3ea6fcaca6","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"27dfdc04_dag","uuid":"37f61b09-731f-4a7c-8953-d990dbfc8b0a"},"name":"4150545e_runbook"},"type":"system","uuid":"7c31fafc-f3d2-46f1-b371-a3c6ea9cadce"},{"description":"System action for starting an application","name":"action_start","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b","name":"MSSQL"},"retries":"0","description":"","uuid":"f6ffb5b0-2fe0-4461-8618-7343344dd0d5","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"8e5f51b4_dag"}],"description":"","uuid":"e8e4abb3-204f-432b-afe9-944b40eb96ca","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"8e5f51b4_dag","uuid":"f6ffb5b0-2fe0-4461-8618-7343344dd0d5"},"name":"11876906_runbook"},"type":"system","uuid":"29c68c28-844c-4373-bb17-c41e12fb89a7"},{"description":"System action for stopping an application","name":"action_stop","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b","name":"MSSQL"},"retries":"0","description":"","uuid":"24e26d97-06d9-481a-984d-09b7ba2c4ebb","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"1a17e568_dag"}],"description":"","uuid":"1f317491-b3c2-4dd3-bdc7-15aeb1e33b0a","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"1a17e568_dag","uuid":"24e26d97-06d9-481a-984d-09b7ba2c4ebb"},"name":"d2728354_runbook"},"type":"system","uuid":"2a8dc4fe-174a-4fbb-aba7-bb6bf6e55019"}],"description":"","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b","port_list":[],"tier":"","variable_list":[{"val_type":"STRING","description":"","uuid":"167b49eb-fbc7-42f8-b8fa-97065080bb7d","value":"","label":"","attrs":{"type":""},"type":"LOCAL","name":"IQN"}],"depends_on_list":[]}],"substrate_definition_list":[{"name":"AHV_MSSQL","action_list":[],"uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d","readiness_probe":{"connection_type":"POWERSHELL","retries":"5","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"30","connection_port":5985,"login_credential_local_reference":{"kind":"app_credential","name":"LOCAL","uuid":"1306b8bf-61d0-49f7-b176-acaf383a01bc"}},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":null},"create_spec":{"name":true,"resources":{"nic_list":{},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"guest_customization":true,"disk_list":{}}}},"os_type":"Windows","type":"AHV_VM","create_spec":{"name":"MSSQL-@@{calm_unique}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"718f9bd2-7aed-43cb-9fae-fe984c162b57"},"type":""},{"nic_type":"NORMAL_NIC","network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"718f9bd2-7aed-43cb-9fae-fe984c162b57"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"gpu_list":[],"memory_size_mib":4096,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":null,"type":"","sysprep":{"install_type":"PREPARED","unattend_xml":"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<unattend xmlns=\"urn:schemas-microsoft-com:unattend\">\n   <settings pass=\"specialize\">\n      <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Microsoft-Windows-Shell-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n         <ComputerName>@@{name}@@<\/ComputerName>\n         <RegisteredOrganization>Nutanix<\/RegisteredOrganization>\n         <RegisteredOwner>Acropolis<\/RegisteredOwner>\n         <TimeZone>UTC<\/TimeZone>\n      <\/component>\n      <component xmlns=\"\" name=\"Microsoft-Windows-TerminalServices-LocalSessionManager\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" processorArchitecture=\"amd64\">\n         <fDenyTSConnections>false<\/fDenyTSConnections>\n      <\/component>\n      <component xmlns=\"\" name=\"Microsoft-Windows-TerminalServices-RDP-WinStationExtensions\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" processorArchitecture=\"amd64\">\n         <UserAuthentication>0<\/UserAuthentication>\n      <\/component>\n      <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Networking-MPSSVC-Svc\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n         <FirewallGroups>\n            <FirewallGroup wcm:action=\"add\" wcm:keyValue=\"RemoteDesktop\">\n               <Active>true<\/Active>\n               <Profile>all<\/Profile>\n               <Group>@FirewallAPI.dll,-28752<\/Group>\n            <\/FirewallGroup>\n         <\/FirewallGroups>\n      <\/component>\n   <\/settings>\n   <settings pass=\"oobeSystem\">\n      <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Microsoft-Windows-Shell-Setup\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n         <UserAccounts>\n            <AdministratorPassword>\n               <Value>@@{LOCAL.secret}@@<\/Value>\n               <PlainText>true<\/PlainText>\n            <\/AdministratorPassword>\n         <\/UserAccounts>\n         <AutoLogon>\n            <Password>\n               <Value>@@{LOCAL.secret}@@<\/Value>\n               <PlainText>true<\/PlainText>\n            <\/Password>\n            <Enabled>true<\/Enabled>\n            <Username>Administrator<\/Username>\n         <\/AutoLogon>\n         <FirstLogonCommands>\n            <SynchronousCommand wcm:action=\"add\">\n               <CommandLine>cmd.exe \/c netsh firewall add portopening TCP 5985 \"Port 5985\"<\/CommandLine>\n               <Description>Win RM port open<\/Description>\n               <Order>1<\/Order>\n               <RequiresUserInput>true<\/RequiresUserInput>\n            <\/SynchronousCommand>\n         <\/FirstLogonCommands>\n         <OOBE>\n            <HideEULAPage>true<\/HideEULAPage>\n            <SkipMachineOOBE>true<\/SkipMachineOOBE>\n         <\/OOBE>\n      <\/component>\n      <component xmlns:wcm=\"http:\/\/schemas.microsoft.com\/WMIConfig\/2002\/State\" xmlns:xsi=\"http:\/\/www.w3.org\/2001\/XMLSchema-instance\" name=\"Microsoft-Windows-International-Core\" processorArchitecture=\"amd64\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\">\n         <InputLocale>en-US<\/InputLocale>\n         <SystemLocale>en-US<\/SystemLocale>\n         <UILanguageFallback>en-us<\/UILanguageFallback>\n         <UILanguage>en-US<\/UILanguage>\n         <UserLocale>en-US<\/UserLocale>\n      <\/component>\n   <\/settings>\n<\/unattend>","type":""}},"power_state":"ON","type":"","account_uuid":"718f9bd2-7aed-43cb-9fae-fe984c162b57","boot_config":{"boot_device":{"type":"","disk_address":{"device_index":0,"adapter_type":"SCSI"}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"image","name":"WindowsServer2016.qcow2","uuid":"5c93e8c5-cad2-4b3e-bdea-10062795634d"},"device_properties":{"device_type":"DISK","disk_address":{"device_index":0,"adapter_type":"SCSI"}}},{"data_source_reference":{"kind":"image","name":"SQLServer2014SP2-FullSlipstream-x64-ENU","uuid":"a2b648c0-fb1f-4380-8371-07ebe54b00a3"},"device_properties":{"device_type":"CDROM","disk_address":{"device_index":1,"adapter_type":"IDE"}}},{"device_properties":{"device_type":"DISK","disk_address":{"device_index":2,"adapter_type":"SCSI"}},"disk_size_mib":51200},{"device_properties":{"device_type":"DISK","disk_address":{"device_index":3,"adapter_type":"SCSI"}},"disk_size_mib":153600},{"device_properties":{"device_type":"DISK","disk_address":{"device_index":4,"adapter_type":"SCSI"}},"disk_size_mib":307200},{"device_properties":{"device_type":"DISK","disk_address":{"device_index":5,"adapter_type":"SCSI"}},"disk_size_mib":307200},{"device_properties":{"device_type":"DISK","disk_address":{"device_index":6,"adapter_type":"SCSI"}},"disk_size_mib":102400},{"device_properties":{"device_type":"DISK","disk_address":{"device_index":7,"adapter_type":"SCSI"}},"disk_size_mib":102400},{"device_properties":{"device_type":"DISK","disk_address":{"device_index":8,"adapter_type":"SCSI"}},"disk_size_mib":204800},{"device_properties":{"device_type":"DISK","disk_address":{"device_index":9,"adapter_type":"SCSI"}},"disk_size_mib":204800}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[],"description":""}],"credential_definition_list":[{"username":"administrator@mssql.com","uuid":"6d258f96-9d6e-4896-903c-6b803e848d61","name":"DOMAIN_CRED","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{"uuid":"d775f3ec-9663-4d5e-97cb-07d7db691e2a"}}},"type":"PASSWORD","description":""},{"username":"administrator","uuid":"1306b8bf-61d0-49f7-b176-acaf383a01bc","name":"LOCAL","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{"uuid":"63941d0c-f3d5-4439-8666-189d258ab1eb"}}},"type":"PASSWORD","description":""},{"username":"admin","uuid":"c5acd72f-caa6-4878-a584-4dbe9fefcd70","name":"PE_CREDS","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{"uuid":"3fa28002-7adc-4513-9470-d8b2472c12c7"}}},"type":"PASSWORD","description":""},{"username":"mssql\\sqlservice","uuid":"06f26a1e-076f-4840-afc2-4066d5842824","name":"SQL_CREDS","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{"uuid":"ce5bb877-8c70-4204-89ce-6bd6afec28ee"}}},"type":"PASSWORD","description":""}],"type":"USER","app_profile_list":[{"deployment_create_list":[{"name":"5aed8000_deployment","action_list":[],"package_local_reference_list":[{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"}],"description":"","published_service_local_reference_list":[],"min_replicas":"2","depends_on_list":[],"max_replicas":"2","substrate_local_reference":{"kind":"app_substrate","name":"AHV_MSSQL","uuid":"f5f34d48-5ed8-4796-93b3-5e273294ea9d"},"type":"GREENFIELD","variable_list":[],"uuid":"94e0cc1c-70cf-4bec-b743-42304577db9b"}],"description":"","action_list":[],"name":"Nutanix","variable_list":[{"val_type":"STRING","description":"","uuid":"c5c2efe4-0d7d-414c-aa0e-9663105b30e4","value":"10.46.6.4","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"AD_IP"},{"val_type":"STRING","description":"","uuid":"467de542-9f10-47ef-8ca9-a323c4abee51","value":"http:\/\/download.microsoft.com\/download\/8\/e\/c\/8ec3a7d8-05b4-440a-a71e-ca3ee25fe057\/rktools.exe","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"BPG_RKTOOLS_URL"},{"val_type":"STRING","description":"","uuid":"9d436195-e583-4aaf-9e2b-6b9d6f128997","value":"default-container-71229","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"CONTAINER_NAME"},{"val_type":"STRING","description":"","uuid":"4fb7334b-7f13-4285-9884-ce56a377364c","value":"mssql.com","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"DOMAIN"},{"val_type":"STRING","description":"","uuid":"015b3141-4d26-4021-87cd-0c857afe4136","value":"NTNX-CLS01","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"FAILOVER_CLUSTER_NAME"},{"val_type":"STRING","description":"","uuid":"ae8e0956-2314-4a5b-9e01-6f4ac3b50ed9","value":"10.46.136.9","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"FAILOVER_VIP"},{"val_type":"STRING","description":"","uuid":"47cf9691-da0f-4d18-90be-bcf89885a8d0","value":"10.46.136.10","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"MSSQL_VIP"},{"val_type":"STRING","description":"","uuid":"b0ffec11-870c-4343-a749-be5e129214b2","value":"10.46.32.5","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"PE_DATA_SERVICE_IP"},{"val_type":"STRING","description":"","uuid":"ae991897-675b-4406-a214-c6f84f22c0fb","value":"10.46.32.4","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"PE_IP"},{"val_type":"STRING","description":"","uuid":"fbef9d71-80e3-4d94-ab87-92d461f4bc51","value":"NTNX-SQLCLS01","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"SQL_CLUSTER_NAME"},{"val_type":"STRING","description":"","uuid":"90c2a8e5-5a5c-41d8-b236-647e3f29cd51","value":"SQL_VolumeGroup01","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"VG_NAME"}],"uuid":"54d19394-b546-4948-8fd6-cc869fabe45b"}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"LOCAL","uuid":"1306b8bf-61d0-49f7-b176-acaf383a01bc"},"package_definition_list":[{"uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32","action_list":[],"service_local_reference_list":[{"kind":"app_service","name":"MSSQL","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"}],"name":"AHV MSSQL Package","version":"","type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","name":"Apply OS BPG","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"$start_time = Get-Date\n\n$TempDirectory = \"C:\\Temp\"\n$RktTemp = \"$TempDirectory\\rktools.2003\"\n\n$url = \"@@{BPG_RKTOOLS_URL}@@\"\n$filePath = \"$TempDirectory\\rktools.exe\"\n\nNew-Item -ItemType Directory -Force -Path $TempDirectory\n(New-Object System.Net.WebClient).DownloadFile($url,$filePath)\n\n& $filePath \/Q \/T:\"$RktTemp\" \/C\n\nStart-Sleep 10\n\n$PackageName = \"rktools.2003\"\n$setupPath = \"C:\\Windows\\System32\\msiexec.exe\"\n$silentArgs = \"\/i $RktTemp\\rktools.msi \/qn\"\n$validExitCodes = @(0)\n\nWrite-Output \"Installing $PackageName....\"\n\n$install = Start-Process -FilePath $setupPath -ArgumentList $silentArgs -Wait -NoNewWindow -PassThru\n$install.WaitForExit()\n\n$exitCode = $install.ExitCode\n$install.Dispose()\n\nWrite-Output \"Command [`\"$setupPath`\" $silentArgs] exited with `'$exitCode`'.\"\nif ($validExitCodes -notcontains $exitCode) {\n\tWrite-Output \"Running [`\"$setupPath`\" $silentArgs] was not successful. Exit code was '$exitCode'. See log for possible error messages.\"\n\texit 1\n}\n\n# OS related tunning\n# Set Windows Power Options to High Performance\npowercfg -s 8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c\n\n#Grant Memory privileges to user \n$ntrights_cli = \"C:\\Program Files (x86)\\Windows Resource Kits\\Tools\\ntrights.exe\"\n& $ntrights_cli -u \"NT SERVICE\\MSSQLSERVER\" +r SeLockMemoryPrivilege\n& $ntrights_cli -u \"NT SERVICE\\MSSQLSERVER\" +r SeManageVolumePrivilege\n\nWrite-Output \"Time taken: $((Get-Date).Subtract($start_time).seconds) Second(s)\"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"6d258f96-9d6e-4896-903c-6b803e848d61"},"type":"","command_line_args":"","script_type":"npsscript"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"c5c03e88-dd51-4252-ae67-bcece8e0ab3e"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","name":"Apply SQL BPG","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"$start_time = Get-Date\n\n$TempDirectory = \"C:\\Temp\"\n$sqladdparms_cli = \"$TempDirectory\\Add-SqlServerStartupParameter.ps1\"\n$TSQLSCRIPTSDIR = \"$TempDirectory\\TSQL_Scripts\"\nNew-Item -ItemType Directory -Force -Path $TSQLSCRIPTSDIR\n  \nSet-Content -Path \"$sqladdparms_cli\" -Value '\nparam(\n    ## The parameter you wish to add\n    [Parameter(Mandatory = $true)]\n    $StartupParameter\n)\n\n$hklmRootNode = \"HKLM:\\SOFTWARE\\Microsoft\\Microsoft SQL Server\"\n\n$props = Get-ItemProperty \"$hklmRootNode\\Instance Names\\SQL\"\n$instances = $props.psobject.properties | ?{$_.Value -like \"MSSQL*\"} | select Value\n\n$instances | %{\n    $inst = $_.Value;\n    $regKey = \"$hklmRootNode\\$inst\\MSSQLServer\\Parameters\"\n    $props = Get-ItemProperty $regKey\n    $params = $props.psobject.properties | ?{$_.Name -like \"SQLArg*\"} | select Name, Value\n    #$params | ft -AutoSize\n    $hasFlag = $false\n    foreach ($param in $params) {\n        if($param.Value -eq $StartupParameter) {\n            $hasFlag = $true\n            break;\n        }\n    }\n    if (-not $hasFlag) {\n        \"Adding $StartupParameter\"\n        $newRegProp = \"SQLArg\"+($params.Count)\n        Set-ItemProperty -Path $regKey -Name $newRegProp -Value $StartupParameter\n    } else {\n        \"$StartupParameter already set\"\n    }\n}'\nSet-Content -Path \"$TSQLSCRIPTSDIR\\01-ChangeTempDB.sql\" -Value \"use master`r`n\ngo`r`n\nAlter database tempdb modify file (name = tempdev, filename = 'I:\\TEMPDB01\\tempdb01.mdf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb modify file (name = templog, filename = 'T:\\TempDB-logs01\\templog01.ldf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb ADD file (name = tempdev02, filename = 'I:\\TEMPDB01\\tempdb02.ndf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb ADD file (name = tempdev03, filename = 'J:\\TEMPDB02\\tempdb03.ndf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\nAlter database tempdb ADD file (name = tempdev04, filename = 'J:\\TEMPDB02\\tempdb04.ndf', SIZE = 4096, FILEGROWTH=0)`r`n\ngo`r`n\n`r`n\nALTER DATABASE [tempdb] MODIFY FILE (NAME=N'tempdev', NEWNAME=N'tempdev01')`r`n\nGO`r`n\nALTER DATABASE [tempdb] MODIFY FILE (NAME=N'templog', NEWNAME=N'templog01')`r`n\nGO\"\n\nSet-Content -Path \"$TSQLSCRIPTSDIR\\02-IncreaseTempDB_logs.sql\" -Value \"Use master`r`n\ngo`r`n\nALTER DATABASE tempdb MODIFY FILE (NAME = templog01, filename = 'T:\\TempDB-logs01\\templog01.ldf', SIZE`r`n\n= 8096);`r`n\nGO`r`n\nALTER DATABASE tempdb MODIFY FILE (NAME = templog01, FILENAME = 'T:\\TempDB-logs01\\templog01.ldf', SIZE`r`n\n= 12288);`r`n\nGO\"\n\nSet-Content -Path \"$TSQLSCRIPTSDIR\\03-SQL_set_memory.sql\" -Value \"USE master;`r`n\nexec sp_configure 'show advanced options', 1;`r`n\nRECONFIGURE;`r`n\nGO`r`n\nDECLARE `r`n\n        @total_mem decimal (10,0),`r`n\n\t\t@min int,`r`n\n\t\t@max int`r`n\nSELECT `r`n\n   --SELECT (physical_memory_kb\/1024) AS Server_Physical_Memory_MB`r`n\n  @total_mem = (physical_memory_kb\/1024)`r`n\nFROM sys.dm_os_sys_info`r`n\n`r`n\nset @min = @total_mem * 0.1`r`n\nset @max = @total_mem * 0.85`r`n\nprint @min`r`n\nprint @max`r`n\n--print @total_mem`r`n\n`r`n\n`r`n\nEXEC sp_configure 'min server memory (MB)',@min`r`n\nEXEC sp_configure 'max server memory (MB)',@max`r`n\nRECONFIGURE\"\n\nSet-Content -Path \"$TSQLSCRIPTSDIR\\04-SQL-ChangeDefaultPaths.sql\" -Value \"USE [master]`r`n\nGO`r`n\n-- Change default location for data files`r`n\nEXEC xp_instance_regwrite`r`n\nN'HKEY_LOCAL_MACHINE',`r`n\nN'Software\\Microsoft\\MSSQLServer\\MSSQLServer',`r`n\nN'DefaultData',`r`n\nREG_SZ,`r`n\nN'G:\\SQLDATA01'`r`n\nGO`r`n\n-- Change default location for log files`r`n\nEXEC xp_instance_regwrite`r`n\nN'HKEY_LOCAL_MACHINE',`r`n\nN'Software\\Microsoft\\MSSQLServer\\MSSQLServer',`r`n\nN'DefaultLog',`r`n\nREG_SZ,`r`n\nN'L:\\UserDB-logs01'`r`n\nGO`r`n\n-- Change default location for backups`r`n\nEXEC xp_instance_regwrite`r`n\nN'HKEY_LOCAL_MACHINE',`r`n\nN'Software\\Microsoft\\MSSQLServer\\MSSQLServer',`r`n\nN'BackupDirectory',`r`n\nREG_SZ,`r`n\nN'R:\\SQLBACK'`r`n\nGO\"\n\n#create directories\nmkdir G:\\SQLDATA01\\\nmkdir H:\\SQLDATA02\\\nmkdir I:\\TEMPDB01\\\nmkdir J:\\TEMPDB02\\\nmkdir L:\\UserDB-logs01\\\nmkdir T:\\TempDB-logs01\\\nmkdir R:\\SQLBACK\n\n#ADD SQL T parameters \n#T1117 This parameter forces MS SQL Server to grow all database files uniformly\n#T1118 This parameter forces MS SQL Server to use full extents only\n& $sqladdparms_cli '-T1117'\n& $sqladdparms_cli '-T1118'\nrestart-service MSSQL* -force\n\n#import powershell SQL module\nimport-module \"sqlps\" -DisableNameChecking\n\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\01-ChangeTempDB.sql\"\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\02-IncreaseTempDB_logs.sql\"\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\03-SQL_set_memory.sql\"\ninvoke-sqlcmd -hostname localhost -inputFile \"$TSQLSCRIPTSDIR\\04-SQL-ChangeDefaultPaths.sql\"\n\n#Delete original SQL temp files\nstop-service MSSQL* \nStart-Sleep 5\nrm \"F:\\MSSQL\\MSSQL12.MSSQLSERVER\\MSSQL\\DATA\\temp*\"\n\nstart-service MSSQL* \nwmic useraccount get sid\nWrite-Output \"Time taken: $((Get-Date).Subtract($start_time).seconds) Second(s)\"","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"6d258f96-9d6e-4896-903c-6b803e848d61"},"type":"","command_line_args":"","script_type":"npsscript"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"dabbb680-d05c-408d-9063-310b308a0bfb"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","name":"Attach VG","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#script\nprism_ip = '@@{PE_IP}@@'\nusername = '@@{PE_CREDS.username}@@'\npassword = '@@{PE_CREDS.secret}@@'\nvgname = '@@{VG_NAME}@@'\nvg_uuid = ''\nIQN='@@{IQN}@@'\n\napi_url = \"https:\/\/\" + prism_ip + \":9440\/PrismGateway\/services\/rest\/v2.0\/\"\n\nprint \"INFO: Attaching VG {} to node.\".format(vgname)\n\n# -*- Check volume group existance\n\ntry:\n  check_vg_url = api_url + \"volume_groups\"\n  response = urlreq(check_vg_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\n  vgs = json.loads(response.content)\n  for vg in vgs['entities']:\n    if vg['name'] == vgname:\n      vg_uuid = vg['uuid']\nexcept Exception as e:\n\tprint \"ERROR: Failed to get volume group, check volume group or check username\/password\"\n\tprint e.message\n\texit(1)\n    \nif vg_uuid == '':\n  print \"ERROR: Volume group with name {} doesn't exists\".format(vgname)\n  exit(1)\n\n# -*- Attach Volume Group\n\nattach_vg_url = api_url + \"volume_groups\/\" + vg_uuid + \"\/open\"\npayload = {\n  \"iscsi_client\": {\n    \"client_address\": IQN\n  },\n  \"operation\": \"ATTACH\"\n}\n\nresponse = urlreq(attach_vg_url, verb='POST', auth=\"BASIC\", user=username, passwd=password, params=json.dumps(payload), verify=False)\nif response.status_code != 201:\n\tprint \"ERROR: Attaching vg '{}' failed.\".format(vgname)\n\nattach_status = json.loads(response.content)\nif attach_status['value']:\n  print \"INFO: Attaching vg '{}' Successful.\".format(vgname)\nelse:\n  print \"ERROR: Attaching vg '{}' failed.\".format(vgname)","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"28d71afc-ce41-4154-a78f-c05337f3f60b"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","name":"Configure WSFC","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"if (\"@@{calm_array_index}@@\" -ne \"0\"){\n\texit\n}\n\n$FailOverClusterName='@@{FAILOVER_CLUSTER_NAME}@@'\n$FailOverVIP='@@{FAILOVER_VIP}@@'\n$Nodes=\"@@{calm_array_address}@@\".split(',')\nWrite-Output \"INFO: Testing Failover Cluster.\"\n\n# -*- Test Failover Cluster\n\nif(Test-Cluster -Node $Nodes){\n\tWrite-Output \"INFO: Test-Cluster Success.\"\n}\nelse\n{\n\tWrite-Output \"ERROR: Test-Cluster Failed.\"\n    exit 1\n}\n\nforeach ( $node in $(\"@@{calm_array_address}@@\".split(',')) ){Test-WSMan $node}\n\n# -*- Create Failover Cluster\n\nNew-Cluster -Name $FailOverClusterName -Node $Nodes -StaticAddress $FailOverVIP\n\n# -*- Rename Cluster Disks\n$ClusterDisks =  Get-CimInstance -ClassName MSCluster_Resource -Namespace root\/mscluster -Filter \"type = 'Physical Disk'\"\nforeach ($Disk in $ClusterDisks) {\n$DiskResource = Get-CimAssociatedInstance -InputObject $Disk -ResultClass MSCluster_DiskPartition\n\tif (-not ($DiskResource.VolumeLabel -eq $Disk.Name)) {\n\t\tInvoke-CimMethod -InputObject $Disk -MethodName Rename -Arguments @{newName = $DiskResource.VolumeLabel}\n  \t}\n}","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"6d258f96-9d6e-4896-903c-6b803e848d61"},"type":"","command_line_args":"","script_type":"npsscript"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"957b3f6a-bd01-479f-8635-ae43c7aea0fa"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","name":"Connect Mount VG","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"New-IscsiTargetPortal -TargetPortalAddress @@{PE_DATA_SERVICE_IP}@@\nGet-IscsiTarget | Connect-IscsiTarget -IsPersistent $true\n\n#Initialize Disks\nif (((Get-Disk -Number 1 -ErrorAction SilentlyContinue).HealthStatus -eq \"Healthy\") -and ((Get-Disk -Number 2 -ErrorAction SilentlyContinue).HealthStatus -eq \"Healthy\")) {\n\tGet-Disk -Number 1 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 2 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 3 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 4 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 5 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 6 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 7 | Initialize-Disk -ErrorAction SilentlyContinue\n\tGet-Disk -Number 8 | Initialize-Disk -ErrorAction SilentlyContinue\n\tNew-Partition -DiskNumber 1 -UseMaximumSize -DriveLetter F -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -FileSystem NTFS -NewFileSystemLabel \"SQLINSTALL\" \n\tNew-Partition -DiskNumber 2 -UseMaximumSize -DriveLetter R -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"SQLBCK\"\n\tNew-Partition -DiskNumber 3 -UseMaximumSize -DriveLetter G -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"DATA01\" \n\tNew-Partition -DiskNumber 4 -UseMaximumSize -DriveLetter H -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"DATA02\"\n    New-Partition -DiskNumber 5 -UseMaximumSize -DriveLetter I -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"TEMPDB01\" \n\tNew-Partition -DiskNumber 6 -UseMaximumSize -DriveLetter J -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"TEMPDB02\"\n    New-Partition -DiskNumber 7 -UseMaximumSize -DriveLetter T -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"TEMPDBLOG01\" \n\tNew-Partition -DiskNumber 8 -UseMaximumSize -DriveLetter L -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -AllocationUnitSize 65536 -FileSystem NTFS -NewFileSystemLabel \"ULOG01\"\n\n} else {\n\tWrite-Output \"Disks does not exists or not healthy.`nIf you havent added disks please add 8 disk.\"\n\texit 1\n}\n\nif (\"@@{calm_array_index}@@\" -eq \"0\"){\n  if ((Get-Disk -Number 9 -ErrorAction SilentlyContinue).HealthStatus -eq \"Healthy\"){\n      Get-Disk -Number 9 | Initialize-Disk -ErrorAction SilentlyContinue\n      New-Partition -DiskNumber 9 -UseMaximumSize -DriveLetter W -ErrorAction SilentlyContinue | Format-Volume -Confirm:$false -FileSystem NTFS -NewFileSystemLabel \"Witness\" \n  } else {\n      Write-Output \"Witness Disk does not exists or not healthy.`nIf you havent added disks please add a volume group and attach.`n `t - Witness : 1GB\"\n      exit 1\n  }\n}\n","type":"","command_line_args":"","exit_status":[],"script_type":"npsscript"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"c3d7de2c-6488-4be0-82ce-01ddd8bea78b"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","name":"Create AAG","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"if (\"$(Get-ClusterNode | where {$_.Id -eq 1} | select -ExpandProperty Name)\" -ne \"$(hostname)\"){\n\texit\n}\n$AGName = '@@{SQL_CLUSTER_NAME}@@'\n$PrimaryNode = $(hostname)\n$IP = '@@{MSSQL_VIP}@@\/255.255.255.0'\n$replicas = @()\n\n$cname = (Get-Cluster -name $PrimaryNode).name\n$nodes = (get-clusternode -Cluster $cname).name\n\n$sqlperms = @\"\nuse [master];\nGRANT ALTER ANY AVAILABILITY GROUP TO [NT AUTHORITY\\SYSTEM];\nGRANT CONNECT SQL TO [NT AUTHORITY\\SYSTEM];\nGRANT VIEW SERVER STATE TO [NT AUTHORITY\\SYSTEM];\n\"@\n\nforeach($node in $nodes)\n{\n\tInvoke-Sqlcmd -ServerInstance $node -Database master -Query $sqlperms\n\t$replicas += New-SqlAvailabilityReplica -Name $node -EndpointUrl \"TCP:\/\/$($node):5022\" -AvailabilityMode \"SynchronousCommit\" -FailoverMode \"Automatic\" -AsTemplate -Version 12 \n}\n\n\nNew-SqlAvailabilityGroup -Name $AGName -Path \"SQLSERVER:\\SQL\\$PrimaryNode\\DEFAULT\" -AvailabilityReplica $replicas\n$nodes | Where-Object {$_ -ne $PrimaryNode} | ForEach-Object {Join-SqlAvailabilityGroup -path \"SQLSERVER:\\SQL\\$_\\DEFAULT\" -Name $AGName}\nNew-SqlAvailabilityGroupListener -Name $AGName -staticIP $IP -Port 1433 -Path \"SQLSERVER:\\Sql\\$PrimaryNode\\DEFAULT\\AvailabilityGroups\\$AGName\"\n","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"6d258f96-9d6e-4896-903c-6b803e848d61"},"type":"","command_line_args":"","script_type":"npsscript"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"fc643ea4-2ad8-4e16-8171-67d254e23543"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","name":"Create VG","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#script\n\nif \"@@{calm_array_index}@@\" != \"0\":\n  exit(0)\nprism_ip = '@@{PE_IP}@@'\nusername = '@@{PE_CREDS.username}@@'\npassword = '@@{PE_CREDS.secret}@@'\nstorage_container_name = '@@{CONTAINER_NAME}@@'\nstorage_container_uuid = ''\nvgname = '@@{VG_NAME}@@'\n\napi_url = \"https:\/\/\" + prism_ip + \":9440\/PrismGateway\/services\/rest\/v2.0\/\"\n\nprint \"INFO: Retrieving storage container uuid for: {}.\".format(storage_container_name)\n\n# -*- Get Container UUID\n\nget_container_uuid_url = api_url + \"storage_containers\"\ntry:\n  response = urlreq(get_container_uuid_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\n  storage_containers = json.loads(response.content)\n  for container in storage_containers['entities']:\n    if container['name'] == storage_container_name:\n      storage_container_uuid = container['storage_container_uuid']\nexcept Exception as e:\n\tprint \"ERROR: Failed to get storage container uuid, check storage container name or check username\/password\"\n\tprint e.message\n\texit(1)\n\nprint \"INFO: storage container uuid is: {}.\".format(storage_container_uuid)\n\n# -*- Check volume group existance\n\ncheck_vg_url = api_url + \"volume_groups\"\nresponse = urlreq(check_vg_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\nvgs = json.loads(response.content)\nfor vg in vgs['entities']:\n  if vg['name'] == vgname:\n    print \"ERROR: Volume group with name {} already exists.\".format(vgname)\n    exit(1)\n\nprint \"INFO: Creating volume group '{}'.\".format(vgname)\n\n# -*- Create Volume Group\n\ncreate_vg_url = api_url + \"volume_groups\"\npayload = {\n\t\"disk_list\": [{\n\t\t\"create_config\": {\n\t\t\t\"size\": 1073741824,\n\t\t\t\"storage_container_uuid\": storage_container_uuid\n\t\t},\n\t\t\"index\": 0\n\t}],\n\t\"is_shared\": True,\n\t\"name\": vgname\n}\n\nresponse = urlreq(create_vg_url, verb='POST', auth=\"BASIC\", user=username, passwd=password, params=json.dumps(payload), verify=False)\nif response.status_code != 201:\n\tprint \"ERROR: creation of volume group '{}' failed.\".format(vgname)\n\nvg_create_status = json.loads(response.content)\ntask_uuid = vg_create_status['task_uuid']\n\nsleep(5)\n\ncheck_vg_creation_url = api_url + \"tasks\/\" + task_uuid\nresponse = response = urlreq(check_vg_creation_url, verb='GET', auth=\"BASIC\", user=username, passwd=password, verify=False)\nvg_create_status = json.loads(response.content)\n\nif vg_create_status['progress_status'] != \"Succeeded\":\n\tprint \"ERROR: creation of volume group '{}' failed.\".format(vgname)\n\texit(1)\nelse:\n\tprint \"INFO: creation of volume group '{}' Successful.\".format(vgname)","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"c48f54e3-eb21-4418-bd2d-f5623208e84a"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","name":"Enable AAG","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"# -*- Variable for T-SQL command\n$netbios = \"@@{DOMAIN}@@\".Split(\".\")[0].ToUpper()\n$createLogin = \"CREATE LOGIN [$netbios\\sqlservice] FROM WINDOWS; \" \n$grantConnectPermissions = \"GRANT CONNECT ON ENDPOINT::Endpoint_AG TO [$netbios\\sqlservice];\"\n\nEnable-SqlAlwaysOn -ServerInstance $(hostname) -Force \nNew-SqlHADREndpoint -Path \"SQLSERVER:\\SQL\\$(hostname)\\DEFAULT\" -Name \"Endpoint_AG\" -Port 5022 -EncryptionAlgorithm Aes -Encryption Required \nSet-SqlHADREndpoint -Path \"SQLSERVER:\\SQL\\$(hostname)\\DEFAULT\\Endpoints\\Endpoint_AG\" -State Started\nInvoke-SqlCmd -Server $(hostname) -Query $createLogin\nInvoke-SqlCmd -Server $(hostname) -Query $grantConnectPermissions","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"6d258f96-9d6e-4896-903c-6b803e848d61"},"type":"","command_line_args":"","script_type":"npsscript"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"7991a817-2640-4c3a-813a-611b3ae09452"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","name":"Get IQN","type":"SET_VARIABLE","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"Write-Output \"IQN=$((Get-InitiatorPort).NodeAddress)\"","eval_variables":["IQN"],"eval_scope":"local","type":"","script_type":"npsscript"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"0f4471ce-096e-469e-9f69-c9339d1067f0"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","name":"Install FC","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"Install-WindowsFeature -Name Failover-Clustering -IncludeManagementTools\n\nif (-not (get-WindowsFeature -Name Failover-Clustering -ErrorAction SilentlyContinue | select -ExpandProperty Installed)){\n\tWrite-output \"Failover Clustering is not installed\"\n\texit 1\n}","type":"","command_line_args":"","exit_status":[],"script_type":"npsscript"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"d8c7a910-e915-4093-8b29-9891952a2b60"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","name":"Install SQL","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"Install-WindowsFeature -IncludeAllSubFeature -ErrorAction Stop \"Net-Framework-Core\"\n$DOMAINNAME=(Get-WmiObject Win32_ComputerSystem).Domain\n$setupDriveLetter = \"D:\"\n$setupPath = \"$setupDriveLetter\\setup.exe\"\n$silentArgs = \"\/IACCEPTSQLSERVERLICENSETERMS \/Q \/ACTION=install \/FEATURES=SQLENGINE,FULLTEXT,SSMS,ADV_SSMS \/AGTSVCACCOUNT=`\"@@{SQL_CREDS.username}@@`\" \/AGTSVCPASSWORD=@@{SQL_CREDS.secret}@@ \/SQLSVCACCOUNT=`\"@@{SQL_CREDS.username}@@`\" \/SQLSVCPASSWORD=@@{SQL_CREDS.secret}@@ \/SQLSYSADMINACCOUNTS=`\"$DOMAINNAME\\Domain Admins`\" \/ISSVCACCOUNT=`\"@@{SQL_CREDS.username}@@`\" \/ISSVCPASSWORD=@@{SQL_CREDS.secret}@@ \/ASSYSADMINACCOUNTS=`\"@@{SQL_CREDS.username}@@`\" \/INSTANCEID=MSSQLSERVER \/INSTANCENAME=MSSQLSERVER \/UPDATEENABLED=True \/UPDATESOURCE=`\"C:\\Temp`\" \/INDICATEPROGRESS \/TCPENABLED=1 \/INSTALLSQLDATADIR=`\"F:\\MSSQL`\" \/SQLUSERDBLOGDIR=`\"L:\\MSSQL`\" \/SQLTEMPDBLOGDIR=`\"T:\\MSSQL`\"\"\n$validExitCodes = @(0)\n\n$install = Start-Process -FilePath $setupPath -ArgumentList $silentArgs -Wait -NoNewWindow -PassThru\n$install.WaitForExit()\n$exitCode = $install.ExitCode\n$install.Dispose()\n\nWrite-Output \"SQL Failover Cluster Installation exited with `'$exitCode`'.\"\nif ($validExitCodes -notcontains $exitCode) {\n\tWrite-Output \"Running [`\"$setupPath`\" $silentArgs] was not successful. Exit code was '$exitCode'. See log for possible error messages.\"\n\texit 1\n}","login_credential_local_reference":{"kind":"app_credential","name":"DOMAIN_CRED","uuid":"6d258f96-9d6e-4896-903c-6b803e848d61"},"type":"","command_line_args":"","script_type":"npsscript"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"3229ae0a-055e-4faf-ad5e-d0935fdf98ad"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","name":"JoinDomain","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"##############################################\n# Name        : JoinDomain\n# Author      : K Sarat Kumar\n# Version     : 1.0\n# Description : Script is used to join to domain.\n##############################################\n\nfunction JointoDomain {\n  [CmdletBinding()]\n  Param(\n      [parameter(Mandatory=$true)]\n      [string]$DomainName,\n      [parameter(Mandatory=$false)]\n      [string]$OU,\n      [parameter(Mandatory=$true)]\n      [string]$Username,\n      [parameter(Mandatory=$true)]\n      [string]$Password,\n      [parameter(Mandatory=$true)]\n      [string]$Server\n  )\n  $adapter = Get-NetAdapter | ? {$_.Status -eq \"up\"}\n  $adapter | Set-DnsClientServerAddress -ServerAddresses $Server\n\n  if ($env:computername  -eq $env:userdomain) {\n    Write-Host \"Not in domain\"\n    $adminname = \"$Username\"\n    $adminpassword = ConvertTo-SecureString -asPlainText -Force -String \"$Password\"\n    Write-Host \"$adminname , $password\"\n    $credential = New-Object System.Management.Automation.PSCredential($adminname,$adminpassword)\n    Add-computer -DomainName $DomainName -Credential $credential -force -Options JoinWithNewName,AccountCreate -PassThru -ErrorAction Stop\n  } else {\n     Write-Host \"Already in domain\"\n  }\n}\n\nJointoDomain -DomainName \"@@{DOMAIN}@@\" -Username \"@@{DOMAIN_CRED.username}@@\" -Password \"@@{DOMAIN_CRED.secret}@@\" -Server \"@@{AD_IP}@@\"\n\nRestart-Computer -Force -AsJob\nexit 0","type":"","command_line_args":"","exit_status":[],"script_type":"npsscript"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"39bb7402-9ada-4ee1-a348-ad63df7d1407"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","name":"Pre Requisites","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"##############################################\n# Name        : Pre-requisites\n# Author      : K Sarat Kumar\n# Version     : 1.0\n# Description : Script is used to join to domain.\n##############################################\n\n# -*- Pre-requisite to enable credssp and set 'Server' role\nEnable-WSManCredSSP -Role Server -Force\n\n# -*- Enabling and starting 'msiscsi'\nSet-Service -Name msiscsi -StartupType Automatic\nStart-Service msiscsi\n\n# -*- Change first Ehternet adapter name to 'Production'\nGet-NetAdapter -Name \"Ethernet\" | Rename-NetAdapter -NewName \"Production\" -ErrorAction SilentlyContinue\n\n# -*- Download SQL Updates\n$TempDirectory = \"C:\\Temp\"\nNew-Item -ItemType Directory -Force -Path $TempDirectory\n(New-Object System.Net.WebClient).DownloadFile(\"http:\/\/10.46.1.165\/data1\/ISOs\/SQLServer2014-KB4052725-x64.exe\",\"$TempDirectory\\SQLServer2014-KB4052725-x64.exe\")\nSet-NetFirewallProfile -Profile Domain,Public,Private -Enabled False","type":"","command_line_args":"","exit_status":[],"script_type":"npsscript"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"64d06e54-4d78-42ea-b723-2d77cc9f3a18"},{"target_any_local_reference":{"kind":"app_service","name":"MSSQL","uuid":"1fd5d9b1-a75f-4d28-98cd-2bea326d505b"},"retries":"0","name":"Sleep","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#script\nsleep(50)","type":"","command_line_args":"","exit_status":[],"script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"113beadd-e1ca-43f8-8cbf-c65d49852086"},{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","name":"ddaf74d2_dag","type":"DAG","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Apply OS BPG","uuid":"c5c03e88-dd51-4252-ae67-bcece8e0ab3e"},{"kind":"app_task","name":"Apply SQL BPG","uuid":"dabbb680-d05c-408d-9063-310b308a0bfb"},{"kind":"app_task","name":"Attach VG","uuid":"28d71afc-ce41-4154-a78f-c05337f3f60b"},{"kind":"app_task","name":"Configure WSFC","uuid":"957b3f6a-bd01-479f-8635-ae43c7aea0fa"},{"kind":"app_task","name":"Connect Mount VG","uuid":"c3d7de2c-6488-4be0-82ce-01ddd8bea78b"},{"kind":"app_task","name":"Create AAG","uuid":"fc643ea4-2ad8-4e16-8171-67d254e23543"},{"kind":"app_task","name":"Create VG","uuid":"c48f54e3-eb21-4418-bd2d-f5623208e84a"},{"kind":"app_task","name":"Enable AAG","uuid":"7991a817-2640-4c3a-813a-611b3ae09452"},{"kind":"app_task","name":"Get IQN","uuid":"0f4471ce-096e-469e-9f69-c9339d1067f0"},{"kind":"app_task","name":"Install FC","uuid":"d8c7a910-e915-4093-8b29-9891952a2b60"},{"kind":"app_task","name":"Install SQL","uuid":"3229ae0a-055e-4faf-ad5e-d0935fdf98ad"},{"kind":"app_task","name":"JoinDomain","uuid":"39bb7402-9ada-4ee1-a348-ad63df7d1407"},{"kind":"app_task","name":"Pre Requisites","uuid":"64d06e54-4d78-42ea-b723-2d77cc9f3a18"},{"kind":"app_task","name":"Sleep","uuid":"113beadd-e1ca-43f8-8cbf-c65d49852086"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Apply OS BPG","uuid":"c5c03e88-dd51-4252-ae67-bcece8e0ab3e"},"edge_type":"user_defined","type":"","uuid":"2d34f974-796f-4404-aaf6-e219f16d8d48","to_task_reference":{"kind":"app_task","name":"Apply SQL BPG","uuid":"dabbb680-d05c-408d-9063-310b308a0bfb"}},{"from_task_reference":{"kind":"app_task","name":"Apply SQL BPG","uuid":"dabbb680-d05c-408d-9063-310b308a0bfb"},"edge_type":"user_defined","type":"","uuid":"c50d59ad-d9a3-4480-9373-9058e7c83326","to_task_reference":{"kind":"app_task","name":"Enable AAG","uuid":"7991a817-2640-4c3a-813a-611b3ae09452"}},{"from_task_reference":{"kind":"app_task","name":"Attach VG","uuid":"28d71afc-ce41-4154-a78f-c05337f3f60b"},"edge_type":"user_defined","type":"","uuid":"54f08b1a-952e-4bc9-bf97-c3c4d0888b2a","to_task_reference":{"kind":"app_task","name":"Connect Mount VG","uuid":"c3d7de2c-6488-4be0-82ce-01ddd8bea78b"}},{"from_task_reference":{"kind":"app_task","name":"Configure WSFC","uuid":"957b3f6a-bd01-479f-8635-ae43c7aea0fa"},"edge_type":"user_defined","type":"","uuid":"b606ee4a-ae92-4202-812b-3ba226cebe4f","to_task_reference":{"kind":"app_task","name":"Install SQL","uuid":"3229ae0a-055e-4faf-ad5e-d0935fdf98ad"}},{"from_task_reference":{"kind":"app_task","name":"Connect Mount VG","uuid":"c3d7de2c-6488-4be0-82ce-01ddd8bea78b"},"edge_type":"user_defined","type":"","uuid":"4f68e321-7344-4105-bd6c-cb4e096e234c","to_task_reference":{"kind":"app_task","name":"Install FC","uuid":"d8c7a910-e915-4093-8b29-9891952a2b60"}},{"from_task_reference":{"kind":"app_task","name":"Create VG","uuid":"c48f54e3-eb21-4418-bd2d-f5623208e84a"},"edge_type":"user_defined","type":"","uuid":"8779cffa-a21b-4237-b24c-840979efbcb3","to_task_reference":{"kind":"app_task","name":"Get IQN","uuid":"0f4471ce-096e-469e-9f69-c9339d1067f0"}},{"from_task_reference":{"kind":"app_task","name":"Enable AAG","uuid":"7991a817-2640-4c3a-813a-611b3ae09452"},"edge_type":"user_defined","type":"","uuid":"fe6eb75d-f47b-4dae-a3d6-15e080edc2a8","to_task_reference":{"kind":"app_task","name":"Create AAG","uuid":"fc643ea4-2ad8-4e16-8171-67d254e23543"}},{"from_task_reference":{"kind":"app_task","name":"Get IQN","uuid":"0f4471ce-096e-469e-9f69-c9339d1067f0"},"edge_type":"user_defined","type":"","uuid":"507f52e7-63aa-45fc-a20c-dab8161d202b","to_task_reference":{"kind":"app_task","name":"Attach VG","uuid":"28d71afc-ce41-4154-a78f-c05337f3f60b"}},{"from_task_reference":{"kind":"app_task","name":"Install FC","uuid":"d8c7a910-e915-4093-8b29-9891952a2b60"},"edge_type":"user_defined","type":"","uuid":"3e887ae6-5f7b-4131-959d-1f77a70860b6","to_task_reference":{"kind":"app_task","name":"Configure WSFC","uuid":"957b3f6a-bd01-479f-8635-ae43c7aea0fa"}},{"from_task_reference":{"kind":"app_task","name":"Install SQL","uuid":"3229ae0a-055e-4faf-ad5e-d0935fdf98ad"},"edge_type":"user_defined","type":"","uuid":"511c3306-d33d-46f8-b448-40bdeb29ca1c","to_task_reference":{"kind":"app_task","name":"Apply OS BPG","uuid":"c5c03e88-dd51-4252-ae67-bcece8e0ab3e"}},{"from_task_reference":{"kind":"app_task","name":"JoinDomain","uuid":"39bb7402-9ada-4ee1-a348-ad63df7d1407"},"edge_type":"user_defined","type":"","uuid":"811570cd-e8e9-4224-b0b8-f1192f6f4029","to_task_reference":{"kind":"app_task","name":"Sleep","uuid":"113beadd-e1ca-43f8-8cbf-c65d49852086"}},{"from_task_reference":{"kind":"app_task","name":"Pre Requisites","uuid":"64d06e54-4d78-42ea-b723-2d77cc9f3a18"},"edge_type":"user_defined","type":"","uuid":"ce840774-6c6d-4ab5-a88c-2e60adf14037","to_task_reference":{"kind":"app_task","name":"JoinDomain","uuid":"39bb7402-9ada-4ee1-a348-ad63df7d1407"}},{"from_task_reference":{"kind":"app_task","name":"Sleep","uuid":"113beadd-e1ca-43f8-8cbf-c65d49852086"},"edge_type":"user_defined","type":"","uuid":"e8d271d6-3557-4c67-bdaf-51f925debda2","to_task_reference":{"kind":"app_task","name":"Create VG","uuid":"c48f54e3-eb21-4418-bd2d-f5623208e84a"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"0660260c-5415-4a23-90e0-ceb0af24dbfb"}],"name":"0561ade3_runbook","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"ddaf74d2_dag","uuid":"0660260c-5415-4a23-90e0-ceb0af24dbfb"},"uuid":"cf254e8d-da7c-40f5-8252-abea0d8d0e3d"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV MSSQL Package","uuid":"88b567d7-7ed0-4362-900b-06aec7b77e32"},"retries":"0","name":"7bf7eecb_dag","type":"DAG","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"f1ec0a18-88a4-466c-9fe4-0e75ddf1d4e2"}],"name":"f564b0c1_runbook","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"7bf7eecb_dag","uuid":"f1ec0a18-88a4-466c-9fe4-0e75ddf1d4e2"},"uuid":"80334a55-16d3-4e61-9608-44dc01af349b"}},"variable_list":[],"description":""}],"client_attrs":{"None":{"y":-40,"x":63},"94e0cc1c-70cf-4bec-b743-42304577db9b":{"y":-295,"x":-405}}},"description":""},"api_version":"3.0","metadata":{"last_update_time":"1556010346187485","owner_reference":{"kind":"user","uuid":"00000000-0000-0000-0000-000000000000","name":"admin"},"kind":"blueprint","uuid":"825d59df-d508-4cb4-9379-4705e5bee0b1","project_reference":{"kind":"project","name":"default","uuid":"22ca180e-f065-4728-95ad-9eed952de20f"},"spec_version":11,"creation_time":"1555996702249443","name":"MSSQL AAG"}}