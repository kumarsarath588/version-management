{"status":{"description":"* [Kubernetes API](https:\/\/@@{Kubernetes_Master.address[0]}@@:6443)\n* [Kubernetes Dashboard](https:\/\/@@{Kubernetes_Master.address[0]}@@:30443)","source_mpi":"","state":"ACTIVE","is_cloned":false,"message_list":[],"resources":{"service_definition_list":[{"port_list":[],"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"cac576ea-239c-4acf-973c-d9b4069814d4","name":"action_create","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"DAG","uuid":"8390c360-30b9-4219-9311-c1f35a4ca40f","child_tasks_local_reference_list":[{"kind":"app_task","name":"Dashboard","uuid":"5ce1c190-3f1e-4bb8-bd10-1e62555a40a0"},{"kind":"app_task","name":"HELM","uuid":"0fc9610c-0fa4-4b6e-bd04-5813c5fb5bba"},{"kind":"app_task","name":"Heapster","uuid":"43a62154-c1c9-47ec-867d-710a5bc4d44d"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Dashboard","uuid":"5ce1c190-3f1e-4bb8-bd10-1e62555a40a0"},"edge_type":"user_defined","type":"","uuid":"d6df22f4-82c0-411f-a8ef-874bc4b4b9f4","to_task_reference":{"kind":"app_task","name":"HELM","uuid":"0fc9610c-0fa4-4b6e-bd04-5813c5fb5bba"}},{"from_task_reference":{"kind":"app_task","name":"HELM","uuid":"0fc9610c-0fa4-4b6e-bd04-5813c5fb5bba"},"edge_type":"user_defined","type":"","uuid":"8c216cc0-472a-41af-9a4b-a14cf363af94","to_task_reference":{"kind":"app_task","name":"Heapster","uuid":"43a62154-c1c9-47ec-867d-710a5bc4d44d"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"f33eac3f_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"5ce1c190-3f1e-4bb8-bd10-1e62555a40a0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/dashboard\necho '# Copyright 2015 Google Inc. All Rights Reserved.\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#     http:\/\/www.apache.org\/licenses\/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\n# Configuration to deploy release version of the Dashboard UI compatible with\n# Kubernetes 1.7.\n#\n# Example usage: kubectl create -f <this_file>\n\n# ------------------- Dashboard Secret ------------------- #\n\napiVersion: v1\nkind: Secret\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard-certs\n  namespace: kube-system\ntype: Opaque\n\n---\n# ------------------- Dashboard Service Account ------------------- #\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\n\n---\n# ------------------- Dashboard Role & Role Binding ------------------- #\n\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: kubernetes-full-access\n  namespace: kube-system\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: kubernetes-dashboard\n  namespace: kube-system\n\n---\n# ------------------- Dashboard Deployment ------------------- #\n\nkind: Deployment\napiVersion: apps\/v1beta2\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\nspec:\n  replicas: 1\n  revisionHistoryLimit: 10\n  selector:\n    matchLabels:\n      k8s-app: kubernetes-dashboard\n  template:\n    metadata:\n      labels:\n        k8s-app: kubernetes-dashboard\n    spec:\n      containers:\n      - name: kubernetes-dashboard\n        image: k8s.gcr.io\/kubernetes-dashboard-amd64:v1.10.1\n        ports:\n        - containerPort: 8443\n          protocol: TCP\n        args:\n          - --auto-generate-certificates\n          # Uncomment the following line to manually specify Kubernetes API server Host\n          # If not specified, Dashboard will attempt to auto discover the API server and connect\n          # to it. Uncomment only if the default does not work.\n          # - --apiserver-host=http:\/\/my-address:port\n        volumeMounts:\n        - name: kubernetes-dashboard-certs\n          mountPath: \/certs\n          # Create on-disk volume to store exec logs\n        - mountPath: \/tmp\n          name: tmp-volume\n        livenessProbe:\n          httpGet:\n            scheme: HTTPS\n            path: \/\n            port: 8443\n          initialDelaySeconds: 30\n          timeoutSeconds: 30\n      volumes:\n      - name: kubernetes-dashboard-certs\n        secret:\n          secretName: kubernetes-dashboard-certs\n      - name: tmp-volume\n        emptyDir: {}\n      serviceAccountName: kubernetes-dashboard\n      # Comment the following tolerations if Dashboard must not be deployed on master\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        effect: NoSchedule\n\n---\n# ------------------- Dashboard Service ------------------- #\n\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\nspec:\n  type: NodePort\n  ports:\n    - port: 8443\n      nodePort: 30443\n  selector:\n    k8s-app: kubernetes-dashboard' | sudo tee \/etc\/kubernetes\/addons\/dashboard\/kubernetes-dashboard.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/dashboard\/kubernetes-dashboard.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Dashboard"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"0fc9610c-0fa4-4b6e-bd04-5813c5fb5bba","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir \/etc\/kubernetes\/addons\/helm\necho \"#helm init --service-account helm\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: helm\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: helm\n  namespace: kube-system\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: helm\n  namespace: kube-system\" | sudo tee \/etc\/kubernetes\/addons\/helm\/helm.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/helm\/helm.yaml\nhelm init --service-account helm\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"HELM"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"43a62154-c1c9-47ec-867d-710a5bc4d44d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir \/etc\/kubernetes\/addons\/heapster\nkubectl delete ClusterRole system:heapster -n kube-system\n\necho 'apiVersion: rbac.authorization.k8s.io\/v1\nkind: ClusterRole\nmetadata:\n  name: system:heapster\n  namespace: kube-system\nrules:\n- apiGroups:\n  - \"\"\n  resources:\n  - events\n  - namespaces\n  - nodes\n  - pods\n  verbs:\n  - get\n  - list\n  - watch\n- apiGroups:\n  - \"\"\n  resources:\n  - nodes\/stats\n  verbs:\n  - get\n- apiGroups:\n  - extensions\n  resources:\n  - deployments\n  verbs:\n  - get\n  - list\n  - watch\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: heapster\n  namespace: kube-system\n  labels:\n    k8s-app: heapster\n    module: apiserver\n    version: v6\nspec:\n  selector:\n    matchLabels:\n      k8s-app: heapster\n      module: apiserver\n      version: v6\n  template:\n    metadata:\n      name: heapster\n      labels:\n        k8s-app: heapster\n        module: apiserver\n        version: v6\n    spec:\n      serviceAccountName: heapster\n      containers:\n      - name: heapster\n        image: k8s.gcr.io\/heapster-amd64:v1.5.3\n        command:\n        - \/heapster\n        - --source=kubernetes.summary_api:\"\"?useServiceAccount=true&kubeletHttps=true&kubeletPort=10250&insecure=true\n        ports:\n        - containerPort: 6443\n          name: https\n        - containerPort: 8080\n          name: http\n        volumeMounts:\n        - name: ssl-certs\n          mountPath: \/etc\/ssl\/certs\n          readOnly: true\n      volumes:\n      - name: ssl-certs\n        hostPath:\n          path: \/etc\/ssl\/certs\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: heapster\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n---\nkind: Service\napiVersion: v1\nmetadata:\n  name: heapster\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    kubernetes.io\/name: \"Heapster\"\n    k8s-app: heapster\nspec:\n  ports:\n    - port: 80\n      targetPort: 8082\n  selector:\n    k8s-app: heapster\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: heapster\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: heapster\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/heapster\/heapster.yaml\n  \nkubectl create -f \/etc\/kubernetes\/addons\/heapster\/heapster.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Heapster"}],"description":"","message_list":[],"uuid":"384cf3d8-e940-43f1-a289-6c6b363c5371","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"f33eac3f_dag","uuid":"8390c360-30b9-4219-9311-c1f35a4ca40f"},"name":"a9639da1_runbook"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"0d36bbcc-b0c3-40e9-8468-4715b7f5bea5","name":"action_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"DAG","uuid":"df8b9349-996c-4dc9-af64-e4707640efb4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"62a92d34_dag"}],"description":"","message_list":[],"uuid":"7f713d48-74e9-4bb6-8dc9-eb8f00371ff3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"62a92d34_dag","uuid":"df8b9349-996c-4dc9-af64-e4707640efb4"},"name":"8c4aa276_runbook"}},{"description":"System action for starting an application","message_list":[],"uuid":"cb53aa3a-a093-41a4-8a91-4d9bd2451bd3","name":"action_start","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"DAG","uuid":"e34fd574-8610-4ce3-9061-9d4f4c437f98","child_tasks_local_reference_list":[{"kind":"app_task","name":"Start","uuid":"378729ff-78ae-40a9-9096-d98029e614db"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"334b4484_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"378729ff-78ae-40a9-9096-d98029e614db","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\nsudo systemctl start etcd docker kubelet \nsudo systemctl enable etcd docker kubelet\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Start"}],"description":"","message_list":[],"uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"334b4484_dag","uuid":"e34fd574-8610-4ce3-9061-9d4f4c437f98"},"name":"daee30ae_runbook"}},{"description":"System action for stopping an application","message_list":[],"uuid":"973a21ca-9570-41c9-b998-62793dcb278b","name":"action_stop","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"DAG","uuid":"c0b61a7f-788f-4cf8-9235-64f7f3a32ba5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"9713c3d0_dag"}],"description":"","message_list":[],"uuid":"d47bda45-1029-453f-8f80-28216a9797e4","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"9713c3d0_dag","uuid":"c0b61a7f-788f-4cf8-9235-64f7f3a32ba5"},"name":"6407a345_runbook"}},{"description":"System action for restarting an application","message_list":[],"uuid":"ddca9274-10e3-48ea-bbe0-11c14eb4a5fe","name":"action_restart","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"DAG","uuid":"b4e81e27-b062-47a0-8499-2e2da7b7f5ed","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"414912df_dag"}],"description":"","message_list":[],"uuid":"ca8cec47-f6e6-4ffb-83f1-eb67ddbb98e2","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"414912df_dag","uuid":"b4e81e27-b062-47a0-8499-2e2da7b7f5ed"},"name":"d5c8316f_runbook"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"2c4d2643-70b7-4d42-ab4c-07d48a274e4e","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"DAG","uuid":"429f70a6-e224-433b-bd6e-105757911208","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Service_Element_Delete_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"1a1d6a45-fc38-4b09-902b-225af90ebdba"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"1a1d6a45-fc38-4b09-902b-225af90ebdba","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Service_Element_Delete_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"2064d305-852a-47aa-89b9-7415f90c2152","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"429f70a6-e224-433b-bd6e-105757911208"},"name":"SYS_GEN__Runbook_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}}],"message_list":[],"uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","state":"ACTIVE","depends_on_list":[],"editables":{},"tier":"","singleton":false,"variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"06f8b711-cc7e-4c52-ad28-f7c799b6b2aa","value":"","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{},"is_hidden":false,"type":"LOCAL","options":{},"name":"VERSION"}],"name":"Kubernetes_Master"},{"port_list":[],"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"6df9c265-f4f4-4f8f-9f2b-6cc0ca7ec64e","name":"action_create","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"DAG","uuid":"50756cfa-6874-4edf-b86c-7a53f8a5eaa0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"4af7c45f_dag"}],"description":"","message_list":[],"uuid":"cca906a5-5e79-422e-b15f-7391a907ad07","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"4af7c45f_dag","uuid":"50756cfa-6874-4edf-b86c-7a53f8a5eaa0"},"name":"7c6e4932_runbook"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"c5bfeb62-2a04-4361-82ee-a5e89b659466","name":"action_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"DAG","uuid":"725715b1-7f4e-4969-b9d9-8da0496287ec","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"1e2c50bb_dag"}],"description":"","message_list":[],"uuid":"843ab0a6-03bd-4b9c-8f56-7d852e9348e0","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"1e2c50bb_dag","uuid":"725715b1-7f4e-4969-b9d9-8da0496287ec"},"name":"1d794193_runbook"}},{"description":"System action for starting an application","message_list":[],"uuid":"bdc0fbef-15b3-4964-a51c-760f7b35ab3f","name":"action_start","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"DAG","uuid":"d72f08f3-1dd7-4ee8-b590-adb1dab63e2c","child_tasks_local_reference_list":[{"kind":"app_task","name":"Start","uuid":"11506026-008f-43e1-b571-ec1802f3ed21"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"970128c7_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"11506026-008f-43e1-b571-ec1802f3ed21","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo systemctl start docker kubelet\nsudo systemctl enable docker kubelet"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Start"}],"description":"","message_list":[],"uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"970128c7_dag","uuid":"d72f08f3-1dd7-4ee8-b590-adb1dab63e2c"},"name":"884352cf_runbook"}},{"description":"System action for stopping an application","message_list":[],"uuid":"567704ed-583d-41b0-a5bb-38c826f5a1fc","name":"action_stop","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"DAG","uuid":"ee72001a-18d8-4e3d-a556-16a343ed37a8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6c01dc28_dag"}],"description":"","message_list":[],"uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6c01dc28_dag","uuid":"ee72001a-18d8-4e3d-a556-16a343ed37a8"},"name":"0cb172a7_runbook"}},{"description":"System action for restarting an application","message_list":[],"uuid":"aac6e551-6dcf-40bf-92d4-0ea4ae156851","name":"action_restart","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"DAG","uuid":"30e99832-f72a-41fa-921a-5d75d5eb8955","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"1d66b5be_dag"}],"description":"","message_list":[],"uuid":"ce602c49-d9cd-44d7-8e10-5671dc407b8b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"1d66b5be_dag","uuid":"30e99832-f72a-41fa-921a-5d75d5eb8955"},"name":"3a6f587d_runbook"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"85de24d9-40ea-42b5-ae6d-aa24541b2a37","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"DAG","uuid":"61f33434-4dae-4823-83cb-f43b77e554be","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Service_Element_Delete_045659a2_932c_49c8_9269_3a911f955962","uuid":"cf0f14f2-40f4-4626-b943-974492d66368"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"cf0f14f2-40f4-4626-b943-974492d66368","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Service_Element_Delete_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"716ea7a7-bc0c-4ac5-ab9c-720c327a498e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"61f33434-4dae-4823-83cb-f43b77e554be"},"name":"SYS_GEN__Runbook_Service_045659a2_932c_49c8_9269_3a911f955962"}}],"message_list":[],"uuid":"045659a2-932c-49c8-9269-3a911f955962","state":"ACTIVE","depends_on_list":[],"editables":{},"tier":"","singleton":false,"variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"ad7e3b5e-185d-4f96-a160-791f42bedcbc","value":"","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{},"is_hidden":false,"type":"LOCAL","options":{},"name":"VERSION"}],"name":"Kubernetes_Worker"}],"substrate_definition_list":[{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"b866ade5-ba51-4f1a-bccc-b087fd13214d","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"DAG","uuid":"cbab0261-fc10-4c36-83c6-7b085b9f0003","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Provision_07dace66_598d_4d29_a271_7965340bd074","uuid":"5c5dc2c1-9274-45f7-9eb5-3d11e696c500"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_07dace66_598d_4d29_a271_7965340bd074","uuid":"d12b5183-159d-4243-9550-3c0398f15da9"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Provision_07dace66_598d_4d29_a271_7965340bd074","uuid":"5c5dc2c1-9274-45f7-9eb5-3d11e696c500"},"edge_type":"inherent","type":"","uuid":"29534213-205c-409b-88cc-a5e16d8940f6","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_07dace66_598d_4d29_a271_7965340bd074","uuid":"d12b5183-159d-4243-9550-3c0398f15da9"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_07dace66_598d_4d29_a271_7965340bd074"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"PROVISION_NUTANIX","uuid":"5c5dc2c1-9274-45f7-9eb5-3d11e696c500","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"name":"K8SM-@@{calm_array_index}@@-@@{calm_time}@@","categories":"","availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"099dbe61-2c00-4964-9567-f547ec224e10"},"type":""}],"parent_reference":null,"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"serial_port_list":[],"gpu_list":[],"memory_size_mib":2048,"power_state":"ON","hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"type":"","boot_config":{"boot_device":{"type":"","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"AHV_CENTOS_76","uuid":"691d60b5-9272-4cb0-a4b4-4e8dc6f75277"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":1,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":2,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":3,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":4,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":5,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":6,"type":""}}}]}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Provision_07dace66_598d_4d29_a271_7965340bd074"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"d12b5183-159d-4243-9550-3c0398f15da9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_07dace66_598d_4d29_a271_7965340bd074"}],"description":"","message_list":[],"uuid":"1a1082b4-4898-4c81-bf4e-1ac2d172c842","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"cbab0261-fc10-4c36-83c6-7b085b9f0003"},"name":"SYS_GEN__Runbook_Substrate_07dace66_598d_4d29_a271_7965340bd074"}},{"description":"System action for powering on an application","message_list":[],"uuid":"fb6225e5-8f90-426e-90e0-b54e769e1ef4","name":"action_poweron","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"DAG","uuid":"b058c2c4-3d30-4718-852d-5991905d0ccb","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOn_07dace66_598d_4d29_a271_7965340bd074","uuid":"2dbeb16b-82aa-46a9-9a29-566173a328c5"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_07dace66_598d_4d29_a271_7965340bd074","uuid":"0d5a8b3f-d2d1-42dc-b15e-3221955400d8"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOn_07dace66_598d_4d29_a271_7965340bd074","uuid":"2dbeb16b-82aa-46a9-9a29-566173a328c5"},"edge_type":"inherent","type":"","uuid":"70a1cbc2-156d-4a86-8858-5d2e995a5a1e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_07dace66_598d_4d29_a271_7965340bd074","uuid":"0d5a8b3f-d2d1-42dc-b15e-3221955400d8"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_07dace66_598d_4d29_a271_7965340bd074"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"2dbeb16b-82aa-46a9-9a29-566173a328c5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_PowerOn_07dace66_598d_4d29_a271_7965340bd074"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"0d5a8b3f-d2d1-42dc-b15e-3221955400d8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_07dace66_598d_4d29_a271_7965340bd074"}],"description":"","message_list":[],"uuid":"944a7abe-6689-4697-aa2d-de5aa22bc3e2","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"b058c2c4-3d30-4718-852d-5991905d0ccb"},"name":"SYS_GEN__Runbook_Substrate_07dace66_598d_4d29_a271_7965340bd074"}},{"description":"System action for restarting an application","message_list":[],"uuid":"7fa7c9ed-fc3c-45af-8318-5b192a0f31f4","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"DAG","uuid":"40895baf-3b31-4274-bced-9bd7e60855a3","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_Restart_07dace66_598d_4d29_a271_7965340bd074","uuid":"edf43201-b9ef-4a24-9833-7d142e0dad4f"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_07dace66_598d_4d29_a271_7965340bd074","uuid":"0d3226a1-0c47-43d4-b222-d4fa45eee384"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_Restart_07dace66_598d_4d29_a271_7965340bd074","uuid":"edf43201-b9ef-4a24-9833-7d142e0dad4f"},"edge_type":"inherent","type":"","uuid":"4825197a-b0ef-4376-9daa-d3e9845f4543","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_07dace66_598d_4d29_a271_7965340bd074","uuid":"0d3226a1-0c47-43d4-b222-d4fa45eee384"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_07dace66_598d_4d29_a271_7965340bd074"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"edf43201-b9ef-4a24-9833-7d142e0dad4f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_Restart_07dace66_598d_4d29_a271_7965340bd074"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"0d3226a1-0c47-43d4-b222-d4fa45eee384","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_07dace66_598d_4d29_a271_7965340bd074"}],"description":"","message_list":[],"uuid":"eebd290b-2b08-452c-bd08-8e435eb12798","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"40895baf-3b31-4274-bced-9bd7e60855a3"},"name":"SYS_GEN__Runbook_Substrate_07dace66_598d_4d29_a271_7965340bd074"}},{"description":"System action for suspending an application","message_list":[],"uuid":"9b44c01d-93d5-41c5-b157-cdbc8adb3fe2","name":"action_suspend","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"DAG","uuid":"eb877963-110a-4913-bbba-677911c3fa6c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_07dace66_598d_4d29_a271_7965340bd074"}],"description":"","message_list":[],"uuid":"b625764e-8238-4e32-9d12-f4034853a2cf","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"eb877963-110a-4913-bbba-677911c3fa6c"},"name":"SYS_GEN__Runbook_Substrate_07dace66_598d_4d29_a271_7965340bd074"}},{"description":"System action for modifying an application","message_list":[],"uuid":"e425aaf5-6477-47dc-a7a1-3acdb5708ee9","name":"action_modify","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"DAG","uuid":"a1ccafea-7f1c-4103-bb10-d6da1ac267af","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_07dace66_598d_4d29_a271_7965340bd074"}],"description":"","message_list":[],"uuid":"b83b13fc-3b6c-4c8d-814e-9060f569779d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"a1ccafea-7f1c-4103-bb10-d6da1ac267af"},"name":"SYS_GEN__Runbook_Substrate_07dace66_598d_4d29_a271_7965340bd074"}},{"description":"System action for powering off an application","message_list":[],"uuid":"8f90913f-aa85-4c6f-94e2-99cc5ca44f1b","name":"action_poweroff","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"DAG","uuid":"5cf7dd38-10a2-4ea6-bae9-9b59ff9f34e6","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOff_07dace66_598d_4d29_a271_7965340bd074","uuid":"182ff33e-7766-4334-bf8e-76e9c4ac8660"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_07dace66_598d_4d29_a271_7965340bd074"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"182ff33e-7766-4334-bf8e-76e9c4ac8660","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_PowerOff_07dace66_598d_4d29_a271_7965340bd074"}],"description":"","message_list":[],"uuid":"8a14fa13-5c99-4c8c-8d19-8ca3ff08d37e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"5cf7dd38-10a2-4ea6-bae9-9b59ff9f34e6"},"name":"SYS_GEN__Runbook_Substrate_07dace66_598d_4d29_a271_7965340bd074"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"a0664a06-1a0a-4ffc-aa81-5881dec75ac5","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"DAG","uuid":"7c280421-c7be-4363-80a5-ca344cac5a9b","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Delete_07dace66_598d_4d29_a271_7965340bd074","uuid":"8918ead0-048d-4a56-a3d5-174a4546b3ba"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_07dace66_598d_4d29_a271_7965340bd074"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"DELETE_NUTANIX","uuid":"8918ead0-048d-4a56-a3d5-174a4546b3ba","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Delete_07dace66_598d_4d29_a271_7965340bd074"}],"description":"","message_list":[],"uuid":"36ea5e7a-39dd-4b51-a707-415c5e19caca","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"7c280421-c7be-4363-80a5-ca344cac5a9b"},"name":"SYS_GEN__Runbook_Substrate_07dace66_598d_4d29_a271_7965340bd074"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"c80c6492-b806-46ce-ac60-815e8ace5894","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"DAG","uuid":"920013d4-3696-4b8d-a8f6-3af981860dd6","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Substrate_Element_Delete_07dace66_598d_4d29_a271_7965340bd074","uuid":"aa6e9665-a114-4373-a965-d3fd430a17e7"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_07dace66_598d_4d29_a271_7965340bd074"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"aa6e9665-a114-4373-a965-d3fd430a17e7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Substrate_Element_Delete_07dace66_598d_4d29_a271_7965340bd074"}],"description":"","message_list":[],"uuid":"154c4dd5-93a8-43c1-a093-f68ec6eaad90","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"920013d4-3696-4b8d-a8f6-3af981860dd6"},"name":"SYS_GEN__Runbook_Substrate_07dace66_598d_4d29_a271_7965340bd074"}}],"message_list":[],"uuid":"07dace66-598d-4d29-a271-7965340bd074","state":"ACTIVE","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS","uuid":"70ea3312-6ea8-4ace-9433-d77766f00ba2"}},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"categories":true,"name":true,"resources":{"nic_list":{"0":{"subnet_reference":true}},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"guest_customization":true,"disk_list":{"1":{"data_source_reference":true,"device_properties":{"disk_address":{"adapter_type":true},"device_type":true},"disk_size_mib":true},"0":{"device_properties":{"disk_address":{}},"disk_size_mib":true},"3":{"data_source_reference":true,"device_properties":{"disk_address":{"adapter_type":true},"device_type":true},"disk_size_mib":true},"2":{"data_source_reference":true,"device_properties":{"disk_address":{"adapter_type":true},"device_type":true},"disk_size_mib":true},"5":{"data_source_reference":true,"device_properties":{"disk_address":{"adapter_type":true},"device_type":true},"disk_size_mib":true},"4":{"data_source_reference":true,"device_properties":{"disk_address":{"adapter_type":true},"device_type":true},"disk_size_mib":true},"6":{"data_source_reference":true,"device_properties":{"disk_address":{"adapter_type":true},"device_type":true},"disk_size_mib":true}}}}},"os_type":"Linux","type":"AHV_VM","create_spec":{"name":"K8SM-@@{calm_array_index}@@-@@{calm_time}@@","categories":"","availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"099dbe61-2c00-4964-9567-f547ec224e10"},"type":""}],"parent_reference":null,"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"serial_port_list":[],"gpu_list":[],"memory_size_mib":2048,"power_state":"ON","hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"type":"","boot_config":{"boot_device":{"type":"","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"AHV_CENTOS_76","uuid":"691d60b5-9272-4cb0-a4b4-4e8dc6f75277"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":1,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":2,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":3,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":4,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":5,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":6,"type":""}}}]}},"variable_list":[],"name":"AHV_Centos_K8SM"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"a97e3c3d-c0eb-4303-9657-cd5603999a40","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"DAG","uuid":"2cf879f2-5cd0-4541-b9aa-0fba23bfdc9f","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Provision_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"230bf320-91d4-4c58-8a1e-a52f9cf10173"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SW_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"92a78689-bda5-4473-8867-fe2863d228b6"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Provision_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"230bf320-91d4-4c58-8a1e-a52f9cf10173"},"edge_type":"inherent","type":"","uuid":"8a6f5609-6faa-444b-ab53-528f64a5e6ce","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SW_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"92a78689-bda5-4473-8867-fe2863d228b6"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"PROVISION_NUTANIX","uuid":"230bf320-91d4-4c58-8a1e-a52f9cf10173","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"name":"K8SW-@@{calm_array_index}@@-@@{calm_time}@@","categories":"","availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"099dbe61-2c00-4964-9567-f547ec224e10"},"type":""}],"parent_reference":null,"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"serial_port_list":[],"gpu_list":[],"memory_size_mib":2048,"power_state":"ON","hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"type":"","boot_config":{"boot_device":{"type":"","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"AHV_CENTOS_76","uuid":"691d60b5-9272-4cb0-a4b4-4e8dc6f75277"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":1,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":2,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":3,"type":""}}}]}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Provision_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"92a78689-bda5-4473-8867-fe2863d228b6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_Centos_K8SW_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"}],"description":"","message_list":[],"uuid":"ae1b092e-54db-4e92-8cc9-395f2b2b308d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"2cf879f2-5cd0-4541-b9aa-0fba23bfdc9f"},"name":"SYS_GEN__Runbook_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"}},{"description":"System action for powering on an application","message_list":[],"uuid":"ec239a17-73fc-4236-9447-c4c1d14de860","name":"action_poweron","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"DAG","uuid":"2524e50e-941e-4049-9f58-e26295f70d8e","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOn_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"20a42964-c78c-4864-ba71-c6a80b200c18"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SW_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"e0be3a53-f9b4-4fb3-80c9-3c8887d292fc"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOn_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"20a42964-c78c-4864-ba71-c6a80b200c18"},"edge_type":"inherent","type":"","uuid":"15f3ab44-ab78-4b7b-b019-0a2752346cc4","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SW_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"e0be3a53-f9b4-4fb3-80c9-3c8887d292fc"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"20a42964-c78c-4864-ba71-c6a80b200c18","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_PowerOn_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"e0be3a53-f9b4-4fb3-80c9-3c8887d292fc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_Centos_K8SW_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"}],"description":"","message_list":[],"uuid":"5b630ba9-e950-4fc9-9286-5d0310cce379","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"2524e50e-941e-4049-9f58-e26295f70d8e"},"name":"SYS_GEN__Runbook_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"}},{"description":"System action for restarting an application","message_list":[],"uuid":"b3196646-278c-4786-a84b-27388049d551","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"DAG","uuid":"0a362411-be83-444f-9f9e-660c7a59cb89","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_Restart_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"5537b1cb-c7d9-4155-b3ca-09ff3b43b94d"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SW_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"74c7df34-ae9d-488e-b3d1-b4baea5d0a35"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_Restart_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"5537b1cb-c7d9-4155-b3ca-09ff3b43b94d"},"edge_type":"inherent","type":"","uuid":"5b4b55b6-790d-4b08-a26e-8431326c54da","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SW_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"74c7df34-ae9d-488e-b3d1-b4baea5d0a35"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"5537b1cb-c7d9-4155-b3ca-09ff3b43b94d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_Restart_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"74c7df34-ae9d-488e-b3d1-b4baea5d0a35","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_Centos_K8SW_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"}],"description":"","message_list":[],"uuid":"f0a20e02-9792-48dd-8a0d-d9c4e8ddf92c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"0a362411-be83-444f-9f9e-660c7a59cb89"},"name":"SYS_GEN__Runbook_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"}},{"description":"System action for suspending an application","message_list":[],"uuid":"b153efed-b523-45fa-bc84-197cba91c832","name":"action_suspend","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"DAG","uuid":"e9e59418-028d-451b-9c31-a3092b3d2d90","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"}],"description":"","message_list":[],"uuid":"53142248-b1e3-4f88-8aae-931b454e0d71","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"e9e59418-028d-451b-9c31-a3092b3d2d90"},"name":"SYS_GEN__Runbook_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"}},{"description":"System action for modifying an application","message_list":[],"uuid":"5f379523-08ef-46ce-a214-8f759b657222","name":"action_modify","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"DAG","uuid":"05e16e19-6aca-4a0c-86bb-8e360155a21c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"}],"description":"","message_list":[],"uuid":"7c16ac57-b4cf-48b4-bfda-3e37321212fe","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"05e16e19-6aca-4a0c-86bb-8e360155a21c"},"name":"SYS_GEN__Runbook_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"}},{"description":"System action for powering off an application","message_list":[],"uuid":"705b73ad-71d4-4ad0-83e2-c70c777b4fb7","name":"action_poweroff","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"DAG","uuid":"05ef70f1-d465-45c9-97a9-d47f40017abc","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOff_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"98b15f3f-c869-44cc-bc83-2312684ae5f8"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"98b15f3f-c869-44cc-bc83-2312684ae5f8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_PowerOff_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"}],"description":"","message_list":[],"uuid":"897d7e18-c1c6-4d19-a6b4-10c1a721f4c0","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"05ef70f1-d465-45c9-97a9-d47f40017abc"},"name":"SYS_GEN__Runbook_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"684a522c-0ee5-4094-a912-b79c70988cb1","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"DAG","uuid":"c22643bd-abe4-449b-b705-ff60cf9ab15f","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Delete_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"56af71ea-febe-426a-8877-24bb241f3c52"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"DELETE_NUTANIX","uuid":"56af71ea-febe-426a-8877-24bb241f3c52","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Delete_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"}],"description":"","message_list":[],"uuid":"aa01078e-f99d-40a1-967a-af99b543be38","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"c22643bd-abe4-449b-b705-ff60cf9ab15f"},"name":"SYS_GEN__Runbook_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"c2f1500c-e3fb-41e0-82da-91840fb37d3d","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"DAG","uuid":"9584f1e8-a41d-4864-ace2-6b67544c0126","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Substrate_Element_Delete_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"12989b4b-3c8e-4ffc-bac3-56073c53fe61"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"12989b4b-3c8e-4ffc-bac3-56073c53fe61","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Substrate_Element_Delete_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"}],"description":"","message_list":[],"uuid":"1dfca661-ca45-488a-8f6e-da2aa26768c3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"9584f1e8-a41d-4864-ace2-6b67544c0126"},"name":"SYS_GEN__Runbook_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"}}],"message_list":[],"uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26","state":"ACTIVE","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS","uuid":"70ea3312-6ea8-4ace-9433-d77766f00ba2"}},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"categories":true,"name":true,"resources":{"nic_list":{"0":{"subnet_reference":true}},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"guest_customization":true,"disk_list":{"1":{"data_source_reference":true,"device_properties":{"disk_address":{"adapter_type":true},"device_type":true},"disk_size_mib":true},"0":{"device_properties":{"disk_address":{}},"disk_size_mib":true},"3":{"data_source_reference":true,"device_properties":{"disk_address":{"adapter_type":true},"device_type":true},"disk_size_mib":true},"2":{"data_source_reference":true,"device_properties":{"disk_address":{"adapter_type":true},"device_type":true},"disk_size_mib":true}}}}},"os_type":"Linux","type":"AHV_VM","create_spec":{"name":"K8SW-@@{calm_array_index}@@-@@{calm_time}@@","categories":"","availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"099dbe61-2c00-4964-9567-f547ec224e10"},"type":""}],"parent_reference":null,"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"serial_port_list":[],"gpu_list":[],"memory_size_mib":2048,"power_state":"ON","hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"type":"","boot_config":{"boot_device":{"type":"","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"AHV_CENTOS_76","uuid":"691d60b5-9272-4cb0-a4b4-4e8dc6f75277"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":1,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":2,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":3,"type":""}}}]}},"variable_list":[],"name":"AHV_Centos_K8SW"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"f4e1f318-e86e-4cfa-8cf2-8535c51a2282","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"DAG","uuid":"39600444-8c64-4ec6-ad53-5223e313284f","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Aws_Provision_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"7eaed2d6-0676-4749-b5c2-beefd39211eb"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AWS_Centos_K8SM_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"d2c67e6e-583d-452d-b98a-3ed04c794902"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Aws_Provision_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"7eaed2d6-0676-4749-b5c2-beefd39211eb"},"edge_type":"inherent","type":"","uuid":"6afcb46d-ca7c-4cb3-9769-ec3c6eba4033","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AWS_Centos_K8SM_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"d2c67e6e-583d-452d-b98a-3ed04c794902"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"PROVISION_AWS_VM","uuid":"7eaed2d6-0676-4749-b5c2-beefd39211eb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"name":"K8SM-@@{calm_array_index}@@-@@{calm_time}@@","availability_zone_reference":null,"backup_policy":null,"type":"PROVISION_AWS_VM","cluster_reference":null,"resources":{"instance_profile_name":"kubernetes-ebs-volumes","instance_type":"t2.medium","subnet_id":"subnet-c599a5ef","key_name":"calm-blueprints","region":"us-east-1","availability_zone":"us-east-1a","instance_initiated_shutdown_behavior":"","user_data":"","image_id":"ami-0ccec2041ac92b449","state":"RUNNING","security_group_list":[{"type":"","security_group_id":"sg-3b938f40"}],"block_device_map":{"data_disk_list":[{"size_gb":10,"volume_type":"GP2","device_name":"\/dev\/sdb","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"GP2","device_name":"\/dev\/sdc","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"GP2","device_name":"\/dev\/sdd","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"STANDARD","device_name":"\/dev\/sde","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"STANDARD","device_name":"\/dev\/sdf","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"STANDARD","device_name":"\/dev\/sdg","iops":1,"snapshot_id":"","type":"","delete_on_termination":true}],"type":"","root_disk":{"size_gb":10,"volume_type":"GP2","device_name":"\/dev\/sda1","iops":1,"snapshot_id":"","type":"","delete_on_termination":true}},"private_ip_address":"","vpc_id":"vpc-ffd54d98","tag_list":[{"type":"","value":"true","key":"kubernetes.io\/cluster\/@@{KUBE_CLUSTER_NAME}@@"}],"type":"","account_uuid":"8c2e0a6b-620a-c62a-c3f4-e58b101dfd0d","associate_public_ip_address":true}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Aws_Provision_2c077429_6628_4a1d_8153_776c6ecd4247"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"d2c67e6e-583d-452d-b98a-3ed04c794902","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{public_ip_address}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AWS_Centos_K8SM_2c077429_6628_4a1d_8153_776c6ecd4247"}],"description":"","message_list":[],"uuid":"b4e860cc-e5be-4f59-9702-04c83a3832cd","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"39600444-8c64-4ec6-ad53-5223e313284f"},"name":"SYS_GEN__Runbook_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247"}},{"description":"System action for powering on an application","message_list":[],"uuid":"bbdb262a-b244-45f7-a215-6ee8a67178be","name":"action_poweron","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"DAG","uuid":"9b3ed7d9-4631-4bcd-abb2-ee414b4cfc3b","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Aws_Operation_PowerOn_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"adab0f9b-0139-4ba1-9b08-41e0dcda275f"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AWS_Centos_K8SM_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"bb3c0e3b-e8bf-404a-9894-4f7addbcf13a"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Aws_Operation_PowerOn_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"adab0f9b-0139-4ba1-9b08-41e0dcda275f"},"edge_type":"inherent","type":"","uuid":"91ef9b79-cc62-4f84-b887-f62334da12cf","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AWS_Centos_K8SM_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"bb3c0e3b-e8bf-404a-9894-4f7addbcf13a"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"VMOPERATION_AWS_VM","uuid":"adab0f9b-0139-4ba1-9b08-41e0dcda275f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Aws_Operation_PowerOn_2c077429_6628_4a1d_8153_776c6ecd4247"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"bb3c0e3b-e8bf-404a-9894-4f7addbcf13a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{public_ip_address}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AWS_Centos_K8SM_2c077429_6628_4a1d_8153_776c6ecd4247"}],"description":"","message_list":[],"uuid":"96911906-9050-4cbd-ad31-8ababc7046cd","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"9b3ed7d9-4631-4bcd-abb2-ee414b4cfc3b"},"name":"SYS_GEN__Runbook_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247"}},{"description":"System action for restarting an application","message_list":[],"uuid":"d4d3037a-3231-4cb9-ab27-bd54f0410932","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"DAG","uuid":"a14af512-6c60-4d09-aa52-72154bf4542e","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Aws_Operation_Restart_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"815df9d2-efeb-48a1-b04e-f64805eea39b"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AWS_Centos_K8SM_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"c78a34aa-ae6e-4a0f-ad1d-fe5e634649ab"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Aws_Operation_Restart_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"815df9d2-efeb-48a1-b04e-f64805eea39b"},"edge_type":"inherent","type":"","uuid":"69e8f510-71cc-46df-8698-6418d3dc0e28","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AWS_Centos_K8SM_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"c78a34aa-ae6e-4a0f-ad1d-fe5e634649ab"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"VMOPERATION_AWS_VM","uuid":"815df9d2-efeb-48a1-b04e-f64805eea39b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Aws_Operation_Restart_2c077429_6628_4a1d_8153_776c6ecd4247"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"c78a34aa-ae6e-4a0f-ad1d-fe5e634649ab","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{public_ip_address}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AWS_Centos_K8SM_2c077429_6628_4a1d_8153_776c6ecd4247"}],"description":"","message_list":[],"uuid":"d9499ae4-9eea-4bb1-8a9c-aa97c693040c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"a14af512-6c60-4d09-aa52-72154bf4542e"},"name":"SYS_GEN__Runbook_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247"}},{"description":"System action for suspending an application","message_list":[],"uuid":"ffb8c472-8066-43de-8707-98949f6fd1c0","name":"action_suspend","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"DAG","uuid":"294d1d3e-9698-4f16-a4b5-e3f65b55e838","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247"}],"description":"","message_list":[],"uuid":"6231a56c-b6c2-41dd-b6d9-6610363bb4d8","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"294d1d3e-9698-4f16-a4b5-e3f65b55e838"},"name":"SYS_GEN__Runbook_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247"}},{"description":"System action for modifying an application","message_list":[],"uuid":"467d4d67-4ade-42ef-bf14-5aafe9099dc1","name":"action_modify","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"DAG","uuid":"516f3fb3-03f6-4ff8-86ad-db054e73e25d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247"}],"description":"","message_list":[],"uuid":"e276a150-b26b-4254-8933-392cf0adfa89","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"516f3fb3-03f6-4ff8-86ad-db054e73e25d"},"name":"SYS_GEN__Runbook_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247"}},{"description":"System action for powering off an application","message_list":[],"uuid":"67a2696d-7ba2-409d-af82-e78a06f9590b","name":"action_poweroff","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"DAG","uuid":"b115e8e4-1edc-48c0-b61d-5d9643a570bb","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Aws_Operation_PowerOff_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"714de774-1e0f-48bf-8f82-a283e95c18bc"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"VMOPERATION_AWS_VM","uuid":"714de774-1e0f-48bf-8f82-a283e95c18bc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Aws_Operation_PowerOff_2c077429_6628_4a1d_8153_776c6ecd4247"}],"description":"","message_list":[],"uuid":"6edeaf33-7e8b-4726-a1fa-5114bb4a850d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"b115e8e4-1edc-48c0-b61d-5d9643a570bb"},"name":"SYS_GEN__Runbook_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"a680fca1-8393-47bd-b1d4-fd35690a614d","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"DAG","uuid":"3dea5194-34a2-4b2f-a082-94c6e725b4ff","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Aws_Delete_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"bc5a65ec-63a7-4d15-ba41-13b7f44635d7"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"DELETE_AWS_VM","uuid":"bc5a65ec-63a7-4d15-ba41-13b7f44635d7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Aws_Delete_2c077429_6628_4a1d_8153_776c6ecd4247"}],"description":"","message_list":[],"uuid":"ef5e502e-516c-40cf-b3c5-f903d96e4193","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"3dea5194-34a2-4b2f-a082-94c6e725b4ff"},"name":"SYS_GEN__Runbook_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"f4a4835b-a477-4ad9-a87c-fb406d5654b3","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"DAG","uuid":"4e8790ae-868b-4cd7-aa57-4fc60924d0c0","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Substrate_Element_Delete_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"61ac5e1f-860a-43ba-934f-2458e02b1582"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"61ac5e1f-860a-43ba-934f-2458e02b1582","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Substrate_Element_Delete_2c077429_6628_4a1d_8153_776c6ecd4247"}],"description":"","message_list":[],"uuid":"fd0fdcc1-b9ed-40b1-ab58-b732cc2b4d28","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"4e8790ae-868b-4cd7-aa57-4fc60924d0c0"},"name":"SYS_GEN__Runbook_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247"}}],"message_list":[],"uuid":"2c077429-6628-4a1d-8153-776c6ecd4247","state":"ACTIVE","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{public_ip_address}@@","delay_secs":"0","connection_port":22},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"name":true,"resources":{"instance_profile_name":true,"availability_zone":true,"subnet_id":true,"key_name":true,"region":true,"user_data":true,"image_id":true,"instance_type":true,"security_group_list":true,"block_device_map":{"data_disk_list":{"1":{"size_gb":true},"0":{"size_gb":true},"3":{"size_gb":true},"2":{"size_gb":true},"5":{"size_gb":true},"4":{"size_gb":true}},"root_disk":{"size_gb":true}},"associate_public_ip_address":true,"vpc_id":true,"tag_list":true}}},"os_type":"Linux","type":"AWS_VM","create_spec":{"name":"K8SM-@@{calm_array_index}@@-@@{calm_time}@@","availability_zone_reference":null,"backup_policy":null,"type":"PROVISION_AWS_VM","cluster_reference":null,"resources":{"instance_profile_name":"kubernetes-ebs-volumes","instance_type":"t2.medium","subnet_id":"subnet-c599a5ef","key_name":"calm-blueprints","region":"us-east-1","availability_zone":"us-east-1a","instance_initiated_shutdown_behavior":"","user_data":"","image_id":"ami-0ccec2041ac92b449","state":"RUNNING","security_group_list":[{"type":"","security_group_id":"sg-3b938f40"}],"block_device_map":{"data_disk_list":[{"size_gb":10,"volume_type":"GP2","device_name":"\/dev\/sdb","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"GP2","device_name":"\/dev\/sdc","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"GP2","device_name":"\/dev\/sdd","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"STANDARD","device_name":"\/dev\/sde","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"STANDARD","device_name":"\/dev\/sdf","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"STANDARD","device_name":"\/dev\/sdg","iops":1,"snapshot_id":"","type":"","delete_on_termination":true}],"type":"","root_disk":{"size_gb":10,"volume_type":"GP2","device_name":"\/dev\/sda1","iops":1,"snapshot_id":"","type":"","delete_on_termination":true}},"private_ip_address":"","vpc_id":"vpc-ffd54d98","tag_list":[{"type":"","value":"true","key":"kubernetes.io\/cluster\/@@{KUBE_CLUSTER_NAME}@@"}],"type":"","account_uuid":"8c2e0a6b-620a-c62a-c3f4-e58b101dfd0d","associate_public_ip_address":true}},"variable_list":[],"name":"AWS_Centos_K8SM"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"1a515740-9b8f-4bed-a430-15a04b6a8153","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"DAG","uuid":"c4818721-cfa4-42e1-849f-a1cc2cfcab08","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Aws_Provision_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"0cba41ca-87c0-49a4-b5f8-a82fc052884a"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AWS_Centos_K8SW_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"b50964bb-205e-4de1-895c-361decd5f613"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Aws_Provision_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"0cba41ca-87c0-49a4-b5f8-a82fc052884a"},"edge_type":"inherent","type":"","uuid":"76517304-5d23-4f30-8f36-fad2b45f881a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AWS_Centos_K8SW_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"b50964bb-205e-4de1-895c-361decd5f613"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_190048e5_32e8_44b5_abe9_91374efc543b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"PROVISION_AWS_VM","uuid":"0cba41ca-87c0-49a4-b5f8-a82fc052884a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"name":"K8SW-@@{calm_array_index}@@-@@{calm_time}@@","availability_zone_reference":null,"backup_policy":null,"type":"PROVISION_AWS_VM","cluster_reference":null,"resources":{"instance_profile_name":"kubernetes-ebs-volumes","instance_type":"t2.large","subnet_id":"subnet-9d1085b1","key_name":"calm-blueprints","region":"us-east-1","availability_zone":"us-east-1a","instance_initiated_shutdown_behavior":"","user_data":"","image_id":"ami-0ccec2041ac92b449","state":"RUNNING","security_group_list":[{"type":"","security_group_id":"sg-3b938f40"}],"block_device_map":{"data_disk_list":[{"size_gb":8,"volume_type":"GP2","device_name":"\/dev\/sdb","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":8,"volume_type":"GP2","device_name":"\/dev\/sdc","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":8,"volume_type":"GP2","device_name":"\/dev\/sdd","iops":1,"snapshot_id":"","type":"","delete_on_termination":true}],"type":"","root_disk":{"size_gb":8,"volume_type":"GP2","device_name":"\/dev\/sda1","iops":1,"snapshot_id":"","type":"","delete_on_termination":true}},"private_ip_address":"","vpc_id":"vpc-ffd54d98","tag_list":[{"type":"","value":"owned","key":"kubernetes.io\/cluster\/@@{KUBE_CLUSTER_NAME}@@"}],"type":"","account_uuid":"8c2e0a6b-620a-c62a-c3f4-e58b101dfd0d","associate_public_ip_address":true}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Aws_Provision_190048e5_32e8_44b5_abe9_91374efc543b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"b50964bb-205e-4de1-895c-361decd5f613","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{public_ip_address}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AWS_Centos_K8SW_190048e5_32e8_44b5_abe9_91374efc543b"}],"description":"","message_list":[],"uuid":"54a68898-9143-4a38-8317-bc79057fe2be","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"c4818721-cfa4-42e1-849f-a1cc2cfcab08"},"name":"SYS_GEN__Runbook_Substrate_190048e5_32e8_44b5_abe9_91374efc543b"}},{"description":"System action for powering on an application","message_list":[],"uuid":"ee1e2fed-81ca-4347-a935-47a2e6f40dbc","name":"action_poweron","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"DAG","uuid":"733efdbe-83a8-4f73-98a4-2d68d3212fc3","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Aws_Operation_PowerOn_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"fab16ed1-37af-43fb-b174-067e02768a9a"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AWS_Centos_K8SW_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"7895d68b-e4b6-4a8e-a651-1a9ed9406f2c"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Aws_Operation_PowerOn_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"fab16ed1-37af-43fb-b174-067e02768a9a"},"edge_type":"inherent","type":"","uuid":"bb0cefd1-8c8a-4bca-8179-18a25ab58181","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AWS_Centos_K8SW_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"7895d68b-e4b6-4a8e-a651-1a9ed9406f2c"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_190048e5_32e8_44b5_abe9_91374efc543b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"VMOPERATION_AWS_VM","uuid":"fab16ed1-37af-43fb-b174-067e02768a9a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Aws_Operation_PowerOn_190048e5_32e8_44b5_abe9_91374efc543b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"7895d68b-e4b6-4a8e-a651-1a9ed9406f2c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{public_ip_address}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AWS_Centos_K8SW_190048e5_32e8_44b5_abe9_91374efc543b"}],"description":"","message_list":[],"uuid":"4b5cf38b-5720-413a-9f89-0ccfe6da8154","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"733efdbe-83a8-4f73-98a4-2d68d3212fc3"},"name":"SYS_GEN__Runbook_Substrate_190048e5_32e8_44b5_abe9_91374efc543b"}},{"description":"System action for restarting an application","message_list":[],"uuid":"c7d71fea-dc13-4772-9c24-0110e8ff3cbb","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"DAG","uuid":"d2b123b6-e92f-49a3-b4a7-34d5ef859fb1","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Aws_Operation_Restart_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"834f6816-ef3c-4ac7-8294-473527aecfd1"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AWS_Centos_K8SW_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"37e78d3d-15fc-4773-9989-fb3ddc3bb9a6"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Aws_Operation_Restart_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"834f6816-ef3c-4ac7-8294-473527aecfd1"},"edge_type":"inherent","type":"","uuid":"8f823ad7-2e71-4cfa-bee8-cd09e5cbedd3","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AWS_Centos_K8SW_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"37e78d3d-15fc-4773-9989-fb3ddc3bb9a6"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_190048e5_32e8_44b5_abe9_91374efc543b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"VMOPERATION_AWS_VM","uuid":"834f6816-ef3c-4ac7-8294-473527aecfd1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Aws_Operation_Restart_190048e5_32e8_44b5_abe9_91374efc543b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"37e78d3d-15fc-4773-9989-fb3ddc3bb9a6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{public_ip_address}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AWS_Centos_K8SW_190048e5_32e8_44b5_abe9_91374efc543b"}],"description":"","message_list":[],"uuid":"74faa3cf-fc81-455c-9706-0a2a4f4231b3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"d2b123b6-e92f-49a3-b4a7-34d5ef859fb1"},"name":"SYS_GEN__Runbook_Substrate_190048e5_32e8_44b5_abe9_91374efc543b"}},{"description":"System action for suspending an application","message_list":[],"uuid":"44cf6eb1-4c4e-4dc3-8813-27f0e41a1757","name":"action_suspend","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"DAG","uuid":"d41ed76d-23c6-4440-93e1-76a856f91882","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_190048e5_32e8_44b5_abe9_91374efc543b"}],"description":"","message_list":[],"uuid":"4743c3e0-4ef3-44fd-9c6a-5de26424593e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"d41ed76d-23c6-4440-93e1-76a856f91882"},"name":"SYS_GEN__Runbook_Substrate_190048e5_32e8_44b5_abe9_91374efc543b"}},{"description":"System action for modifying an application","message_list":[],"uuid":"7938408e-825b-410b-a98d-a6a0af553d6b","name":"action_modify","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"DAG","uuid":"89db82d3-2a9b-4cdd-9306-0d7c430c9f28","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_190048e5_32e8_44b5_abe9_91374efc543b"}],"description":"","message_list":[],"uuid":"7ce2aea9-8545-420c-9a4c-c784ea4f0a5e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"89db82d3-2a9b-4cdd-9306-0d7c430c9f28"},"name":"SYS_GEN__Runbook_Substrate_190048e5_32e8_44b5_abe9_91374efc543b"}},{"description":"System action for powering off an application","message_list":[],"uuid":"388b7321-4b1e-4930-87c3-4de18e1c64a5","name":"action_poweroff","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"DAG","uuid":"9fdf2837-ba70-434f-925d-ad304cba76f9","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Aws_Operation_PowerOff_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"f2ab2732-dad5-4ca9-aa7d-cdbb267b02e7"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_190048e5_32e8_44b5_abe9_91374efc543b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"VMOPERATION_AWS_VM","uuid":"f2ab2732-dad5-4ca9-aa7d-cdbb267b02e7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Aws_Operation_PowerOff_190048e5_32e8_44b5_abe9_91374efc543b"}],"description":"","message_list":[],"uuid":"7a3d22ff-8a4a-43c2-9eb2-07b0ffa96367","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"9fdf2837-ba70-434f-925d-ad304cba76f9"},"name":"SYS_GEN__Runbook_Substrate_190048e5_32e8_44b5_abe9_91374efc543b"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"440fded6-e780-4a99-947d-38dfdd997cfd","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"DAG","uuid":"73c9f188-e720-4d89-aebe-36ab63ab78ca","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Aws_Delete_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"e0197c39-dcac-43bd-bfe6-79effbdee957"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_190048e5_32e8_44b5_abe9_91374efc543b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"DELETE_AWS_VM","uuid":"e0197c39-dcac-43bd-bfe6-79effbdee957","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Aws_Delete_190048e5_32e8_44b5_abe9_91374efc543b"}],"description":"","message_list":[],"uuid":"ebbab961-26f8-4dbf-a896-97ae805f7900","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"73c9f188-e720-4d89-aebe-36ab63ab78ca"},"name":"SYS_GEN__Runbook_Substrate_190048e5_32e8_44b5_abe9_91374efc543b"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"bcf18919-fe6c-44ae-985a-74e4c1b12626","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"DAG","uuid":"2f4a78fc-0dfa-4202-a189-52474f45b22b","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Substrate_Element_Delete_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"11fbfbf0-ae53-4840-9959-35c69f567742"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_190048e5_32e8_44b5_abe9_91374efc543b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"11fbfbf0-ae53-4840-9959-35c69f567742","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Substrate_Element_Delete_190048e5_32e8_44b5_abe9_91374efc543b"}],"description":"","message_list":[],"uuid":"d3966b00-3afe-4613-a490-54e6a8fdadb3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"2f4a78fc-0dfa-4202-a189-52474f45b22b"},"name":"SYS_GEN__Runbook_Substrate_190048e5_32e8_44b5_abe9_91374efc543b"}}],"message_list":[],"uuid":"190048e5-32e8-44b5-abe9-91374efc543b","state":"ACTIVE","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{public_ip_address}@@","delay_secs":"0","connection_port":22},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"name":true,"resources":{"instance_profile_name":true,"availability_zone":true,"subnet_id":true,"key_name":true,"region":true,"user_data":true,"image_id":true,"instance_type":true,"security_group_list":true,"block_device_map":{"data_disk_list":{"1":{"size_gb":true},"0":{"size_gb":true},"2":{"size_gb":true}},"root_disk":{"size_gb":true}},"associate_public_ip_address":true,"vpc_id":true,"tag_list":true}}},"os_type":"Linux","type":"AWS_VM","create_spec":{"name":"K8SW-@@{calm_array_index}@@-@@{calm_time}@@","availability_zone_reference":null,"backup_policy":null,"type":"PROVISION_AWS_VM","cluster_reference":null,"resources":{"instance_profile_name":"kubernetes-ebs-volumes","instance_type":"t2.large","subnet_id":"subnet-9d1085b1","key_name":"calm-blueprints","region":"us-east-1","availability_zone":"us-east-1a","instance_initiated_shutdown_behavior":"","user_data":"","image_id":"ami-0ccec2041ac92b449","state":"RUNNING","security_group_list":[{"type":"","security_group_id":"sg-3b938f40"}],"block_device_map":{"data_disk_list":[{"size_gb":8,"volume_type":"GP2","device_name":"\/dev\/sdb","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":8,"volume_type":"GP2","device_name":"\/dev\/sdc","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":8,"volume_type":"GP2","device_name":"\/dev\/sdd","iops":1,"snapshot_id":"","type":"","delete_on_termination":true}],"type":"","root_disk":{"size_gb":8,"volume_type":"GP2","device_name":"\/dev\/sda1","iops":1,"snapshot_id":"","type":"","delete_on_termination":true}},"private_ip_address":"","vpc_id":"vpc-ffd54d98","tag_list":[{"type":"","value":"owned","key":"kubernetes.io\/cluster\/@@{KUBE_CLUSTER_NAME}@@"}],"type":"","account_uuid":"8c2e0a6b-620a-c62a-c3f4-e58b101dfd0d","associate_public_ip_address":true}},"variable_list":[],"name":"AWS_Centos_K8SW"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"d8af328c-2ecb-4667-b4dc-dc41587cc186","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"DAG","uuid":"bbbe7e6c-46b8-412f-9d46-b310a82e4166","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Gcp_Provision_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"8c2eae04-125d-491b-acd5-f34a0723015a"},{"kind":"app_task","name":"SYS_GEN__check_login_for_GCP_Centos_K8SM_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"968e1117-4e11-425c-9c1f-bf5d06231cbd"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Gcp_Provision_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"8c2eae04-125d-491b-acd5-f34a0723015a"},"edge_type":"inherent","type":"","uuid":"25415c8e-2c75-45cd-b945-4c6c168137cb","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_GCP_Centos_K8SM_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"968e1117-4e11-425c-9c1f-bf5d06231cbd"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"PROVISION_GCP_VM","uuid":"8c2eae04-125d-491b-acd5-f34a0723015a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"PROVISION_GCP_VM","resources":{"labels":[],"machineType":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/machineTypes\/n1-highcpu-2","description":"","zone":"us-central1-c","tags":{"items":[],"type":"","fingerprint":""},"guestCustomization":{"type":"","sysprep":"","startupScript":""},"labelFingerprint":"","disks":[{"diskEncryptionKey":{"rawKey":"","type":""},"deviceName":"","initializeParams":{"sourceImageEncryptionKey":{"rawKey":"","type":""},"diskName":"","diskType":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","diskSizeGb":10,"sourceImage":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/global\/images\/centos-7","type":""},"autoDelete":true,"boot":true,"source":"","mode":"","interface":"","disk_type":"PERSISTENT","type":""}],"metadata":{"items":[],"type":"","fingerprint":""},"sshKeys":["centos:ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDMGAS\/K0Mb\/uwFXwD+hkjguy7VMZk2hpuhwPl9FUZwVBrURf\/i9QMJ5\/paPEZixu8VlRx7Inu4iun7rQfrnfeIYInmBwspXHYiTK3oHJAgZnrAHVEf1p6YaxLINlT1NI5yOAGPRWW6of8rBDBH1ObwU2+wcSx\/1H0uIs3aZNLufr+Rh628ACxAum2Gt8AVRj6ua2BPFyt5VTdclyysAmeh1AiixNgOZXOz6y\/i4TbzpY78I3isuKpxsUeXX6jxEMQol406jHDUF6njEOPIQG2zVZ3QJlTG9OlN+NiyZG9WkZz0VG\/6M8ixxIHHI2dNwUbBFv2HUu+8X9LTLFq2O7KjX9Hp7uZKBAySHA3eKaKHIp2bZuU1bT5PRPkggngX86xg+T+OMNnutbAiMnRJ8+FvD5So+5TIx4b9GgxAxure3x2yRPT9lOiQOB+CVpJPxR0Rn9bOI+wiPnD0kAGvK\/fHT+pqL4PM+hTnJtp9rrCRzIQApBx1263jEcYffhW2epZQRO+he5CMawFJ5TBe08om2AaDJ8GQdrpF6YA3W8DzHbmL3DPVVHdmqPLn10o+LX4gv5SdIIDVGdjKOc1BCnLTRmM28d5+sLDt\/M+kvcQgf0y0yDjMVjGECZkt39hbm4ELMHzZtzYLmHNhBZxRqHeJ7qFTuv1kx88OW3Xc5mbBNQ== centos@nutanix.com\n"],"minCpuPlatform":"","scheduling":{"automaticRestart":true,"type":"","preemptible":false,"onHostMaintenance":"TERMINATE"},"canIpForward":false,"blankDisks":[{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk1-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk2-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk3-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk4-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk5-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk6-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true}],"networkInterfaces":[{"aliasIpRanges":[],"network":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/global\/networks\/default","accessConfigs":[{"config_type":"ONE_TO_ONE_NAT","type":"","name":"k8sc-acn-@@{calm_array_index}@@-@@{calm_time}@@","natIP":""}],"networkIP":"","subnetwork":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/regions\/us-central1\/subnetworks\/default","type":"","associatePublicIP":true}],"type":"","account_uuid":"84213a31-4fe8-7e39-3799-e093e5d0dc2e","serviceAccounts":[{"scopes":["https:\/\/www.googleapis.com\/auth\/cloud-platform"],"type":"","email":"108048128720-compute@developer.gserviceaccount.com"}],"name":"k8sm-@@{calm_array_index}@@-@@{calm_time}@@"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Gcp_Provision_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"968e1117-4e11-425c-9c1f-bf5d06231cbd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{public_ip_address}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_GCP_Centos_K8SM_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"}],"description":"","message_list":[],"uuid":"880ea93e-b225-4a7c-a0a3-9b7fee60b57e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"bbbe7e6c-46b8-412f-9d46-b310a82e4166"},"name":"SYS_GEN__Runbook_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"}},{"description":"System action for powering on an application","message_list":[],"uuid":"c87cadb0-563c-4f72-9bbd-910d51c9f7e6","name":"action_poweron","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"DAG","uuid":"cda0d8c7-eac4-4a45-90d1-245858803cb5","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Gcp_Operation_PowerOn_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"5a0a273d-82e0-485b-a90a-c3c117633e5e"},{"kind":"app_task","name":"SYS_GEN__check_login_for_GCP_Centos_K8SM_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"03fe6b3d-5353-4119-a85d-1919c860733e"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Gcp_Operation_PowerOn_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"5a0a273d-82e0-485b-a90a-c3c117633e5e"},"edge_type":"inherent","type":"","uuid":"dfff3919-0be8-4b07-93f8-d42bc61e391f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_GCP_Centos_K8SM_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"03fe6b3d-5353-4119-a85d-1919c860733e"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"VMOPERATION_GCP_VM","uuid":"5a0a273d-82e0-485b-a90a-c3c117633e5e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Gcp_Operation_PowerOn_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"03fe6b3d-5353-4119-a85d-1919c860733e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{public_ip_address}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_GCP_Centos_K8SM_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"}],"description":"","message_list":[],"uuid":"dcd79a6f-3f26-4bae-a713-2e2afc1cf3a7","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"cda0d8c7-eac4-4a45-90d1-245858803cb5"},"name":"SYS_GEN__Runbook_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"}},{"description":"System action for restarting an application","message_list":[],"uuid":"649b192f-8d61-4885-aa34-2409251419e2","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"DAG","uuid":"219c3254-9852-4ef2-9ac0-5c3fd428a1fb","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Gcp_Operation_Restart_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"12215065-22e2-4bee-bf10-cdab56dbe85f"},{"kind":"app_task","name":"SYS_GEN__check_login_for_GCP_Centos_K8SM_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"8d828d85-9f34-48b0-aef2-9dc08bacab68"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Gcp_Operation_Restart_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"12215065-22e2-4bee-bf10-cdab56dbe85f"},"edge_type":"inherent","type":"","uuid":"38a0172e-710f-47d8-82c4-31804cacd5ba","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_GCP_Centos_K8SM_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"8d828d85-9f34-48b0-aef2-9dc08bacab68"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"VMOPERATION_GCP_VM","uuid":"12215065-22e2-4bee-bf10-cdab56dbe85f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Gcp_Operation_Restart_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"8d828d85-9f34-48b0-aef2-9dc08bacab68","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{public_ip_address}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_GCP_Centos_K8SM_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"}],"description":"","message_list":[],"uuid":"c19288f6-e0d7-4a04-b697-ad707aa6ef83","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"219c3254-9852-4ef2-9ac0-5c3fd428a1fb"},"name":"SYS_GEN__Runbook_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"}},{"description":"System action for suspending an application","message_list":[],"uuid":"ea57d55b-54df-48c7-a83e-f312004fbd30","name":"action_suspend","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"DAG","uuid":"a09cd374-803c-498e-b78a-770081458378","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"}],"description":"","message_list":[],"uuid":"7d0272d7-3a98-4e10-8dd6-8aa85ed7d3a6","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"a09cd374-803c-498e-b78a-770081458378"},"name":"SYS_GEN__Runbook_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"}},{"description":"System action for modifying an application","message_list":[],"uuid":"da7004f7-ca21-4581-b2a0-42759e773812","name":"action_modify","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"DAG","uuid":"3c1b3c5b-98ca-43ad-b881-d916da058ccd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"}],"description":"","message_list":[],"uuid":"e58d1bd7-0521-4f7b-b885-ebcdadc04ffc","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"3c1b3c5b-98ca-43ad-b881-d916da058ccd"},"name":"SYS_GEN__Runbook_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"}},{"description":"System action for powering off an application","message_list":[],"uuid":"43af78cc-7ad4-403e-87d1-c843f90754c3","name":"action_poweroff","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"DAG","uuid":"8cede924-6289-4f0d-b650-b7dc00fee299","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Gcp_Operation_PowerOff_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"5346e269-1f11-48ca-9cf7-3b2706981990"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"VMOPERATION_GCP_VM","uuid":"5346e269-1f11-48ca-9cf7-3b2706981990","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Gcp_Operation_PowerOff_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"}],"description":"","message_list":[],"uuid":"fce4dd1e-7e76-4518-af76-a58dea5186f6","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"8cede924-6289-4f0d-b650-b7dc00fee299"},"name":"SYS_GEN__Runbook_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"817baca7-5c1f-4474-9812-86a94e64d560","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"DAG","uuid":"592a78e4-bcf1-4c35-aa03-9ec5c2a53148","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Gcp_Delete_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"ea3b59c9-14b6-441a-abd8-0860189e2e35"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"DELETE_GCP_VM","uuid":"ea3b59c9-14b6-441a-abd8-0860189e2e35","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Gcp_Delete_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"}],"description":"","message_list":[],"uuid":"b394f7c2-b79e-433e-8e73-305836500cbe","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"592a78e4-bcf1-4c35-aa03-9ec5c2a53148"},"name":"SYS_GEN__Runbook_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"0910a041-ae0c-4c27-bd87-c095cfe0589b","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"DAG","uuid":"d61ec3d5-717d-4c3a-9231-d2171a15a897","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Substrate_Element_Delete_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"6cbf87a2-43ad-44bd-a270-6240c4581817"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"6cbf87a2-43ad-44bd-a270-6240c4581817","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Substrate_Element_Delete_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"}],"description":"","message_list":[],"uuid":"63354784-367f-47cd-94cd-a6d6ad8f3be6","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"d61ec3d5-717d-4c3a-9231-d2171a15a897"},"name":"SYS_GEN__Runbook_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"}}],"message_list":[],"uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5","state":"ACTIVE","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{public_ip_address}@@","delay_secs":"0","connection_port":22},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"timeout_secs":true,"address":true,"delay_secs":true,"connection_port":true},"create_spec":{"resources":{"labels":true,"machineType":true,"name":true,"zone":true,"tags":{"items":true},"guestCustomization":{"startupScript":true},"disks":{"0":{"initializeParams":{"diskSizeGb":true,"sourceImage":true,"diskType":true},"autoDelete":true}},"blankDisks":{"1":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true},"0":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true},"3":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true},"2":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true},"5":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true},"4":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true}},"networkInterfaces":{"0":{"accessConfigs":{"0":{"config_type":true,"name":true}},"network":true,"subnetwork":true,"associatePublicIP":true}},"sshKeys":{"0":true},"serviceAccounts":{"0":{"scopes":true,"email":true}},"metadata":{"items":true}}}},"os_type":"Linux","type":"GCP_VM","create_spec":{"type":"PROVISION_GCP_VM","resources":{"labels":[],"machineType":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/machineTypes\/n1-highcpu-2","description":"","zone":"us-central1-c","tags":{"items":[],"type":"","fingerprint":""},"guestCustomization":{"type":"","sysprep":"","startupScript":""},"labelFingerprint":"","disks":[{"diskEncryptionKey":{"rawKey":"","type":""},"deviceName":"","initializeParams":{"sourceImageEncryptionKey":{"rawKey":"","type":""},"diskName":"","diskType":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","diskSizeGb":10,"sourceImage":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/global\/images\/centos-7","type":""},"autoDelete":true,"boot":true,"source":"","mode":"","interface":"","disk_type":"PERSISTENT","type":""}],"metadata":{"items":[],"type":"","fingerprint":""},"sshKeys":["centos:ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDMGAS\/K0Mb\/uwFXwD+hkjguy7VMZk2hpuhwPl9FUZwVBrURf\/i9QMJ5\/paPEZixu8VlRx7Inu4iun7rQfrnfeIYInmBwspXHYiTK3oHJAgZnrAHVEf1p6YaxLINlT1NI5yOAGPRWW6of8rBDBH1ObwU2+wcSx\/1H0uIs3aZNLufr+Rh628ACxAum2Gt8AVRj6ua2BPFyt5VTdclyysAmeh1AiixNgOZXOz6y\/i4TbzpY78I3isuKpxsUeXX6jxEMQol406jHDUF6njEOPIQG2zVZ3QJlTG9OlN+NiyZG9WkZz0VG\/6M8ixxIHHI2dNwUbBFv2HUu+8X9LTLFq2O7KjX9Hp7uZKBAySHA3eKaKHIp2bZuU1bT5PRPkggngX86xg+T+OMNnutbAiMnRJ8+FvD5So+5TIx4b9GgxAxure3x2yRPT9lOiQOB+CVpJPxR0Rn9bOI+wiPnD0kAGvK\/fHT+pqL4PM+hTnJtp9rrCRzIQApBx1263jEcYffhW2epZQRO+he5CMawFJ5TBe08om2AaDJ8GQdrpF6YA3W8DzHbmL3DPVVHdmqPLn10o+LX4gv5SdIIDVGdjKOc1BCnLTRmM28d5+sLDt\/M+kvcQgf0y0yDjMVjGECZkt39hbm4ELMHzZtzYLmHNhBZxRqHeJ7qFTuv1kx88OW3Xc5mbBNQ== centos@nutanix.com\n"],"minCpuPlatform":"","scheduling":{"automaticRestart":true,"type":"","preemptible":false,"onHostMaintenance":"TERMINATE"},"canIpForward":false,"blankDisks":[{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk1-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk2-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk3-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk4-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk5-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk6-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true}],"networkInterfaces":[{"aliasIpRanges":[],"network":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/global\/networks\/default","accessConfigs":[{"config_type":"ONE_TO_ONE_NAT","type":"","name":"k8sc-acn-@@{calm_array_index}@@-@@{calm_time}@@","natIP":""}],"networkIP":"","subnetwork":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/regions\/us-central1\/subnetworks\/default","type":"","associatePublicIP":true}],"type":"","account_uuid":"84213a31-4fe8-7e39-3799-e093e5d0dc2e","serviceAccounts":[{"scopes":["https:\/\/www.googleapis.com\/auth\/cloud-platform"],"type":"","email":"108048128720-compute@developer.gserviceaccount.com"}],"name":"k8sm-@@{calm_array_index}@@-@@{calm_time}@@"}},"variable_list":[],"name":"GCP_Centos_K8SM"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"f96d50ae-bfda-403d-9797-548d5a27faf2","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"DAG","uuid":"86710287-92d5-4f0c-ad2f-4f8e9358d53f","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Gcp_Provision_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"3a28a291-d55b-44c9-b120-da58a277d765"},{"kind":"app_task","name":"SYS_GEN__check_login_for_GCP_Centos_K8SW_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"74d150f9-a35a-4384-88bc-b225ce42dae3"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Gcp_Provision_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"3a28a291-d55b-44c9-b120-da58a277d765"},"edge_type":"inherent","type":"","uuid":"87a4a736-9338-4226-9380-45050bc646ae","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_GCP_Centos_K8SW_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"74d150f9-a35a-4384-88bc-b225ce42dae3"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"PROVISION_GCP_VM","uuid":"3a28a291-d55b-44c9-b120-da58a277d765","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"PROVISION_GCP_VM","resources":{"labels":[],"machineType":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/machineTypes\/n1-highcpu-4","description":"","zone":"us-central1-c","tags":{"items":[],"type":"","fingerprint":""},"guestCustomization":{"type":"","sysprep":"","startupScript":""},"labelFingerprint":"","disks":[{"diskEncryptionKey":{"rawKey":"","type":""},"deviceName":"","initializeParams":{"sourceImageEncryptionKey":{"rawKey":"","type":""},"diskName":"","diskType":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","diskSizeGb":10,"sourceImage":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/global\/images\/centos-7","type":""},"autoDelete":true,"boot":true,"source":"","mode":"","interface":"","disk_type":"PERSISTENT","type":""}],"metadata":{"items":[],"type":"","fingerprint":""},"sshKeys":["centos:ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDMGAS\/K0Mb\/uwFXwD+hkjguy7VMZk2hpuhwPl9FUZwVBrURf\/i9QMJ5\/paPEZixu8VlRx7Inu4iun7rQfrnfeIYInmBwspXHYiTK3oHJAgZnrAHVEf1p6YaxLINlT1NI5yOAGPRWW6of8rBDBH1ObwU2+wcSx\/1H0uIs3aZNLufr+Rh628ACxAum2Gt8AVRj6ua2BPFyt5VTdclyysAmeh1AiixNgOZXOz6y\/i4TbzpY78I3isuKpxsUeXX6jxEMQol406jHDUF6njEOPIQG2zVZ3QJlTG9OlN+NiyZG9WkZz0VG\/6M8ixxIHHI2dNwUbBFv2HUu+8X9LTLFq2O7KjX9Hp7uZKBAySHA3eKaKHIp2bZuU1bT5PRPkggngX86xg+T+OMNnutbAiMnRJ8+FvD5So+5TIx4b9GgxAxure3x2yRPT9lOiQOB+CVpJPxR0Rn9bOI+wiPnD0kAGvK\/fHT+pqL4PM+hTnJtp9rrCRzIQApBx1263jEcYffhW2epZQRO+he5CMawFJ5TBe08om2AaDJ8GQdrpF6YA3W8DzHbmL3DPVVHdmqPLn10o+LX4gv5SdIIDVGdjKOc1BCnLTRmM28d5+sLDt\/M+kvcQgf0y0yDjMVjGECZkt39hbm4ELMHzZtzYLmHNhBZxRqHeJ7qFTuv1kx88OW3Xc5mbBNQ== centos@nutanix.com\n"],"minCpuPlatform":"","scheduling":{"automaticRestart":true,"type":"","preemptible":false,"onHostMaintenance":"TERMINATE"},"canIpForward":false,"blankDisks":[{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sm-disk1-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sm-disk2-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sm-disk3-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true}],"networkInterfaces":[{"aliasIpRanges":[],"network":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/global\/networks\/default","accessConfigs":[{"config_type":"ONE_TO_ONE_NAT","type":"","name":"k8sm-acm-@@{calm_array_index}@@-@@{calm_time}@@","natIP":""}],"networkIP":"","subnetwork":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/regions\/us-central1\/subnetworks\/default","type":"","associatePublicIP":true}],"type":"","account_uuid":"84213a31-4fe8-7e39-3799-e093e5d0dc2e","serviceAccounts":[{"scopes":["https:\/\/www.googleapis.com\/auth\/cloud-platform"],"type":"","email":"108048128720-compute@developer.gserviceaccount.com"}],"name":"k8sw-@@{calm_array_index}@@-@@{calm_time}@@"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Gcp_Provision_fd41b059_b412_4c19_ba36_ca417a5806ab"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"74d150f9-a35a-4384-88bc-b225ce42dae3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{public_ip_address}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_GCP_Centos_K8SW_fd41b059_b412_4c19_ba36_ca417a5806ab"}],"description":"","message_list":[],"uuid":"6964e301-bd60-4861-90d7-5c2afcf2c4ef","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"86710287-92d5-4f0c-ad2f-4f8e9358d53f"},"name":"SYS_GEN__Runbook_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab"}},{"description":"System action for powering on an application","message_list":[],"uuid":"a11bd03b-a8b8-440d-9545-dc188b25a14a","name":"action_poweron","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"DAG","uuid":"1d44225a-ef9f-46a8-ad8a-03b0ae12961b","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Gcp_Operation_PowerOn_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"b4b83fbf-e9b8-4716-9457-81e5c7158f95"},{"kind":"app_task","name":"SYS_GEN__check_login_for_GCP_Centos_K8SW_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"6ac1d728-924a-4c1b-a8f0-6534931b5080"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Gcp_Operation_PowerOn_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"b4b83fbf-e9b8-4716-9457-81e5c7158f95"},"edge_type":"inherent","type":"","uuid":"d4091147-1d11-42b4-86be-081a6a6c88ad","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_GCP_Centos_K8SW_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"6ac1d728-924a-4c1b-a8f0-6534931b5080"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"VMOPERATION_GCP_VM","uuid":"b4b83fbf-e9b8-4716-9457-81e5c7158f95","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Gcp_Operation_PowerOn_fd41b059_b412_4c19_ba36_ca417a5806ab"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"6ac1d728-924a-4c1b-a8f0-6534931b5080","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{public_ip_address}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_GCP_Centos_K8SW_fd41b059_b412_4c19_ba36_ca417a5806ab"}],"description":"","message_list":[],"uuid":"6c7fc381-c137-4c63-94e6-b206b9c149a5","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"1d44225a-ef9f-46a8-ad8a-03b0ae12961b"},"name":"SYS_GEN__Runbook_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab"}},{"description":"System action for restarting an application","message_list":[],"uuid":"eed45980-9bf1-4d14-adcf-af2b8fff2623","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"DAG","uuid":"df7dc0f1-4535-47d6-b895-c83b4649622f","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Gcp_Operation_Restart_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"87b1000d-4fcd-4e52-9556-02c617413dfc"},{"kind":"app_task","name":"SYS_GEN__check_login_for_GCP_Centos_K8SW_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"925f81f1-973e-41dc-b293-5ad833ae7e53"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Gcp_Operation_Restart_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"87b1000d-4fcd-4e52-9556-02c617413dfc"},"edge_type":"inherent","type":"","uuid":"609b4c05-3020-4266-9af9-c604b8da1ba9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_GCP_Centos_K8SW_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"925f81f1-973e-41dc-b293-5ad833ae7e53"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"VMOPERATION_GCP_VM","uuid":"87b1000d-4fcd-4e52-9556-02c617413dfc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Gcp_Operation_Restart_fd41b059_b412_4c19_ba36_ca417a5806ab"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"925f81f1-973e-41dc-b293-5ad833ae7e53","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{public_ip_address}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_GCP_Centos_K8SW_fd41b059_b412_4c19_ba36_ca417a5806ab"}],"description":"","message_list":[],"uuid":"d7bf312a-bf6e-4666-9d5b-21b2f328a9a6","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"df7dc0f1-4535-47d6-b895-c83b4649622f"},"name":"SYS_GEN__Runbook_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab"}},{"description":"System action for suspending an application","message_list":[],"uuid":"3aac2f21-b1e8-4d7a-8d95-3f768e1e58db","name":"action_suspend","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"DAG","uuid":"6dd510fa-55e7-47a9-9b8b-beda5a3d14e0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab"}],"description":"","message_list":[],"uuid":"9fa7a2aa-ce97-4bfb-9185-4338c102db42","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"6dd510fa-55e7-47a9-9b8b-beda5a3d14e0"},"name":"SYS_GEN__Runbook_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab"}},{"description":"System action for modifying an application","message_list":[],"uuid":"db9bdaf8-88fd-4da9-acf5-9ec2f0e18f2b","name":"action_modify","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"DAG","uuid":"971edab6-e743-4703-974f-4ca293ed4abf","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab"}],"description":"","message_list":[],"uuid":"df43a3c2-c89f-494d-bc32-220c9d9c5b6c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"971edab6-e743-4703-974f-4ca293ed4abf"},"name":"SYS_GEN__Runbook_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab"}},{"description":"System action for powering off an application","message_list":[],"uuid":"cea00d40-7982-45bd-b6a0-511d37a34b02","name":"action_poweroff","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"DAG","uuid":"0b9e5961-ed69-46e3-b6e7-c45a382dc32d","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Gcp_Operation_PowerOff_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"ecc3bcf8-6cec-4a82-b2f2-deff9f8e5a15"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"VMOPERATION_GCP_VM","uuid":"ecc3bcf8-6cec-4a82-b2f2-deff9f8e5a15","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Gcp_Operation_PowerOff_fd41b059_b412_4c19_ba36_ca417a5806ab"}],"description":"","message_list":[],"uuid":"1c203a4e-da24-4f1d-a059-709d069374ec","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"0b9e5961-ed69-46e3-b6e7-c45a382dc32d"},"name":"SYS_GEN__Runbook_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"1f93f0f4-4a7d-4f2c-928c-82b3a1c775f8","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"DAG","uuid":"e115325b-a227-4cde-8dc4-1ba5aad58b08","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Gcp_Delete_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"b772d789-608b-487b-8ea5-cbf6c0dad53a"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"DELETE_GCP_VM","uuid":"b772d789-608b-487b-8ea5-cbf6c0dad53a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Gcp_Delete_fd41b059_b412_4c19_ba36_ca417a5806ab"}],"description":"","message_list":[],"uuid":"2d42e962-1021-4baf-bed6-0a9174384d5d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"e115325b-a227-4cde-8dc4-1ba5aad58b08"},"name":"SYS_GEN__Runbook_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"f1f060af-0f91-4ae2-bc6b-4a90779c3e75","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"DAG","uuid":"73067e3c-55be-448f-b9de-2a808f5d6883","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Substrate_Element_Delete_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"cd631088-9c84-4d71-8b6b-22e6b5b17e95"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"cd631088-9c84-4d71-8b6b-22e6b5b17e95","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Substrate_Element_Delete_fd41b059_b412_4c19_ba36_ca417a5806ab"}],"description":"","message_list":[],"uuid":"c98634ce-1304-4350-a68d-676cd00041b7","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"73067e3c-55be-448f-b9de-2a808f5d6883"},"name":"SYS_GEN__Runbook_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab"}}],"message_list":[],"uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab","state":"ACTIVE","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{public_ip_address}@@","delay_secs":"0","connection_port":22},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"timeout_secs":true,"address":true,"delay_secs":true,"connection_port":true},"create_spec":{"resources":{"labels":true,"machineType":true,"name":true,"zone":true,"tags":{"items":true},"guestCustomization":{"startupScript":true},"disks":{"0":{"initializeParams":{"diskSizeGb":true,"sourceImage":true,"diskType":true},"autoDelete":true}},"blankDisks":{"1":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true},"0":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true},"2":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true}},"networkInterfaces":{"0":{"accessConfigs":{"0":{"config_type":true,"name":true}},"network":true,"subnetwork":true,"associatePublicIP":true}},"sshKeys":{"0":true},"serviceAccounts":{"0":{"scopes":true,"email":true}},"metadata":{"items":true}}}},"os_type":"Linux","type":"GCP_VM","create_spec":{"type":"PROVISION_GCP_VM","resources":{"labels":[],"machineType":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/machineTypes\/n1-highcpu-4","description":"","zone":"us-central1-c","tags":{"items":[],"type":"","fingerprint":""},"guestCustomization":{"type":"","sysprep":"","startupScript":""},"labelFingerprint":"","disks":[{"diskEncryptionKey":{"rawKey":"","type":""},"deviceName":"","initializeParams":{"sourceImageEncryptionKey":{"rawKey":"","type":""},"diskName":"","diskType":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","diskSizeGb":10,"sourceImage":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/global\/images\/centos-7","type":""},"autoDelete":true,"boot":true,"source":"","mode":"","interface":"","disk_type":"PERSISTENT","type":""}],"metadata":{"items":[],"type":"","fingerprint":""},"sshKeys":["centos:ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDMGAS\/K0Mb\/uwFXwD+hkjguy7VMZk2hpuhwPl9FUZwVBrURf\/i9QMJ5\/paPEZixu8VlRx7Inu4iun7rQfrnfeIYInmBwspXHYiTK3oHJAgZnrAHVEf1p6YaxLINlT1NI5yOAGPRWW6of8rBDBH1ObwU2+wcSx\/1H0uIs3aZNLufr+Rh628ACxAum2Gt8AVRj6ua2BPFyt5VTdclyysAmeh1AiixNgOZXOz6y\/i4TbzpY78I3isuKpxsUeXX6jxEMQol406jHDUF6njEOPIQG2zVZ3QJlTG9OlN+NiyZG9WkZz0VG\/6M8ixxIHHI2dNwUbBFv2HUu+8X9LTLFq2O7KjX9Hp7uZKBAySHA3eKaKHIp2bZuU1bT5PRPkggngX86xg+T+OMNnutbAiMnRJ8+FvD5So+5TIx4b9GgxAxure3x2yRPT9lOiQOB+CVpJPxR0Rn9bOI+wiPnD0kAGvK\/fHT+pqL4PM+hTnJtp9rrCRzIQApBx1263jEcYffhW2epZQRO+he5CMawFJ5TBe08om2AaDJ8GQdrpF6YA3W8DzHbmL3DPVVHdmqPLn10o+LX4gv5SdIIDVGdjKOc1BCnLTRmM28d5+sLDt\/M+kvcQgf0y0yDjMVjGECZkt39hbm4ELMHzZtzYLmHNhBZxRqHeJ7qFTuv1kx88OW3Xc5mbBNQ== centos@nutanix.com\n"],"minCpuPlatform":"","scheduling":{"automaticRestart":true,"type":"","preemptible":false,"onHostMaintenance":"TERMINATE"},"canIpForward":false,"blankDisks":[{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sm-disk1-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sm-disk2-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sm-disk3-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true}],"networkInterfaces":[{"aliasIpRanges":[],"network":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/global\/networks\/default","accessConfigs":[{"config_type":"ONE_TO_ONE_NAT","type":"","name":"k8sm-acm-@@{calm_array_index}@@-@@{calm_time}@@","natIP":""}],"networkIP":"","subnetwork":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/regions\/us-central1\/subnetworks\/default","type":"","associatePublicIP":true}],"type":"","account_uuid":"84213a31-4fe8-7e39-3799-e093e5d0dc2e","serviceAccounts":[{"scopes":["https:\/\/www.googleapis.com\/auth\/cloud-platform"],"type":"","email":"108048128720-compute@developer.gserviceaccount.com"}],"name":"k8sw-@@{calm_array_index}@@-@@{calm_time}@@"}},"variable_list":[],"name":"GCP_Centos_K8SW"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"ea423da0-94ed-4fc2-b52d-a64bec1f4a2a","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"DAG","uuid":"a097aa6d-d8da-43c9-8861-060fc93ae3c8","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Azure_Provision_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"ec1f7867-30fc-49d3-9720-ebd9247a567f"},{"kind":"app_task","name":"SYS_GEN__check_login_for_Azure_Centos_K8SM_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"5c5faa90-d5c7-4519-93d8-c056c306b3f3"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Azure_Provision_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"ec1f7867-30fc-49d3-9720-ebd9247a567f"},"edge_type":"inherent","type":"","uuid":"995d1bc2-2c46-49bc-96d9-3322bd3eee7a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_Azure_Centos_K8SM_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"5c5faa90-d5c7-4519-93d8-c056c306b3f3"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"PROVISION_AZURE_VM","uuid":"ec1f7867-30fc-49d3-9720-ebd9247a567f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"PROVISION_AZURE_VM","name":"","resources":{"vm_name":"K8SM-@@{calm_unique_hash}@@-@@{calm_array_index}@@","storage_profile":{"is_managed":true,"image_details":{"sku":"7.4","publisher":"OpenLogic","offer":"CentOS-HPC","source_image_id":"","use_custom_image":false,"version":"7.4.20180719","type":""},"type":"","os_disk_details":{"size_in_gb":127,"name":"os-@@{calm_unique_hash}@@-@@{calm_array_index}@@-disk","storage_name":"","storage_type":"Standard_LRS","lun":-1,"type":"","create_option":"FromImage","caching_type":"ReadWrite"},"data_disk_list":[]},"nw_profile":{"nic_list":[{"nsg_name":"sg-allow-all-eastus2","vnet_name":"calm-virtual-network-eastus2","private_ip_info":{"ip_address":"","ip_allocation_method":"Dynamic","type":""},"nic_name":"nic-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","subnet_name":"default","type":"","public_ip_info":{"ip_name":"public-ip-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","dns_label":"dns-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","ip_allocation_method":"Dynamic","type":""}}],"primary_nic":-1,"type":""},"resource_group":"calmrg","os_profile":{"secrets":[],"type":"","windows_config":{"winrm_listeners":[],"time_zone":"","additional_unattend_content":[],"provision_vm_agent":true,"auto_updates":false,"type":""},"linux_config":null},"hw_profile":{"max_data_disk_count":4,"vm_size":"Standard_D1_v2","type":""},"location":"eastus2","availability_set_id":"","tag_list":[],"type":"","account_uuid":"3c0f2d94-878c-f34c-6d39-90b854129782"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Azure_Provision_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"5c5faa90-d5c7-4519-93d8-c056c306b3f3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.publicIPAddressList[0]}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_Azure_Centos_K8SM_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"}],"description":"","message_list":[],"uuid":"9dfe0dad-5617-4b18-879c-59bb79f93df6","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"a097aa6d-d8da-43c9-8861-060fc93ae3c8"},"name":"SYS_GEN__Runbook_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"}},{"description":"System action for powering on an application","message_list":[],"uuid":"38d695d1-e89c-44d8-b16e-174601f2bceb","name":"action_poweron","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"DAG","uuid":"4b3d80a7-ccae-4c11-93e9-afdf54fd9306","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Azure_Operation_PowerOn_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"c6edc57d-ed8b-4cbf-98a4-7fe17ebcf788"},{"kind":"app_task","name":"SYS_GEN__check_login_for_Azure_Centos_K8SM_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"ed9f65c5-5c4a-494d-b4bc-2e4ff4547dd1"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Azure_Operation_PowerOn_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"c6edc57d-ed8b-4cbf-98a4-7fe17ebcf788"},"edge_type":"inherent","type":"","uuid":"2a3fcef5-4419-4d5f-bc8b-4f37dd3c410a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_Azure_Centos_K8SM_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"ed9f65c5-5c4a-494d-b4bc-2e4ff4547dd1"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"VMOPERATION_AZURE_VM","uuid":"c6edc57d-ed8b-4cbf-98a4-7fe17ebcf788","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Azure_Operation_PowerOn_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"ed9f65c5-5c4a-494d-b4bc-2e4ff4547dd1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.publicIPAddressList[0]}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_Azure_Centos_K8SM_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"}],"description":"","message_list":[],"uuid":"50d0c06c-b7e4-4917-aa29-23c4333eebb9","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"4b3d80a7-ccae-4c11-93e9-afdf54fd9306"},"name":"SYS_GEN__Runbook_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"}},{"description":"System action for restarting an application","message_list":[],"uuid":"4c73b160-b21b-46bf-9a36-f9375643908d","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"DAG","uuid":"4ac9689a-8658-4146-b821-e1156830aceb","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Azure_Operation_Restart2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"b2e69106-e125-4d48-8e8d-45fbc1c172a3"},{"kind":"app_task","name":"SYS_GEN__check_login_for_Azure_Centos_K8SM_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"02f26b23-4ccf-4fae-a9ce-b18669be9780"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Azure_Operation_Restart2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"b2e69106-e125-4d48-8e8d-45fbc1c172a3"},"edge_type":"inherent","type":"","uuid":"71476523-63c9-4506-87e1-af47d5073907","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_Azure_Centos_K8SM_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"02f26b23-4ccf-4fae-a9ce-b18669be9780"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"VMOPERATION_AZURE_VM","uuid":"b2e69106-e125-4d48-8e8d-45fbc1c172a3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Azure_Operation_Restart2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"02f26b23-4ccf-4fae-a9ce-b18669be9780","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.publicIPAddressList[0]}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_Azure_Centos_K8SM_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"}],"description":"","message_list":[],"uuid":"55b5618b-9830-4b42-a755-71eba1e1704f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"4ac9689a-8658-4146-b821-e1156830aceb"},"name":"SYS_GEN__Runbook_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"}},{"description":"System action for suspending an application","message_list":[],"uuid":"aa8da398-e812-40b6-be9e-327d379b610d","name":"action_suspend","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"DAG","uuid":"27f307b5-9edd-4287-a21e-38bcbed85beb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"}],"description":"","message_list":[],"uuid":"8f12dac2-ca7f-473c-b664-61849be52cc0","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"27f307b5-9edd-4287-a21e-38bcbed85beb"},"name":"SYS_GEN__Runbook_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"}},{"description":"System action for modifying an application","message_list":[],"uuid":"93ed4fcf-f91c-4bd1-9e61-093613362cb5","name":"action_modify","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"DAG","uuid":"89547444-5d20-40fa-b178-2a907245ba55","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"}],"description":"","message_list":[],"uuid":"5287b137-9a45-48c4-8e84-40b7fb7401bb","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"89547444-5d20-40fa-b178-2a907245ba55"},"name":"SYS_GEN__Runbook_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"}},{"description":"System action for powering off an application","message_list":[],"uuid":"c60e1fd5-45fb-4022-9e67-f47b6286ff9a","name":"action_poweroff","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"DAG","uuid":"fd17df29-5191-4221-823e-a7e3d6a39bd3","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Azure_Operation_Poweroff_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"c20f2133-92f0-4cc3-bdd2-52d7889d2be1"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"VMOPERATION_AZURE_VM","uuid":"c20f2133-92f0-4cc3-bdd2-52d7889d2be1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Azure_Operation_Poweroff_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"}],"description":"","message_list":[],"uuid":"66b1af5f-12b1-44a4-b10f-e8cfc94305fc","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"fd17df29-5191-4221-823e-a7e3d6a39bd3"},"name":"SYS_GEN__Runbook_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"daecd52f-55f4-4b22-be54-6f8a627a96de","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"DAG","uuid":"5bca698c-cfa6-4d7e-a217-13bdd1096bfd","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Azure_Delete_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"eadea8ed-201e-4b3c-ac53-7dfa15ae8867"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"DELETE_AZURE_VM","uuid":"eadea8ed-201e-4b3c-ac53-7dfa15ae8867","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Azure_Delete_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"}],"description":"","message_list":[],"uuid":"79b273ea-9ecd-424b-8427-bfc2c0918390","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"5bca698c-cfa6-4d7e-a217-13bdd1096bfd"},"name":"SYS_GEN__Runbook_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"3414fee1-04b1-494b-ac14-1115ffc65ac7","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"DAG","uuid":"aac0c1ba-2fa9-49db-a8b4-69c7a30f5a8b","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Substrate_Element_Delete_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"63074ea5-a332-477a-a5ca-35a5a5e1bcd1"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"63074ea5-a332-477a-a5ca-35a5a5e1bcd1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Substrate_Element_Delete_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"}],"description":"","message_list":[],"uuid":"3a4f6a9f-8773-4cf1-afac-ef6a966c17b5","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"aac0c1ba-2fa9-49db-a8b4-69c7a30f5a8b"},"name":"SYS_GEN__Runbook_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"}}],"message_list":[],"uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5","state":"ACTIVE","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{platform.publicIPAddressList[0]}@@","delay_secs":"0","connection_port":22},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"delay_secs":true,"connection_port":true,"timeout_secs":null},"create_spec":{"resources":{"vm_name":true,"storage_profile":{"is_managed":true,"image_details":{"sku":true,"publisher":true,"offer":true,"source_image_id":true,"use_custom_image":true,"version":true},"os_disk_details":{"storage_type":true,"name":true,"caching_type":true,"create_option":true}},"nw_profile":{"nic_list":{"0":{"nsg_name":true,"vnet_name":true,"private_ip_info":{"ip_allocation_method":true},"nic_name":true,"subnet_name":true,"public_ip_info":{"ip_allocation_method":true,"dns_label":true,"ip_name":true}}}},"resource_group":true,"os_profile":{"linux_config":{"custom_data":true}},"hw_profile":{"vm_size":true},"location":true,"availability_set_id":true,"tag_list":true}}},"os_type":"Linux","type":"AZURE_VM","create_spec":{"type":"PROVISION_AZURE_VM","name":"","resources":{"vm_name":"K8SM-@@{calm_unique_hash}@@-@@{calm_array_index}@@","storage_profile":{"is_managed":true,"image_details":{"sku":"7.4","publisher":"OpenLogic","offer":"CentOS-HPC","source_image_id":"","use_custom_image":false,"version":"7.4.20180719","type":""},"type":"","os_disk_details":{"size_in_gb":127,"name":"os-@@{calm_unique_hash}@@-@@{calm_array_index}@@-disk","storage_name":"","storage_type":"Standard_LRS","lun":-1,"type":"","create_option":"FromImage","caching_type":"ReadWrite"},"data_disk_list":[]},"nw_profile":{"nic_list":[{"nsg_name":"sg-allow-all-eastus2","vnet_name":"calm-virtual-network-eastus2","private_ip_info":{"ip_address":"","ip_allocation_method":"Dynamic","type":""},"nic_name":"nic-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","subnet_name":"default","type":"","public_ip_info":{"ip_name":"public-ip-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","dns_label":"dns-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","ip_allocation_method":"Dynamic","type":""}}],"primary_nic":-1,"type":""},"resource_group":"calmrg","os_profile":{"secrets":[],"type":"","windows_config":{"winrm_listeners":[],"time_zone":"","additional_unattend_content":[],"provision_vm_agent":true,"auto_updates":false,"type":""},"linux_config":null},"hw_profile":{"max_data_disk_count":4,"vm_size":"Standard_D1_v2","type":""},"location":"eastus2","availability_set_id":"","tag_list":[],"type":"","account_uuid":"3c0f2d94-878c-f34c-6d39-90b854129782"}},"variable_list":[],"name":"Azure_Centos_K8SM"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"86caa048-c06c-4a87-b6d2-b44dc681bc75","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"DAG","uuid":"a1361d25-4881-4352-a567-9f84d10d8085","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Azure_Provision_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"efe81717-1810-4a72-9386-bf8c5f625dba"},{"kind":"app_task","name":"SYS_GEN__check_login_for_Azure_Centos_K8SW_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"52e82bfd-d5d8-4b03-bc7d-a475b58bfda2"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Azure_Provision_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"efe81717-1810-4a72-9386-bf8c5f625dba"},"edge_type":"inherent","type":"","uuid":"cbcf23b7-1ed3-47de-8c4e-6eae08064d7f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_Azure_Centos_K8SW_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"52e82bfd-d5d8-4b03-bc7d-a475b58bfda2"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"PROVISION_AZURE_VM","uuid":"efe81717-1810-4a72-9386-bf8c5f625dba","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"PROVISION_AZURE_VM","name":"","resources":{"vm_name":"K8SW-@@{calm_unique_hash}@@-@@{calm_array_index}@@","storage_profile":{"is_managed":true,"image_details":{"sku":"7.4","publisher":"OpenLogic","offer":"CentOS-HPC","source_image_id":"","use_custom_image":false,"version":"7.4.20180719","type":""},"type":"","os_disk_details":{"size_in_gb":127,"name":"os-@@{calm_unique_hash}@@-@@{calm_array_index}@@-disk","storage_name":"","storage_type":"Standard_LRS","lun":-1,"type":"","create_option":"FromImage","caching_type":"ReadWrite"},"data_disk_list":[]},"nw_profile":{"nic_list":[{"nsg_name":"sg-allow-all-eastus2","vnet_name":"calm-virtual-network-eastus2","private_ip_info":{"ip_address":"","ip_allocation_method":"Dynamic","type":""},"nic_name":"nic-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","subnet_name":"default","type":"","public_ip_info":{"ip_name":"public-ip-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","dns_label":"dns-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","ip_allocation_method":"Dynamic","type":""}}],"primary_nic":-1,"type":""},"resource_group":"calmrg","os_profile":{"secrets":[],"type":"","windows_config":{"winrm_listeners":[],"time_zone":"","additional_unattend_content":[],"provision_vm_agent":true,"auto_updates":false,"type":""},"linux_config":null},"hw_profile":{"max_data_disk_count":4,"vm_size":"Standard_D1_v2","type":""},"location":"eastus2","availability_set_id":"","tag_list":[],"type":"","account_uuid":"3c0f2d94-878c-f34c-6d39-90b854129782"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Azure_Provision_03295a06_796d_4fa9_acec_3ad99de6e822"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"52e82bfd-d5d8-4b03-bc7d-a475b58bfda2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.publicIPAddressList[0]}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_Azure_Centos_K8SW_03295a06_796d_4fa9_acec_3ad99de6e822"}],"description":"","message_list":[],"uuid":"84ad3d71-f9a7-4d41-8c38-ef8a2f389785","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"a1361d25-4881-4352-a567-9f84d10d8085"},"name":"SYS_GEN__Runbook_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822"}},{"description":"System action for powering on an application","message_list":[],"uuid":"d867324a-0955-4c5a-9557-e66ff562078f","name":"action_poweron","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"DAG","uuid":"7617983f-e028-47b0-bdef-1bc3f694c06a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Azure_Operation_PowerOn_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"06709a83-9e9d-4bcd-b3d9-199b7d3156c5"},{"kind":"app_task","name":"SYS_GEN__check_login_for_Azure_Centos_K8SW_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"640d6417-148e-4555-93f9-a856b61e3be9"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Azure_Operation_PowerOn_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"06709a83-9e9d-4bcd-b3d9-199b7d3156c5"},"edge_type":"inherent","type":"","uuid":"e0eda145-8a33-49ea-943f-24980d544575","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_Azure_Centos_K8SW_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"640d6417-148e-4555-93f9-a856b61e3be9"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"VMOPERATION_AZURE_VM","uuid":"06709a83-9e9d-4bcd-b3d9-199b7d3156c5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Azure_Operation_PowerOn_03295a06_796d_4fa9_acec_3ad99de6e822"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"640d6417-148e-4555-93f9-a856b61e3be9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.publicIPAddressList[0]}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_Azure_Centos_K8SW_03295a06_796d_4fa9_acec_3ad99de6e822"}],"description":"","message_list":[],"uuid":"323f1f12-a907-4235-98e4-818ddb951f22","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"7617983f-e028-47b0-bdef-1bc3f694c06a"},"name":"SYS_GEN__Runbook_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822"}},{"description":"System action for restarting an application","message_list":[],"uuid":"9760636d-8c6c-4f25-b61c-063aab7aa1d8","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"DAG","uuid":"3781efd4-051a-4b77-9c25-f507e624098a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Azure_Operation_Restart03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"f0222883-2316-40b6-9069-69e32ad51ee4"},{"kind":"app_task","name":"SYS_GEN__check_login_for_Azure_Centos_K8SW_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"19b0e41c-579d-45dc-a332-8128071232ca"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Azure_Operation_Restart03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"f0222883-2316-40b6-9069-69e32ad51ee4"},"edge_type":"inherent","type":"","uuid":"0907726b-fc25-435f-980b-fd9bd1208c5a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_Azure_Centos_K8SW_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"19b0e41c-579d-45dc-a332-8128071232ca"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"VMOPERATION_AZURE_VM","uuid":"f0222883-2316-40b6-9069-69e32ad51ee4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Azure_Operation_Restart03295a06_796d_4fa9_acec_3ad99de6e822"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"19b0e41c-579d-45dc-a332-8128071232ca","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.publicIPAddressList[0]}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_Azure_Centos_K8SW_03295a06_796d_4fa9_acec_3ad99de6e822"}],"description":"","message_list":[],"uuid":"79da12b6-2fbc-4431-90b5-a050d06a68b8","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"3781efd4-051a-4b77-9c25-f507e624098a"},"name":"SYS_GEN__Runbook_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822"}},{"description":"System action for suspending an application","message_list":[],"uuid":"f9afa903-c47c-4df7-9e47-0cb320c96d50","name":"action_suspend","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"DAG","uuid":"229a635d-f8c2-444f-94a5-68664ff14ec3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822"}],"description":"","message_list":[],"uuid":"06444e64-b54c-43e6-9232-30453eaff35d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"229a635d-f8c2-444f-94a5-68664ff14ec3"},"name":"SYS_GEN__Runbook_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822"}},{"description":"System action for modifying an application","message_list":[],"uuid":"6c4c5fb3-65eb-4bd7-aa15-7def89b7b47c","name":"action_modify","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"DAG","uuid":"1366481b-7db3-4b37-bd24-78769b7a1110","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822"}],"description":"","message_list":[],"uuid":"ba1706fb-e87d-4648-aa18-500ca69a6cef","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"1366481b-7db3-4b37-bd24-78769b7a1110"},"name":"SYS_GEN__Runbook_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822"}},{"description":"System action for powering off an application","message_list":[],"uuid":"304667b1-d20b-40e4-a919-90ce326e106a","name":"action_poweroff","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"DAG","uuid":"0089c8f2-d185-4c3f-b158-e6f12faf9bd9","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Azure_Operation_Poweroff_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"17e2ea9f-6f13-427f-bffd-f5371327e0ce"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"VMOPERATION_AZURE_VM","uuid":"17e2ea9f-6f13-427f-bffd-f5371327e0ce","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Azure_Operation_Poweroff_03295a06_796d_4fa9_acec_3ad99de6e822"}],"description":"","message_list":[],"uuid":"9a212087-bafd-4e1c-b898-95ab56b4e6f2","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"0089c8f2-d185-4c3f-b158-e6f12faf9bd9"},"name":"SYS_GEN__Runbook_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"7ae28838-aef9-4ef7-afd0-f56b501c030d","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"DAG","uuid":"2ea375e8-31ca-45e6-99ee-9d2f0e97e6bc","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Azure_Delete_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"d52ac257-ee9e-4f9e-83b2-c61ecc2a5ae5"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"DELETE_AZURE_VM","uuid":"d52ac257-ee9e-4f9e-83b2-c61ecc2a5ae5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Azure_Delete_03295a06_796d_4fa9_acec_3ad99de6e822"}],"description":"","message_list":[],"uuid":"52c64980-14d7-4e3c-9f27-1dc3e6f4d968","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"2ea375e8-31ca-45e6-99ee-9d2f0e97e6bc"},"name":"SYS_GEN__Runbook_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"5ee9eb53-106c-4361-b13d-8ae9283cf2ff","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"DAG","uuid":"4cc6775b-6d8a-4cb3-8401-3ddf9b53d356","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Substrate_Element_Delete_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"cf4b62cb-a1c6-4dc1-b1bc-114f97b8adcc"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"cf4b62cb-a1c6-4dc1-b1bc-114f97b8adcc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Substrate_Element_Delete_03295a06_796d_4fa9_acec_3ad99de6e822"}],"description":"","message_list":[],"uuid":"94567f54-0a7c-457c-abeb-45e1fa9c58f5","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"4cc6775b-6d8a-4cb3-8401-3ddf9b53d356"},"name":"SYS_GEN__Runbook_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822"}}],"message_list":[],"uuid":"03295a06-796d-4fa9-acec-3ad99de6e822","state":"ACTIVE","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{platform.publicIPAddressList[0]}@@","delay_secs":"0","connection_port":22},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"delay_secs":true,"connection_port":true,"timeout_secs":null},"create_spec":{"resources":{"vm_name":true,"storage_profile":{"is_managed":true,"image_details":{"sku":true,"publisher":true,"offer":true,"source_image_id":true,"use_custom_image":true,"version":true},"os_disk_details":{"storage_type":true,"name":true,"caching_type":true,"create_option":true}},"nw_profile":{"nic_list":{"0":{"nsg_name":true,"vnet_name":true,"private_ip_info":{"ip_allocation_method":true},"nic_name":true,"subnet_name":true,"public_ip_info":{"ip_name":true,"dns_label":true,"ip_allocation_method":true}}}},"resource_group":true,"os_profile":{"linux_config":{"custom_data":true}},"hw_profile":{"vm_size":true},"location":true,"availability_set_id":true,"tag_list":true}}},"os_type":"Linux","type":"AZURE_VM","create_spec":{"type":"PROVISION_AZURE_VM","name":"","resources":{"vm_name":"K8SW-@@{calm_unique_hash}@@-@@{calm_array_index}@@","storage_profile":{"is_managed":true,"image_details":{"sku":"7.4","publisher":"OpenLogic","offer":"CentOS-HPC","source_image_id":"","use_custom_image":false,"version":"7.4.20180719","type":""},"type":"","os_disk_details":{"size_in_gb":127,"name":"os-@@{calm_unique_hash}@@-@@{calm_array_index}@@-disk","storage_name":"","storage_type":"Standard_LRS","lun":-1,"type":"","create_option":"FromImage","caching_type":"ReadWrite"},"data_disk_list":[]},"nw_profile":{"nic_list":[{"nsg_name":"sg-allow-all-eastus2","vnet_name":"calm-virtual-network-eastus2","private_ip_info":{"ip_address":"","ip_allocation_method":"Dynamic","type":""},"nic_name":"nic-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","subnet_name":"default","type":"","public_ip_info":{"ip_name":"public-ip-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","dns_label":"dns-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","ip_allocation_method":"Dynamic","type":""}}],"primary_nic":-1,"type":""},"resource_group":"calmrg","os_profile":{"secrets":[],"type":"","windows_config":{"winrm_listeners":[],"time_zone":"","additional_unattend_content":[],"provision_vm_agent":true,"auto_updates":false,"type":""},"linux_config":null},"hw_profile":{"max_data_disk_count":4,"vm_size":"Standard_D1_v2","type":""},"location":"eastus2","availability_set_id":"","tag_list":[],"type":"","account_uuid":"3c0f2d94-878c-f34c-6d39-90b854129782"}},"variable_list":[],"name":"Azure_Centos_K8SW"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"dd080d86-5ca3-473c-85a6-0c93629ec40d","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"DAG","uuid":"82e053c5-838d-43dd-a321-5ff079b4165d","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Vmware_Provision_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"6c73c4d9-f589-409b-95a7-86359c5a83f3"},{"kind":"app_task","name":"SYS_GEN__check_login_for_VMware_Centos_K8SM_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"c7e2e0ec-b6bc-4f9c-8393-c1ff752f9294"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Vmware_Provision_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"6c73c4d9-f589-409b-95a7-86359c5a83f3"},"edge_type":"inherent","type":"","uuid":"b7c8190c-e6f4-42d6-a564-e6beeb156581","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_VMware_Centos_K8SM_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"c7e2e0ec-b6bc-4f9c-8393-c1ff752f9294"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"PROVISION_VCENTER","uuid":"6c73c4d9-f589-409b-95a7-86359c5a83f3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"name":"K8SM-@@{calm_array_index}@@-@@{calm_time}@@","storage_pod":"TestQA","drs_mode":true,"cluster":"Sabine59-Cluster","host":"","clone_is_template":false,"template":"8fb1dd88-fcf1-444f-a5bb-d5482c87170f","datastore":"","type":"PROVISION_VMWARE_VM","resources":{"nic_list":[{"nic_type":"e1000","type":"","net_name":"key-vim.host.PortGroup-VM Network"}],"template_nic_list":[],"template_controller_list":[],"num_vcpus_per_socket":1,"num_sockets":2,"controller_list":[],"memory_size_mib":2048,"power_state":"poweron","guest_customization":{"type":"","cloud_init":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']","linux_data":null,"customization_name":"","customization_type":"GUEST_OS_LINUX","windows_data":null},"template_disk_list":[],"type":"","account_uuid":"7f90399d-ed3d-1c70-447d-17004ef1bd0a","disk_list":[{"disk_size_mb":10240,"disk_mode":"persistent","adapter_type":"SCSI","iso_path":"","location":"ds:\/\/\/vmfs\/volumes\/7b773e05-e06fc970\/","disk_type":"disk","type":""},{"disk_size_mb":10240,"disk_mode":"persistent","adapter_type":"SCSI","iso_path":"","location":"ds:\/\/\/vmfs\/volumes\/7b773e05-e06fc970\/","disk_type":"disk","type":""},{"disk_size_mb":10240,"disk_mode":"persistent","adapter_type":"SCSI","iso_path":"","location":"ds:\/\/\/vmfs\/volumes\/7b773e05-e06fc970\/","disk_type":"disk","type":""},{"disk_size_mb":10240,"disk_mode":"persistent","adapter_type":"SCSI","iso_path":"","location":"ds:\/\/\/vmfs\/volumes\/7b773e05-e06fc970\/","disk_type":"disk","type":""},{"disk_size_mb":10240,"disk_mode":"persistent","adapter_type":"SCSI","iso_path":"","location":"ds:\/\/\/vmfs\/volumes\/7b773e05-e06fc970\/","disk_type":"disk","type":""},{"disk_size_mb":10240,"disk_mode":"persistent","adapter_type":"SCSI","iso_path":"","location":"ds:\/\/\/vmfs\/volumes\/7b773e05-e06fc970\/","disk_type":"disk","type":""}]}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Vmware_Provision_eb19b05b_0c58_438e_aed0_2efba5c2019d"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"c7e2e0ec-b6bc-4f9c-8393-c1ff752f9294","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.ipAddressList[0]}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_VMware_Centos_K8SM_eb19b05b_0c58_438e_aed0_2efba5c2019d"}],"description":"","message_list":[],"uuid":"6be46218-ad79-4bbe-9ddf-2a954a5f2990","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"82e053c5-838d-43dd-a321-5ff079b4165d"},"name":"SYS_GEN__Runbook_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d"}},{"description":"System action for powering on an application","message_list":[],"uuid":"1106325a-1b2e-4458-803c-db28bb3f8d1d","name":"action_poweron","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"DAG","uuid":"19dd8575-f7ea-407e-8a1e-1635cf7608a1","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Vmware_Operation_PowerOn_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"d9231f35-a340-4345-aab5-a914658b87aa"},{"kind":"app_task","name":"SYS_GEN__check_login_for_VMware_Centos_K8SM_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"5b6d2b00-69bd-467a-b065-1ff0cd99a12f"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Vmware_Operation_PowerOn_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"d9231f35-a340-4345-aab5-a914658b87aa"},"edge_type":"inherent","type":"","uuid":"d47a75f5-795d-455c-b7b3-dc17d62c9837","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_VMware_Centos_K8SM_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"5b6d2b00-69bd-467a-b065-1ff0cd99a12f"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"VMOPERATION_VCENTER","uuid":"d9231f35-a340-4345-aab5-a914658b87aa","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Vmware_Operation_PowerOn_eb19b05b_0c58_438e_aed0_2efba5c2019d"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"5b6d2b00-69bd-467a-b065-1ff0cd99a12f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.ipAddressList[0]}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_VMware_Centos_K8SM_eb19b05b_0c58_438e_aed0_2efba5c2019d"}],"description":"","message_list":[],"uuid":"25f55a73-4233-48f8-98dd-fee0fe4e8d86","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"19dd8575-f7ea-407e-8a1e-1635cf7608a1"},"name":"SYS_GEN__Runbook_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d"}},{"description":"System action for restarting an application","message_list":[],"uuid":"920e8e63-295d-4282-993f-435bc7baf5e0","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"DAG","uuid":"940ffa24-f1ab-4929-91e8-6d1bd79cf5a2","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Vmware_Operation_Restarteb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"aea99484-8b11-4153-973f-abe664d79af4"},{"kind":"app_task","name":"SYS_GEN__check_login_for_VMware_Centos_K8SM_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"219c9798-d844-40ca-a58a-cacb388e76ae"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Vmware_Operation_Restarteb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"aea99484-8b11-4153-973f-abe664d79af4"},"edge_type":"inherent","type":"","uuid":"c7906fb2-310f-4569-95c3-b8de7edd91c8","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_VMware_Centos_K8SM_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"219c9798-d844-40ca-a58a-cacb388e76ae"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"VMOPERATION_VCENTER","uuid":"aea99484-8b11-4153-973f-abe664d79af4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Vmware_Operation_Restarteb19b05b_0c58_438e_aed0_2efba5c2019d"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"219c9798-d844-40ca-a58a-cacb388e76ae","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.ipAddressList[0]}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_VMware_Centos_K8SM_eb19b05b_0c58_438e_aed0_2efba5c2019d"}],"description":"","message_list":[],"uuid":"9f8d6201-6117-45d8-8f90-2e2ed20d04ff","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"940ffa24-f1ab-4929-91e8-6d1bd79cf5a2"},"name":"SYS_GEN__Runbook_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d"}},{"description":"System action for suspending an application","message_list":[],"uuid":"a377cc02-2c4f-43b8-a12e-450b2c238316","name":"action_suspend","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"DAG","uuid":"03897576-ce27-4fe9-be6c-bc2aa78a093a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d"}],"description":"","message_list":[],"uuid":"1356cdea-5cb6-476b-be03-d475f3295d87","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"03897576-ce27-4fe9-be6c-bc2aa78a093a"},"name":"SYS_GEN__Runbook_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d"}},{"description":"System action for modifying an application","message_list":[],"uuid":"466de019-396c-46f5-97b6-44deb2ecb807","name":"action_modify","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"DAG","uuid":"fc84b461-fe9f-4dd7-91ff-54ded11fac86","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d"}],"description":"","message_list":[],"uuid":"7a4c10e0-2ad2-491d-8be1-89605b60d5b6","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"fc84b461-fe9f-4dd7-91ff-54ded11fac86"},"name":"SYS_GEN__Runbook_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d"}},{"description":"System action for powering off an application","message_list":[],"uuid":"54592e11-293d-4fee-95ba-e16f41fdc33f","name":"action_poweroff","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"DAG","uuid":"d6f1515b-238b-46fa-91e6-708707c7ab73","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Vmware_Operation_Poweroff_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"412fa06a-5f96-447e-9b17-2d92e8d59e9f"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"VMOPERATION_VCENTER","uuid":"412fa06a-5f96-447e-9b17-2d92e8d59e9f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Vmware_Operation_Poweroff_eb19b05b_0c58_438e_aed0_2efba5c2019d"}],"description":"","message_list":[],"uuid":"07a3e2fe-6213-4f82-a186-0f81f54986b3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"d6f1515b-238b-46fa-91e6-708707c7ab73"},"name":"SYS_GEN__Runbook_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"32a27059-9eff-4961-94ca-5544d108c61b","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"DAG","uuid":"669a420f-51a4-443f-99ac-bfdbcac9aec2","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Vmware_Delete_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"b8b2cb65-9a30-40cf-bc14-745019676bf6"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"DELETE_VCENTER","uuid":"b8b2cb65-9a30-40cf-bc14-745019676bf6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Vmware_Delete_eb19b05b_0c58_438e_aed0_2efba5c2019d"}],"description":"","message_list":[],"uuid":"4e9fd739-21aa-425a-9f39-519a0c3fcd5c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"669a420f-51a4-443f-99ac-bfdbcac9aec2"},"name":"SYS_GEN__Runbook_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"a772e795-3cb5-4da0-8bfd-281c6f10a0c6","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"DAG","uuid":"7138ac10-71d6-4b0a-9740-a98cc3c7b862","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Substrate_Element_Delete_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"10cc84e5-3ddb-4e4a-b2a8-f118d36a5495"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"10cc84e5-3ddb-4e4a-b2a8-f118d36a5495","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Substrate_Element_Delete_eb19b05b_0c58_438e_aed0_2efba5c2019d"}],"description":"","message_list":[],"uuid":"4a67affe-ed94-4ed1-ab4d-cdab23eac0cc","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"7138ac10-71d6-4b0a-9740-a98cc3c7b862"},"name":"SYS_GEN__Runbook_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d"}}],"message_list":[],"uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d","state":"ACTIVE","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{platform.ipAddressList[0]}@@","delay_secs":"30","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS","uuid":"70ea3312-6ea8-4ace-9433-d77766f00ba2"}},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"delay_secs":true,"connection_port":true,"timeout_secs":null},"create_spec":{"name":true,"drs_mode":true,"cluster":true,"host":true,"datastore":true,"storage_pod":true,"resources":{"template_nic_list":{},"nic_list":{"0":{"nic_type":true,"net_name":true}},"template_controller_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"controller_list":{},"memory_size_mib":true,"guest_customization":{"customization_name":true,"cloud_init":true},"template_disk_list":{},"disk_list":true}}},"os_type":"Linux","type":"VMWARE_VM","create_spec":{"name":"K8SM-@@{calm_array_index}@@-@@{calm_time}@@","storage_pod":"TestQA","drs_mode":true,"cluster":"Sabine59-Cluster","host":"","clone_is_template":false,"template":"8fb1dd88-fcf1-444f-a5bb-d5482c87170f","datastore":"","type":"PROVISION_VMWARE_VM","resources":{"nic_list":[{"nic_type":"e1000","type":"","net_name":"key-vim.host.PortGroup-VM Network"}],"template_nic_list":[],"template_controller_list":[],"num_vcpus_per_socket":1,"num_sockets":2,"controller_list":[],"memory_size_mib":2048,"power_state":"poweron","guest_customization":{"type":"","cloud_init":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']","linux_data":null,"customization_name":"","customization_type":"GUEST_OS_LINUX","windows_data":null},"template_disk_list":[],"type":"","account_uuid":"7f90399d-ed3d-1c70-447d-17004ef1bd0a","disk_list":[{"disk_size_mb":10240,"disk_mode":"persistent","adapter_type":"SCSI","iso_path":"","location":"ds:\/\/\/vmfs\/volumes\/7b773e05-e06fc970\/","disk_type":"disk","type":""},{"disk_size_mb":10240,"disk_mode":"persistent","adapter_type":"SCSI","iso_path":"","location":"ds:\/\/\/vmfs\/volumes\/7b773e05-e06fc970\/","disk_type":"disk","type":""},{"disk_size_mb":10240,"disk_mode":"persistent","adapter_type":"SCSI","iso_path":"","location":"ds:\/\/\/vmfs\/volumes\/7b773e05-e06fc970\/","disk_type":"disk","type":""},{"disk_size_mb":10240,"disk_mode":"persistent","adapter_type":"SCSI","iso_path":"","location":"ds:\/\/\/vmfs\/volumes\/7b773e05-e06fc970\/","disk_type":"disk","type":""},{"disk_size_mb":10240,"disk_mode":"persistent","adapter_type":"SCSI","iso_path":"","location":"ds:\/\/\/vmfs\/volumes\/7b773e05-e06fc970\/","disk_type":"disk","type":""},{"disk_size_mb":10240,"disk_mode":"persistent","adapter_type":"SCSI","iso_path":"","location":"ds:\/\/\/vmfs\/volumes\/7b773e05-e06fc970\/","disk_type":"disk","type":""}]}},"variable_list":[],"name":"VMware_Centos_K8SM"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"49e7eb4a-4354-4a1a-b39e-2b8429536663","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"DAG","uuid":"2905c8e6-49ef-4a06-827f-62983f8cf635","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Vmware_Provision_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"f6896e90-6283-44f4-8cb4-78be01618dd1"},{"kind":"app_task","name":"SYS_GEN__check_login_for_VMware_Centos_K8SW_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"0bfe94fc-63f6-41de-906e-1f7a787e9cdb"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Vmware_Provision_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"f6896e90-6283-44f4-8cb4-78be01618dd1"},"edge_type":"inherent","type":"","uuid":"34d5423d-ab3f-49bf-9b67-c1454a4136cb","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_VMware_Centos_K8SW_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"0bfe94fc-63f6-41de-906e-1f7a787e9cdb"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"PROVISION_VCENTER","uuid":"f6896e90-6283-44f4-8cb4-78be01618dd1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"name":"K8SW-@@{calm_array_index}@@-@@{calm_time}@@","storage_pod":"TestQA","drs_mode":true,"cluster":"Sabine59-Cluster","host":"","clone_is_template":false,"template":"8fb1dd88-fcf1-444f-a5bb-d5482c87170f","datastore":"","type":"PROVISION_VMWARE_VM","resources":{"nic_list":[{"nic_type":"e1000","type":"","net_name":"key-vim.host.PortGroup-VM Network"}],"template_nic_list":[],"template_controller_list":[],"num_vcpus_per_socket":1,"num_sockets":4,"controller_list":[],"memory_size_mib":4096,"power_state":"poweron","guest_customization":{"type":"","cloud_init":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']","linux_data":null,"customization_name":"","customization_type":"GUEST_OS_LINUX","windows_data":null},"template_disk_list":[],"type":"","account_uuid":"7f90399d-ed3d-1c70-447d-17004ef1bd0a","disk_list":[{"disk_size_mb":10240,"disk_mode":"persistent","adapter_type":"SCSI","iso_path":"","location":"ds:\/\/\/vmfs\/volumes\/7b773e05-e06fc970\/","disk_type":"disk","type":""},{"disk_size_mb":10240,"disk_mode":"persistent","adapter_type":"SCSI","iso_path":"","location":"ds:\/\/\/vmfs\/volumes\/7b773e05-e06fc970\/","disk_type":"disk","type":""},{"disk_size_mb":10240,"disk_mode":"persistent","adapter_type":"SCSI","iso_path":"","location":"ds:\/\/\/vmfs\/volumes\/7b773e05-e06fc970\/","disk_type":"disk","type":""}]}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Vmware_Provision_4c3514f2_78b2_46b7_ba50_05f323515a8e"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"0bfe94fc-63f6-41de-906e-1f7a787e9cdb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.ipAddressList[0]}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_VMware_Centos_K8SW_4c3514f2_78b2_46b7_ba50_05f323515a8e"}],"description":"","message_list":[],"uuid":"fcfe334d-52df-48ef-9b1a-f130e700697f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"2905c8e6-49ef-4a06-827f-62983f8cf635"},"name":"SYS_GEN__Runbook_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e"}},{"description":"System action for powering on an application","message_list":[],"uuid":"a19e6d6e-8c35-4d0a-8332-c13ebdeeb890","name":"action_poweron","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"DAG","uuid":"cc5474fe-af51-4ee0-a883-613e7cad3c95","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Vmware_Operation_PowerOn_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"f8086804-8dc1-444c-9b71-ddf7483d4ffe"},{"kind":"app_task","name":"SYS_GEN__check_login_for_VMware_Centos_K8SW_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"88e85ca4-c20d-409a-9ac0-10cd600c273d"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Vmware_Operation_PowerOn_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"f8086804-8dc1-444c-9b71-ddf7483d4ffe"},"edge_type":"inherent","type":"","uuid":"29af90d9-7e6b-46f7-abd9-c8686ca6633b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_VMware_Centos_K8SW_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"88e85ca4-c20d-409a-9ac0-10cd600c273d"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"VMOPERATION_VCENTER","uuid":"f8086804-8dc1-444c-9b71-ddf7483d4ffe","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Vmware_Operation_PowerOn_4c3514f2_78b2_46b7_ba50_05f323515a8e"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"88e85ca4-c20d-409a-9ac0-10cd600c273d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.ipAddressList[0]}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_VMware_Centos_K8SW_4c3514f2_78b2_46b7_ba50_05f323515a8e"}],"description":"","message_list":[],"uuid":"67a13373-5646-4286-aa8a-0d588dea4db1","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"cc5474fe-af51-4ee0-a883-613e7cad3c95"},"name":"SYS_GEN__Runbook_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e"}},{"description":"System action for restarting an application","message_list":[],"uuid":"5a18da13-5367-43c7-9b2b-45559e135c61","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"DAG","uuid":"46ca1373-691a-4b3f-ba17-8a461fdb3c41","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Vmware_Operation_Restart4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"96e6cf75-6934-4be5-9bfa-397ab8dd6dcf"},{"kind":"app_task","name":"SYS_GEN__check_login_for_VMware_Centos_K8SW_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"4a0dc273-8eb5-406b-8237-bae3a08f670d"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Vmware_Operation_Restart4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"96e6cf75-6934-4be5-9bfa-397ab8dd6dcf"},"edge_type":"inherent","type":"","uuid":"b3891496-c182-4120-859a-d7a39ff1dd2c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_VMware_Centos_K8SW_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"4a0dc273-8eb5-406b-8237-bae3a08f670d"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"VMOPERATION_VCENTER","uuid":"96e6cf75-6934-4be5-9bfa-397ab8dd6dcf","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Vmware_Operation_Restart4c3514f2_78b2_46b7_ba50_05f323515a8e"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"4a0dc273-8eb5-406b-8237-bae3a08f670d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.ipAddressList[0]}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_VMware_Centos_K8SW_4c3514f2_78b2_46b7_ba50_05f323515a8e"}],"description":"","message_list":[],"uuid":"15b93666-3488-4333-bf74-fc334f09cab5","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"46ca1373-691a-4b3f-ba17-8a461fdb3c41"},"name":"SYS_GEN__Runbook_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e"}},{"description":"System action for suspending an application","message_list":[],"uuid":"90cde4bd-4ff3-480c-9ce7-9994d92e2d74","name":"action_suspend","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"DAG","uuid":"1458d8ac-3360-4f90-b3c1-2526216e22c1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e"}],"description":"","message_list":[],"uuid":"bbc97960-24ad-4daf-9bc6-a8784897aa4b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"1458d8ac-3360-4f90-b3c1-2526216e22c1"},"name":"SYS_GEN__Runbook_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e"}},{"description":"System action for modifying an application","message_list":[],"uuid":"f9731232-2f2b-4090-ae7a-756dc385cb12","name":"action_modify","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"DAG","uuid":"7f5e267c-066d-4660-92fc-ef6c0e431d78","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e"}],"description":"","message_list":[],"uuid":"19ac6597-3c9a-4be9-80f7-79998c496276","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"7f5e267c-066d-4660-92fc-ef6c0e431d78"},"name":"SYS_GEN__Runbook_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e"}},{"description":"System action for powering off an application","message_list":[],"uuid":"c5f3c43c-0a48-4967-9065-38cf32654a2a","name":"action_poweroff","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"DAG","uuid":"16c3a364-146f-4f4e-8667-26621239bdb1","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Vmware_Operation_Poweroff_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"c71460c7-ee6d-42b3-89a3-ad7f9b840eb2"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"VMOPERATION_VCENTER","uuid":"c71460c7-ee6d-42b3-89a3-ad7f9b840eb2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Vmware_Operation_Poweroff_4c3514f2_78b2_46b7_ba50_05f323515a8e"}],"description":"","message_list":[],"uuid":"644f71ed-0955-47b3-9f2b-9b722a177a08","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"16c3a364-146f-4f4e-8667-26621239bdb1"},"name":"SYS_GEN__Runbook_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"2ba10767-4d3a-4856-8423-70f57ebd659b","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"DAG","uuid":"f31322c8-b3bf-46ac-9aa1-335e6ed21e4c","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Vmware_Delete_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"7b01075a-1248-4b8f-9679-d5607591f5c3"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"DELETE_VCENTER","uuid":"7b01075a-1248-4b8f-9679-d5607591f5c3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Vmware_Delete_4c3514f2_78b2_46b7_ba50_05f323515a8e"}],"description":"","message_list":[],"uuid":"83c91941-5cb1-42d9-a60b-424569feeebb","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"f31322c8-b3bf-46ac-9aa1-335e6ed21e4c"},"name":"SYS_GEN__Runbook_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"20c29423-382e-4a47-ba3c-36011b5a17d8","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"DAG","uuid":"8bbe46fd-86c7-44bb-b529-24090784c8ad","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Substrate_Element_Delete_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"9413eab1-67fd-40d5-b720-dac2e1b93c2c"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"9413eab1-67fd-40d5-b720-dac2e1b93c2c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Substrate_Element_Delete_4c3514f2_78b2_46b7_ba50_05f323515a8e"}],"description":"","message_list":[],"uuid":"82dd31a7-9d9a-49c3-a1a8-8dfa67efb61b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"8bbe46fd-86c7-44bb-b529-24090784c8ad"},"name":"SYS_GEN__Runbook_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e"}}],"message_list":[],"uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e","state":"ACTIVE","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{platform.ipAddressList[0]}@@","delay_secs":"30","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS","uuid":"70ea3312-6ea8-4ace-9433-d77766f00ba2"}},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"delay_secs":true,"connection_port":true,"timeout_secs":null},"create_spec":{"name":true,"drs_mode":true,"cluster":true,"host":true,"datastore":true,"storage_pod":true,"resources":{"template_nic_list":{},"nic_list":{"0":{"nic_type":true,"net_name":true}},"template_controller_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"controller_list":{},"memory_size_mib":true,"guest_customization":{"customization_name":true,"cloud_init":true},"template_disk_list":{},"disk_list":true}}},"os_type":"Linux","type":"VMWARE_VM","create_spec":{"name":"K8SW-@@{calm_array_index}@@-@@{calm_time}@@","storage_pod":"TestQA","drs_mode":true,"cluster":"Sabine59-Cluster","host":"","clone_is_template":false,"template":"8fb1dd88-fcf1-444f-a5bb-d5482c87170f","datastore":"","type":"PROVISION_VMWARE_VM","resources":{"nic_list":[{"nic_type":"e1000","type":"","net_name":"key-vim.host.PortGroup-VM Network"}],"template_nic_list":[],"template_controller_list":[],"num_vcpus_per_socket":1,"num_sockets":4,"controller_list":[],"memory_size_mib":4096,"power_state":"poweron","guest_customization":{"type":"","cloud_init":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']","linux_data":null,"customization_name":"","customization_type":"GUEST_OS_LINUX","windows_data":null},"template_disk_list":[],"type":"","account_uuid":"7f90399d-ed3d-1c70-447d-17004ef1bd0a","disk_list":[{"disk_size_mb":10240,"disk_mode":"persistent","adapter_type":"SCSI","iso_path":"","location":"ds:\/\/\/vmfs\/volumes\/7b773e05-e06fc970\/","disk_type":"disk","type":""},{"disk_size_mb":10240,"disk_mode":"persistent","adapter_type":"SCSI","iso_path":"","location":"ds:\/\/\/vmfs\/volumes\/7b773e05-e06fc970\/","disk_type":"disk","type":""},{"disk_size_mb":10240,"disk_mode":"persistent","adapter_type":"SCSI","iso_path":"","location":"ds:\/\/\/vmfs\/volumes\/7b773e05-e06fc970\/","disk_type":"disk","type":""}]}},"variable_list":[],"name":"VMware_Centos_K8SW"}],"credential_definition_list":[{"username":"centos","description":"","state":"ACTIVE","message_list":[],"uuid":"70ea3312-6ea8-4ace-9433-d77766f00ba2","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"editables":{"username":true,"secret":true},"type":"KEY","name":"CENTOS"}],"type":"USER","app_profile_list":[{"deployment_create_list":[{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"242695c0-8218-4d21-9044-9bd5aeb0da18","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"retries":"0","description":"","type":"DAG","uuid":"485070db-54ef-4fcf-ab00-9b090a375edf","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_56a7c02a_9a6e_46e2_8d39_c786833649db","uuid":"36077f40-e245-4f2f-8028-989d8e978abe"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277","uuid":"02ad4be3-9290-4e0b-95a5-24346ecddb57"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"a8b2bd8b-979b-4050-9bfe-700aa27c5865"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"2683e253-a9c4-4dcc-ae79-eceb11d7f6ff"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"018fa577-73ff-4cec-aaa1-5b084bd0ac79"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"d980fef8-5228-4056-98e0-9746fdfab5f0"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"018fa577-73ff-4cec-aaa1-5b084bd0ac79"},"edge_type":"inherent","type":"","uuid":"f4025af8-5a86-49fe-8f51-2518635ab597","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"d980fef8-5228-4056-98e0-9746fdfab5f0"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"2683e253-a9c4-4dcc-ae79-eceb11d7f6ff"},"edge_type":"inherent","type":"","uuid":"9c427f15-1c39-4aa2-a4d3-2b3c50c4e21b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"018fa577-73ff-4cec-aaa1-5b084bd0ac79"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_56a7c02a_9a6e_46e2_8d39_c786833649db","uuid":"36077f40-e245-4f2f-8028-989d8e978abe"},"edge_type":"inherent","type":"","uuid":"e9311544-4c8c-4734-bef9-81065f84b32d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277","uuid":"02ad4be3-9290-4e0b-95a5-24346ecddb57"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"a8b2bd8b-979b-4050-9bfe-700aa27c5865"},"edge_type":"inherent","type":"","uuid":"f3d704e2-7802-4fdf-84d2-803e22f0c393","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"2683e253-a9c4-4dcc-ae79-eceb11d7f6ff"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_56a7c02a_9a6e_46e2_8d39_c786833649db","uuid":"36077f40-e245-4f2f-8028-989d8e978abe"},"edge_type":"inherent","type":"","uuid":"76678171-1165-44f3-8330-1befdd7ecff2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"a8b2bd8b-979b-4050-9bfe-700aa27c5865"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277","uuid":"02ad4be3-9290-4e0b-95a5-24346ecddb57"},"edge_type":"inherent","type":"","uuid":"ebe5b239-f012-44a5-bab6-e24ed3589ac1","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"a8b2bd8b-979b-4050-9bfe-700aa27c5865"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_56a7c02a_9a6e_46e2_8d39_c786833649db"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"36077f40-e245-4f2f-8028-989d8e978abe","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_56a7c02a_9a6e_46e2_8d39_c786833649db"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_CENTOS_76","uuid":"691d60b5-9272-4cb0-a4b4-4e8dc6f75277"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"02ad4be3-9290-4e0b-95a5-24346ecddb57","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277","uuid":"9b6af2e4-9bb9-4d7d-9d74-2c7c244373a1"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a8b2bd8b-979b-4050-9bfe-700aa27c5865","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"1a1082b4-4898-4c81-bf4e-1ac2d172c842"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2683e253-a9c4-4dcc-ae79-eceb11d7f6ff","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"61b24c4f-ac1b-4182-a03a-b65e157a71bf"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_22e18386_fa75_402e_9fd9_aa32056cb746"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"018fa577-73ff-4cec-aaa1-5b084bd0ac79","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"384cf3d8-e940-43f1-a289-6c6b363c5371"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d980fef8-5228-4056-98e0-9746fdfab5f0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"02d4081c-83bd-4925-9539-9cc51d80cba3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_56a7c02a_9a6e_46e2_8d39_c786833649db","uuid":"485070db-54ef-4fcf-ab00-9b090a375edf"},"name":"SYS_GEN__Runbook_Deployment_56a7c02a_9a6e_46e2_8d39_c786833649db"}},{"description":"System action for starting an application","message_list":[],"uuid":"0d0eed7d-b7d6-4f2a-b486-40d863e7e78a","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"retries":"0","description":"","type":"DAG","uuid":"6428755f-5538-498f-868d-fcc1857d05ca","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"ebd5f450-901a-45e3-bc12-c1442343b9a4"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"4800f2b8-d3c0-46f0-a55f-4b47950364e6"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"ebd5f450-901a-45e3-bc12-c1442343b9a4"},"edge_type":"inherent","type":"","uuid":"bf9136c6-b423-4f31-9a78-f0287d28510c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"4800f2b8-d3c0-46f0-a55f-4b47950364e6"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_56a7c02a_9a6e_46e2_8d39_c786833649db"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ebd5f450-901a-45e3-bc12-c1442343b9a4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"944a7abe-6689-4697-aa2d-de5aa22bc3e2"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4800f2b8-d3c0-46f0-a55f-4b47950364e6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"e350e261-654e-4959-b2ee-ecc9c467ac20","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_56a7c02a_9a6e_46e2_8d39_c786833649db","uuid":"6428755f-5538-498f-868d-fcc1857d05ca"},"name":"SYS_GEN__Runbook_Deployment_56a7c02a_9a6e_46e2_8d39_c786833649db"}},{"description":"System action for restarting an application","message_list":[],"uuid":"2fd38739-de2f-42e6-a0d7-5d79d3ea4cd6","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"retries":"0","description":"","type":"DAG","uuid":"aeedc295-3e3f-454b-a75f-d578d87d0a5e","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"01aab8a6-4f91-4591-a267-fe92bc9b7cbb"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"eff397e2-1b64-47d1-aee5-249d79fbb24e"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"01aab8a6-4f91-4591-a267-fe92bc9b7cbb"},"edge_type":"inherent","type":"","uuid":"d35a6c60-6f49-413b-ab9d-47eddef80f68","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"eff397e2-1b64-47d1-aee5-249d79fbb24e"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_56a7c02a_9a6e_46e2_8d39_c786833649db"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"01aab8a6-4f91-4591-a267-fe92bc9b7cbb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"eebd290b-2b08-452c-bd08-8e435eb12798"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"eff397e2-1b64-47d1-aee5-249d79fbb24e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"ca8cec47-f6e6-4ffb-83f1-eb67ddbb98e2"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"fc798b55-e640-47bd-a31f-4c2cdd2b97a9","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_56a7c02a_9a6e_46e2_8d39_c786833649db","uuid":"aeedc295-3e3f-454b-a75f-d578d87d0a5e"},"name":"SYS_GEN__Runbook_Deployment_56a7c02a_9a6e_46e2_8d39_c786833649db"}},{"description":"System action for stopping an application","message_list":[],"uuid":"ec73909e-c66b-4d2b-9e41-4ddfac0696fa","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"retries":"0","description":"","type":"DAG","uuid":"ff510ed3-fab2-4b21-aeef-14fd4af67e3f","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"fbc3d770-a511-4203-a749-4ee645a84ebf"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"7e1bf6cd-aa0c-48ef-9c95-ba624fa86113"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"fbc3d770-a511-4203-a749-4ee645a84ebf"},"edge_type":"inherent","type":"","uuid":"94196599-0022-4b55-b034-c0ffb7e254e6","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"7e1bf6cd-aa0c-48ef-9c95-ba624fa86113"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_56a7c02a_9a6e_46e2_8d39_c786833649db"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"fbc3d770-a511-4203-a749-4ee645a84ebf","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"7e1bf6cd-aa0c-48ef-9c95-ba624fa86113","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"8a14fa13-5c99-4c8c-8d19-8ca3ff08d37e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074"}],"description":"","message_list":[],"uuid":"88f15621-fcda-4459-9c60-b79fc70a43d7","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_56a7c02a_9a6e_46e2_8d39_c786833649db","uuid":"ff510ed3-fab2-4b21-aeef-14fd4af67e3f"},"name":"SYS_GEN__Runbook_Deployment_56a7c02a_9a6e_46e2_8d39_c786833649db"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"db3395fc-c590-47f4-acfb-01e85ab98ded","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"retries":"0","description":"","type":"DAG","uuid":"f194b294-b76c-44d6-bf27-0ac2411435cf","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"5477af8b-afbc-4b0c-bdd6-cdbe3b814d79"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"bfcf3da0-e1f4-48d2-92e0-ac5803f3cb09"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"2b04a68f-7cda-4249-9de9-13b32f8f8f94"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"3edbfd2c-309b-48e0-abf6-ca6fe8575803"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_56a7c02a_9a6e_46e2_8d39_c786833649db","uuid":"2f2b7bde-e27b-4fc7-9068-8847e35722e7"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"5477af8b-afbc-4b0c-bdd6-cdbe3b814d79"},"edge_type":"inherent","type":"","uuid":"fd67e08d-40a4-4d6c-82c1-99e8c0924902","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"bfcf3da0-e1f4-48d2-92e0-ac5803f3cb09"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"bfcf3da0-e1f4-48d2-92e0-ac5803f3cb09"},"edge_type":"inherent","type":"","uuid":"8347fbd3-ffe2-43da-8003-d39e441c2de7","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"2b04a68f-7cda-4249-9de9-13b32f8f8f94"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"2b04a68f-7cda-4249-9de9-13b32f8f8f94"},"edge_type":"inherent","type":"","uuid":"a8a2ab4a-d870-46e7-a5aa-ef847b7de0f0","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"3edbfd2c-309b-48e0-abf6-ca6fe8575803"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"3edbfd2c-309b-48e0-abf6-ca6fe8575803"},"edge_type":"inherent","type":"","uuid":"288f1a68-d9cd-4c52-b2f6-7d2954a3cbda","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_56a7c02a_9a6e_46e2_8d39_c786833649db","uuid":"2f2b7bde-e27b-4fc7-9068-8847e35722e7"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_56a7c02a_9a6e_46e2_8d39_c786833649db"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5477af8b-afbc-4b0c-bdd6-cdbe3b814d79","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"bfcf3da0-e1f4-48d2-92e0-ac5803f3cb09","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"7f713d48-74e9-4bb6-8dc9-eb8f00371ff3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2b04a68f-7cda-4249-9de9-13b32f8f8f94","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"65e26ed0-c793-48d7-ad16-695573871526"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_22e18386_fa75_402e_9fd9_aa32056cb746"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3edbfd2c-309b-48e0-abf6-ca6fe8575803","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"36ea5e7a-39dd-4b51-a707-415c5e19caca"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"2f2b7bde-e27b-4fc7-9068-8847e35722e7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_56a7c02a_9a6e_46e2_8d39_c786833649db"}],"description":"","message_list":[],"uuid":"de07e240-ce02-4e68-a00b-c4b6beb10b22","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_56a7c02a_9a6e_46e2_8d39_c786833649db","uuid":"f194b294-b76c-44d6-bf27-0ac2411435cf"},"name":"SYS_GEN__Runbook_Deployment_56a7c02a_9a6e_46e2_8d39_c786833649db"}},{"description":"System action for scaleout","message_list":[],"uuid":"514e0a4c-8f8c-48b7-9560-692ab24dfe0a","name":"action_scaleout","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"retries":"0","description":"","type":"DAG","uuid":"e4fe9092-a96b-424e-bb56-9227143bac65","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scaleout_56a7c02a_9a6e_46e2_8d39_c786833649db","uuid":"ba60bca5-7d81-419d-9b65-2fe666019c07"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_56a7c02a_9a6e_46e2_8d39_c786833649db"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"retries":"0","description":"","type":"SCALING","uuid":"ba60bca5-7d81-419d-9b65-2fe666019c07","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scaleout_56a7c02a_9a6e_46e2_8d39_c786833649db"}],"description":"","message_list":[],"uuid":"5a8ba4b7-6b56-4456-9832-da15dba2dcc5","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"14b10676-729c-4346-a36e-0900f2842a3b","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_56a7c02a_9a6e_46e2_8d39_c786833649db","uuid":"e4fe9092-a96b-424e-bb56-9227143bac65"},"name":"SYS_GEN__Runbook_Deployment_56a7c02a_9a6e_46e2_8d39_c786833649db"}},{"description":"System action for scalein","message_list":[],"uuid":"34a152a4-60b2-44eb-aa31-052edd382368","name":"action_scalein","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"retries":"0","description":"","type":"DAG","uuid":"567adc6a-4ed0-4a3a-8d74-0636be63d2f1","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scalein_56a7c02a_9a6e_46e2_8d39_c786833649db","uuid":"b8ed961b-0fa5-4dd0-bb99-9336c5c43150"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_56a7c02a_9a6e_46e2_8d39_c786833649db"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"retries":"0","description":"","type":"SCALING","uuid":"b8ed961b-0fa5-4dd0-bb99-9336c5c43150","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scalein_56a7c02a_9a6e_46e2_8d39_c786833649db"}],"description":"","message_list":[],"uuid":"52c9090f-bac5-486b-b3b0-663ace7f8d9c","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"61dabd10-bbd8-4760-849c-c6ec6bc36741","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_56a7c02a_9a6e_46e2_8d39_c786833649db","uuid":"567adc6a-4ed0-4a3a-8d74-0636be63d2f1"},"name":"SYS_GEN__Runbook_Deployment_56a7c02a_9a6e_46e2_8d39_c786833649db"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"dc611c8a-aaf6-46ee-9c14-2060afa3794f","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"retries":"0","description":"","type":"DAG","uuid":"82b1d318-3eca-4249-be2d-f4c29888cbfb","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"fb3f5c82-b86c-4867-9c92-19bd8446b162"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"0a3500a2-3994-4890-adb4-97495531ef9e"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"1b06c834-8332-482e-b98d-01adce67708e"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_56a7c02a_9a6e_46e2_8d39_c786833649db","uuid":"3daadff9-3b4b-4a3d-a294-2a715ea35bb1"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"fb3f5c82-b86c-4867-9c92-19bd8446b162"},"edge_type":"inherent","type":"","uuid":"e3269110-4aeb-41bd-aec1-37b2721490ef","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"0a3500a2-3994-4890-adb4-97495531ef9e"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"0a3500a2-3994-4890-adb4-97495531ef9e"},"edge_type":"inherent","type":"","uuid":"192fee06-40ca-47db-a245-0fe94ff06a48","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"1b06c834-8332-482e-b98d-01adce67708e"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"1b06c834-8332-482e-b98d-01adce67708e"},"edge_type":"inherent","type":"","uuid":"09c7f646-df61-4f87-bb3d-743b79b4ed71","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_56a7c02a_9a6e_46e2_8d39_c786833649db","uuid":"3daadff9-3b4b-4a3d-a294-2a715ea35bb1"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_56a7c02a_9a6e_46e2_8d39_c786833649db"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"fb3f5c82-b86c-4867-9c92-19bd8446b162","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"2064d305-852a-47aa-89b9-7415f90c2152"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"0a3500a2-3994-4890-adb4-97495531ef9e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_22e18386_fa75_402e_9fd9_aa32056cb746"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1b06c834-8332-482e-b98d-01adce67708e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"154c4dd5-93a8-43c1-a093-f68ec6eaad90"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"3daadff9-3b4b-4a3d-a294-2a715ea35bb1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_56a7c02a_9a6e_46e2_8d39_c786833649db"}],"description":"","message_list":[],"uuid":"1071f273-86c1-47eb-aacf-b7ad8ccb9f35","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_56a7c02a_9a6e_46e2_8d39_c786833649db","uuid":"82b1d318-3eca-4249-be2d-f4c29888cbfb"},"name":"SYS_GEN__Runbook_Deployment_56a7c02a_9a6e_46e2_8d39_c786833649db"}}],"message_list":[],"published_service_local_reference_list":[],"uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db","min_replicas":"3","state":"ACTIVE","max_replicas":"3","depends_on_list":[],"editables":{"min_replicas":true,"max_replicas":true},"package_local_reference_list":[{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"}],"substrate_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"type":"GREENFIELD","options":{},"variable_list":[],"name":"2cbb2f6a_deployment"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"882cf847-bc37-46d2-9535-aad6a631be84","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"retries":"0","description":"","type":"DAG","uuid":"9fb72180-0b33-48a2-9c35-efd2a586e070","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_7306a3c9_9a76_45c2_90c9_27729ab58b5f","uuid":"9de6c1e6-4dea-4202-bcd5-ae1667fa430b"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277","uuid":"c81bf8c8-efc6-47e6-9d90-19987a1f1b15"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"f5c0ba5b-8ff0-473f-adb2-5810f4b66b37"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"0bd35eae-156a-4e0f-9b5f-ef67d2779fdf"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"5186d703-b6de-4806-b6a1-554ad928ec89"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"55dbbc43-60ba-4a3a-9d42-1aaf43e4fb77"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"5186d703-b6de-4806-b6a1-554ad928ec89"},"edge_type":"inherent","type":"","uuid":"2214bbae-6499-4bc2-9717-02ecb9cf7b01","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"55dbbc43-60ba-4a3a-9d42-1aaf43e4fb77"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"0bd35eae-156a-4e0f-9b5f-ef67d2779fdf"},"edge_type":"inherent","type":"","uuid":"330c83ea-f8bb-4ab6-aaef-c4edafcb5032","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"5186d703-b6de-4806-b6a1-554ad928ec89"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277","uuid":"c81bf8c8-efc6-47e6-9d90-19987a1f1b15"},"edge_type":"inherent","type":"","uuid":"26057365-e431-4c73-8ae9-b347fc89e418","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"f5c0ba5b-8ff0-473f-adb2-5810f4b66b37"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"f5c0ba5b-8ff0-473f-adb2-5810f4b66b37"},"edge_type":"inherent","type":"","uuid":"af7ba361-28b0-42bc-af20-6713402da459","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"0bd35eae-156a-4e0f-9b5f-ef67d2779fdf"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_7306a3c9_9a76_45c2_90c9_27729ab58b5f","uuid":"9de6c1e6-4dea-4202-bcd5-ae1667fa430b"},"edge_type":"inherent","type":"","uuid":"6691dea9-d29f-4451-905b-3a95f95d0952","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"f5c0ba5b-8ff0-473f-adb2-5810f4b66b37"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_7306a3c9_9a76_45c2_90c9_27729ab58b5f","uuid":"9de6c1e6-4dea-4202-bcd5-ae1667fa430b"},"edge_type":"inherent","type":"","uuid":"eb8a4a75-7339-4cf3-a695-55a6a8246aab","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277","uuid":"c81bf8c8-efc6-47e6-9d90-19987a1f1b15"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_7306a3c9_9a76_45c2_90c9_27729ab58b5f"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"9de6c1e6-4dea-4202-bcd5-ae1667fa430b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_7306a3c9_9a76_45c2_90c9_27729ab58b5f"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_CENTOS_76","uuid":"691d60b5-9272-4cb0-a4b4-4e8dc6f75277"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c81bf8c8-efc6-47e6-9d90-19987a1f1b15","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277","uuid":"9b6af2e4-9bb9-4d7d-9d74-2c7c244373a1"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f5c0ba5b-8ff0-473f-adb2-5810f4b66b37","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"ae1b092e-54db-4e92-8cc9-395f2b2b308d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0bd35eae-156a-4e0f-9b5f-ef67d2779fdf","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"38077e44-f222-4d2b-906b-ca8cc64c9edc"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5186d703-b6de-4806-b6a1-554ad928ec89","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"cca906a5-5e79-422e-b15f-7391a907ad07"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"55dbbc43-60ba-4a3a-9d42-1aaf43e4fb77","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"4c1ac9be-ea17-4e77-85e0-5496ec9345d5","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_7306a3c9_9a76_45c2_90c9_27729ab58b5f","uuid":"9fb72180-0b33-48a2-9c35-efd2a586e070"},"name":"SYS_GEN__Runbook_Deployment_7306a3c9_9a76_45c2_90c9_27729ab58b5f"}},{"description":"System action for starting an application","message_list":[],"uuid":"77738fd1-8316-47ab-be64-cf466e549c1b","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"retries":"0","description":"","type":"DAG","uuid":"1f65dab1-dbcd-4bd4-9b09-364db72b7da7","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"17fd32a6-3b5d-41c6-b4ee-35efa0c5fafb"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"4eafc79f-4340-46da-9310-dc82b4b66d73"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"17fd32a6-3b5d-41c6-b4ee-35efa0c5fafb"},"edge_type":"inherent","type":"","uuid":"e1c0c62c-6048-45c6-916e-c4ee0ca3b44f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"4eafc79f-4340-46da-9310-dc82b4b66d73"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_7306a3c9_9a76_45c2_90c9_27729ab58b5f"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"17fd32a6-3b5d-41c6-b4ee-35efa0c5fafb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"5b630ba9-e950-4fc9-9286-5d0310cce379"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4eafc79f-4340-46da-9310-dc82b4b66d73","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"588fb874-eb40-4a44-a5de-9922da716b3b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_7306a3c9_9a76_45c2_90c9_27729ab58b5f","uuid":"1f65dab1-dbcd-4bd4-9b09-364db72b7da7"},"name":"SYS_GEN__Runbook_Deployment_7306a3c9_9a76_45c2_90c9_27729ab58b5f"}},{"description":"System action for restarting an application","message_list":[],"uuid":"e2fcc6f1-59c0-4675-9557-2e8eb785b70b","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"retries":"0","description":"","type":"DAG","uuid":"79e7908a-630f-4416-af65-a5c8acde19d0","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"0f70d7de-f28b-482a-9730-5419829c56c4"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"158e53d2-695d-44bb-aeb4-335ec8cb5def"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"0f70d7de-f28b-482a-9730-5419829c56c4"},"edge_type":"inherent","type":"","uuid":"2348f59c-c918-4de6-9ebc-2ffe4946efce","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"158e53d2-695d-44bb-aeb4-335ec8cb5def"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_7306a3c9_9a76_45c2_90c9_27729ab58b5f"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0f70d7de-f28b-482a-9730-5419829c56c4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"f0a20e02-9792-48dd-8a0d-d9c4e8ddf92c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"158e53d2-695d-44bb-aeb4-335ec8cb5def","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"ce602c49-d9cd-44d7-8e10-5671dc407b8b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"cb230749-44ed-44bb-928a-5724dc967f76","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_7306a3c9_9a76_45c2_90c9_27729ab58b5f","uuid":"79e7908a-630f-4416-af65-a5c8acde19d0"},"name":"SYS_GEN__Runbook_Deployment_7306a3c9_9a76_45c2_90c9_27729ab58b5f"}},{"description":"System action for stopping an application","message_list":[],"uuid":"9c663cca-efdc-4c0e-ac34-9c161463fcd0","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"retries":"0","description":"","type":"DAG","uuid":"1c2d9e23-d8b3-4e79-b4d9-bcaee4bf0ef3","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"8294ab24-b155-4e64-8716-2e8f229b0b81"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"35db4265-76cb-43dc-a13b-395d7380458b"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"8294ab24-b155-4e64-8716-2e8f229b0b81"},"edge_type":"inherent","type":"","uuid":"dea32aac-5f28-4e44-9367-130ad9b52267","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"35db4265-76cb-43dc-a13b-395d7380458b"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_7306a3c9_9a76_45c2_90c9_27729ab58b5f"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8294ab24-b155-4e64-8716-2e8f229b0b81","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"35db4265-76cb-43dc-a13b-395d7380458b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"897d7e18-c1c6-4d19-a6b4-10c1a721f4c0"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"}],"description":"","message_list":[],"uuid":"5492f60f-ad89-4855-a20d-fecd36f883a9","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_7306a3c9_9a76_45c2_90c9_27729ab58b5f","uuid":"1c2d9e23-d8b3-4e79-b4d9-bcaee4bf0ef3"},"name":"SYS_GEN__Runbook_Deployment_7306a3c9_9a76_45c2_90c9_27729ab58b5f"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"e0b5fffa-b9d4-4612-85f4-e676b07b2f4c","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"retries":"0","description":"","type":"DAG","uuid":"d04790c1-f13f-41fe-9a27-6432e5ea8310","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"fdb44508-1c87-419f-b34f-3dbde21e378e"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"01b3248a-7197-465d-b9c0-34b30a8f05a2"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"920a723a-3708-4a53-8754-3ee0b75944fc"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"a2b6da1c-8b7c-4227-b49b-bff1b71c91c5"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_7306a3c9_9a76_45c2_90c9_27729ab58b5f","uuid":"bb6a33a7-ab0e-4868-a069-cfda1e0e8495"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"fdb44508-1c87-419f-b34f-3dbde21e378e"},"edge_type":"inherent","type":"","uuid":"9f697f6a-0c3c-4bac-84ee-fd31e4ee1655","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"01b3248a-7197-465d-b9c0-34b30a8f05a2"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"01b3248a-7197-465d-b9c0-34b30a8f05a2"},"edge_type":"inherent","type":"","uuid":"4b9541c7-c768-40b8-8962-69fa69bb4d22","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"920a723a-3708-4a53-8754-3ee0b75944fc"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"a2b6da1c-8b7c-4227-b49b-bff1b71c91c5"},"edge_type":"inherent","type":"","uuid":"ecc07519-af83-410a-9771-81a3f8a9f711","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_7306a3c9_9a76_45c2_90c9_27729ab58b5f","uuid":"bb6a33a7-ab0e-4868-a069-cfda1e0e8495"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"920a723a-3708-4a53-8754-3ee0b75944fc"},"edge_type":"inherent","type":"","uuid":"af303f08-a7ee-4797-a63b-e012a71efb31","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"a2b6da1c-8b7c-4227-b49b-bff1b71c91c5"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_7306a3c9_9a76_45c2_90c9_27729ab58b5f"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"fdb44508-1c87-419f-b34f-3dbde21e378e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"01b3248a-7197-465d-b9c0-34b30a8f05a2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"843ab0a6-03bd-4b9c-8f56-7d852e9348e0"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"920a723a-3708-4a53-8754-3ee0b75944fc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"37c2201b-1dfe-4c39-bc25-787eb9dc0c38"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a2b6da1c-8b7c-4227-b49b-bff1b71c91c5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"aa01078e-f99d-40a1-967a-af99b543be38"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"bb6a33a7-ab0e-4868-a069-cfda1e0e8495","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_7306a3c9_9a76_45c2_90c9_27729ab58b5f"}],"description":"","message_list":[],"uuid":"d4d74851-9733-415e-a60b-d854d34c0a41","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_7306a3c9_9a76_45c2_90c9_27729ab58b5f","uuid":"d04790c1-f13f-41fe-9a27-6432e5ea8310"},"name":"SYS_GEN__Runbook_Deployment_7306a3c9_9a76_45c2_90c9_27729ab58b5f"}},{"description":"System action for scaleout","message_list":[],"uuid":"c61246ff-f0ae-47f4-9144-0e96f4dae1de","name":"action_scaleout","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"retries":"0","description":"","type":"DAG","uuid":"dc2c5e43-75f9-4614-9c89-0bb256da6645","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scaleout_7306a3c9_9a76_45c2_90c9_27729ab58b5f","uuid":"12141773-b75b-4ba0-891d-ecc55d521ede"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_7306a3c9_9a76_45c2_90c9_27729ab58b5f"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"retries":"0","description":"","type":"SCALING","uuid":"12141773-b75b-4ba0-891d-ecc55d521ede","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scaleout_7306a3c9_9a76_45c2_90c9_27729ab58b5f"}],"description":"","message_list":[],"uuid":"da9bb298-d4b5-4113-8930-ec5be7cda591","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"c6774e5e-ef50-4078-bcff-3a86452d7ea5","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_7306a3c9_9a76_45c2_90c9_27729ab58b5f","uuid":"dc2c5e43-75f9-4614-9c89-0bb256da6645"},"name":"SYS_GEN__Runbook_Deployment_7306a3c9_9a76_45c2_90c9_27729ab58b5f"}},{"description":"System action for scalein","message_list":[],"uuid":"9471a30c-50e8-40e2-9246-823302be2489","name":"action_scalein","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"retries":"0","description":"","type":"DAG","uuid":"d44b8b15-9090-4512-8a13-8d7fdf2b66f6","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scalein_7306a3c9_9a76_45c2_90c9_27729ab58b5f","uuid":"f625bb34-ed0f-4b00-ba55-a0980b86ea6a"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_7306a3c9_9a76_45c2_90c9_27729ab58b5f"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"retries":"0","description":"","type":"SCALING","uuid":"f625bb34-ed0f-4b00-ba55-a0980b86ea6a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scalein_7306a3c9_9a76_45c2_90c9_27729ab58b5f"}],"description":"","message_list":[],"uuid":"ecc2e967-966c-4bee-80a4-d0d05b7cbc07","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"63e166f0-22fe-43ec-90b0-e71c8d9fdea7","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_7306a3c9_9a76_45c2_90c9_27729ab58b5f","uuid":"d44b8b15-9090-4512-8a13-8d7fdf2b66f6"},"name":"SYS_GEN__Runbook_Deployment_7306a3c9_9a76_45c2_90c9_27729ab58b5f"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"e51bdfd6-534f-4fd2-9b23-ac91b191dfb4","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"retries":"0","description":"","type":"DAG","uuid":"805d06dc-dcf2-4b09-bcfe-3f61ff960ac6","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"d724a4c2-3098-4168-8f2e-85d4ec288e93"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"5344d32c-52fb-48e9-ad48-369dbf2e8a79"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"00be6626-78c1-4b83-a377-43c27f845564"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_7306a3c9_9a76_45c2_90c9_27729ab58b5f","uuid":"1a310cc5-16fd-4539-9c71-37dc571f2d90"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"d724a4c2-3098-4168-8f2e-85d4ec288e93"},"edge_type":"inherent","type":"","uuid":"565e5354-8c40-472b-942a-c874034503de","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"5344d32c-52fb-48e9-ad48-369dbf2e8a79"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"5344d32c-52fb-48e9-ad48-369dbf2e8a79"},"edge_type":"inherent","type":"","uuid":"43fa6c8c-704d-4941-a13d-2087bfbc45f9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"00be6626-78c1-4b83-a377-43c27f845564"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"00be6626-78c1-4b83-a377-43c27f845564"},"edge_type":"inherent","type":"","uuid":"583c8bbb-25cf-4656-840a-5d8e7a7e2282","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_7306a3c9_9a76_45c2_90c9_27729ab58b5f","uuid":"1a310cc5-16fd-4539-9c71-37dc571f2d90"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_7306a3c9_9a76_45c2_90c9_27729ab58b5f"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d724a4c2-3098-4168-8f2e-85d4ec288e93","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"716ea7a7-bc0c-4ac5-ab9c-720c327a498e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"5344d32c-52fb-48e9-ad48-369dbf2e8a79","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"00be6626-78c1-4b83-a377-43c27f845564","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"1dfca661-ca45-488a-8f6e-da2aa26768c3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"1a310cc5-16fd-4539-9c71-37dc571f2d90","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_7306a3c9_9a76_45c2_90c9_27729ab58b5f"}],"description":"","message_list":[],"uuid":"f523d9de-ff3d-4d2b-9125-e732aa070c06","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_7306a3c9_9a76_45c2_90c9_27729ab58b5f","uuid":"805d06dc-dcf2-4b09-bcfe-3f61ff960ac6"},"name":"SYS_GEN__Runbook_Deployment_7306a3c9_9a76_45c2_90c9_27729ab58b5f"}}],"message_list":[],"published_service_local_reference_list":[],"uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f","min_replicas":"2","state":"ACTIVE","max_replicas":"9","depends_on_list":[],"editables":{"min_replicas":true,"max_replicas":true},"package_local_reference_list":[{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"}],"substrate_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"type":"GREENFIELD","options":{},"variable_list":[],"name":"39cf7283_deployment"}],"description":"","action_list":[{"description":"","message_list":[],"uuid":"a45e107f-f2c9-409b-b265-986751dfb1fd","name":"Upgrade","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"95b09321-5b8d-4031-836d-3d3a40d818fe","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Version Master","uuid":"66c0a5e7-3494-43ba-83f8-9368806ef5b3"},{"kind":"app_task","name":"Upgrade Master","uuid":"e44ef901-81c0-42ca-8ff2-03faae6404a9"},{"kind":"app_task","name":"Set Version Minion","uuid":"7daeb627-0861-419e-9814-1a1450f7fa73"},{"kind":"app_task","name":"Upgrade Minion","uuid":"e8bd1a85-382f-4cd3-b0fe-0b4dadfc4531"},{"kind":"app_task","name":"RestartServices","uuid":"e3242f4f-3997-4600-adfe-7683e768e32b"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"66c0a5e7-3494-43ba-83f8-9368806ef5b3"},"edge_type":"user_defined","type":"","uuid":"f9dc20ef-b3b3-4776-b89c-22ecfd58f908","to_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"e44ef901-81c0-42ca-8ff2-03faae6404a9"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"e44ef901-81c0-42ca-8ff2-03faae6404a9"},"edge_type":"user_defined","type":"","uuid":"20a8f316-c37b-4633-8822-61d75cf5dddd","to_task_reference":{"kind":"app_task","name":"RestartServices","uuid":"e3242f4f-3997-4600-adfe-7683e768e32b"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"66c0a5e7-3494-43ba-83f8-9368806ef5b3"},"edge_type":"user_defined","type":"","uuid":"00204690-aee8-4934-8ea1-74c86714f130","to_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"7daeb627-0861-419e-9814-1a1450f7fa73"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"7daeb627-0861-419e-9814-1a1450f7fa73"},"edge_type":"user_defined","type":"","uuid":"3ab35cda-e48b-49f1-9147-2522b51ea0dd","to_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"e8bd1a85-382f-4cd3-b0fe-0b4dadfc4531"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"e8bd1a85-382f-4cd3-b0fe-0b4dadfc4531"},"edge_type":"user_defined","type":"","uuid":"8618c7d4-7731-4e67-befe-a38fd9dec9eb","to_task_reference":{"kind":"app_task","name":"RestartServices","uuid":"e3242f4f-3997-4600-adfe-7683e768e32b"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6ee65d8a_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"66c0a5e7-3494-43ba-83f8-9368806ef5b3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Version Master"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"e44ef901-81c0-42ca-8ff2-03faae6404a9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nCONTROLLER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n\nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Upgrade Master"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"7daeb627-0861-419e-9814-1a1450f7fa73","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Version Minion"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"e8bd1a85-382f-4cd3-b0fe-0b4dadfc4531","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/usr\/share\/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Upgrade Minion"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"e3242f4f-3997-4600-adfe-7683e768e32b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_IPS=\"@@{AHV_Centos_K8SW.address}@@\"\nJSONPATH='{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}'\nKUBE_VERSION_NEW=\"@@{KUBE_VERSION_NEW}@@\"\nMASTER_API_HTTPS=6443\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION_NEW}\/bin\/linux\/amd64\/kubectl\nchmod +x kubectl\nsudo mv kubectl \/usr\/local\/bin\/kubectl\n\ncount=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n  echo \"Trying to reach master server https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} : sleep for 5 secs\"\n  sleep 10\n  if [[ $count -eq 10 ]]; then\n    echo \"Unable to reach master server: https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\"\n    exit 1\n  fi\n  count=$((count+1))\ndone\n\ncount=0\nfor ip in $(echo \"${WORKER_IPS}\" | tr \",\" \"\\n\"); do\n  #kubectl drain \"worker${count}\" --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no $ip \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 10\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=worker${count} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon worker${count}\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n  echo \"Upgrade failed on worker nodes\"\n    exit 1\nfi\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  #kubectl drain \"master${count}\" --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no $ip \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 10\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=master${count} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon master${count}\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n  echo \"Upgrade failed on nodes: $(kubectl get nodes -o jsonpath='$JSONPATH' | grep 'Ready=Unknown')\"\n    exit 1\nfi"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"RestartServices"}],"description":"","message_list":[],"uuid":"5ae78232-6591-4891-8df4-2b99e50db68e","state":"ACTIVE","variable_list":[{"regex":{"should_validate":true,"value":"^v1\\.[0-9]?[0-9]\\.[0-9]?[0-9]$"},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"3977b454-c88e-401f-a15c-0f3bd1b4cbbe","value":"v1.10.13","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_VERSION_NEW"}],"main_task_local_reference":{"kind":"app_task","name":"6ee65d8a_dag","uuid":"95b09321-5b8d-4031-836d-3d3a40d818fe"},"name":"68a7ffd0_runbook"}},{"description":"","message_list":[],"uuid":"58ed0edc-98f7-4fc5-bf59-d55ff420e69d","name":"ScaleOut","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"8c235d7f-5db1-4a68-93d7-baebf4d54abc","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Out","uuid":"a9256a47-8d31-4a5e-b209-e440bccb6ffd"},{"kind":"app_task","name":"Set Hosts file","uuid":"4ff6c5cf-e041-4a7f-9de6-bf131fc3d2a3"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Scale Out","uuid":"a9256a47-8d31-4a5e-b209-e440bccb6ffd"},"edge_type":"user_defined","type":"","uuid":"7c7b1a63-e73a-4fe1-baaa-68db376fe1f8","to_task_reference":{"kind":"app_task","name":"Set Hosts file","uuid":"4ff6c5cf-e041-4a7f-9de6-bf131fc3d2a3"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"03b33121_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"retries":"0","description":"","type":"SCALING","uuid":"a9256a47-8d31-4a5e-b209-e440bccb6ffd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Scale Out"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"4ff6c5cf-e041-4a7f-9de6-bf131fc3d2a3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMINION_IPS=\"@@{AHV_Centos_K8SW.address}@@\"\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  if ! (( $(grep -c \"${ip} worker${count}\" \/etc\/hosts) )) ; then\n  \techo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  fi\n  count=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Hosts file"}],"description":"","message_list":[],"uuid":"d5d1289f-cbeb-47d5-9269-9b83993724ab","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"e6a0176b-8b04-48f1-b219-75603ee064d1","value":"1","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"03b33121_dag","uuid":"8c235d7f-5db1-4a68-93d7-baebf4d54abc"},"name":"00cf5417_runbook"}},{"description":"","message_list":[],"uuid":"c34277be-b695-48d1-a9c6-e96125e6fff1","name":"ScaleIn","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"033e90a7-3dc2-4750-8d41-b61bfbfb63a1","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale In","uuid":"a08e85e9-2cb4-4175-9273-527997e392b4"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"e72a9133_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"retries":"0","description":"","type":"SCALING","uuid":"a08e85e9-2cb4-4175-9273-527997e392b4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Scale In"}],"description":"","message_list":[],"uuid":"a4e423d4-7f36-49e0-95c0-579115dac3f7","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"ff3a40f9-0e4e-49a8-9f44-ef99c3f11bb4","value":"1","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"e72a9133_dag","uuid":"033e90a7-3dc2-4750-8d41-b61bfbfb63a1"},"name":"96546f6c_runbook"}},{"description":"System action for creating an application","message_list":[],"uuid":"4c6dc601-3eb4-4513-805b-b8f103390ab5","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"ec3b1924-dd2a-4b53-894a-86b92cc06792"},"retries":"0","description":"","type":"DAG","uuid":"1f5db159-a520-47db-9cb9-ecae8d3d7257","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_7306a3c9_9a76_45c2_90c9_27729ab58b5f","uuid":"78ca0ee6-6741-41a6-8fed-b46d7a310a94"},{"kind":"app_task","name":"SYS_GEN__DE_Provision_56a7c02a_9a6e_46e2_8d39_c786833649db","uuid":"1e51d92d-3fc5-43e3-99cd-979309803ef4"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277","uuid":"045d9eb7-3021-43a9-90bd-0b6772587f30"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277_1","uuid":"9707be41-bf3d-4ad4-a1c4-d87aec93b262"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"113ececa-b146-4b0c-ae13-cb7afe25102c"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"119d74b9-d901-4e90-aee4-866736961c38"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"42397cc1-fa6e-4328-9da1-ff4edb22603d"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"30549552-1f76-4ae2-9fec-4752e76dafe9"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"3c0fb168-aa4f-4144-8399-8bfd149de32a"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"263ff4c8-9fa8-4b75-9744-56122a696d4c"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"1c64c906-7ac7-462d-9033-d5745884c102"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"1c5410ce-f49a-47bc-b4b3-c5a3c012f3bf"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"3c0fb168-aa4f-4144-8399-8bfd149de32a"},"edge_type":"inherent","type":"","uuid":"f8cdde2f-a132-4fa7-b240-9cbffa5b3e11","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"1c5410ce-f49a-47bc-b4b3-c5a3c012f3bf"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"42397cc1-fa6e-4328-9da1-ff4edb22603d"},"edge_type":"inherent","type":"","uuid":"e92172ac-8351-4c45-8482-560f4105c2af","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"3c0fb168-aa4f-4144-8399-8bfd149de32a"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_56a7c02a_9a6e_46e2_8d39_c786833649db","uuid":"1e51d92d-3fc5-43e3-99cd-979309803ef4"},"edge_type":"inherent","type":"","uuid":"2afb9187-d77d-4b23-a2cf-12e8b2df5005","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277","uuid":"045d9eb7-3021-43a9-90bd-0b6772587f30"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"113ececa-b146-4b0c-ae13-cb7afe25102c"},"edge_type":"inherent","type":"","uuid":"1625ced8-34a0-4a9b-99aa-2b3579eb59a2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"42397cc1-fa6e-4328-9da1-ff4edb22603d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_56a7c02a_9a6e_46e2_8d39_c786833649db","uuid":"1e51d92d-3fc5-43e3-99cd-979309803ef4"},"edge_type":"inherent","type":"","uuid":"b12d87e4-53da-4157-aa17-cf923281c45c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"113ececa-b146-4b0c-ae13-cb7afe25102c"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277","uuid":"045d9eb7-3021-43a9-90bd-0b6772587f30"},"edge_type":"inherent","type":"","uuid":"1fb46439-568b-44fc-878e-3f9b85973936","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"113ececa-b146-4b0c-ae13-cb7afe25102c"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"263ff4c8-9fa8-4b75-9744-56122a696d4c"},"edge_type":"inherent","type":"","uuid":"d42e2a11-8285-4c57-a511-eaaeae3e2a98","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"1c64c906-7ac7-462d-9033-d5745884c102"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"30549552-1f76-4ae2-9fec-4752e76dafe9"},"edge_type":"inherent","type":"","uuid":"34ab331c-daa9-4cd4-b934-205c309d7650","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"263ff4c8-9fa8-4b75-9744-56122a696d4c"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277_1","uuid":"9707be41-bf3d-4ad4-a1c4-d87aec93b262"},"edge_type":"inherent","type":"","uuid":"d36e2607-14ec-4909-8230-ca5fc3ad67f2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"119d74b9-d901-4e90-aee4-866736961c38"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"119d74b9-d901-4e90-aee4-866736961c38"},"edge_type":"inherent","type":"","uuid":"a06c2865-7f08-4080-8f03-d3ceb9cec6d9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"30549552-1f76-4ae2-9fec-4752e76dafe9"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_7306a3c9_9a76_45c2_90c9_27729ab58b5f","uuid":"78ca0ee6-6741-41a6-8fed-b46d7a310a94"},"edge_type":"inherent","type":"","uuid":"9e390b62-9cfd-4563-9ec1-3ac40ed498f5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"119d74b9-d901-4e90-aee4-866736961c38"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_7306a3c9_9a76_45c2_90c9_27729ab58b5f","uuid":"78ca0ee6-6741-41a6-8fed-b46d7a310a94"},"edge_type":"inherent","type":"","uuid":"39f041ea-048d-43ba-9f73-e9908d170174","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277_1","uuid":"9707be41-bf3d-4ad4-a1c4-d87aec93b262"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"119d74b9-d901-4e90-aee4-866736961c38"},"edge_type":"dependency","type":"","uuid":"32f206c8-9eaf-4351-bf6a-99bc0bb13511","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"42397cc1-fa6e-4328-9da1-ff4edb22603d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"113ececa-b146-4b0c-ae13-cb7afe25102c"},"edge_type":"dependency","type":"","uuid":"7b433ce4-8666-4637-8363-dbb2620315e6","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"30549552-1f76-4ae2-9fec-4752e76dafe9"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_ec3b1924_dd2a_4b53_894a_86b92cc06792"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"78ca0ee6-6741-41a6-8fed-b46d7a310a94","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_7306a3c9_9a76_45c2_90c9_27729ab58b5f"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"1e51d92d-3fc5-43e3-99cd-979309803ef4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_56a7c02a_9a6e_46e2_8d39_c786833649db"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_CENTOS_76","uuid":"691d60b5-9272-4cb0-a4b4-4e8dc6f75277"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"045d9eb7-3021-43a9-90bd-0b6772587f30","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277","uuid":"9b6af2e4-9bb9-4d7d-9d74-2c7c244373a1"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_CENTOS_76","uuid":"691d60b5-9272-4cb0-a4b4-4e8dc6f75277"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"9707be41-bf3d-4ad4-a1c4-d87aec93b262","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277","uuid":"9b6af2e4-9bb9-4d7d-9d74-2c7c244373a1"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277_1"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"113ececa-b146-4b0c-ae13-cb7afe25102c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"1a1082b4-4898-4c81-bf4e-1ac2d172c842"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"119d74b9-d901-4e90-aee4-866736961c38","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"ae1b092e-54db-4e92-8cc9-395f2b2b308d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"42397cc1-fa6e-4328-9da1-ff4edb22603d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"61b24c4f-ac1b-4182-a03a-b65e157a71bf"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_22e18386_fa75_402e_9fd9_aa32056cb746"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"30549552-1f76-4ae2-9fec-4752e76dafe9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"38077e44-f222-4d2b-906b-ca8cc64c9edc"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3c0fb168-aa4f-4144-8399-8bfd149de32a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"384cf3d8-e940-43f1-a289-6c6b363c5371"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"263ff4c8-9fa8-4b75-9744-56122a696d4c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"cca906a5-5e79-422e-b15f-7391a907ad07"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1c64c906-7ac7-462d-9033-d5745884c102","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1c5410ce-f49a-47bc-b4b3-c5a3c012f3bf","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"b9152f0f-6379-4b9f-90aa-da901c74af59","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_ec3b1924_dd2a_4b53_894a_86b92cc06792","uuid":"1f5db159-a520-47db-9cb9-ecae8d3d7257"},"name":"SYS_GEN__Runbook_Application_ec3b1924_dd2a_4b53_894a_86b92cc06792"}},{"description":"System action for starting an application","message_list":[],"uuid":"318e50c1-7c34-48e8-9d0a-203a6219dbf2","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"ec3b1924-dd2a-4b53-894a-86b92cc06792"},"retries":"0","description":"","type":"DAG","uuid":"d75acc7f-a674-4241-9e2a-0ba32cdd1ac0","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"2abaa770-8ac5-4141-8b91-f579be6c2c1c"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"ffeb60bc-5c13-48e7-8305-3b401dff64fb"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"925720f9-ad1c-405f-8868-38261771735e"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"5883146d-ecca-4799-9b97-44d859b46631"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"2abaa770-8ac5-4141-8b91-f579be6c2c1c"},"edge_type":"inherent","type":"","uuid":"8212c652-155e-4f84-bb29-4e36e2675597","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"925720f9-ad1c-405f-8868-38261771735e"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"ffeb60bc-5c13-48e7-8305-3b401dff64fb"},"edge_type":"inherent","type":"","uuid":"522dd183-b34d-4c6e-bb8a-e7c567d744c5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"5883146d-ecca-4799-9b97-44d859b46631"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_ec3b1924_dd2a_4b53_894a_86b92cc06792"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2abaa770-8ac5-4141-8b91-f579be6c2c1c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"944a7abe-6689-4697-aa2d-de5aa22bc3e2"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ffeb60bc-5c13-48e7-8305-3b401dff64fb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"5b630ba9-e950-4fc9-9286-5d0310cce379"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"925720f9-ad1c-405f-8868-38261771735e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5883146d-ecca-4799-9b97-44d859b46631","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"442f62c2-cac5-4239-85c2-6a2742586c15","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_ec3b1924_dd2a_4b53_894a_86b92cc06792","uuid":"d75acc7f-a674-4241-9e2a-0ba32cdd1ac0"},"name":"SYS_GEN__Runbook_Application_ec3b1924_dd2a_4b53_894a_86b92cc06792"}},{"description":"System action for restarting an application","message_list":[],"uuid":"ea0dfca8-9b10-4d15-9292-dce19aeaccf0","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"ec3b1924-dd2a-4b53-894a-86b92cc06792"},"retries":"0","description":"","type":"DAG","uuid":"c9362892-c343-46e6-8495-b5b4e7938b38","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"365a227f-d2a2-4fda-bb3a-2d73922e5acb"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"9af25341-13ed-42da-be18-fc623d8eef83"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"1756cbd0-a247-4eff-b4b5-97889f32eceb"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"54f3930f-55a4-4ae6-93d7-d703e444bf9a"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"9af25341-13ed-42da-be18-fc623d8eef83"},"edge_type":"inherent","type":"","uuid":"b7693f99-51c6-46c5-b86c-3624d8aee670","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"1756cbd0-a247-4eff-b4b5-97889f32eceb"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"365a227f-d2a2-4fda-bb3a-2d73922e5acb"},"edge_type":"inherent","type":"","uuid":"549706e2-3263-4bf5-ab64-948501fac880","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"54f3930f-55a4-4ae6-93d7-d703e444bf9a"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_ec3b1924_dd2a_4b53_894a_86b92cc06792"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"365a227f-d2a2-4fda-bb3a-2d73922e5acb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"f0a20e02-9792-48dd-8a0d-d9c4e8ddf92c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"9af25341-13ed-42da-be18-fc623d8eef83","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"eebd290b-2b08-452c-bd08-8e435eb12798"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1756cbd0-a247-4eff-b4b5-97889f32eceb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"ca8cec47-f6e6-4ffb-83f1-eb67ddbb98e2"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"54f3930f-55a4-4ae6-93d7-d703e444bf9a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"ce602c49-d9cd-44d7-8e10-5671dc407b8b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"7904f8c2-ea6c-4272-b94e-afb1f0897786","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_ec3b1924_dd2a_4b53_894a_86b92cc06792","uuid":"c9362892-c343-46e6-8495-b5b4e7938b38"},"name":"SYS_GEN__Runbook_Application_ec3b1924_dd2a_4b53_894a_86b92cc06792"}},{"description":"System action for stopping an application","message_list":[],"uuid":"7eecab7b-376e-4b04-a12b-9a8878e471a1","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"ec3b1924-dd2a-4b53-894a-86b92cc06792"},"retries":"0","description":"","type":"DAG","uuid":"a97c7bfa-c9d3-42cd-a9ff-1cfa75e880f3","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"0f393265-6583-4052-949f-0e14a2bfc7dd"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"1e89460e-349a-4586-8bf3-1a2bb495690c"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"3a2ed4da-400b-4cdb-9953-bf88897df913"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"aab91310-c704-4493-8403-1ecfb6c78cf8"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"0f393265-6583-4052-949f-0e14a2bfc7dd"},"edge_type":"inherent","type":"","uuid":"06e5f744-1933-45e5-8d08-a090d5c8ecae","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"aab91310-c704-4493-8403-1ecfb6c78cf8"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"1e89460e-349a-4586-8bf3-1a2bb495690c"},"edge_type":"inherent","type":"","uuid":"ae93f4a8-ef8c-41bc-8c76-7dcb941608d7","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"3a2ed4da-400b-4cdb-9953-bf88897df913"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_ec3b1924_dd2a_4b53_894a_86b92cc06792"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0f393265-6583-4052-949f-0e14a2bfc7dd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1e89460e-349a-4586-8bf3-1a2bb495690c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3a2ed4da-400b-4cdb-9953-bf88897df913","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"897d7e18-c1c6-4d19-a6b4-10c1a721f4c0"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"aab91310-c704-4493-8403-1ecfb6c78cf8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"8a14fa13-5c99-4c8c-8d19-8ca3ff08d37e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074"}],"description":"","message_list":[],"uuid":"1bcaca2d-45df-4efb-b5a5-70d8950eacf3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_ec3b1924_dd2a_4b53_894a_86b92cc06792","uuid":"a97c7bfa-c9d3-42cd-a9ff-1cfa75e880f3"},"name":"SYS_GEN__Runbook_Application_ec3b1924_dd2a_4b53_894a_86b92cc06792"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"84f3de0d-5621-4ad5-b0f3-2d9d3d557f75","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"ec3b1924-dd2a-4b53-894a-86b92cc06792"},"retries":"0","description":"","type":"DAG","uuid":"e7ae71ff-d954-4977-a940-367058ae7751","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"722f4521-b0aa-47a9-aac6-c26e83587df4"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"583d4a18-79a1-42e9-a81b-3a1a3639123b"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"f2f09b82-18fe-4bd7-8554-8bd82b26edc2"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"f4fda212-9207-444b-92ba-9b1ed10a40ae"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"4cbcc971-28e8-4690-98cc-f9b7a0000791"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"67cc4ce0-eefe-47e0-96aa-49845ab1eeed"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"47a47f8d-f45d-4f25-a6e5-74a024a1015d"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"31766736-a552-40cd-a74c-14e782f88121"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_7306a3c9_9a76_45c2_90c9_27729ab58b5f","uuid":"29f73610-334b-4fa8-9697-41cff7ed3b51"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_56a7c02a_9a6e_46e2_8d39_c786833649db","uuid":"860f1b2f-3bb2-4cef-9e4b-064bb78677ce"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"722f4521-b0aa-47a9-aac6-c26e83587df4"},"edge_type":"inherent","type":"","uuid":"47f026f1-a027-4a05-9294-40bb9299b011","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"f2f09b82-18fe-4bd7-8554-8bd82b26edc2"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"f2f09b82-18fe-4bd7-8554-8bd82b26edc2"},"edge_type":"inherent","type":"","uuid":"7bde854a-7150-4057-bdc9-6290b98aff87","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"67cc4ce0-eefe-47e0-96aa-49845ab1eeed"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"67cc4ce0-eefe-47e0-96aa-49845ab1eeed"},"edge_type":"inherent","type":"","uuid":"a06b16f8-7a24-425c-adc8-f6c935a0023c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"47a47f8d-f45d-4f25-a6e5-74a024a1015d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"47a47f8d-f45d-4f25-a6e5-74a024a1015d"},"edge_type":"inherent","type":"","uuid":"02cb81e2-aaf5-4a20-91a2-8a17130f6aee","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_56a7c02a_9a6e_46e2_8d39_c786833649db","uuid":"860f1b2f-3bb2-4cef-9e4b-064bb78677ce"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"583d4a18-79a1-42e9-a81b-3a1a3639123b"},"edge_type":"inherent","type":"","uuid":"5eea3dde-8002-492b-b667-6d9aa9c7652a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"f4fda212-9207-444b-92ba-9b1ed10a40ae"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"f4fda212-9207-444b-92ba-9b1ed10a40ae"},"edge_type":"inherent","type":"","uuid":"ae4a4c55-6913-43c4-b42c-4434fdcadf8d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"4cbcc971-28e8-4690-98cc-f9b7a0000791"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"31766736-a552-40cd-a74c-14e782f88121"},"edge_type":"inherent","type":"","uuid":"19d379db-0c6f-4700-a9eb-8905bfcf29b2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_7306a3c9_9a76_45c2_90c9_27729ab58b5f","uuid":"29f73610-334b-4fa8-9697-41cff7ed3b51"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"4cbcc971-28e8-4690-98cc-f9b7a0000791"},"edge_type":"inherent","type":"","uuid":"125d1f78-022c-44d5-b415-8db518b3817a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"31766736-a552-40cd-a74c-14e782f88121"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"67cc4ce0-eefe-47e0-96aa-49845ab1eeed"},"edge_type":"create_action_edge","type":"","uuid":"c8bf1331-dc8f-40e2-9538-73dc49f9392a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"31766736-a552-40cd-a74c-14e782f88121"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"4cbcc971-28e8-4690-98cc-f9b7a0000791"},"edge_type":"create_action_edge","type":"","uuid":"b29f72a0-87e9-4f38-8d65-906fe71dbbde","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"47a47f8d-f45d-4f25-a6e5-74a024a1015d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"f2f09b82-18fe-4bd7-8554-8bd82b26edc2"},"edge_type":"dependency","type":"","uuid":"7bce39c7-7f97-4083-bf5c-a2fb56548456","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"4cbcc971-28e8-4690-98cc-f9b7a0000791"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_ec3b1924_dd2a_4b53_894a_86b92cc06792"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"722f4521-b0aa-47a9-aac6-c26e83587df4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"583d4a18-79a1-42e9-a81b-3a1a3639123b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f2f09b82-18fe-4bd7-8554-8bd82b26edc2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"7f713d48-74e9-4bb6-8dc9-eb8f00371ff3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f4fda212-9207-444b-92ba-9b1ed10a40ae","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"843ab0a6-03bd-4b9c-8f56-7d852e9348e0"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4cbcc971-28e8-4690-98cc-f9b7a0000791","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"37c2201b-1dfe-4c39-bc25-787eb9dc0c38"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"67cc4ce0-eefe-47e0-96aa-49845ab1eeed","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"65e26ed0-c793-48d7-ad16-695573871526"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_22e18386_fa75_402e_9fd9_aa32056cb746"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"47a47f8d-f45d-4f25-a6e5-74a024a1015d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"36ea5e7a-39dd-4b51-a707-415c5e19caca"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"31766736-a552-40cd-a74c-14e782f88121","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"aa01078e-f99d-40a1-967a-af99b543be38"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"29f73610-334b-4fa8-9697-41cff7ed3b51","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_7306a3c9_9a76_45c2_90c9_27729ab58b5f"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"860f1b2f-3bb2-4cef-9e4b-064bb78677ce","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_56a7c02a_9a6e_46e2_8d39_c786833649db"}],"description":"","message_list":[],"uuid":"137bf811-04e2-45d3-8fa4-0c1f76b407a6","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_ec3b1924_dd2a_4b53_894a_86b92cc06792","uuid":"e7ae71ff-d954-4977-a940-367058ae7751"},"name":"SYS_GEN__Runbook_Application_ec3b1924_dd2a_4b53_894a_86b92cc06792"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"56684b82-eb8f-4dca-91e7-8c639d440394","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"ec3b1924-dd2a-4b53-894a-86b92cc06792"},"retries":"0","description":"","type":"DAG","uuid":"0cb14710-f53a-41cc-b507-e8edc0442d23","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"f9ce01f4-8c9d-4925-a01f-48b46fc80992"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"0c063f94-545c-4d14-abc7-6fcf8d83a950"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"9f837892-2624-4fe5-afcf-5c818fa60c34"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"6d77401a-66c0-4123-a56e-2a5e3cb6f800"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"0f18673a-89e8-40f7-bfbf-b524c07123d7"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"7655efec-e2ba-4cfc-bd90-0f3b43507141"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_56a7c02a_9a6e_46e2_8d39_c786833649db","uuid":"74b8ce8c-d7f9-4a53-b4e4-0a280396edca"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_7306a3c9_9a76_45c2_90c9_27729ab58b5f","uuid":"85625572-5af2-4d6c-a15b-8be26a3d1a42"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"f9ce01f4-8c9d-4925-a01f-48b46fc80992"},"edge_type":"inherent","type":"","uuid":"7b1b0488-e392-4214-88fd-0502b1288bf2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"6d77401a-66c0-4123-a56e-2a5e3cb6f800"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"6d77401a-66c0-4123-a56e-2a5e3cb6f800"},"edge_type":"inherent","type":"","uuid":"5c19189c-4295-4459-87d5-17f73e5cb188","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"7655efec-e2ba-4cfc-bd90-0f3b43507141"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"7655efec-e2ba-4cfc-bd90-0f3b43507141"},"edge_type":"inherent","type":"","uuid":"75d153dc-0fb3-46d9-9861-e480df41fd05","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_56a7c02a_9a6e_46e2_8d39_c786833649db","uuid":"74b8ce8c-d7f9-4a53-b4e4-0a280396edca"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"0c063f94-545c-4d14-abc7-6fcf8d83a950"},"edge_type":"inherent","type":"","uuid":"67b80c2b-4991-490f-bbb1-e60d278f02d2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"9f837892-2624-4fe5-afcf-5c818fa60c34"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"9f837892-2624-4fe5-afcf-5c818fa60c34"},"edge_type":"inherent","type":"","uuid":"e2b31c11-b2d6-49a1-848b-b16a61841f7d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"0f18673a-89e8-40f7-bfbf-b524c07123d7"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"0f18673a-89e8-40f7-bfbf-b524c07123d7"},"edge_type":"inherent","type":"","uuid":"f89583e1-7238-490b-a548-129b78fe12e3","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_7306a3c9_9a76_45c2_90c9_27729ab58b5f","uuid":"85625572-5af2-4d6c-a15b-8be26a3d1a42"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"6d77401a-66c0-4123-a56e-2a5e3cb6f800"},"edge_type":"create_action_edge","type":"","uuid":"f934c0ba-5931-4784-ad69-ef7fac2a929e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"0f18673a-89e8-40f7-bfbf-b524c07123d7"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"9f837892-2624-4fe5-afcf-5c818fa60c34"},"edge_type":"create_action_edge","type":"","uuid":"0cb1f508-2857-4225-abd6-a0c105108f41","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"7655efec-e2ba-4cfc-bd90-0f3b43507141"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_ec3b1924_dd2a_4b53_894a_86b92cc06792"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f9ce01f4-8c9d-4925-a01f-48b46fc80992","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"2064d305-852a-47aa-89b9-7415f90c2152"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0c063f94-545c-4d14-abc7-6fcf8d83a950","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"716ea7a7-bc0c-4ac5-ab9c-720c327a498e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"9f837892-2624-4fe5-afcf-5c818fa60c34","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"6d77401a-66c0-4123-a56e-2a5e3cb6f800","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_22e18386_fa75_402e_9fd9_aa32056cb746"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0f18673a-89e8-40f7-bfbf-b524c07123d7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26","uuid":"1dfca661-ca45-488a-8f6e-da2aa26768c3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_caf4c659_7d09_49d7_91f5_cfe1c85dbf26"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"7655efec-e2ba-4cfc-bd90-0f3b43507141","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_07dace66_598d_4d29_a271_7965340bd074","uuid":"154c4dd5-93a8-43c1-a093-f68ec6eaad90"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_07dace66_598d_4d29_a271_7965340bd074"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"74b8ce8c-d7f9-4a53-b4e4-0a280396edca","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_56a7c02a_9a6e_46e2_8d39_c786833649db"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"85625572-5af2-4d6c-a15b-8be26a3d1a42","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_7306a3c9_9a76_45c2_90c9_27729ab58b5f"}],"description":"","message_list":[],"uuid":"2250b993-3d99-44fb-956e-52f0fc78f7bc","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_ec3b1924_dd2a_4b53_894a_86b92cc06792","uuid":"0cb14710-f53a-41cc-b507-e8edc0442d23"},"name":"SYS_GEN__Runbook_Application_ec3b1924_dd2a_4b53_894a_86b92cc06792"}}],"message_list":[],"uuid":"ec3b1924-dd2a-4b53-894a-86b92cc06792","state":"ACTIVE","dependency_list":[{"getter_resource_kind":"PackageCfg","setter_resource_attr":"address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"AHV_Centos_K8SW","action_name":"action_create","action_resource_name":"Nutanix","getter_resource_name":"AHV_Centos_K8SM_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"AHV_Centos_K8SM","action_name":"action_create","action_resource_name":"Nutanix","getter_resource_name":"AHV_Centos_K8SW_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"address","setter_resource_kind":"ServiceCfg","setter_resource_name":"Kubernetes_Master","action_name":"action_delete","action_resource_name":"Nutanix","getter_resource_name":"AHV_Centos_K8SW_Package","action_resource_kind":"ApplicationCfg"}],"variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"1d26ced8-e5c1-433d-95b9-8f9b0152f5d4","value":"ahv-kubenetes-cluster","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_CLUSTER_NAME"},{"regex":{"should_validate":true,"value":"^v1\\.[0-9]?[0-9]\\.[0-9]?[0-9]$"},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"58ee33f7-e0b1-4e4a-83b7-522520287607","value":"v1.9.11","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_VERSION"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"008b8a10-4cd0-4195-a81c-d63d6b35c841","value":"17.03.3.ce","label":"","state":"ACTIVE","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{"type":"PREDEFINED","choices":["17.03.3.ce","17.06.2.ce","17.09.1.ce","17.12.1.ce","18.03.1.ce","18.06.3.ce"]},"name":"DOCKER_VERSION"},{"regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\\/\\d{1,2}$"},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"59a3e3bc-2e54-4781-915b-0aeb2cd0a448","value":"10.200.0.0\/16","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_CLUSTER_SUBNET"},{"regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\\/\\d{1,2}$"},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"b28ecb1f-8807-4eb6-98e3-de166abf429d","value":"10.32.0.0\/24","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_SERVICE_SUBNET"},{"regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$"},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"27600034-0187-463d-8b18-0c9003d3f1a8","value":"10.32.0.10","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_DNS_IP"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"eaaf7752-ee90-4f38-be12-f6c664cfc90f","value":"flannel","label":"","state":"ACTIVE","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{"type":"PREDEFINED","choices":["flannel","canal","calico"]},"name":"KUBE_CNI_PLUGIN"},{"regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$"},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"5eb939d0-b980-4fba-a472-736426ee8df1","value":"10.46.34.95","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"PE_CLUSTER_IP"},{"regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$"},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"05edf3dd-1198-472b-90d9-4e793d9772a3","value":"10.46.34.96","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"PE_DATA_SERVICE_IP"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"81f68e72-3225-4b55-8064-9fe5b292f917","value":"admin","label":"","state":"ACTIVE","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"PE_USERNAME"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"97029cb6-ddf4-4f63-9546-a57dab238049","value":"","label":"","state":"ACTIVE","attrs":{"is_secret_modified":false,"secret_reference":{"uuid":"98dcf205-c5ce-4077-bf45-4c29865334e3"},"type":""},"editables":{"value":true},"is_hidden":false,"type":"SECRET","options":{},"name":"PE_PASSWORD"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"2abdd609-5beb-42e5-9e8e-6a031a44ce24","value":"default-container-69049036518763","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"PE_CONTAINER_NAME"}],"name":"Nutanix"},{"deployment_create_list":[{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"83b01eb8-29f7-4cfe-886a-29704fefae02","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"retries":"0","description":"","type":"DAG","uuid":"821094eb-4420-407b-99b8-88f7e04a031d","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_d0f58896_b535_451c_a462_71690d7d9c43","uuid":"49e07bf4-63fd-4d01-af24-e8bf50a44bf4"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"0900d31b-bf0b-4743-a013-afde40718ce5"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"63eafc90-1e51-4b72-a014-5ba56b6edfc1"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"804ded58-4d0b-4c35-ab18-b13334ab93bc"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"75990ab2-4372-4566-9418-697704d3754d"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"804ded58-4d0b-4c35-ab18-b13334ab93bc"},"edge_type":"inherent","type":"","uuid":"dc205505-fc48-456e-8c9d-c5aa8af081bf","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"75990ab2-4372-4566-9418-697704d3754d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"63eafc90-1e51-4b72-a014-5ba56b6edfc1"},"edge_type":"inherent","type":"","uuid":"16df5aa3-1e2c-4708-a1a0-9488740534c8","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"804ded58-4d0b-4c35-ab18-b13334ab93bc"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_d0f58896_b535_451c_a462_71690d7d9c43","uuid":"49e07bf4-63fd-4d01-af24-e8bf50a44bf4"},"edge_type":"inherent","type":"","uuid":"81ff5c92-c395-4d4f-bd8c-d4020f2e4fec","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"0900d31b-bf0b-4743-a013-afde40718ce5"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"0900d31b-bf0b-4743-a013-afde40718ce5"},"edge_type":"inherent","type":"","uuid":"4c77af3d-9001-4ef0-ba9a-91be3e92f0eb","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"63eafc90-1e51-4b72-a014-5ba56b6edfc1"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_d0f58896_b535_451c_a462_71690d7d9c43"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"49e07bf4-63fd-4d01-af24-e8bf50a44bf4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_d0f58896_b535_451c_a462_71690d7d9c43"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0900d31b-bf0b-4743-a013-afde40718ce5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"b4e860cc-e5be-4f59-9702-04c83a3832cd"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"63eafc90-1e51-4b72-a014-5ba56b6edfc1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"4fa4a4af-ba4c-4bba-892d-02af5ec36e1a"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"804ded58-4d0b-4c35-ab18-b13334ab93bc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"384cf3d8-e940-43f1-a289-6c6b363c5371"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"75990ab2-4372-4566-9418-697704d3754d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"3ce29740-a3d6-4e48-aa75-d9c8d477d129","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_d0f58896_b535_451c_a462_71690d7d9c43","uuid":"821094eb-4420-407b-99b8-88f7e04a031d"},"name":"SYS_GEN__Runbook_Deployment_d0f58896_b535_451c_a462_71690d7d9c43"}},{"description":"System action for starting an application","message_list":[],"uuid":"0b84baba-2874-402b-b4ff-211006c31604","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"retries":"0","description":"","type":"DAG","uuid":"b3c6f28e-5c15-403d-a1fc-c34d7da1229a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"dd24fd5b-f4db-4633-be54-5db32e2d87ce"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"21a0c729-bade-4984-8d91-db097e28ec36"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"dd24fd5b-f4db-4633-be54-5db32e2d87ce"},"edge_type":"inherent","type":"","uuid":"8abc5b6e-7a90-40d9-ab87-76b32c859569","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"21a0c729-bade-4984-8d91-db097e28ec36"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_d0f58896_b535_451c_a462_71690d7d9c43"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"dd24fd5b-f4db-4633-be54-5db32e2d87ce","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"96911906-9050-4cbd-ad31-8ababc7046cd"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"21a0c729-bade-4984-8d91-db097e28ec36","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"c22baed2-6b9e-4544-9733-3eb289734824","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_d0f58896_b535_451c_a462_71690d7d9c43","uuid":"b3c6f28e-5c15-403d-a1fc-c34d7da1229a"},"name":"SYS_GEN__Runbook_Deployment_d0f58896_b535_451c_a462_71690d7d9c43"}},{"description":"System action for restarting an application","message_list":[],"uuid":"7d323c11-ca94-415f-98eb-116e367ef7fb","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"retries":"0","description":"","type":"DAG","uuid":"a0709f57-d56d-420c-890f-444c8e9f3d1f","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"e7e97799-5fff-46fe-abd3-acee96b5c0cc"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"0fb83954-b027-4100-a3de-d23bab3cceb9"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"e7e97799-5fff-46fe-abd3-acee96b5c0cc"},"edge_type":"inherent","type":"","uuid":"08b871f1-8872-4380-b061-432cfaf9ca33","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"0fb83954-b027-4100-a3de-d23bab3cceb9"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_d0f58896_b535_451c_a462_71690d7d9c43"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e7e97799-5fff-46fe-abd3-acee96b5c0cc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"d9499ae4-9eea-4bb1-8a9c-aa97c693040c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0fb83954-b027-4100-a3de-d23bab3cceb9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"ca8cec47-f6e6-4ffb-83f1-eb67ddbb98e2"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"597f92d5-63c9-4b49-9f7f-0455309adf46","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_d0f58896_b535_451c_a462_71690d7d9c43","uuid":"a0709f57-d56d-420c-890f-444c8e9f3d1f"},"name":"SYS_GEN__Runbook_Deployment_d0f58896_b535_451c_a462_71690d7d9c43"}},{"description":"System action for stopping an application","message_list":[],"uuid":"08073ed9-e71a-4651-821d-4acc6bdf0d16","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"retries":"0","description":"","type":"DAG","uuid":"95078157-d070-4463-ac3e-05d9ee7d5841","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"769ae1a8-08a7-465b-b670-f2addcad2012"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"2727d5e0-b117-4a5f-be82-6d85c3b58e50"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"769ae1a8-08a7-465b-b670-f2addcad2012"},"edge_type":"inherent","type":"","uuid":"ceb44101-ff0e-4fa4-871b-a1b38204ba97","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"2727d5e0-b117-4a5f-be82-6d85c3b58e50"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_d0f58896_b535_451c_a462_71690d7d9c43"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"769ae1a8-08a7-465b-b670-f2addcad2012","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2727d5e0-b117-4a5f-be82-6d85c3b58e50","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"6edeaf33-7e8b-4726-a1fa-5114bb4a850d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247"}],"description":"","message_list":[],"uuid":"dbf747d3-6171-43b4-9205-917f56d052be","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_d0f58896_b535_451c_a462_71690d7d9c43","uuid":"95078157-d070-4463-ac3e-05d9ee7d5841"},"name":"SYS_GEN__Runbook_Deployment_d0f58896_b535_451c_a462_71690d7d9c43"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"52d86af4-b395-4719-9298-868f412f17bf","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"retries":"0","description":"","type":"DAG","uuid":"83b73a38-0745-4cec-b90a-be9a9379c0e3","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"173af390-3611-40b2-84c7-41779f7a4b02"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"50312382-780b-42d5-b6cd-bc43e6d466c8"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"72dd88c8-33fe-47a3-8b03-8c1d981add7a"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"565d62ba-4c9e-4c86-add1-1dd70e8cd485"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_d0f58896_b535_451c_a462_71690d7d9c43","uuid":"188bbb11-b2f4-4ae8-b856-23f24c21bad2"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"173af390-3611-40b2-84c7-41779f7a4b02"},"edge_type":"inherent","type":"","uuid":"8d271583-994a-4000-bc16-6134e6fe1833","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"50312382-780b-42d5-b6cd-bc43e6d466c8"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"50312382-780b-42d5-b6cd-bc43e6d466c8"},"edge_type":"inherent","type":"","uuid":"08d8ecee-f7e7-4dfe-8277-24466ceb07eb","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"72dd88c8-33fe-47a3-8b03-8c1d981add7a"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"565d62ba-4c9e-4c86-add1-1dd70e8cd485"},"edge_type":"inherent","type":"","uuid":"372e5758-6c04-442f-b358-bd91d3d1545a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_d0f58896_b535_451c_a462_71690d7d9c43","uuid":"188bbb11-b2f4-4ae8-b856-23f24c21bad2"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"72dd88c8-33fe-47a3-8b03-8c1d981add7a"},"edge_type":"inherent","type":"","uuid":"73a1aef1-6a7e-4327-acc9-2482aa214ffd","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"565d62ba-4c9e-4c86-add1-1dd70e8cd485"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_d0f58896_b535_451c_a462_71690d7d9c43"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"173af390-3611-40b2-84c7-41779f7a4b02","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"50312382-780b-42d5-b6cd-bc43e6d466c8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"7f713d48-74e9-4bb6-8dc9-eb8f00371ff3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"72dd88c8-33fe-47a3-8b03-8c1d981add7a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"f097bc74-7b35-4f8c-a995-5fa3e8d59774"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"565d62ba-4c9e-4c86-add1-1dd70e8cd485","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"ef5e502e-516c-40cf-b3c5-f903d96e4193"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"188bbb11-b2f4-4ae8-b856-23f24c21bad2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_d0f58896_b535_451c_a462_71690d7d9c43"}],"description":"","message_list":[],"uuid":"6935648c-eb3f-45d3-8b06-fbc904e04194","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_d0f58896_b535_451c_a462_71690d7d9c43","uuid":"83b73a38-0745-4cec-b90a-be9a9379c0e3"},"name":"SYS_GEN__Runbook_Deployment_d0f58896_b535_451c_a462_71690d7d9c43"}},{"description":"System action for scaleout","message_list":[],"uuid":"b3392035-55d3-476e-99bb-46bf6f91b8c1","name":"action_scaleout","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"retries":"0","description":"","type":"DAG","uuid":"16be48d6-6466-4a22-9e39-dbac04fd132b","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scaleout_d0f58896_b535_451c_a462_71690d7d9c43","uuid":"55971506-bd56-491b-89cf-25051dbe094f"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_d0f58896_b535_451c_a462_71690d7d9c43"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"retries":"0","description":"","type":"SCALING","uuid":"55971506-bd56-491b-89cf-25051dbe094f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scaleout_d0f58896_b535_451c_a462_71690d7d9c43"}],"description":"","message_list":[],"uuid":"8b8dfe87-ea20-41ca-8a2e-2c1e3396ccb7","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"eb845c40-7b5d-4e7b-a4ca-c8ed3eb20754","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_d0f58896_b535_451c_a462_71690d7d9c43","uuid":"16be48d6-6466-4a22-9e39-dbac04fd132b"},"name":"SYS_GEN__Runbook_Deployment_d0f58896_b535_451c_a462_71690d7d9c43"}},{"description":"System action for scalein","message_list":[],"uuid":"a9bdbc69-2775-4040-944a-313fb4d61d54","name":"action_scalein","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"retries":"0","description":"","type":"DAG","uuid":"894be5d3-0acc-409f-b350-96815022d40b","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scalein_d0f58896_b535_451c_a462_71690d7d9c43","uuid":"5030fed0-0782-4f02-8d5e-ace12cacd29a"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_d0f58896_b535_451c_a462_71690d7d9c43"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"retries":"0","description":"","type":"SCALING","uuid":"5030fed0-0782-4f02-8d5e-ace12cacd29a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scalein_d0f58896_b535_451c_a462_71690d7d9c43"}],"description":"","message_list":[],"uuid":"b2d3fad6-b8db-4573-b5de-66b0d67de06a","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"5a5742d9-e7dc-4c69-9944-38eb7b884d31","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_d0f58896_b535_451c_a462_71690d7d9c43","uuid":"894be5d3-0acc-409f-b350-96815022d40b"},"name":"SYS_GEN__Runbook_Deployment_d0f58896_b535_451c_a462_71690d7d9c43"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"5ca553f7-342d-4d04-87d0-23c990f1ef2c","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"retries":"0","description":"","type":"DAG","uuid":"6f880ced-1193-4f1c-833a-886d563803c0","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"6e9a640a-8af3-4203-ad7d-313fc83c1382"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"1dd10c0a-37bb-446a-b3d6-1b49b6f5f0fe"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"1b40e161-1637-4756-9c63-337c628c0f79"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_d0f58896_b535_451c_a462_71690d7d9c43","uuid":"887da6f9-d47e-42a2-b894-1c14bb472c4e"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"6e9a640a-8af3-4203-ad7d-313fc83c1382"},"edge_type":"inherent","type":"","uuid":"a9535ac6-398d-4804-bc52-c4610284d01d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"1dd10c0a-37bb-446a-b3d6-1b49b6f5f0fe"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"1b40e161-1637-4756-9c63-337c628c0f79"},"edge_type":"inherent","type":"","uuid":"4e1187ce-53dc-443a-ad2f-ee258ab9e2a5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_d0f58896_b535_451c_a462_71690d7d9c43","uuid":"887da6f9-d47e-42a2-b894-1c14bb472c4e"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"1dd10c0a-37bb-446a-b3d6-1b49b6f5f0fe"},"edge_type":"inherent","type":"","uuid":"1a38fa14-f9b2-4275-89ba-2c719d6b9562","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"1b40e161-1637-4756-9c63-337c628c0f79"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_d0f58896_b535_451c_a462_71690d7d9c43"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6e9a640a-8af3-4203-ad7d-313fc83c1382","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"2064d305-852a-47aa-89b9-7415f90c2152"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"1dd10c0a-37bb-446a-b3d6-1b49b6f5f0fe","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_6ab2b3c5_fdb8_4960_9757_2248632372d6"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1b40e161-1637-4756-9c63-337c628c0f79","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"fd0fdcc1-b9ed-40b1-ab58-b732cc2b4d28"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"887da6f9-d47e-42a2-b894-1c14bb472c4e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_d0f58896_b535_451c_a462_71690d7d9c43"}],"description":"","message_list":[],"uuid":"c7a4c04d-83b4-4333-80c7-ae676fb778b2","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_d0f58896_b535_451c_a462_71690d7d9c43","uuid":"6f880ced-1193-4f1c-833a-886d563803c0"},"name":"SYS_GEN__Runbook_Deployment_d0f58896_b535_451c_a462_71690d7d9c43"}}],"message_list":[],"published_service_local_reference_list":[],"uuid":"d0f58896-b535-451c-a462-71690d7d9c43","min_replicas":"3","state":"ACTIVE","max_replicas":"3","depends_on_list":[],"editables":{"min_replicas":true,"max_replicas":true},"package_local_reference_list":[{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"}],"substrate_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"type":"GREENFIELD","options":{},"variable_list":[],"name":"85fa2262_deployment"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"78d4274f-5729-43b4-88fd-7968545702c0","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"retries":"0","description":"","type":"DAG","uuid":"850f661e-6788-4ea0-a8f2-97dd7d147db3","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_72e86e92_9738_41e0_bad3_0fcf79e92c97","uuid":"7fd47bfc-cd69-4b03-8ada-5130faf16add"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"c0679c52-0404-4b09-9a12-4bfa7ffe2335"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"59d37392-c4be-44a8-a04c-d31665d482aa"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"bb48ec1e-3b08-4956-b4ab-500d966baee8"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"895e1a8d-61e1-4543-b9ee-691421747bfe"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"bb48ec1e-3b08-4956-b4ab-500d966baee8"},"edge_type":"inherent","type":"","uuid":"f4d118db-b7d1-43ef-aa35-8ecd3a3f97c3","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"895e1a8d-61e1-4543-b9ee-691421747bfe"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"59d37392-c4be-44a8-a04c-d31665d482aa"},"edge_type":"inherent","type":"","uuid":"ea79bb68-1371-45fd-bb85-6c1e7b96b331","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"bb48ec1e-3b08-4956-b4ab-500d966baee8"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_72e86e92_9738_41e0_bad3_0fcf79e92c97","uuid":"7fd47bfc-cd69-4b03-8ada-5130faf16add"},"edge_type":"inherent","type":"","uuid":"33f53ca7-a23e-4503-bec8-bb1ff99f18e2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"c0679c52-0404-4b09-9a12-4bfa7ffe2335"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"c0679c52-0404-4b09-9a12-4bfa7ffe2335"},"edge_type":"inherent","type":"","uuid":"e096ffb3-1c65-44b4-8173-df27a55b1f36","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"59d37392-c4be-44a8-a04c-d31665d482aa"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_72e86e92_9738_41e0_bad3_0fcf79e92c97"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"7fd47bfc-cd69-4b03-8ada-5130faf16add","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_72e86e92_9738_41e0_bad3_0fcf79e92c97"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c0679c52-0404-4b09-9a12-4bfa7ffe2335","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"54a68898-9143-4a38-8317-bc79057fe2be"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"59d37392-c4be-44a8-a04c-d31665d482aa","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"da8c44a9-1929-4f6e-82de-a739f5dae2ef"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"bb48ec1e-3b08-4956-b4ab-500d966baee8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"cca906a5-5e79-422e-b15f-7391a907ad07"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"895e1a8d-61e1-4543-b9ee-691421747bfe","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"e46ccff9-0398-47bf-852f-cfed63b8e13a","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_72e86e92_9738_41e0_bad3_0fcf79e92c97","uuid":"850f661e-6788-4ea0-a8f2-97dd7d147db3"},"name":"SYS_GEN__Runbook_Deployment_72e86e92_9738_41e0_bad3_0fcf79e92c97"}},{"description":"System action for starting an application","message_list":[],"uuid":"84b5b2ad-5f3c-4b9a-9759-c218ae4d1544","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"retries":"0","description":"","type":"DAG","uuid":"b54c786b-53e8-4776-8671-6719b810d85e","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"5dff493c-68e7-4bb2-93d9-f78888332d51"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"abc2bb61-5ea4-4cc2-8ffc-fd3220659e92"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"5dff493c-68e7-4bb2-93d9-f78888332d51"},"edge_type":"inherent","type":"","uuid":"c470b768-e59d-4bcf-8aaf-0af242cfd3ff","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"abc2bb61-5ea4-4cc2-8ffc-fd3220659e92"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_72e86e92_9738_41e0_bad3_0fcf79e92c97"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5dff493c-68e7-4bb2-93d9-f78888332d51","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"4b5cf38b-5720-413a-9f89-0ccfe6da8154"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"abc2bb61-5ea4-4cc2-8ffc-fd3220659e92","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"1cc41c58-2fd9-40b9-8f79-9ac806bb8641","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_72e86e92_9738_41e0_bad3_0fcf79e92c97","uuid":"b54c786b-53e8-4776-8671-6719b810d85e"},"name":"SYS_GEN__Runbook_Deployment_72e86e92_9738_41e0_bad3_0fcf79e92c97"}},{"description":"System action for restarting an application","message_list":[],"uuid":"9f2d7113-a139-48e1-8f58-93c558e02e21","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"retries":"0","description":"","type":"DAG","uuid":"24edc8e4-c249-4fad-a8cf-6cbaf0d8564b","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"4774188f-7106-4b0d-93a9-4ceb3361c126"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"ae48fe60-5e3d-4543-9f67-dc3fda733d13"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"4774188f-7106-4b0d-93a9-4ceb3361c126"},"edge_type":"inherent","type":"","uuid":"49580c5b-7a72-4471-9365-6c07094181e9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"ae48fe60-5e3d-4543-9f67-dc3fda733d13"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_72e86e92_9738_41e0_bad3_0fcf79e92c97"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4774188f-7106-4b0d-93a9-4ceb3361c126","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"74faa3cf-fc81-455c-9706-0a2a4f4231b3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ae48fe60-5e3d-4543-9f67-dc3fda733d13","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"ce602c49-d9cd-44d7-8e10-5671dc407b8b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"8b337a82-be9c-4ab6-8360-05b03f9410fe","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_72e86e92_9738_41e0_bad3_0fcf79e92c97","uuid":"24edc8e4-c249-4fad-a8cf-6cbaf0d8564b"},"name":"SYS_GEN__Runbook_Deployment_72e86e92_9738_41e0_bad3_0fcf79e92c97"}},{"description":"System action for stopping an application","message_list":[],"uuid":"e7560dab-96f7-42bf-9583-11e67848229e","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"retries":"0","description":"","type":"DAG","uuid":"69372fcf-fe79-4df9-be69-ee2545d2cf87","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"f0243767-7978-47cd-a411-3905d82b8ba0"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"31016f46-6189-49f5-9db3-77df207ede86"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"f0243767-7978-47cd-a411-3905d82b8ba0"},"edge_type":"inherent","type":"","uuid":"438939b9-2401-4931-a307-c90510347d14","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"31016f46-6189-49f5-9db3-77df207ede86"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_72e86e92_9738_41e0_bad3_0fcf79e92c97"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f0243767-7978-47cd-a411-3905d82b8ba0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"31016f46-6189-49f5-9db3-77df207ede86","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"7a3d22ff-8a4a-43c2-9eb2-07b0ffa96367"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b"}],"description":"","message_list":[],"uuid":"c37486d3-7d88-4f8b-9b97-c74f7c92c7d8","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_72e86e92_9738_41e0_bad3_0fcf79e92c97","uuid":"69372fcf-fe79-4df9-be69-ee2545d2cf87"},"name":"SYS_GEN__Runbook_Deployment_72e86e92_9738_41e0_bad3_0fcf79e92c97"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"cc76d16f-f323-44a6-92b8-4d0f6e40913c","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"retries":"0","description":"","type":"DAG","uuid":"356f3b72-b6da-495b-a86f-2bdd42840517","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"c59d8a5d-65e7-4e03-b10d-fb69c0696b07"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"eaede6dc-606c-4967-a884-97c207ffc49a"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"8f3796af-aa7b-4620-a707-d23d70cc31b7"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"38bc96fa-0ad6-4b30-911b-00cf4e704262"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_72e86e92_9738_41e0_bad3_0fcf79e92c97","uuid":"041711a2-c581-4a97-8c36-92ba3d47425e"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"c59d8a5d-65e7-4e03-b10d-fb69c0696b07"},"edge_type":"inherent","type":"","uuid":"5bd065b4-a7b6-4ca6-94f4-85c63af749a7","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"eaede6dc-606c-4967-a884-97c207ffc49a"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"eaede6dc-606c-4967-a884-97c207ffc49a"},"edge_type":"inherent","type":"","uuid":"1e17cf1f-3ee9-480d-828e-17bec6669a6a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"8f3796af-aa7b-4620-a707-d23d70cc31b7"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"38bc96fa-0ad6-4b30-911b-00cf4e704262"},"edge_type":"inherent","type":"","uuid":"698aa554-1ed7-4a1c-8a05-33e7ca46ba84","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_72e86e92_9738_41e0_bad3_0fcf79e92c97","uuid":"041711a2-c581-4a97-8c36-92ba3d47425e"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"8f3796af-aa7b-4620-a707-d23d70cc31b7"},"edge_type":"inherent","type":"","uuid":"00124a3d-6d22-48bf-99f1-83e96a43438b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"38bc96fa-0ad6-4b30-911b-00cf4e704262"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_72e86e92_9738_41e0_bad3_0fcf79e92c97"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c59d8a5d-65e7-4e03-b10d-fb69c0696b07","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"eaede6dc-606c-4967-a884-97c207ffc49a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"843ab0a6-03bd-4b9c-8f56-7d852e9348e0"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8f3796af-aa7b-4620-a707-d23d70cc31b7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"2e4a4165-353e-4d7f-9347-9be0943bfd07"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"38bc96fa-0ad6-4b30-911b-00cf4e704262","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"ebbab961-26f8-4dbf-a896-97ae805f7900"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"041711a2-c581-4a97-8c36-92ba3d47425e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_72e86e92_9738_41e0_bad3_0fcf79e92c97"}],"description":"","message_list":[],"uuid":"c1e05054-131d-4a2d-9108-4687e02737eb","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_72e86e92_9738_41e0_bad3_0fcf79e92c97","uuid":"356f3b72-b6da-495b-a86f-2bdd42840517"},"name":"SYS_GEN__Runbook_Deployment_72e86e92_9738_41e0_bad3_0fcf79e92c97"}},{"description":"System action for scaleout","message_list":[],"uuid":"316f9995-00eb-47b7-971f-8a9d7c4ef089","name":"action_scaleout","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"retries":"0","description":"","type":"DAG","uuid":"d0752c37-b0ef-41ed-b2f8-b2a7ad18fab7","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scaleout_72e86e92_9738_41e0_bad3_0fcf79e92c97","uuid":"b61f247a-d54c-479a-8784-9a1b2c667892"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_72e86e92_9738_41e0_bad3_0fcf79e92c97"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"retries":"0","description":"","type":"SCALING","uuid":"b61f247a-d54c-479a-8784-9a1b2c667892","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scaleout_72e86e92_9738_41e0_bad3_0fcf79e92c97"}],"description":"","message_list":[],"uuid":"d6ce4850-1852-475e-a787-77296df243fe","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"c0bb6d9e-a51c-4df0-b2f7-6272e7cd1fcc","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_72e86e92_9738_41e0_bad3_0fcf79e92c97","uuid":"d0752c37-b0ef-41ed-b2f8-b2a7ad18fab7"},"name":"SYS_GEN__Runbook_Deployment_72e86e92_9738_41e0_bad3_0fcf79e92c97"}},{"description":"System action for scalein","message_list":[],"uuid":"de3a315f-7bd4-48a0-ad66-c759eae81914","name":"action_scalein","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"retries":"0","description":"","type":"DAG","uuid":"665f01ce-8817-4ebc-ba57-f2462ece3220","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scalein_72e86e92_9738_41e0_bad3_0fcf79e92c97","uuid":"8f49a568-6d23-4bbf-867f-93412d53f061"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_72e86e92_9738_41e0_bad3_0fcf79e92c97"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"retries":"0","description":"","type":"SCALING","uuid":"8f49a568-6d23-4bbf-867f-93412d53f061","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scalein_72e86e92_9738_41e0_bad3_0fcf79e92c97"}],"description":"","message_list":[],"uuid":"39308ee3-5ad5-4425-b41b-789c4d12ea0e","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"a05c9a05-4915-4bd6-9f0f-4659967d2de0","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_72e86e92_9738_41e0_bad3_0fcf79e92c97","uuid":"665f01ce-8817-4ebc-ba57-f2462ece3220"},"name":"SYS_GEN__Runbook_Deployment_72e86e92_9738_41e0_bad3_0fcf79e92c97"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"8d0368be-da0c-4ea6-91e0-d9be4d3a3cdb","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"retries":"0","description":"","type":"DAG","uuid":"1a474737-9caa-4091-8a51-e1f21fb29571","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"21af7e9f-0549-4c8d-9dba-469bad14b6c1"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"37d0693f-023e-49ca-bbd5-10ab6aa04a3f"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"1706399a-ce52-4ce7-9f75-1143dc2707d3"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_72e86e92_9738_41e0_bad3_0fcf79e92c97","uuid":"3839d397-4504-449e-b112-fa7118f70648"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"21af7e9f-0549-4c8d-9dba-469bad14b6c1"},"edge_type":"inherent","type":"","uuid":"293aea66-f7ca-4555-ba70-e613e4a44b49","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"37d0693f-023e-49ca-bbd5-10ab6aa04a3f"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"37d0693f-023e-49ca-bbd5-10ab6aa04a3f"},"edge_type":"inherent","type":"","uuid":"9eccfc66-e27b-401e-92b7-a396d42cbc9b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"1706399a-ce52-4ce7-9f75-1143dc2707d3"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"1706399a-ce52-4ce7-9f75-1143dc2707d3"},"edge_type":"inherent","type":"","uuid":"556bdf06-2757-4ad4-a03a-096dba2feef7","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_72e86e92_9738_41e0_bad3_0fcf79e92c97","uuid":"3839d397-4504-449e-b112-fa7118f70648"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_72e86e92_9738_41e0_bad3_0fcf79e92c97"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"21af7e9f-0549-4c8d-9dba-469bad14b6c1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"716ea7a7-bc0c-4ac5-ab9c-720c327a498e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"37d0693f-023e-49ca-bbd5-10ab6aa04a3f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_9d79b4a5_8fba_4074_80e9_4e490e46c463"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1706399a-ce52-4ce7-9f75-1143dc2707d3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"d3966b00-3afe-4613-a490-54e6a8fdadb3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"3839d397-4504-449e-b112-fa7118f70648","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_72e86e92_9738_41e0_bad3_0fcf79e92c97"}],"description":"","message_list":[],"uuid":"00e92b7f-ed39-4809-aacb-5e97ccf05832","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_72e86e92_9738_41e0_bad3_0fcf79e92c97","uuid":"1a474737-9caa-4091-8a51-e1f21fb29571"},"name":"SYS_GEN__Runbook_Deployment_72e86e92_9738_41e0_bad3_0fcf79e92c97"}}],"message_list":[],"published_service_local_reference_list":[],"uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97","min_replicas":"3","state":"ACTIVE","max_replicas":"9","depends_on_list":[],"editables":{"min_replicas":true,"max_replicas":true},"package_local_reference_list":[{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"}],"substrate_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"type":"GREENFIELD","options":{},"variable_list":[],"name":"d6584f2e_deployment"}],"description":"","action_list":[{"description":"","message_list":[],"uuid":"7cda09ba-214d-43ea-b9e2-8efbe2e8e485","name":"Upgrade","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"2d64f4b3-5a29-40ba-b263-82f7fec0a1a2","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Version Master","uuid":"f6d4e79a-e7fb-4e99-9651-efd43e883d39"},{"kind":"app_task","name":"Set Version Worker","uuid":"36e20fe8-262f-4fe1-9719-ee99bd361eb7"},{"kind":"app_task","name":"Upgrade Worker","uuid":"fc8597e4-a24e-465a-8bef-0d4359b3c4b3"},{"kind":"app_task","name":"Upgrade Master","uuid":"b5295be0-9330-4b25-a319-ccf187c92698"},{"kind":"app_task","name":"Restart Services","uuid":"5137ab29-3750-4752-96de-be48c143d8b2"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"f6d4e79a-e7fb-4e99-9651-efd43e883d39"},"edge_type":"user_defined","type":"","uuid":"3d9910eb-a035-41b4-945b-59252d83d483","to_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"b5295be0-9330-4b25-a319-ccf187c92698"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"b5295be0-9330-4b25-a319-ccf187c92698"},"edge_type":"user_defined","type":"","uuid":"417895f5-3366-4b10-92b7-ece43412f27f","to_task_reference":{"kind":"app_task","name":"Restart Services","uuid":"5137ab29-3750-4752-96de-be48c143d8b2"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Worker","uuid":"36e20fe8-262f-4fe1-9719-ee99bd361eb7"},"edge_type":"user_defined","type":"","uuid":"6230fe0c-0935-4fc4-9553-01acfa7500fc","to_task_reference":{"kind":"app_task","name":"Upgrade Worker","uuid":"fc8597e4-a24e-465a-8bef-0d4359b3c4b3"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Worker","uuid":"fc8597e4-a24e-465a-8bef-0d4359b3c4b3"},"edge_type":"user_defined","type":"","uuid":"e9cc9f4f-4868-4633-b540-40cf840b34c1","to_task_reference":{"kind":"app_task","name":"Restart Services","uuid":"5137ab29-3750-4752-96de-be48c143d8b2"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"17adda9e_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"f6d4e79a-e7fb-4e99-9651-efd43e883d39","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Version Master"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"36e20fe8-262f-4fe1-9719-ee99bd361eb7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Version Worker"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"fc8597e4-a24e-465a-8bef-0d4359b3c4b3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=aws \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Upgrade Worker"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"b5295be0-9330-4b25-a319-ccf187c92698","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nCONTROLLER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=aws \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --cloud-provider=aws\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n\nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --cloud-provider=aws\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Upgrade Master"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"5137ab29-3750-4752-96de-be48c143d8b2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_NAMES=\"@@{calm_array_private_dns_name}@@\" \nWORKER_NAMES=\"@@{AWS_Centos_K8SW.private_dns_name}@@\" \nJSONPATH='{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}'\nKUBE_VERSION_NEW=\"@@{KUBE_VERSION_NEW}@@\"\nMASTER_API_HTTPS=6443\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION_NEW}\/bin\/linux\/amd64\/kubectl\nchmod +x kubectl\nsudo mv kubectl \/usr\/local\/bin\/kubectl\n\ncount=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n  echo \"Trying to reach master server https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} : sleep for 5 secs\"\n  sleep 10\n  if [[ $count -eq 10 ]]; then\n  \techo \"Unable to reach master server: https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\"\n  \texit 1\n  fi\n  count=$((count+1))\ndone\n\nfor name in $(echo \"${WORKER_NAMES}\" | tr \",\" \"\\n\"); do\n  #kubectl drain \"$name\" --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no $name \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 20\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=${name} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon $name\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n\techo \"Upgrade failed on minion nodes\"\n    exit 1\nfi\n\nfor name in $(echo \"${MASTER_NAMES}\" | tr \",\" \"\\n\"); do\n  #kubectl drain \"${name}\" --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no $name \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 20\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=$name -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon $name\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n\techo \"Upgrade failed on nodes: $(kubectl get nodes -o jsonpath='$JSONPATH' | grep 'Ready=Unknown')\"\n    exit 1\nfi"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Restart Services"}],"description":"","message_list":[],"uuid":"3be5f65e-36c5-4fa9-880e-0f0e28549370","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"ce94cfdc-536a-4566-bdad-e98e8d95c9e2","value":"v1.10.13","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_VERSION_NEW"}],"main_task_local_reference":{"kind":"app_task","name":"17adda9e_dag","uuid":"2d64f4b3-5a29-40ba-b263-82f7fec0a1a2"},"name":"dfce2dff_runbook"}},{"description":"","message_list":[],"uuid":"c345d056-f618-4983-acfe-49a13abf4536","name":"ScaleOut","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"295d0e36-9672-40e8-be38-7767973cd5ec","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Out","uuid":"f15c88bd-2d9e-47df-9eb5-a1f24353f95f"},{"kind":"app_task","name":"Set Hosts File","uuid":"f829587f-e4df-43da-af6e-5caea8fdbda0"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Scale Out","uuid":"f15c88bd-2d9e-47df-9eb5-a1f24353f95f"},"edge_type":"user_defined","type":"","uuid":"05449fc7-1f82-4732-aba9-28bb2ec9078e","to_task_reference":{"kind":"app_task","name":"Set Hosts File","uuid":"f829587f-e4df-43da-af6e-5caea8fdbda0"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"a0fb1ecf_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"retries":"0","description":"","type":"SCALING","uuid":"f15c88bd-2d9e-47df-9eb5-a1f24353f95f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Scale Out"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"f829587f-e4df-43da-af6e-5caea8fdbda0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nWORKER_IPS=\"@@{AWS_Centos_K8SM.private_ip_address}@@\"\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  if ! (( $(grep -c \"${ip} worker${count}\" \/etc\/hosts) )) ; then\n    echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  fi\n  count=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Hosts File"}],"description":"","message_list":[],"uuid":"52c5d06d-3b9a-40e7-9261-b2053f0848ae","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"19428ec1-a3b4-43a7-b4c5-652e3a5cdf89","value":"1","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"a0fb1ecf_dag","uuid":"295d0e36-9672-40e8-be38-7767973cd5ec"},"name":"55139b34_runbook"}},{"description":"","message_list":[],"uuid":"e9ea3ff6-3f7a-447f-b86e-dd8ef62e2bf2","name":"ScaleIn","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"943cd2c6-ab32-4ef2-9d26-1f55e22674b5","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale In","uuid":"0ff30ce9-2bc7-40a4-a2b6-aa0e340e04fa"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"adfef604_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"retries":"0","description":"","type":"SCALING","uuid":"0ff30ce9-2bc7-40a4-a2b6-aa0e340e04fa","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Scale In"}],"description":"","message_list":[],"uuid":"98130d2f-61a7-439b-94ef-f5a17947a60d","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"8f5c2148-20e4-43b8-aece-88cdeb123189","value":"1","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"adfef604_dag","uuid":"943cd2c6-ab32-4ef2-9d26-1f55e22674b5"},"name":"65df2c70_runbook"}},{"description":"System action for creating an application","message_list":[],"uuid":"5aeed84f-06b3-4e55-bea3-95c2eded3369","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"AWS","uuid":"a4c73681-f48b-4889-8dfe-532bf51506f9"},"retries":"0","description":"","type":"DAG","uuid":"2333c0da-b812-4a00-86b8-75dab84cce56","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_d0f58896_b535_451c_a462_71690d7d9c43","uuid":"3656afc3-a374-404e-8f54-5fa5d2a438e0"},{"kind":"app_task","name":"SYS_GEN__DE_Provision_72e86e92_9738_41e0_bad3_0fcf79e92c97","uuid":"f9a96d5d-6a9b-4a77-8b33-0efb7114819b"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"ed7bd60f-735b-44c7-a79e-8bc75f1dd3f0"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"76bcc1e9-ee07-462a-8e5f-8688f77da4a2"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"b56f26ee-5165-4ac2-b3cd-8340483c7daa"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"45b7e737-0b6b-4698-b85e-2bafa8f1b901"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"edfe302c-17c9-43db-80d2-dc4c2899b66a"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"39b7dd74-481a-4944-aa76-c7ac8f0a9e43"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"0cc5f6c4-a5d7-432e-af2c-f61262db9d7e"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"14f0e126-c2a3-4d1c-ad89-0e0f1896287e"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"39b7dd74-481a-4944-aa76-c7ac8f0a9e43"},"edge_type":"inherent","type":"","uuid":"4e2afdd3-b8e2-4a71-b6b2-fa87e0c74fb7","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"14f0e126-c2a3-4d1c-ad89-0e0f1896287e"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"b56f26ee-5165-4ac2-b3cd-8340483c7daa"},"edge_type":"inherent","type":"","uuid":"33ff5358-bb45-4ddb-a2fb-ab5f1a9d4a5c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"39b7dd74-481a-4944-aa76-c7ac8f0a9e43"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_72e86e92_9738_41e0_bad3_0fcf79e92c97","uuid":"f9a96d5d-6a9b-4a77-8b33-0efb7114819b"},"edge_type":"inherent","type":"","uuid":"ea8af22f-8239-4a74-8f7a-f8d743a6356d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"76bcc1e9-ee07-462a-8e5f-8688f77da4a2"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"76bcc1e9-ee07-462a-8e5f-8688f77da4a2"},"edge_type":"inherent","type":"","uuid":"a8e08d24-42b0-4d74-a874-9b6e6b1de1d5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"b56f26ee-5165-4ac2-b3cd-8340483c7daa"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"edfe302c-17c9-43db-80d2-dc4c2899b66a"},"edge_type":"inherent","type":"","uuid":"76c65cf4-5d81-47f4-9833-60f1a3519950","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"0cc5f6c4-a5d7-432e-af2c-f61262db9d7e"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"45b7e737-0b6b-4698-b85e-2bafa8f1b901"},"edge_type":"inherent","type":"","uuid":"36154de1-ff5d-4068-a4de-d2f9286f363e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"edfe302c-17c9-43db-80d2-dc4c2899b66a"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_d0f58896_b535_451c_a462_71690d7d9c43","uuid":"3656afc3-a374-404e-8f54-5fa5d2a438e0"},"edge_type":"inherent","type":"","uuid":"ca83d47e-cbe5-405e-85d4-3efefe72566a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"ed7bd60f-735b-44c7-a79e-8bc75f1dd3f0"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"ed7bd60f-735b-44c7-a79e-8bc75f1dd3f0"},"edge_type":"inherent","type":"","uuid":"3c213f58-81eb-4a4c-87ca-b09bea09e57c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"45b7e737-0b6b-4698-b85e-2bafa8f1b901"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"ed7bd60f-735b-44c7-a79e-8bc75f1dd3f0"},"edge_type":"dependency","type":"","uuid":"951c479e-c8b9-4b5d-ab37-a77f2a514924","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"b56f26ee-5165-4ac2-b3cd-8340483c7daa"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"76bcc1e9-ee07-462a-8e5f-8688f77da4a2"},"edge_type":"dependency","type":"","uuid":"1324616f-d518-41b0-b964-44f4fe58b1a8","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"45b7e737-0b6b-4698-b85e-2bafa8f1b901"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_a4c73681_f48b_4889_8dfe_532bf51506f9"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"3656afc3-a374-404e-8f54-5fa5d2a438e0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_d0f58896_b535_451c_a462_71690d7d9c43"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"f9a96d5d-6a9b-4a77-8b33-0efb7114819b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_72e86e92_9738_41e0_bad3_0fcf79e92c97"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ed7bd60f-735b-44c7-a79e-8bc75f1dd3f0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"b4e860cc-e5be-4f59-9702-04c83a3832cd"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"76bcc1e9-ee07-462a-8e5f-8688f77da4a2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"54a68898-9143-4a38-8317-bc79057fe2be"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b56f26ee-5165-4ac2-b3cd-8340483c7daa","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"da8c44a9-1929-4f6e-82de-a739f5dae2ef"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"45b7e737-0b6b-4698-b85e-2bafa8f1b901","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"4fa4a4af-ba4c-4bba-892d-02af5ec36e1a"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"edfe302c-17c9-43db-80d2-dc4c2899b66a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"384cf3d8-e940-43f1-a289-6c6b363c5371"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"39b7dd74-481a-4944-aa76-c7ac8f0a9e43","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"cca906a5-5e79-422e-b15f-7391a907ad07"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0cc5f6c4-a5d7-432e-af2c-f61262db9d7e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"14f0e126-c2a3-4d1c-ad89-0e0f1896287e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"b21477a8-c5f1-4df0-bdd5-ef618ccdd02c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_a4c73681_f48b_4889_8dfe_532bf51506f9","uuid":"2333c0da-b812-4a00-86b8-75dab84cce56"},"name":"SYS_GEN__Runbook_Application_a4c73681_f48b_4889_8dfe_532bf51506f9"}},{"description":"System action for starting an application","message_list":[],"uuid":"b52f2589-855e-457a-832e-ad002df53aa0","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"AWS","uuid":"a4c73681-f48b-4889-8dfe-532bf51506f9"},"retries":"0","description":"","type":"DAG","uuid":"abdf2b3f-7abb-4d12-880b-fd267245e58b","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"b3f6a05b-ee02-423d-9b11-5661b9ddf39d"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"d6150f91-f79c-4103-841f-85f7edaa151a"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"afb5565f-53e0-43ba-a6e9-7afd7bfb4c77"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"2fa17e6c-4b49-4699-a1f0-53ea4d277243"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"b3f6a05b-ee02-423d-9b11-5661b9ddf39d"},"edge_type":"inherent","type":"","uuid":"49a99bd1-aa5d-4b36-94bf-5209581b50f2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"2fa17e6c-4b49-4699-a1f0-53ea4d277243"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"d6150f91-f79c-4103-841f-85f7edaa151a"},"edge_type":"inherent","type":"","uuid":"25e991c1-0a1b-4e72-b7ea-dc802ebf2285","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"afb5565f-53e0-43ba-a6e9-7afd7bfb4c77"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_a4c73681_f48b_4889_8dfe_532bf51506f9"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b3f6a05b-ee02-423d-9b11-5661b9ddf39d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"4b5cf38b-5720-413a-9f89-0ccfe6da8154"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d6150f91-f79c-4103-841f-85f7edaa151a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"96911906-9050-4cbd-ad31-8ababc7046cd"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"afb5565f-53e0-43ba-a6e9-7afd7bfb4c77","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2fa17e6c-4b49-4699-a1f0-53ea4d277243","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"02ba2a03-28fe-49c9-8fb9-51cb305d11cf","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_a4c73681_f48b_4889_8dfe_532bf51506f9","uuid":"abdf2b3f-7abb-4d12-880b-fd267245e58b"},"name":"SYS_GEN__Runbook_Application_a4c73681_f48b_4889_8dfe_532bf51506f9"}},{"description":"System action for restarting an application","message_list":[],"uuid":"09325f06-dea6-4d61-ac1a-f569b80dd7b8","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"AWS","uuid":"a4c73681-f48b-4889-8dfe-532bf51506f9"},"retries":"0","description":"","type":"DAG","uuid":"c404f513-461c-4670-ba88-31c24a16c9d4","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"27fc87f8-a0e9-48da-a5fe-4f7c103b9ff2"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"f4d2d62c-4da0-4922-9dab-f4158679be0b"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"72e8161b-daa5-44d8-bcb4-3a96285cb0f2"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"db1ad695-63de-4474-8b24-7c2967bceb28"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"f4d2d62c-4da0-4922-9dab-f4158679be0b"},"edge_type":"inherent","type":"","uuid":"900f3597-fc54-438f-a0de-198657e62b72","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"db1ad695-63de-4474-8b24-7c2967bceb28"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"27fc87f8-a0e9-48da-a5fe-4f7c103b9ff2"},"edge_type":"inherent","type":"","uuid":"bc23f77e-af5c-450f-95cb-a199b048b140","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"72e8161b-daa5-44d8-bcb4-3a96285cb0f2"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_a4c73681_f48b_4889_8dfe_532bf51506f9"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"27fc87f8-a0e9-48da-a5fe-4f7c103b9ff2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"d9499ae4-9eea-4bb1-8a9c-aa97c693040c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f4d2d62c-4da0-4922-9dab-f4158679be0b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"74faa3cf-fc81-455c-9706-0a2a4f4231b3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"72e8161b-daa5-44d8-bcb4-3a96285cb0f2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"ca8cec47-f6e6-4ffb-83f1-eb67ddbb98e2"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"db1ad695-63de-4474-8b24-7c2967bceb28","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"ce602c49-d9cd-44d7-8e10-5671dc407b8b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"7d42ead7-6524-4162-88b9-a19552c255c9","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_a4c73681_f48b_4889_8dfe_532bf51506f9","uuid":"c404f513-461c-4670-ba88-31c24a16c9d4"},"name":"SYS_GEN__Runbook_Application_a4c73681_f48b_4889_8dfe_532bf51506f9"}},{"description":"System action for stopping an application","message_list":[],"uuid":"ea22f66a-1b83-4bf1-8769-285a03b0f0d7","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"AWS","uuid":"a4c73681-f48b-4889-8dfe-532bf51506f9"},"retries":"0","description":"","type":"DAG","uuid":"52761eca-99ec-4b9b-b640-43343c1daee9","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"8cc5e535-bcf6-49e5-814d-ead1a2a89653"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"75707ed1-ff27-4585-a751-0f5557f3f7f6"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"0f3c8760-f637-44d7-bfbd-868e31ff5077"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"1fa74777-7f06-4a8d-9890-299a7a37834f"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"75707ed1-ff27-4585-a751-0f5557f3f7f6"},"edge_type":"inherent","type":"","uuid":"5ddcb8f6-6cbc-41d8-abe2-37b677d52db1","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"1fa74777-7f06-4a8d-9890-299a7a37834f"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"8cc5e535-bcf6-49e5-814d-ead1a2a89653"},"edge_type":"inherent","type":"","uuid":"42d355d1-3cdc-41bf-b7ca-d84af8d192db","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"0f3c8760-f637-44d7-bfbd-868e31ff5077"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_a4c73681_f48b_4889_8dfe_532bf51506f9"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8cc5e535-bcf6-49e5-814d-ead1a2a89653","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"75707ed1-ff27-4585-a751-0f5557f3f7f6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0f3c8760-f637-44d7-bfbd-868e31ff5077","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"6edeaf33-7e8b-4726-a1fa-5114bb4a850d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1fa74777-7f06-4a8d-9890-299a7a37834f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"7a3d22ff-8a4a-43c2-9eb2-07b0ffa96367"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b"}],"description":"","message_list":[],"uuid":"36e1fa12-93dc-412e-9a9c-eae3bd96c49f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_a4c73681_f48b_4889_8dfe_532bf51506f9","uuid":"52761eca-99ec-4b9b-b640-43343c1daee9"},"name":"SYS_GEN__Runbook_Application_a4c73681_f48b_4889_8dfe_532bf51506f9"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"74a6128f-4753-4f71-9787-76b6025f3380","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"AWS","uuid":"a4c73681-f48b-4889-8dfe-532bf51506f9"},"retries":"0","description":"","type":"DAG","uuid":"9e22008c-6ef6-4b54-bf40-395d58302176","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"c4cb1230-13b3-4a37-a7bd-8e830e7f4944"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"c360faf9-ce6e-4f32-b1c7-c3508dfdb3e7"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"3a99f32a-fadf-4eca-9510-7f73895b2f6b"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"8ff708ee-f656-4bba-ae53-54a5836711d3"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"a78bb94a-dde4-4c67-953f-fbb7826444d0"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"1418fef0-992b-43b1-9272-fa37cfae3a60"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"0e8285f6-36b0-4354-b561-68128f0eb7b0"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"a139d7cf-d972-485d-a94d-60214d9bf3f1"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_72e86e92_9738_41e0_bad3_0fcf79e92c97","uuid":"7e06b299-26e6-4f3e-a414-863e2b66a232"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_d0f58896_b535_451c_a462_71690d7d9c43","uuid":"10cdb8af-4481-4be7-9633-1fcfcb7977ae"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"c4cb1230-13b3-4a37-a7bd-8e830e7f4944"},"edge_type":"inherent","type":"","uuid":"a9f8c36f-c4bd-41a6-89e1-40501b35e65c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"3a99f32a-fadf-4eca-9510-7f73895b2f6b"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"3a99f32a-fadf-4eca-9510-7f73895b2f6b"},"edge_type":"inherent","type":"","uuid":"aa9e44e2-5123-46b6-a724-831a3ec67ea6","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"a78bb94a-dde4-4c67-953f-fbb7826444d0"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"0e8285f6-36b0-4354-b561-68128f0eb7b0"},"edge_type":"inherent","type":"","uuid":"5d341ebb-15a5-4d6c-b95a-6cecbaa19548","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_72e86e92_9738_41e0_bad3_0fcf79e92c97","uuid":"7e06b299-26e6-4f3e-a414-863e2b66a232"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"a78bb94a-dde4-4c67-953f-fbb7826444d0"},"edge_type":"inherent","type":"","uuid":"59a032db-12fc-4571-9f75-206bc7c2a292","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"0e8285f6-36b0-4354-b561-68128f0eb7b0"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"c360faf9-ce6e-4f32-b1c7-c3508dfdb3e7"},"edge_type":"inherent","type":"","uuid":"dd4cf8ae-226f-4df8-9918-203f60476d71","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"8ff708ee-f656-4bba-ae53-54a5836711d3"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"8ff708ee-f656-4bba-ae53-54a5836711d3"},"edge_type":"inherent","type":"","uuid":"84f2600d-bc9f-41a8-8cb7-e6941a16ac38","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"1418fef0-992b-43b1-9272-fa37cfae3a60"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"a139d7cf-d972-485d-a94d-60214d9bf3f1"},"edge_type":"inherent","type":"","uuid":"94b4f58c-3a41-4c94-b00c-51e861bef4a3","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_d0f58896_b535_451c_a462_71690d7d9c43","uuid":"10cdb8af-4481-4be7-9633-1fcfcb7977ae"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"1418fef0-992b-43b1-9272-fa37cfae3a60"},"edge_type":"inherent","type":"","uuid":"cff570b1-982c-4648-9eca-8fffbad78629","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"a139d7cf-d972-485d-a94d-60214d9bf3f1"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"a78bb94a-dde4-4c67-953f-fbb7826444d0"},"edge_type":"create_action_edge","type":"","uuid":"d75342d0-7a3e-409f-bd0f-d27295384a6b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"a139d7cf-d972-485d-a94d-60214d9bf3f1"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"1418fef0-992b-43b1-9272-fa37cfae3a60"},"edge_type":"create_action_edge","type":"","uuid":"b0e64bac-c1d1-452b-82d0-db73fe43987d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"0e8285f6-36b0-4354-b561-68128f0eb7b0"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"8ff708ee-f656-4bba-ae53-54a5836711d3"},"edge_type":"dependency","type":"","uuid":"6b4cf3c3-bc11-4dfc-b31b-5e755d35d2c7","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"a78bb94a-dde4-4c67-953f-fbb7826444d0"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_a4c73681_f48b_4889_8dfe_532bf51506f9"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c4cb1230-13b3-4a37-a7bd-8e830e7f4944","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c360faf9-ce6e-4f32-b1c7-c3508dfdb3e7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3a99f32a-fadf-4eca-9510-7f73895b2f6b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"843ab0a6-03bd-4b9c-8f56-7d852e9348e0"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8ff708ee-f656-4bba-ae53-54a5836711d3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"7f713d48-74e9-4bb6-8dc9-eb8f00371ff3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a78bb94a-dde4-4c67-953f-fbb7826444d0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"2e4a4165-353e-4d7f-9347-9be0943bfd07"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1418fef0-992b-43b1-9272-fa37cfae3a60","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"f097bc74-7b35-4f8c-a995-5fa3e8d59774"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0e8285f6-36b0-4354-b561-68128f0eb7b0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"ebbab961-26f8-4dbf-a896-97ae805f7900"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a139d7cf-d972-485d-a94d-60214d9bf3f1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"ef5e502e-516c-40cf-b3c5-f903d96e4193"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"7e06b299-26e6-4f3e-a414-863e2b66a232","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_72e86e92_9738_41e0_bad3_0fcf79e92c97"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"10cdb8af-4481-4be7-9633-1fcfcb7977ae","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_d0f58896_b535_451c_a462_71690d7d9c43"}],"description":"","message_list":[],"uuid":"aa305c4f-6541-4ee6-8c88-0dc1e9ef800d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_a4c73681_f48b_4889_8dfe_532bf51506f9","uuid":"9e22008c-6ef6-4b54-bf40-395d58302176"},"name":"SYS_GEN__Runbook_Application_a4c73681_f48b_4889_8dfe_532bf51506f9"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"94cd32d4-58ce-47ab-9ba0-05475631b9ab","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"AWS","uuid":"a4c73681-f48b-4889-8dfe-532bf51506f9"},"retries":"0","description":"","type":"DAG","uuid":"504439b8-682a-4004-84b4-0b871a818fad","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"5f26fe53-3023-4b0b-a7dc-9e11c00fd2b1"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"dbc6950d-b461-4810-a03e-da8e143a204a"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"ba6c2643-a3b8-4086-b27f-51fc23cbcf73"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"7abb291e-2da7-4543-9cfa-262188dbdae0"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"54da7b0a-af1d-4075-9d42-b2a1a641822c"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"445c753c-2e70-42c2-aae0-428f98c6e472"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_d0f58896_b535_451c_a462_71690d7d9c43","uuid":"1313bd57-2c9b-4883-9f4d-ba0742c6985f"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_72e86e92_9738_41e0_bad3_0fcf79e92c97","uuid":"bb784c8f-c866-4906-8ae3-584249b857a2"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"dbc6950d-b461-4810-a03e-da8e143a204a"},"edge_type":"inherent","type":"","uuid":"cc0cd39e-9c48-4cd7-90b0-979a3e3419c0","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"7abb291e-2da7-4543-9cfa-262188dbdae0"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"7abb291e-2da7-4543-9cfa-262188dbdae0"},"edge_type":"inherent","type":"","uuid":"3121dec1-2ac3-48be-a25f-885c982dd388","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"445c753c-2e70-42c2-aae0-428f98c6e472"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"445c753c-2e70-42c2-aae0-428f98c6e472"},"edge_type":"inherent","type":"","uuid":"3a01557b-4441-479b-98b6-ef49b6ee925a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_72e86e92_9738_41e0_bad3_0fcf79e92c97","uuid":"bb784c8f-c866-4906-8ae3-584249b857a2"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"5f26fe53-3023-4b0b-a7dc-9e11c00fd2b1"},"edge_type":"inherent","type":"","uuid":"4782dbb2-b39b-4814-83b4-771373ee6af6","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"ba6c2643-a3b8-4086-b27f-51fc23cbcf73"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"54da7b0a-af1d-4075-9d42-b2a1a641822c"},"edge_type":"inherent","type":"","uuid":"60f215f6-0e0c-4588-bfe3-6b618463d229","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_d0f58896_b535_451c_a462_71690d7d9c43","uuid":"1313bd57-2c9b-4883-9f4d-ba0742c6985f"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"ba6c2643-a3b8-4086-b27f-51fc23cbcf73"},"edge_type":"inherent","type":"","uuid":"6cb5bad3-cf8a-4d2d-80f9-cdc0c1d24904","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"54da7b0a-af1d-4075-9d42-b2a1a641822c"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"7abb291e-2da7-4543-9cfa-262188dbdae0"},"edge_type":"create_action_edge","type":"","uuid":"79b36982-dc07-40a6-9fd9-d18ef6bc7c9e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"54da7b0a-af1d-4075-9d42-b2a1a641822c"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"ba6c2643-a3b8-4086-b27f-51fc23cbcf73"},"edge_type":"create_action_edge","type":"","uuid":"3282ad8e-7395-4bad-93c1-b666596dd025","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"445c753c-2e70-42c2-aae0-428f98c6e472"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_a4c73681_f48b_4889_8dfe_532bf51506f9"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5f26fe53-3023-4b0b-a7dc-9e11c00fd2b1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"2064d305-852a-47aa-89b9-7415f90c2152"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"dbc6950d-b461-4810-a03e-da8e143a204a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"716ea7a7-bc0c-4ac5-ab9c-720c327a498e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"ba6c2643-a3b8-4086-b27f-51fc23cbcf73","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_6ab2b3c5_fdb8_4960_9757_2248632372d6"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"7abb291e-2da7-4543-9cfa-262188dbdae0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_9d79b4a5_8fba_4074_80e9_4e490e46c463"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"54da7b0a-af1d-4075-9d42-b2a1a641822c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247","uuid":"fd0fdcc1-b9ed-40b1-ab58-b732cc2b4d28"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_2c077429_6628_4a1d_8153_776c6ecd4247"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"445c753c-2e70-42c2-aae0-428f98c6e472","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_190048e5_32e8_44b5_abe9_91374efc543b","uuid":"d3966b00-3afe-4613-a490-54e6a8fdadb3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_190048e5_32e8_44b5_abe9_91374efc543b"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"1313bd57-2c9b-4883-9f4d-ba0742c6985f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_d0f58896_b535_451c_a462_71690d7d9c43"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"bb784c8f-c866-4906-8ae3-584249b857a2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_72e86e92_9738_41e0_bad3_0fcf79e92c97"}],"description":"","message_list":[],"uuid":"0da00892-a19b-4748-ad99-a044bafabfef","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_a4c73681_f48b_4889_8dfe_532bf51506f9","uuid":"504439b8-682a-4004-84b4-0b871a818fad"},"name":"SYS_GEN__Runbook_Application_a4c73681_f48b_4889_8dfe_532bf51506f9"}}],"message_list":[],"uuid":"a4c73681-f48b-4889-8dfe-532bf51506f9","state":"ACTIVE","dependency_list":[{"getter_resource_kind":"PackageCfg","setter_resource_attr":"private_ip_address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"AWS_Centos_K8SM","action_name":"action_create","action_resource_name":"AWS","getter_resource_name":"AWS_Centos_K8SW_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"private_ip_address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"AWS_Centos_K8SW","action_name":"action_create","action_resource_name":"AWS","getter_resource_name":"AWS_Centos_K8SM_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"public_dns_name","setter_resource_kind":"SubstrateCfg","setter_resource_name":"AWS_Centos_K8SW","action_name":"action_create","action_resource_name":"AWS","getter_resource_name":"AWS_Centos_K8SM_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"private_dns_name","setter_resource_kind":"SubstrateCfg","setter_resource_name":"AWS_Centos_K8SW","action_name":"action_create","action_resource_name":"AWS","getter_resource_name":"AWS_Centos_K8SM_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"public_ip_address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"AWS_Centos_K8SW","action_name":"action_create","action_resource_name":"AWS","getter_resource_name":"AWS_Centos_K8SM_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"address","setter_resource_kind":"ServiceCfg","setter_resource_name":"Kubernetes_Master","action_name":"action_delete","action_resource_name":"AWS","getter_resource_name":"AWS_Centos_K8SW_Package","action_resource_kind":"ApplicationCfg"}],"variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"28055f7b-8ef0-4620-951b-c50a597bdad9","value":"aws-kubenetes-cluster","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_CLUSTER_NAME"},{"regex":{"should_validate":true,"value":"^v1\\.[0-9]?[0-9]\\.[0-9]?[0-9]$"},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"815b95b3-28e1-4250-b90b-07d3bcc41e0f","value":"v1.9.11","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_VERSION"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"0e439d74-ac24-469c-98e7-cf0dac220c3e","value":"17.03.3.ce","label":"","state":"ACTIVE","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{"type":"PREDEFINED","choices":["17.03.3.ce","17.06.2.ce","17.09.1.ce","17.12.1.ce","18.03.1.ce","18.06.3.ce"]},"name":"DOCKER_VERSION"},{"regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\\/\\d{1,2}$"},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"e58b7529-9dce-430b-a3ae-26962c2556de","value":"10.200.0.0\/16","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_CLUSTER_SUBNET"},{"regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\\/\\d{1,2}$"},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"524e9f26-0e50-409f-8357-0cf6db2eb73a","value":"10.32.0.0\/24","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_SERVICE_SUBNET"},{"regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$"},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"aa75d332-b847-437f-9fc8-7dd5cda5c41e","value":"10.32.0.10","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_DNS_IP"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"7a5cf072-8d4d-45db-a864-9daadaeb09ed","value":"flannel","label":"","state":"ACTIVE","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{"type":"PREDEFINED","choices":["flannel","canal","calico"]},"name":"KUBE_CNI_PLUGIN"}],"name":"AWS"},{"deployment_create_list":[{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"1b869f2c-1fa8-4130-82b1-20f83a5d4292","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"retries":"0","description":"","type":"DAG","uuid":"06d58d7c-5384-4d83-b5a4-a6f88e5e434b","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_41a81f4c_6289_4f56_aef8_b7f9003bb8fa","uuid":"ed9576a2-4060-41ee-adb4-c52a7b58b54c"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"f1cfc37b-deef-4910-a54b-ce99aac9b0a8"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"0f009c82-a3e7-4e57-b367-d496a1e31ed0"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"15b09401-e818-4447-9371-03ced1660982"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"f3cd367f-c9c7-4ed5-8c90-5f5e47e83132"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"15b09401-e818-4447-9371-03ced1660982"},"edge_type":"inherent","type":"","uuid":"ddb5c9e8-d98c-475d-91b0-f56b0988602b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"f3cd367f-c9c7-4ed5-8c90-5f5e47e83132"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"0f009c82-a3e7-4e57-b367-d496a1e31ed0"},"edge_type":"inherent","type":"","uuid":"1b2a1f77-6d61-4e5a-af19-34ec9b78301b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"15b09401-e818-4447-9371-03ced1660982"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_41a81f4c_6289_4f56_aef8_b7f9003bb8fa","uuid":"ed9576a2-4060-41ee-adb4-c52a7b58b54c"},"edge_type":"inherent","type":"","uuid":"6f766ad0-d50d-4f1f-9558-d318f8567b26","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"f1cfc37b-deef-4910-a54b-ce99aac9b0a8"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"f1cfc37b-deef-4910-a54b-ce99aac9b0a8"},"edge_type":"inherent","type":"","uuid":"28a4633e-ceed-4240-8604-1b4c82d1b08b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"0f009c82-a3e7-4e57-b367-d496a1e31ed0"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_41a81f4c_6289_4f56_aef8_b7f9003bb8fa"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"ed9576a2-4060-41ee-adb4-c52a7b58b54c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_41a81f4c_6289_4f56_aef8_b7f9003bb8fa"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f1cfc37b-deef-4910-a54b-ce99aac9b0a8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"880ea93e-b225-4a7c-a0a3-9b7fee60b57e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0f009c82-a3e7-4e57-b367-d496a1e31ed0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"06390bdf-bec5-439f-851c-d9bbd17ab64e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_0ad182b1_b1e7_476c_894c_8121c7440601"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"15b09401-e818-4447-9371-03ced1660982","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"384cf3d8-e940-43f1-a289-6c6b363c5371"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f3cd367f-c9c7-4ed5-8c90-5f5e47e83132","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"3e73fd2f-fbf8-4328-9e3f-900b7f5fa684","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_41a81f4c_6289_4f56_aef8_b7f9003bb8fa","uuid":"06d58d7c-5384-4d83-b5a4-a6f88e5e434b"},"name":"SYS_GEN__Runbook_Deployment_41a81f4c_6289_4f56_aef8_b7f9003bb8fa"}},{"description":"System action for starting an application","message_list":[],"uuid":"b98f956d-3123-4ae0-83ed-c11db0b08759","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"retries":"0","description":"","type":"DAG","uuid":"9fd59561-e307-4a08-a10f-c4b89d64115d","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"6c89f948-cf53-40b6-adb7-c44ad508d1d8"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"2baa246b-4826-4c71-a308-130b8e7f3b59"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"6c89f948-cf53-40b6-adb7-c44ad508d1d8"},"edge_type":"inherent","type":"","uuid":"31e96412-5302-4e34-b99c-9a6abde687b8","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"2baa246b-4826-4c71-a308-130b8e7f3b59"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_41a81f4c_6289_4f56_aef8_b7f9003bb8fa"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6c89f948-cf53-40b6-adb7-c44ad508d1d8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"dcd79a6f-3f26-4bae-a713-2e2afc1cf3a7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2baa246b-4826-4c71-a308-130b8e7f3b59","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"427cc0d5-a3cd-4ca2-90b5-37547d127dd2","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_41a81f4c_6289_4f56_aef8_b7f9003bb8fa","uuid":"9fd59561-e307-4a08-a10f-c4b89d64115d"},"name":"SYS_GEN__Runbook_Deployment_41a81f4c_6289_4f56_aef8_b7f9003bb8fa"}},{"description":"System action for restarting an application","message_list":[],"uuid":"a15cf77f-b963-4864-8cab-3a26859786fa","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"retries":"0","description":"","type":"DAG","uuid":"c49a6be5-2299-44fe-b25c-d032a490e86d","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"a587488c-6004-4c0e-a1ee-2b425adc5cd5"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"04d6240e-6872-408a-abc1-6997fd719ebf"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"a587488c-6004-4c0e-a1ee-2b425adc5cd5"},"edge_type":"inherent","type":"","uuid":"7bb31756-e91f-4aca-a526-5f285a5edfd8","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"04d6240e-6872-408a-abc1-6997fd719ebf"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_41a81f4c_6289_4f56_aef8_b7f9003bb8fa"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a587488c-6004-4c0e-a1ee-2b425adc5cd5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"c19288f6-e0d7-4a04-b697-ad707aa6ef83"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"04d6240e-6872-408a-abc1-6997fd719ebf","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"ca8cec47-f6e6-4ffb-83f1-eb67ddbb98e2"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"fe139e38-d5ba-4b1d-95b8-17c0e1ac6d7e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_41a81f4c_6289_4f56_aef8_b7f9003bb8fa","uuid":"c49a6be5-2299-44fe-b25c-d032a490e86d"},"name":"SYS_GEN__Runbook_Deployment_41a81f4c_6289_4f56_aef8_b7f9003bb8fa"}},{"description":"System action for stopping an application","message_list":[],"uuid":"7ba0c3a8-22e6-4b79-b311-b57b09af2b7f","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"retries":"0","description":"","type":"DAG","uuid":"a3251b40-3964-4178-95fa-d32c9791171d","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"5f468814-8eee-4732-a632-cc079fe40094"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"d7c991af-b7b1-4489-9659-fc5133532684"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"5f468814-8eee-4732-a632-cc079fe40094"},"edge_type":"inherent","type":"","uuid":"baee576c-5179-46ec-a1fb-ba7a2768e7b5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"d7c991af-b7b1-4489-9659-fc5133532684"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_41a81f4c_6289_4f56_aef8_b7f9003bb8fa"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5f468814-8eee-4732-a632-cc079fe40094","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d7c991af-b7b1-4489-9659-fc5133532684","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"fce4dd1e-7e76-4518-af76-a58dea5186f6"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"}],"description":"","message_list":[],"uuid":"311b5402-5e87-44c6-acc5-4d9c324af8bc","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_41a81f4c_6289_4f56_aef8_b7f9003bb8fa","uuid":"a3251b40-3964-4178-95fa-d32c9791171d"},"name":"SYS_GEN__Runbook_Deployment_41a81f4c_6289_4f56_aef8_b7f9003bb8fa"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"b7f63565-01aa-4231-a8b7-b353405dff5d","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"retries":"0","description":"","type":"DAG","uuid":"07512cbd-befb-4ea9-8f51-6fe7895304da","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"3bdbf835-4ca7-4c01-aa47-fecc664e864c"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"18ce102a-add7-45ae-8265-43eb1a44b731"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"9c9cf39a-d2bf-4507-871e-76c350da1698"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"a00ac668-ec16-41c0-953d-0581d18f6b1c"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_41a81f4c_6289_4f56_aef8_b7f9003bb8fa","uuid":"7b48cc53-2d0e-4636-b959-5423bd35669d"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"3bdbf835-4ca7-4c01-aa47-fecc664e864c"},"edge_type":"inherent","type":"","uuid":"32f02f37-de78-4278-b4ea-1ba52736e73c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"18ce102a-add7-45ae-8265-43eb1a44b731"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"18ce102a-add7-45ae-8265-43eb1a44b731"},"edge_type":"inherent","type":"","uuid":"012fcf6b-e62b-4a54-8bd9-da67177084dd","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"9c9cf39a-d2bf-4507-871e-76c350da1698"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"a00ac668-ec16-41c0-953d-0581d18f6b1c"},"edge_type":"inherent","type":"","uuid":"f075c789-d63b-4855-8f56-bd12f183e9aa","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_41a81f4c_6289_4f56_aef8_b7f9003bb8fa","uuid":"7b48cc53-2d0e-4636-b959-5423bd35669d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"9c9cf39a-d2bf-4507-871e-76c350da1698"},"edge_type":"inherent","type":"","uuid":"fe134dd0-6dce-4e9c-babb-4cc44e9540e3","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"a00ac668-ec16-41c0-953d-0581d18f6b1c"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_41a81f4c_6289_4f56_aef8_b7f9003bb8fa"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3bdbf835-4ca7-4c01-aa47-fecc664e864c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"18ce102a-add7-45ae-8265-43eb1a44b731","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"7f713d48-74e9-4bb6-8dc9-eb8f00371ff3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"9c9cf39a-d2bf-4507-871e-76c350da1698","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"79773e8b-084a-43f6-9e69-8f811fe0d528"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_0ad182b1_b1e7_476c_894c_8121c7440601"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a00ac668-ec16-41c0-953d-0581d18f6b1c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"b394f7c2-b79e-433e-8e73-305836500cbe"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"7b48cc53-2d0e-4636-b959-5423bd35669d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_41a81f4c_6289_4f56_aef8_b7f9003bb8fa"}],"description":"","message_list":[],"uuid":"c3ab9e36-ba80-4d66-a183-fa2f5ab2002b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_41a81f4c_6289_4f56_aef8_b7f9003bb8fa","uuid":"07512cbd-befb-4ea9-8f51-6fe7895304da"},"name":"SYS_GEN__Runbook_Deployment_41a81f4c_6289_4f56_aef8_b7f9003bb8fa"}},{"description":"System action for scaleout","message_list":[],"uuid":"f2807051-3206-4e8b-846a-cf3f4b75359a","name":"action_scaleout","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"retries":"0","description":"","type":"DAG","uuid":"faca0d93-6ce4-4b19-abf5-f4b96b720201","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scaleout_41a81f4c_6289_4f56_aef8_b7f9003bb8fa","uuid":"2f0cdff2-d374-4200-a936-9f6b91681cf6"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_41a81f4c_6289_4f56_aef8_b7f9003bb8fa"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"retries":"0","description":"","type":"SCALING","uuid":"2f0cdff2-d374-4200-a936-9f6b91681cf6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scaleout_41a81f4c_6289_4f56_aef8_b7f9003bb8fa"}],"description":"","message_list":[],"uuid":"f92ef2d1-42e7-44fd-bec4-a9752594558e","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"e4179cbb-a8ac-41f8-9bd9-c13cbe41303e","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_41a81f4c_6289_4f56_aef8_b7f9003bb8fa","uuid":"faca0d93-6ce4-4b19-abf5-f4b96b720201"},"name":"SYS_GEN__Runbook_Deployment_41a81f4c_6289_4f56_aef8_b7f9003bb8fa"}},{"description":"System action for scalein","message_list":[],"uuid":"7e460b19-2aa8-45eb-a590-41732b980c7c","name":"action_scalein","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"retries":"0","description":"","type":"DAG","uuid":"7acffef2-0960-457a-b710-7246fed0ac2c","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scalein_41a81f4c_6289_4f56_aef8_b7f9003bb8fa","uuid":"95829023-3553-4a52-80d1-13bb46e7b09c"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_41a81f4c_6289_4f56_aef8_b7f9003bb8fa"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"retries":"0","description":"","type":"SCALING","uuid":"95829023-3553-4a52-80d1-13bb46e7b09c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scalein_41a81f4c_6289_4f56_aef8_b7f9003bb8fa"}],"description":"","message_list":[],"uuid":"f47f33c0-6517-4741-b4b2-7ae344766a84","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"0ff04f54-a584-419d-b7ad-2bbf713484b9","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_41a81f4c_6289_4f56_aef8_b7f9003bb8fa","uuid":"7acffef2-0960-457a-b710-7246fed0ac2c"},"name":"SYS_GEN__Runbook_Deployment_41a81f4c_6289_4f56_aef8_b7f9003bb8fa"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"57eccdc8-ede2-4d6d-a234-84e4f82ba0c9","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"retries":"0","description":"","type":"DAG","uuid":"c52e807f-8967-4d28-b543-6ae4606ac036","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"60aa1dc8-ccbd-4812-8f77-e7e668aee006"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"db52b107-5d16-4d9d-9b89-c206a55e4a74"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"ed150729-096c-45eb-90d5-aea09c80970c"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_41a81f4c_6289_4f56_aef8_b7f9003bb8fa","uuid":"2eb8be28-7c65-443f-9350-b5c0112dc013"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"60aa1dc8-ccbd-4812-8f77-e7e668aee006"},"edge_type":"inherent","type":"","uuid":"916a7034-70f2-4f27-9ee0-0337e08b815c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"db52b107-5d16-4d9d-9b89-c206a55e4a74"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"ed150729-096c-45eb-90d5-aea09c80970c"},"edge_type":"inherent","type":"","uuid":"8e77d56c-7675-49c6-8092-4fe37f2d4dd2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_41a81f4c_6289_4f56_aef8_b7f9003bb8fa","uuid":"2eb8be28-7c65-443f-9350-b5c0112dc013"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"db52b107-5d16-4d9d-9b89-c206a55e4a74"},"edge_type":"inherent","type":"","uuid":"c89a8085-aad7-4dab-bd17-50347894f554","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"ed150729-096c-45eb-90d5-aea09c80970c"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_41a81f4c_6289_4f56_aef8_b7f9003bb8fa"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"60aa1dc8-ccbd-4812-8f77-e7e668aee006","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"2064d305-852a-47aa-89b9-7415f90c2152"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"db52b107-5d16-4d9d-9b89-c206a55e4a74","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_0ad182b1_b1e7_476c_894c_8121c7440601"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ed150729-096c-45eb-90d5-aea09c80970c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"63354784-367f-47cd-94cd-a6d6ad8f3be6"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"2eb8be28-7c65-443f-9350-b5c0112dc013","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_41a81f4c_6289_4f56_aef8_b7f9003bb8fa"}],"description":"","message_list":[],"uuid":"0079ea2f-f913-49cc-88e2-7404e0c44d47","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_41a81f4c_6289_4f56_aef8_b7f9003bb8fa","uuid":"c52e807f-8967-4d28-b543-6ae4606ac036"},"name":"SYS_GEN__Runbook_Deployment_41a81f4c_6289_4f56_aef8_b7f9003bb8fa"}}],"message_list":[],"published_service_local_reference_list":[],"uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa","min_replicas":"3","state":"ACTIVE","max_replicas":"3","depends_on_list":[],"editables":{"min_replicas":true,"max_replicas":true},"package_local_reference_list":[{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"}],"substrate_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"type":"GREENFIELD","options":{},"variable_list":[],"name":"34875daf_deployment"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"a39d6e3b-84ad-4afd-a36c-af6a8a601475","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"retries":"0","description":"","type":"DAG","uuid":"984da594-ea47-4d2a-9aba-28fed243dbb7","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_78e07ffd_9c25_4005_aba0_444053ecbcd7","uuid":"1b009bca-098e-4731-9aba-abdbd5ea5afe"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"fb4578e8-9451-4166-bd4b-3446ad688c9d"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"cc838372-e550-4a7e-8f20-41943d1220fc"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"3128f9e4-94cf-41a9-ae35-dd34b8ba4549"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"105773ff-49bb-466a-a594-e8f720f3f7d4"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"3128f9e4-94cf-41a9-ae35-dd34b8ba4549"},"edge_type":"inherent","type":"","uuid":"fef35651-96b1-4a83-b0cc-706f60d4e9ce","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"105773ff-49bb-466a-a594-e8f720f3f7d4"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"cc838372-e550-4a7e-8f20-41943d1220fc"},"edge_type":"inherent","type":"","uuid":"57f01c7e-c739-4781-ad56-62ed662afed7","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"3128f9e4-94cf-41a9-ae35-dd34b8ba4549"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_78e07ffd_9c25_4005_aba0_444053ecbcd7","uuid":"1b009bca-098e-4731-9aba-abdbd5ea5afe"},"edge_type":"inherent","type":"","uuid":"268f40be-3436-4f79-99d1-d0d253f2e5ec","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"fb4578e8-9451-4166-bd4b-3446ad688c9d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"fb4578e8-9451-4166-bd4b-3446ad688c9d"},"edge_type":"inherent","type":"","uuid":"50a9bd84-f666-4b15-9c4a-800eddec4e2e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"cc838372-e550-4a7e-8f20-41943d1220fc"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_78e07ffd_9c25_4005_aba0_444053ecbcd7"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"1b009bca-098e-4731-9aba-abdbd5ea5afe","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_78e07ffd_9c25_4005_aba0_444053ecbcd7"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"fb4578e8-9451-4166-bd4b-3446ad688c9d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"6964e301-bd60-4861-90d7-5c2afcf2c4ef"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"cc838372-e550-4a7e-8f20-41943d1220fc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"c44cbeaa-7ac9-414b-9e51-9c8a4af2f9b1"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3128f9e4-94cf-41a9-ae35-dd34b8ba4549","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"cca906a5-5e79-422e-b15f-7391a907ad07"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"105773ff-49bb-466a-a594-e8f720f3f7d4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"a7ee34c5-6662-4dd8-b6bb-87902b13fb0c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_78e07ffd_9c25_4005_aba0_444053ecbcd7","uuid":"984da594-ea47-4d2a-9aba-28fed243dbb7"},"name":"SYS_GEN__Runbook_Deployment_78e07ffd_9c25_4005_aba0_444053ecbcd7"}},{"description":"System action for starting an application","message_list":[],"uuid":"d8516166-3d0e-4007-a519-9e30275c048b","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"retries":"0","description":"","type":"DAG","uuid":"07f79552-1bb8-467e-9e59-27009a553370","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"4a0e0159-9269-49f8-8797-db0a105d13ec"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"576f67c3-9fb3-4b1c-9342-c3e1ebbc7f0c"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"4a0e0159-9269-49f8-8797-db0a105d13ec"},"edge_type":"inherent","type":"","uuid":"b3054662-bf1b-430e-9841-9bf9cf062f7f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"576f67c3-9fb3-4b1c-9342-c3e1ebbc7f0c"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_78e07ffd_9c25_4005_aba0_444053ecbcd7"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4a0e0159-9269-49f8-8797-db0a105d13ec","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"6c7fc381-c137-4c63-94e6-b206b9c149a5"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"576f67c3-9fb3-4b1c-9342-c3e1ebbc7f0c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"55a66299-254e-4ff1-88ad-86cf281d9242","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_78e07ffd_9c25_4005_aba0_444053ecbcd7","uuid":"07f79552-1bb8-467e-9e59-27009a553370"},"name":"SYS_GEN__Runbook_Deployment_78e07ffd_9c25_4005_aba0_444053ecbcd7"}},{"description":"System action for restarting an application","message_list":[],"uuid":"5148f953-3516-4235-aced-22a8538d066a","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"retries":"0","description":"","type":"DAG","uuid":"779576b8-0abd-4fb4-ad9c-54887e5a86e9","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"db402d71-d88a-46d2-957f-e1ccbbb64019"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"38fbc26f-657f-4412-8434-56fecfcb9781"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"db402d71-d88a-46d2-957f-e1ccbbb64019"},"edge_type":"inherent","type":"","uuid":"ec3e48af-f0fa-4327-86a9-68042d948821","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"38fbc26f-657f-4412-8434-56fecfcb9781"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_78e07ffd_9c25_4005_aba0_444053ecbcd7"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"db402d71-d88a-46d2-957f-e1ccbbb64019","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"d7bf312a-bf6e-4666-9d5b-21b2f328a9a6"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"38fbc26f-657f-4412-8434-56fecfcb9781","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"ce602c49-d9cd-44d7-8e10-5671dc407b8b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"d71f31d2-be4b-4c29-9162-95ad2f966073","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_78e07ffd_9c25_4005_aba0_444053ecbcd7","uuid":"779576b8-0abd-4fb4-ad9c-54887e5a86e9"},"name":"SYS_GEN__Runbook_Deployment_78e07ffd_9c25_4005_aba0_444053ecbcd7"}},{"description":"System action for stopping an application","message_list":[],"uuid":"9f567e10-d7b3-4317-a863-2bee6ef84dd0","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"retries":"0","description":"","type":"DAG","uuid":"1a5bd663-39b2-4261-b1f0-bd9fdffa93ab","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"774b76c7-6c00-48a8-870f-79db09387d4c"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"9b11f64d-8342-4462-986a-e84e08ca399f"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"774b76c7-6c00-48a8-870f-79db09387d4c"},"edge_type":"inherent","type":"","uuid":"15bf4e29-2f44-45dc-9ad1-16fe0e385dca","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"9b11f64d-8342-4462-986a-e84e08ca399f"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_78e07ffd_9c25_4005_aba0_444053ecbcd7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"774b76c7-6c00-48a8-870f-79db09387d4c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"9b11f64d-8342-4462-986a-e84e08ca399f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"1c203a4e-da24-4f1d-a059-709d069374ec"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab"}],"description":"","message_list":[],"uuid":"c1c206c5-3484-4d98-ae39-90c27ec6f45c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_78e07ffd_9c25_4005_aba0_444053ecbcd7","uuid":"1a5bd663-39b2-4261-b1f0-bd9fdffa93ab"},"name":"SYS_GEN__Runbook_Deployment_78e07ffd_9c25_4005_aba0_444053ecbcd7"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"741d1092-6a74-47cb-a5ce-0e14ca0c2bef","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"retries":"0","description":"","type":"DAG","uuid":"a59c3b78-333f-44ea-bc10-34232d657256","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"cd8ed537-5e99-43fb-bd43-b10c96c676b2"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"49956fe9-c97d-4280-9491-e3d05541b8ad"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"d64891aa-98a2-4e04-af15-79e2c69ec4b7"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"163d3fc3-3972-4668-8d1f-e429a0680a4d"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_78e07ffd_9c25_4005_aba0_444053ecbcd7","uuid":"e5a374e5-d906-4fb2-8a9e-cd0bf66a7cf5"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"cd8ed537-5e99-43fb-bd43-b10c96c676b2"},"edge_type":"inherent","type":"","uuid":"1a5412de-0630-412b-ad66-d580677a6eb8","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"49956fe9-c97d-4280-9491-e3d05541b8ad"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"49956fe9-c97d-4280-9491-e3d05541b8ad"},"edge_type":"inherent","type":"","uuid":"e7f198fc-7632-4efa-a4c9-907a98532cd3","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"d64891aa-98a2-4e04-af15-79e2c69ec4b7"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"163d3fc3-3972-4668-8d1f-e429a0680a4d"},"edge_type":"inherent","type":"","uuid":"4af56239-eb8f-45cc-b8e4-e14b071215ac","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_78e07ffd_9c25_4005_aba0_444053ecbcd7","uuid":"e5a374e5-d906-4fb2-8a9e-cd0bf66a7cf5"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"d64891aa-98a2-4e04-af15-79e2c69ec4b7"},"edge_type":"inherent","type":"","uuid":"cdd23416-d11f-4224-9bc9-2da43d5064b6","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"163d3fc3-3972-4668-8d1f-e429a0680a4d"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_78e07ffd_9c25_4005_aba0_444053ecbcd7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"cd8ed537-5e99-43fb-bd43-b10c96c676b2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"49956fe9-c97d-4280-9491-e3d05541b8ad","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"843ab0a6-03bd-4b9c-8f56-7d852e9348e0"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d64891aa-98a2-4e04-af15-79e2c69ec4b7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"de38f3ce-27a5-466d-91be-6037e2a4c86e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"163d3fc3-3972-4668-8d1f-e429a0680a4d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"2d42e962-1021-4baf-bed6-0a9174384d5d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"e5a374e5-d906-4fb2-8a9e-cd0bf66a7cf5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_78e07ffd_9c25_4005_aba0_444053ecbcd7"}],"description":"","message_list":[],"uuid":"f472a320-4416-4844-a81d-372dd03d62da","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_78e07ffd_9c25_4005_aba0_444053ecbcd7","uuid":"a59c3b78-333f-44ea-bc10-34232d657256"},"name":"SYS_GEN__Runbook_Deployment_78e07ffd_9c25_4005_aba0_444053ecbcd7"}},{"description":"System action for scaleout","message_list":[],"uuid":"f8a7ad70-770f-4717-8846-6dcaf2ada60b","name":"action_scaleout","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"retries":"0","description":"","type":"DAG","uuid":"76c6e176-1cf5-4e38-a0f2-6d5f8d689e08","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scaleout_78e07ffd_9c25_4005_aba0_444053ecbcd7","uuid":"d707468d-4df0-4219-b090-48cab37dc58a"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_78e07ffd_9c25_4005_aba0_444053ecbcd7"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"retries":"0","description":"","type":"SCALING","uuid":"d707468d-4df0-4219-b090-48cab37dc58a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scaleout_78e07ffd_9c25_4005_aba0_444053ecbcd7"}],"description":"","message_list":[],"uuid":"505ee46f-5708-424b-a2b5-ea2c05fa9b0a","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"b4606743-6046-4b61-befb-7258aaabda46","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_78e07ffd_9c25_4005_aba0_444053ecbcd7","uuid":"76c6e176-1cf5-4e38-a0f2-6d5f8d689e08"},"name":"SYS_GEN__Runbook_Deployment_78e07ffd_9c25_4005_aba0_444053ecbcd7"}},{"description":"System action for scalein","message_list":[],"uuid":"ec1315cb-a03e-4ad3-aaee-1e6a7327d4fa","name":"action_scalein","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"retries":"0","description":"","type":"DAG","uuid":"1c810f50-baf2-421a-9934-6c7de0bfc15c","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scalein_78e07ffd_9c25_4005_aba0_444053ecbcd7","uuid":"fd533346-0687-46b0-8218-aa01cce882c5"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_78e07ffd_9c25_4005_aba0_444053ecbcd7"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"retries":"0","description":"","type":"SCALING","uuid":"fd533346-0687-46b0-8218-aa01cce882c5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scalein_78e07ffd_9c25_4005_aba0_444053ecbcd7"}],"description":"","message_list":[],"uuid":"7fb0267c-13b0-4d6f-8d61-a5ee64e74a03","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"386f4e6f-b35d-4456-ac90-d40038ac15bc","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_78e07ffd_9c25_4005_aba0_444053ecbcd7","uuid":"1c810f50-baf2-421a-9934-6c7de0bfc15c"},"name":"SYS_GEN__Runbook_Deployment_78e07ffd_9c25_4005_aba0_444053ecbcd7"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"01f70e03-1398-46bf-9386-cc7ea7a0fe7c","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"retries":"0","description":"","type":"DAG","uuid":"f88e8f3f-20ab-4868-bb97-4577d428c48b","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"4bc564a3-2517-4b54-91fd-52f642ca8b44"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"e6afbb52-19f9-421e-af2d-4bb332fb7bd4"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"0f84c951-2ae8-4e79-a6aa-7d23d1337cb1"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_78e07ffd_9c25_4005_aba0_444053ecbcd7","uuid":"ba76a6a5-2c0b-4fff-b7c2-c721c5806416"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"4bc564a3-2517-4b54-91fd-52f642ca8b44"},"edge_type":"inherent","type":"","uuid":"5087564c-d0bd-49f7-8051-c138b8e6acb2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"e6afbb52-19f9-421e-af2d-4bb332fb7bd4"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"0f84c951-2ae8-4e79-a6aa-7d23d1337cb1"},"edge_type":"inherent","type":"","uuid":"7abb92ab-b25d-4506-a928-e78d7c2d9908","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_78e07ffd_9c25_4005_aba0_444053ecbcd7","uuid":"ba76a6a5-2c0b-4fff-b7c2-c721c5806416"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"e6afbb52-19f9-421e-af2d-4bb332fb7bd4"},"edge_type":"inherent","type":"","uuid":"d7e8c05f-4eef-471d-b509-a2fafa1ba4d0","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"0f84c951-2ae8-4e79-a6aa-7d23d1337cb1"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_78e07ffd_9c25_4005_aba0_444053ecbcd7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4bc564a3-2517-4b54-91fd-52f642ca8b44","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"716ea7a7-bc0c-4ac5-ab9c-720c327a498e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"e6afbb52-19f9-421e-af2d-4bb332fb7bd4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0f84c951-2ae8-4e79-a6aa-7d23d1337cb1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"c98634ce-1304-4350-a68d-676cd00041b7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"ba76a6a5-2c0b-4fff-b7c2-c721c5806416","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_78e07ffd_9c25_4005_aba0_444053ecbcd7"}],"description":"","message_list":[],"uuid":"ef11fe58-3068-4228-9efa-f526382533bd","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_78e07ffd_9c25_4005_aba0_444053ecbcd7","uuid":"f88e8f3f-20ab-4868-bb97-4577d428c48b"},"name":"SYS_GEN__Runbook_Deployment_78e07ffd_9c25_4005_aba0_444053ecbcd7"}}],"message_list":[],"published_service_local_reference_list":[],"uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7","min_replicas":"3","state":"ACTIVE","max_replicas":"9","depends_on_list":[],"editables":{"min_replicas":true,"max_replicas":true},"package_local_reference_list":[{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"}],"substrate_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"type":"GREENFIELD","options":{},"variable_list":[],"name":"77b729d5_deployment"}],"description":"","action_list":[{"description":"","message_list":[],"uuid":"a4e68551-86de-49ab-8271-ca59fd880d56","name":"Upgrade","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"6637ee0b-4435-4447-a45b-43c95dcbeb1a","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Version Master","uuid":"3e8012cf-3632-4be4-b4fb-9a357fc50d69"},{"kind":"app_task","name":"Set Version Worker","uuid":"a7d147bd-c7ce-4d0a-b93e-1e397e04ffb5"},{"kind":"app_task","name":"Upgrade Worker","uuid":"57d0630c-c7a2-425f-b4f0-d5717d3e6861"},{"kind":"app_task","name":"Upgrade Master","uuid":"1aba108d-dd2e-4d98-a956-c7360ebbbd30"},{"kind":"app_task","name":"Restart Services","uuid":"8894f79a-40bb-4a98-b27d-171d750eebcf"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"3e8012cf-3632-4be4-b4fb-9a357fc50d69"},"edge_type":"user_defined","type":"","uuid":"c1038158-7040-45ef-b0a7-8d162bf0abcf","to_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"1aba108d-dd2e-4d98-a956-c7360ebbbd30"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"1aba108d-dd2e-4d98-a956-c7360ebbbd30"},"edge_type":"user_defined","type":"","uuid":"d6b7e5df-edbe-4454-919a-d6601843b66c","to_task_reference":{"kind":"app_task","name":"Restart Services","uuid":"8894f79a-40bb-4a98-b27d-171d750eebcf"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Worker","uuid":"a7d147bd-c7ce-4d0a-b93e-1e397e04ffb5"},"edge_type":"user_defined","type":"","uuid":"59cc81be-110c-4fec-92bd-e30c821732aa","to_task_reference":{"kind":"app_task","name":"Upgrade Worker","uuid":"57d0630c-c7a2-425f-b4f0-d5717d3e6861"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Worker","uuid":"57d0630c-c7a2-425f-b4f0-d5717d3e6861"},"edge_type":"user_defined","type":"","uuid":"4fcda967-f38f-4bdc-9ad9-943235252ee2","to_task_reference":{"kind":"app_task","name":"Restart Services","uuid":"8894f79a-40bb-4a98-b27d-171d750eebcf"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"cbdb4fa8_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"3e8012cf-3632-4be4-b4fb-9a357fc50d69","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Version Master"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"a7d147bd-c7ce-4d0a-b93e-1e397e04ffb5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Version Worker"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"57d0630c-c7a2-425f-b4f0-d5717d3e6861","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=gce \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Upgrade Worker"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"1aba108d-dd2e-4d98-a956-c7360ebbbd30","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nMASTER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --cloud-provider=gce \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${MASTER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --cloud-provider=gce\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem  \n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --cloud-provider=gce\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Upgrade Master"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"8894f79a-40bb-4a98-b27d-171d750eebcf","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_NAMES=\"@@{calm_array_name}@@\" \nWORKER_NAMES=\"@@{GCP_Centos_K8SM.name}@@\" \nJSONPATH='{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}'\nKUBE_VERSION_NEW=\"@@{KUBE_VERSION_NEW}@@\"\nMASTER_API_HTTPS=6443\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION_NEW}\/bin\/linux\/amd64\/kubectl\nchmod +x kubectl\nsudo mv kubectl \/usr\/local\/bin\/kubectl\n\ncount=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n  echo \"Trying to reach master server https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} : sleep for 5 secs\"\n  sleep 10\n  if [[ $count -eq 10 ]]; then\n    echo \"Unable to reach master server: https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\"\n    exit 1\n  fi\n  count=$((count+1))\ndone\n\ncount=0\nfor name in $(echo \"${WORKER_NAMES}\" | tr \",\" \"\\n\"); do\n  #kubectl drain ${name} --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no \"worker${count}\" \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 20\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=${name} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon ${name}\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n  echo \"Upgrade failed on worker nodes\"\n    exit 1\nfi\n\ncount=0\nfor name in $(echo \"${MASTER_NAMES}\" | tr \",\" \"\\n\"); do\n  #kubectl drain $name --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no \"master${count}\" \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 20\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=$name -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon $name\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n  echo \"Upgrade failed on nodes: $(kubectl get nodes -o jsonpath='$JSONPATH' | grep 'Ready=Unknown')\"\n    exit 1\nfi"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Restart Services"}],"description":"","message_list":[],"uuid":"e78e5e7b-42d6-428c-a28b-e60dda0687c3","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"188d0974-333c-4b60-a111-f5103ddfc955","value":"v1.10.13","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_VERSION_NEW"}],"main_task_local_reference":{"kind":"app_task","name":"cbdb4fa8_dag","uuid":"6637ee0b-4435-4447-a45b-43c95dcbeb1a"},"name":"8d003d32_runbook"}},{"description":"","message_list":[],"uuid":"83b597b1-2aeb-4a6c-8705-5c27db1bc8c8","name":"ScaleOut","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"509a6d0d-c81b-4d95-9aae-236fda989f16","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Out","uuid":"df3bf615-23dd-475a-97d5-329676c291d1"},{"kind":"app_task","name":"Set Hosts File","uuid":"77ddcd09-75f1-4c24-ac35-f896a0735cfb"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Scale Out","uuid":"df3bf615-23dd-475a-97d5-329676c291d1"},"edge_type":"user_defined","type":"","uuid":"b32099f3-bee9-427a-99c1-cad37440563d","to_task_reference":{"kind":"app_task","name":"Set Hosts File","uuid":"77ddcd09-75f1-4c24-ac35-f896a0735cfb"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"f3682593_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"retries":"0","description":"","type":"SCALING","uuid":"df3bf615-23dd-475a-97d5-329676c291d1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Scale Out"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"77ddcd09-75f1-4c24-ac35-f896a0735cfb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nWORKER_IP=\"@@{GCP_Centos_K8SM.private_ip_address}@@\"\nfor ip in $(echo ${WORKER_IP} | tr \",\" \"\\n\"); do\n  if ! (( $(grep -c \"${ip} worker${count}\" \/etc\/hosts) )) ; then\n    echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  fi\n  count=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Hosts File"}],"description":"","message_list":[],"uuid":"31559a06-0af0-412f-9bff-1c7eb4b315ae","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"7d5d9272-a7dc-475a-bed8-0eec169a8a38","value":"1","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"f3682593_dag","uuid":"509a6d0d-c81b-4d95-9aae-236fda989f16"},"name":"744583cd_runbook"}},{"description":"","message_list":[],"uuid":"1ef8e495-de99-4003-bc0d-94d7b91e8b07","name":"ScaleIn","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"af79248d-510c-45b4-93c4-2890eeb56130","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale In","uuid":"1c80c7fc-23e2-4c89-acd0-28ee081f639c"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"853cb860_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"retries":"0","description":"","type":"SCALING","uuid":"1c80c7fc-23e2-4c89-acd0-28ee081f639c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Scale In"}],"description":"","message_list":[],"uuid":"85aebc49-2556-4dc3-a4ef-bcf97f67bad9","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"3c2b9b7f-1f1d-445b-a208-1ed32f801412","value":"1","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"853cb860_dag","uuid":"af79248d-510c-45b4-93c4-2890eeb56130"},"name":"9331a25f_runbook"}},{"description":"System action for creating an application","message_list":[],"uuid":"5f4c12e7-4a01-4a51-9404-22b482eb5d70","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"GCP","uuid":"234e6716-2347-4711-80e6-0525b24f6004"},"retries":"0","description":"","type":"DAG","uuid":"755f1464-75b8-494f-ac87-b4eca2140b36","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_78e07ffd_9c25_4005_aba0_444053ecbcd7","uuid":"19a2e87f-0e46-40dd-9e1e-1e8f285b22be"},{"kind":"app_task","name":"SYS_GEN__DE_Provision_41a81f4c_6289_4f56_aef8_b7f9003bb8fa","uuid":"c36163a4-a0dd-4b2f-bb1d-0fb0a027a458"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"a8f7c9ea-317d-4205-97df-be3eeb0f2651"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"4875779e-1fd5-4b8b-b61e-b3eddc53b750"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"3b5c3458-b0e1-486e-8050-67ad718b1623"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"0667094c-dcec-4c68-9c7f-386507c2a94f"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"cf9a5cc9-9345-459f-abf8-29aea2b32b37"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"f20534a6-a5fe-41f9-8734-9905c58af3c0"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"36fbfcc9-47ea-4888-bd17-6d6d401afc93"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"a01bfe6f-3cfe-4546-8f55-e2b0f16a4b78"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"cf9a5cc9-9345-459f-abf8-29aea2b32b37"},"edge_type":"inherent","type":"","uuid":"2f9705d2-121f-42d9-bf42-9457f63f20bb","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"36fbfcc9-47ea-4888-bd17-6d6d401afc93"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"0667094c-dcec-4c68-9c7f-386507c2a94f"},"edge_type":"inherent","type":"","uuid":"e6077da6-9ffc-43cc-a3b5-679f2fd647a0","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"cf9a5cc9-9345-459f-abf8-29aea2b32b37"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_41a81f4c_6289_4f56_aef8_b7f9003bb8fa","uuid":"c36163a4-a0dd-4b2f-bb1d-0fb0a027a458"},"edge_type":"inherent","type":"","uuid":"358f2d88-c923-407d-a8d7-0cceb4297336","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"a8f7c9ea-317d-4205-97df-be3eeb0f2651"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"a8f7c9ea-317d-4205-97df-be3eeb0f2651"},"edge_type":"inherent","type":"","uuid":"cec7febf-585a-42fc-a14e-5977061f2f00","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"0667094c-dcec-4c68-9c7f-386507c2a94f"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"f20534a6-a5fe-41f9-8734-9905c58af3c0"},"edge_type":"inherent","type":"","uuid":"f3d157da-8408-48b6-ba0e-35d2ebf3b8b6","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"a01bfe6f-3cfe-4546-8f55-e2b0f16a4b78"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"3b5c3458-b0e1-486e-8050-67ad718b1623"},"edge_type":"inherent","type":"","uuid":"75352bb4-da5a-4490-9f5f-575eac05d224","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"f20534a6-a5fe-41f9-8734-9905c58af3c0"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_78e07ffd_9c25_4005_aba0_444053ecbcd7","uuid":"19a2e87f-0e46-40dd-9e1e-1e8f285b22be"},"edge_type":"inherent","type":"","uuid":"be6e642f-27f7-4e06-a303-9954899c066a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"4875779e-1fd5-4b8b-b61e-b3eddc53b750"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"4875779e-1fd5-4b8b-b61e-b3eddc53b750"},"edge_type":"inherent","type":"","uuid":"e23c69be-1d33-47ed-be24-dff55be7c710","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"3b5c3458-b0e1-486e-8050-67ad718b1623"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"4875779e-1fd5-4b8b-b61e-b3eddc53b750"},"edge_type":"dependency","type":"","uuid":"7b9c441d-e5ab-4581-ac22-821592e464ba","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"0667094c-dcec-4c68-9c7f-386507c2a94f"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"a8f7c9ea-317d-4205-97df-be3eeb0f2651"},"edge_type":"dependency","type":"","uuid":"f1858122-0fa2-47e7-9411-128c4c821ba0","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"3b5c3458-b0e1-486e-8050-67ad718b1623"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_234e6716_2347_4711_80e6_0525b24f6004"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"19a2e87f-0e46-40dd-9e1e-1e8f285b22be","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_78e07ffd_9c25_4005_aba0_444053ecbcd7"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"c36163a4-a0dd-4b2f-bb1d-0fb0a027a458","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_41a81f4c_6289_4f56_aef8_b7f9003bb8fa"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a8f7c9ea-317d-4205-97df-be3eeb0f2651","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"880ea93e-b225-4a7c-a0a3-9b7fee60b57e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4875779e-1fd5-4b8b-b61e-b3eddc53b750","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"6964e301-bd60-4861-90d7-5c2afcf2c4ef"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3b5c3458-b0e1-486e-8050-67ad718b1623","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"c44cbeaa-7ac9-414b-9e51-9c8a4af2f9b1"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0667094c-dcec-4c68-9c7f-386507c2a94f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"06390bdf-bec5-439f-851c-d9bbd17ab64e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_0ad182b1_b1e7_476c_894c_8121c7440601"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"cf9a5cc9-9345-459f-abf8-29aea2b32b37","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"384cf3d8-e940-43f1-a289-6c6b363c5371"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f20534a6-a5fe-41f9-8734-9905c58af3c0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"cca906a5-5e79-422e-b15f-7391a907ad07"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"36fbfcc9-47ea-4888-bd17-6d6d401afc93","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a01bfe6f-3cfe-4546-8f55-e2b0f16a4b78","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"a9b07309-7c83-4bf7-aca1-c74969738bdc","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_234e6716_2347_4711_80e6_0525b24f6004","uuid":"755f1464-75b8-494f-ac87-b4eca2140b36"},"name":"SYS_GEN__Runbook_Application_234e6716_2347_4711_80e6_0525b24f6004"}},{"description":"System action for starting an application","message_list":[],"uuid":"bdd1adfe-5658-419c-a045-e69134859fd4","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"GCP","uuid":"234e6716-2347-4711-80e6-0525b24f6004"},"retries":"0","description":"","type":"DAG","uuid":"a7e0ffaa-f198-4624-b565-468c97dd7b7c","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"1ee3f45e-92d3-4673-a149-1544f6ed03c8"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"c0ce83bc-ef64-41ca-a33c-614da063246b"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"6298c096-6f39-492b-9979-861b07dfbb25"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"a8d17fe7-3041-41a3-9611-032c1712ee6c"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"1ee3f45e-92d3-4673-a149-1544f6ed03c8"},"edge_type":"inherent","type":"","uuid":"cbf3a16a-9e5d-4388-9be0-646dcf9a04ff","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"6298c096-6f39-492b-9979-861b07dfbb25"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"c0ce83bc-ef64-41ca-a33c-614da063246b"},"edge_type":"inherent","type":"","uuid":"5bf273e8-90c4-4109-bde0-94f85633c663","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"a8d17fe7-3041-41a3-9611-032c1712ee6c"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_234e6716_2347_4711_80e6_0525b24f6004"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1ee3f45e-92d3-4673-a149-1544f6ed03c8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"dcd79a6f-3f26-4bae-a713-2e2afc1cf3a7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c0ce83bc-ef64-41ca-a33c-614da063246b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"6c7fc381-c137-4c63-94e6-b206b9c149a5"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6298c096-6f39-492b-9979-861b07dfbb25","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a8d17fe7-3041-41a3-9611-032c1712ee6c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"bd4252fb-dd1a-4548-98c3-ab3498e9eb5f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_234e6716_2347_4711_80e6_0525b24f6004","uuid":"a7e0ffaa-f198-4624-b565-468c97dd7b7c"},"name":"SYS_GEN__Runbook_Application_234e6716_2347_4711_80e6_0525b24f6004"}},{"description":"System action for restarting an application","message_list":[],"uuid":"f4e0fe04-9d86-4eea-aae4-eae2ff2570bf","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"GCP","uuid":"234e6716-2347-4711-80e6-0525b24f6004"},"retries":"0","description":"","type":"DAG","uuid":"29efb506-508a-4046-93d4-0fdeff24b64a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"09cc76cc-5e6f-406e-855c-a2a6709502bc"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"d6b198c5-5321-4ede-8fd5-fbc0fd9c9250"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"7778e9fb-2560-4700-b0a4-bbaf50def374"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"6247f217-b0f6-4797-a541-5a13ed579e2e"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"09cc76cc-5e6f-406e-855c-a2a6709502bc"},"edge_type":"inherent","type":"","uuid":"c4903223-b82b-480c-850a-0f54813a8c4d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"7778e9fb-2560-4700-b0a4-bbaf50def374"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"d6b198c5-5321-4ede-8fd5-fbc0fd9c9250"},"edge_type":"inherent","type":"","uuid":"a3e2a0f6-bc94-46b3-ba79-bdd66af8a2f4","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"6247f217-b0f6-4797-a541-5a13ed579e2e"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_234e6716_2347_4711_80e6_0525b24f6004"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"09cc76cc-5e6f-406e-855c-a2a6709502bc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"c19288f6-e0d7-4a04-b697-ad707aa6ef83"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d6b198c5-5321-4ede-8fd5-fbc0fd9c9250","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"d7bf312a-bf6e-4666-9d5b-21b2f328a9a6"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"7778e9fb-2560-4700-b0a4-bbaf50def374","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"ca8cec47-f6e6-4ffb-83f1-eb67ddbb98e2"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6247f217-b0f6-4797-a541-5a13ed579e2e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"ce602c49-d9cd-44d7-8e10-5671dc407b8b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"d35dbf94-f609-4a0b-bcc1-5d00987e3ec0","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_234e6716_2347_4711_80e6_0525b24f6004","uuid":"29efb506-508a-4046-93d4-0fdeff24b64a"},"name":"SYS_GEN__Runbook_Application_234e6716_2347_4711_80e6_0525b24f6004"}},{"description":"System action for stopping an application","message_list":[],"uuid":"be3af1d7-ac68-415c-8539-be162ccefbbe","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"GCP","uuid":"234e6716-2347-4711-80e6-0525b24f6004"},"retries":"0","description":"","type":"DAG","uuid":"6e70c981-8cef-4916-8adc-3a33bc432996","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"25209685-b617-4610-92f7-8d4c5b9f1aa7"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"ca588813-07ce-4543-9003-8a429a6b60c1"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"fa667e29-46b8-4ded-bf7b-e50fe0e96493"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"02a1de2c-736e-45d4-b34a-17cc97124167"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"25209685-b617-4610-92f7-8d4c5b9f1aa7"},"edge_type":"inherent","type":"","uuid":"06a802f3-12ab-4cfa-ad16-1a5f8df434fd","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"fa667e29-46b8-4ded-bf7b-e50fe0e96493"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"ca588813-07ce-4543-9003-8a429a6b60c1"},"edge_type":"inherent","type":"","uuid":"ad14cd4d-a9f9-4d7f-97fa-dde51d585919","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"02a1de2c-736e-45d4-b34a-17cc97124167"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_234e6716_2347_4711_80e6_0525b24f6004"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"25209685-b617-4610-92f7-8d4c5b9f1aa7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ca588813-07ce-4543-9003-8a429a6b60c1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"fa667e29-46b8-4ded-bf7b-e50fe0e96493","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"fce4dd1e-7e76-4518-af76-a58dea5186f6"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"02a1de2c-736e-45d4-b34a-17cc97124167","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"1c203a4e-da24-4f1d-a059-709d069374ec"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab"}],"description":"","message_list":[],"uuid":"9ca00783-9875-40be-b5fb-20f68473ad7f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_234e6716_2347_4711_80e6_0525b24f6004","uuid":"6e70c981-8cef-4916-8adc-3a33bc432996"},"name":"SYS_GEN__Runbook_Application_234e6716_2347_4711_80e6_0525b24f6004"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"2f782054-a00d-4213-b939-52a80dc04962","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"GCP","uuid":"234e6716-2347-4711-80e6-0525b24f6004"},"retries":"0","description":"","type":"DAG","uuid":"ea18815f-9f95-456d-8b40-fce9118d6bf2","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"b16c2f4c-7bed-40e8-a00a-975f6ca82b12"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"14b09a98-86ef-4868-aefa-51a5c86cf1f6"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"3c7596de-ebea-429e-bea0-e174c7164524"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"36cba272-607b-48e2-9535-4c7e8fcd823d"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"17c81604-dd4f-45f1-9a01-72b9fdae63b8"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"660505f4-210f-45a4-bb8d-0133d4f95908"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"4799e0a9-dcdf-4652-884a-02ebd6be4001"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"ae3acd31-e2ae-496f-8306-45f09e234588"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_41a81f4c_6289_4f56_aef8_b7f9003bb8fa","uuid":"fbaa56b0-28ff-4422-a716-b4281905129d"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_78e07ffd_9c25_4005_aba0_444053ecbcd7","uuid":"eedc40dc-e1dd-4047-a47f-848f746b6364"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"14b09a98-86ef-4868-aefa-51a5c86cf1f6"},"edge_type":"inherent","type":"","uuid":"3b1c2698-c91a-49cc-8e88-cc7aa4be3672","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"36cba272-607b-48e2-9535-4c7e8fcd823d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"36cba272-607b-48e2-9535-4c7e8fcd823d"},"edge_type":"inherent","type":"","uuid":"053cf30f-6d7c-4a72-b3ba-203c98f0cfa9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"660505f4-210f-45a4-bb8d-0133d4f95908"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"ae3acd31-e2ae-496f-8306-45f09e234588"},"edge_type":"inherent","type":"","uuid":"72c13c31-9925-4eb0-825a-dfad38ed1980","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_41a81f4c_6289_4f56_aef8_b7f9003bb8fa","uuid":"fbaa56b0-28ff-4422-a716-b4281905129d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"660505f4-210f-45a4-bb8d-0133d4f95908"},"edge_type":"inherent","type":"","uuid":"0bd261e0-2c99-4508-8a27-4ed76608efc9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"ae3acd31-e2ae-496f-8306-45f09e234588"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"b16c2f4c-7bed-40e8-a00a-975f6ca82b12"},"edge_type":"inherent","type":"","uuid":"51d08c31-792d-4645-8100-72f55737b05b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"3c7596de-ebea-429e-bea0-e174c7164524"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"3c7596de-ebea-429e-bea0-e174c7164524"},"edge_type":"inherent","type":"","uuid":"490b2022-cdf0-4139-b51b-3e7e9473eb2d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"17c81604-dd4f-45f1-9a01-72b9fdae63b8"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"4799e0a9-dcdf-4652-884a-02ebd6be4001"},"edge_type":"inherent","type":"","uuid":"ea5dcd0b-c964-4f72-b767-0800353f380c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_78e07ffd_9c25_4005_aba0_444053ecbcd7","uuid":"eedc40dc-e1dd-4047-a47f-848f746b6364"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"17c81604-dd4f-45f1-9a01-72b9fdae63b8"},"edge_type":"inherent","type":"","uuid":"8ef70cd4-1ad8-4565-867c-82a2a9dec29b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"4799e0a9-dcdf-4652-884a-02ebd6be4001"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"660505f4-210f-45a4-bb8d-0133d4f95908"},"edge_type":"create_action_edge","type":"","uuid":"78478842-770f-4700-af56-8eac198057aa","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"4799e0a9-dcdf-4652-884a-02ebd6be4001"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"17c81604-dd4f-45f1-9a01-72b9fdae63b8"},"edge_type":"create_action_edge","type":"","uuid":"fdc5b3aa-6371-4e06-b7ae-f314b2eefa0e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"ae3acd31-e2ae-496f-8306-45f09e234588"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"36cba272-607b-48e2-9535-4c7e8fcd823d"},"edge_type":"dependency","type":"","uuid":"210ef073-6f65-449f-a728-8c5fc4693ce7","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"17c81604-dd4f-45f1-9a01-72b9fdae63b8"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_234e6716_2347_4711_80e6_0525b24f6004"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b16c2f4c-7bed-40e8-a00a-975f6ca82b12","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"14b09a98-86ef-4868-aefa-51a5c86cf1f6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3c7596de-ebea-429e-bea0-e174c7164524","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"843ab0a6-03bd-4b9c-8f56-7d852e9348e0"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"36cba272-607b-48e2-9535-4c7e8fcd823d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"7f713d48-74e9-4bb6-8dc9-eb8f00371ff3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"17c81604-dd4f-45f1-9a01-72b9fdae63b8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"de38f3ce-27a5-466d-91be-6037e2a4c86e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"660505f4-210f-45a4-bb8d-0133d4f95908","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"79773e8b-084a-43f6-9e69-8f811fe0d528"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_0ad182b1_b1e7_476c_894c_8121c7440601"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4799e0a9-dcdf-4652-884a-02ebd6be4001","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"2d42e962-1021-4baf-bed6-0a9174384d5d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ae3acd31-e2ae-496f-8306-45f09e234588","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"b394f7c2-b79e-433e-8e73-305836500cbe"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"fbaa56b0-28ff-4422-a716-b4281905129d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_41a81f4c_6289_4f56_aef8_b7f9003bb8fa"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"eedc40dc-e1dd-4047-a47f-848f746b6364","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_78e07ffd_9c25_4005_aba0_444053ecbcd7"}],"description":"","message_list":[],"uuid":"f81e0e1c-9876-41ea-807b-ff31773c2d52","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_234e6716_2347_4711_80e6_0525b24f6004","uuid":"ea18815f-9f95-456d-8b40-fce9118d6bf2"},"name":"SYS_GEN__Runbook_Application_234e6716_2347_4711_80e6_0525b24f6004"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"e9fac3a4-0b5b-4c09-a4d6-9fc94c7de8f6","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"GCP","uuid":"234e6716-2347-4711-80e6-0525b24f6004"},"retries":"0","description":"","type":"DAG","uuid":"00d44536-62f6-42e3-a9eb-060dcab123c4","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"6ef4ef28-65df-4e3d-89f7-ade315c4e950"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"95d0f533-a27b-4f18-89d9-4dcc30bee5a4"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"cd720236-e340-4a49-bdfd-d927ed86d5be"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"7615de66-39a3-4268-8a31-bbcd5023b036"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"01dbdf7f-1d1a-45ef-ab94-d3dc43b120dc"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"043a3591-d44e-48d4-8d42-989c2e806e1e"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_41a81f4c_6289_4f56_aef8_b7f9003bb8fa","uuid":"f2c4c9a0-e9b0-480f-95d8-518029289bb5"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_78e07ffd_9c25_4005_aba0_444053ecbcd7","uuid":"be7fc632-35bf-48c0-af91-1ea57e99e1ef"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"95d0f533-a27b-4f18-89d9-4dcc30bee5a4"},"edge_type":"inherent","type":"","uuid":"8ffb23c4-20a2-4b42-8eb2-25151bbf10b4","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"cd720236-e340-4a49-bdfd-d927ed86d5be"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"043a3591-d44e-48d4-8d42-989c2e806e1e"},"edge_type":"inherent","type":"","uuid":"61218772-e83c-49bf-9a28-20a656484eec","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_41a81f4c_6289_4f56_aef8_b7f9003bb8fa","uuid":"f2c4c9a0-e9b0-480f-95d8-518029289bb5"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"cd720236-e340-4a49-bdfd-d927ed86d5be"},"edge_type":"inherent","type":"","uuid":"d4aa7538-de8a-478e-a95c-ef29800e6267","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"043a3591-d44e-48d4-8d42-989c2e806e1e"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"6ef4ef28-65df-4e3d-89f7-ade315c4e950"},"edge_type":"inherent","type":"","uuid":"a4ec4ff4-ed93-439b-83d3-77c31b65f168","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"7615de66-39a3-4268-8a31-bbcd5023b036"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"01dbdf7f-1d1a-45ef-ab94-d3dc43b120dc"},"edge_type":"inherent","type":"","uuid":"d392c12e-3abf-4327-b241-6927a86f258b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_78e07ffd_9c25_4005_aba0_444053ecbcd7","uuid":"be7fc632-35bf-48c0-af91-1ea57e99e1ef"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"7615de66-39a3-4268-8a31-bbcd5023b036"},"edge_type":"inherent","type":"","uuid":"2298e73a-3a01-4334-aac3-71db2b2e8562","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"01dbdf7f-1d1a-45ef-ab94-d3dc43b120dc"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"cd720236-e340-4a49-bdfd-d927ed86d5be"},"edge_type":"create_action_edge","type":"","uuid":"6fd0a55f-660f-47d8-bcfa-610ca6f9275b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"01dbdf7f-1d1a-45ef-ab94-d3dc43b120dc"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"7615de66-39a3-4268-8a31-bbcd5023b036"},"edge_type":"create_action_edge","type":"","uuid":"da77eaf5-5366-4342-976b-0b751e694352","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"043a3591-d44e-48d4-8d42-989c2e806e1e"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_234e6716_2347_4711_80e6_0525b24f6004"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6ef4ef28-65df-4e3d-89f7-ade315c4e950","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"716ea7a7-bc0c-4ac5-ab9c-720c327a498e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"95d0f533-a27b-4f18-89d9-4dcc30bee5a4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"2064d305-852a-47aa-89b9-7415f90c2152"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"cd720236-e340-4a49-bdfd-d927ed86d5be","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_0ad182b1_b1e7_476c_894c_8121c7440601"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"7615de66-39a3-4268-8a31-bbcd5023b036","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"01dbdf7f-1d1a-45ef-ab94-d3dc43b120dc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab","uuid":"c98634ce-1304-4350-a68d-676cd00041b7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_fd41b059_b412_4c19_ba36_ca417a5806ab"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"043a3591-d44e-48d4-8d42-989c2e806e1e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5","uuid":"63354784-367f-47cd-94cd-a6d6ad8f3be6"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_ff719bc6_bcca_4c1c_b691_a931bd6e2de5"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"f2c4c9a0-e9b0-480f-95d8-518029289bb5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_41a81f4c_6289_4f56_aef8_b7f9003bb8fa"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"be7fc632-35bf-48c0-af91-1ea57e99e1ef","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_78e07ffd_9c25_4005_aba0_444053ecbcd7"}],"description":"","message_list":[],"uuid":"381689dc-b789-483c-a443-81c38563a8ae","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_234e6716_2347_4711_80e6_0525b24f6004","uuid":"00d44536-62f6-42e3-a9eb-060dcab123c4"},"name":"SYS_GEN__Runbook_Application_234e6716_2347_4711_80e6_0525b24f6004"}}],"message_list":[],"uuid":"234e6716-2347-4711-80e6-0525b24f6004","state":"ACTIVE","dependency_list":[{"getter_resource_kind":"PackageCfg","setter_resource_attr":"private_ip_address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"GCP_Centos_K8SW","action_name":"action_create","action_resource_name":"GCP","getter_resource_name":"GCP_Centos_K8SM_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"public_ip_address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"GCP_Centos_K8SW","action_name":"action_create","action_resource_name":"GCP","getter_resource_name":"GCP_Centos_K8SM_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"name","setter_resource_kind":"SubstrateCfg","setter_resource_name":"GCP_Centos_K8SW","action_name":"action_create","action_resource_name":"GCP","getter_resource_name":"GCP_Centos_K8SM_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"private_ip_address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"GCP_Centos_K8SM","action_name":"action_create","action_resource_name":"GCP","getter_resource_name":"GCP_Centos_K8SM_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"public_ip_address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"GCP_Centos_K8SM","action_name":"action_create","action_resource_name":"GCP","getter_resource_name":"GCP_Centos_K8SM_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"private_ip_address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"GCP_Centos_K8SM","action_name":"action_create","action_resource_name":"GCP","getter_resource_name":"GCP_Centos_K8SW_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"address","setter_resource_kind":"ServiceCfg","setter_resource_name":"Kubernetes_Master","action_name":"action_delete","action_resource_name":"GCP","getter_resource_name":"GCP_Centos_K8SW_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"private_ip_address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"GCP_Centos_K8SM","action_name":"action_create","action_resource_name":"34875daf_deployment","getter_resource_name":"GCP_Centos_K8SM_Package","action_resource_kind":"DeploymentCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"public_ip_address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"GCP_Centos_K8SM","action_name":"action_create","action_resource_name":"34875daf_deployment","getter_resource_name":"GCP_Centos_K8SM_Package","action_resource_kind":"DeploymentCfg"}],"variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"9152ff12-b13d-46cf-be40-0caa94292652","value":"gcp-kubenetes-cluster","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_CLUSTER_NAME"},{"regex":{"should_validate":true,"value":"^v1\\.[0-9]?[0-9]\\.[0-9]?[0-9]$"},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"92c3efbd-d51e-4dd8-9dfc-97ed234eaa6a","value":"v1.9.11","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_VERSION"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"9724abca-2f8b-49f7-a7c7-7f48a5b4163d","value":"17.03.3.ce","label":"","state":"ACTIVE","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{"type":"PREDEFINED","choices":["17.03.3.ce","17.06.2.ce","17.09.1.ce","17.12.1.ce","18.03.1.ce","18.06.3.ce"]},"name":"DOCKER_VERSION"},{"regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\\/\\d{1,2}$"},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"769f48b9-eb0f-4a22-addb-a78e5b12820b","value":"10.200.0.0\/16","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_CLUSTER_SUBNET"},{"regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\\/\\d{1,2}$"},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"f6279bc8-47dd-4f73-a5a7-3fb0e51da17e","value":"10.32.0.0\/24","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_SERVICE_SUBNET"},{"regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$"},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"e720df63-2436-4e79-83f8-441c037a7832","value":"10.32.0.10","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_DNS_IP"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"3e7d8b17-802e-4095-a99b-4d78bd483924","value":"flannel","label":"","state":"ACTIVE","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{"type":"PREDEFINED","choices":["flannel","canal","calico"]},"name":"KUBE_CNI_PLUGIN"}],"name":"GCP"},{"deployment_create_list":[{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"bd9addaf-29b6-4e50-8ad1-95026752421e","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"retries":"0","description":"","type":"DAG","uuid":"9202ff2e-8565-4a05-86cb-65f97fd3f12d","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_b81c9b76_a47d_4a40_b199_3ea41ef244a9","uuid":"a3112afd-4213-4549-af0f-403ba5625ecf"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"30cfa23c-e2d6-4e0c-9768-3d91cd708b63"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"679f781e-4b21-4fd2-8a64-7738be66ddf3"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"0dcf9e5f-69b6-405e-931a-c97fc57b0270"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"df5f62c2-c985-4198-804a-989b426b3c36"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"0dcf9e5f-69b6-405e-931a-c97fc57b0270"},"edge_type":"inherent","type":"","uuid":"ee186d24-e9a2-4a6c-9d8f-dcd4ae06250b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"df5f62c2-c985-4198-804a-989b426b3c36"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"679f781e-4b21-4fd2-8a64-7738be66ddf3"},"edge_type":"inherent","type":"","uuid":"9faf2e5a-cfc3-4a0a-a2d3-b7a409e01a22","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"0dcf9e5f-69b6-405e-931a-c97fc57b0270"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_b81c9b76_a47d_4a40_b199_3ea41ef244a9","uuid":"a3112afd-4213-4549-af0f-403ba5625ecf"},"edge_type":"inherent","type":"","uuid":"12059196-f119-4546-847f-4453e63ff29c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"30cfa23c-e2d6-4e0c-9768-3d91cd708b63"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"30cfa23c-e2d6-4e0c-9768-3d91cd708b63"},"edge_type":"inherent","type":"","uuid":"4e908990-9ab3-4c46-afda-091a1169aa97","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"679f781e-4b21-4fd2-8a64-7738be66ddf3"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_b81c9b76_a47d_4a40_b199_3ea41ef244a9"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"a3112afd-4213-4549-af0f-403ba5625ecf","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_b81c9b76_a47d_4a40_b199_3ea41ef244a9"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"30cfa23c-e2d6-4e0c-9768-3d91cd708b63","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"9dfe0dad-5617-4b18-879c-59bb79f93df6"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"679f781e-4b21-4fd2-8a64-7738be66ddf3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"de04cc30-89ea-4f23-b11f-4542e75deba1"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0dcf9e5f-69b6-405e-931a-c97fc57b0270","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"384cf3d8-e940-43f1-a289-6c6b363c5371"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"df5f62c2-c985-4198-804a-989b426b3c36","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"010d63f5-cd33-4e72-8c7b-c9df036109e6","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_b81c9b76_a47d_4a40_b199_3ea41ef244a9","uuid":"9202ff2e-8565-4a05-86cb-65f97fd3f12d"},"name":"SYS_GEN__Runbook_Deployment_b81c9b76_a47d_4a40_b199_3ea41ef244a9"}},{"description":"System action for starting an application","message_list":[],"uuid":"4670cb0c-0a64-4d02-ab3d-c5383da6d000","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"retries":"0","description":"","type":"DAG","uuid":"a93d118c-6cc1-43b0-8bea-d3720d86f9c9","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"2cff6747-f484-452a-adef-6f177c877950"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"a33baea9-702e-4b11-ac5a-241c5b8a875d"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"2cff6747-f484-452a-adef-6f177c877950"},"edge_type":"inherent","type":"","uuid":"ab5ff2a3-58da-4fec-bed4-6338225c5bbf","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"a33baea9-702e-4b11-ac5a-241c5b8a875d"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_b81c9b76_a47d_4a40_b199_3ea41ef244a9"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2cff6747-f484-452a-adef-6f177c877950","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"50d0c06c-b7e4-4917-aa29-23c4333eebb9"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a33baea9-702e-4b11-ac5a-241c5b8a875d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"7ac0bdf4-4be4-49e1-8ee6-82c45888968e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_b81c9b76_a47d_4a40_b199_3ea41ef244a9","uuid":"a93d118c-6cc1-43b0-8bea-d3720d86f9c9"},"name":"SYS_GEN__Runbook_Deployment_b81c9b76_a47d_4a40_b199_3ea41ef244a9"}},{"description":"System action for restarting an application","message_list":[],"uuid":"c9555b9b-5a6e-491b-8c14-2e40e05334f6","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"retries":"0","description":"","type":"DAG","uuid":"9a627a59-23ce-4f0e-9b8b-27d0f3e9d8bb","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"d50b79b2-24ee-42e4-9d35-4d76d10c5325"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"15bd8ad6-ad56-4bc8-ae72-b4d200fbf07a"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"d50b79b2-24ee-42e4-9d35-4d76d10c5325"},"edge_type":"inherent","type":"","uuid":"f63a9565-2a15-4ce4-8d6b-643add918113","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"15bd8ad6-ad56-4bc8-ae72-b4d200fbf07a"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_b81c9b76_a47d_4a40_b199_3ea41ef244a9"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d50b79b2-24ee-42e4-9d35-4d76d10c5325","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"55b5618b-9830-4b42-a755-71eba1e1704f"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"15bd8ad6-ad56-4bc8-ae72-b4d200fbf07a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"ca8cec47-f6e6-4ffb-83f1-eb67ddbb98e2"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"8a79e83e-faf4-4d39-8c3d-51e89721186d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_b81c9b76_a47d_4a40_b199_3ea41ef244a9","uuid":"9a627a59-23ce-4f0e-9b8b-27d0f3e9d8bb"},"name":"SYS_GEN__Runbook_Deployment_b81c9b76_a47d_4a40_b199_3ea41ef244a9"}},{"description":"System action for stopping an application","message_list":[],"uuid":"a8603e50-36c1-46c4-89b8-44008e4bf05b","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"retries":"0","description":"","type":"DAG","uuid":"88f7a1c1-34b9-483b-854c-c5a2921b1565","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"2984b49e-23b6-4f18-b69d-f6a5d7864f6e"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"5282cbaa-cc72-4515-a483-6e2daf846f83"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"2984b49e-23b6-4f18-b69d-f6a5d7864f6e"},"edge_type":"inherent","type":"","uuid":"3a5c7be0-400d-4816-8617-1ac0aa3f0665","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"5282cbaa-cc72-4515-a483-6e2daf846f83"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_b81c9b76_a47d_4a40_b199_3ea41ef244a9"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2984b49e-23b6-4f18-b69d-f6a5d7864f6e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5282cbaa-cc72-4515-a483-6e2daf846f83","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"66b1af5f-12b1-44a4-b10f-e8cfc94305fc"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"}],"description":"","message_list":[],"uuid":"2fea7c8a-06cf-4e9f-b023-95cb57d5e539","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_b81c9b76_a47d_4a40_b199_3ea41ef244a9","uuid":"88f7a1c1-34b9-483b-854c-c5a2921b1565"},"name":"SYS_GEN__Runbook_Deployment_b81c9b76_a47d_4a40_b199_3ea41ef244a9"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"0830c26d-03b8-4209-8061-201b9a6906e6","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"retries":"0","description":"","type":"DAG","uuid":"66b7ad74-ba90-491b-a9c7-b12781cf2900","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"8f466570-350f-4f05-8a68-521a3ac02109"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"6edbab04-37be-4ed4-83d7-2470e5ab49d0"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"81204aa1-4c69-4463-9b73-c63c7d727545"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"6e3af429-266d-4150-a25e-d180d7f7a79d"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_b81c9b76_a47d_4a40_b199_3ea41ef244a9","uuid":"b09dcdd0-315c-4ae0-82d9-18b6b3b65ee4"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"8f466570-350f-4f05-8a68-521a3ac02109"},"edge_type":"inherent","type":"","uuid":"a784498c-84fd-4b12-8a57-8cff49e62720","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"6edbab04-37be-4ed4-83d7-2470e5ab49d0"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"6edbab04-37be-4ed4-83d7-2470e5ab49d0"},"edge_type":"inherent","type":"","uuid":"86a09499-f648-42f0-b1ed-95a24a78e088","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"81204aa1-4c69-4463-9b73-c63c7d727545"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"81204aa1-4c69-4463-9b73-c63c7d727545"},"edge_type":"inherent","type":"","uuid":"a0dfc0a1-f3d4-4f12-af48-0307226c227c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"6e3af429-266d-4150-a25e-d180d7f7a79d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"6e3af429-266d-4150-a25e-d180d7f7a79d"},"edge_type":"inherent","type":"","uuid":"85861c8d-026c-4be3-8e05-afff540052bb","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_b81c9b76_a47d_4a40_b199_3ea41ef244a9","uuid":"b09dcdd0-315c-4ae0-82d9-18b6b3b65ee4"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_b81c9b76_a47d_4a40_b199_3ea41ef244a9"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8f466570-350f-4f05-8a68-521a3ac02109","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6edbab04-37be-4ed4-83d7-2470e5ab49d0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"7f713d48-74e9-4bb6-8dc9-eb8f00371ff3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"81204aa1-4c69-4463-9b73-c63c7d727545","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"7ff33631-d4cf-4620-8034-02c306390390"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6e3af429-266d-4150-a25e-d180d7f7a79d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"79b273ea-9ecd-424b-8427-bfc2c0918390"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"b09dcdd0-315c-4ae0-82d9-18b6b3b65ee4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_b81c9b76_a47d_4a40_b199_3ea41ef244a9"}],"description":"","message_list":[],"uuid":"669fc657-0c7e-458b-b0ec-d60a9c939233","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_b81c9b76_a47d_4a40_b199_3ea41ef244a9","uuid":"66b7ad74-ba90-491b-a9c7-b12781cf2900"},"name":"SYS_GEN__Runbook_Deployment_b81c9b76_a47d_4a40_b199_3ea41ef244a9"}},{"description":"System action for scaleout","message_list":[],"uuid":"24e4ae10-4db0-47af-a6c5-dcde899cbf39","name":"action_scaleout","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"retries":"0","description":"","type":"DAG","uuid":"93a0842f-7865-43b0-92e6-a65ee0d52816","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scaleout_b81c9b76_a47d_4a40_b199_3ea41ef244a9","uuid":"fbc52434-e3f0-4903-97a5-82dbc056efab"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_b81c9b76_a47d_4a40_b199_3ea41ef244a9"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"retries":"0","description":"","type":"SCALING","uuid":"fbc52434-e3f0-4903-97a5-82dbc056efab","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scaleout_b81c9b76_a47d_4a40_b199_3ea41ef244a9"}],"description":"","message_list":[],"uuid":"926556d8-9830-4d59-87ec-37b8d8452326","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"c076510e-3464-4ae9-b3e5-93c944011c8b","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_b81c9b76_a47d_4a40_b199_3ea41ef244a9","uuid":"93a0842f-7865-43b0-92e6-a65ee0d52816"},"name":"SYS_GEN__Runbook_Deployment_b81c9b76_a47d_4a40_b199_3ea41ef244a9"}},{"description":"System action for scalein","message_list":[],"uuid":"ce36a7fc-2489-40a5-9b31-fe0f977473ca","name":"action_scalein","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"retries":"0","description":"","type":"DAG","uuid":"7e73efdc-1cca-40df-932a-8146573dbc2e","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scalein_b81c9b76_a47d_4a40_b199_3ea41ef244a9","uuid":"26c76e04-fee0-4179-bbd2-9bd36e11cfc3"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_b81c9b76_a47d_4a40_b199_3ea41ef244a9"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"retries":"0","description":"","type":"SCALING","uuid":"26c76e04-fee0-4179-bbd2-9bd36e11cfc3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scalein_b81c9b76_a47d_4a40_b199_3ea41ef244a9"}],"description":"","message_list":[],"uuid":"367c1270-78e0-45ea-8506-9e5cd71371d6","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"2322c3cf-8b92-4c9e-9560-25b6f6f4832e","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_b81c9b76_a47d_4a40_b199_3ea41ef244a9","uuid":"7e73efdc-1cca-40df-932a-8146573dbc2e"},"name":"SYS_GEN__Runbook_Deployment_b81c9b76_a47d_4a40_b199_3ea41ef244a9"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"15b81971-f5a5-4a2e-a35b-087c879ffac8","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"retries":"0","description":"","type":"DAG","uuid":"2611225b-0835-4a39-863e-edf26e85a64f","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"1497de61-3826-4006-a194-68d1df35406e"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"4c2eced1-3c3c-4822-8f12-1d49acf3691c"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"2ddc01ab-8d1f-4917-b138-5ea9bcdf3b5b"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_b81c9b76_a47d_4a40_b199_3ea41ef244a9","uuid":"d382b4a5-6de4-4492-a049-16d2313fef7a"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"1497de61-3826-4006-a194-68d1df35406e"},"edge_type":"inherent","type":"","uuid":"b06d0310-1bf2-4f6d-beef-5d92715e649c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"4c2eced1-3c3c-4822-8f12-1d49acf3691c"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"2ddc01ab-8d1f-4917-b138-5ea9bcdf3b5b"},"edge_type":"inherent","type":"","uuid":"2a8e8dd3-426a-4ae6-820a-22de4a5c492e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_b81c9b76_a47d_4a40_b199_3ea41ef244a9","uuid":"d382b4a5-6de4-4492-a049-16d2313fef7a"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"4c2eced1-3c3c-4822-8f12-1d49acf3691c"},"edge_type":"inherent","type":"","uuid":"3b5330b3-85ad-44a9-97b1-3b2e7518b19a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"2ddc01ab-8d1f-4917-b138-5ea9bcdf3b5b"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_b81c9b76_a47d_4a40_b199_3ea41ef244a9"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1497de61-3826-4006-a194-68d1df35406e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"2064d305-852a-47aa-89b9-7415f90c2152"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"4c2eced1-3c3c-4822-8f12-1d49acf3691c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_8f379386_82c8_4851_84aa_e97b83c8b8a7"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2ddc01ab-8d1f-4917-b138-5ea9bcdf3b5b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"3a4f6a9f-8773-4cf1-afac-ef6a966c17b5"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"d382b4a5-6de4-4492-a049-16d2313fef7a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_b81c9b76_a47d_4a40_b199_3ea41ef244a9"}],"description":"","message_list":[],"uuid":"e4d6a4ee-27bd-40ab-b245-ad61aa015f2f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_b81c9b76_a47d_4a40_b199_3ea41ef244a9","uuid":"2611225b-0835-4a39-863e-edf26e85a64f"},"name":"SYS_GEN__Runbook_Deployment_b81c9b76_a47d_4a40_b199_3ea41ef244a9"}}],"message_list":[],"published_service_local_reference_list":[],"uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9","min_replicas":"3","state":"ACTIVE","max_replicas":"3","depends_on_list":[],"editables":{"min_replicas":true,"max_replicas":true},"package_local_reference_list":[{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"}],"substrate_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"type":"GREENFIELD","options":{},"variable_list":[],"name":"34875daf_deployment_cloned_1"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"31506eb2-9f8b-459e-8e48-b5ac5592df24","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"retries":"0","description":"","type":"DAG","uuid":"9083a180-b36a-47d3-b52e-d09e1fcfde13","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_5fec9da3_ca77_445c_96cb_726df66c483e","uuid":"977f3c16-9ca2-4183-8dab-c85c9d21850d"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"e81d2007-6aeb-4751-8953-0e4715b7025c"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"cfccb6c8-f5e4-4b3f-a2f1-f14be3d2884f"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"c3664551-10b6-443f-92fb-698bd2573861"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"180afc90-c863-42ea-b6f7-7bf42a65fad1"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"c3664551-10b6-443f-92fb-698bd2573861"},"edge_type":"inherent","type":"","uuid":"159d2476-3906-45d7-a2c1-4aa2032b609e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"180afc90-c863-42ea-b6f7-7bf42a65fad1"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"cfccb6c8-f5e4-4b3f-a2f1-f14be3d2884f"},"edge_type":"inherent","type":"","uuid":"d857f782-4253-4e48-ac97-6ab70359de69","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"c3664551-10b6-443f-92fb-698bd2573861"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_5fec9da3_ca77_445c_96cb_726df66c483e","uuid":"977f3c16-9ca2-4183-8dab-c85c9d21850d"},"edge_type":"inherent","type":"","uuid":"1cd85158-0c75-4854-8866-3cf6aa3fef15","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"e81d2007-6aeb-4751-8953-0e4715b7025c"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"e81d2007-6aeb-4751-8953-0e4715b7025c"},"edge_type":"inherent","type":"","uuid":"8aa98e93-7b2a-4238-a588-fff202ef99e1","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"cfccb6c8-f5e4-4b3f-a2f1-f14be3d2884f"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_5fec9da3_ca77_445c_96cb_726df66c483e"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"977f3c16-9ca2-4183-8dab-c85c9d21850d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_5fec9da3_ca77_445c_96cb_726df66c483e"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e81d2007-6aeb-4751-8953-0e4715b7025c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"84ad3d71-f9a7-4d41-8c38-ef8a2f389785"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"cfccb6c8-f5e4-4b3f-a2f1-f14be3d2884f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"dd28a56f-050d-4a92-87ea-44c57f0264d3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_206d70f4_364d_415d_bb4a_8739e54e57f5"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c3664551-10b6-443f-92fb-698bd2573861","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"cca906a5-5e79-422e-b15f-7391a907ad07"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"180afc90-c863-42ea-b6f7-7bf42a65fad1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"5360b1e4-365e-4a7b-9f48-17636f00fa48","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_5fec9da3_ca77_445c_96cb_726df66c483e","uuid":"9083a180-b36a-47d3-b52e-d09e1fcfde13"},"name":"SYS_GEN__Runbook_Deployment_5fec9da3_ca77_445c_96cb_726df66c483e"}},{"description":"System action for starting an application","message_list":[],"uuid":"7c336595-7740-41da-a2e0-9eaa06b27117","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"retries":"0","description":"","type":"DAG","uuid":"616a086c-73e9-4a32-8614-50718dc71066","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"304f8b86-adf0-4365-bfc2-1c3c8880e304"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"38f7a409-28fa-4b9b-81b4-0951306c3e9d"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"304f8b86-adf0-4365-bfc2-1c3c8880e304"},"edge_type":"inherent","type":"","uuid":"aed96844-242f-4872-8a98-420ebb9dd676","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"38f7a409-28fa-4b9b-81b4-0951306c3e9d"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_5fec9da3_ca77_445c_96cb_726df66c483e"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"304f8b86-adf0-4365-bfc2-1c3c8880e304","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"323f1f12-a907-4235-98e4-818ddb951f22"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"38f7a409-28fa-4b9b-81b4-0951306c3e9d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"44a0f6a8-03f3-4ef4-a891-c895939e8326","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_5fec9da3_ca77_445c_96cb_726df66c483e","uuid":"616a086c-73e9-4a32-8614-50718dc71066"},"name":"SYS_GEN__Runbook_Deployment_5fec9da3_ca77_445c_96cb_726df66c483e"}},{"description":"System action for restarting an application","message_list":[],"uuid":"b94d7df1-4143-45e3-8a6b-dddc89334841","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"retries":"0","description":"","type":"DAG","uuid":"699cb28b-2722-4f55-9bcf-ca79f76719b3","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"42ac10e0-0e69-480a-b7a4-0f50c88bb2a4"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"687c8bf4-0781-4d3c-814f-96421c597c25"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"42ac10e0-0e69-480a-b7a4-0f50c88bb2a4"},"edge_type":"inherent","type":"","uuid":"24f60393-fa0d-4c9b-9d35-f0eabbf42916","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"687c8bf4-0781-4d3c-814f-96421c597c25"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_5fec9da3_ca77_445c_96cb_726df66c483e"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"42ac10e0-0e69-480a-b7a4-0f50c88bb2a4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"79da12b6-2fbc-4431-90b5-a050d06a68b8"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"687c8bf4-0781-4d3c-814f-96421c597c25","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"ce602c49-d9cd-44d7-8e10-5671dc407b8b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"0f8c540e-c6cd-42c0-a9f3-a0a96d428f0a","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_5fec9da3_ca77_445c_96cb_726df66c483e","uuid":"699cb28b-2722-4f55-9bcf-ca79f76719b3"},"name":"SYS_GEN__Runbook_Deployment_5fec9da3_ca77_445c_96cb_726df66c483e"}},{"description":"System action for stopping an application","message_list":[],"uuid":"b9a4b34f-7d5f-4fd3-8939-f7afdbfa0377","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"retries":"0","description":"","type":"DAG","uuid":"f0e2b5ed-47d3-4958-b3e1-cbb76f6d055a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"485196ef-7639-4d24-9efd-da3deb2def26"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"6ad47cf9-acf0-4454-9091-0ffa7273691b"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"485196ef-7639-4d24-9efd-da3deb2def26"},"edge_type":"inherent","type":"","uuid":"472d9165-94e2-4fae-bd0d-7f564d81c9e5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"6ad47cf9-acf0-4454-9091-0ffa7273691b"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_5fec9da3_ca77_445c_96cb_726df66c483e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"485196ef-7639-4d24-9efd-da3deb2def26","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6ad47cf9-acf0-4454-9091-0ffa7273691b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"9a212087-bafd-4e1c-b898-95ab56b4e6f2"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822"}],"description":"","message_list":[],"uuid":"9b8bead1-13ed-4d0c-9142-c4833f21a120","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_5fec9da3_ca77_445c_96cb_726df66c483e","uuid":"f0e2b5ed-47d3-4958-b3e1-cbb76f6d055a"},"name":"SYS_GEN__Runbook_Deployment_5fec9da3_ca77_445c_96cb_726df66c483e"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"583fc7ab-8e8a-482b-938c-2a133cfb96fc","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"retries":"0","description":"","type":"DAG","uuid":"74345b4a-bf2a-4ad1-89e8-447e3299468b","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"80178683-9c2f-4508-bb6a-7526cb2f4a20"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"b01c6bdd-41d3-43bb-85a0-05f6c2403801"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"f8ebfe3b-9c44-4c00-9f02-be424a1b3e60"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"d9ae4ae7-ef43-4600-b18f-87d00c95784a"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_5fec9da3_ca77_445c_96cb_726df66c483e","uuid":"e4055981-5612-43e1-b4f5-ca2f46d49978"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"80178683-9c2f-4508-bb6a-7526cb2f4a20"},"edge_type":"inherent","type":"","uuid":"fae12bf2-dd9b-4cf7-992b-cf0dfef3335d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"b01c6bdd-41d3-43bb-85a0-05f6c2403801"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"b01c6bdd-41d3-43bb-85a0-05f6c2403801"},"edge_type":"inherent","type":"","uuid":"ad95768d-c418-4f3e-a0a5-ceef711355ec","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"f8ebfe3b-9c44-4c00-9f02-be424a1b3e60"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"f8ebfe3b-9c44-4c00-9f02-be424a1b3e60"},"edge_type":"inherent","type":"","uuid":"94d6d539-8e85-4243-887a-07bfb23f56d5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"d9ae4ae7-ef43-4600-b18f-87d00c95784a"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"d9ae4ae7-ef43-4600-b18f-87d00c95784a"},"edge_type":"inherent","type":"","uuid":"5d2a9b1e-e98f-47f1-a4ff-d5596be057f9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_5fec9da3_ca77_445c_96cb_726df66c483e","uuid":"e4055981-5612-43e1-b4f5-ca2f46d49978"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_5fec9da3_ca77_445c_96cb_726df66c483e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"80178683-9c2f-4508-bb6a-7526cb2f4a20","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b01c6bdd-41d3-43bb-85a0-05f6c2403801","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"843ab0a6-03bd-4b9c-8f56-7d852e9348e0"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f8ebfe3b-9c44-4c00-9f02-be424a1b3e60","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"652a7c4c-795e-4605-a656-4fb279302091"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_206d70f4_364d_415d_bb4a_8739e54e57f5"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d9ae4ae7-ef43-4600-b18f-87d00c95784a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"52c64980-14d7-4e3c-9f27-1dc3e6f4d968"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"e4055981-5612-43e1-b4f5-ca2f46d49978","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_5fec9da3_ca77_445c_96cb_726df66c483e"}],"description":"","message_list":[],"uuid":"b0355f44-6cd5-4530-84cf-39e703addeeb","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_5fec9da3_ca77_445c_96cb_726df66c483e","uuid":"74345b4a-bf2a-4ad1-89e8-447e3299468b"},"name":"SYS_GEN__Runbook_Deployment_5fec9da3_ca77_445c_96cb_726df66c483e"}},{"description":"System action for scaleout","message_list":[],"uuid":"85c96684-b010-4109-ab33-6ad090955509","name":"action_scaleout","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"retries":"0","description":"","type":"DAG","uuid":"cec20e63-d772-417b-8263-c3e2be8941db","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scaleout_5fec9da3_ca77_445c_96cb_726df66c483e","uuid":"6e8662db-9330-4095-baad-dcb9a7452b19"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_5fec9da3_ca77_445c_96cb_726df66c483e"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"retries":"0","description":"","type":"SCALING","uuid":"6e8662db-9330-4095-baad-dcb9a7452b19","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scaleout_5fec9da3_ca77_445c_96cb_726df66c483e"}],"description":"","message_list":[],"uuid":"c02769ea-ccec-4d38-a3cb-da2c0121a756","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"f7da3b8d-80cb-45c6-872a-2bb2940f11b0","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_5fec9da3_ca77_445c_96cb_726df66c483e","uuid":"cec20e63-d772-417b-8263-c3e2be8941db"},"name":"SYS_GEN__Runbook_Deployment_5fec9da3_ca77_445c_96cb_726df66c483e"}},{"description":"System action for scalein","message_list":[],"uuid":"df071e4d-e779-48e8-ab1b-930c19a330be","name":"action_scalein","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"retries":"0","description":"","type":"DAG","uuid":"28bd420e-38c6-4067-a81e-12ea267f1dcb","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scalein_5fec9da3_ca77_445c_96cb_726df66c483e","uuid":"4956de8c-da81-4ebf-aa27-87f01e592014"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_5fec9da3_ca77_445c_96cb_726df66c483e"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"retries":"0","description":"","type":"SCALING","uuid":"4956de8c-da81-4ebf-aa27-87f01e592014","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scalein_5fec9da3_ca77_445c_96cb_726df66c483e"}],"description":"","message_list":[],"uuid":"3f24ea87-cee6-44a2-9995-1e09641cc97a","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"aad41c83-0545-46e3-bbd3-5fa86abc1343","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_5fec9da3_ca77_445c_96cb_726df66c483e","uuid":"28bd420e-38c6-4067-a81e-12ea267f1dcb"},"name":"SYS_GEN__Runbook_Deployment_5fec9da3_ca77_445c_96cb_726df66c483e"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"9bf77852-770f-4b54-99e2-9d2d077ebf7f","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"retries":"0","description":"","type":"DAG","uuid":"86afcac9-b861-41aa-b89e-bf11d2bb939b","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"41a717b0-3534-40a7-bf96-0f53437d9ae2"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"3fc92cc9-7365-4dd3-9518-f55aac58135b"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"52bdcd51-8385-4665-99fc-0523931a2c2a"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_5fec9da3_ca77_445c_96cb_726df66c483e","uuid":"fd6e0883-fb32-4820-a988-88d95eb0f607"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"41a717b0-3534-40a7-bf96-0f53437d9ae2"},"edge_type":"inherent","type":"","uuid":"49bd1439-b739-4b3a-85e5-e869b12aeadc","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"3fc92cc9-7365-4dd3-9518-f55aac58135b"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"52bdcd51-8385-4665-99fc-0523931a2c2a"},"edge_type":"inherent","type":"","uuid":"984d3ad8-c511-4d0e-835b-ed5e112c00c9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_5fec9da3_ca77_445c_96cb_726df66c483e","uuid":"fd6e0883-fb32-4820-a988-88d95eb0f607"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"3fc92cc9-7365-4dd3-9518-f55aac58135b"},"edge_type":"inherent","type":"","uuid":"bf05b8e4-f2ef-4fd8-8457-03342ac2ae12","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"52bdcd51-8385-4665-99fc-0523931a2c2a"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_5fec9da3_ca77_445c_96cb_726df66c483e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"41a717b0-3534-40a7-bf96-0f53437d9ae2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"716ea7a7-bc0c-4ac5-ab9c-720c327a498e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"3fc92cc9-7365-4dd3-9518-f55aac58135b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_206d70f4_364d_415d_bb4a_8739e54e57f5"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"52bdcd51-8385-4665-99fc-0523931a2c2a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"94567f54-0a7c-457c-abeb-45e1fa9c58f5"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"fd6e0883-fb32-4820-a988-88d95eb0f607","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_5fec9da3_ca77_445c_96cb_726df66c483e"}],"description":"","message_list":[],"uuid":"029f05b2-d5aa-406e-9a31-360a06e97162","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_5fec9da3_ca77_445c_96cb_726df66c483e","uuid":"86afcac9-b861-41aa-b89e-bf11d2bb939b"},"name":"SYS_GEN__Runbook_Deployment_5fec9da3_ca77_445c_96cb_726df66c483e"}}],"message_list":[],"published_service_local_reference_list":[],"uuid":"5fec9da3-ca77-445c-96cb-726df66c483e","min_replicas":"3","state":"ACTIVE","max_replicas":"9","depends_on_list":[],"editables":{"min_replicas":true,"max_replicas":true},"package_local_reference_list":[{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"}],"substrate_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"type":"GREENFIELD","options":{},"variable_list":[],"name":"77b729d5_deployment_cloned_1"}],"description":"","action_list":[{"description":"","message_list":[],"uuid":"31ec0369-6c24-4906-88e0-5e6824486dac","name":"Upgrade","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"e0366f42-64ad-4dd4-8f8c-1b8a688a3564","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Version Master","uuid":"5c9fe27b-4a64-4fa5-be27-7606efa20e88"},{"kind":"app_task","name":"Set Version Worker","uuid":"dc594a7d-2d2c-4657-9e1e-2280f8150cb7"},{"kind":"app_task","name":"Upgrade Worker","uuid":"66935d23-badb-4391-bfce-1e838579ccf6"},{"kind":"app_task","name":"Upgrade Master","uuid":"1198aadb-24ba-405b-9a1b-e509ae2e14af"},{"kind":"app_task","name":"Restart Services","uuid":"892ba5b4-768b-4915-92e2-d6b07453410c"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"5c9fe27b-4a64-4fa5-be27-7606efa20e88"},"edge_type":"user_defined","type":"","uuid":"cbe1b611-4000-403a-a015-ca15cb7a0a92","to_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"1198aadb-24ba-405b-9a1b-e509ae2e14af"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"1198aadb-24ba-405b-9a1b-e509ae2e14af"},"edge_type":"user_defined","type":"","uuid":"5679158a-9c8e-494f-a8d3-a63df00455f3","to_task_reference":{"kind":"app_task","name":"Restart Services","uuid":"892ba5b4-768b-4915-92e2-d6b07453410c"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Worker","uuid":"dc594a7d-2d2c-4657-9e1e-2280f8150cb7"},"edge_type":"user_defined","type":"","uuid":"06c776bf-6fe7-41ad-aade-b13e63219f19","to_task_reference":{"kind":"app_task","name":"Upgrade Worker","uuid":"66935d23-badb-4391-bfce-1e838579ccf6"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Worker","uuid":"66935d23-badb-4391-bfce-1e838579ccf6"},"edge_type":"user_defined","type":"","uuid":"ff8a50e4-0294-46fa-b967-84200ba7a30f","to_task_reference":{"kind":"app_task","name":"Restart Services","uuid":"892ba5b4-768b-4915-92e2-d6b07453410c"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"cbdb4fa8_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"5c9fe27b-4a64-4fa5-be27-7606efa20e88","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Version Master"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"dc594a7d-2d2c-4657-9e1e-2280f8150cb7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Version Worker"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"66935d23-badb-4391-bfce-1e838579ccf6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{KUBE_VERSION_NEW}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Upgrade Worker"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"1198aadb-24ba-405b-9a1b-e509ae2e14af","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{KUBE_VERSION_NEW}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nMASTER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${MASTER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem  \n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Upgrade Master"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"892ba5b4-768b-4915-92e2-d6b07453410c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_NAMES=\"@@{calm_array_name}@@\" \nWORKER_NAMES=\"@@{Azure_Centos_K8SM.name}@@\" \nJSONPATH='{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}'\nKUBE_VERSION_NEW=\"@@{KUBE_VERSION_NEW}@@\"\nMASTER_API_HTTPS=6443\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION_NEW}\/bin\/linux\/amd64\/kubectl\nchmod +x kubectl\nsudo mv kubectl \/usr\/local\/bin\/kubectl\n\ncount=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n  echo \"Trying to reach master server https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} : sleep for 5 secs\"\n  sleep 10\n  if [[ $count -eq 10 ]]; then\n    echo \"Unable to reach master server: https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\"\n    exit 1\n  fi\n  count=$((count+1))\ndone\n\ncount=0\nfor name in $(echo \"${WORKER_NAMES}\" | tr \",\" \"\\n\"); do\n  #kubectl drain ${name} --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no \"worker${count}\" \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 20\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=${name} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon ${name}\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n  echo \"Upgrade failed on worker nodes\"\n    exit 1\nfi\n\ncount=0\nfor name in $(echo \"${MASTER_NAMES}\" | tr \",\" \"\\n\"); do\n  #kubectl drain $name --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no \"master${count}\" \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 20\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=$name -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon $name\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n  echo \"Upgrade failed on nodes: $(kubectl get nodes -o jsonpath='$JSONPATH' | grep 'Ready=Unknown')\"\n    exit 1\nfi"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Restart Services"}],"description":"","message_list":[],"uuid":"fd62710a-7148-4d6b-86c9-661f5701050e","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"a8e2c7c3-a143-4525-8503-0b5b1e00447f","value":"v1.10.13","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_VERSION_NEW"}],"main_task_local_reference":{"kind":"app_task","name":"cbdb4fa8_dag","uuid":"e0366f42-64ad-4dd4-8f8c-1b8a688a3564"},"name":"8d003d32_runbook_cloned_1"}},{"description":"","message_list":[],"uuid":"163105fb-33ec-40c6-8462-4ceafb2d4c64","name":"ScaleOut","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"0aebcf85-b0a7-4b70-9299-5c26c1fe271b","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Out","uuid":"2fc474ea-366d-4353-9059-38e1bfbc32ad"},{"kind":"app_task","name":"Set Hosts File","uuid":"e579bef7-4bd7-4718-a0a3-1c6adeeb14ed"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Scale Out","uuid":"2fc474ea-366d-4353-9059-38e1bfbc32ad"},"edge_type":"user_defined","type":"","uuid":"0cb35f4c-7e1e-4ce8-854b-ee8439a0adc7","to_task_reference":{"kind":"app_task","name":"Set Hosts File","uuid":"e579bef7-4bd7-4718-a0a3-1c6adeeb14ed"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"f3682593_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"retries":"0","description":"","type":"SCALING","uuid":"2fc474ea-366d-4353-9059-38e1bfbc32ad","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Scale Out"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"e579bef7-4bd7-4718-a0a3-1c6adeeb14ed","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nWORKER_IPS=\"@@{Azure_Centos_K8SM.private_ip_address}@@\"\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  if ! (( $(grep -c \"${ip} worker${count}\" \/etc\/hosts) )) ; then\n    echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  fi\n  count=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Hosts File"}],"description":"","message_list":[],"uuid":"55f706f6-cbf1-4efc-b52e-46627e9797fd","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"197f1dbd-02bd-4260-981f-8dab982afaa8","value":"1","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"f3682593_dag","uuid":"0aebcf85-b0a7-4b70-9299-5c26c1fe271b"},"name":"744583cd_runbook_cloned_1"}},{"description":"","message_list":[],"uuid":"5ee03a07-399b-4ebf-8f8e-e943448b067d","name":"ScaleIn","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"c7eb6abc-9d8d-4d95-9c3d-901e261fef8c","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale In","uuid":"f99ee624-7029-481d-9e07-2e3536934e2a"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"853cb860_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"retries":"0","description":"","type":"SCALING","uuid":"f99ee624-7029-481d-9e07-2e3536934e2a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Scale In"}],"description":"","message_list":[],"uuid":"314ad507-aec0-410b-9ef5-7e693ba9f55c","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"81485e82-89bb-4a7f-942b-a471ca893c80","value":"1","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"853cb860_dag","uuid":"c7eb6abc-9d8d-4d95-9c3d-901e261fef8c"},"name":"9331a25f_runbook_cloned_1"}},{"description":"System action for creating an application","message_list":[],"uuid":"f0367891-d1a7-4050-917f-0e04bfb59dcf","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Azure","uuid":"e955aab5-825b-4057-b86d-b28d02bbefde"},"retries":"0","description":"","type":"DAG","uuid":"f9404dff-9d96-4781-9ee2-5d08ebf2fee4","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_5fec9da3_ca77_445c_96cb_726df66c483e","uuid":"c851af38-2775-48fe-8816-2695263fd681"},{"kind":"app_task","name":"SYS_GEN__DE_Provision_b81c9b76_a47d_4a40_b199_3ea41ef244a9","uuid":"a450d9a7-bd0f-4e61-b844-2050ebc6e0ab"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"d871a025-f3db-43e3-a7f8-8868dd7abcf9"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"632e1f21-3053-42df-b63c-aaa6b591b559"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"5e0cdca5-3388-40df-9469-8d58019cccc7"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"03ed01e4-15d8-4335-98eb-f2da02464dee"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"c71b4dfd-59c0-4dc1-abde-7ad11b33ea2f"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"64ca7f59-5f65-475b-aece-d3153140aaba"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"07fb5c3a-b68e-4fd9-b71e-873a1bd4d737"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"8414b989-4e3b-4eac-8876-b0e5997be955"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"64ca7f59-5f65-475b-aece-d3153140aaba"},"edge_type":"inherent","type":"","uuid":"8b3420fb-af6e-4893-b1c4-ae2247d0b0ae","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"8414b989-4e3b-4eac-8876-b0e5997be955"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"03ed01e4-15d8-4335-98eb-f2da02464dee"},"edge_type":"inherent","type":"","uuid":"c8981291-820b-4b15-a12f-2cc054c01a58","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"64ca7f59-5f65-475b-aece-d3153140aaba"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_b81c9b76_a47d_4a40_b199_3ea41ef244a9","uuid":"a450d9a7-bd0f-4e61-b844-2050ebc6e0ab"},"edge_type":"inherent","type":"","uuid":"91e3e313-e12e-46f5-9bdb-8c3a44b804e0","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"d871a025-f3db-43e3-a7f8-8868dd7abcf9"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"d871a025-f3db-43e3-a7f8-8868dd7abcf9"},"edge_type":"inherent","type":"","uuid":"7043bca5-8785-45a4-84f4-a69ad877b5a4","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"03ed01e4-15d8-4335-98eb-f2da02464dee"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"c71b4dfd-59c0-4dc1-abde-7ad11b33ea2f"},"edge_type":"inherent","type":"","uuid":"27160813-4413-4b8e-b0ac-b9f7db2bcadc","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"07fb5c3a-b68e-4fd9-b71e-873a1bd4d737"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"5e0cdca5-3388-40df-9469-8d58019cccc7"},"edge_type":"inherent","type":"","uuid":"5c815cb7-fafd-41ff-abe9-972da52d65e3","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"c71b4dfd-59c0-4dc1-abde-7ad11b33ea2f"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_5fec9da3_ca77_445c_96cb_726df66c483e","uuid":"c851af38-2775-48fe-8816-2695263fd681"},"edge_type":"inherent","type":"","uuid":"33af3076-8c3c-493d-ac86-4d7c98b442e2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"632e1f21-3053-42df-b63c-aaa6b591b559"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"632e1f21-3053-42df-b63c-aaa6b591b559"},"edge_type":"inherent","type":"","uuid":"2f904ba0-1f16-4a37-ab9a-2851953544cc","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"5e0cdca5-3388-40df-9469-8d58019cccc7"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"632e1f21-3053-42df-b63c-aaa6b591b559"},"edge_type":"dependency","type":"","uuid":"a47ac524-d701-4837-9b95-17cc573fd50a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"03ed01e4-15d8-4335-98eb-f2da02464dee"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"d871a025-f3db-43e3-a7f8-8868dd7abcf9"},"edge_type":"dependency","type":"","uuid":"9f47d3f3-5a77-4260-ba9a-015019ee774c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"5e0cdca5-3388-40df-9469-8d58019cccc7"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_e955aab5_825b_4057_b86d_b28d02bbefde"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"c851af38-2775-48fe-8816-2695263fd681","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_5fec9da3_ca77_445c_96cb_726df66c483e"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"a450d9a7-bd0f-4e61-b844-2050ebc6e0ab","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_b81c9b76_a47d_4a40_b199_3ea41ef244a9"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d871a025-f3db-43e3-a7f8-8868dd7abcf9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"9dfe0dad-5617-4b18-879c-59bb79f93df6"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"632e1f21-3053-42df-b63c-aaa6b591b559","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"84ad3d71-f9a7-4d41-8c38-ef8a2f389785"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5e0cdca5-3388-40df-9469-8d58019cccc7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"dd28a56f-050d-4a92-87ea-44c57f0264d3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_206d70f4_364d_415d_bb4a_8739e54e57f5"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"03ed01e4-15d8-4335-98eb-f2da02464dee","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"de04cc30-89ea-4f23-b11f-4542e75deba1"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c71b4dfd-59c0-4dc1-abde-7ad11b33ea2f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"cca906a5-5e79-422e-b15f-7391a907ad07"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"64ca7f59-5f65-475b-aece-d3153140aaba","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"384cf3d8-e940-43f1-a289-6c6b363c5371"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"07fb5c3a-b68e-4fd9-b71e-873a1bd4d737","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8414b989-4e3b-4eac-8876-b0e5997be955","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"8979841b-f785-452f-824f-4f231c2a94d2","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_e955aab5_825b_4057_b86d_b28d02bbefde","uuid":"f9404dff-9d96-4781-9ee2-5d08ebf2fee4"},"name":"SYS_GEN__Runbook_Application_e955aab5_825b_4057_b86d_b28d02bbefde"}},{"description":"System action for starting an application","message_list":[],"uuid":"88e14408-32e1-473b-b02c-11a29c783002","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Azure","uuid":"e955aab5-825b-4057-b86d-b28d02bbefde"},"retries":"0","description":"","type":"DAG","uuid":"50d5a305-4a6a-4f27-a4c9-701d63920333","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"97321520-19a2-4b4f-b074-ed14e3a26b4c"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"0d80cd58-b925-44ec-b082-17ac4ee5a262"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"bef51d5f-29dc-4492-8767-320469b37723"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"fd8fd326-1c6e-4ba2-8f66-4aedf3be9b92"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"97321520-19a2-4b4f-b074-ed14e3a26b4c"},"edge_type":"inherent","type":"","uuid":"cf143a38-f198-4807-8b17-3f56437564d4","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"bef51d5f-29dc-4492-8767-320469b37723"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"0d80cd58-b925-44ec-b082-17ac4ee5a262"},"edge_type":"inherent","type":"","uuid":"318826aa-e8af-40ab-8156-3c9a9765184e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"fd8fd326-1c6e-4ba2-8f66-4aedf3be9b92"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_e955aab5_825b_4057_b86d_b28d02bbefde"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"97321520-19a2-4b4f-b074-ed14e3a26b4c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"50d0c06c-b7e4-4917-aa29-23c4333eebb9"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0d80cd58-b925-44ec-b082-17ac4ee5a262","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"323f1f12-a907-4235-98e4-818ddb951f22"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"bef51d5f-29dc-4492-8767-320469b37723","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"fd8fd326-1c6e-4ba2-8f66-4aedf3be9b92","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"1f65773c-b439-445a-b9b7-542ca04c599a","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_e955aab5_825b_4057_b86d_b28d02bbefde","uuid":"50d5a305-4a6a-4f27-a4c9-701d63920333"},"name":"SYS_GEN__Runbook_Application_e955aab5_825b_4057_b86d_b28d02bbefde"}},{"description":"System action for restarting an application","message_list":[],"uuid":"fd467f5a-9d52-4da3-b60e-1e4fb6dc6397","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Azure","uuid":"e955aab5-825b-4057-b86d-b28d02bbefde"},"retries":"0","description":"","type":"DAG","uuid":"c1f2107d-05a4-4940-ba28-444fb8ef0535","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"5036a497-41b2-4273-854e-325b78ced231"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"c8e3c7f4-1f17-4688-b40c-713f09baad55"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"3fc6f860-9355-4dc7-90a2-930f158e57b1"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"fdad74c3-b5d8-40e1-85f9-7a91013c2127"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"5036a497-41b2-4273-854e-325b78ced231"},"edge_type":"inherent","type":"","uuid":"126715cf-5094-47f3-a2c0-2cdd85e0662a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"3fc6f860-9355-4dc7-90a2-930f158e57b1"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"c8e3c7f4-1f17-4688-b40c-713f09baad55"},"edge_type":"inherent","type":"","uuid":"91ad9a8b-672e-4b81-9071-549d16dc7bd9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"fdad74c3-b5d8-40e1-85f9-7a91013c2127"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_e955aab5_825b_4057_b86d_b28d02bbefde"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5036a497-41b2-4273-854e-325b78ced231","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"55b5618b-9830-4b42-a755-71eba1e1704f"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c8e3c7f4-1f17-4688-b40c-713f09baad55","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"79da12b6-2fbc-4431-90b5-a050d06a68b8"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3fc6f860-9355-4dc7-90a2-930f158e57b1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"ca8cec47-f6e6-4ffb-83f1-eb67ddbb98e2"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"fdad74c3-b5d8-40e1-85f9-7a91013c2127","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"ce602c49-d9cd-44d7-8e10-5671dc407b8b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"567737b2-a316-42e4-9c6a-89302b53c28d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_e955aab5_825b_4057_b86d_b28d02bbefde","uuid":"c1f2107d-05a4-4940-ba28-444fb8ef0535"},"name":"SYS_GEN__Runbook_Application_e955aab5_825b_4057_b86d_b28d02bbefde"}},{"description":"System action for stopping an application","message_list":[],"uuid":"d2e4f9ea-4765-4126-992a-919b66842d08","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Azure","uuid":"e955aab5-825b-4057-b86d-b28d02bbefde"},"retries":"0","description":"","type":"DAG","uuid":"fda0adfc-1760-482b-ad68-9588ed44e3a4","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"42bb56cb-b53c-4f50-bbca-b51d60048cd3"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"0eb43db8-009a-428f-826a-5ec5a610bbb8"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"bad3d454-431a-4e88-91d4-a249cd3b34b4"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"21eab8da-037c-4ed0-8a53-f3f90b77b73a"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"0eb43db8-009a-428f-826a-5ec5a610bbb8"},"edge_type":"inherent","type":"","uuid":"6c045a58-3193-4fe0-bcb8-036bf37c4e2b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"bad3d454-431a-4e88-91d4-a249cd3b34b4"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"42bb56cb-b53c-4f50-bbca-b51d60048cd3"},"edge_type":"inherent","type":"","uuid":"0a983064-59c7-4320-b7dd-85f792c735e1","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"21eab8da-037c-4ed0-8a53-f3f90b77b73a"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_e955aab5_825b_4057_b86d_b28d02bbefde"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"42bb56cb-b53c-4f50-bbca-b51d60048cd3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0eb43db8-009a-428f-826a-5ec5a610bbb8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"bad3d454-431a-4e88-91d4-a249cd3b34b4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"66b1af5f-12b1-44a4-b10f-e8cfc94305fc"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"21eab8da-037c-4ed0-8a53-f3f90b77b73a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"9a212087-bafd-4e1c-b898-95ab56b4e6f2"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822"}],"description":"","message_list":[],"uuid":"ff5677b7-f672-42e0-b328-07d702879f6c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_e955aab5_825b_4057_b86d_b28d02bbefde","uuid":"fda0adfc-1760-482b-ad68-9588ed44e3a4"},"name":"SYS_GEN__Runbook_Application_e955aab5_825b_4057_b86d_b28d02bbefde"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"2b190c45-6c7d-4acd-8051-3258cc9e3622","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Azure","uuid":"e955aab5-825b-4057-b86d-b28d02bbefde"},"retries":"0","description":"","type":"DAG","uuid":"b0399946-3187-4368-b631-634c10ce8589","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"f70ab5e0-ee6a-49d5-bc5a-549975d9eed2"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"a2e1ac01-cfe1-43d0-8dca-4f6b86cbf1f6"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"0a74af10-5f7b-4b20-8f62-e781bdbe04e7"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"81a47403-0808-4bf6-a0a6-92f6f5cffac5"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"b2e661c2-58ac-4b55-9212-66f151df7801"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"4e980286-0d73-4405-a820-d98b7e41c73f"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"9dc4533d-35b0-4a96-ba20-c64344cda801"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"fb65e978-1c5f-4e9a-8e8d-39e6d593967e"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_b81c9b76_a47d_4a40_b199_3ea41ef244a9","uuid":"cb99b319-987d-430f-acaf-a4e2e88d5856"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_5fec9da3_ca77_445c_96cb_726df66c483e","uuid":"c517de66-39af-4557-a725-84437a68a9b9"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"a2e1ac01-cfe1-43d0-8dca-4f6b86cbf1f6"},"edge_type":"inherent","type":"","uuid":"a7fcec5e-b598-4cc4-9689-34c17dcf5e5e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"81a47403-0808-4bf6-a0a6-92f6f5cffac5"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"81a47403-0808-4bf6-a0a6-92f6f5cffac5"},"edge_type":"inherent","type":"","uuid":"a4834f24-9b29-417f-bc12-ecddc7dff6e4","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"b2e661c2-58ac-4b55-9212-66f151df7801"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"b2e661c2-58ac-4b55-9212-66f151df7801"},"edge_type":"inherent","type":"","uuid":"1787130e-e01a-4187-882e-3fc3028eecf3","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"fb65e978-1c5f-4e9a-8e8d-39e6d593967e"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"fb65e978-1c5f-4e9a-8e8d-39e6d593967e"},"edge_type":"inherent","type":"","uuid":"e4be8561-965e-4130-bc60-087a98862e14","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_b81c9b76_a47d_4a40_b199_3ea41ef244a9","uuid":"cb99b319-987d-430f-acaf-a4e2e88d5856"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"f70ab5e0-ee6a-49d5-bc5a-549975d9eed2"},"edge_type":"inherent","type":"","uuid":"cd103150-0fc0-4242-aa2f-38bbcca89bc8","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"0a74af10-5f7b-4b20-8f62-e781bdbe04e7"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"0a74af10-5f7b-4b20-8f62-e781bdbe04e7"},"edge_type":"inherent","type":"","uuid":"01263761-df67-4888-9504-1665449332ca","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"4e980286-0d73-4405-a820-d98b7e41c73f"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"4e980286-0d73-4405-a820-d98b7e41c73f"},"edge_type":"inherent","type":"","uuid":"8595098c-d08c-49a7-9554-7f1d5caf24ca","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"9dc4533d-35b0-4a96-ba20-c64344cda801"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"9dc4533d-35b0-4a96-ba20-c64344cda801"},"edge_type":"inherent","type":"","uuid":"6bea9d28-21cc-4102-9ab9-1da72e9f24bf","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_5fec9da3_ca77_445c_96cb_726df66c483e","uuid":"c517de66-39af-4557-a725-84437a68a9b9"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"b2e661c2-58ac-4b55-9212-66f151df7801"},"edge_type":"create_action_edge","type":"","uuid":"262f9b67-54fb-489b-950c-b6db3efd8671","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"9dc4533d-35b0-4a96-ba20-c64344cda801"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"4e980286-0d73-4405-a820-d98b7e41c73f"},"edge_type":"create_action_edge","type":"","uuid":"c0f53a33-502c-4912-8bf9-d2d685a20787","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"fb65e978-1c5f-4e9a-8e8d-39e6d593967e"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"81a47403-0808-4bf6-a0a6-92f6f5cffac5"},"edge_type":"dependency","type":"","uuid":"ce42125d-d7c9-4346-ab9a-8e8cfac4638e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"4e980286-0d73-4405-a820-d98b7e41c73f"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_e955aab5_825b_4057_b86d_b28d02bbefde"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f70ab5e0-ee6a-49d5-bc5a-549975d9eed2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a2e1ac01-cfe1-43d0-8dca-4f6b86cbf1f6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0a74af10-5f7b-4b20-8f62-e781bdbe04e7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"843ab0a6-03bd-4b9c-8f56-7d852e9348e0"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"81a47403-0808-4bf6-a0a6-92f6f5cffac5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"7f713d48-74e9-4bb6-8dc9-eb8f00371ff3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b2e661c2-58ac-4b55-9212-66f151df7801","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"7ff33631-d4cf-4620-8034-02c306390390"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4e980286-0d73-4405-a820-d98b7e41c73f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"652a7c4c-795e-4605-a656-4fb279302091"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_206d70f4_364d_415d_bb4a_8739e54e57f5"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"9dc4533d-35b0-4a96-ba20-c64344cda801","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"52c64980-14d7-4e3c-9f27-1dc3e6f4d968"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"fb65e978-1c5f-4e9a-8e8d-39e6d593967e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"79b273ea-9ecd-424b-8427-bfc2c0918390"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"cb99b319-987d-430f-acaf-a4e2e88d5856","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_b81c9b76_a47d_4a40_b199_3ea41ef244a9"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"c517de66-39af-4557-a725-84437a68a9b9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_5fec9da3_ca77_445c_96cb_726df66c483e"}],"description":"","message_list":[],"uuid":"bbdd34b3-0195-4261-ab47-3a7bc03437ff","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_e955aab5_825b_4057_b86d_b28d02bbefde","uuid":"b0399946-3187-4368-b631-634c10ce8589"},"name":"SYS_GEN__Runbook_Application_e955aab5_825b_4057_b86d_b28d02bbefde"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"b88ece75-f01f-45cc-92f9-3b517560322a","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Azure","uuid":"e955aab5-825b-4057-b86d-b28d02bbefde"},"retries":"0","description":"","type":"DAG","uuid":"03497a66-4e5e-412a-8369-390dfbee7c6a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"909a9ed6-598f-4d63-9271-264de3a0ea48"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"05cc231e-ce02-44db-b106-b93920710a8a"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"080b5535-6202-486c-a34b-dda705d95763"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"71848260-5a9a-4143-8a7a-0e7baf5892f4"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"57fed67f-82a9-41b1-8069-42bcb8cae56d"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"91076344-b785-468d-8bdb-044529f30d69"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_b81c9b76_a47d_4a40_b199_3ea41ef244a9","uuid":"8747e209-6142-4535-8081-15844e508ea8"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_5fec9da3_ca77_445c_96cb_726df66c483e","uuid":"9e3c1fe1-2b85-49a6-91d6-1b58fe1f2f41"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"909a9ed6-598f-4d63-9271-264de3a0ea48"},"edge_type":"inherent","type":"","uuid":"749dea7e-0f38-48fb-ace2-583c7efbc00a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"080b5535-6202-486c-a34b-dda705d95763"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"91076344-b785-468d-8bdb-044529f30d69"},"edge_type":"inherent","type":"","uuid":"163e846f-0248-4744-bb11-daebe37f4b28","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_b81c9b76_a47d_4a40_b199_3ea41ef244a9","uuid":"8747e209-6142-4535-8081-15844e508ea8"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"080b5535-6202-486c-a34b-dda705d95763"},"edge_type":"inherent","type":"","uuid":"bbdae9de-adb0-40a0-98a4-aafb19ed40d2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"91076344-b785-468d-8bdb-044529f30d69"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"05cc231e-ce02-44db-b106-b93920710a8a"},"edge_type":"inherent","type":"","uuid":"8295bdf6-da1a-46c6-8046-5afe160be0f0","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"71848260-5a9a-4143-8a7a-0e7baf5892f4"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"57fed67f-82a9-41b1-8069-42bcb8cae56d"},"edge_type":"inherent","type":"","uuid":"f5ad065c-80bb-4433-a5d0-ce8f76f6e666","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_5fec9da3_ca77_445c_96cb_726df66c483e","uuid":"9e3c1fe1-2b85-49a6-91d6-1b58fe1f2f41"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"71848260-5a9a-4143-8a7a-0e7baf5892f4"},"edge_type":"inherent","type":"","uuid":"a4e09032-5459-419c-9adc-7582cd4e9b85","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"57fed67f-82a9-41b1-8069-42bcb8cae56d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"080b5535-6202-486c-a34b-dda705d95763"},"edge_type":"create_action_edge","type":"","uuid":"2d6c998f-9992-4d8f-ad4c-7a522e801d5d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"57fed67f-82a9-41b1-8069-42bcb8cae56d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"71848260-5a9a-4143-8a7a-0e7baf5892f4"},"edge_type":"create_action_edge","type":"","uuid":"d517bb9f-cb9f-44ae-82b8-c21dbf364272","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"91076344-b785-468d-8bdb-044529f30d69"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_e955aab5_825b_4057_b86d_b28d02bbefde"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"909a9ed6-598f-4d63-9271-264de3a0ea48","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"2064d305-852a-47aa-89b9-7415f90c2152"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"05cc231e-ce02-44db-b106-b93920710a8a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"716ea7a7-bc0c-4ac5-ab9c-720c327a498e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"080b5535-6202-486c-a34b-dda705d95763","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_8f379386_82c8_4851_84aa_e97b83c8b8a7"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"71848260-5a9a-4143-8a7a-0e7baf5892f4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_206d70f4_364d_415d_bb4a_8739e54e57f5"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"57fed67f-82a9-41b1-8069-42bcb8cae56d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822","uuid":"94567f54-0a7c-457c-abeb-45e1fa9c58f5"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_03295a06_796d_4fa9_acec_3ad99de6e822"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"91076344-b785-468d-8bdb-044529f30d69","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5","uuid":"3a4f6a9f-8773-4cf1-afac-ef6a966c17b5"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_2fb2b374_c7af_42d5_b6e1_7cd0a3fe34a5"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"8747e209-6142-4535-8081-15844e508ea8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_b81c9b76_a47d_4a40_b199_3ea41ef244a9"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"9e3c1fe1-2b85-49a6-91d6-1b58fe1f2f41","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_5fec9da3_ca77_445c_96cb_726df66c483e"}],"description":"","message_list":[],"uuid":"3e360e54-6bba-4b41-92bc-839dfdc3cdd8","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_e955aab5_825b_4057_b86d_b28d02bbefde","uuid":"03497a66-4e5e-412a-8369-390dfbee7c6a"},"name":"SYS_GEN__Runbook_Application_e955aab5_825b_4057_b86d_b28d02bbefde"}}],"message_list":[],"uuid":"e955aab5-825b-4057-b86d-b28d02bbefde","state":"ACTIVE","dependency_list":[{"getter_resource_kind":"PackageCfg","setter_resource_attr":"private_ip_address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"Azure_Centos_K8SW","action_name":"action_create","action_resource_name":"Azure","getter_resource_name":"Azure_Centos_K8SM_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"public_ip_address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"Azure_Centos_K8SW","action_name":"action_create","action_resource_name":"Azure","getter_resource_name":"Azure_Centos_K8SM_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"public_ip_address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"Azure_Centos_K8SM","action_name":"action_create","action_resource_name":"Azure","getter_resource_name":"Azure_Centos_K8SM_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"private_ip_address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"Azure_Centos_K8SM","action_name":"action_create","action_resource_name":"Azure","getter_resource_name":"Azure_Centos_K8SW_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"address","setter_resource_kind":"ServiceCfg","setter_resource_name":"Kubernetes_Master","action_name":"action_delete","action_resource_name":"Azure","getter_resource_name":"Azure_Centos_K8SW_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"public_ip_address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"Azure_Centos_K8SM","action_name":"action_create","action_resource_name":"34875daf_deployment_cloned_1","getter_resource_name":"Azure_Centos_K8SM_Package","action_resource_kind":"DeploymentCfg"}],"variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"de345935-65ee-4d63-92c4-cd87b4cc9fb0","value":"azure-kubenetes-cluster","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_CLUSTER_NAME"},{"regex":{"should_validate":true,"value":"^v1\\.[0-9]?[0-9]\\.[0-9]?[0-9]$"},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"8377f5cf-7173-4405-ab6d-699c7f4fd2a7","value":"v1.9.11","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_VERSION"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"dc2501eb-5c7b-42a1-aac3-506a7286ec8d","value":"17.03.3.ce","label":"","state":"ACTIVE","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{"type":"PREDEFINED","choices":["17.03.3.ce","17.06.2.ce","17.09.1.ce","17.12.1.ce","18.03.1.ce","18.06.3.ce"]},"name":"DOCKER_VERSION"},{"regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\\/\\d{1,2}$"},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"19daae5a-df3a-432d-924b-d4dad7607446","value":"10.200.0.0\/16","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_CLUSTER_SUBNET"},{"regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\\/\\d{1,2}$"},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"e51e60a1-c84a-4fa7-8f60-7230c069a239","value":"10.32.0.0\/24","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_SERVICE_SUBNET"},{"regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$"},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"92241c26-051a-4ec9-97cc-dcf7be1422b0","value":"10.32.0.10","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_DNS_IP"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"0b690623-eaaf-4790-870e-efeca65562bb","value":"flannel","label":"","state":"ACTIVE","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{"type":"PREDEFINED","choices":["flannel","canal","calico"]},"name":"KUBE_CNI_PLUGIN"}],"name":"Azure"},{"deployment_create_list":[{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"768f44cd-0d3b-4610-8263-8b2ab428939b","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"retries":"0","description":"","type":"DAG","uuid":"ed56cb5c-0c6b-431b-8abb-7aa910c18040","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_4b3985c8_846b_4321_9603_db0b165c02a9","uuid":"2f8c0bf2-735e-4ebb-aa2d-b3b16aa7e156"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f","uuid":"888a4bea-986d-4233-bc49-371ebbbcf72f"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"018175f8-cf40-4cd3-b992-3b2ed913aaa4"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"8c7908d1-ab82-499a-a7a4-6c1f271661e8"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"7e53bf1b-565f-4100-9264-db4ae79e37bb"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"c7f3ab46-f684-490b-8e61-8a2c3c845f18"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"7e53bf1b-565f-4100-9264-db4ae79e37bb"},"edge_type":"inherent","type":"","uuid":"9d0b0c7c-a58a-407c-94d1-7763ee00103c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"c7f3ab46-f684-490b-8e61-8a2c3c845f18"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"8c7908d1-ab82-499a-a7a4-6c1f271661e8"},"edge_type":"inherent","type":"","uuid":"7267d1cb-b0e3-47bb-b98c-2051e1615e45","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"7e53bf1b-565f-4100-9264-db4ae79e37bb"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_4b3985c8_846b_4321_9603_db0b165c02a9","uuid":"2f8c0bf2-735e-4ebb-aa2d-b3b16aa7e156"},"edge_type":"inherent","type":"","uuid":"3ce614f8-d863-47e8-a65e-eb64eac27963","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"018175f8-cf40-4cd3-b992-3b2ed913aaa4"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"018175f8-cf40-4cd3-b992-3b2ed913aaa4"},"edge_type":"inherent","type":"","uuid":"ef204ec7-032f-4ee7-a2e7-37c73b63d4ba","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"8c7908d1-ab82-499a-a7a4-6c1f271661e8"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f","uuid":"888a4bea-986d-4233-bc49-371ebbbcf72f"},"edge_type":"inherent","type":"","uuid":"69e4bb4c-20ac-4628-9a52-4281628f2f1f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"018175f8-cf40-4cd3-b992-3b2ed913aaa4"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_4b3985c8_846b_4321_9603_db0b165c02a9","uuid":"2f8c0bf2-735e-4ebb-aa2d-b3b16aa7e156"},"edge_type":"inherent","type":"","uuid":"e662a056-832d-4abc-a8d9-97c1c697f8d9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f","uuid":"888a4bea-986d-4233-bc49-371ebbbcf72f"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_4b3985c8_846b_4321_9603_db0b165c02a9"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"2f8c0bf2-735e-4ebb-aa2d-b3b16aa7e156","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_4b3985c8_846b_4321_9603_db0b165c02a9"},{"target_any_local_reference":{"kind":"app_package","name":"ESX_CENTOS_76","uuid":"8fb1dd88-fcf1-444f-a5bb-d5482c87170f"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"888a4bea-986d-4233-bc49-371ebbbcf72f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f","uuid":"703f1b91-0a54-4823-8853-57d5ce0f664c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"018175f8-cf40-4cd3-b992-3b2ed913aaa4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"6be46218-ad79-4bbe-9ddf-2a954a5f2990"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d"},{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8c7908d1-ab82-499a-a7a4-6c1f271661e8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"2018e0a5-2448-4823-9f5d-9b7d415ea75e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"7e53bf1b-565f-4100-9264-db4ae79e37bb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"384cf3d8-e940-43f1-a289-6c6b363c5371"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c7f3ab46-f684-490b-8e61-8a2c3c845f18","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"fd5bac33-fb12-4f77-8b60-17e7da2b273c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_4b3985c8_846b_4321_9603_db0b165c02a9","uuid":"ed56cb5c-0c6b-431b-8abb-7aa910c18040"},"name":"SYS_GEN__Runbook_Deployment_4b3985c8_846b_4321_9603_db0b165c02a9"}},{"description":"System action for starting an application","message_list":[],"uuid":"e4f30e5d-0d01-41b0-a333-889050fb9540","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"retries":"0","description":"","type":"DAG","uuid":"22eac85c-19c4-47df-a988-d3cf8558ca4c","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"6749dcb1-f9a4-4c89-9706-2d95e2284c80"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"61421a5a-cff9-4606-9b47-ecc35311823c"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"6749dcb1-f9a4-4c89-9706-2d95e2284c80"},"edge_type":"inherent","type":"","uuid":"1fc84f37-0e21-42da-a283-d8afff130980","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"61421a5a-cff9-4606-9b47-ecc35311823c"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_4b3985c8_846b_4321_9603_db0b165c02a9"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6749dcb1-f9a4-4c89-9706-2d95e2284c80","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"25f55a73-4233-48f8-98dd-fee0fe4e8d86"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"61421a5a-cff9-4606-9b47-ecc35311823c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"534c863d-f1f6-4eaf-8875-303ff0bf367d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_4b3985c8_846b_4321_9603_db0b165c02a9","uuid":"22eac85c-19c4-47df-a988-d3cf8558ca4c"},"name":"SYS_GEN__Runbook_Deployment_4b3985c8_846b_4321_9603_db0b165c02a9"}},{"description":"System action for restarting an application","message_list":[],"uuid":"f3a4176f-9a29-4a26-99dc-11c621098cc1","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"retries":"0","description":"","type":"DAG","uuid":"7bbc014f-d5cb-4a97-beba-eb2e41787ec6","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"de6b8e51-4c39-4d21-8893-05e36985ee68"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"f398636d-217f-476a-9f1b-7f15cd802761"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"de6b8e51-4c39-4d21-8893-05e36985ee68"},"edge_type":"inherent","type":"","uuid":"d00788a9-c861-4021-9711-55a390d0356e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"f398636d-217f-476a-9f1b-7f15cd802761"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_4b3985c8_846b_4321_9603_db0b165c02a9"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"de6b8e51-4c39-4d21-8893-05e36985ee68","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"9f8d6201-6117-45d8-8f90-2e2ed20d04ff"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f398636d-217f-476a-9f1b-7f15cd802761","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"ca8cec47-f6e6-4ffb-83f1-eb67ddbb98e2"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"1cb2d920-c8f5-4314-aa46-f3fb662efe79","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_4b3985c8_846b_4321_9603_db0b165c02a9","uuid":"7bbc014f-d5cb-4a97-beba-eb2e41787ec6"},"name":"SYS_GEN__Runbook_Deployment_4b3985c8_846b_4321_9603_db0b165c02a9"}},{"description":"System action for stopping an application","message_list":[],"uuid":"185e2e66-f888-4642-bed3-aba3d95dad42","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"retries":"0","description":"","type":"DAG","uuid":"4bd033f1-dccd-41ec-a8c3-ea59bb175afd","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"6d137e26-ccc5-4f23-8f7b-13fc25d5812f"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"dac7690c-6e36-4e0e-a753-6c7c68e7e41d"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"6d137e26-ccc5-4f23-8f7b-13fc25d5812f"},"edge_type":"inherent","type":"","uuid":"bbfedc84-ffb3-4ac8-bc84-3937ec272e10","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"dac7690c-6e36-4e0e-a753-6c7c68e7e41d"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_4b3985c8_846b_4321_9603_db0b165c02a9"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6d137e26-ccc5-4f23-8f7b-13fc25d5812f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"dac7690c-6e36-4e0e-a753-6c7c68e7e41d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"07a3e2fe-6213-4f82-a186-0f81f54986b3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d"}],"description":"","message_list":[],"uuid":"095b5b4d-0a89-4b06-a208-2f6eccf08446","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_4b3985c8_846b_4321_9603_db0b165c02a9","uuid":"4bd033f1-dccd-41ec-a8c3-ea59bb175afd"},"name":"SYS_GEN__Runbook_Deployment_4b3985c8_846b_4321_9603_db0b165c02a9"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"f527b1b5-e4b1-4081-8224-61bd4c672436","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"retries":"0","description":"","type":"DAG","uuid":"850fb99a-439c-4a28-b9db-e34825363b29","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"18056a90-b517-40af-998b-fa0ae2ff05f2"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"c1e93b45-c208-44ff-8637-b6a0b1e11dc1"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"b3b7f310-8760-4c86-a064-2dafff178f17"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"e67cf42d-900a-473a-b66a-ae131280d901"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_4b3985c8_846b_4321_9603_db0b165c02a9","uuid":"770e293d-5f34-478e-b225-3a57bf61d1c7"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"18056a90-b517-40af-998b-fa0ae2ff05f2"},"edge_type":"inherent","type":"","uuid":"a062479e-6e18-4b01-9afe-5186120b7923","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"c1e93b45-c208-44ff-8637-b6a0b1e11dc1"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"c1e93b45-c208-44ff-8637-b6a0b1e11dc1"},"edge_type":"inherent","type":"","uuid":"1ab4eeb9-677c-42a7-a7d7-cd4bd8a21d92","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"b3b7f310-8760-4c86-a064-2dafff178f17"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"b3b7f310-8760-4c86-a064-2dafff178f17"},"edge_type":"inherent","type":"","uuid":"c86d585c-447a-4963-ad48-09552d3e2f9d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"e67cf42d-900a-473a-b66a-ae131280d901"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"e67cf42d-900a-473a-b66a-ae131280d901"},"edge_type":"inherent","type":"","uuid":"42d03cb6-243d-45fc-8ce3-d2b43bf9f5ec","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_4b3985c8_846b_4321_9603_db0b165c02a9","uuid":"770e293d-5f34-478e-b225-3a57bf61d1c7"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_4b3985c8_846b_4321_9603_db0b165c02a9"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"18056a90-b517-40af-998b-fa0ae2ff05f2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c1e93b45-c208-44ff-8637-b6a0b1e11dc1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"7f713d48-74e9-4bb6-8dc9-eb8f00371ff3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b3b7f310-8760-4c86-a064-2dafff178f17","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"3fe526fc-375b-4cfb-8e10-d1106f31be90"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e67cf42d-900a-473a-b66a-ae131280d901","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"4e9fd739-21aa-425a-9f39-519a0c3fcd5c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"770e293d-5f34-478e-b225-3a57bf61d1c7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_4b3985c8_846b_4321_9603_db0b165c02a9"}],"description":"","message_list":[],"uuid":"d0e60bb8-4030-4561-967b-69c46149c804","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_4b3985c8_846b_4321_9603_db0b165c02a9","uuid":"850fb99a-439c-4a28-b9db-e34825363b29"},"name":"SYS_GEN__Runbook_Deployment_4b3985c8_846b_4321_9603_db0b165c02a9"}},{"description":"System action for scaleout","message_list":[],"uuid":"c31cf9da-9444-469b-82d8-129dda9adfa2","name":"action_scaleout","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"retries":"0","description":"","type":"DAG","uuid":"7a25ef14-2be6-4243-96e4-dde18cd01695","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scaleout_4b3985c8_846b_4321_9603_db0b165c02a9","uuid":"48f877b6-0713-4448-96ed-067870f06d4b"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_4b3985c8_846b_4321_9603_db0b165c02a9"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"retries":"0","description":"","type":"SCALING","uuid":"48f877b6-0713-4448-96ed-067870f06d4b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scaleout_4b3985c8_846b_4321_9603_db0b165c02a9"}],"description":"","message_list":[],"uuid":"8602fa21-a007-4b78-9b2e-9a6087d107ba","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"8afbf15b-9258-41d8-b156-2d23dfecb5f9","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_4b3985c8_846b_4321_9603_db0b165c02a9","uuid":"7a25ef14-2be6-4243-96e4-dde18cd01695"},"name":"SYS_GEN__Runbook_Deployment_4b3985c8_846b_4321_9603_db0b165c02a9"}},{"description":"System action for scalein","message_list":[],"uuid":"3e2f9da7-ccc0-474d-9a4e-8c0db8323094","name":"action_scalein","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"retries":"0","description":"","type":"DAG","uuid":"aeec454c-33e8-490d-8e00-aafe59d45e84","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scalein_4b3985c8_846b_4321_9603_db0b165c02a9","uuid":"14899e39-4e8f-43c0-a4e1-979a8e746ced"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_4b3985c8_846b_4321_9603_db0b165c02a9"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"retries":"0","description":"","type":"SCALING","uuid":"14899e39-4e8f-43c0-a4e1-979a8e746ced","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scalein_4b3985c8_846b_4321_9603_db0b165c02a9"}],"description":"","message_list":[],"uuid":"5c4e8e10-bcad-4580-bffb-711a458dabbf","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"9e25fe13-46b1-4257-80d5-77093070f26c","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_4b3985c8_846b_4321_9603_db0b165c02a9","uuid":"aeec454c-33e8-490d-8e00-aafe59d45e84"},"name":"SYS_GEN__Runbook_Deployment_4b3985c8_846b_4321_9603_db0b165c02a9"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"6cbd72b6-3cd5-491a-9375-51929a8f1873","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"retries":"0","description":"","type":"DAG","uuid":"5e4c5431-5866-4682-811a-d49bd3e814f9","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"bfdeb12a-ad6c-4b92-b3dc-9f7f0e54f5a9"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"df8372e7-d3dd-4cd1-a9a2-2abfd1321e57"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"1125b638-cbb7-40bd-ab86-7eda82d4fc2f"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_4b3985c8_846b_4321_9603_db0b165c02a9","uuid":"c5bb1439-c2e9-495e-b1bd-6681b6638c38"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"bfdeb12a-ad6c-4b92-b3dc-9f7f0e54f5a9"},"edge_type":"inherent","type":"","uuid":"914ee92e-4988-49aa-b5d8-0f8392e04440","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"df8372e7-d3dd-4cd1-a9a2-2abfd1321e57"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"1125b638-cbb7-40bd-ab86-7eda82d4fc2f"},"edge_type":"inherent","type":"","uuid":"29c8cdfe-f0b6-41da-bd10-172db082e716","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_4b3985c8_846b_4321_9603_db0b165c02a9","uuid":"c5bb1439-c2e9-495e-b1bd-6681b6638c38"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"df8372e7-d3dd-4cd1-a9a2-2abfd1321e57"},"edge_type":"inherent","type":"","uuid":"a81ab09c-8593-4fb8-99d5-dcaf460359d1","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"1125b638-cbb7-40bd-ab86-7eda82d4fc2f"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_4b3985c8_846b_4321_9603_db0b165c02a9"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"bfdeb12a-ad6c-4b92-b3dc-9f7f0e54f5a9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"2064d305-852a-47aa-89b9-7415f90c2152"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"df8372e7-d3dd-4cd1-a9a2-2abfd1321e57","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_78d59e2e_ea58_482a_a2b2_6f593da4049e"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1125b638-cbb7-40bd-ab86-7eda82d4fc2f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"4a67affe-ed94-4ed1-ab4d-cdab23eac0cc"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"c5bb1439-c2e9-495e-b1bd-6681b6638c38","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_4b3985c8_846b_4321_9603_db0b165c02a9"}],"description":"","message_list":[],"uuid":"26f0a4f0-c2e1-45f3-837f-858c5a65747a","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_4b3985c8_846b_4321_9603_db0b165c02a9","uuid":"5e4c5431-5866-4682-811a-d49bd3e814f9"},"name":"SYS_GEN__Runbook_Deployment_4b3985c8_846b_4321_9603_db0b165c02a9"}}],"message_list":[],"published_service_local_reference_list":[],"uuid":"4b3985c8-846b-4321-9603-db0b165c02a9","min_replicas":"3","state":"ACTIVE","max_replicas":"3","depends_on_list":[],"editables":{"min_replicas":true,"max_replicas":true},"package_local_reference_list":[{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"}],"substrate_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"type":"GREENFIELD","options":{},"variable_list":[],"name":"2cbb2f6a_deployment_cloned_0"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"93fd0076-0dd8-4b00-9ca1-dc07d3b0b297","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"retries":"0","description":"","type":"DAG","uuid":"fa175635-199c-4f32-9608-f9c34b815c2b","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_e51f257b_fa1f_4293_8b25_64b1e57d824e","uuid":"20a3ebe3-b43f-4d41-acb2-f8ce181b3179"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f","uuid":"c74bc80c-b980-4a04-8cbd-cd9f614dccd9"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"9fd02943-41d9-4b36-a55e-cab7d59be980"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"e83df7a9-f3c5-4c11-85f5-7754305324a9"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"e150107d-f99d-48ac-9f05-000e3c678515"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"ff7df165-a71f-4299-96c8-7975ead96b23"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"e150107d-f99d-48ac-9f05-000e3c678515"},"edge_type":"inherent","type":"","uuid":"74ecd0dc-3e0d-4b26-a56f-1b3ab5438411","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"ff7df165-a71f-4299-96c8-7975ead96b23"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"e83df7a9-f3c5-4c11-85f5-7754305324a9"},"edge_type":"inherent","type":"","uuid":"8478ff8a-49c7-4432-a9ed-cb37a3bcb5c6","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"e150107d-f99d-48ac-9f05-000e3c678515"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f","uuid":"c74bc80c-b980-4a04-8cbd-cd9f614dccd9"},"edge_type":"inherent","type":"","uuid":"ca0c2865-ba3e-4cc2-b4e7-5d6e864f73f8","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"9fd02943-41d9-4b36-a55e-cab7d59be980"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_e51f257b_fa1f_4293_8b25_64b1e57d824e","uuid":"20a3ebe3-b43f-4d41-acb2-f8ce181b3179"},"edge_type":"inherent","type":"","uuid":"9e37cc06-0538-4990-b455-d9023a947cd7","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"9fd02943-41d9-4b36-a55e-cab7d59be980"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"9fd02943-41d9-4b36-a55e-cab7d59be980"},"edge_type":"inherent","type":"","uuid":"a9d5526e-b338-4587-a1ab-626c6167cd8e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"e83df7a9-f3c5-4c11-85f5-7754305324a9"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_e51f257b_fa1f_4293_8b25_64b1e57d824e","uuid":"20a3ebe3-b43f-4d41-acb2-f8ce181b3179"},"edge_type":"inherent","type":"","uuid":"cf79d061-be62-4262-9473-3e896378ebad","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f","uuid":"c74bc80c-b980-4a04-8cbd-cd9f614dccd9"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_e51f257b_fa1f_4293_8b25_64b1e57d824e"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"20a3ebe3-b43f-4d41-acb2-f8ce181b3179","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_e51f257b_fa1f_4293_8b25_64b1e57d824e"},{"target_any_local_reference":{"kind":"app_package","name":"ESX_CENTOS_76","uuid":"8fb1dd88-fcf1-444f-a5bb-d5482c87170f"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c74bc80c-b980-4a04-8cbd-cd9f614dccd9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f","uuid":"703f1b91-0a54-4823-8853-57d5ce0f664c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"9fd02943-41d9-4b36-a55e-cab7d59be980","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"fcfe334d-52df-48ef-9b1a-f130e700697f"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e"},{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e83df7a9-f3c5-4c11-85f5-7754305324a9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"3e21f753-bc67-4e4c-81bf-17ff5ace0f8c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_f749fc63_17aa_4814_a56b_c45ca8be030e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e150107d-f99d-48ac-9f05-000e3c678515","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"cca906a5-5e79-422e-b15f-7391a907ad07"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ff7df165-a71f-4299-96c8-7975ead96b23","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"4b5dc26c-3ed3-46d4-baa6-6cb4209017ea","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_e51f257b_fa1f_4293_8b25_64b1e57d824e","uuid":"fa175635-199c-4f32-9608-f9c34b815c2b"},"name":"SYS_GEN__Runbook_Deployment_e51f257b_fa1f_4293_8b25_64b1e57d824e"}},{"description":"System action for starting an application","message_list":[],"uuid":"033ab92c-8aa3-455f-a260-2a5e63daedda","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"retries":"0","description":"","type":"DAG","uuid":"b02762f7-15c9-4195-8052-1f427c536ffc","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"e51739e5-b861-4750-ac59-276c89f331e5"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"08770267-d560-40a8-827b-ba6ac5f74ae5"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"e51739e5-b861-4750-ac59-276c89f331e5"},"edge_type":"inherent","type":"","uuid":"fec27cf4-006d-4c8d-ba40-e14fd9980652","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"08770267-d560-40a8-827b-ba6ac5f74ae5"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_e51f257b_fa1f_4293_8b25_64b1e57d824e"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e51739e5-b861-4750-ac59-276c89f331e5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"67a13373-5646-4286-aa8a-0d588dea4db1"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"08770267-d560-40a8-827b-ba6ac5f74ae5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"f0ec9bed-4f26-4e02-813d-d763a08b0411","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_e51f257b_fa1f_4293_8b25_64b1e57d824e","uuid":"b02762f7-15c9-4195-8052-1f427c536ffc"},"name":"SYS_GEN__Runbook_Deployment_e51f257b_fa1f_4293_8b25_64b1e57d824e"}},{"description":"System action for restarting an application","message_list":[],"uuid":"0c851f2b-335c-4436-afc7-3400b18d0e7e","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"retries":"0","description":"","type":"DAG","uuid":"1a4e8981-acd8-493d-8e8b-465599cd1096","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"0b8ffe5a-7ed8-4a35-ba4f-0aa60f8b7897"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"7a9a6c32-ce60-4d8a-a3a8-6550a3df9da0"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"0b8ffe5a-7ed8-4a35-ba4f-0aa60f8b7897"},"edge_type":"inherent","type":"","uuid":"1d2132ab-3486-458e-8cb5-01559ba9e003","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"7a9a6c32-ce60-4d8a-a3a8-6550a3df9da0"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_e51f257b_fa1f_4293_8b25_64b1e57d824e"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0b8ffe5a-7ed8-4a35-ba4f-0aa60f8b7897","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"15b93666-3488-4333-bf74-fc334f09cab5"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"7a9a6c32-ce60-4d8a-a3a8-6550a3df9da0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"ce602c49-d9cd-44d7-8e10-5671dc407b8b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"332ff3d4-335f-4803-9421-5df00507ccee","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_e51f257b_fa1f_4293_8b25_64b1e57d824e","uuid":"1a4e8981-acd8-493d-8e8b-465599cd1096"},"name":"SYS_GEN__Runbook_Deployment_e51f257b_fa1f_4293_8b25_64b1e57d824e"}},{"description":"System action for stopping an application","message_list":[],"uuid":"c6999e88-f85a-417d-a31c-98d01c51a85d","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"retries":"0","description":"","type":"DAG","uuid":"d3c978c3-b899-4822-8df7-9f38798142a1","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"266955f9-c411-4d97-8c26-acdbb6b1c599"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"6a8b9bc4-6812-47be-a646-cee5147bebb4"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"266955f9-c411-4d97-8c26-acdbb6b1c599"},"edge_type":"inherent","type":"","uuid":"def66c21-e1bf-4eda-b613-46c53d9b49d0","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"6a8b9bc4-6812-47be-a646-cee5147bebb4"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_e51f257b_fa1f_4293_8b25_64b1e57d824e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"266955f9-c411-4d97-8c26-acdbb6b1c599","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6a8b9bc4-6812-47be-a646-cee5147bebb4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"644f71ed-0955-47b3-9f2b-9b722a177a08"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e"}],"description":"","message_list":[],"uuid":"fba6af24-1b1c-4e6f-9513-f4b9171298d6","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_e51f257b_fa1f_4293_8b25_64b1e57d824e","uuid":"d3c978c3-b899-4822-8df7-9f38798142a1"},"name":"SYS_GEN__Runbook_Deployment_e51f257b_fa1f_4293_8b25_64b1e57d824e"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"c2376da5-1488-4011-9deb-fc808af97f27","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"retries":"0","description":"","type":"DAG","uuid":"64b67f56-b37e-458b-8a60-bd9406f04432","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"1ec20305-8b62-4db6-bd48-c96f0e31ed70"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"a6acf7a8-3e97-4b39-8ae2-1f3a9b7f724f"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"ee8c5b57-8d37-4915-964b-c1f544ebbf14"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"00f7a1c8-357a-4aad-8b72-04b455be3fab"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_e51f257b_fa1f_4293_8b25_64b1e57d824e","uuid":"fd87aa7f-ca2e-4564-ac20-7533d3b80f18"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"1ec20305-8b62-4db6-bd48-c96f0e31ed70"},"edge_type":"inherent","type":"","uuid":"581fdb77-c67b-434a-8c43-189581ae956c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"a6acf7a8-3e97-4b39-8ae2-1f3a9b7f724f"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"a6acf7a8-3e97-4b39-8ae2-1f3a9b7f724f"},"edge_type":"inherent","type":"","uuid":"bb2caf9e-a16c-41bc-9abf-91afa4424e6b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"ee8c5b57-8d37-4915-964b-c1f544ebbf14"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"00f7a1c8-357a-4aad-8b72-04b455be3fab"},"edge_type":"inherent","type":"","uuid":"ec860be3-799c-4b28-a938-238e18f96c35","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_e51f257b_fa1f_4293_8b25_64b1e57d824e","uuid":"fd87aa7f-ca2e-4564-ac20-7533d3b80f18"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"ee8c5b57-8d37-4915-964b-c1f544ebbf14"},"edge_type":"inherent","type":"","uuid":"3a310677-7e9e-4517-913c-23eaaf045f86","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"00f7a1c8-357a-4aad-8b72-04b455be3fab"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_e51f257b_fa1f_4293_8b25_64b1e57d824e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1ec20305-8b62-4db6-bd48-c96f0e31ed70","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a6acf7a8-3e97-4b39-8ae2-1f3a9b7f724f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"843ab0a6-03bd-4b9c-8f56-7d852e9348e0"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ee8c5b57-8d37-4915-964b-c1f544ebbf14","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"d28d4dd3-fd12-4200-afe4-2f9ef7fe25c8"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_f749fc63_17aa_4814_a56b_c45ca8be030e"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"00f7a1c8-357a-4aad-8b72-04b455be3fab","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"83c91941-5cb1-42d9-a60b-424569feeebb"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"fd87aa7f-ca2e-4564-ac20-7533d3b80f18","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_e51f257b_fa1f_4293_8b25_64b1e57d824e"}],"description":"","message_list":[],"uuid":"d4e42fbd-02b6-471d-bbe6-4765e140c79c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_e51f257b_fa1f_4293_8b25_64b1e57d824e","uuid":"64b67f56-b37e-458b-8a60-bd9406f04432"},"name":"SYS_GEN__Runbook_Deployment_e51f257b_fa1f_4293_8b25_64b1e57d824e"}},{"description":"System action for scaleout","message_list":[],"uuid":"2bd0537f-6879-4955-ba38-3ce5aa6680c5","name":"action_scaleout","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"retries":"0","description":"","type":"DAG","uuid":"c29e4640-e886-4b91-a052-8daf685a2e99","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scaleout_e51f257b_fa1f_4293_8b25_64b1e57d824e","uuid":"3cc19b81-a92d-4e34-9e1f-d8f9f816617f"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_e51f257b_fa1f_4293_8b25_64b1e57d824e"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"retries":"0","description":"","type":"SCALING","uuid":"3cc19b81-a92d-4e34-9e1f-d8f9f816617f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scaleout_e51f257b_fa1f_4293_8b25_64b1e57d824e"}],"description":"","message_list":[],"uuid":"b7a872da-dc4b-42a4-a87e-ddd9e2d83a77","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"f6408b0d-b856-436e-91e4-c97a23a61056","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_e51f257b_fa1f_4293_8b25_64b1e57d824e","uuid":"c29e4640-e886-4b91-a052-8daf685a2e99"},"name":"SYS_GEN__Runbook_Deployment_e51f257b_fa1f_4293_8b25_64b1e57d824e"}},{"description":"System action for scalein","message_list":[],"uuid":"5dd14cda-15c7-4bb3-82ae-b93a8510f481","name":"action_scalein","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"retries":"0","description":"","type":"DAG","uuid":"ade19538-3cf3-468b-bfe5-d905aec66ff9","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scalein_e51f257b_fa1f_4293_8b25_64b1e57d824e","uuid":"d0fd42ae-c2c8-434e-a5ee-70496f4814c3"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_e51f257b_fa1f_4293_8b25_64b1e57d824e"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"retries":"0","description":"","type":"SCALING","uuid":"d0fd42ae-c2c8-434e-a5ee-70496f4814c3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scalein_e51f257b_fa1f_4293_8b25_64b1e57d824e"}],"description":"","message_list":[],"uuid":"2e7b63f8-2c38-449e-8c8b-b9b90ec5ada2","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"3725f0d4-b92c-405d-a64c-eaf7b03c05f1","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_e51f257b_fa1f_4293_8b25_64b1e57d824e","uuid":"ade19538-3cf3-468b-bfe5-d905aec66ff9"},"name":"SYS_GEN__Runbook_Deployment_e51f257b_fa1f_4293_8b25_64b1e57d824e"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"760a9ef1-9595-4837-8be8-e0824828b5c3","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"retries":"0","description":"","type":"DAG","uuid":"ff79ccb7-8159-431c-abfc-98288a774248","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"4b75ba0f-c20f-4092-b397-b24e7b7bbc33"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"2407a40f-616f-412c-af61-b9d2acfad7f7"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"24a88ca2-5476-4dd5-9f82-c3a490f67c78"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_e51f257b_fa1f_4293_8b25_64b1e57d824e","uuid":"ac2d5896-852a-4f2d-a193-29e3ef94450f"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"4b75ba0f-c20f-4092-b397-b24e7b7bbc33"},"edge_type":"inherent","type":"","uuid":"d6b0b2cf-1f4a-43cc-8842-fe129dbf575f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"2407a40f-616f-412c-af61-b9d2acfad7f7"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"24a88ca2-5476-4dd5-9f82-c3a490f67c78"},"edge_type":"inherent","type":"","uuid":"b832fa57-6c47-4584-a1c3-cadb86b9bcda","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_e51f257b_fa1f_4293_8b25_64b1e57d824e","uuid":"ac2d5896-852a-4f2d-a193-29e3ef94450f"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"2407a40f-616f-412c-af61-b9d2acfad7f7"},"edge_type":"inherent","type":"","uuid":"0c6012d4-0f1f-4653-943a-adbeff3ea963","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"24a88ca2-5476-4dd5-9f82-c3a490f67c78"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_e51f257b_fa1f_4293_8b25_64b1e57d824e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4b75ba0f-c20f-4092-b397-b24e7b7bbc33","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"716ea7a7-bc0c-4ac5-ab9c-720c327a498e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"2407a40f-616f-412c-af61-b9d2acfad7f7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_f749fc63_17aa_4814_a56b_c45ca8be030e"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"24a88ca2-5476-4dd5-9f82-c3a490f67c78","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"82dd31a7-9d9a-49c3-a1a8-8dfa67efb61b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"ac2d5896-852a-4f2d-a193-29e3ef94450f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_e51f257b_fa1f_4293_8b25_64b1e57d824e"}],"description":"","message_list":[],"uuid":"b31c2395-25fe-4581-8f20-a5e7a257d052","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_e51f257b_fa1f_4293_8b25_64b1e57d824e","uuid":"ff79ccb7-8159-431c-abfc-98288a774248"},"name":"SYS_GEN__Runbook_Deployment_e51f257b_fa1f_4293_8b25_64b1e57d824e"}}],"message_list":[],"published_service_local_reference_list":[],"uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e","min_replicas":"2","state":"ACTIVE","max_replicas":"9","depends_on_list":[],"editables":{"min_replicas":true,"max_replicas":true},"package_local_reference_list":[{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"}],"substrate_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"type":"GREENFIELD","options":{},"variable_list":[],"name":"39cf7283_deployment_cloned_0"}],"description":"","action_list":[{"description":"","message_list":[],"uuid":"b588f833-9ab3-4660-8bce-46fc9241452b","name":"Upgrade","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"92bdd175-8835-4d2c-8bc6-a17bb4f43a7d","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Version Minion","uuid":"036cbe52-3fc5-490f-a9a2-d8b59b11acb3"},{"kind":"app_task","name":"Set Version Master","uuid":"b97e3fb1-1894-446e-b613-7f2e6cc56e63"},{"kind":"app_task","name":"Upgrade Master","uuid":"6ad16d9a-91c6-404b-ad11-a63bf08162b7"},{"kind":"app_task","name":"Upgrade Minion","uuid":"46d8ca17-da47-4226-9f3b-99a317a0349d"},{"kind":"app_task","name":"RestartServices","uuid":"21502b1b-e95e-45db-84f0-3994571aaca0"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"b97e3fb1-1894-446e-b613-7f2e6cc56e63"},"edge_type":"user_defined","type":"","uuid":"7e972475-df92-417d-a614-d89abacf86bb","to_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"6ad16d9a-91c6-404b-ad11-a63bf08162b7"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"6ad16d9a-91c6-404b-ad11-a63bf08162b7"},"edge_type":"user_defined","type":"","uuid":"f5b53dbf-615a-4611-9bda-aaa50b5e57dc","to_task_reference":{"kind":"app_task","name":"RestartServices","uuid":"21502b1b-e95e-45db-84f0-3994571aaca0"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"036cbe52-3fc5-490f-a9a2-d8b59b11acb3"},"edge_type":"user_defined","type":"","uuid":"4772b56c-4bc3-4ac9-a670-c10bb6273cd6","to_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"46d8ca17-da47-4226-9f3b-99a317a0349d"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"46d8ca17-da47-4226-9f3b-99a317a0349d"},"edge_type":"user_defined","type":"","uuid":"eba27cdd-98f0-45bc-9c0b-7554f58a0126","to_task_reference":{"kind":"app_task","name":"RestartServices","uuid":"21502b1b-e95e-45db-84f0-3994571aaca0"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6ee65d8a_dag_cloned_1"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"036cbe52-3fc5-490f-a9a2-d8b59b11acb3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Version Minion"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"b97e3fb1-1894-446e-b613-7f2e6cc56e63","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Version Master"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"6ad16d9a-91c6-404b-ad11-a63bf08162b7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nMASTER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${MASTER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false \n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Upgrade Master"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"46d8ca17-da47-4226-9f3b-99a317a0349d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Upgrade Minion"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"21502b1b-e95e-45db-84f0-3994571aaca0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_NAMES=\"@@{VMware_Centos_K8SW.address}@@\"\nJSONPATH='{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}'\nKUBE_VERSION_NEW=\"@@{KUBE_VERSION_NEW}@@\"\nMASTER_API_HTTPS=6443\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION_NEW}\/bin\/linux\/amd64\/kubectl\nchmod +x kubectl\nsudo mv kubectl \/usr\/local\/bin\/kubectl\n\ncount=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n  echo \"Trying to reach master server https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} : sleep for 5 secs\"\n  sleep 10\n  if [[ $count -eq 10 ]]; then\n    echo \"Unable to reach master server: https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\"\n    exit 1\n  fi\n  count=$((count+1))\ndone\n\ncount=0\nfor ip in $(echo \"${WORKER_NAMES}\" | tr \",\" \"\\n\"); do\n  #kubectl drain \"worker${count}\" --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no $ip \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 10\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=worker${count} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon worker${count}\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n  echo \"Upgrade failed on worker nodes\"\n    exit 1\nfi\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  #kubectl drain \"master${count}\" --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no $ip \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 10\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=master${count} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon master${count}\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n  echo \"Upgrade failed on nodes: $(kubectl get nodes -o jsonpath='$JSONPATH' | grep 'Ready=Unknown')\"\n    exit 1\nfi"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"RestartServices"}],"description":"","message_list":[],"uuid":"8208b8bb-6803-4cf6-98f7-486858546a33","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"7e38c6d8-9217-4d26-b901-79a99d439261","value":"v1.10.13","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_VERSION_NEW"}],"main_task_local_reference":{"kind":"app_task","name":"6ee65d8a_dag_cloned_1","uuid":"92bdd175-8835-4d2c-8bc6-a17bb4f43a7d"},"name":"68a7ffd0_runbook_cloned_0"}},{"description":"","message_list":[],"uuid":"9b1c7248-8451-441d-a8d5-25a08002fd9c","name":"ScaleOut","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"3a80fefb-860c-4532-8c7a-6c6c765f7132","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Out","uuid":"e1ef73bd-cd0f-4fe4-9023-da96388ae6c1"},{"kind":"app_task","name":"Set Hosts file","uuid":"0ff769e7-d60c-4086-a68d-f5b82461e4be"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Scale Out","uuid":"e1ef73bd-cd0f-4fe4-9023-da96388ae6c1"},"edge_type":"user_defined","type":"","uuid":"83b9e564-9f2d-4e44-9c11-8d33fc5c51d0","to_task_reference":{"kind":"app_task","name":"Set Hosts file","uuid":"0ff769e7-d60c-4086-a68d-f5b82461e4be"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"03b33121_dag_cloned_1"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"retries":"0","description":"","type":"SCALING","uuid":"e1ef73bd-cd0f-4fe4-9023-da96388ae6c1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Scale Out"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"0ff769e7-d60c-4086-a68d-f5b82461e4be","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMINION_IPS=\"@@{VMware_Centos_K8SM.address}@@\"\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  if ! (( $(grep -c \"${ip} minion${count}\" \/etc\/hosts) )) ; then\n  \techo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  fi\n  count=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Hosts file"}],"description":"","message_list":[],"uuid":"cb22e4c9-c256-434f-a553-4b59f022bfc4","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"6efc1add-f50b-4353-b7a0-af46316f8425","value":"1","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"03b33121_dag_cloned_1","uuid":"3a80fefb-860c-4532-8c7a-6c6c765f7132"},"name":"00cf5417_runbook_cloned_0"}},{"description":"","message_list":[],"uuid":"427b9818-cb0d-4575-a7be-1080b0569a98","name":"ScaleIn","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"56530059-4668-43c9-91b7-3d6261842e6f","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale In","uuid":"3f7a2048-8271-44a4-81a9-c1976a1be83b"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"e72a9133_dag_cloned_1"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"retries":"0","description":"","type":"SCALING","uuid":"3f7a2048-8271-44a4-81a9-c1976a1be83b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Scale In"}],"description":"","message_list":[],"uuid":"5e54ded6-d632-47c1-8fcb-998eecd48fe2","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"942292cc-68d7-4e1c-981e-f1aeb26ce1c1","value":"1","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"e72a9133_dag_cloned_1","uuid":"56530059-4668-43c9-91b7-3d6261842e6f"},"name":"96546f6c_runbook_cloned_0"}},{"description":"System action for creating an application","message_list":[],"uuid":"f025e599-3202-46b8-8e15-43c932db62fb","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"VMware","uuid":"a1ec0f17-c623-4c1b-bb5f-c9672dfa6fea"},"retries":"0","description":"","type":"DAG","uuid":"da039607-7393-4ea0-abc1-7ba049370f35","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_e51f257b_fa1f_4293_8b25_64b1e57d824e","uuid":"be5231b3-a257-47ed-9d51-bef204540844"},{"kind":"app_task","name":"SYS_GEN__DE_Provision_4b3985c8_846b_4321_9603_db0b165c02a9","uuid":"24b681a9-9dfc-4a2c-bf15-7309953be847"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f_1","uuid":"2f4ec649-8d59-4bff-bf1f-d1fa285b618b"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f","uuid":"f8e88262-6914-4f62-8163-d95b635af10d"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"6be6b716-a108-42b2-9a6d-732141676756"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"9de54441-5604-4e8e-adff-5f029aeca834"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"830bab21-198a-4875-88fa-749b57dbe511"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"cae5e3a5-98a5-45c4-b5a1-d9c162475c9d"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"c5a90ef7-3310-4763-91d7-04ef44f70d46"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"b0cc4a91-ed99-40b4-9cb2-0241be934522"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"89b659df-ccfb-4d5e-8bcb-dd409f051646"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"ede534ee-8fa9-477c-bed7-0560ef1e6972"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"b0cc4a91-ed99-40b4-9cb2-0241be934522"},"edge_type":"inherent","type":"","uuid":"e6dee4c6-2884-458e-8c91-4d72701b6935","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"89b659df-ccfb-4d5e-8bcb-dd409f051646"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"cae5e3a5-98a5-45c4-b5a1-d9c162475c9d"},"edge_type":"inherent","type":"","uuid":"5c89df4a-2724-47af-bba3-b6f44bb72e22","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"b0cc4a91-ed99-40b4-9cb2-0241be934522"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_4b3985c8_846b_4321_9603_db0b165c02a9","uuid":"24b681a9-9dfc-4a2c-bf15-7309953be847"},"edge_type":"inherent","type":"","uuid":"26af378c-7b74-4e83-be91-7dbabbafa108","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"6be6b716-a108-42b2-9a6d-732141676756"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"6be6b716-a108-42b2-9a6d-732141676756"},"edge_type":"inherent","type":"","uuid":"13d48b07-2db7-4514-9e8a-4f8cc7f50959","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"cae5e3a5-98a5-45c4-b5a1-d9c162475c9d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f","uuid":"f8e88262-6914-4f62-8163-d95b635af10d"},"edge_type":"inherent","type":"","uuid":"1b1bc9d9-58bd-4de8-a07a-02aee22e4431","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"6be6b716-a108-42b2-9a6d-732141676756"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_4b3985c8_846b_4321_9603_db0b165c02a9","uuid":"24b681a9-9dfc-4a2c-bf15-7309953be847"},"edge_type":"inherent","type":"","uuid":"84f97e6a-e2ae-417c-98ba-da66fcf09723","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f","uuid":"f8e88262-6914-4f62-8163-d95b635af10d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"c5a90ef7-3310-4763-91d7-04ef44f70d46"},"edge_type":"inherent","type":"","uuid":"436da234-ca9f-4bcd-8d09-31fad678c81a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"ede534ee-8fa9-477c-bed7-0560ef1e6972"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"830bab21-198a-4875-88fa-749b57dbe511"},"edge_type":"inherent","type":"","uuid":"be735803-ab72-43e8-8420-e5aa4d2b1508","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"c5a90ef7-3310-4763-91d7-04ef44f70d46"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f_1","uuid":"2f4ec649-8d59-4bff-bf1f-d1fa285b618b"},"edge_type":"inherent","type":"","uuid":"2a4488ff-3ce3-48aa-888b-a588b469d1b8","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"9de54441-5604-4e8e-adff-5f029aeca834"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_e51f257b_fa1f_4293_8b25_64b1e57d824e","uuid":"be5231b3-a257-47ed-9d51-bef204540844"},"edge_type":"inherent","type":"","uuid":"0fc85f85-b263-45e2-8132-bf0cf94009d3","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"9de54441-5604-4e8e-adff-5f029aeca834"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"9de54441-5604-4e8e-adff-5f029aeca834"},"edge_type":"inherent","type":"","uuid":"823bfd63-acb1-443d-bdae-1faf01b5eab9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"830bab21-198a-4875-88fa-749b57dbe511"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_e51f257b_fa1f_4293_8b25_64b1e57d824e","uuid":"be5231b3-a257-47ed-9d51-bef204540844"},"edge_type":"inherent","type":"","uuid":"d65352d6-f808-4a7a-90ad-94e7fd7f2756","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f_1","uuid":"2f4ec649-8d59-4bff-bf1f-d1fa285b618b"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"9de54441-5604-4e8e-adff-5f029aeca834"},"edge_type":"dependency","type":"","uuid":"02796d49-778a-418d-aac7-c8d0da01bb98","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"cae5e3a5-98a5-45c4-b5a1-d9c162475c9d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"6be6b716-a108-42b2-9a6d-732141676756"},"edge_type":"dependency","type":"","uuid":"30e8af96-c900-46c7-a566-715a5daf5e91","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"830bab21-198a-4875-88fa-749b57dbe511"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_a1ec0f17_c623_4c1b_bb5f_c9672dfa6fea"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"be5231b3-a257-47ed-9d51-bef204540844","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_e51f257b_fa1f_4293_8b25_64b1e57d824e"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"24b681a9-9dfc-4a2c-bf15-7309953be847","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_4b3985c8_846b_4321_9603_db0b165c02a9"},{"target_any_local_reference":{"kind":"app_package","name":"ESX_CENTOS_76","uuid":"8fb1dd88-fcf1-444f-a5bb-d5482c87170f"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2f4ec649-8d59-4bff-bf1f-d1fa285b618b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f","uuid":"703f1b91-0a54-4823-8853-57d5ce0f664c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f_1"},{"target_any_local_reference":{"kind":"app_package","name":"ESX_CENTOS_76","uuid":"8fb1dd88-fcf1-444f-a5bb-d5482c87170f"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f8e88262-6914-4f62-8163-d95b635af10d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f","uuid":"703f1b91-0a54-4823-8853-57d5ce0f664c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6be6b716-a108-42b2-9a6d-732141676756","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"6be46218-ad79-4bbe-9ddf-2a954a5f2990"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"9de54441-5604-4e8e-adff-5f029aeca834","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"fcfe334d-52df-48ef-9b1a-f130e700697f"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e"},{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"830bab21-198a-4875-88fa-749b57dbe511","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"3e21f753-bc67-4e4c-81bf-17ff5ace0f8c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_f749fc63_17aa_4814_a56b_c45ca8be030e"},{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"cae5e3a5-98a5-45c4-b5a1-d9c162475c9d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"2018e0a5-2448-4823-9f5d-9b7d415ea75e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c5a90ef7-3310-4763-91d7-04ef44f70d46","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"cca906a5-5e79-422e-b15f-7391a907ad07"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b0cc4a91-ed99-40b4-9cb2-0241be934522","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"384cf3d8-e940-43f1-a289-6c6b363c5371"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"89b659df-ccfb-4d5e-8bcb-dd409f051646","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ede534ee-8fa9-477c-bed7-0560ef1e6972","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"3ebb6fd9-8598-43d3-a205-e52f1b659c6b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_a1ec0f17_c623_4c1b_bb5f_c9672dfa6fea","uuid":"da039607-7393-4ea0-abc1-7ba049370f35"},"name":"SYS_GEN__Runbook_Application_a1ec0f17_c623_4c1b_bb5f_c9672dfa6fea"}},{"description":"System action for starting an application","message_list":[],"uuid":"1b024313-9758-4a19-b874-04e58a344cc1","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"VMware","uuid":"a1ec0f17-c623-4c1b-bb5f-c9672dfa6fea"},"retries":"0","description":"","type":"DAG","uuid":"e2a6e2f3-bd88-44c4-9e9a-e4fb18165607","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"cab09067-d34a-4fc0-b308-fad6901eab28"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"b373a358-693d-47f4-95c2-13cae528e116"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"b6b42e7c-bea8-4150-bd26-bf3d693bb3c2"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"06864f35-668d-4f95-bb67-0dc2c00579d1"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"cab09067-d34a-4fc0-b308-fad6901eab28"},"edge_type":"inherent","type":"","uuid":"b4e4ddcf-cf91-4a7b-a3d4-ce62c6064f98","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"b6b42e7c-bea8-4150-bd26-bf3d693bb3c2"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"b373a358-693d-47f4-95c2-13cae528e116"},"edge_type":"inherent","type":"","uuid":"e0d1738f-51bc-48d9-a7fd-af51a63bf6c3","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"06864f35-668d-4f95-bb67-0dc2c00579d1"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_a1ec0f17_c623_4c1b_bb5f_c9672dfa6fea"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"cab09067-d34a-4fc0-b308-fad6901eab28","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"25f55a73-4233-48f8-98dd-fee0fe4e8d86"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b373a358-693d-47f4-95c2-13cae528e116","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"67a13373-5646-4286-aa8a-0d588dea4db1"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b6b42e7c-bea8-4150-bd26-bf3d693bb3c2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"06864f35-668d-4f95-bb67-0dc2c00579d1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"fea4bc13-14fe-4d50-9588-69cdddc13f6f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_a1ec0f17_c623_4c1b_bb5f_c9672dfa6fea","uuid":"e2a6e2f3-bd88-44c4-9e9a-e4fb18165607"},"name":"SYS_GEN__Runbook_Application_a1ec0f17_c623_4c1b_bb5f_c9672dfa6fea"}},{"description":"System action for restarting an application","message_list":[],"uuid":"936679af-fad5-4bf7-8fcb-10177cce7332","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"VMware","uuid":"a1ec0f17-c623-4c1b-bb5f-c9672dfa6fea"},"retries":"0","description":"","type":"DAG","uuid":"bafeab5d-238c-466b-bee9-04ec03a964bb","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"304b88ed-dd3a-45d8-a9f4-51adc1f1d743"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"01f84b44-3e8f-444a-a578-a37f5f166b10"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"b03893b2-0792-44a8-b856-746de6609f24"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"c02a2f51-5a9e-44dd-8037-03f43af3fb25"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"01f84b44-3e8f-444a-a578-a37f5f166b10"},"edge_type":"inherent","type":"","uuid":"ba623ba9-f388-4886-b04a-9f9f61be302f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"b03893b2-0792-44a8-b856-746de6609f24"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"304b88ed-dd3a-45d8-a9f4-51adc1f1d743"},"edge_type":"inherent","type":"","uuid":"5500b259-f13c-4446-8702-62cd5ca8e946","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"c02a2f51-5a9e-44dd-8037-03f43af3fb25"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_a1ec0f17_c623_4c1b_bb5f_c9672dfa6fea"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"304b88ed-dd3a-45d8-a9f4-51adc1f1d743","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"15b93666-3488-4333-bf74-fc334f09cab5"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"01f84b44-3e8f-444a-a578-a37f5f166b10","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"9f8d6201-6117-45d8-8f90-2e2ed20d04ff"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b03893b2-0792-44a8-b856-746de6609f24","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"ca8cec47-f6e6-4ffb-83f1-eb67ddbb98e2"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c02a2f51-5a9e-44dd-8037-03f43af3fb25","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"ce602c49-d9cd-44d7-8e10-5671dc407b8b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"aa0700ff-9391-4c3c-bb2a-01a0def06438","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_a1ec0f17_c623_4c1b_bb5f_c9672dfa6fea","uuid":"bafeab5d-238c-466b-bee9-04ec03a964bb"},"name":"SYS_GEN__Runbook_Application_a1ec0f17_c623_4c1b_bb5f_c9672dfa6fea"}},{"description":"System action for stopping an application","message_list":[],"uuid":"d9a6f1d2-6b26-4b68-af32-38ce3b5da413","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"VMware","uuid":"a1ec0f17-c623-4c1b-bb5f-c9672dfa6fea"},"retries":"0","description":"","type":"DAG","uuid":"f4da8a54-5104-4264-9836-34e6d61a18b8","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"1e3db8c6-1db5-4d24-9dbe-6b1b823fc2fc"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"59b48328-74af-4f84-bc9c-c248606803e8"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"06a289d6-149f-44ef-a6ea-5d8bae518ea1"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"ef0b098b-a64d-4c57-b01a-03ff27c4c7a3"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"1e3db8c6-1db5-4d24-9dbe-6b1b823fc2fc"},"edge_type":"inherent","type":"","uuid":"5c889393-836c-4a57-9cb8-87496411e6c5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"06a289d6-149f-44ef-a6ea-5d8bae518ea1"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"59b48328-74af-4f84-bc9c-c248606803e8"},"edge_type":"inherent","type":"","uuid":"97708644-3cae-4add-ae6f-8bfe711c3270","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"ef0b098b-a64d-4c57-b01a-03ff27c4c7a3"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_a1ec0f17_c623_4c1b_bb5f_c9672dfa6fea"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1e3db8c6-1db5-4d24-9dbe-6b1b823fc2fc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"59b48328-74af-4f84-bc9c-c248606803e8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"06a289d6-149f-44ef-a6ea-5d8bae518ea1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"07a3e2fe-6213-4f82-a186-0f81f54986b3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ef0b098b-a64d-4c57-b01a-03ff27c4c7a3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"644f71ed-0955-47b3-9f2b-9b722a177a08"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e"}],"description":"","message_list":[],"uuid":"d186b694-2c34-4d46-81e8-cc926fd28b2e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_a1ec0f17_c623_4c1b_bb5f_c9672dfa6fea","uuid":"f4da8a54-5104-4264-9836-34e6d61a18b8"},"name":"SYS_GEN__Runbook_Application_a1ec0f17_c623_4c1b_bb5f_c9672dfa6fea"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"42141ab4-a5d5-4f78-8dfc-f4061fec1c23","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"VMware","uuid":"a1ec0f17-c623-4c1b-bb5f-c9672dfa6fea"},"retries":"0","description":"","type":"DAG","uuid":"59e0c4b3-1e56-4cfa-9b0b-ca5b7bdd35a5","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"3746e2ae-16b8-4b70-ba67-074ccf6906d0"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"10d20041-6564-43af-a0c4-75206f150c89"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"ddfcb8dd-f529-41f5-be26-eda2c3fb3da0"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"48186e13-460b-4eea-956b-f5484121f2c2"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"3293e24d-f76e-473f-b21d-aa665aa81a8f"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"54010ad8-635e-4239-87f1-37cbb6728670"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"2d5512e6-c5b7-475f-9367-901820e9a73b"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"580da066-aeac-4746-a970-a59c7b85474b"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_e51f257b_fa1f_4293_8b25_64b1e57d824e","uuid":"11a71d53-0da6-4732-bfca-1e3a0675edfb"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_4b3985c8_846b_4321_9603_db0b165c02a9","uuid":"9dbc301b-3876-42d5-b414-7297d08ebcc3"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"3746e2ae-16b8-4b70-ba67-074ccf6906d0"},"edge_type":"inherent","type":"","uuid":"58fad483-ef09-4b98-bbff-2e0983000ceb","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"ddfcb8dd-f529-41f5-be26-eda2c3fb3da0"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"ddfcb8dd-f529-41f5-be26-eda2c3fb3da0"},"edge_type":"inherent","type":"","uuid":"c3e70aef-761f-4578-9997-2ee12d4c26ea","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"3293e24d-f76e-473f-b21d-aa665aa81a8f"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"3293e24d-f76e-473f-b21d-aa665aa81a8f"},"edge_type":"inherent","type":"","uuid":"6b126d2d-26d6-46fe-aa69-bd68af078037","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"580da066-aeac-4746-a970-a59c7b85474b"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"580da066-aeac-4746-a970-a59c7b85474b"},"edge_type":"inherent","type":"","uuid":"3e9809d3-0cdb-4de3-b62d-fb4666518750","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_4b3985c8_846b_4321_9603_db0b165c02a9","uuid":"9dbc301b-3876-42d5-b414-7297d08ebcc3"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"10d20041-6564-43af-a0c4-75206f150c89"},"edge_type":"inherent","type":"","uuid":"ced911f2-7dea-42da-98f1-b71fde096546","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"48186e13-460b-4eea-956b-f5484121f2c2"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"48186e13-460b-4eea-956b-f5484121f2c2"},"edge_type":"inherent","type":"","uuid":"0003b125-1a29-4c24-882f-8483deaf8aa7","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"54010ad8-635e-4239-87f1-37cbb6728670"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"2d5512e6-c5b7-475f-9367-901820e9a73b"},"edge_type":"inherent","type":"","uuid":"92da2d72-9998-41ef-a878-4a4dec175bac","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_e51f257b_fa1f_4293_8b25_64b1e57d824e","uuid":"11a71d53-0da6-4732-bfca-1e3a0675edfb"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"54010ad8-635e-4239-87f1-37cbb6728670"},"edge_type":"inherent","type":"","uuid":"7f0eb5d4-5efa-459b-9f60-6a536642084e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"2d5512e6-c5b7-475f-9367-901820e9a73b"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"3293e24d-f76e-473f-b21d-aa665aa81a8f"},"edge_type":"create_action_edge","type":"","uuid":"868bbb95-6ce2-4323-8c7c-03d86230d35d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"2d5512e6-c5b7-475f-9367-901820e9a73b"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"54010ad8-635e-4239-87f1-37cbb6728670"},"edge_type":"create_action_edge","type":"","uuid":"125db5f3-24f5-4f41-b81e-3d4f754dc0b6","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"580da066-aeac-4746-a970-a59c7b85474b"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"ddfcb8dd-f529-41f5-be26-eda2c3fb3da0"},"edge_type":"dependency","type":"","uuid":"dd872b2d-a834-471a-a3cd-48eb71b21d09","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"54010ad8-635e-4239-87f1-37cbb6728670"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_a1ec0f17_c623_4c1b_bb5f_c9672dfa6fea"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3746e2ae-16b8-4b70-ba67-074ccf6906d0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"10d20041-6564-43af-a0c4-75206f150c89","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ddfcb8dd-f529-41f5-be26-eda2c3fb3da0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"7f713d48-74e9-4bb6-8dc9-eb8f00371ff3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"48186e13-460b-4eea-956b-f5484121f2c2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"843ab0a6-03bd-4b9c-8f56-7d852e9348e0"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3293e24d-f76e-473f-b21d-aa665aa81a8f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"3fe526fc-375b-4cfb-8e10-d1106f31be90"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e"},{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"54010ad8-635e-4239-87f1-37cbb6728670","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"d28d4dd3-fd12-4200-afe4-2f9ef7fe25c8"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_f749fc63_17aa_4814_a56b_c45ca8be030e"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2d5512e6-c5b7-475f-9367-901820e9a73b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"83c91941-5cb1-42d9-a60b-424569feeebb"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"580da066-aeac-4746-a970-a59c7b85474b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"4e9fd739-21aa-425a-9f39-519a0c3fcd5c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"11a71d53-0da6-4732-bfca-1e3a0675edfb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_e51f257b_fa1f_4293_8b25_64b1e57d824e"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"9dbc301b-3876-42d5-b414-7297d08ebcc3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_4b3985c8_846b_4321_9603_db0b165c02a9"}],"description":"","message_list":[],"uuid":"6e620a00-de20-4563-85d0-5d0ef7577661","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_a1ec0f17_c623_4c1b_bb5f_c9672dfa6fea","uuid":"59e0c4b3-1e56-4cfa-9b0b-ca5b7bdd35a5"},"name":"SYS_GEN__Runbook_Application_a1ec0f17_c623_4c1b_bb5f_c9672dfa6fea"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"2a07ec14-45e0-42b4-abf0-74a3e93c087d","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"VMware","uuid":"a1ec0f17-c623-4c1b-bb5f-c9672dfa6fea"},"retries":"0","description":"","type":"DAG","uuid":"6c8928b7-595f-4ba2-a3a4-91b2cd5498c5","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"874f4e42-72a1-42ae-8d77-ac2eb72566ff"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"367cdc06-4d50-466b-ad23-f7731a3edace"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"898ab521-fa80-4adc-8e84-18fa6821b832"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"43f4321a-7897-4ec1-8fb0-1080275fa01e"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"819c4e96-f55e-4c0e-b964-177bb12e6ee7"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"d816bc4a-9709-4f61-8b0c-4c886a84d05b"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_4b3985c8_846b_4321_9603_db0b165c02a9","uuid":"e158bb5c-845f-447b-86ce-907b7ff61f5d"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_e51f257b_fa1f_4293_8b25_64b1e57d824e","uuid":"057e706c-1e0b-4f76-851b-07e63886ad45"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"367cdc06-4d50-466b-ad23-f7731a3edace"},"edge_type":"inherent","type":"","uuid":"5845fc83-9ef1-4457-bc24-f1f759841aa7","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"43f4321a-7897-4ec1-8fb0-1080275fa01e"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"d816bc4a-9709-4f61-8b0c-4c886a84d05b"},"edge_type":"inherent","type":"","uuid":"744f7121-9023-4db0-9caa-4f9999926d0f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_4b3985c8_846b_4321_9603_db0b165c02a9","uuid":"e158bb5c-845f-447b-86ce-907b7ff61f5d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"43f4321a-7897-4ec1-8fb0-1080275fa01e"},"edge_type":"inherent","type":"","uuid":"5380f871-15f7-4bed-aa37-1ed0811af9b5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"d816bc4a-9709-4f61-8b0c-4c886a84d05b"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"874f4e42-72a1-42ae-8d77-ac2eb72566ff"},"edge_type":"inherent","type":"","uuid":"e39c814d-bd48-43e4-b692-6cf666b1abd4","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"898ab521-fa80-4adc-8e84-18fa6821b832"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"819c4e96-f55e-4c0e-b964-177bb12e6ee7"},"edge_type":"inherent","type":"","uuid":"4ddbfb9a-0da1-4282-97a8-a846cbd97731","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_e51f257b_fa1f_4293_8b25_64b1e57d824e","uuid":"057e706c-1e0b-4f76-851b-07e63886ad45"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"898ab521-fa80-4adc-8e84-18fa6821b832"},"edge_type":"inherent","type":"","uuid":"37872f79-4e5d-4959-a80c-0d5b1e78a3d4","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"819c4e96-f55e-4c0e-b964-177bb12e6ee7"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"43f4321a-7897-4ec1-8fb0-1080275fa01e"},"edge_type":"create_action_edge","type":"","uuid":"f61ed068-60ca-412a-a06e-2149aba9294a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"819c4e96-f55e-4c0e-b964-177bb12e6ee7"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"898ab521-fa80-4adc-8e84-18fa6821b832"},"edge_type":"create_action_edge","type":"","uuid":"8d1f9514-9c91-4f9f-9249-7e52da1d25be","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"d816bc4a-9709-4f61-8b0c-4c886a84d05b"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_a1ec0f17_c623_4c1b_bb5f_c9672dfa6fea"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"874f4e42-72a1-42ae-8d77-ac2eb72566ff","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"716ea7a7-bc0c-4ac5-ab9c-720c327a498e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"367cdc06-4d50-466b-ad23-f7731a3edace","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"2064d305-852a-47aa-89b9-7415f90c2152"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"898ab521-fa80-4adc-8e84-18fa6821b832","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_f749fc63_17aa_4814_a56b_c45ca8be030e"},{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"43f4321a-7897-4ec1-8fb0-1080275fa01e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_78d59e2e_ea58_482a_a2b2_6f593da4049e"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"819c4e96-f55e-4c0e-b964-177bb12e6ee7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e","uuid":"82dd31a7-9d9a-49c3-a1a8-8dfa67efb61b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_4c3514f2_78b2_46b7_ba50_05f323515a8e"},{"target_any_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d816bc4a-9709-4f61-8b0c-4c886a84d05b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d","uuid":"4a67affe-ed94-4ed1-ab4d-cdab23eac0cc"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_eb19b05b_0c58_438e_aed0_2efba5c2019d"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment_cloned_0","uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"e158bb5c-845f-447b-86ce-907b7ff61f5d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_4b3985c8_846b_4321_9603_db0b165c02a9"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment_cloned_0","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"057e706c-1e0b-4f76-851b-07e63886ad45","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_e51f257b_fa1f_4293_8b25_64b1e57d824e"}],"description":"","message_list":[],"uuid":"4a5fe732-eb9b-4615-908b-4e8f353387cb","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_a1ec0f17_c623_4c1b_bb5f_c9672dfa6fea","uuid":"6c8928b7-595f-4ba2-a3a4-91b2cd5498c5"},"name":"SYS_GEN__Runbook_Application_a1ec0f17_c623_4c1b_bb5f_c9672dfa6fea"}}],"message_list":[],"uuid":"a1ec0f17-c623-4c1b-bb5f-c9672dfa6fea","state":"ACTIVE","dependency_list":[{"getter_resource_kind":"PackageCfg","setter_resource_attr":"address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"VMware_Centos_K8SW","action_name":"action_create","action_resource_name":"VMware","getter_resource_name":"VMware_Centos_K8SM_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"VMware_Centos_K8SM","action_name":"action_create","action_resource_name":"VMware","getter_resource_name":"VMware_Centos_K8SW_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"address","setter_resource_kind":"ServiceCfg","setter_resource_name":"Kubernetes_Master","action_name":"action_delete","action_resource_name":"VMware","getter_resource_name":"VMware_Centos_K8SW_Package","action_resource_kind":"ApplicationCfg"}],"variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"61f5cb6e-b1f4-4696-99e2-5e29ba0fda24","value":"vmware-kubenetes-cluster","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_CLUSTER_NAME"},{"regex":{"should_validate":true,"value":"^v1\\.[0-9]?[0-9]\\.[0-9]?[0-9]$"},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"242ab196-7a93-4a1b-b131-58178311ae91","value":"v1.9.11","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_VERSION"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"ab81f35c-8e24-46b8-bc48-923c0a7a8093","value":"17.03.3.ce","label":"","state":"ACTIVE","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{"type":"PREDEFINED","choices":["17.03.3.ce","17.06.2.ce","17.09.1.ce","17.12.1.ce","18.03.1.ce","18.06.3.ce"]},"name":"DOCKER_VERSION"},{"regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\\/\\d{1,2}$"},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"19a52dd5-04c6-4358-8382-7429130abf09","value":"10.200.0.0\/16","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_CLUSTER_SUBNET"},{"regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\\/\\d{1,2}$"},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"b7e59261-7a0c-4f27-badc-d66057fd0953","value":"10.32.0.0\/24","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_SERVICE_SUBNET"},{"regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$"},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"233d7887-4060-451d-a0d3-6f998a339f24","value":"10.32.0.10","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_DNS_IP"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"d1238e53-69cb-4283-9c7c-d8ece2ca8c49","value":"flannel","label":"","state":"ACTIVE","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{"type":"PREDEFINED","choices":["flannel","canal","calico"]},"name":"KUBE_CNI_PLUGIN"},{"regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$"},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"f1163ab1-219d-4bfb-a887-6177a5c5f73d","value":"10.46.33.177","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"PE_CLUSTER_IP"},{"regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$"},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"cc1ce60a-200c-4418-b260-7e2f3e1a8cf4","value":"10.46.33.4","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"PE_DATA_SERVICE_IP"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"064697b0-4c94-483b-a6f3-0b0d6908a2f9","value":"admin","label":"","state":"ACTIVE","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"PE_USERNAME"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"d9cf57f5-c30c-4f86-a63f-b02f4824c49b","value":"","label":"","state":"ACTIVE","attrs":{"is_secret_modified":false,"secret_reference":{"uuid":"ec136eb9-4049-4857-85df-5ef8f13193b4"},"type":""},"editables":{"value":true},"is_hidden":false,"type":"SECRET","options":{},"name":"PE_PASSWORD"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"2efcb003-0592-4bbd-a5b8-eacf660172b0","value":"default-container-71224","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"PE_CONTAINER_NAME"}],"name":"VMware"}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"CENTOS","uuid":"70ea3312-6ea8-4ace-9433-d77766f00ba2"},"package_definition_list":[{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"189484f4-980c-403c-85db-506ce82141dc","name":"action_install","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"},"retries":"0","description":"","type":"DAG","uuid":"bfa33070-a485-4c37-aab4-7d0a7f5cac75","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Install_Crb_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"7105bd3e-4097-42d9-ab76-c56468587154"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_22e18386_fa75_402e_9fd9_aa32056cb746"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_INSTALL","uuid":"7105bd3e-4097-42d9-ab76-c56468587154","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"},"retries":"0","description":"","type":"DAG","uuid":"8fe8c5d1-5aaa-48f6-a089-811b9d7d0d0e","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"fe928d5c-3674-4e54-be1a-ceff751b83fc"},{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"60a50e8a-e2fb-4d88-82f7-e0821461371b"},{"kind":"app_task","name":"Generate Certs","uuid":"3cc49ad3-44d3-4b81-8252-af87eb1816e6"},{"kind":"app_task","name":"Configure Services","uuid":"056a3681-f7b5-4937-9f8c-83ec8c45e753"},{"kind":"app_task","name":"Add User Roles","uuid":"13077133-beda-4566-ac35-e637c8d504ed"},{"kind":"app_task","name":"Network Configuration","uuid":"8fab44c0-5cd6-4e36-9b77-db6fd8fd6993"},{"kind":"app_task","name":"DNS Configuration","uuid":"edeb2357-deeb-49ae-be66-7d6066b60c7f"},{"kind":"app_task","name":"NVP Configuration","uuid":"bff2dae4-0d71-404e-ab32-cd4db81a887a"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"fe928d5c-3674-4e54-be1a-ceff751b83fc"},"edge_type":"user_defined","type":"","uuid":"36d1c5b8-2355-426c-ba27-903ebbf6b195","to_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"60a50e8a-e2fb-4d88-82f7-e0821461371b"}},{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"60a50e8a-e2fb-4d88-82f7-e0821461371b"},"edge_type":"user_defined","type":"","uuid":"1a31216d-aa38-42ed-a18a-60226580df1a","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"3cc49ad3-44d3-4b81-8252-af87eb1816e6"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"3cc49ad3-44d3-4b81-8252-af87eb1816e6"},"edge_type":"user_defined","type":"","uuid":"3ba5aff3-4ae7-4fee-b071-1fe06251fcb9","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"056a3681-f7b5-4937-9f8c-83ec8c45e753"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"056a3681-f7b5-4937-9f8c-83ec8c45e753"},"edge_type":"user_defined","type":"","uuid":"1bf63fa5-1194-4c46-a9e1-60dcdb5c8132","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"13077133-beda-4566-ac35-e637c8d504ed"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"13077133-beda-4566-ac35-e637c8d504ed"},"edge_type":"user_defined","type":"","uuid":"cf6f6dce-44a8-4ea2-a099-40684682c7bf","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"8fab44c0-5cd6-4e36-9b77-db6fd8fd6993"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"8fab44c0-5cd6-4e36-9b77-db6fd8fd6993"},"edge_type":"user_defined","type":"","uuid":"e6445df3-e8d2-4fc6-a974-b1021fd35bff","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"edeb2357-deeb-49ae-be66-7d6066b60c7f"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"edeb2357-deeb-49ae-be66-7d6066b60c7f"},"edge_type":"user_defined","type":"","uuid":"691a7fe4-bc87-472c-9b45-a30fba2ac0c8","to_task_reference":{"kind":"app_task","name":"NVP Configuration","uuid":"bff2dae4-0d71-404e-ab32-cd4db81a887a"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"dac441af_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"fe928d5c-3674-4e54-be1a-ceff751b83fc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"60a50e8a-e2fb-4d88-82f7-e0821461371b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\ncount=0\n# Verify access to Centos mirror before yum update\ncheck_mirror() {\ncurl -s mirrorlist.centos.org >\/dev\/null | true\nif [ \"${PIPESTATUS[0]}\" -ne 0 ]; then\n    if [ ${count} -lt 60 ]; then\n        echo \"Sleeping for 5 seconds before repeating the check\" | sudo tee -a \/var\/log\/messages\n        sleep 5\n        count=$((count+1))\n        check_mirror\n    else\n        echo \"DNS resolution failed after 5 minutes, exiting\" | sudo tee -a \/var\/log\/messages\n        exit 1\n    fi\nfi\n}\ncheck_mirror\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.3.12\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_IPS=\"@@{AHV_Centos_K8SW.address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} master${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"master${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  count=$((count+1))\ndone  \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\necho \"if \\$programname == 'etcd' then \/var\/log\/etcd.log\n& stop\" | sudo tee \/etc\/rsyslog.d\/etcd.conf\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"if \\$programname == 'kubelet' then \/var\/log\/kubelet.log\n& stop\" | sudo tee \/etc\/rsyslog.d\/kubelet.conf\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate etcd \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/sd{e,f,g}\nsudo vgcreate docker \/dev\/sd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"3cc49ad3-44d3-4b81-8252-af87eb1816e6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_IPS=\"@@{AHV_Centos_K8SW.address}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"master${count}\",\n  count=$((count+1))\ndone\n\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"worker${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_NAMES},${MASTER_IPS},${MINION_NAMES},${WORKER_IPS},${FIRST_IP_SERVICE_SUBNET},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local -profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\ninstance=\"master${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=master${count}.kubeconfig\nkubectl config set-credentials system:node:master${count} --client-certificate=master${count}.pem --client-key=master${count}-key.pem --embed-certs=true --kubeconfig=master${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:master${count} --kubeconfig=master${count}.kubeconfig\nkubectl config use-context default --kubeconfig=master${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"master${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"056a3681-f7b5-4937-9f8c-83ec8c45e753","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nCONTROLLER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=${KUBE_CLUSTER_NAME}\n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n    \necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"13077133-beda-4566-ac35-e637c8d504ed","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet iscsid\nsudo systemctl enable etcd docker kubelet iscsid\nsudo systemctl restart rsyslog\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem master* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"8fab44c0-5cd6-4e36-9b77-db6fd8fd6993","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ]]; then\nsudo mkdir -p \/etc\/kubernetes\/addons\/canal\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: canal-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  canal_iface: \"\"\n\n  masquerade: \"true\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: canal\n  namespace: kube-system\n  labels:\n    k8s-app: canal\nspec:\n  selector:\n    matchLabels:\n      k8s-app: canal\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: canal\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: canal\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-canal.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              value: \"none\"\n            - name: CLUSTER_TYPE\n              value: \"k8s,canal\"\n            - name: FELIX_IPTABLESREFRESHINTERVAL\n              value: \"60\"\n            - name: IP\n              value: \"\"\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"192.168.0.0\/16\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: \/readiness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n        - name: kube-flannel\n          image: quay.io\/coreos\/flannel:v0.9.1\n          command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n          securityContext:\n            privileged: true\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: FLANNELD_IFACE\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: canal_iface\n            - name: FLANNELD_IP_MASQ\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: masquerade\n          volumeMounts:\n          - mountPath: \/run\/xtables.lock\n            name: xtables-lock\n            readOnly: false\n          - name: flannel-cfg\n            mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: flannel-cfg\n          configMap:\n            name: canal-config\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: canal\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: canal-flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: canal-calico\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/canal\/canal.yml\nkubectl create -f \/etc\/kubernetes\/addons\/canal\/canal.yml\n\nelif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]];then\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/calico\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  calico_backend: \"bird\"\n\n  veth_mtu: \"1440\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: calico-node\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-calico.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CNI_MTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s,bgp\"\n            - name: IP\n              value: \"autodetect\"\n            - name: CALICO_IPV4POOL_IPIP\n              value: \"Always\"\n            - name: FELIX_IPINIPMTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"@@{KUBE_CLUSTER_SUBNET}@@\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            exec:\n              command:\n              - \/bin\/calico-node\n              - -bird-ready\n              - -felix-ready\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPPeer\n    plural: bgppeers\n    singular: bgppeer\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/calico\/calico.yml\nkubectl create -f \/etc\/kubernetes\/addons\/calico\/calico.yml  \n\nelse\n  echo \"Defaulting to flannel\"\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n  - kind: ServiceAccount\n    name: flannel\n    namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"hairpinMode\": true,\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - \/opt\/bin\/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n          limits:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/bin\/sh\", \"-c\", \"set -e -x; cp -f \/etc\/kube-flannel\/cni-conf.json \/etc\/cni\/net.d\/10-flannel.conf; while true; do sleep 3600; done\" ]\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nfi\n\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"edeb2357-deeb-49ae-be66-7d6066b60c7f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n  - name: dns\n    port: 53\n    protocol: UDP\n  - name: dns-tcp\n    port: 53\n    protocol: TCP\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: k8s.gcr.io\/k8s-dns-kube-dns:1.14.13\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: k8s.gcr.io\/k8s-dns-dnsmasq-nanny:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --no-negcache\n        - --dns-loop-detect\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: k8s.gcr.io\/k8s-dns-sidecar:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local,5,SRV\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local,5,SRV\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy: Default\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.2.0\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          - --target=Deployment\/kube-dns\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"bff2dae4-0d71-404e-ab32-cd4db81a887a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nPRISM_CLUSTER_IP=\"@@{PE_CLUSTER_IP}@@\"\nPRISM_DATA_SERVICE_IP=\"@@{PE_CLUSTER_IP}@@\"\n\nif [[ (\"${PRISM_CLUSTER_IP}x\" == \"x\") && (\"${PRISM_DATA_SERVICE_IP}x\" == \"x\") ]]; then exit 0; fi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/volume_plugin\nNTNX_SECRET=$(echo -n \"@@{PE_USERNAME}@@:@@{PE_PASSWORD}@@\" | base64)\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: nutanixabs-provisioner-runner\n  namespace: kube-system\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumes\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumeclaims\"]\n    verbs: [\"get\", \"list\", \"watch\", \"update\"]\n  - apiGroups: [\"storage.k8s.io\"]\n    resources: [\"storageclasses\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"list\", \"watch\", \"create\", \"update\", \"patch\"]\n  - apiGroups: [\"\"]\n    resources: [\"services\"]\n    verbs: [\"get\"]\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"create\", \"delete\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: run-nutanixabs-provisioner\n  namespace: kube-system\nsubjects:\n  - kind: ServiceAccount\n    name: nutanixabs-provisioner\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: nutanixabs-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      labels:\n        app: nutanixabs-provisioner\n    spec:\n      serviceAccount: nutanixabs-provisioner\n      hostNetwork: true\n      containers:\n        -\n          image: \"ntnx\/nutanixabs-provisioner\"\n          name: nutanixabs-provisioner\n          args: [\"--v=4\"]\n          imagePullPolicy: IfNotPresent\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: kube-system\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\n---\nkind: StorageClass\napiVersion: storage.k8s.io\/v1\nmetadata:\n  name: silver \n  namespace: kube-system\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\nprovisioner: nutanix\/abs\nparameters:\n     prismEndPoint: @@{PE_CLUSTER_IP}@@:9440\n     dataServiceEndPoint: @@{PE_DATA_SERVICE_IP}@@:3260\n     secretName: ntnx-secret\n     storageContainer: @@{PE_CONTAINER_NAME}@@\n     fsType: ext4\n     chapAuthEnabled: \"false\"' | sudo tee \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\necho \"apiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: default\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\" | sudo tee -a \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"NVP Configuration"}],"description":"","message_list":[],"uuid":"73124b74-b2af-4082-bec4-7cecb8d5f8bb","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"dac441af_dag","uuid":"8fe8c5d1-5aaa-48f6-a089-811b9d7d0d0e"},"name":"8e760b73_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"},"retries":"0","description":"","type":"DAG","uuid":"c7f90cc3-f508-41b2-a289-7a55fc30de35","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6324786a_dag"}],"description":"","message_list":[],"uuid":"ca5f1ae4-f604-456d-9302-d1c6858e9cca","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6324786a_dag","uuid":"c7f90cc3-f508-41b2-a289-7a55fc30de35"},"name":"6522ac7a_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Install_Crb_22e18386_fa75_402e_9fd9_aa32056cb746"}],"description":"","message_list":[],"uuid":"61b24c4f-ac1b-4182-a03a-b65e157a71bf","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"bfa33070-a485-4c37-aab4-7d0a7f5cac75"},"name":"SYS_GEN__Runbook_Package_22e18386_fa75_402e_9fd9_aa32056cb746"}},{"description":"System action for creating an application","message_list":[],"uuid":"1259dbce-f461-4ebc-8cb5-a4b6a85a9816","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"},"retries":"0","description":"","type":"DAG","uuid":"d9a048f4-6e06-4828-b861-0f3f67f09981","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"b5bc4e32-5c3c-471b-9b44-80cab64e5fe8"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"d2841a7e-5cc4-4f2d-96ed-e335b16797c4"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"d71837f3-eae2-4666-9f9d-d9bdffd4c699"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"d2841a7e-5cc4-4f2d-96ed-e335b16797c4"},"edge_type":"inherent","type":"","uuid":"97c12e38-f4bc-4cd1-8c59-07d33ef1414c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"d71837f3-eae2-4666-9f9d-d9bdffd4c699"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"b5bc4e32-5c3c-471b-9b44-80cab64e5fe8"},"edge_type":"inherent","type":"","uuid":"9dccc637-ef98-4af3-8316-be686d9674db","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"d2841a7e-5cc4-4f2d-96ed-e335b16797c4"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_22e18386_fa75_402e_9fd9_aa32056cb746"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b5bc4e32-5c3c-471b-9b44-80cab64e5fe8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"61b24c4f-ac1b-4182-a03a-b65e157a71bf"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_22e18386_fa75_402e_9fd9_aa32056cb746"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d2841a7e-5cc4-4f2d-96ed-e335b16797c4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"384cf3d8-e940-43f1-a289-6c6b363c5371"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d71837f3-eae2-4666-9f9d-d9bdffd4c699","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"bc07ab5d-07c9-4164-a0f2-8895b48c50d3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"d9a048f4-6e06-4828-b861-0f3f67f09981"},"name":"SYS_GEN__Runbook_Package_22e18386_fa75_402e_9fd9_aa32056cb746"}},{"description":"System action for uninstalling an application","message_list":[],"uuid":"f8f0e7c3-de61-4e01-95e0-ead13da2365f","name":"action_uninstall","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"},"retries":"0","description":"","type":"DAG","uuid":"211b8cbc-246a-4937-a578-16dfdcd85f3a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Uninstall_Crb_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"f862e351-47e1-49be-8960-90e838fcb4b3"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_22e18386_fa75_402e_9fd9_aa32056cb746"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_UNINSTALL","uuid":"f862e351-47e1-49be-8960-90e838fcb4b3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"},"retries":"0","description":"","type":"DAG","uuid":"8fe8c5d1-5aaa-48f6-a089-811b9d7d0d0e","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"fe928d5c-3674-4e54-be1a-ceff751b83fc"},{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"60a50e8a-e2fb-4d88-82f7-e0821461371b"},{"kind":"app_task","name":"Generate Certs","uuid":"3cc49ad3-44d3-4b81-8252-af87eb1816e6"},{"kind":"app_task","name":"Configure Services","uuid":"056a3681-f7b5-4937-9f8c-83ec8c45e753"},{"kind":"app_task","name":"Add User Roles","uuid":"13077133-beda-4566-ac35-e637c8d504ed"},{"kind":"app_task","name":"Network Configuration","uuid":"8fab44c0-5cd6-4e36-9b77-db6fd8fd6993"},{"kind":"app_task","name":"DNS Configuration","uuid":"edeb2357-deeb-49ae-be66-7d6066b60c7f"},{"kind":"app_task","name":"NVP Configuration","uuid":"bff2dae4-0d71-404e-ab32-cd4db81a887a"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"fe928d5c-3674-4e54-be1a-ceff751b83fc"},"edge_type":"user_defined","type":"","uuid":"36d1c5b8-2355-426c-ba27-903ebbf6b195","to_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"60a50e8a-e2fb-4d88-82f7-e0821461371b"}},{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"60a50e8a-e2fb-4d88-82f7-e0821461371b"},"edge_type":"user_defined","type":"","uuid":"1a31216d-aa38-42ed-a18a-60226580df1a","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"3cc49ad3-44d3-4b81-8252-af87eb1816e6"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"3cc49ad3-44d3-4b81-8252-af87eb1816e6"},"edge_type":"user_defined","type":"","uuid":"3ba5aff3-4ae7-4fee-b071-1fe06251fcb9","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"056a3681-f7b5-4937-9f8c-83ec8c45e753"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"056a3681-f7b5-4937-9f8c-83ec8c45e753"},"edge_type":"user_defined","type":"","uuid":"1bf63fa5-1194-4c46-a9e1-60dcdb5c8132","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"13077133-beda-4566-ac35-e637c8d504ed"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"13077133-beda-4566-ac35-e637c8d504ed"},"edge_type":"user_defined","type":"","uuid":"cf6f6dce-44a8-4ea2-a099-40684682c7bf","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"8fab44c0-5cd6-4e36-9b77-db6fd8fd6993"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"8fab44c0-5cd6-4e36-9b77-db6fd8fd6993"},"edge_type":"user_defined","type":"","uuid":"e6445df3-e8d2-4fc6-a974-b1021fd35bff","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"edeb2357-deeb-49ae-be66-7d6066b60c7f"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"edeb2357-deeb-49ae-be66-7d6066b60c7f"},"edge_type":"user_defined","type":"","uuid":"691a7fe4-bc87-472c-9b45-a30fba2ac0c8","to_task_reference":{"kind":"app_task","name":"NVP Configuration","uuid":"bff2dae4-0d71-404e-ab32-cd4db81a887a"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"dac441af_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"fe928d5c-3674-4e54-be1a-ceff751b83fc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"60a50e8a-e2fb-4d88-82f7-e0821461371b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\ncount=0\n# Verify access to Centos mirror before yum update\ncheck_mirror() {\ncurl -s mirrorlist.centos.org >\/dev\/null | true\nif [ \"${PIPESTATUS[0]}\" -ne 0 ]; then\n    if [ ${count} -lt 60 ]; then\n        echo \"Sleeping for 5 seconds before repeating the check\" | sudo tee -a \/var\/log\/messages\n        sleep 5\n        count=$((count+1))\n        check_mirror\n    else\n        echo \"DNS resolution failed after 5 minutes, exiting\" | sudo tee -a \/var\/log\/messages\n        exit 1\n    fi\nfi\n}\ncheck_mirror\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.3.12\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_IPS=\"@@{AHV_Centos_K8SW.address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} master${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"master${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  count=$((count+1))\ndone  \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\necho \"if \\$programname == 'etcd' then \/var\/log\/etcd.log\n& stop\" | sudo tee \/etc\/rsyslog.d\/etcd.conf\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"if \\$programname == 'kubelet' then \/var\/log\/kubelet.log\n& stop\" | sudo tee \/etc\/rsyslog.d\/kubelet.conf\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate etcd \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/sd{e,f,g}\nsudo vgcreate docker \/dev\/sd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"3cc49ad3-44d3-4b81-8252-af87eb1816e6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_IPS=\"@@{AHV_Centos_K8SW.address}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"master${count}\",\n  count=$((count+1))\ndone\n\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"worker${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_NAMES},${MASTER_IPS},${MINION_NAMES},${WORKER_IPS},${FIRST_IP_SERVICE_SUBNET},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local -profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\ninstance=\"master${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=master${count}.kubeconfig\nkubectl config set-credentials system:node:master${count} --client-certificate=master${count}.pem --client-key=master${count}-key.pem --embed-certs=true --kubeconfig=master${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:master${count} --kubeconfig=master${count}.kubeconfig\nkubectl config use-context default --kubeconfig=master${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"master${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"056a3681-f7b5-4937-9f8c-83ec8c45e753","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nCONTROLLER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=${KUBE_CLUSTER_NAME}\n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n    \necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"13077133-beda-4566-ac35-e637c8d504ed","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet iscsid\nsudo systemctl enable etcd docker kubelet iscsid\nsudo systemctl restart rsyslog\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem master* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"8fab44c0-5cd6-4e36-9b77-db6fd8fd6993","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ]]; then\nsudo mkdir -p \/etc\/kubernetes\/addons\/canal\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: canal-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  canal_iface: \"\"\n\n  masquerade: \"true\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: canal\n  namespace: kube-system\n  labels:\n    k8s-app: canal\nspec:\n  selector:\n    matchLabels:\n      k8s-app: canal\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: canal\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: canal\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-canal.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              value: \"none\"\n            - name: CLUSTER_TYPE\n              value: \"k8s,canal\"\n            - name: FELIX_IPTABLESREFRESHINTERVAL\n              value: \"60\"\n            - name: IP\n              value: \"\"\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"192.168.0.0\/16\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: \/readiness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n        - name: kube-flannel\n          image: quay.io\/coreos\/flannel:v0.9.1\n          command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n          securityContext:\n            privileged: true\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: FLANNELD_IFACE\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: canal_iface\n            - name: FLANNELD_IP_MASQ\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: masquerade\n          volumeMounts:\n          - mountPath: \/run\/xtables.lock\n            name: xtables-lock\n            readOnly: false\n          - name: flannel-cfg\n            mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: flannel-cfg\n          configMap:\n            name: canal-config\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: canal\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: canal-flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: canal-calico\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/canal\/canal.yml\nkubectl create -f \/etc\/kubernetes\/addons\/canal\/canal.yml\n\nelif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]];then\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/calico\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  calico_backend: \"bird\"\n\n  veth_mtu: \"1440\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: calico-node\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-calico.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CNI_MTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s,bgp\"\n            - name: IP\n              value: \"autodetect\"\n            - name: CALICO_IPV4POOL_IPIP\n              value: \"Always\"\n            - name: FELIX_IPINIPMTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"@@{KUBE_CLUSTER_SUBNET}@@\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            exec:\n              command:\n              - \/bin\/calico-node\n              - -bird-ready\n              - -felix-ready\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPPeer\n    plural: bgppeers\n    singular: bgppeer\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/calico\/calico.yml\nkubectl create -f \/etc\/kubernetes\/addons\/calico\/calico.yml  \n\nelse\n  echo \"Defaulting to flannel\"\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n  - kind: ServiceAccount\n    name: flannel\n    namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"hairpinMode\": true,\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - \/opt\/bin\/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n          limits:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/bin\/sh\", \"-c\", \"set -e -x; cp -f \/etc\/kube-flannel\/cni-conf.json \/etc\/cni\/net.d\/10-flannel.conf; while true; do sleep 3600; done\" ]\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nfi\n\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"edeb2357-deeb-49ae-be66-7d6066b60c7f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n  - name: dns\n    port: 53\n    protocol: UDP\n  - name: dns-tcp\n    port: 53\n    protocol: TCP\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: k8s.gcr.io\/k8s-dns-kube-dns:1.14.13\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: k8s.gcr.io\/k8s-dns-dnsmasq-nanny:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --no-negcache\n        - --dns-loop-detect\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: k8s.gcr.io\/k8s-dns-sidecar:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local,5,SRV\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local,5,SRV\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy: Default\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.2.0\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          - --target=Deployment\/kube-dns\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"bff2dae4-0d71-404e-ab32-cd4db81a887a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nPRISM_CLUSTER_IP=\"@@{PE_CLUSTER_IP}@@\"\nPRISM_DATA_SERVICE_IP=\"@@{PE_CLUSTER_IP}@@\"\n\nif [[ (\"${PRISM_CLUSTER_IP}x\" == \"x\") && (\"${PRISM_DATA_SERVICE_IP}x\" == \"x\") ]]; then exit 0; fi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/volume_plugin\nNTNX_SECRET=$(echo -n \"@@{PE_USERNAME}@@:@@{PE_PASSWORD}@@\" | base64)\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: nutanixabs-provisioner-runner\n  namespace: kube-system\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumes\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumeclaims\"]\n    verbs: [\"get\", \"list\", \"watch\", \"update\"]\n  - apiGroups: [\"storage.k8s.io\"]\n    resources: [\"storageclasses\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"list\", \"watch\", \"create\", \"update\", \"patch\"]\n  - apiGroups: [\"\"]\n    resources: [\"services\"]\n    verbs: [\"get\"]\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"create\", \"delete\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: run-nutanixabs-provisioner\n  namespace: kube-system\nsubjects:\n  - kind: ServiceAccount\n    name: nutanixabs-provisioner\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: nutanixabs-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      labels:\n        app: nutanixabs-provisioner\n    spec:\n      serviceAccount: nutanixabs-provisioner\n      hostNetwork: true\n      containers:\n        -\n          image: \"ntnx\/nutanixabs-provisioner\"\n          name: nutanixabs-provisioner\n          args: [\"--v=4\"]\n          imagePullPolicy: IfNotPresent\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: kube-system\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\n---\nkind: StorageClass\napiVersion: storage.k8s.io\/v1\nmetadata:\n  name: silver \n  namespace: kube-system\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\nprovisioner: nutanix\/abs\nparameters:\n     prismEndPoint: @@{PE_CLUSTER_IP}@@:9440\n     dataServiceEndPoint: @@{PE_DATA_SERVICE_IP}@@:3260\n     secretName: ntnx-secret\n     storageContainer: @@{PE_CONTAINER_NAME}@@\n     fsType: ext4\n     chapAuthEnabled: \"false\"' | sudo tee \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\necho \"apiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: default\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\" | sudo tee -a \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"NVP Configuration"}],"description":"","message_list":[],"uuid":"73124b74-b2af-4082-bec4-7cecb8d5f8bb","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"dac441af_dag","uuid":"8fe8c5d1-5aaa-48f6-a089-811b9d7d0d0e"},"name":"8e760b73_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"},"retries":"0","description":"","type":"DAG","uuid":"c7f90cc3-f508-41b2-a289-7a55fc30de35","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6324786a_dag"}],"description":"","message_list":[],"uuid":"ca5f1ae4-f604-456d-9302-d1c6858e9cca","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6324786a_dag","uuid":"c7f90cc3-f508-41b2-a289-7a55fc30de35"},"name":"6522ac7a_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Uninstall_Crb_22e18386_fa75_402e_9fd9_aa32056cb746"}],"description":"","message_list":[],"uuid":"65e26ed0-c793-48d7-ad16-695573871526","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"211b8cbc-246a-4937-a578-16dfdcd85f3a"},"name":"SYS_GEN__Runbook_Package_22e18386_fa75_402e_9fd9_aa32056cb746"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"0920119a-a517-48c1-ae73-4a6cc3e56864","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"},"retries":"0","description":"","type":"DAG","uuid":"eabb54d1-f9d3-44f9-8602-e41b9bc37dc2","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"fd34f219-a7bb-4d1f-b26c-1911a71b1e47"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"a08cfee3-e4c2-41f1-9d20-a6d6de816eb5"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"7eda69f7-126d-4a65-9df0-217dd41e6ce4"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"fd34f219-a7bb-4d1f-b26c-1911a71b1e47"},"edge_type":"inherent","type":"","uuid":"f51bb93c-d846-49d8-b011-601199162568","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"a08cfee3-e4c2-41f1-9d20-a6d6de816eb5"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"a08cfee3-e4c2-41f1-9d20-a6d6de816eb5"},"edge_type":"inherent","type":"","uuid":"1dc9b84d-b894-4c2e-917a-dbec6b57bc8f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"7eda69f7-126d-4a65-9df0-217dd41e6ce4"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_22e18386_fa75_402e_9fd9_aa32056cb746"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"fd34f219-a7bb-4d1f-b26c-1911a71b1e47","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a08cfee3-e4c2-41f1-9d20-a6d6de816eb5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"7f713d48-74e9-4bb6-8dc9-eb8f00371ff3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"7eda69f7-126d-4a65-9df0-217dd41e6ce4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"65e26ed0-c793-48d7-ad16-695573871526"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_22e18386_fa75_402e_9fd9_aa32056cb746"}],"description":"","message_list":[],"uuid":"2a8320a4-1c76-4792-b3dc-d2c3d1e95e4f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"eabb54d1-f9d3-44f9-8602-e41b9bc37dc2"},"name":"SYS_GEN__Runbook_Package_22e18386_fa75_402e_9fd9_aa32056cb746"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"a6a76c04-d5cc-49a3-b99a-b4fd94ee1542","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"},"retries":"0","description":"","type":"DAG","uuid":"fb03f644-25ae-478a-95d7-de0b0d9908bf","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"6e73cead-a006-42e8-acec-cb0001d42d18"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"706489ff-5373-406e-bb95-0316cdefe086"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"6e73cead-a006-42e8-acec-cb0001d42d18"},"edge_type":"inherent","type":"","uuid":"d0549cc6-06f0-4b05-8a55-80cffd103140","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"706489ff-5373-406e-bb95-0316cdefe086"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_22e18386_fa75_402e_9fd9_aa32056cb746"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6e73cead-a006-42e8-acec-cb0001d42d18","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"2064d305-852a-47aa-89b9-7415f90c2152"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"706489ff-5373-406e-bb95-0316cdefe086","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_22e18386_fa75_402e_9fd9_aa32056cb746"}],"description":"","message_list":[],"uuid":"b58ea9c9-758f-4ef1-ba98-d183da17dd7e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"fb03f644-25ae-478a-95d7-de0b0d9908bf"},"name":"SYS_GEN__Runbook_Package_22e18386_fa75_402e_9fd9_aa32056cb746"}},{"description":"System action for starting an application","message_list":[],"uuid":"452ef875-1938-43f9-b496-1334d5fc0751","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"},"retries":"0","description":"","type":"DAG","uuid":"c4f16941-7544-49ed-b8c4-fbe00c948314","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"12615cdd-0ffd-4ad1-ab0b-c15cf9bf428c"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_22e18386_fa75_402e_9fd9_aa32056cb746"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"12615cdd-0ffd-4ad1-ab0b-c15cf9bf428c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"9ed6a107-c247-472e-83e7-2c22768547e3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"c4f16941-7544-49ed-b8c4-fbe00c948314"},"name":"SYS_GEN__Runbook_Package_22e18386_fa75_402e_9fd9_aa32056cb746"}},{"description":"System action for restarting an application","message_list":[],"uuid":"1b6f3d5c-71e2-4ad9-914f-a1a676f72f13","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"},"retries":"0","description":"","type":"DAG","uuid":"f12ef9b5-89c8-475a-b31b-09825bea6160","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"d16d3ef6-f4e8-40b7-a9ea-9b12fcafa990"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_22e18386_fa75_402e_9fd9_aa32056cb746"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d16d3ef6-f4e8-40b7-a9ea-9b12fcafa990","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"ca8cec47-f6e6-4ffb-83f1-eb67ddbb98e2"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"5c45de09-847e-4776-a526-cdbe12e4418c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"f12ef9b5-89c8-475a-b31b-09825bea6160"},"name":"SYS_GEN__Runbook_Package_22e18386_fa75_402e_9fd9_aa32056cb746"}},{"description":"System action for stopping an application","message_list":[],"uuid":"d33d5558-23a7-4757-88d7-c07579c51857","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"},"retries":"0","description":"","type":"DAG","uuid":"4730d6d2-df2e-42b0-8583-5a2489a59fd9","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"ee34e37d-77b4-474d-8a1f-7834efb0b63c"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_22e18386_fa75_402e_9fd9_aa32056cb746"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ee34e37d-77b4-474d-8a1f-7834efb0b63c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"d34fd347-4143-447c-878d-17fc590d443f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_22e18386_fa75_402e_9fd9_aa32056cb746","uuid":"4730d6d2-df2e-42b0-8583-5a2489a59fd9"},"name":"SYS_GEN__Runbook_Package_22e18386_fa75_402e_9fd9_aa32056cb746"}}],"message_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"}],"uuid":"22e18386-fa75-402e-9fd9-aa32056cb746","state":"ACTIVE","version":"","editables":{},"type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"},"retries":"0","description":"","type":"DAG","uuid":"8fe8c5d1-5aaa-48f6-a089-811b9d7d0d0e","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"fe928d5c-3674-4e54-be1a-ceff751b83fc"},{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"60a50e8a-e2fb-4d88-82f7-e0821461371b"},{"kind":"app_task","name":"Generate Certs","uuid":"3cc49ad3-44d3-4b81-8252-af87eb1816e6"},{"kind":"app_task","name":"Configure Services","uuid":"056a3681-f7b5-4937-9f8c-83ec8c45e753"},{"kind":"app_task","name":"Add User Roles","uuid":"13077133-beda-4566-ac35-e637c8d504ed"},{"kind":"app_task","name":"Network Configuration","uuid":"8fab44c0-5cd6-4e36-9b77-db6fd8fd6993"},{"kind":"app_task","name":"DNS Configuration","uuid":"edeb2357-deeb-49ae-be66-7d6066b60c7f"},{"kind":"app_task","name":"NVP Configuration","uuid":"bff2dae4-0d71-404e-ab32-cd4db81a887a"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"fe928d5c-3674-4e54-be1a-ceff751b83fc"},"edge_type":"user_defined","type":"","uuid":"36d1c5b8-2355-426c-ba27-903ebbf6b195","to_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"60a50e8a-e2fb-4d88-82f7-e0821461371b"}},{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"60a50e8a-e2fb-4d88-82f7-e0821461371b"},"edge_type":"user_defined","type":"","uuid":"1a31216d-aa38-42ed-a18a-60226580df1a","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"3cc49ad3-44d3-4b81-8252-af87eb1816e6"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"3cc49ad3-44d3-4b81-8252-af87eb1816e6"},"edge_type":"user_defined","type":"","uuid":"3ba5aff3-4ae7-4fee-b071-1fe06251fcb9","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"056a3681-f7b5-4937-9f8c-83ec8c45e753"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"056a3681-f7b5-4937-9f8c-83ec8c45e753"},"edge_type":"user_defined","type":"","uuid":"1bf63fa5-1194-4c46-a9e1-60dcdb5c8132","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"13077133-beda-4566-ac35-e637c8d504ed"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"13077133-beda-4566-ac35-e637c8d504ed"},"edge_type":"user_defined","type":"","uuid":"cf6f6dce-44a8-4ea2-a099-40684682c7bf","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"8fab44c0-5cd6-4e36-9b77-db6fd8fd6993"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"8fab44c0-5cd6-4e36-9b77-db6fd8fd6993"},"edge_type":"user_defined","type":"","uuid":"e6445df3-e8d2-4fc6-a974-b1021fd35bff","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"edeb2357-deeb-49ae-be66-7d6066b60c7f"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"edeb2357-deeb-49ae-be66-7d6066b60c7f"},"edge_type":"user_defined","type":"","uuid":"691a7fe4-bc87-472c-9b45-a30fba2ac0c8","to_task_reference":{"kind":"app_task","name":"NVP Configuration","uuid":"bff2dae4-0d71-404e-ab32-cd4db81a887a"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"dac441af_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"fe928d5c-3674-4e54-be1a-ceff751b83fc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"60a50e8a-e2fb-4d88-82f7-e0821461371b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\ncount=0\n# Verify access to Centos mirror before yum update\ncheck_mirror() {\ncurl -s mirrorlist.centos.org >\/dev\/null | true\nif [ \"${PIPESTATUS[0]}\" -ne 0 ]; then\n    if [ ${count} -lt 60 ]; then\n        echo \"Sleeping for 5 seconds before repeating the check\" | sudo tee -a \/var\/log\/messages\n        sleep 5\n        count=$((count+1))\n        check_mirror\n    else\n        echo \"DNS resolution failed after 5 minutes, exiting\" | sudo tee -a \/var\/log\/messages\n        exit 1\n    fi\nfi\n}\ncheck_mirror\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.3.12\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_IPS=\"@@{AHV_Centos_K8SW.address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} master${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"master${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  count=$((count+1))\ndone  \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\necho \"if \\$programname == 'etcd' then \/var\/log\/etcd.log\n& stop\" | sudo tee \/etc\/rsyslog.d\/etcd.conf\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"if \\$programname == 'kubelet' then \/var\/log\/kubelet.log\n& stop\" | sudo tee \/etc\/rsyslog.d\/kubelet.conf\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate etcd \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/sd{e,f,g}\nsudo vgcreate docker \/dev\/sd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"3cc49ad3-44d3-4b81-8252-af87eb1816e6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_IPS=\"@@{AHV_Centos_K8SW.address}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"master${count}\",\n  count=$((count+1))\ndone\n\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"worker${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_NAMES},${MASTER_IPS},${MINION_NAMES},${WORKER_IPS},${FIRST_IP_SERVICE_SUBNET},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local -profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\ninstance=\"master${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=master${count}.kubeconfig\nkubectl config set-credentials system:node:master${count} --client-certificate=master${count}.pem --client-key=master${count}-key.pem --embed-certs=true --kubeconfig=master${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:master${count} --kubeconfig=master${count}.kubeconfig\nkubectl config use-context default --kubeconfig=master${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"master${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"056a3681-f7b5-4937-9f8c-83ec8c45e753","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nCONTROLLER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=${KUBE_CLUSTER_NAME}\n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n    \necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"13077133-beda-4566-ac35-e637c8d504ed","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet iscsid\nsudo systemctl enable etcd docker kubelet iscsid\nsudo systemctl restart rsyslog\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem master* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"8fab44c0-5cd6-4e36-9b77-db6fd8fd6993","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ]]; then\nsudo mkdir -p \/etc\/kubernetes\/addons\/canal\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: canal-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  canal_iface: \"\"\n\n  masquerade: \"true\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: canal\n  namespace: kube-system\n  labels:\n    k8s-app: canal\nspec:\n  selector:\n    matchLabels:\n      k8s-app: canal\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: canal\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: canal\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-canal.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              value: \"none\"\n            - name: CLUSTER_TYPE\n              value: \"k8s,canal\"\n            - name: FELIX_IPTABLESREFRESHINTERVAL\n              value: \"60\"\n            - name: IP\n              value: \"\"\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"192.168.0.0\/16\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: \/readiness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n        - name: kube-flannel\n          image: quay.io\/coreos\/flannel:v0.9.1\n          command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n          securityContext:\n            privileged: true\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: FLANNELD_IFACE\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: canal_iface\n            - name: FLANNELD_IP_MASQ\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: masquerade\n          volumeMounts:\n          - mountPath: \/run\/xtables.lock\n            name: xtables-lock\n            readOnly: false\n          - name: flannel-cfg\n            mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: flannel-cfg\n          configMap:\n            name: canal-config\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: canal\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: canal-flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: canal-calico\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/canal\/canal.yml\nkubectl create -f \/etc\/kubernetes\/addons\/canal\/canal.yml\n\nelif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]];then\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/calico\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  calico_backend: \"bird\"\n\n  veth_mtu: \"1440\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: calico-node\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-calico.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CNI_MTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s,bgp\"\n            - name: IP\n              value: \"autodetect\"\n            - name: CALICO_IPV4POOL_IPIP\n              value: \"Always\"\n            - name: FELIX_IPINIPMTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"@@{KUBE_CLUSTER_SUBNET}@@\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            exec:\n              command:\n              - \/bin\/calico-node\n              - -bird-ready\n              - -felix-ready\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPPeer\n    plural: bgppeers\n    singular: bgppeer\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/calico\/calico.yml\nkubectl create -f \/etc\/kubernetes\/addons\/calico\/calico.yml  \n\nelse\n  echo \"Defaulting to flannel\"\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n  - kind: ServiceAccount\n    name: flannel\n    namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"hairpinMode\": true,\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - \/opt\/bin\/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n          limits:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/bin\/sh\", \"-c\", \"set -e -x; cp -f \/etc\/kube-flannel\/cni-conf.json \/etc\/cni\/net.d\/10-flannel.conf; while true; do sleep 3600; done\" ]\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nfi\n\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"edeb2357-deeb-49ae-be66-7d6066b60c7f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n  - name: dns\n    port: 53\n    protocol: UDP\n  - name: dns-tcp\n    port: 53\n    protocol: TCP\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: k8s.gcr.io\/k8s-dns-kube-dns:1.14.13\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: k8s.gcr.io\/k8s-dns-dnsmasq-nanny:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --no-negcache\n        - --dns-loop-detect\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: k8s.gcr.io\/k8s-dns-sidecar:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local,5,SRV\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local,5,SRV\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy: Default\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.2.0\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          - --target=Deployment\/kube-dns\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"bff2dae4-0d71-404e-ab32-cd4db81a887a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nPRISM_CLUSTER_IP=\"@@{PE_CLUSTER_IP}@@\"\nPRISM_DATA_SERVICE_IP=\"@@{PE_CLUSTER_IP}@@\"\n\nif [[ (\"${PRISM_CLUSTER_IP}x\" == \"x\") && (\"${PRISM_DATA_SERVICE_IP}x\" == \"x\") ]]; then exit 0; fi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/volume_plugin\nNTNX_SECRET=$(echo -n \"@@{PE_USERNAME}@@:@@{PE_PASSWORD}@@\" | base64)\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: nutanixabs-provisioner-runner\n  namespace: kube-system\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumes\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumeclaims\"]\n    verbs: [\"get\", \"list\", \"watch\", \"update\"]\n  - apiGroups: [\"storage.k8s.io\"]\n    resources: [\"storageclasses\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"list\", \"watch\", \"create\", \"update\", \"patch\"]\n  - apiGroups: [\"\"]\n    resources: [\"services\"]\n    verbs: [\"get\"]\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"create\", \"delete\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: run-nutanixabs-provisioner\n  namespace: kube-system\nsubjects:\n  - kind: ServiceAccount\n    name: nutanixabs-provisioner\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: nutanixabs-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      labels:\n        app: nutanixabs-provisioner\n    spec:\n      serviceAccount: nutanixabs-provisioner\n      hostNetwork: true\n      containers:\n        -\n          image: \"ntnx\/nutanixabs-provisioner\"\n          name: nutanixabs-provisioner\n          args: [\"--v=4\"]\n          imagePullPolicy: IfNotPresent\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: kube-system\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\n---\nkind: StorageClass\napiVersion: storage.k8s.io\/v1\nmetadata:\n  name: silver \n  namespace: kube-system\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\nprovisioner: nutanix\/abs\nparameters:\n     prismEndPoint: @@{PE_CLUSTER_IP}@@:9440\n     dataServiceEndPoint: @@{PE_DATA_SERVICE_IP}@@:3260\n     secretName: ntnx-secret\n     storageContainer: @@{PE_CONTAINER_NAME}@@\n     fsType: ext4\n     chapAuthEnabled: \"false\"' | sudo tee \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\necho \"apiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: default\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\" | sudo tee -a \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"NVP Configuration"}],"description":"","message_list":[],"uuid":"73124b74-b2af-4082-bec4-7cecb8d5f8bb","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"dac441af_dag","uuid":"8fe8c5d1-5aaa-48f6-a089-811b9d7d0d0e"},"name":"8e760b73_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"},"retries":"0","description":"","type":"DAG","uuid":"c7f90cc3-f508-41b2-a289-7a55fc30de35","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6324786a_dag"}],"description":"","message_list":[],"uuid":"ca5f1ae4-f604-456d-9302-d1c6858e9cca","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6324786a_dag","uuid":"c7f90cc3-f508-41b2-a289-7a55fc30de35"},"name":"6522ac7a_runbook"}},"variable_list":[],"name":"AHV_Centos_K8SM_Package"},{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"4aad5a85-cda2-4c03-b881-be16e5f6fe37","name":"action_install","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"},"retries":"0","description":"","type":"DAG","uuid":"34346097-8a80-46d3-b3ec-e6cc302aecd7","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Install_Crb_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"dce55445-71ac-46e0-b761-2380ff27c63c"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_INSTALL","uuid":"dce55445-71ac-46e0-b761-2380ff27c63c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"},"retries":"0","description":"","type":"DAG","uuid":"e0360d55-975f-4b97-a73c-e1eaabd0390f","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"1ba5c814-58b2-4ef7-abd4-c45bb1597e77"},{"kind":"app_task","name":"Docker Kubelet Install","uuid":"099fff07-8d75-49fc-9034-6c5f8906334d"},{"kind":"app_task","name":"GetCerts","uuid":"c36fc474-4fc7-42d9-8e63-b5cf37e2ecba"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"1ba5c814-58b2-4ef7-abd4-c45bb1597e77"},"edge_type":"user_defined","type":"","uuid":"36a33d61-9fe9-4ebf-9c33-dd90e113e992","to_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"099fff07-8d75-49fc-9034-6c5f8906334d"}},{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"099fff07-8d75-49fc-9034-6c5f8906334d"},"edge_type":"user_defined","type":"","uuid":"dfcf0803-d531-4422-bdf7-99c7539461ba","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"c36fc474-4fc7-42d9-8e63-b5cf37e2ecba"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"c1566b3d_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"1ba5c814-58b2-4ef7-abd4-c45bb1597e77","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"099fff07-8d75-49fc-9034-6c5f8906334d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\ncount=0\n# Verify access to Centos mirror before yum update\ncheck_mirror() {\ncurl -s mirrorlist.centos.org >\/dev\/null | true\nif [ \"${PIPESTATUS[0]}\" -ne 0 ]; then\n    if [ ${count} -lt 60 ]; then\n        echo \"Sleeping for 5 seconds before repeating the check\"\n        sleep 5\n        count=$((count+1))\n        check_mirror\n    else\n        echo \"DNS resolution failed after 5 minutes, exiting\"\n        exit 1\n    fi\nfi\n}\ncheck_mirror\n\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"if \\$programname == 'kubelet' then \/var\/log\/kubelet.log\n& stop\" | sudo tee \/etc\/rsyslog.d\/kubelet.conf\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"c36fc474-4fc7-42d9-8e63-b5cf37e2ecba","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{AHV_Centos_K8SM.address[0]}@@\"\nINSTANCE_IP=\"@@{address}@@\"\ninstance=\"worker@@{calm_array_index}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nsudo systemctl start iscsid\nsudo systemctl restart rsyslog\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; if [[ $count -eq 600 ]]; then echo \"failed to download certs\" && exit 1; fi; count=$(($count+5)) ; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${instance} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${instance} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"ca7feba8-9c3a-45b2-89e4-136abdc49c2b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"c1566b3d_dag","uuid":"e0360d55-975f-4b97-a73c-e1eaabd0390f"},"name":"9a6e189b_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"},"retries":"0","description":"","type":"DAG","uuid":"1e7d26f2-668f-4fbc-802a-a434951b94d4","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"d7e9ee5d-0644-416e-98fe-edc0d0828cd3"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"abd3357c_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"d7e9ee5d-0644-416e-98fe-edc0d0828cd3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain 'worker@@{calm_array_index}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node 'worker@@{calm_array_index}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"6f422867-891e-4b13-977d-fa640f0d3330","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"abd3357c_dag","uuid":"1e7d26f2-668f-4fbc-802a-a434951b94d4"},"name":"3cb17acf_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Install_Crb_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e"}],"description":"","message_list":[],"uuid":"38077e44-f222-4d2b-906b-ca8cc64c9edc","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"34346097-8a80-46d3-b3ec-e6cc302aecd7"},"name":"SYS_GEN__Runbook_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e"}},{"description":"System action for creating an application","message_list":[],"uuid":"08a523c6-10ab-4cb4-9f69-1814f4074705","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"},"retries":"0","description":"","type":"DAG","uuid":"85ffc20d-0420-47bf-9888-29b66f679ae0","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"1d517ea7-4ffe-499c-9e03-dc7abb406bdb"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"f82099b5-5757-4bf0-9890-9bb0af077f0a"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"599eabd8-8eee-49b5-a220-2d71279e4776"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"f82099b5-5757-4bf0-9890-9bb0af077f0a"},"edge_type":"inherent","type":"","uuid":"977a2f80-e638-484c-876f-df013cb1773b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"599eabd8-8eee-49b5-a220-2d71279e4776"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"1d517ea7-4ffe-499c-9e03-dc7abb406bdb"},"edge_type":"inherent","type":"","uuid":"2d175333-a461-4364-adf0-e19106a962dc","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"f82099b5-5757-4bf0-9890-9bb0af077f0a"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1d517ea7-4ffe-499c-9e03-dc7abb406bdb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"38077e44-f222-4d2b-906b-ca8cc64c9edc"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f82099b5-5757-4bf0-9890-9bb0af077f0a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"cca906a5-5e79-422e-b15f-7391a907ad07"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"599eabd8-8eee-49b5-a220-2d71279e4776","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"2701b7f5-96dd-45a7-a268-1b8020a0d0f6","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"85ffc20d-0420-47bf-9888-29b66f679ae0"},"name":"SYS_GEN__Runbook_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e"}},{"description":"System action for uninstalling an application","message_list":[],"uuid":"b8cc93d4-4434-49e8-adad-57538a95ae25","name":"action_uninstall","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"},"retries":"0","description":"","type":"DAG","uuid":"c75851f1-248e-4e6a-a0c6-60a436d1e11e","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Uninstall_Crb_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"36fb52de-b463-4700-b455-a8e652ec9ba3"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_UNINSTALL","uuid":"36fb52de-b463-4700-b455-a8e652ec9ba3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"},"retries":"0","description":"","type":"DAG","uuid":"e0360d55-975f-4b97-a73c-e1eaabd0390f","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"1ba5c814-58b2-4ef7-abd4-c45bb1597e77"},{"kind":"app_task","name":"Docker Kubelet Install","uuid":"099fff07-8d75-49fc-9034-6c5f8906334d"},{"kind":"app_task","name":"GetCerts","uuid":"c36fc474-4fc7-42d9-8e63-b5cf37e2ecba"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"1ba5c814-58b2-4ef7-abd4-c45bb1597e77"},"edge_type":"user_defined","type":"","uuid":"36a33d61-9fe9-4ebf-9c33-dd90e113e992","to_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"099fff07-8d75-49fc-9034-6c5f8906334d"}},{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"099fff07-8d75-49fc-9034-6c5f8906334d"},"edge_type":"user_defined","type":"","uuid":"dfcf0803-d531-4422-bdf7-99c7539461ba","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"c36fc474-4fc7-42d9-8e63-b5cf37e2ecba"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"c1566b3d_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"1ba5c814-58b2-4ef7-abd4-c45bb1597e77","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"099fff07-8d75-49fc-9034-6c5f8906334d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\ncount=0\n# Verify access to Centos mirror before yum update\ncheck_mirror() {\ncurl -s mirrorlist.centos.org >\/dev\/null | true\nif [ \"${PIPESTATUS[0]}\" -ne 0 ]; then\n    if [ ${count} -lt 60 ]; then\n        echo \"Sleeping for 5 seconds before repeating the check\"\n        sleep 5\n        count=$((count+1))\n        check_mirror\n    else\n        echo \"DNS resolution failed after 5 minutes, exiting\"\n        exit 1\n    fi\nfi\n}\ncheck_mirror\n\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"if \\$programname == 'kubelet' then \/var\/log\/kubelet.log\n& stop\" | sudo tee \/etc\/rsyslog.d\/kubelet.conf\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"c36fc474-4fc7-42d9-8e63-b5cf37e2ecba","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{AHV_Centos_K8SM.address[0]}@@\"\nINSTANCE_IP=\"@@{address}@@\"\ninstance=\"worker@@{calm_array_index}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nsudo systemctl start iscsid\nsudo systemctl restart rsyslog\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; if [[ $count -eq 600 ]]; then echo \"failed to download certs\" && exit 1; fi; count=$(($count+5)) ; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${instance} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${instance} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"ca7feba8-9c3a-45b2-89e4-136abdc49c2b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"c1566b3d_dag","uuid":"e0360d55-975f-4b97-a73c-e1eaabd0390f"},"name":"9a6e189b_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"},"retries":"0","description":"","type":"DAG","uuid":"1e7d26f2-668f-4fbc-802a-a434951b94d4","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"d7e9ee5d-0644-416e-98fe-edc0d0828cd3"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"abd3357c_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"d7e9ee5d-0644-416e-98fe-edc0d0828cd3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain 'worker@@{calm_array_index}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node 'worker@@{calm_array_index}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"6f422867-891e-4b13-977d-fa640f0d3330","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"abd3357c_dag","uuid":"1e7d26f2-668f-4fbc-802a-a434951b94d4"},"name":"3cb17acf_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Uninstall_Crb_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e"}],"description":"","message_list":[],"uuid":"37c2201b-1dfe-4c39-bc25-787eb9dc0c38","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"c75851f1-248e-4e6a-a0c6-60a436d1e11e"},"name":"SYS_GEN__Runbook_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"2cb0c5cd-174d-4dc7-b463-778fdafe13a9","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"},"retries":"0","description":"","type":"DAG","uuid":"c30c230a-57f9-40c2-8b6e-cd1b4dcb2efc","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"88d37234-c05e-4bae-9a20-03f8fcc53e71"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"781a6fec-be20-4c36-9856-7259f44a4eeb"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"5784e3ee-31c8-48c2-a983-50a96272de60"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"88d37234-c05e-4bae-9a20-03f8fcc53e71"},"edge_type":"inherent","type":"","uuid":"2d711e9a-00a3-4462-9f5a-b142e9646a68","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"781a6fec-be20-4c36-9856-7259f44a4eeb"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"781a6fec-be20-4c36-9856-7259f44a4eeb"},"edge_type":"inherent","type":"","uuid":"44a5a258-b4cc-42e5-9b74-18fd9780e1f0","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"5784e3ee-31c8-48c2-a983-50a96272de60"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"88d37234-c05e-4bae-9a20-03f8fcc53e71","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"781a6fec-be20-4c36-9856-7259f44a4eeb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"843ab0a6-03bd-4b9c-8f56-7d852e9348e0"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5784e3ee-31c8-48c2-a983-50a96272de60","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"37c2201b-1dfe-4c39-bc25-787eb9dc0c38"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e"}],"description":"","message_list":[],"uuid":"b5e1baa5-37ac-4977-bf79-186d7214aed5","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"c30c230a-57f9-40c2-8b6e-cd1b4dcb2efc"},"name":"SYS_GEN__Runbook_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"a2a8344b-354c-4a1e-b3a5-2026781bc14d","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"},"retries":"0","description":"","type":"DAG","uuid":"264fe304-ba0f-4352-bd38-9ef3278e0c93","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"f727b298-520a-4e50-a6b5-9edd108858ad"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"c255b696-7486-4e2e-8657-a2322451d3c3"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"f727b298-520a-4e50-a6b5-9edd108858ad"},"edge_type":"inherent","type":"","uuid":"af3c97a5-fc2c-4fac-be51-a5d343064fd9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"c255b696-7486-4e2e-8657-a2322451d3c3"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f727b298-520a-4e50-a6b5-9edd108858ad","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"716ea7a7-bc0c-4ac5-ab9c-720c327a498e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"c255b696-7486-4e2e-8657-a2322451d3c3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e"}],"description":"","message_list":[],"uuid":"4ce506e1-36f1-4a4f-a0e9-7780f35c4d65","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"264fe304-ba0f-4352-bd38-9ef3278e0c93"},"name":"SYS_GEN__Runbook_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e"}},{"description":"System action for starting an application","message_list":[],"uuid":"fe46f381-0948-466c-a465-61fded759be3","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"},"retries":"0","description":"","type":"DAG","uuid":"1e658c90-f28f-4879-b5e4-ca97ad9b41d8","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"2cb12cdb-ca05-42d9-b406-5693bf6d5390"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2cb12cdb-ca05-42d9-b406-5693bf6d5390","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"22c28e35-c15b-4eb7-9a70-55e9094afeca","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"1e658c90-f28f-4879-b5e4-ca97ad9b41d8"},"name":"SYS_GEN__Runbook_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e"}},{"description":"System action for restarting an application","message_list":[],"uuid":"5f3ea793-e5f1-411d-865d-9d33f5d3b574","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"},"retries":"0","description":"","type":"DAG","uuid":"1e57349d-877e-41c9-958a-c9995116d054","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"9cfc5d15-5bc2-491c-9e82-09c22448ed24"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"9cfc5d15-5bc2-491c-9e82-09c22448ed24","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"ce602c49-d9cd-44d7-8e10-5671dc407b8b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"e14da281-1bec-43b6-8b9f-b913a1d542b4","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"1e57349d-877e-41c9-958a-c9995116d054"},"name":"SYS_GEN__Runbook_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e"}},{"description":"System action for stopping an application","message_list":[],"uuid":"93658a90-6eb7-4bfc-9d88-7eb8278fb564","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"},"retries":"0","description":"","type":"DAG","uuid":"fc637c3d-2468-46a1-b40c-e39b431b068a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"319dee17-d414-4764-931b-c313fc7d9ec8"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"319dee17-d414-4764-931b-c313fc7d9ec8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"e3d61efd-3452-497e-acdb-b66352c081b7","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e","uuid":"fc637c3d-2468-46a1-b40c-e39b431b068a"},"name":"SYS_GEN__Runbook_Package_24dd623b_a6ae_43d6_b8ef_adad0e20ce9e"}}],"message_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"}],"uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e","state":"ACTIVE","version":"","editables":{},"type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"},"retries":"0","description":"","type":"DAG","uuid":"e0360d55-975f-4b97-a73c-e1eaabd0390f","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"1ba5c814-58b2-4ef7-abd4-c45bb1597e77"},{"kind":"app_task","name":"Docker Kubelet Install","uuid":"099fff07-8d75-49fc-9034-6c5f8906334d"},{"kind":"app_task","name":"GetCerts","uuid":"c36fc474-4fc7-42d9-8e63-b5cf37e2ecba"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"1ba5c814-58b2-4ef7-abd4-c45bb1597e77"},"edge_type":"user_defined","type":"","uuid":"36a33d61-9fe9-4ebf-9c33-dd90e113e992","to_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"099fff07-8d75-49fc-9034-6c5f8906334d"}},{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"099fff07-8d75-49fc-9034-6c5f8906334d"},"edge_type":"user_defined","type":"","uuid":"dfcf0803-d531-4422-bdf7-99c7539461ba","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"c36fc474-4fc7-42d9-8e63-b5cf37e2ecba"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"c1566b3d_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"1ba5c814-58b2-4ef7-abd4-c45bb1597e77","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"099fff07-8d75-49fc-9034-6c5f8906334d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\ncount=0\n# Verify access to Centos mirror before yum update\ncheck_mirror() {\ncurl -s mirrorlist.centos.org >\/dev\/null | true\nif [ \"${PIPESTATUS[0]}\" -ne 0 ]; then\n    if [ ${count} -lt 60 ]; then\n        echo \"Sleeping for 5 seconds before repeating the check\"\n        sleep 5\n        count=$((count+1))\n        check_mirror\n    else\n        echo \"DNS resolution failed after 5 minutes, exiting\"\n        exit 1\n    fi\nfi\n}\ncheck_mirror\n\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"if \\$programname == 'kubelet' then \/var\/log\/kubelet.log\n& stop\" | sudo tee \/etc\/rsyslog.d\/kubelet.conf\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"c36fc474-4fc7-42d9-8e63-b5cf37e2ecba","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{AHV_Centos_K8SM.address[0]}@@\"\nINSTANCE_IP=\"@@{address}@@\"\ninstance=\"worker@@{calm_array_index}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nsudo systemctl start iscsid\nsudo systemctl restart rsyslog\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; if [[ $count -eq 600 ]]; then echo \"failed to download certs\" && exit 1; fi; count=$(($count+5)) ; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${instance} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${instance} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"ca7feba8-9c3a-45b2-89e4-136abdc49c2b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"c1566b3d_dag","uuid":"e0360d55-975f-4b97-a73c-e1eaabd0390f"},"name":"9a6e189b_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"},"retries":"0","description":"","type":"DAG","uuid":"1e7d26f2-668f-4fbc-802a-a434951b94d4","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"d7e9ee5d-0644-416e-98fe-edc0d0828cd3"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"abd3357c_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"d7e9ee5d-0644-416e-98fe-edc0d0828cd3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain 'worker@@{calm_array_index}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node 'worker@@{calm_array_index}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"6f422867-891e-4b13-977d-fa640f0d3330","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"abd3357c_dag","uuid":"1e7d26f2-668f-4fbc-802a-a434951b94d4"},"name":"3cb17acf_runbook"}},"variable_list":[],"name":"AHV_Centos_K8SW_Package"},{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"fac9ec66-0bde-4471-b430-62a31a7b0f77","name":"action_install","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"},"retries":"0","description":"","type":"DAG","uuid":"69c84cc7-d067-4e1c-8e1c-77cf3d36421e","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Install_Crb_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"c7818368-9e44-4ee0-ac87-3aca1e353c87"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_INSTALL","uuid":"c7818368-9e44-4ee0-ac87-3aca1e353c87","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"},"retries":"0","description":"","type":"DAG","uuid":"eb0a4fbb-7076-41cd-904a-0eab8de3d5e4","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"f542c0ea-1657-4039-92e4-171897dc94cd"},{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"5e8f303d-fefa-4900-b070-d8f6086a3684"},{"kind":"app_task","name":"Generate Certs","uuid":"3772aab0-cf05-4779-b657-672a951c97a3"},{"kind":"app_task","name":"Configure Services","uuid":"0609cf4d-8689-4c65-8464-49aec84b95a1"},{"kind":"app_task","name":"Add User Roles","uuid":"ae1b7bbc-a3e9-4fc3-bf46-71c15a8b2c90"},{"kind":"app_task","name":"Network Configuration","uuid":"fdb6b70e-e4a8-452a-bfdb-7125ec563f87"},{"kind":"app_task","name":"DNS Configuration","uuid":"9b102b01-091c-4e25-b54c-faf1e8744c7e"},{"kind":"app_task","name":"EBS VolumePlugin","uuid":"bb84fcf0-b54f-4e39-92a0-14c53ca802af"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"f542c0ea-1657-4039-92e4-171897dc94cd"},"edge_type":"user_defined","type":"","uuid":"393b023b-e6d2-41a4-8c81-dd74bccce4c1","to_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"5e8f303d-fefa-4900-b070-d8f6086a3684"}},{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"5e8f303d-fefa-4900-b070-d8f6086a3684"},"edge_type":"user_defined","type":"","uuid":"364ee192-14bc-45cd-abf0-f85442c23a1a","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"3772aab0-cf05-4779-b657-672a951c97a3"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"3772aab0-cf05-4779-b657-672a951c97a3"},"edge_type":"user_defined","type":"","uuid":"297c9e2b-ae2e-4fe1-b1fb-769d1b0f62fe","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"0609cf4d-8689-4c65-8464-49aec84b95a1"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"0609cf4d-8689-4c65-8464-49aec84b95a1"},"edge_type":"user_defined","type":"","uuid":"44f5a8a2-6171-4ac1-b60d-c4f2fd5937ca","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"ae1b7bbc-a3e9-4fc3-bf46-71c15a8b2c90"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"ae1b7bbc-a3e9-4fc3-bf46-71c15a8b2c90"},"edge_type":"user_defined","type":"","uuid":"4b966a75-83ca-4ebb-910f-818f08ea5489","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"fdb6b70e-e4a8-452a-bfdb-7125ec563f87"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"fdb6b70e-e4a8-452a-bfdb-7125ec563f87"},"edge_type":"user_defined","type":"","uuid":"c337bb68-9651-4eb1-b6e7-bc5a875249e4","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"9b102b01-091c-4e25-b54c-faf1e8744c7e"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"9b102b01-091c-4e25-b54c-faf1e8744c7e"},"edge_type":"user_defined","type":"","uuid":"76e183c1-30d8-4507-9698-42b6da4461d5","to_task_reference":{"kind":"app_task","name":"EBS VolumePlugin","uuid":"bb84fcf0-b54f-4e39-92a0-14c53ca802af"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"84e097cf_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"f542c0ea-1657-4039-92e4-171897dc94cd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"5e8f303d-fefa-4900-b070-d8f6086a3684","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.3.12\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nWORKER_IPS=\"@@{AWS_Centos_K8SW.private_ip_address}@@\" # private Ip's\nMASTER_DNS=\"@@{calm_array_private_dns_name}@@\" # private Dns\nWORKER_DNS=\"@@{AWS_Centos_K8SW.private_dns_name}@@\" # private Dns\nPUBLIC_MASTER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_WORKER_IPS=\"@@{AWS_Centos_K8SW.public_ip_address}@@\"\nPUBLIC_MASTER_DNS=\"@@{calm_array_public_dns_name}@@\"\nPUBLIC_WORKER_DNS=\"@@{AWS_Centos_K8SW.public_dns_name}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y --quiet\nsudo yum install -y wget iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} master${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"master${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  count=$((count+1))\ndone   \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=aws \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/xvd{b,c,d}\nsudo vgcreate etcd \/dev\/xvd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/xvd{e,f,g}\nsudo vgcreate docker \/dev\/xvd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"3772aab0-cf05-4779-b657-672a951c97a3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\ndeclare -a INSTANCE_IPS\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nWORKER_IPS=\"@@{AWS_Centos_K8SW.private_ip_address}@@\" # private Ip's\nMASTER_DNS=\"@@{calm_array_private_dns_name}@@\" # private Dns\nWORKER_DNS=\"@@{AWS_Centos_K8SW.private_dns_name}@@\" # private Dns\nINSTANCE_IPS=($(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"))\nPUBLIC_MASTER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_WORKER_IPS=\"@@{AWS_Centos_K8SW.public_ip_address}@@\"\nPUBLIC_MASTER_DNS=\"@@{calm_array_public_dns_name}@@\"\nPUBLIC_WORKER_DNS=\"@@{AWS_Centos_K8SW.public_dns_name}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"master${count}\",\n  count=$((count+1))\ndone\nMASTER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"worker${count}\",\n  count=$((count+1))\ndone\nWORKER_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${MASTER_DNS},${PUBLIC_MASTER_IPS},${PUBLIC_MASTER_DNS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${MASTER_DNS},${PUBLIC_MASTER_IPS},${PUBLIC_MASTER_DNS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${MASTER_DNS},${PUBLIC_MASTER_IPS},${PUBLIC_MASTER_DNS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json \\\n-hostname=${MASTER_NAMES},${MASTER_IPS},${WORKER_NAMES},${WORKER_IPS},${FIRST_IP_SERVICE_SUBNET},${MASTER_DNS},${WORKER_DNS},${PUBLIC_MASTER_IPS},${PUBLIC_WORKER_IPS},${PUBLIC_MASTER_DNS},${PUBLIC_WORKER_DNS},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local \\\n-profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor name in $(echo ${MASTER_DNS} | tr \",\" \"\\n\"); do\ninstance=\"master${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${name}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${name},${INSTANCE_IPS[$count]} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor name in $(echo ${MASTER_DNS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=master${count}.kubeconfig\nkubectl config set-credentials system:node:${name} --client-certificate=master${count}.pem --client-key=master${count}-key.pem --embed-certs=true --kubeconfig=master${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${name} --kubeconfig=master${count}.kubeconfig\nkubectl config use-context default --kubeconfig=master${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"master${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"0609cf4d-8689-4c65-8464-49aec84b95a1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nCONTROLLER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --cloud-provider=aws\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=${KUBE_CLUSTER_NAME}  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --cloud-provider=aws\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n    \necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"ae1b7bbc-a3e9-4fc3-bf46-71c15a8b2c90","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet\nsudo systemctl enable etcd docker kubelet\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem master* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\n\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n    echo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF\n\ncat <<EOF | kubectl apply -f -\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: kube-aws:node-proxier\nsubjects:\n  - kind: User\n    name: kube-worker\n  - kind: ServiceAccount\n    name: kube-proxy\n    namespace: kube-system\n  - kind: Group\n    name: system:nodes\nroleRef:\n  kind: ClusterRole\n  name: system:node-proxier\n  apiGroup: rbac.authorization.k8s.io\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"fdb6b70e-e4a8-452a-bfdb-7125ec563f87","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ]]; then\nsudo mkdir -p \/etc\/kubernetes\/addons\/canal\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: canal-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  canal_iface: \"\"\n\n  masquerade: \"true\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: canal\n  namespace: kube-system\n  labels:\n    k8s-app: canal\nspec:\n  selector:\n    matchLabels:\n      k8s-app: canal\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: canal\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: canal\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-canal.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              value: \"none\"\n            - name: CLUSTER_TYPE\n              value: \"k8s,canal\"\n            - name: FELIX_IPTABLESREFRESHINTERVAL\n              value: \"60\"\n            - name: IP\n              value: \"\"\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"192.168.0.0\/16\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: \/readiness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n        - name: kube-flannel\n          image: quay.io\/coreos\/flannel:v0.9.1\n          command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n          securityContext:\n            privileged: true\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: FLANNELD_IFACE\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: canal_iface\n            - name: FLANNELD_IP_MASQ\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: masquerade\n          volumeMounts:\n          - mountPath: \/run\/xtables.lock\n            name: xtables-lock\n            readOnly: false\n          - name: flannel-cfg\n            mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: flannel-cfg\n          configMap:\n            name: canal-config\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: canal\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: canal-flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: canal-calico\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/canal\/canal.yml\nkubectl create -f \/etc\/kubernetes\/addons\/canal\/canal.yml\n\nelif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]];then\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/calico\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  calico_backend: \"bird\"\n\n  veth_mtu: \"1440\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: calico-node\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-calico.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CNI_MTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s,bgp\"\n            - name: IP\n              value: \"autodetect\"\n            - name: CALICO_IPV4POOL_IPIP\n              value: \"Always\"\n            - name: FELIX_IPINIPMTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"@@{KUBE_CLUSTER_SUBNET}@@\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            exec:\n              command:\n              - \/bin\/calico-node\n              - -bird-ready\n              - -felix-ready\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPPeer\n    plural: bgppeers\n    singular: bgppeer\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/calico\/calico.yml\nkubectl create -f \/etc\/kubernetes\/addons\/calico\/calico.yml  \n\nelse\n  echo \"Defaulting to flannel\"\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n  - kind: ServiceAccount\n    name: flannel\n    namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"hairpinMode\": true,\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - \/opt\/bin\/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n          limits:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/bin\/sh\", \"-c\", \"set -e -x; cp -f \/etc\/kube-flannel\/cni-conf.json \/etc\/cni\/net.d\/10-flannel.conf; while true; do sleep 3600; done\" ]\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nfi\n\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"9b102b01-091c-4e25-b54c-faf1e8744c7e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n  - name: dns\n    port: 53\n    protocol: UDP\n  - name: dns-tcp\n    port: 53\n    protocol: TCP\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: k8s.gcr.io\/k8s-dns-kube-dns:1.14.13\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: k8s.gcr.io\/k8s-dns-dnsmasq-nanny:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --no-negcache\n        - --dns-loop-detect\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: k8s.gcr.io\/k8s-dns-sidecar:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local,5,SRV\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local,5,SRV\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy: Default\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.2.0\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          - --target=Deployment\/kube-dns\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"bb84fcf0-b54f-4e39-92a0-14c53ca802af","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nsudo mkdir \"\/etc\/kubernetes\/addons\/volume\"\n\necho 'apiVersion: storage.k8s.io\/v1\nkind: StorageClass\nmetadata:\n  name: gp2\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: EnsureExists\nprovisioner: kubernetes.io\/aws-ebs\nparameters:\n  type: gp2' | sudo tee \/etc\/kubernetes\/addons\/volume\/default.yaml\n \nkubectl create -f \/etc\/kubernetes\/addons\/volume\/default.yaml "},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"EBS VolumePlugin"}],"description":"","message_list":[],"uuid":"94b46989-f45b-486e-9dff-731f3a0d6e2f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"84e097cf_dag","uuid":"eb0a4fbb-7076-41cd-904a-0eab8de3d5e4"},"name":"e836616a_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"},"retries":"0","description":"","type":"DAG","uuid":"aba7e289-21f7-4815-a99e-7f25116aa325","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"4226cd9d_dag"}],"description":"","message_list":[],"uuid":"b7c46034-6f60-40ce-aa4d-48473098d05f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"4226cd9d_dag","uuid":"aba7e289-21f7-4815-a99e-7f25116aa325"},"name":"18f2756f_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Install_Crb_6ab2b3c5_fdb8_4960_9757_2248632372d6"}],"description":"","message_list":[],"uuid":"4fa4a4af-ba4c-4bba-892d-02af5ec36e1a","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"69c84cc7-d067-4e1c-8e1c-77cf3d36421e"},"name":"SYS_GEN__Runbook_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6"}},{"description":"System action for creating an application","message_list":[],"uuid":"19ea2c6f-0a07-4031-9fdf-8b2f1737ab7f","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"},"retries":"0","description":"","type":"DAG","uuid":"62bfdc6e-bb85-45b0-9b0c-1363c7fb29bb","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"fa42a51b-afdc-4abc-817a-b09d47705981"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"3e9bb17f-a243-4ff6-9902-175fe5ed8f3c"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"c50d0f86-1add-4c25-b91a-19b15d73e1b1"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"3e9bb17f-a243-4ff6-9902-175fe5ed8f3c"},"edge_type":"inherent","type":"","uuid":"2e0f4d25-3bcd-4b0b-9904-9f296db71db3","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"c50d0f86-1add-4c25-b91a-19b15d73e1b1"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"fa42a51b-afdc-4abc-817a-b09d47705981"},"edge_type":"inherent","type":"","uuid":"1c5a8dbf-8ba4-4b2e-862f-46b187e0062a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"3e9bb17f-a243-4ff6-9902-175fe5ed8f3c"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"fa42a51b-afdc-4abc-817a-b09d47705981","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"4fa4a4af-ba4c-4bba-892d-02af5ec36e1a"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3e9bb17f-a243-4ff6-9902-175fe5ed8f3c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"384cf3d8-e940-43f1-a289-6c6b363c5371"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c50d0f86-1add-4c25-b91a-19b15d73e1b1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"0908b4ee-f128-45c6-95cd-54e35b2dc17c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"62bfdc6e-bb85-45b0-9b0c-1363c7fb29bb"},"name":"SYS_GEN__Runbook_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6"}},{"description":"System action for uninstalling an application","message_list":[],"uuid":"6d6e9f6b-6cf2-46bc-9c79-7d75ec2d72b0","name":"action_uninstall","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"},"retries":"0","description":"","type":"DAG","uuid":"fcd8040e-cfa2-460b-b018-87c436c4f130","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Uninstall_Crb_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"dd7c5efb-fb52-44b7-ad31-80416978a5ac"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_UNINSTALL","uuid":"dd7c5efb-fb52-44b7-ad31-80416978a5ac","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"},"retries":"0","description":"","type":"DAG","uuid":"eb0a4fbb-7076-41cd-904a-0eab8de3d5e4","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"f542c0ea-1657-4039-92e4-171897dc94cd"},{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"5e8f303d-fefa-4900-b070-d8f6086a3684"},{"kind":"app_task","name":"Generate Certs","uuid":"3772aab0-cf05-4779-b657-672a951c97a3"},{"kind":"app_task","name":"Configure Services","uuid":"0609cf4d-8689-4c65-8464-49aec84b95a1"},{"kind":"app_task","name":"Add User Roles","uuid":"ae1b7bbc-a3e9-4fc3-bf46-71c15a8b2c90"},{"kind":"app_task","name":"Network Configuration","uuid":"fdb6b70e-e4a8-452a-bfdb-7125ec563f87"},{"kind":"app_task","name":"DNS Configuration","uuid":"9b102b01-091c-4e25-b54c-faf1e8744c7e"},{"kind":"app_task","name":"EBS VolumePlugin","uuid":"bb84fcf0-b54f-4e39-92a0-14c53ca802af"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"f542c0ea-1657-4039-92e4-171897dc94cd"},"edge_type":"user_defined","type":"","uuid":"393b023b-e6d2-41a4-8c81-dd74bccce4c1","to_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"5e8f303d-fefa-4900-b070-d8f6086a3684"}},{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"5e8f303d-fefa-4900-b070-d8f6086a3684"},"edge_type":"user_defined","type":"","uuid":"364ee192-14bc-45cd-abf0-f85442c23a1a","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"3772aab0-cf05-4779-b657-672a951c97a3"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"3772aab0-cf05-4779-b657-672a951c97a3"},"edge_type":"user_defined","type":"","uuid":"297c9e2b-ae2e-4fe1-b1fb-769d1b0f62fe","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"0609cf4d-8689-4c65-8464-49aec84b95a1"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"0609cf4d-8689-4c65-8464-49aec84b95a1"},"edge_type":"user_defined","type":"","uuid":"44f5a8a2-6171-4ac1-b60d-c4f2fd5937ca","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"ae1b7bbc-a3e9-4fc3-bf46-71c15a8b2c90"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"ae1b7bbc-a3e9-4fc3-bf46-71c15a8b2c90"},"edge_type":"user_defined","type":"","uuid":"4b966a75-83ca-4ebb-910f-818f08ea5489","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"fdb6b70e-e4a8-452a-bfdb-7125ec563f87"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"fdb6b70e-e4a8-452a-bfdb-7125ec563f87"},"edge_type":"user_defined","type":"","uuid":"c337bb68-9651-4eb1-b6e7-bc5a875249e4","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"9b102b01-091c-4e25-b54c-faf1e8744c7e"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"9b102b01-091c-4e25-b54c-faf1e8744c7e"},"edge_type":"user_defined","type":"","uuid":"76e183c1-30d8-4507-9698-42b6da4461d5","to_task_reference":{"kind":"app_task","name":"EBS VolumePlugin","uuid":"bb84fcf0-b54f-4e39-92a0-14c53ca802af"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"84e097cf_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"f542c0ea-1657-4039-92e4-171897dc94cd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"5e8f303d-fefa-4900-b070-d8f6086a3684","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.3.12\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nWORKER_IPS=\"@@{AWS_Centos_K8SW.private_ip_address}@@\" # private Ip's\nMASTER_DNS=\"@@{calm_array_private_dns_name}@@\" # private Dns\nWORKER_DNS=\"@@{AWS_Centos_K8SW.private_dns_name}@@\" # private Dns\nPUBLIC_MASTER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_WORKER_IPS=\"@@{AWS_Centos_K8SW.public_ip_address}@@\"\nPUBLIC_MASTER_DNS=\"@@{calm_array_public_dns_name}@@\"\nPUBLIC_WORKER_DNS=\"@@{AWS_Centos_K8SW.public_dns_name}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y --quiet\nsudo yum install -y wget iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} master${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"master${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  count=$((count+1))\ndone   \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=aws \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/xvd{b,c,d}\nsudo vgcreate etcd \/dev\/xvd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/xvd{e,f,g}\nsudo vgcreate docker \/dev\/xvd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"3772aab0-cf05-4779-b657-672a951c97a3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\ndeclare -a INSTANCE_IPS\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nWORKER_IPS=\"@@{AWS_Centos_K8SW.private_ip_address}@@\" # private Ip's\nMASTER_DNS=\"@@{calm_array_private_dns_name}@@\" # private Dns\nWORKER_DNS=\"@@{AWS_Centos_K8SW.private_dns_name}@@\" # private Dns\nINSTANCE_IPS=($(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"))\nPUBLIC_MASTER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_WORKER_IPS=\"@@{AWS_Centos_K8SW.public_ip_address}@@\"\nPUBLIC_MASTER_DNS=\"@@{calm_array_public_dns_name}@@\"\nPUBLIC_WORKER_DNS=\"@@{AWS_Centos_K8SW.public_dns_name}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"master${count}\",\n  count=$((count+1))\ndone\nMASTER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"worker${count}\",\n  count=$((count+1))\ndone\nWORKER_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${MASTER_DNS},${PUBLIC_MASTER_IPS},${PUBLIC_MASTER_DNS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${MASTER_DNS},${PUBLIC_MASTER_IPS},${PUBLIC_MASTER_DNS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${MASTER_DNS},${PUBLIC_MASTER_IPS},${PUBLIC_MASTER_DNS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json \\\n-hostname=${MASTER_NAMES},${MASTER_IPS},${WORKER_NAMES},${WORKER_IPS},${FIRST_IP_SERVICE_SUBNET},${MASTER_DNS},${WORKER_DNS},${PUBLIC_MASTER_IPS},${PUBLIC_WORKER_IPS},${PUBLIC_MASTER_DNS},${PUBLIC_WORKER_DNS},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local \\\n-profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor name in $(echo ${MASTER_DNS} | tr \",\" \"\\n\"); do\ninstance=\"master${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${name}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${name},${INSTANCE_IPS[$count]} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor name in $(echo ${MASTER_DNS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=master${count}.kubeconfig\nkubectl config set-credentials system:node:${name} --client-certificate=master${count}.pem --client-key=master${count}-key.pem --embed-certs=true --kubeconfig=master${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${name} --kubeconfig=master${count}.kubeconfig\nkubectl config use-context default --kubeconfig=master${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"master${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"0609cf4d-8689-4c65-8464-49aec84b95a1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nCONTROLLER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --cloud-provider=aws\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=${KUBE_CLUSTER_NAME}  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --cloud-provider=aws\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n    \necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"ae1b7bbc-a3e9-4fc3-bf46-71c15a8b2c90","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet\nsudo systemctl enable etcd docker kubelet\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem master* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\n\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n    echo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF\n\ncat <<EOF | kubectl apply -f -\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: kube-aws:node-proxier\nsubjects:\n  - kind: User\n    name: kube-worker\n  - kind: ServiceAccount\n    name: kube-proxy\n    namespace: kube-system\n  - kind: Group\n    name: system:nodes\nroleRef:\n  kind: ClusterRole\n  name: system:node-proxier\n  apiGroup: rbac.authorization.k8s.io\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"fdb6b70e-e4a8-452a-bfdb-7125ec563f87","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ]]; then\nsudo mkdir -p \/etc\/kubernetes\/addons\/canal\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: canal-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  canal_iface: \"\"\n\n  masquerade: \"true\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: canal\n  namespace: kube-system\n  labels:\n    k8s-app: canal\nspec:\n  selector:\n    matchLabels:\n      k8s-app: canal\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: canal\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: canal\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-canal.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              value: \"none\"\n            - name: CLUSTER_TYPE\n              value: \"k8s,canal\"\n            - name: FELIX_IPTABLESREFRESHINTERVAL\n              value: \"60\"\n            - name: IP\n              value: \"\"\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"192.168.0.0\/16\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: \/readiness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n        - name: kube-flannel\n          image: quay.io\/coreos\/flannel:v0.9.1\n          command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n          securityContext:\n            privileged: true\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: FLANNELD_IFACE\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: canal_iface\n            - name: FLANNELD_IP_MASQ\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: masquerade\n          volumeMounts:\n          - mountPath: \/run\/xtables.lock\n            name: xtables-lock\n            readOnly: false\n          - name: flannel-cfg\n            mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: flannel-cfg\n          configMap:\n            name: canal-config\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: canal\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: canal-flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: canal-calico\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/canal\/canal.yml\nkubectl create -f \/etc\/kubernetes\/addons\/canal\/canal.yml\n\nelif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]];then\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/calico\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  calico_backend: \"bird\"\n\n  veth_mtu: \"1440\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: calico-node\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-calico.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CNI_MTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s,bgp\"\n            - name: IP\n              value: \"autodetect\"\n            - name: CALICO_IPV4POOL_IPIP\n              value: \"Always\"\n            - name: FELIX_IPINIPMTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"@@{KUBE_CLUSTER_SUBNET}@@\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            exec:\n              command:\n              - \/bin\/calico-node\n              - -bird-ready\n              - -felix-ready\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPPeer\n    plural: bgppeers\n    singular: bgppeer\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/calico\/calico.yml\nkubectl create -f \/etc\/kubernetes\/addons\/calico\/calico.yml  \n\nelse\n  echo \"Defaulting to flannel\"\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n  - kind: ServiceAccount\n    name: flannel\n    namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"hairpinMode\": true,\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - \/opt\/bin\/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n          limits:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/bin\/sh\", \"-c\", \"set -e -x; cp -f \/etc\/kube-flannel\/cni-conf.json \/etc\/cni\/net.d\/10-flannel.conf; while true; do sleep 3600; done\" ]\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nfi\n\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"9b102b01-091c-4e25-b54c-faf1e8744c7e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n  - name: dns\n    port: 53\n    protocol: UDP\n  - name: dns-tcp\n    port: 53\n    protocol: TCP\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: k8s.gcr.io\/k8s-dns-kube-dns:1.14.13\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: k8s.gcr.io\/k8s-dns-dnsmasq-nanny:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --no-negcache\n        - --dns-loop-detect\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: k8s.gcr.io\/k8s-dns-sidecar:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local,5,SRV\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local,5,SRV\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy: Default\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.2.0\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          - --target=Deployment\/kube-dns\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"bb84fcf0-b54f-4e39-92a0-14c53ca802af","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nsudo mkdir \"\/etc\/kubernetes\/addons\/volume\"\n\necho 'apiVersion: storage.k8s.io\/v1\nkind: StorageClass\nmetadata:\n  name: gp2\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: EnsureExists\nprovisioner: kubernetes.io\/aws-ebs\nparameters:\n  type: gp2' | sudo tee \/etc\/kubernetes\/addons\/volume\/default.yaml\n \nkubectl create -f \/etc\/kubernetes\/addons\/volume\/default.yaml "},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"EBS VolumePlugin"}],"description":"","message_list":[],"uuid":"94b46989-f45b-486e-9dff-731f3a0d6e2f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"84e097cf_dag","uuid":"eb0a4fbb-7076-41cd-904a-0eab8de3d5e4"},"name":"e836616a_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"},"retries":"0","description":"","type":"DAG","uuid":"aba7e289-21f7-4815-a99e-7f25116aa325","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"4226cd9d_dag"}],"description":"","message_list":[],"uuid":"b7c46034-6f60-40ce-aa4d-48473098d05f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"4226cd9d_dag","uuid":"aba7e289-21f7-4815-a99e-7f25116aa325"},"name":"18f2756f_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Uninstall_Crb_6ab2b3c5_fdb8_4960_9757_2248632372d6"}],"description":"","message_list":[],"uuid":"f097bc74-7b35-4f8c-a995-5fa3e8d59774","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"fcd8040e-cfa2-460b-b018-87c436c4f130"},"name":"SYS_GEN__Runbook_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"7a6d3255-cff8-4c79-982d-c6f721154f9b","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"},"retries":"0","description":"","type":"DAG","uuid":"b3d82b63-f834-4e45-aa04-07f91a417649","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"4e1adc2f-3d75-4146-937d-14597db5d15c"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"a8755dcf-a30c-4c0d-a3a8-c0c16418ef8d"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"887ff0ca-ab75-4440-ab15-ccc5eb6c9150"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"4e1adc2f-3d75-4146-937d-14597db5d15c"},"edge_type":"inherent","type":"","uuid":"abd209cc-a59a-403f-9967-fc6c704e6f84","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"a8755dcf-a30c-4c0d-a3a8-c0c16418ef8d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"a8755dcf-a30c-4c0d-a3a8-c0c16418ef8d"},"edge_type":"inherent","type":"","uuid":"386baa19-a419-40a2-b44f-83baebd42fa9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"887ff0ca-ab75-4440-ab15-ccc5eb6c9150"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4e1adc2f-3d75-4146-937d-14597db5d15c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a8755dcf-a30c-4c0d-a3a8-c0c16418ef8d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"7f713d48-74e9-4bb6-8dc9-eb8f00371ff3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"887ff0ca-ab75-4440-ab15-ccc5eb6c9150","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"f097bc74-7b35-4f8c-a995-5fa3e8d59774"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6"}],"description":"","message_list":[],"uuid":"e8cff0bd-d882-42f9-ab3c-25120c2df11c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"b3d82b63-f834-4e45-aa04-07f91a417649"},"name":"SYS_GEN__Runbook_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"49c68411-8db2-4f90-9d48-d128b3841c0b","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"},"retries":"0","description":"","type":"DAG","uuid":"a7325f1d-0e67-462c-9ded-c76ec8fc8116","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"969ee433-ed0d-4b37-bb3d-be875bf0ffd1"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"2c8cf778-3d37-4c98-8b31-9655a78f8462"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"969ee433-ed0d-4b37-bb3d-be875bf0ffd1"},"edge_type":"inherent","type":"","uuid":"90834ed5-a1d4-49eb-ad11-e5e6d7ea37a6","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"2c8cf778-3d37-4c98-8b31-9655a78f8462"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"969ee433-ed0d-4b37-bb3d-be875bf0ffd1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"2064d305-852a-47aa-89b9-7415f90c2152"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"2c8cf778-3d37-4c98-8b31-9655a78f8462","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_6ab2b3c5_fdb8_4960_9757_2248632372d6"}],"description":"","message_list":[],"uuid":"4816c3a5-66bf-4354-85eb-5699c92318ee","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"a7325f1d-0e67-462c-9ded-c76ec8fc8116"},"name":"SYS_GEN__Runbook_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6"}},{"description":"System action for starting an application","message_list":[],"uuid":"e0f4247d-00ed-47ec-b1ca-7832933b6792","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"},"retries":"0","description":"","type":"DAG","uuid":"f6378bb5-c561-4212-8fed-4ac9cff10f2c","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"3bf9807b-52db-4493-a3f4-6e8af8c46acc"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3bf9807b-52db-4493-a3f4-6e8af8c46acc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"06315356-0915-43ba-9316-e5d5ccb574c4","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"f6378bb5-c561-4212-8fed-4ac9cff10f2c"},"name":"SYS_GEN__Runbook_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6"}},{"description":"System action for restarting an application","message_list":[],"uuid":"7c45c962-cac0-4f95-b467-8ed9395491a7","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"},"retries":"0","description":"","type":"DAG","uuid":"a9510d06-1ac2-4684-be66-e85353001e27","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"a2d8324d-269b-4e86-8eea-70336c104d3f"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a2d8324d-269b-4e86-8eea-70336c104d3f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"ca8cec47-f6e6-4ffb-83f1-eb67ddbb98e2"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"b2620bbd-6c3b-4538-ae0d-7d8510053a3b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"a9510d06-1ac2-4684-be66-e85353001e27"},"name":"SYS_GEN__Runbook_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6"}},{"description":"System action for stopping an application","message_list":[],"uuid":"9958217e-33d1-4dd5-96ab-3f1ac759ee17","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"},"retries":"0","description":"","type":"DAG","uuid":"9a067d16-35e5-4afc-ab50-f4d66fdd2928","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"72ae71b8-5281-40a4-b061-de4d6be0f6cc"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"72ae71b8-5281-40a4-b061-de4d6be0f6cc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"ca01fea6-2a80-4bcf-a547-e3f7382ea551","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6","uuid":"9a067d16-35e5-4afc-ab50-f4d66fdd2928"},"name":"SYS_GEN__Runbook_Package_6ab2b3c5_fdb8_4960_9757_2248632372d6"}}],"message_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"}],"uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6","state":"ACTIVE","version":"","editables":{},"type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"},"retries":"0","description":"","type":"DAG","uuid":"eb0a4fbb-7076-41cd-904a-0eab8de3d5e4","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"f542c0ea-1657-4039-92e4-171897dc94cd"},{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"5e8f303d-fefa-4900-b070-d8f6086a3684"},{"kind":"app_task","name":"Generate Certs","uuid":"3772aab0-cf05-4779-b657-672a951c97a3"},{"kind":"app_task","name":"Configure Services","uuid":"0609cf4d-8689-4c65-8464-49aec84b95a1"},{"kind":"app_task","name":"Add User Roles","uuid":"ae1b7bbc-a3e9-4fc3-bf46-71c15a8b2c90"},{"kind":"app_task","name":"Network Configuration","uuid":"fdb6b70e-e4a8-452a-bfdb-7125ec563f87"},{"kind":"app_task","name":"DNS Configuration","uuid":"9b102b01-091c-4e25-b54c-faf1e8744c7e"},{"kind":"app_task","name":"EBS VolumePlugin","uuid":"bb84fcf0-b54f-4e39-92a0-14c53ca802af"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"f542c0ea-1657-4039-92e4-171897dc94cd"},"edge_type":"user_defined","type":"","uuid":"393b023b-e6d2-41a4-8c81-dd74bccce4c1","to_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"5e8f303d-fefa-4900-b070-d8f6086a3684"}},{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"5e8f303d-fefa-4900-b070-d8f6086a3684"},"edge_type":"user_defined","type":"","uuid":"364ee192-14bc-45cd-abf0-f85442c23a1a","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"3772aab0-cf05-4779-b657-672a951c97a3"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"3772aab0-cf05-4779-b657-672a951c97a3"},"edge_type":"user_defined","type":"","uuid":"297c9e2b-ae2e-4fe1-b1fb-769d1b0f62fe","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"0609cf4d-8689-4c65-8464-49aec84b95a1"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"0609cf4d-8689-4c65-8464-49aec84b95a1"},"edge_type":"user_defined","type":"","uuid":"44f5a8a2-6171-4ac1-b60d-c4f2fd5937ca","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"ae1b7bbc-a3e9-4fc3-bf46-71c15a8b2c90"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"ae1b7bbc-a3e9-4fc3-bf46-71c15a8b2c90"},"edge_type":"user_defined","type":"","uuid":"4b966a75-83ca-4ebb-910f-818f08ea5489","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"fdb6b70e-e4a8-452a-bfdb-7125ec563f87"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"fdb6b70e-e4a8-452a-bfdb-7125ec563f87"},"edge_type":"user_defined","type":"","uuid":"c337bb68-9651-4eb1-b6e7-bc5a875249e4","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"9b102b01-091c-4e25-b54c-faf1e8744c7e"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"9b102b01-091c-4e25-b54c-faf1e8744c7e"},"edge_type":"user_defined","type":"","uuid":"76e183c1-30d8-4507-9698-42b6da4461d5","to_task_reference":{"kind":"app_task","name":"EBS VolumePlugin","uuid":"bb84fcf0-b54f-4e39-92a0-14c53ca802af"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"84e097cf_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"f542c0ea-1657-4039-92e4-171897dc94cd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"5e8f303d-fefa-4900-b070-d8f6086a3684","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.3.12\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nWORKER_IPS=\"@@{AWS_Centos_K8SW.private_ip_address}@@\" # private Ip's\nMASTER_DNS=\"@@{calm_array_private_dns_name}@@\" # private Dns\nWORKER_DNS=\"@@{AWS_Centos_K8SW.private_dns_name}@@\" # private Dns\nPUBLIC_MASTER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_WORKER_IPS=\"@@{AWS_Centos_K8SW.public_ip_address}@@\"\nPUBLIC_MASTER_DNS=\"@@{calm_array_public_dns_name}@@\"\nPUBLIC_WORKER_DNS=\"@@{AWS_Centos_K8SW.public_dns_name}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y --quiet\nsudo yum install -y wget iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} master${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"master${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  count=$((count+1))\ndone   \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=aws \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/xvd{b,c,d}\nsudo vgcreate etcd \/dev\/xvd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/xvd{e,f,g}\nsudo vgcreate docker \/dev\/xvd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"3772aab0-cf05-4779-b657-672a951c97a3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\ndeclare -a INSTANCE_IPS\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nWORKER_IPS=\"@@{AWS_Centos_K8SW.private_ip_address}@@\" # private Ip's\nMASTER_DNS=\"@@{calm_array_private_dns_name}@@\" # private Dns\nWORKER_DNS=\"@@{AWS_Centos_K8SW.private_dns_name}@@\" # private Dns\nINSTANCE_IPS=($(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"))\nPUBLIC_MASTER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_WORKER_IPS=\"@@{AWS_Centos_K8SW.public_ip_address}@@\"\nPUBLIC_MASTER_DNS=\"@@{calm_array_public_dns_name}@@\"\nPUBLIC_WORKER_DNS=\"@@{AWS_Centos_K8SW.public_dns_name}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"master${count}\",\n  count=$((count+1))\ndone\nMASTER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"worker${count}\",\n  count=$((count+1))\ndone\nWORKER_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${MASTER_DNS},${PUBLIC_MASTER_IPS},${PUBLIC_MASTER_DNS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${MASTER_DNS},${PUBLIC_MASTER_IPS},${PUBLIC_MASTER_DNS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${MASTER_DNS},${PUBLIC_MASTER_IPS},${PUBLIC_MASTER_DNS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json \\\n-hostname=${MASTER_NAMES},${MASTER_IPS},${WORKER_NAMES},${WORKER_IPS},${FIRST_IP_SERVICE_SUBNET},${MASTER_DNS},${WORKER_DNS},${PUBLIC_MASTER_IPS},${PUBLIC_WORKER_IPS},${PUBLIC_MASTER_DNS},${PUBLIC_WORKER_DNS},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local \\\n-profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor name in $(echo ${MASTER_DNS} | tr \",\" \"\\n\"); do\ninstance=\"master${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${name}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${name},${INSTANCE_IPS[$count]} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor name in $(echo ${MASTER_DNS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=master${count}.kubeconfig\nkubectl config set-credentials system:node:${name} --client-certificate=master${count}.pem --client-key=master${count}-key.pem --embed-certs=true --kubeconfig=master${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${name} --kubeconfig=master${count}.kubeconfig\nkubectl config use-context default --kubeconfig=master${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"master${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"0609cf4d-8689-4c65-8464-49aec84b95a1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nCONTROLLER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --cloud-provider=aws\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=${KUBE_CLUSTER_NAME}  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --cloud-provider=aws\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n    \necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"ae1b7bbc-a3e9-4fc3-bf46-71c15a8b2c90","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet\nsudo systemctl enable etcd docker kubelet\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem master* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\n\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n    echo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF\n\ncat <<EOF | kubectl apply -f -\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: kube-aws:node-proxier\nsubjects:\n  - kind: User\n    name: kube-worker\n  - kind: ServiceAccount\n    name: kube-proxy\n    namespace: kube-system\n  - kind: Group\n    name: system:nodes\nroleRef:\n  kind: ClusterRole\n  name: system:node-proxier\n  apiGroup: rbac.authorization.k8s.io\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"fdb6b70e-e4a8-452a-bfdb-7125ec563f87","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ]]; then\nsudo mkdir -p \/etc\/kubernetes\/addons\/canal\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: canal-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  canal_iface: \"\"\n\n  masquerade: \"true\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: canal\n  namespace: kube-system\n  labels:\n    k8s-app: canal\nspec:\n  selector:\n    matchLabels:\n      k8s-app: canal\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: canal\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: canal\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-canal.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              value: \"none\"\n            - name: CLUSTER_TYPE\n              value: \"k8s,canal\"\n            - name: FELIX_IPTABLESREFRESHINTERVAL\n              value: \"60\"\n            - name: IP\n              value: \"\"\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"192.168.0.0\/16\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: \/readiness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n        - name: kube-flannel\n          image: quay.io\/coreos\/flannel:v0.9.1\n          command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n          securityContext:\n            privileged: true\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: FLANNELD_IFACE\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: canal_iface\n            - name: FLANNELD_IP_MASQ\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: masquerade\n          volumeMounts:\n          - mountPath: \/run\/xtables.lock\n            name: xtables-lock\n            readOnly: false\n          - name: flannel-cfg\n            mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: flannel-cfg\n          configMap:\n            name: canal-config\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: canal\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: canal-flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: canal-calico\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/canal\/canal.yml\nkubectl create -f \/etc\/kubernetes\/addons\/canal\/canal.yml\n\nelif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]];then\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/calico\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  calico_backend: \"bird\"\n\n  veth_mtu: \"1440\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: calico-node\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-calico.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CNI_MTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s,bgp\"\n            - name: IP\n              value: \"autodetect\"\n            - name: CALICO_IPV4POOL_IPIP\n              value: \"Always\"\n            - name: FELIX_IPINIPMTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"@@{KUBE_CLUSTER_SUBNET}@@\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            exec:\n              command:\n              - \/bin\/calico-node\n              - -bird-ready\n              - -felix-ready\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPPeer\n    plural: bgppeers\n    singular: bgppeer\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/calico\/calico.yml\nkubectl create -f \/etc\/kubernetes\/addons\/calico\/calico.yml  \n\nelse\n  echo \"Defaulting to flannel\"\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n  - kind: ServiceAccount\n    name: flannel\n    namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"hairpinMode\": true,\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - \/opt\/bin\/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n          limits:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/bin\/sh\", \"-c\", \"set -e -x; cp -f \/etc\/kube-flannel\/cni-conf.json \/etc\/cni\/net.d\/10-flannel.conf; while true; do sleep 3600; done\" ]\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nfi\n\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"9b102b01-091c-4e25-b54c-faf1e8744c7e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n  - name: dns\n    port: 53\n    protocol: UDP\n  - name: dns-tcp\n    port: 53\n    protocol: TCP\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: k8s.gcr.io\/k8s-dns-kube-dns:1.14.13\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: k8s.gcr.io\/k8s-dns-dnsmasq-nanny:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --no-negcache\n        - --dns-loop-detect\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: k8s.gcr.io\/k8s-dns-sidecar:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local,5,SRV\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local,5,SRV\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy: Default\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.2.0\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          - --target=Deployment\/kube-dns\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"bb84fcf0-b54f-4e39-92a0-14c53ca802af","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nsudo mkdir \"\/etc\/kubernetes\/addons\/volume\"\n\necho 'apiVersion: storage.k8s.io\/v1\nkind: StorageClass\nmetadata:\n  name: gp2\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: EnsureExists\nprovisioner: kubernetes.io\/aws-ebs\nparameters:\n  type: gp2' | sudo tee \/etc\/kubernetes\/addons\/volume\/default.yaml\n \nkubectl create -f \/etc\/kubernetes\/addons\/volume\/default.yaml "},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"EBS VolumePlugin"}],"description":"","message_list":[],"uuid":"94b46989-f45b-486e-9dff-731f3a0d6e2f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"84e097cf_dag","uuid":"eb0a4fbb-7076-41cd-904a-0eab8de3d5e4"},"name":"e836616a_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"},"retries":"0","description":"","type":"DAG","uuid":"aba7e289-21f7-4815-a99e-7f25116aa325","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"4226cd9d_dag"}],"description":"","message_list":[],"uuid":"b7c46034-6f60-40ce-aa4d-48473098d05f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"4226cd9d_dag","uuid":"aba7e289-21f7-4815-a99e-7f25116aa325"},"name":"18f2756f_runbook"}},"variable_list":[],"name":"AWS_Centos_K8SM_Package"},{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"2ab16d4f-396a-467b-9afb-be65a79883ae","name":"action_install","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"},"retries":"0","description":"","type":"DAG","uuid":"cfeec32f-5f63-474c-8036-fcc8e0c1b969","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Install_Crb_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"803e4088-8eb8-418f-9233-ade7a6b5557d"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_INSTALL","uuid":"803e4088-8eb8-418f-9233-ade7a6b5557d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"},"retries":"0","description":"","type":"DAG","uuid":"4fe416c6-2a45-450a-83e3-a8e063791ef6","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"9bdba192-a92b-4feb-bd3a-878d2f244be9"},{"kind":"app_task","name":"Docker Kubelet Install","uuid":"9f41602f-a83b-46ac-9ff7-ed38194e32f9"},{"kind":"app_task","name":"GetCerts","uuid":"3b02cb43-dd35-4a39-849a-bddf6b3d2c31"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"9bdba192-a92b-4feb-bd3a-878d2f244be9"},"edge_type":"user_defined","type":"","uuid":"8f7035f9-fc53-4970-98dd-2f01c3bad943","to_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"9f41602f-a83b-46ac-9ff7-ed38194e32f9"}},{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"9f41602f-a83b-46ac-9ff7-ed38194e32f9"},"edge_type":"user_defined","type":"","uuid":"8d6c31eb-238b-42f6-b125-10c0f7137eb4","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"3b02cb43-dd35-4a39-849a-bddf6b3d2c31"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"a4ecbecd_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"9bdba192-a92b-4feb-bd3a-878d2f244be9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"9f41602f-a83b-46ac-9ff7-ed38194e32f9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{AWS_Centos_K8SM.private_ip_address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y --quiet\nsudo yum install -y wget socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\n\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=aws \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/xvd{b,c,d}\nsudo vgcreate docker \/dev\/xvd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"3b02cb43-dd35-4a39-849a-bddf6b3d2c31","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{AWS_Centos_K8SM.private_ip_address[0]}@@\"\nINSTANCE_NAME=\"@@{private_dns_name}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nINSTANCE_IP=\"@@{private_ip_address}@@\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; if [[ $count -eq 600 ]]; then echo \"failed to download certs\" && exit 1; fi; count=$(($count+5)) ; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"worker@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${INSTANCE_NAME}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_NAME},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${INSTANCE_NAME} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${INSTANCE_NAME} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"ed0655ff-a96b-4d98-bec8-62c619c68992","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"a4ecbecd_dag","uuid":"4fe416c6-2a45-450a-83e3-a8e063791ef6"},"name":"dca27b9e_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"},"retries":"0","description":"","type":"DAG","uuid":"77e5b22b-1f9d-4e62-b9bc-466dbda4ebd2","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"e28691ec-bd93-4ca2-9e16-2c548ce7c98c"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"9e5b50bc_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"e28691ec-bd93-4ca2-9e16-2c548ce7c98c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain '@@{private_dns_name}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node '@@{private_dns_name}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"59a6bd18-ad76-4e6c-93de-40d50b63136d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"9e5b50bc_dag","uuid":"77e5b22b-1f9d-4e62-b9bc-466dbda4ebd2"},"name":"137c8a73_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Install_Crb_9d79b4a5_8fba_4074_80e9_4e490e46c463"}],"description":"","message_list":[],"uuid":"da8c44a9-1929-4f6e-82de-a739f5dae2ef","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"cfeec32f-5f63-474c-8036-fcc8e0c1b969"},"name":"SYS_GEN__Runbook_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463"}},{"description":"System action for creating an application","message_list":[],"uuid":"be57ecf3-b5d8-42b4-8a8a-44bc1c45a154","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"},"retries":"0","description":"","type":"DAG","uuid":"e917eac4-0d48-4e0e-8d8a-736c1b3c6bba","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"e566292c-ffbc-4125-bf98-815745f7076e"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"ca764239-82be-4db0-8d5f-5f481ee60cce"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"fa817e3b-7977-46f7-ab07-a502a25f9f98"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"ca764239-82be-4db0-8d5f-5f481ee60cce"},"edge_type":"inherent","type":"","uuid":"9a8e4a00-dd8e-479b-947e-1cb9069e4f9e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"fa817e3b-7977-46f7-ab07-a502a25f9f98"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"e566292c-ffbc-4125-bf98-815745f7076e"},"edge_type":"inherent","type":"","uuid":"010411c8-da94-4055-902a-02c57782abca","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"ca764239-82be-4db0-8d5f-5f481ee60cce"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e566292c-ffbc-4125-bf98-815745f7076e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"da8c44a9-1929-4f6e-82de-a739f5dae2ef"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ca764239-82be-4db0-8d5f-5f481ee60cce","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"cca906a5-5e79-422e-b15f-7391a907ad07"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"fa817e3b-7977-46f7-ab07-a502a25f9f98","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"b8b9166c-2afd-4236-a5a2-a5a13ea519db","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"e917eac4-0d48-4e0e-8d8a-736c1b3c6bba"},"name":"SYS_GEN__Runbook_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463"}},{"description":"System action for uninstalling an application","message_list":[],"uuid":"8abeb032-b4e3-4752-a917-a424d379a887","name":"action_uninstall","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"},"retries":"0","description":"","type":"DAG","uuid":"84c8e5b4-6b9d-49e2-80b8-b6ae44a83b3d","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Uninstall_Crb_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"b8cdf1b2-ba8c-4b87-bcd6-ac58214bb156"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_UNINSTALL","uuid":"b8cdf1b2-ba8c-4b87-bcd6-ac58214bb156","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"},"retries":"0","description":"","type":"DAG","uuid":"4fe416c6-2a45-450a-83e3-a8e063791ef6","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"9bdba192-a92b-4feb-bd3a-878d2f244be9"},{"kind":"app_task","name":"Docker Kubelet Install","uuid":"9f41602f-a83b-46ac-9ff7-ed38194e32f9"},{"kind":"app_task","name":"GetCerts","uuid":"3b02cb43-dd35-4a39-849a-bddf6b3d2c31"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"9bdba192-a92b-4feb-bd3a-878d2f244be9"},"edge_type":"user_defined","type":"","uuid":"8f7035f9-fc53-4970-98dd-2f01c3bad943","to_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"9f41602f-a83b-46ac-9ff7-ed38194e32f9"}},{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"9f41602f-a83b-46ac-9ff7-ed38194e32f9"},"edge_type":"user_defined","type":"","uuid":"8d6c31eb-238b-42f6-b125-10c0f7137eb4","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"3b02cb43-dd35-4a39-849a-bddf6b3d2c31"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"a4ecbecd_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"9bdba192-a92b-4feb-bd3a-878d2f244be9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"9f41602f-a83b-46ac-9ff7-ed38194e32f9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{AWS_Centos_K8SM.private_ip_address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y --quiet\nsudo yum install -y wget socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\n\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=aws \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/xvd{b,c,d}\nsudo vgcreate docker \/dev\/xvd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"3b02cb43-dd35-4a39-849a-bddf6b3d2c31","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{AWS_Centos_K8SM.private_ip_address[0]}@@\"\nINSTANCE_NAME=\"@@{private_dns_name}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nINSTANCE_IP=\"@@{private_ip_address}@@\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; if [[ $count -eq 600 ]]; then echo \"failed to download certs\" && exit 1; fi; count=$(($count+5)) ; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"worker@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${INSTANCE_NAME}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_NAME},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${INSTANCE_NAME} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${INSTANCE_NAME} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"ed0655ff-a96b-4d98-bec8-62c619c68992","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"a4ecbecd_dag","uuid":"4fe416c6-2a45-450a-83e3-a8e063791ef6"},"name":"dca27b9e_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"},"retries":"0","description":"","type":"DAG","uuid":"77e5b22b-1f9d-4e62-b9bc-466dbda4ebd2","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"e28691ec-bd93-4ca2-9e16-2c548ce7c98c"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"9e5b50bc_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"e28691ec-bd93-4ca2-9e16-2c548ce7c98c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain '@@{private_dns_name}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node '@@{private_dns_name}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"59a6bd18-ad76-4e6c-93de-40d50b63136d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"9e5b50bc_dag","uuid":"77e5b22b-1f9d-4e62-b9bc-466dbda4ebd2"},"name":"137c8a73_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Uninstall_Crb_9d79b4a5_8fba_4074_80e9_4e490e46c463"}],"description":"","message_list":[],"uuid":"2e4a4165-353e-4d7f-9347-9be0943bfd07","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"84c8e5b4-6b9d-49e2-80b8-b6ae44a83b3d"},"name":"SYS_GEN__Runbook_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"a280c875-e8e9-4bff-a345-ee434d80e734","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"},"retries":"0","description":"","type":"DAG","uuid":"2fdf4505-f1bc-4084-b4e0-42d4ebe0fbb4","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"ff96c1a8-04b2-456f-8944-fd685c711e4b"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"6015e89e-bb2c-4c27-9b2e-a67cc6456927"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"2f537a56-84a9-4573-b61c-67e932b884aa"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"ff96c1a8-04b2-456f-8944-fd685c711e4b"},"edge_type":"inherent","type":"","uuid":"2eaefd96-5526-420e-8248-e0bc03fa80c5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"6015e89e-bb2c-4c27-9b2e-a67cc6456927"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"6015e89e-bb2c-4c27-9b2e-a67cc6456927"},"edge_type":"inherent","type":"","uuid":"df5a6b93-8967-405d-8c40-ac7456ea03bf","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"2f537a56-84a9-4573-b61c-67e932b884aa"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ff96c1a8-04b2-456f-8944-fd685c711e4b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6015e89e-bb2c-4c27-9b2e-a67cc6456927","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"843ab0a6-03bd-4b9c-8f56-7d852e9348e0"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2f537a56-84a9-4573-b61c-67e932b884aa","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"2e4a4165-353e-4d7f-9347-9be0943bfd07"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463"}],"description":"","message_list":[],"uuid":"da03a232-c7e3-4dc8-bb3a-94f475dfb583","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"2fdf4505-f1bc-4084-b4e0-42d4ebe0fbb4"},"name":"SYS_GEN__Runbook_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"d24bfaea-a396-4fdb-8d81-6f169b2e9d76","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"},"retries":"0","description":"","type":"DAG","uuid":"6780cb7f-e136-45be-9fdc-9139cdda6fb4","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"d0f8f907-5fef-4fe9-9deb-b9a4867ef48b"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"b92a0360-264f-428a-b546-6677ea31443c"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"d0f8f907-5fef-4fe9-9deb-b9a4867ef48b"},"edge_type":"inherent","type":"","uuid":"a09c59c2-0476-4226-8bd6-fa0b05f86b61","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"b92a0360-264f-428a-b546-6677ea31443c"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d0f8f907-5fef-4fe9-9deb-b9a4867ef48b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"716ea7a7-bc0c-4ac5-ab9c-720c327a498e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"b92a0360-264f-428a-b546-6677ea31443c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_9d79b4a5_8fba_4074_80e9_4e490e46c463"}],"description":"","message_list":[],"uuid":"6e8b3df9-91cf-4f1d-bfea-d0ae315b40ba","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"6780cb7f-e136-45be-9fdc-9139cdda6fb4"},"name":"SYS_GEN__Runbook_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463"}},{"description":"System action for starting an application","message_list":[],"uuid":"f1545776-ec9d-488f-9fe0-6044d11b3078","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"},"retries":"0","description":"","type":"DAG","uuid":"86bc9629-417c-4fb5-b1ed-52eec99355f3","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"a66ec7c9-462a-4bc7-bf37-be278cae5531"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a66ec7c9-462a-4bc7-bf37-be278cae5531","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"00391c22-5065-4fcb-811c-43064f94d8d0","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"86bc9629-417c-4fb5-b1ed-52eec99355f3"},"name":"SYS_GEN__Runbook_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463"}},{"description":"System action for restarting an application","message_list":[],"uuid":"b191c53e-234a-4c5a-a3f9-7153993c8adf","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"},"retries":"0","description":"","type":"DAG","uuid":"bcceb594-b32d-4c41-a9b6-4e67b3f3afd6","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"7ed39cde-8b58-40f3-b1bf-f72503f52039"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"7ed39cde-8b58-40f3-b1bf-f72503f52039","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"ce602c49-d9cd-44d7-8e10-5671dc407b8b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"baaead0f-b628-4429-b1d6-5999bb4d7fd2","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"bcceb594-b32d-4c41-a9b6-4e67b3f3afd6"},"name":"SYS_GEN__Runbook_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463"}},{"description":"System action for stopping an application","message_list":[],"uuid":"96807d33-320e-4baa-9007-ca79c8918ece","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"},"retries":"0","description":"","type":"DAG","uuid":"b14235fe-8725-4b00-8439-b1c4b7602cb5","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"176cc128-982d-42ae-993f-6ccd2b023b8c"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"176cc128-982d-42ae-993f-6ccd2b023b8c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"079e76dd-8dc0-4d0a-8d94-801a9eb720d5","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463","uuid":"b14235fe-8725-4b00-8439-b1c4b7602cb5"},"name":"SYS_GEN__Runbook_Package_9d79b4a5_8fba_4074_80e9_4e490e46c463"}}],"message_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"}],"uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463","state":"ACTIVE","version":"","editables":{},"type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"},"retries":"0","description":"","type":"DAG","uuid":"4fe416c6-2a45-450a-83e3-a8e063791ef6","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"9bdba192-a92b-4feb-bd3a-878d2f244be9"},{"kind":"app_task","name":"Docker Kubelet Install","uuid":"9f41602f-a83b-46ac-9ff7-ed38194e32f9"},{"kind":"app_task","name":"GetCerts","uuid":"3b02cb43-dd35-4a39-849a-bddf6b3d2c31"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"9bdba192-a92b-4feb-bd3a-878d2f244be9"},"edge_type":"user_defined","type":"","uuid":"8f7035f9-fc53-4970-98dd-2f01c3bad943","to_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"9f41602f-a83b-46ac-9ff7-ed38194e32f9"}},{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"9f41602f-a83b-46ac-9ff7-ed38194e32f9"},"edge_type":"user_defined","type":"","uuid":"8d6c31eb-238b-42f6-b125-10c0f7137eb4","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"3b02cb43-dd35-4a39-849a-bddf6b3d2c31"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"a4ecbecd_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"9bdba192-a92b-4feb-bd3a-878d2f244be9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"9f41602f-a83b-46ac-9ff7-ed38194e32f9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{AWS_Centos_K8SM.private_ip_address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y --quiet\nsudo yum install -y wget socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\n\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=aws \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/xvd{b,c,d}\nsudo vgcreate docker \/dev\/xvd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"3b02cb43-dd35-4a39-849a-bddf6b3d2c31","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{AWS_Centos_K8SM.private_ip_address[0]}@@\"\nINSTANCE_NAME=\"@@{private_dns_name}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nINSTANCE_IP=\"@@{private_ip_address}@@\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; if [[ $count -eq 600 ]]; then echo \"failed to download certs\" && exit 1; fi; count=$(($count+5)) ; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"worker@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${INSTANCE_NAME}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_NAME},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${INSTANCE_NAME} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${INSTANCE_NAME} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"ed0655ff-a96b-4d98-bec8-62c619c68992","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"a4ecbecd_dag","uuid":"4fe416c6-2a45-450a-83e3-a8e063791ef6"},"name":"dca27b9e_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"},"retries":"0","description":"","type":"DAG","uuid":"77e5b22b-1f9d-4e62-b9bc-466dbda4ebd2","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"e28691ec-bd93-4ca2-9e16-2c548ce7c98c"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"9e5b50bc_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"e28691ec-bd93-4ca2-9e16-2c548ce7c98c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain '@@{private_dns_name}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node '@@{private_dns_name}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"59a6bd18-ad76-4e6c-93de-40d50b63136d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"9e5b50bc_dag","uuid":"77e5b22b-1f9d-4e62-b9bc-466dbda4ebd2"},"name":"137c8a73_runbook"}},"variable_list":[],"name":"AWS_Centos_K8SW_Package"},{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"994422f7-672a-41ee-9aae-06340f6bd828","name":"action_install","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"},"retries":"0","description":"","type":"DAG","uuid":"5755cd35-f296-42ce-a3c4-b250c2d38f86","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Install_Crb_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"e33eae77-eb8f-4860-ad4c-c5999c273aa2"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_0ad182b1_b1e7_476c_894c_8121c7440601"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_INSTALL","uuid":"e33eae77-eb8f-4860-ad4c-c5999c273aa2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"},"retries":"0","description":"","type":"DAG","uuid":"5d4b721d-3fd2-4fff-9f01-e389a6276b61","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"862c4e6c-0ac7-4d77-8a4d-0664a4b37c70"},{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"3e053207-7390-4d73-bada-954aee9817d3"},{"kind":"app_task","name":"Generate Certs","uuid":"9a3a04de-6409-4a59-a4a6-9c00082650dd"},{"kind":"app_task","name":"Configure Services","uuid":"c33329b2-13f3-4de0-ae12-a8dec0fdc9e4"},{"kind":"app_task","name":"Add User Roles","uuid":"1d4e7b6f-c2eb-4a2f-b1ce-d1d55c94f864"},{"kind":"app_task","name":"Network Configuration","uuid":"e0cf5979-5306-4e72-a93d-78311bfcad69"},{"kind":"app_task","name":"DNS Configuration","uuid":"987bc3c7-2a2c-4592-bd68-fc6431d2898d"},{"kind":"app_task","name":"GCE VolumePlugin","uuid":"31eb5b6b-5c67-48c0-9a56-00b7277a19c4"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"862c4e6c-0ac7-4d77-8a4d-0664a4b37c70"},"edge_type":"user_defined","type":"","uuid":"de2348c7-2318-4257-9e79-dfb66281958b","to_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"3e053207-7390-4d73-bada-954aee9817d3"}},{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"3e053207-7390-4d73-bada-954aee9817d3"},"edge_type":"user_defined","type":"","uuid":"51d6c43f-d565-4866-a416-61e095af11bd","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"9a3a04de-6409-4a59-a4a6-9c00082650dd"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"9a3a04de-6409-4a59-a4a6-9c00082650dd"},"edge_type":"user_defined","type":"","uuid":"2488676d-2476-40f6-903e-baa4e0df0d58","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"c33329b2-13f3-4de0-ae12-a8dec0fdc9e4"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"c33329b2-13f3-4de0-ae12-a8dec0fdc9e4"},"edge_type":"user_defined","type":"","uuid":"4ebf67a3-1920-4153-b24f-ae45d14eba9f","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"1d4e7b6f-c2eb-4a2f-b1ce-d1d55c94f864"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"1d4e7b6f-c2eb-4a2f-b1ce-d1d55c94f864"},"edge_type":"user_defined","type":"","uuid":"9bd97b41-84b0-450e-9c25-bca582b0a992","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"e0cf5979-5306-4e72-a93d-78311bfcad69"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"e0cf5979-5306-4e72-a93d-78311bfcad69"},"edge_type":"user_defined","type":"","uuid":"6a02b957-08e3-40e0-844d-c96e3100ef8a","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"987bc3c7-2a2c-4592-bd68-fc6431d2898d"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"987bc3c7-2a2c-4592-bd68-fc6431d2898d"},"edge_type":"user_defined","type":"","uuid":"7f2718af-3bff-4d17-8935-31f1e67111fc","to_task_reference":{"kind":"app_task","name":"GCE VolumePlugin","uuid":"31eb5b6b-5c67-48c0-9a56-00b7277a19c4"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"e07e43b0_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"862c4e6c-0ac7-4d77-8a4d-0664a4b37c70","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"3e053207-7390-4d73-bada-954aee9817d3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.3.12\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nWORKER_IPS=\"@@{GCP_Centos_K8SW.private_ip_address}@@\" # private Ip's\nPUBLIC_MASTER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_WORKER_IPS=\"@@{GCP_Centos_K8SW.public_ip_address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} master${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"master${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  count=$((count+1))\ndone   \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=gce \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate etcd \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/sd{e,f,g}\nsudo vgcreate docker \/dev\/sd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"9a3a04de-6409-4a59-a4a6-9c00082650dd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\ndeclare -a INSTANCE_IPS\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nWORKER_IPS=\"@@{GCP_Centos_K8SM.private_ip_address}@@\" # private Ip's\nPUBLIC_MASTER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_WORKER_IPS=\"@@{GCP_Centos_K8SM.public_ip_address}@@\"\nINSTANCE_IPS=($(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"))\nMASTER_NAMES=\"@@{calm_array_name}@@\"\nWORKER_NAMES=\"@@{GCP_Centos_K8SW.name}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${PUBLIC_MASTER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${PUBLIC_MASTER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${PUBLIC_MASTER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json \\\n-hostname=${MASTER_NAMES},${MASTER_IPS},${WORKER_NAMES},${WORKER_IPS},${FIRST_IP_SERVICE_SUBNET},${PUBLIC_MASTER_IPS},${PUBLIC_WORKER_IPS},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local \\\n-profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor name in $(echo ${MASTER_NAMES} | tr \",\" \"\\n\"); do\ninstance=\"master${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${name}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${name},${INSTANCE_IPS[$count]} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor name in $(echo ${MASTER_NAMES} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=master${count}.kubeconfig\nkubectl config set-credentials system:node:${name} --client-certificate=master${count}.pem --client-key=master${count}-key.pem --embed-certs=true --kubeconfig=master${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${name} --kubeconfig=master${count}.kubeconfig\nkubectl config use-context default --kubeconfig=master${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"master${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"c33329b2-13f3-4de0-ae12-a8dec0fdc9e4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nMASTER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${NODE_NAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${MASTER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --cloud-provider=gce\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=${KUBE_CLUSTER_NAME}\n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --cloud-provider=gce\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n\necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"1d4e7b6f-c2eb-4a2f-b1ce-d1d55c94f864","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet\nsudo systemctl enable etcd docker kubelet\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem master* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\n\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF\n\ncat <<EOF | kubectl apply -f -\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: kube-aws:node-proxier\nsubjects:\n  - kind: User\n    name: kube-worker\n  - kind: ServiceAccount\n    name: kube-proxy\n    namespace: kube-system\n  - kind: Group\n    name: system:nodes\nroleRef:\n  kind: ClusterRole\n  name: system:node-proxier\n  apiGroup: rbac.authorization.k8s.io\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"e0cf5979-5306-4e72-a93d-78311bfcad69","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ]]; then\nsudo mkdir -p \/etc\/kubernetes\/addons\/canal\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: canal-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  canal_iface: \"\"\n\n  masquerade: \"true\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: canal\n  namespace: kube-system\n  labels:\n    k8s-app: canal\nspec:\n  selector:\n    matchLabels:\n      k8s-app: canal\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: canal\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: canal\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-canal.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              value: \"none\"\n            - name: CLUSTER_TYPE\n              value: \"k8s,canal\"\n            - name: FELIX_IPTABLESREFRESHINTERVAL\n              value: \"60\"\n            - name: IP\n              value: \"\"\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"192.168.0.0\/16\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: \/readiness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n        - name: kube-flannel\n          image: quay.io\/coreos\/flannel:v0.9.1\n          command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n          securityContext:\n            privileged: true\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: FLANNELD_IFACE\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: canal_iface\n            - name: FLANNELD_IP_MASQ\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: masquerade\n          volumeMounts:\n          - mountPath: \/run\/xtables.lock\n            name: xtables-lock\n            readOnly: false\n          - name: flannel-cfg\n            mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: flannel-cfg\n          configMap:\n            name: canal-config\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: canal\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: canal-flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: canal-calico\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/canal\/canal.yml\nkubectl create -f \/etc\/kubernetes\/addons\/canal\/canal.yml\n\nelif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]];then\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/calico\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  calico_backend: \"bird\"\n\n  veth_mtu: \"1440\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: calico-node\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-calico.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CNI_MTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s,bgp\"\n            - name: IP\n              value: \"autodetect\"\n            - name: CALICO_IPV4POOL_IPIP\n              value: \"Always\"\n            - name: FELIX_IPINIPMTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"@@{KUBE_CLUSTER_SUBNET}@@\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            exec:\n              command:\n              - \/bin\/calico-node\n              - -bird-ready\n              - -felix-ready\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPPeer\n    plural: bgppeers\n    singular: bgppeer\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/calico\/calico.yml\nkubectl create -f \/etc\/kubernetes\/addons\/calico\/calico.yml  \n\nelse\n  echo \"Defaulting to flannel\"\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n  - kind: ServiceAccount\n    name: flannel\n    namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"hairpinMode\": true,\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - \/opt\/bin\/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n          limits:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/bin\/sh\", \"-c\", \"set -e -x; cp -f \/etc\/kube-flannel\/cni-conf.json \/etc\/cni\/net.d\/10-flannel.conf; while true; do sleep 3600; done\" ]\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nfi\n\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"987bc3c7-2a2c-4592-bd68-fc6431d2898d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n  - name: dns\n    port: 53\n    protocol: UDP\n  - name: dns-tcp\n    port: 53\n    protocol: TCP\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: k8s.gcr.io\/k8s-dns-kube-dns:1.14.13\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: k8s.gcr.io\/k8s-dns-dnsmasq-nanny:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --no-negcache\n        - --dns-loop-detect\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: k8s.gcr.io\/k8s-dns-sidecar:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local,5,SRV\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local,5,SRV\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy: Default\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.2.0\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          - --target=Deployment\/kube-dns\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"31eb5b6b-5c67-48c0-9a56-00b7277a19c4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nsudo mkdir \"\/etc\/kubernetes\/addons\/volume\"\n\necho 'apiVersion: storage.k8s.io\/v1\nkind: StorageClass\nmetadata:\n  name: standard\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: EnsureExists\nprovisioner: kubernetes.io\/gce-pd\nparameters:\n  type: pd-standard' | sudo tee \/etc\/kubernetes\/addons\/volume\/default.yaml\n \nkubectl create -f \/etc\/kubernetes\/addons\/volume\/default.yaml "},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GCE VolumePlugin"}],"description":"","message_list":[],"uuid":"157634a8-f391-47c0-98bb-3a0647057d1b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"e07e43b0_dag","uuid":"5d4b721d-3fd2-4fff-9f01-e389a6276b61"},"name":"26c82c77_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"},"retries":"0","description":"","type":"DAG","uuid":"6b789466-f815-4bc0-a283-e1312f9d3c3d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6bbde6e8_dag"}],"description":"","message_list":[],"uuid":"176acdaa-f7d6-4e53-9387-6d5cf06af409","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6bbde6e8_dag","uuid":"6b789466-f815-4bc0-a283-e1312f9d3c3d"},"name":"6eaeef4c_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Install_Crb_0ad182b1_b1e7_476c_894c_8121c7440601"}],"description":"","message_list":[],"uuid":"06390bdf-bec5-439f-851c-d9bbd17ab64e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"5755cd35-f296-42ce-a3c4-b250c2d38f86"},"name":"SYS_GEN__Runbook_Package_0ad182b1_b1e7_476c_894c_8121c7440601"}},{"description":"System action for creating an application","message_list":[],"uuid":"1abac5bd-38ce-4ebd-89c9-40d15f3d9a1a","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"},"retries":"0","description":"","type":"DAG","uuid":"af6c2490-dd81-4fcc-9566-5be837736fc1","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"89fc6f59-3315-4290-ba96-41eef1888823"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"daf93fd6-29c4-42d8-b363-3635c48c327d"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"aaa6e9f1-0a9d-406e-af87-f8e08fc7f00b"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"daf93fd6-29c4-42d8-b363-3635c48c327d"},"edge_type":"inherent","type":"","uuid":"ae6555d4-1aed-486e-b25f-4222310bbc6f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"aaa6e9f1-0a9d-406e-af87-f8e08fc7f00b"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"89fc6f59-3315-4290-ba96-41eef1888823"},"edge_type":"inherent","type":"","uuid":"f9ddc3a0-f38d-4be9-b265-125f7611311b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"daf93fd6-29c4-42d8-b363-3635c48c327d"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_0ad182b1_b1e7_476c_894c_8121c7440601"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"89fc6f59-3315-4290-ba96-41eef1888823","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"06390bdf-bec5-439f-851c-d9bbd17ab64e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_0ad182b1_b1e7_476c_894c_8121c7440601"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"daf93fd6-29c4-42d8-b363-3635c48c327d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"384cf3d8-e940-43f1-a289-6c6b363c5371"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"aaa6e9f1-0a9d-406e-af87-f8e08fc7f00b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"1e8302ac-0154-43fb-9b11-90c71678fd01","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"af6c2490-dd81-4fcc-9566-5be837736fc1"},"name":"SYS_GEN__Runbook_Package_0ad182b1_b1e7_476c_894c_8121c7440601"}},{"description":"System action for uninstalling an application","message_list":[],"uuid":"3725d779-ded8-4f3e-9cb8-ca585ee0386c","name":"action_uninstall","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"},"retries":"0","description":"","type":"DAG","uuid":"438c7472-91bd-4336-840a-2d67a96ee84e","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Uninstall_Crb_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"d5b6da1c-1dba-479d-a977-caa8b460f23c"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_0ad182b1_b1e7_476c_894c_8121c7440601"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_UNINSTALL","uuid":"d5b6da1c-1dba-479d-a977-caa8b460f23c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"},"retries":"0","description":"","type":"DAG","uuid":"5d4b721d-3fd2-4fff-9f01-e389a6276b61","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"862c4e6c-0ac7-4d77-8a4d-0664a4b37c70"},{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"3e053207-7390-4d73-bada-954aee9817d3"},{"kind":"app_task","name":"Generate Certs","uuid":"9a3a04de-6409-4a59-a4a6-9c00082650dd"},{"kind":"app_task","name":"Configure Services","uuid":"c33329b2-13f3-4de0-ae12-a8dec0fdc9e4"},{"kind":"app_task","name":"Add User Roles","uuid":"1d4e7b6f-c2eb-4a2f-b1ce-d1d55c94f864"},{"kind":"app_task","name":"Network Configuration","uuid":"e0cf5979-5306-4e72-a93d-78311bfcad69"},{"kind":"app_task","name":"DNS Configuration","uuid":"987bc3c7-2a2c-4592-bd68-fc6431d2898d"},{"kind":"app_task","name":"GCE VolumePlugin","uuid":"31eb5b6b-5c67-48c0-9a56-00b7277a19c4"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"862c4e6c-0ac7-4d77-8a4d-0664a4b37c70"},"edge_type":"user_defined","type":"","uuid":"de2348c7-2318-4257-9e79-dfb66281958b","to_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"3e053207-7390-4d73-bada-954aee9817d3"}},{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"3e053207-7390-4d73-bada-954aee9817d3"},"edge_type":"user_defined","type":"","uuid":"51d6c43f-d565-4866-a416-61e095af11bd","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"9a3a04de-6409-4a59-a4a6-9c00082650dd"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"9a3a04de-6409-4a59-a4a6-9c00082650dd"},"edge_type":"user_defined","type":"","uuid":"2488676d-2476-40f6-903e-baa4e0df0d58","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"c33329b2-13f3-4de0-ae12-a8dec0fdc9e4"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"c33329b2-13f3-4de0-ae12-a8dec0fdc9e4"},"edge_type":"user_defined","type":"","uuid":"4ebf67a3-1920-4153-b24f-ae45d14eba9f","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"1d4e7b6f-c2eb-4a2f-b1ce-d1d55c94f864"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"1d4e7b6f-c2eb-4a2f-b1ce-d1d55c94f864"},"edge_type":"user_defined","type":"","uuid":"9bd97b41-84b0-450e-9c25-bca582b0a992","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"e0cf5979-5306-4e72-a93d-78311bfcad69"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"e0cf5979-5306-4e72-a93d-78311bfcad69"},"edge_type":"user_defined","type":"","uuid":"6a02b957-08e3-40e0-844d-c96e3100ef8a","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"987bc3c7-2a2c-4592-bd68-fc6431d2898d"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"987bc3c7-2a2c-4592-bd68-fc6431d2898d"},"edge_type":"user_defined","type":"","uuid":"7f2718af-3bff-4d17-8935-31f1e67111fc","to_task_reference":{"kind":"app_task","name":"GCE VolumePlugin","uuid":"31eb5b6b-5c67-48c0-9a56-00b7277a19c4"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"e07e43b0_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"862c4e6c-0ac7-4d77-8a4d-0664a4b37c70","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"3e053207-7390-4d73-bada-954aee9817d3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.3.12\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nWORKER_IPS=\"@@{GCP_Centos_K8SW.private_ip_address}@@\" # private Ip's\nPUBLIC_MASTER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_WORKER_IPS=\"@@{GCP_Centos_K8SW.public_ip_address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} master${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"master${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  count=$((count+1))\ndone   \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=gce \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate etcd \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/sd{e,f,g}\nsudo vgcreate docker \/dev\/sd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"9a3a04de-6409-4a59-a4a6-9c00082650dd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\ndeclare -a INSTANCE_IPS\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nWORKER_IPS=\"@@{GCP_Centos_K8SM.private_ip_address}@@\" # private Ip's\nPUBLIC_MASTER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_WORKER_IPS=\"@@{GCP_Centos_K8SM.public_ip_address}@@\"\nINSTANCE_IPS=($(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"))\nMASTER_NAMES=\"@@{calm_array_name}@@\"\nWORKER_NAMES=\"@@{GCP_Centos_K8SW.name}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${PUBLIC_MASTER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${PUBLIC_MASTER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${PUBLIC_MASTER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json \\\n-hostname=${MASTER_NAMES},${MASTER_IPS},${WORKER_NAMES},${WORKER_IPS},${FIRST_IP_SERVICE_SUBNET},${PUBLIC_MASTER_IPS},${PUBLIC_WORKER_IPS},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local \\\n-profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor name in $(echo ${MASTER_NAMES} | tr \",\" \"\\n\"); do\ninstance=\"master${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${name}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${name},${INSTANCE_IPS[$count]} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor name in $(echo ${MASTER_NAMES} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=master${count}.kubeconfig\nkubectl config set-credentials system:node:${name} --client-certificate=master${count}.pem --client-key=master${count}-key.pem --embed-certs=true --kubeconfig=master${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${name} --kubeconfig=master${count}.kubeconfig\nkubectl config use-context default --kubeconfig=master${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"master${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"c33329b2-13f3-4de0-ae12-a8dec0fdc9e4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nMASTER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${NODE_NAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${MASTER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --cloud-provider=gce\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=${KUBE_CLUSTER_NAME}\n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --cloud-provider=gce\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n\necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"1d4e7b6f-c2eb-4a2f-b1ce-d1d55c94f864","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet\nsudo systemctl enable etcd docker kubelet\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem master* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\n\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF\n\ncat <<EOF | kubectl apply -f -\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: kube-aws:node-proxier\nsubjects:\n  - kind: User\n    name: kube-worker\n  - kind: ServiceAccount\n    name: kube-proxy\n    namespace: kube-system\n  - kind: Group\n    name: system:nodes\nroleRef:\n  kind: ClusterRole\n  name: system:node-proxier\n  apiGroup: rbac.authorization.k8s.io\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"e0cf5979-5306-4e72-a93d-78311bfcad69","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ]]; then\nsudo mkdir -p \/etc\/kubernetes\/addons\/canal\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: canal-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  canal_iface: \"\"\n\n  masquerade: \"true\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: canal\n  namespace: kube-system\n  labels:\n    k8s-app: canal\nspec:\n  selector:\n    matchLabels:\n      k8s-app: canal\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: canal\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: canal\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-canal.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              value: \"none\"\n            - name: CLUSTER_TYPE\n              value: \"k8s,canal\"\n            - name: FELIX_IPTABLESREFRESHINTERVAL\n              value: \"60\"\n            - name: IP\n              value: \"\"\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"192.168.0.0\/16\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: \/readiness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n        - name: kube-flannel\n          image: quay.io\/coreos\/flannel:v0.9.1\n          command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n          securityContext:\n            privileged: true\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: FLANNELD_IFACE\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: canal_iface\n            - name: FLANNELD_IP_MASQ\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: masquerade\n          volumeMounts:\n          - mountPath: \/run\/xtables.lock\n            name: xtables-lock\n            readOnly: false\n          - name: flannel-cfg\n            mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: flannel-cfg\n          configMap:\n            name: canal-config\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: canal\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: canal-flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: canal-calico\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/canal\/canal.yml\nkubectl create -f \/etc\/kubernetes\/addons\/canal\/canal.yml\n\nelif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]];then\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/calico\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  calico_backend: \"bird\"\n\n  veth_mtu: \"1440\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: calico-node\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-calico.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CNI_MTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s,bgp\"\n            - name: IP\n              value: \"autodetect\"\n            - name: CALICO_IPV4POOL_IPIP\n              value: \"Always\"\n            - name: FELIX_IPINIPMTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"@@{KUBE_CLUSTER_SUBNET}@@\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            exec:\n              command:\n              - \/bin\/calico-node\n              - -bird-ready\n              - -felix-ready\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPPeer\n    plural: bgppeers\n    singular: bgppeer\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/calico\/calico.yml\nkubectl create -f \/etc\/kubernetes\/addons\/calico\/calico.yml  \n\nelse\n  echo \"Defaulting to flannel\"\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n  - kind: ServiceAccount\n    name: flannel\n    namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"hairpinMode\": true,\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - \/opt\/bin\/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n          limits:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/bin\/sh\", \"-c\", \"set -e -x; cp -f \/etc\/kube-flannel\/cni-conf.json \/etc\/cni\/net.d\/10-flannel.conf; while true; do sleep 3600; done\" ]\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nfi\n\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"987bc3c7-2a2c-4592-bd68-fc6431d2898d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n  - name: dns\n    port: 53\n    protocol: UDP\n  - name: dns-tcp\n    port: 53\n    protocol: TCP\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: k8s.gcr.io\/k8s-dns-kube-dns:1.14.13\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: k8s.gcr.io\/k8s-dns-dnsmasq-nanny:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --no-negcache\n        - --dns-loop-detect\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: k8s.gcr.io\/k8s-dns-sidecar:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local,5,SRV\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local,5,SRV\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy: Default\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.2.0\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          - --target=Deployment\/kube-dns\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"31eb5b6b-5c67-48c0-9a56-00b7277a19c4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nsudo mkdir \"\/etc\/kubernetes\/addons\/volume\"\n\necho 'apiVersion: storage.k8s.io\/v1\nkind: StorageClass\nmetadata:\n  name: standard\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: EnsureExists\nprovisioner: kubernetes.io\/gce-pd\nparameters:\n  type: pd-standard' | sudo tee \/etc\/kubernetes\/addons\/volume\/default.yaml\n \nkubectl create -f \/etc\/kubernetes\/addons\/volume\/default.yaml "},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GCE VolumePlugin"}],"description":"","message_list":[],"uuid":"157634a8-f391-47c0-98bb-3a0647057d1b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"e07e43b0_dag","uuid":"5d4b721d-3fd2-4fff-9f01-e389a6276b61"},"name":"26c82c77_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"},"retries":"0","description":"","type":"DAG","uuid":"6b789466-f815-4bc0-a283-e1312f9d3c3d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6bbde6e8_dag"}],"description":"","message_list":[],"uuid":"176acdaa-f7d6-4e53-9387-6d5cf06af409","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6bbde6e8_dag","uuid":"6b789466-f815-4bc0-a283-e1312f9d3c3d"},"name":"6eaeef4c_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Uninstall_Crb_0ad182b1_b1e7_476c_894c_8121c7440601"}],"description":"","message_list":[],"uuid":"79773e8b-084a-43f6-9e69-8f811fe0d528","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"438c7472-91bd-4336-840a-2d67a96ee84e"},"name":"SYS_GEN__Runbook_Package_0ad182b1_b1e7_476c_894c_8121c7440601"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"f41d6381-32f3-4b49-952d-f64bab59ba13","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"},"retries":"0","description":"","type":"DAG","uuid":"0f5e6249-835c-4c41-a1d4-9ddc4ce2fe31","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"2c7a402e-c17f-4139-8f20-18f87ae8f432"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"4ecbdd3d-45d5-41ea-9f84-6f8b8b79684b"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"5a87f3d0-2b80-4991-907d-e2d15dc5ca9b"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"2c7a402e-c17f-4139-8f20-18f87ae8f432"},"edge_type":"inherent","type":"","uuid":"c0e1860b-aa10-4823-9f22-c68bbd6d69fb","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"4ecbdd3d-45d5-41ea-9f84-6f8b8b79684b"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"4ecbdd3d-45d5-41ea-9f84-6f8b8b79684b"},"edge_type":"inherent","type":"","uuid":"b26486e2-d403-45f5-96a1-422ccc735a53","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"5a87f3d0-2b80-4991-907d-e2d15dc5ca9b"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_0ad182b1_b1e7_476c_894c_8121c7440601"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2c7a402e-c17f-4139-8f20-18f87ae8f432","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4ecbdd3d-45d5-41ea-9f84-6f8b8b79684b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"7f713d48-74e9-4bb6-8dc9-eb8f00371ff3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5a87f3d0-2b80-4991-907d-e2d15dc5ca9b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"79773e8b-084a-43f6-9e69-8f811fe0d528"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_0ad182b1_b1e7_476c_894c_8121c7440601"}],"description":"","message_list":[],"uuid":"516b73f9-a569-49fe-baf2-1de2d2857653","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"0f5e6249-835c-4c41-a1d4-9ddc4ce2fe31"},"name":"SYS_GEN__Runbook_Package_0ad182b1_b1e7_476c_894c_8121c7440601"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"96a1aba1-681f-4705-83e7-586913b01348","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"},"retries":"0","description":"","type":"DAG","uuid":"a90d73af-5e45-4131-91da-82276fc6428b","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"8b9bdb54-4836-4b2b-b940-1b98e8af8fca"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"1d0827a6-0be8-4928-aeb0-b12fc49bd96b"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"8b9bdb54-4836-4b2b-b940-1b98e8af8fca"},"edge_type":"inherent","type":"","uuid":"2eee87a3-7e51-411b-bd50-8339442c90ed","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"1d0827a6-0be8-4928-aeb0-b12fc49bd96b"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_0ad182b1_b1e7_476c_894c_8121c7440601"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8b9bdb54-4836-4b2b-b940-1b98e8af8fca","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"2064d305-852a-47aa-89b9-7415f90c2152"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"1d0827a6-0be8-4928-aeb0-b12fc49bd96b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_0ad182b1_b1e7_476c_894c_8121c7440601"}],"description":"","message_list":[],"uuid":"6d345bb7-a108-4ec5-a4dd-092b34fd4e1c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"a90d73af-5e45-4131-91da-82276fc6428b"},"name":"SYS_GEN__Runbook_Package_0ad182b1_b1e7_476c_894c_8121c7440601"}},{"description":"System action for starting an application","message_list":[],"uuid":"b7d2c41d-85dd-4d08-b1ce-9e5967188583","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"},"retries":"0","description":"","type":"DAG","uuid":"8391c4c5-994d-4493-ad23-a161ac0acb33","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"6ea5b1b2-13bd-4891-a84e-decc369189b4"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_0ad182b1_b1e7_476c_894c_8121c7440601"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6ea5b1b2-13bd-4891-a84e-decc369189b4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"32d1d6e7-c0b2-4bfc-9492-41fc2c54d2f9","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"8391c4c5-994d-4493-ad23-a161ac0acb33"},"name":"SYS_GEN__Runbook_Package_0ad182b1_b1e7_476c_894c_8121c7440601"}},{"description":"System action for restarting an application","message_list":[],"uuid":"fcc1b847-ca8b-4506-9d52-95661bf341aa","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"},"retries":"0","description":"","type":"DAG","uuid":"8ecb26cd-4c6d-4824-adda-3595f1411747","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"cc0b1f46-ec8b-4e29-8f7d-e13d3211b221"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_0ad182b1_b1e7_476c_894c_8121c7440601"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"cc0b1f46-ec8b-4e29-8f7d-e13d3211b221","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"ca8cec47-f6e6-4ffb-83f1-eb67ddbb98e2"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"482ebf8a-08cd-492d-8613-ce1873ec7d6e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"8ecb26cd-4c6d-4824-adda-3595f1411747"},"name":"SYS_GEN__Runbook_Package_0ad182b1_b1e7_476c_894c_8121c7440601"}},{"description":"System action for stopping an application","message_list":[],"uuid":"b0e53532-854a-455a-a057-da770064fcbf","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"},"retries":"0","description":"","type":"DAG","uuid":"b177ec08-0968-461d-8f02-ebc214517851","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"a81a36ce-83dc-476c-ac59-b4c981e717a5"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_0ad182b1_b1e7_476c_894c_8121c7440601"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a81a36ce-83dc-476c-ac59-b4c981e717a5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"5a21c10f-3477-4579-9ded-2028b1eba12c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_0ad182b1_b1e7_476c_894c_8121c7440601","uuid":"b177ec08-0968-461d-8f02-ebc214517851"},"name":"SYS_GEN__Runbook_Package_0ad182b1_b1e7_476c_894c_8121c7440601"}}],"message_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"}],"uuid":"0ad182b1-b1e7-476c-894c-8121c7440601","state":"ACTIVE","version":"","editables":{},"type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"},"retries":"0","description":"","type":"DAG","uuid":"5d4b721d-3fd2-4fff-9f01-e389a6276b61","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"862c4e6c-0ac7-4d77-8a4d-0664a4b37c70"},{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"3e053207-7390-4d73-bada-954aee9817d3"},{"kind":"app_task","name":"Generate Certs","uuid":"9a3a04de-6409-4a59-a4a6-9c00082650dd"},{"kind":"app_task","name":"Configure Services","uuid":"c33329b2-13f3-4de0-ae12-a8dec0fdc9e4"},{"kind":"app_task","name":"Add User Roles","uuid":"1d4e7b6f-c2eb-4a2f-b1ce-d1d55c94f864"},{"kind":"app_task","name":"Network Configuration","uuid":"e0cf5979-5306-4e72-a93d-78311bfcad69"},{"kind":"app_task","name":"DNS Configuration","uuid":"987bc3c7-2a2c-4592-bd68-fc6431d2898d"},{"kind":"app_task","name":"GCE VolumePlugin","uuid":"31eb5b6b-5c67-48c0-9a56-00b7277a19c4"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"862c4e6c-0ac7-4d77-8a4d-0664a4b37c70"},"edge_type":"user_defined","type":"","uuid":"de2348c7-2318-4257-9e79-dfb66281958b","to_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"3e053207-7390-4d73-bada-954aee9817d3"}},{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"3e053207-7390-4d73-bada-954aee9817d3"},"edge_type":"user_defined","type":"","uuid":"51d6c43f-d565-4866-a416-61e095af11bd","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"9a3a04de-6409-4a59-a4a6-9c00082650dd"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"9a3a04de-6409-4a59-a4a6-9c00082650dd"},"edge_type":"user_defined","type":"","uuid":"2488676d-2476-40f6-903e-baa4e0df0d58","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"c33329b2-13f3-4de0-ae12-a8dec0fdc9e4"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"c33329b2-13f3-4de0-ae12-a8dec0fdc9e4"},"edge_type":"user_defined","type":"","uuid":"4ebf67a3-1920-4153-b24f-ae45d14eba9f","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"1d4e7b6f-c2eb-4a2f-b1ce-d1d55c94f864"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"1d4e7b6f-c2eb-4a2f-b1ce-d1d55c94f864"},"edge_type":"user_defined","type":"","uuid":"9bd97b41-84b0-450e-9c25-bca582b0a992","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"e0cf5979-5306-4e72-a93d-78311bfcad69"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"e0cf5979-5306-4e72-a93d-78311bfcad69"},"edge_type":"user_defined","type":"","uuid":"6a02b957-08e3-40e0-844d-c96e3100ef8a","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"987bc3c7-2a2c-4592-bd68-fc6431d2898d"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"987bc3c7-2a2c-4592-bd68-fc6431d2898d"},"edge_type":"user_defined","type":"","uuid":"7f2718af-3bff-4d17-8935-31f1e67111fc","to_task_reference":{"kind":"app_task","name":"GCE VolumePlugin","uuid":"31eb5b6b-5c67-48c0-9a56-00b7277a19c4"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"e07e43b0_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"862c4e6c-0ac7-4d77-8a4d-0664a4b37c70","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"3e053207-7390-4d73-bada-954aee9817d3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.3.12\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nWORKER_IPS=\"@@{GCP_Centos_K8SW.private_ip_address}@@\" # private Ip's\nPUBLIC_MASTER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_WORKER_IPS=\"@@{GCP_Centos_K8SW.public_ip_address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} master${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"master${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  count=$((count+1))\ndone   \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=gce \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate etcd \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/sd{e,f,g}\nsudo vgcreate docker \/dev\/sd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"9a3a04de-6409-4a59-a4a6-9c00082650dd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\ndeclare -a INSTANCE_IPS\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nWORKER_IPS=\"@@{GCP_Centos_K8SM.private_ip_address}@@\" # private Ip's\nPUBLIC_MASTER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_WORKER_IPS=\"@@{GCP_Centos_K8SM.public_ip_address}@@\"\nINSTANCE_IPS=($(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"))\nMASTER_NAMES=\"@@{calm_array_name}@@\"\nWORKER_NAMES=\"@@{GCP_Centos_K8SW.name}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${PUBLIC_MASTER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${PUBLIC_MASTER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${PUBLIC_MASTER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json \\\n-hostname=${MASTER_NAMES},${MASTER_IPS},${WORKER_NAMES},${WORKER_IPS},${FIRST_IP_SERVICE_SUBNET},${PUBLIC_MASTER_IPS},${PUBLIC_WORKER_IPS},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local \\\n-profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor name in $(echo ${MASTER_NAMES} | tr \",\" \"\\n\"); do\ninstance=\"master${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${name}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${name},${INSTANCE_IPS[$count]} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor name in $(echo ${MASTER_NAMES} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=master${count}.kubeconfig\nkubectl config set-credentials system:node:${name} --client-certificate=master${count}.pem --client-key=master${count}-key.pem --embed-certs=true --kubeconfig=master${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${name} --kubeconfig=master${count}.kubeconfig\nkubectl config use-context default --kubeconfig=master${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"master${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"c33329b2-13f3-4de0-ae12-a8dec0fdc9e4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nMASTER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${NODE_NAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${MASTER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --cloud-provider=gce\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=${KUBE_CLUSTER_NAME}\n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --cloud-provider=gce\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n\necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"1d4e7b6f-c2eb-4a2f-b1ce-d1d55c94f864","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet\nsudo systemctl enable etcd docker kubelet\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem master* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\n\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF\n\ncat <<EOF | kubectl apply -f -\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: kube-aws:node-proxier\nsubjects:\n  - kind: User\n    name: kube-worker\n  - kind: ServiceAccount\n    name: kube-proxy\n    namespace: kube-system\n  - kind: Group\n    name: system:nodes\nroleRef:\n  kind: ClusterRole\n  name: system:node-proxier\n  apiGroup: rbac.authorization.k8s.io\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"e0cf5979-5306-4e72-a93d-78311bfcad69","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ]]; then\nsudo mkdir -p \/etc\/kubernetes\/addons\/canal\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: canal-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  canal_iface: \"\"\n\n  masquerade: \"true\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: canal\n  namespace: kube-system\n  labels:\n    k8s-app: canal\nspec:\n  selector:\n    matchLabels:\n      k8s-app: canal\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: canal\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: canal\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-canal.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              value: \"none\"\n            - name: CLUSTER_TYPE\n              value: \"k8s,canal\"\n            - name: FELIX_IPTABLESREFRESHINTERVAL\n              value: \"60\"\n            - name: IP\n              value: \"\"\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"192.168.0.0\/16\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: \/readiness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n        - name: kube-flannel\n          image: quay.io\/coreos\/flannel:v0.9.1\n          command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n          securityContext:\n            privileged: true\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: FLANNELD_IFACE\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: canal_iface\n            - name: FLANNELD_IP_MASQ\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: masquerade\n          volumeMounts:\n          - mountPath: \/run\/xtables.lock\n            name: xtables-lock\n            readOnly: false\n          - name: flannel-cfg\n            mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: flannel-cfg\n          configMap:\n            name: canal-config\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: canal\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: canal-flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: canal-calico\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/canal\/canal.yml\nkubectl create -f \/etc\/kubernetes\/addons\/canal\/canal.yml\n\nelif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]];then\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/calico\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  calico_backend: \"bird\"\n\n  veth_mtu: \"1440\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: calico-node\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-calico.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CNI_MTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s,bgp\"\n            - name: IP\n              value: \"autodetect\"\n            - name: CALICO_IPV4POOL_IPIP\n              value: \"Always\"\n            - name: FELIX_IPINIPMTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"@@{KUBE_CLUSTER_SUBNET}@@\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            exec:\n              command:\n              - \/bin\/calico-node\n              - -bird-ready\n              - -felix-ready\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPPeer\n    plural: bgppeers\n    singular: bgppeer\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/calico\/calico.yml\nkubectl create -f \/etc\/kubernetes\/addons\/calico\/calico.yml  \n\nelse\n  echo \"Defaulting to flannel\"\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n  - kind: ServiceAccount\n    name: flannel\n    namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"hairpinMode\": true,\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - \/opt\/bin\/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n          limits:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/bin\/sh\", \"-c\", \"set -e -x; cp -f \/etc\/kube-flannel\/cni-conf.json \/etc\/cni\/net.d\/10-flannel.conf; while true; do sleep 3600; done\" ]\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nfi\n\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"987bc3c7-2a2c-4592-bd68-fc6431d2898d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n  - name: dns\n    port: 53\n    protocol: UDP\n  - name: dns-tcp\n    port: 53\n    protocol: TCP\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: k8s.gcr.io\/k8s-dns-kube-dns:1.14.13\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: k8s.gcr.io\/k8s-dns-dnsmasq-nanny:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --no-negcache\n        - --dns-loop-detect\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: k8s.gcr.io\/k8s-dns-sidecar:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local,5,SRV\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local,5,SRV\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy: Default\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.2.0\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          - --target=Deployment\/kube-dns\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"31eb5b6b-5c67-48c0-9a56-00b7277a19c4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nsudo mkdir \"\/etc\/kubernetes\/addons\/volume\"\n\necho 'apiVersion: storage.k8s.io\/v1\nkind: StorageClass\nmetadata:\n  name: standard\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: EnsureExists\nprovisioner: kubernetes.io\/gce-pd\nparameters:\n  type: pd-standard' | sudo tee \/etc\/kubernetes\/addons\/volume\/default.yaml\n \nkubectl create -f \/etc\/kubernetes\/addons\/volume\/default.yaml "},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GCE VolumePlugin"}],"description":"","message_list":[],"uuid":"157634a8-f391-47c0-98bb-3a0647057d1b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"e07e43b0_dag","uuid":"5d4b721d-3fd2-4fff-9f01-e389a6276b61"},"name":"26c82c77_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"},"retries":"0","description":"","type":"DAG","uuid":"6b789466-f815-4bc0-a283-e1312f9d3c3d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6bbde6e8_dag"}],"description":"","message_list":[],"uuid":"176acdaa-f7d6-4e53-9387-6d5cf06af409","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6bbde6e8_dag","uuid":"6b789466-f815-4bc0-a283-e1312f9d3c3d"},"name":"6eaeef4c_runbook"}},"variable_list":[],"name":"GCP_Centos_K8SM_Package"},{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"9263b9b0-a622-4250-8c6a-deae7b6ddce1","name":"action_install","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"},"retries":"0","description":"","type":"DAG","uuid":"e1c91b3b-f5a9-4cf2-bf85-f417778cf983","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Install_Crb_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"391150b7-4527-485e-948a-ec61d18d9bfe"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_INSTALL","uuid":"391150b7-4527-485e-948a-ec61d18d9bfe","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"},"retries":"0","description":"","type":"DAG","uuid":"828f838c-097d-45f3-a3e5-8520f50d545b","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"b1c78264-62cd-4a54-b4e2-7b6304dd7a52"},{"kind":"app_task","name":"Docker Kubelet Install","uuid":"08cabc37-3932-4742-b73e-ed1a59080736"},{"kind":"app_task","name":"GetCerts","uuid":"d74356af-8e3f-4e28-a257-98fd3d83fd18"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"b1c78264-62cd-4a54-b4e2-7b6304dd7a52"},"edge_type":"user_defined","type":"","uuid":"360d0984-ea28-4735-9844-52198ccbc247","to_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"08cabc37-3932-4742-b73e-ed1a59080736"}},{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"08cabc37-3932-4742-b73e-ed1a59080736"},"edge_type":"user_defined","type":"","uuid":"39614adb-74d1-4814-a16d-69dcceba6c1c","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"d74356af-8e3f-4e28-a257-98fd3d83fd18"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"709f9264_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"b1c78264-62cd-4a54-b4e2-7b6304dd7a52","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"08cabc37-3932-4742-b73e-ed1a59080736","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{GCP_Centos_K8SM.private_ip_address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\n\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=gce \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"d74356af-8e3f-4e28-a257-98fd3d83fd18","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{GCP_Centos_K8SM.private_ip_address[0]}@@\"\nINSTANCE_IP=\"@@{private_ip_address}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; if [[ $count -eq 600 ]]; then echo \"failed to download certs\" && exit 1; fi; count=$(($count+5)) ; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"worker@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${HOSTNAME}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${HOSTNAME},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${HOSTNAME} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${HOSTNAME} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"b66a864e-fe6a-4a0c-ab6b-a6871fa37e09","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"709f9264_dag","uuid":"828f838c-097d-45f3-a3e5-8520f50d545b"},"name":"927472a7_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"},"retries":"0","description":"","type":"DAG","uuid":"99d854d9-c1b5-4c20-a0a6-269d00f91213","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"6e2d5148-258e-4415-a37d-0c3e228725a2"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"fef85962_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"6e2d5148-258e-4415-a37d-0c3e228725a2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nNODE_NAME=${HOSTNAME}\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain '${NODE_NAME}' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node '${NODE_NAME}'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"7ff9b6f9-15ee-4acc-9640-de3153dd7c3b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"fef85962_dag","uuid":"99d854d9-c1b5-4c20-a0a6-269d00f91213"},"name":"435393f9_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Install_Crb_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a"}],"description":"","message_list":[],"uuid":"c44cbeaa-7ac9-414b-9e51-9c8a4af2f9b1","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"e1c91b3b-f5a9-4cf2-bf85-f417778cf983"},"name":"SYS_GEN__Runbook_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a"}},{"description":"System action for creating an application","message_list":[],"uuid":"47230608-b13c-4f91-97b8-8fb49fc0a86e","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"},"retries":"0","description":"","type":"DAG","uuid":"e04cda62-0579-4bab-a58a-c94563747b20","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"c00f9185-c3b9-4b57-b158-48bc2da7d8cd"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"cf6dbb32-6fba-40b4-beb1-228ee4075def"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"6bfd7d4d-f596-4c87-b5a3-8dba59f1fc0f"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"cf6dbb32-6fba-40b4-beb1-228ee4075def"},"edge_type":"inherent","type":"","uuid":"b0838159-b7b8-44d7-9b26-c352c7f618d4","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"6bfd7d4d-f596-4c87-b5a3-8dba59f1fc0f"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"c00f9185-c3b9-4b57-b158-48bc2da7d8cd"},"edge_type":"inherent","type":"","uuid":"fbf100e2-e02c-4ba3-8dee-e1699425cfac","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"cf6dbb32-6fba-40b4-beb1-228ee4075def"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c00f9185-c3b9-4b57-b158-48bc2da7d8cd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"c44cbeaa-7ac9-414b-9e51-9c8a4af2f9b1"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"cf6dbb32-6fba-40b4-beb1-228ee4075def","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"cca906a5-5e79-422e-b15f-7391a907ad07"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6bfd7d4d-f596-4c87-b5a3-8dba59f1fc0f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"4289d3e2-b3c7-4628-ac87-f36ff669be62","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"e04cda62-0579-4bab-a58a-c94563747b20"},"name":"SYS_GEN__Runbook_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a"}},{"description":"System action for uninstalling an application","message_list":[],"uuid":"dc3ffdeb-752d-40f3-aaaa-7a36481bbc13","name":"action_uninstall","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"},"retries":"0","description":"","type":"DAG","uuid":"62bd01db-25df-4851-89e2-a241bca91390","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Uninstall_Crb_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"c223fa47-4c2c-4002-81b8-2680229e86b8"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_UNINSTALL","uuid":"c223fa47-4c2c-4002-81b8-2680229e86b8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"},"retries":"0","description":"","type":"DAG","uuid":"828f838c-097d-45f3-a3e5-8520f50d545b","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"b1c78264-62cd-4a54-b4e2-7b6304dd7a52"},{"kind":"app_task","name":"Docker Kubelet Install","uuid":"08cabc37-3932-4742-b73e-ed1a59080736"},{"kind":"app_task","name":"GetCerts","uuid":"d74356af-8e3f-4e28-a257-98fd3d83fd18"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"b1c78264-62cd-4a54-b4e2-7b6304dd7a52"},"edge_type":"user_defined","type":"","uuid":"360d0984-ea28-4735-9844-52198ccbc247","to_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"08cabc37-3932-4742-b73e-ed1a59080736"}},{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"08cabc37-3932-4742-b73e-ed1a59080736"},"edge_type":"user_defined","type":"","uuid":"39614adb-74d1-4814-a16d-69dcceba6c1c","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"d74356af-8e3f-4e28-a257-98fd3d83fd18"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"709f9264_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"b1c78264-62cd-4a54-b4e2-7b6304dd7a52","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"08cabc37-3932-4742-b73e-ed1a59080736","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{GCP_Centos_K8SM.private_ip_address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\n\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=gce \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"d74356af-8e3f-4e28-a257-98fd3d83fd18","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{GCP_Centos_K8SM.private_ip_address[0]}@@\"\nINSTANCE_IP=\"@@{private_ip_address}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; if [[ $count -eq 600 ]]; then echo \"failed to download certs\" && exit 1; fi; count=$(($count+5)) ; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"worker@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${HOSTNAME}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${HOSTNAME},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${HOSTNAME} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${HOSTNAME} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"b66a864e-fe6a-4a0c-ab6b-a6871fa37e09","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"709f9264_dag","uuid":"828f838c-097d-45f3-a3e5-8520f50d545b"},"name":"927472a7_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"},"retries":"0","description":"","type":"DAG","uuid":"99d854d9-c1b5-4c20-a0a6-269d00f91213","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"6e2d5148-258e-4415-a37d-0c3e228725a2"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"fef85962_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"6e2d5148-258e-4415-a37d-0c3e228725a2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nNODE_NAME=${HOSTNAME}\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain '${NODE_NAME}' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node '${NODE_NAME}'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"7ff9b6f9-15ee-4acc-9640-de3153dd7c3b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"fef85962_dag","uuid":"99d854d9-c1b5-4c20-a0a6-269d00f91213"},"name":"435393f9_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Uninstall_Crb_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a"}],"description":"","message_list":[],"uuid":"de38f3ce-27a5-466d-91be-6037e2a4c86e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"62bd01db-25df-4851-89e2-a241bca91390"},"name":"SYS_GEN__Runbook_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"afede7d9-29a0-4ffc-8536-98f60f804a7b","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"},"retries":"0","description":"","type":"DAG","uuid":"96f7cb10-9d8f-4e56-add0-846f6dca96e8","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"950c2c4a-29ba-448e-afb1-1c2fa1a85ad3"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"e72cddf6-cc67-4371-8a9d-bbde5bd33efe"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"97566fb3-7e4f-4fc1-827b-8eaf41a22d32"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"950c2c4a-29ba-448e-afb1-1c2fa1a85ad3"},"edge_type":"inherent","type":"","uuid":"71d26ea1-8802-4b7f-995e-843adfa246eb","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"e72cddf6-cc67-4371-8a9d-bbde5bd33efe"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"e72cddf6-cc67-4371-8a9d-bbde5bd33efe"},"edge_type":"inherent","type":"","uuid":"45eabad8-d7d5-4af3-af37-8c5c0eb50127","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"97566fb3-7e4f-4fc1-827b-8eaf41a22d32"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"950c2c4a-29ba-448e-afb1-1c2fa1a85ad3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e72cddf6-cc67-4371-8a9d-bbde5bd33efe","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"843ab0a6-03bd-4b9c-8f56-7d852e9348e0"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"97566fb3-7e4f-4fc1-827b-8eaf41a22d32","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"de38f3ce-27a5-466d-91be-6037e2a4c86e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a"}],"description":"","message_list":[],"uuid":"987539f8-2a24-4ad8-85ce-faa0b4ce72f9","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"96f7cb10-9d8f-4e56-add0-846f6dca96e8"},"name":"SYS_GEN__Runbook_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"c279ee34-1bb5-476f-8eda-f5a8920e1d7a","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"},"retries":"0","description":"","type":"DAG","uuid":"2a4adbe9-ec66-46ad-9ed1-fed7886402d1","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"4bfd7e22-7d8f-422c-8d7f-9d5485e358cd"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"425b890e-1c3f-41e4-a3de-e4d0b1b5f057"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"4bfd7e22-7d8f-422c-8d7f-9d5485e358cd"},"edge_type":"inherent","type":"","uuid":"3b994ad7-1302-4e4f-93d7-09c1407d1d25","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"425b890e-1c3f-41e4-a3de-e4d0b1b5f057"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4bfd7e22-7d8f-422c-8d7f-9d5485e358cd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"716ea7a7-bc0c-4ac5-ab9c-720c327a498e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"425b890e-1c3f-41e4-a3de-e4d0b1b5f057","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a"}],"description":"","message_list":[],"uuid":"5a30738d-5405-4fdf-a12d-54e641329503","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"2a4adbe9-ec66-46ad-9ed1-fed7886402d1"},"name":"SYS_GEN__Runbook_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a"}},{"description":"System action for starting an application","message_list":[],"uuid":"7d69ea0a-3a4a-4945-abcb-197b96c1114c","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"},"retries":"0","description":"","type":"DAG","uuid":"d78d49e0-ee61-4e09-8ecd-ca307459ad40","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"fed4100c-0c61-44e5-8e51-101cbdfbf919"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"fed4100c-0c61-44e5-8e51-101cbdfbf919","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"cec92e21-21bd-4b4e-8d7d-2a6a8a14fe53","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"d78d49e0-ee61-4e09-8ecd-ca307459ad40"},"name":"SYS_GEN__Runbook_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a"}},{"description":"System action for restarting an application","message_list":[],"uuid":"a3513afe-9331-4aa5-a643-a83ee7adf5fe","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"},"retries":"0","description":"","type":"DAG","uuid":"fe8e4bdf-4335-439b-9ae6-b1dd6449adeb","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"5186bae7-c969-4885-9380-000eeb4ca319"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5186bae7-c969-4885-9380-000eeb4ca319","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"ce602c49-d9cd-44d7-8e10-5671dc407b8b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"a1677a87-8e53-4fb2-a8a0-7569058fe5cc","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"fe8e4bdf-4335-439b-9ae6-b1dd6449adeb"},"name":"SYS_GEN__Runbook_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a"}},{"description":"System action for stopping an application","message_list":[],"uuid":"ca73397c-466d-47cb-a0b8-49065f41a7ae","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"},"retries":"0","description":"","type":"DAG","uuid":"e17ac6df-fa67-4132-b312-c1e5fa2ae109","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"1009d2a4-2024-4478-ae81-f993dc6a009c"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1009d2a4-2024-4478-ae81-f993dc6a009c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"8f095264-70d4-4b0b-ab5b-0ca8739c0d66","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a","uuid":"e17ac6df-fa67-4132-b312-c1e5fa2ae109"},"name":"SYS_GEN__Runbook_Package_5c74eb52_ea4c_4c67_bc85_5bcbff0fc85a"}}],"message_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"}],"uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a","state":"ACTIVE","version":"","editables":{},"type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"},"retries":"0","description":"","type":"DAG","uuid":"828f838c-097d-45f3-a3e5-8520f50d545b","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"b1c78264-62cd-4a54-b4e2-7b6304dd7a52"},{"kind":"app_task","name":"Docker Kubelet Install","uuid":"08cabc37-3932-4742-b73e-ed1a59080736"},{"kind":"app_task","name":"GetCerts","uuid":"d74356af-8e3f-4e28-a257-98fd3d83fd18"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"b1c78264-62cd-4a54-b4e2-7b6304dd7a52"},"edge_type":"user_defined","type":"","uuid":"360d0984-ea28-4735-9844-52198ccbc247","to_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"08cabc37-3932-4742-b73e-ed1a59080736"}},{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"08cabc37-3932-4742-b73e-ed1a59080736"},"edge_type":"user_defined","type":"","uuid":"39614adb-74d1-4814-a16d-69dcceba6c1c","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"d74356af-8e3f-4e28-a257-98fd3d83fd18"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"709f9264_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"b1c78264-62cd-4a54-b4e2-7b6304dd7a52","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"08cabc37-3932-4742-b73e-ed1a59080736","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{GCP_Centos_K8SM.private_ip_address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\n\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=gce \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"d74356af-8e3f-4e28-a257-98fd3d83fd18","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{GCP_Centos_K8SM.private_ip_address[0]}@@\"\nINSTANCE_IP=\"@@{private_ip_address}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; if [[ $count -eq 600 ]]; then echo \"failed to download certs\" && exit 1; fi; count=$(($count+5)) ; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"worker@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${HOSTNAME}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${HOSTNAME},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${HOSTNAME} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${HOSTNAME} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"b66a864e-fe6a-4a0c-ab6b-a6871fa37e09","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"709f9264_dag","uuid":"828f838c-097d-45f3-a3e5-8520f50d545b"},"name":"927472a7_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"},"retries":"0","description":"","type":"DAG","uuid":"99d854d9-c1b5-4c20-a0a6-269d00f91213","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"6e2d5148-258e-4415-a37d-0c3e228725a2"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"fef85962_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"6e2d5148-258e-4415-a37d-0c3e228725a2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nNODE_NAME=${HOSTNAME}\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain '${NODE_NAME}' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node '${NODE_NAME}'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"7ff9b6f9-15ee-4acc-9640-de3153dd7c3b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"fef85962_dag","uuid":"99d854d9-c1b5-4c20-a0a6-269d00f91213"},"name":"435393f9_runbook"}},"variable_list":[],"name":"GCP_Centos_K8SW_Package"},{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"6f607f4c-9735-474c-8615-8571e0df12df","name":"action_install","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_CENTOS_76","uuid":"691d60b5-9272-4cb0-a4b4-4e8dc6f75277"},"retries":"0","description":"","type":"DAG","uuid":"ac334b5c-98ed-4a65-aec1-942793611dfb","child_tasks_local_reference_list":[{"kind":"app_task","name":"Image Fetch task for VM","uuid":"48de1cb1-ab29-434b-889e-d57d19059beb"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_CENTOS_76","uuid":"691d60b5-9272-4cb0-a4b4-4e8dc6f75277"},"retries":"0","description":"","type":"SUBSTRATE_IMAGE_FETCH","uuid":"48de1cb1-ab29-434b-889e-d57d19059beb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"","name":"CENTOS_76","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-1810.qcow2","version":{"product_version":"","type":"","product_name":""},"architecture":"X86_64","type":""},"description":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Image Fetch task for VM"}],"description":"","message_list":[],"uuid":"9b6af2e4-9bb9-4d7d-9d74-2c7c244373a1","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277","uuid":"ac334b5c-98ed-4a65-aec1-942793611dfb"},"name":"SYS_GEN__Runbook_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277"}},{"description":"System action for creating an application","message_list":[],"uuid":"fdaad466-f314-4379-88f3-37188625aca3","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_CENTOS_76","uuid":"691d60b5-9272-4cb0-a4b4-4e8dc6f75277"},"retries":"0","description":"","type":"DAG","uuid":"6b97cf75-60cd-4f7b-b702-c4ace8eca320","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277","uuid":"65cab73c-3639-4fc0-9294-e8a1342be888"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_CENTOS_76","uuid":"691d60b5-9272-4cb0-a4b4-4e8dc6f75277"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"65cab73c-3639-4fc0-9294-e8a1342be888","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277","uuid":"9b6af2e4-9bb9-4d7d-9d74-2c7c244373a1"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277"}],"description":"","message_list":[],"uuid":"c69822bd-adb9-4199-9053-784ae152c580","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277","uuid":"6b97cf75-60cd-4f7b-b702-c4ace8eca320"},"name":"SYS_GEN__Runbook_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277"}},{"description":"System action for starting an application","message_list":[],"uuid":"3c2e0322-a132-4971-90ee-43f0e89338d4","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_CENTOS_76","uuid":"691d60b5-9272-4cb0-a4b4-4e8dc6f75277"},"retries":"0","description":"","type":"DAG","uuid":"00ef97b7-7582-4a8b-9946-f792090df505","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277"}],"description":"","message_list":[],"uuid":"ec6f6633-0c8c-426f-af0b-ffb010682f29","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277","uuid":"00ef97b7-7582-4a8b-9946-f792090df505"},"name":"SYS_GEN__Runbook_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277"}},{"description":"System action for restarting an application","message_list":[],"uuid":"7b032d51-f1ab-4338-aea9-fcba4f57c3ac","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_CENTOS_76","uuid":"691d60b5-9272-4cb0-a4b4-4e8dc6f75277"},"retries":"0","description":"","type":"DAG","uuid":"60c3a597-816a-4ad9-816e-0fc8f20d8dee","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277"}],"description":"","message_list":[],"uuid":"aaa21157-8a3b-4977-b156-90a94bdbc92c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277","uuid":"60c3a597-816a-4ad9-816e-0fc8f20d8dee"},"name":"SYS_GEN__Runbook_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277"}},{"description":"System action for stopping an application","message_list":[],"uuid":"dbf4f521-3de1-4abc-b60d-fc89129dc5b7","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_CENTOS_76","uuid":"691d60b5-9272-4cb0-a4b4-4e8dc6f75277"},"retries":"0","description":"","type":"DAG","uuid":"85d4547e-ff79-4d47-86f9-570cbe4bddeb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277"}],"description":"","message_list":[],"uuid":"9f5fd9c6-f32f-4613-aa94-b8a759581b6e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277","uuid":"85d4547e-ff79-4d47-86f9-570cbe4bddeb"},"name":"SYS_GEN__Runbook_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"8de43a51-f8cd-4e5d-8447-391c2011387e","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_CENTOS_76","uuid":"691d60b5-9272-4cb0-a4b4-4e8dc6f75277"},"retries":"0","description":"","type":"DAG","uuid":"3822edd8-b6f7-4985-b833-5adc1064f7ab","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277"}],"description":"","message_list":[],"uuid":"9e901ab2-e589-4af0-8743-bbe101d98cae","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277","uuid":"3822edd8-b6f7-4985-b833-5adc1064f7ab"},"name":"SYS_GEN__Runbook_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"aa2982a7-3643-4b19-8ca9-b2e0d731d8cf","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_CENTOS_76","uuid":"691d60b5-9272-4cb0-a4b4-4e8dc6f75277"},"retries":"0","description":"","type":"DAG","uuid":"db523294-31b6-459a-87f0-61f0ab12e9ea","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277"}],"description":"","message_list":[],"uuid":"98c49b68-9cb5-453e-8f57-628c9e5bbbd7","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277","uuid":"db523294-31b6-459a-87f0-61f0ab12e9ea"},"name":"SYS_GEN__Runbook_Package_691d60b5_9272_4cb0_a4b4_4e8dc6f75277"}}],"message_list":[],"service_local_reference_list":[],"uuid":"691d60b5-9272-4cb0-a4b4-4e8dc6f75277","state":"ACTIVE","version":"","editables":{},"type":"SUBSTRATE_IMAGE","options":{"type":"","name":"CENTOS_76","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-1810.qcow2","version":{"product_version":"","type":"","product_name":""},"architecture":"X86_64","type":""},"description":""},"variable_list":[],"name":"AHV_CENTOS_76"},{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"e75aca04-cc37-4d7b-9b9b-0e80bb7878a5","name":"action_install","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"},"retries":"0","description":"","type":"DAG","uuid":"ef0a19c5-79b9-406e-9c6e-f6d7c9223ee0","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Install_Crb_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"05101311-aae2-4478-9c9f-99972b7489e2"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_INSTALL","uuid":"05101311-aae2-4478-9c9f-99972b7489e2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"},"retries":"0","description":"","type":"DAG","uuid":"026f2463-8259-48c4-a015-962ec6ee3c69","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubenetes Version","uuid":"a58ad377-dfbf-4a4b-9cdf-2222d2e78f80"},{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"854219fc-578b-4a46-bc86-f5b1dec3fc6f"},{"kind":"app_task","name":"Generate Certs","uuid":"7af0fa88-eec7-4152-bb5c-768f203e21cb"},{"kind":"app_task","name":"Configure Services","uuid":"2ed591c5-8534-4c09-8dca-ddd4a1aec422"},{"kind":"app_task","name":"Add User Roles","uuid":"7bb62d31-6da2-499e-bab8-6f4dfabff5aa"},{"kind":"app_task","name":"Network Configuration","uuid":"9abf1be0-de41-4b10-8833-8677647a0dd4"},{"kind":"app_task","name":"DNS Configuration","uuid":"5cc056c8-cd5a-4fa1-9013-46e423a85b50"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubenetes Version","uuid":"a58ad377-dfbf-4a4b-9cdf-2222d2e78f80"},"edge_type":"user_defined","type":"","uuid":"84c67d99-e587-4045-9b4a-8d1d64e11f2f","to_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"854219fc-578b-4a46-bc86-f5b1dec3fc6f"}},{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"854219fc-578b-4a46-bc86-f5b1dec3fc6f"},"edge_type":"user_defined","type":"","uuid":"abc2a0aa-e191-45b6-820e-e0f3538abf20","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"7af0fa88-eec7-4152-bb5c-768f203e21cb"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"7af0fa88-eec7-4152-bb5c-768f203e21cb"},"edge_type":"user_defined","type":"","uuid":"1c202d0e-aed1-41fb-8042-f1b6ab9aff87","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"2ed591c5-8534-4c09-8dca-ddd4a1aec422"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"2ed591c5-8534-4c09-8dca-ddd4a1aec422"},"edge_type":"user_defined","type":"","uuid":"22b08f81-dcc4-4593-83fc-817e1bbf4c9c","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"7bb62d31-6da2-499e-bab8-6f4dfabff5aa"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"7bb62d31-6da2-499e-bab8-6f4dfabff5aa"},"edge_type":"user_defined","type":"","uuid":"09095f87-8136-4300-af6a-8359190e98c4","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"9abf1be0-de41-4b10-8833-8677647a0dd4"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"9abf1be0-de41-4b10-8833-8677647a0dd4"},"edge_type":"user_defined","type":"","uuid":"220a64fd-6fba-4c2b-b0d8-46d76c661023","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"5cc056c8-cd5a-4fa1-9013-46e423a85b50"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"e07e43b0_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"a58ad377-dfbf-4a4b-9cdf-2222d2e78f80","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubenetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"854219fc-578b-4a46-bc86-f5b1dec3fc6f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo yum install -y python-setuptools --quiet\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.3.12\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nWORKER_IPS=\"@@{Azure_Centos_K8SW.private_ip_address}@@\" # private Ip's\nPUBLIC_MASTER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_WORKER_IPS=\"@@{Azure_Centos_K8SW.public_ip_address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} master${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"master${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  count=$((count+1))\ndone \n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"7af0fa88-eec7-4152-bb5c-768f203e21cb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\ndeclare -a INSTANCE_IPS\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nWORKER_IPS=\"@@{Azure_Centos_K8SW.private_ip_address}@@\" # private Ip's\nPUBLIC_MASTER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_WORKER_IPS=\"@@{Azure_Centos_K8SM.public_ip_address}@@\"\nINSTANCE_IPS=($(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"))\nMASTER_HOSTNAMES=\"@@{calm_array_name}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"master${count}\",\n  count=$((count+1))\ndone\nMASTER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"worker${count}\",\n  count=$((count+1))\ndone\nWORKER_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${PUBLIC_MASTER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${PUBLIC_MASTER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${PUBLIC_MASTER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json \\\n-hostname=${MASTER_NAMES},${MASTER_IPS},${WORKER_NAMES},${WORKER_IPS},${FIRST_IP_SERVICE_SUBNET},${PUBLIC_MASTER_IPS},${PUBLIC_WORKER_IPS},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local \\\n-profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor name in $(echo ${MASTER_NAMES} | tr \",\" \"\\n\"); do\ninstance=\"master${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${name}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_IPS[$count]} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor name in $(echo ${MASTER_NAMES} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=master${count}.kubeconfig\nkubectl config set-credentials system:node:${name} --client-certificate=master${count}.pem --client-key=master${count}-key.pem --embed-certs=true --kubeconfig=master${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${name} --kubeconfig=master${count}.kubeconfig\nkubectl config use-context default --kubeconfig=master${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"master${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"2ed591c5-8534-4c09-8dca-ddd4a1aec422","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nMASTER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${NODE_NAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${MASTER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=${KUBE_CLUSTER_NAME}\n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n\necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"7bb62d31-6da2-499e-bab8-6f4dfabff5aa","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet\nsudo systemctl enable etcd docker kubelet\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem master* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\n\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF\n\ncat <<EOF | kubectl apply -f -\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: kube-aws:node-proxier\nsubjects:\n  - kind: User\n    name: kube-worker\n  - kind: ServiceAccount\n    name: kube-proxy\n    namespace: kube-system\n  - kind: Group\n    name: system:nodes\nroleRef:\n  kind: ClusterRole\n  name: system:node-proxier\n  apiGroup: rbac.authorization.k8s.io\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"9abf1be0-de41-4b10-8833-8677647a0dd4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ]]; then\nsudo mkdir -p \/etc\/kubernetes\/addons\/canal\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: canal-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  canal_iface: \"\"\n\n  masquerade: \"true\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: canal\n  namespace: kube-system\n  labels:\n    k8s-app: canal\nspec:\n  selector:\n    matchLabels:\n      k8s-app: canal\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: canal\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: canal\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-canal.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              value: \"none\"\n            - name: CLUSTER_TYPE\n              value: \"k8s,canal\"\n            - name: FELIX_IPTABLESREFRESHINTERVAL\n              value: \"60\"\n            - name: IP\n              value: \"\"\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"192.168.0.0\/16\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: \/readiness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n        - name: kube-flannel\n          image: quay.io\/coreos\/flannel:v0.9.1\n          command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n          securityContext:\n            privileged: true\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: FLANNELD_IFACE\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: canal_iface\n            - name: FLANNELD_IP_MASQ\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: masquerade\n          volumeMounts:\n          - mountPath: \/run\/xtables.lock\n            name: xtables-lock\n            readOnly: false\n          - name: flannel-cfg\n            mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: flannel-cfg\n          configMap:\n            name: canal-config\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: canal\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: canal-flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: canal-calico\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/canal\/canal.yml\nkubectl create -f \/etc\/kubernetes\/addons\/canal\/canal.yml\n\nelif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]];then\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/calico\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  calico_backend: \"bird\"\n\n  veth_mtu: \"1440\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: calico-node\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-calico.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CNI_MTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s,bgp\"\n            - name: IP\n              value: \"autodetect\"\n            - name: CALICO_IPV4POOL_IPIP\n              value: \"Always\"\n            - name: FELIX_IPINIPMTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"@@{KUBE_CLUSTER_SUBNET}@@\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            exec:\n              command:\n              - \/bin\/calico-node\n              - -bird-ready\n              - -felix-ready\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPPeer\n    plural: bgppeers\n    singular: bgppeer\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/calico\/calico.yml\nkubectl create -f \/etc\/kubernetes\/addons\/calico\/calico.yml  \n\nelse\n  echo \"Defaulting to flannel\"\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n  - kind: ServiceAccount\n    name: flannel\n    namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"hairpinMode\": true,\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - \/opt\/bin\/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n          limits:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/bin\/sh\", \"-c\", \"set -e -x; cp -f \/etc\/kube-flannel\/cni-conf.json \/etc\/cni\/net.d\/10-flannel.conf; while true; do sleep 3600; done\" ]\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nfi\n\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"5cc056c8-cd5a-4fa1-9013-46e423a85b50","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n  - name: dns\n    port: 53\n    protocol: UDP\n  - name: dns-tcp\n    port: 53\n    protocol: TCP\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: k8s.gcr.io\/k8s-dns-kube-dns:1.14.13\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: k8s.gcr.io\/k8s-dns-dnsmasq-nanny:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --no-negcache\n        - --dns-loop-detect\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: k8s.gcr.io\/k8s-dns-sidecar:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local,5,SRV\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local,5,SRV\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy: Default\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.2.0\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          - --target=Deployment\/kube-dns\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"}],"description":"","message_list":[],"uuid":"eb446d01-8c07-4895-b70a-69c1861525bf","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"e07e43b0_dag","uuid":"026f2463-8259-48c4-a015-962ec6ee3c69"},"name":"26c82c77_runbook_cloned_1"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"},"retries":"0","description":"","type":"DAG","uuid":"0430de1c-4a60-4831-a140-7a42fa1e1204","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6bbde6e8_dag"}],"description":"","message_list":[],"uuid":"1ba020b7-35b3-415f-8a9f-9ea1d90e488b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6bbde6e8_dag","uuid":"0430de1c-4a60-4831-a140-7a42fa1e1204"},"name":"6eaeef4c_runbook_cloned_1"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Install_Crb_8f379386_82c8_4851_84aa_e97b83c8b8a7"}],"description":"","message_list":[],"uuid":"de04cc30-89ea-4f23-b11f-4542e75deba1","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"ef0a19c5-79b9-406e-9c6e-f6d7c9223ee0"},"name":"SYS_GEN__Runbook_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7"}},{"description":"System action for creating an application","message_list":[],"uuid":"c2947103-6a64-4e2f-9c10-e9761849fc3c","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"},"retries":"0","description":"","type":"DAG","uuid":"763af9eb-9557-411c-9ef5-c818e7174575","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"62f0d641-a22e-4fc3-9f31-a689d15dddc5"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"21f25291-e05a-488e-b534-0ead1b21de95"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"8d595076-306f-43cc-96a4-e271f01181aa"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"21f25291-e05a-488e-b534-0ead1b21de95"},"edge_type":"inherent","type":"","uuid":"e50570e5-3e23-4908-ba5d-7262ca8f24c6","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"8d595076-306f-43cc-96a4-e271f01181aa"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"62f0d641-a22e-4fc3-9f31-a689d15dddc5"},"edge_type":"inherent","type":"","uuid":"4453cff3-ff74-4bd7-b3fb-cdd280355c09","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"21f25291-e05a-488e-b534-0ead1b21de95"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"62f0d641-a22e-4fc3-9f31-a689d15dddc5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"de04cc30-89ea-4f23-b11f-4542e75deba1"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"21f25291-e05a-488e-b534-0ead1b21de95","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"384cf3d8-e940-43f1-a289-6c6b363c5371"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8d595076-306f-43cc-96a4-e271f01181aa","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"d3c90a24-bf4f-4681-abd0-9205ae78cfc2","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"763af9eb-9557-411c-9ef5-c818e7174575"},"name":"SYS_GEN__Runbook_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7"}},{"description":"System action for uninstalling an application","message_list":[],"uuid":"5e3de021-1b92-4d10-a86f-4ca5e280b724","name":"action_uninstall","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"},"retries":"0","description":"","type":"DAG","uuid":"bc6fec02-06b2-4103-aeb8-c75647601388","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Uninstall_Crb_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"b328f4fa-d36b-4312-93f6-66a45c1dd190"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_UNINSTALL","uuid":"b328f4fa-d36b-4312-93f6-66a45c1dd190","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"},"retries":"0","description":"","type":"DAG","uuid":"026f2463-8259-48c4-a015-962ec6ee3c69","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubenetes Version","uuid":"a58ad377-dfbf-4a4b-9cdf-2222d2e78f80"},{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"854219fc-578b-4a46-bc86-f5b1dec3fc6f"},{"kind":"app_task","name":"Generate Certs","uuid":"7af0fa88-eec7-4152-bb5c-768f203e21cb"},{"kind":"app_task","name":"Configure Services","uuid":"2ed591c5-8534-4c09-8dca-ddd4a1aec422"},{"kind":"app_task","name":"Add User Roles","uuid":"7bb62d31-6da2-499e-bab8-6f4dfabff5aa"},{"kind":"app_task","name":"Network Configuration","uuid":"9abf1be0-de41-4b10-8833-8677647a0dd4"},{"kind":"app_task","name":"DNS Configuration","uuid":"5cc056c8-cd5a-4fa1-9013-46e423a85b50"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubenetes Version","uuid":"a58ad377-dfbf-4a4b-9cdf-2222d2e78f80"},"edge_type":"user_defined","type":"","uuid":"84c67d99-e587-4045-9b4a-8d1d64e11f2f","to_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"854219fc-578b-4a46-bc86-f5b1dec3fc6f"}},{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"854219fc-578b-4a46-bc86-f5b1dec3fc6f"},"edge_type":"user_defined","type":"","uuid":"abc2a0aa-e191-45b6-820e-e0f3538abf20","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"7af0fa88-eec7-4152-bb5c-768f203e21cb"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"7af0fa88-eec7-4152-bb5c-768f203e21cb"},"edge_type":"user_defined","type":"","uuid":"1c202d0e-aed1-41fb-8042-f1b6ab9aff87","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"2ed591c5-8534-4c09-8dca-ddd4a1aec422"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"2ed591c5-8534-4c09-8dca-ddd4a1aec422"},"edge_type":"user_defined","type":"","uuid":"22b08f81-dcc4-4593-83fc-817e1bbf4c9c","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"7bb62d31-6da2-499e-bab8-6f4dfabff5aa"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"7bb62d31-6da2-499e-bab8-6f4dfabff5aa"},"edge_type":"user_defined","type":"","uuid":"09095f87-8136-4300-af6a-8359190e98c4","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"9abf1be0-de41-4b10-8833-8677647a0dd4"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"9abf1be0-de41-4b10-8833-8677647a0dd4"},"edge_type":"user_defined","type":"","uuid":"220a64fd-6fba-4c2b-b0d8-46d76c661023","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"5cc056c8-cd5a-4fa1-9013-46e423a85b50"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"e07e43b0_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"a58ad377-dfbf-4a4b-9cdf-2222d2e78f80","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubenetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"854219fc-578b-4a46-bc86-f5b1dec3fc6f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo yum install -y python-setuptools --quiet\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.3.12\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nWORKER_IPS=\"@@{Azure_Centos_K8SW.private_ip_address}@@\" # private Ip's\nPUBLIC_MASTER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_WORKER_IPS=\"@@{Azure_Centos_K8SW.public_ip_address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} master${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"master${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  count=$((count+1))\ndone \n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"7af0fa88-eec7-4152-bb5c-768f203e21cb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\ndeclare -a INSTANCE_IPS\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nWORKER_IPS=\"@@{Azure_Centos_K8SW.private_ip_address}@@\" # private Ip's\nPUBLIC_MASTER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_WORKER_IPS=\"@@{Azure_Centos_K8SM.public_ip_address}@@\"\nINSTANCE_IPS=($(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"))\nMASTER_HOSTNAMES=\"@@{calm_array_name}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"master${count}\",\n  count=$((count+1))\ndone\nMASTER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"worker${count}\",\n  count=$((count+1))\ndone\nWORKER_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${PUBLIC_MASTER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${PUBLIC_MASTER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${PUBLIC_MASTER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json \\\n-hostname=${MASTER_NAMES},${MASTER_IPS},${WORKER_NAMES},${WORKER_IPS},${FIRST_IP_SERVICE_SUBNET},${PUBLIC_MASTER_IPS},${PUBLIC_WORKER_IPS},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local \\\n-profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor name in $(echo ${MASTER_NAMES} | tr \",\" \"\\n\"); do\ninstance=\"master${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${name}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_IPS[$count]} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor name in $(echo ${MASTER_NAMES} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=master${count}.kubeconfig\nkubectl config set-credentials system:node:${name} --client-certificate=master${count}.pem --client-key=master${count}-key.pem --embed-certs=true --kubeconfig=master${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${name} --kubeconfig=master${count}.kubeconfig\nkubectl config use-context default --kubeconfig=master${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"master${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"2ed591c5-8534-4c09-8dca-ddd4a1aec422","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nMASTER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${NODE_NAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${MASTER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=${KUBE_CLUSTER_NAME}\n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n\necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"7bb62d31-6da2-499e-bab8-6f4dfabff5aa","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet\nsudo systemctl enable etcd docker kubelet\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem master* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\n\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF\n\ncat <<EOF | kubectl apply -f -\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: kube-aws:node-proxier\nsubjects:\n  - kind: User\n    name: kube-worker\n  - kind: ServiceAccount\n    name: kube-proxy\n    namespace: kube-system\n  - kind: Group\n    name: system:nodes\nroleRef:\n  kind: ClusterRole\n  name: system:node-proxier\n  apiGroup: rbac.authorization.k8s.io\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"9abf1be0-de41-4b10-8833-8677647a0dd4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ]]; then\nsudo mkdir -p \/etc\/kubernetes\/addons\/canal\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: canal-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  canal_iface: \"\"\n\n  masquerade: \"true\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: canal\n  namespace: kube-system\n  labels:\n    k8s-app: canal\nspec:\n  selector:\n    matchLabels:\n      k8s-app: canal\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: canal\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: canal\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-canal.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              value: \"none\"\n            - name: CLUSTER_TYPE\n              value: \"k8s,canal\"\n            - name: FELIX_IPTABLESREFRESHINTERVAL\n              value: \"60\"\n            - name: IP\n              value: \"\"\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"192.168.0.0\/16\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: \/readiness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n        - name: kube-flannel\n          image: quay.io\/coreos\/flannel:v0.9.1\n          command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n          securityContext:\n            privileged: true\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: FLANNELD_IFACE\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: canal_iface\n            - name: FLANNELD_IP_MASQ\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: masquerade\n          volumeMounts:\n          - mountPath: \/run\/xtables.lock\n            name: xtables-lock\n            readOnly: false\n          - name: flannel-cfg\n            mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: flannel-cfg\n          configMap:\n            name: canal-config\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: canal\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: canal-flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: canal-calico\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/canal\/canal.yml\nkubectl create -f \/etc\/kubernetes\/addons\/canal\/canal.yml\n\nelif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]];then\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/calico\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  calico_backend: \"bird\"\n\n  veth_mtu: \"1440\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: calico-node\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-calico.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CNI_MTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s,bgp\"\n            - name: IP\n              value: \"autodetect\"\n            - name: CALICO_IPV4POOL_IPIP\n              value: \"Always\"\n            - name: FELIX_IPINIPMTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"@@{KUBE_CLUSTER_SUBNET}@@\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            exec:\n              command:\n              - \/bin\/calico-node\n              - -bird-ready\n              - -felix-ready\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPPeer\n    plural: bgppeers\n    singular: bgppeer\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/calico\/calico.yml\nkubectl create -f \/etc\/kubernetes\/addons\/calico\/calico.yml  \n\nelse\n  echo \"Defaulting to flannel\"\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n  - kind: ServiceAccount\n    name: flannel\n    namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"hairpinMode\": true,\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - \/opt\/bin\/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n          limits:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/bin\/sh\", \"-c\", \"set -e -x; cp -f \/etc\/kube-flannel\/cni-conf.json \/etc\/cni\/net.d\/10-flannel.conf; while true; do sleep 3600; done\" ]\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nfi\n\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"5cc056c8-cd5a-4fa1-9013-46e423a85b50","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n  - name: dns\n    port: 53\n    protocol: UDP\n  - name: dns-tcp\n    port: 53\n    protocol: TCP\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: k8s.gcr.io\/k8s-dns-kube-dns:1.14.13\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: k8s.gcr.io\/k8s-dns-dnsmasq-nanny:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --no-negcache\n        - --dns-loop-detect\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: k8s.gcr.io\/k8s-dns-sidecar:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local,5,SRV\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local,5,SRV\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy: Default\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.2.0\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          - --target=Deployment\/kube-dns\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"}],"description":"","message_list":[],"uuid":"eb446d01-8c07-4895-b70a-69c1861525bf","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"e07e43b0_dag","uuid":"026f2463-8259-48c4-a015-962ec6ee3c69"},"name":"26c82c77_runbook_cloned_1"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"},"retries":"0","description":"","type":"DAG","uuid":"0430de1c-4a60-4831-a140-7a42fa1e1204","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6bbde6e8_dag"}],"description":"","message_list":[],"uuid":"1ba020b7-35b3-415f-8a9f-9ea1d90e488b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6bbde6e8_dag","uuid":"0430de1c-4a60-4831-a140-7a42fa1e1204"},"name":"6eaeef4c_runbook_cloned_1"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Uninstall_Crb_8f379386_82c8_4851_84aa_e97b83c8b8a7"}],"description":"","message_list":[],"uuid":"7ff33631-d4cf-4620-8034-02c306390390","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"bc6fec02-06b2-4103-aeb8-c75647601388"},"name":"SYS_GEN__Runbook_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"2f20302e-7990-4617-8d4c-6d3693896ae6","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"},"retries":"0","description":"","type":"DAG","uuid":"a233e601-d31f-430b-bf95-7320970d8821","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"6ae4a14c-c55a-4f50-ba2b-799bc37f88cf"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"0c2e9e1a-e116-4840-bfe4-87fd58dca2ec"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"06034e9d-2977-45e4-bd9a-02f8f9b12dbd"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"6ae4a14c-c55a-4f50-ba2b-799bc37f88cf"},"edge_type":"inherent","type":"","uuid":"00d372f0-82d9-44ef-91e3-0009ef086661","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"0c2e9e1a-e116-4840-bfe4-87fd58dca2ec"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"0c2e9e1a-e116-4840-bfe4-87fd58dca2ec"},"edge_type":"inherent","type":"","uuid":"bfaf91ab-9a08-42fc-a01d-0bd57330b2b1","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"06034e9d-2977-45e4-bd9a-02f8f9b12dbd"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6ae4a14c-c55a-4f50-ba2b-799bc37f88cf","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0c2e9e1a-e116-4840-bfe4-87fd58dca2ec","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"7f713d48-74e9-4bb6-8dc9-eb8f00371ff3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"06034e9d-2977-45e4-bd9a-02f8f9b12dbd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"7ff33631-d4cf-4620-8034-02c306390390"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7"}],"description":"","message_list":[],"uuid":"f9369cac-46a5-418b-94f8-81c6f880534d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"a233e601-d31f-430b-bf95-7320970d8821"},"name":"SYS_GEN__Runbook_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"0ac0b363-0aee-4b40-a092-6ab6dbb68b06","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"},"retries":"0","description":"","type":"DAG","uuid":"9cff8912-bddc-4cc5-9199-6a8cfcc46db2","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"3fe06839-b9c9-4598-ad8d-2e208b512102"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"bfe7ff35-c8ff-45c0-8397-a6bb12ad444a"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"3fe06839-b9c9-4598-ad8d-2e208b512102"},"edge_type":"inherent","type":"","uuid":"df2bda59-7e01-49a2-8d42-0f2c6da2891a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"bfe7ff35-c8ff-45c0-8397-a6bb12ad444a"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3fe06839-b9c9-4598-ad8d-2e208b512102","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"2064d305-852a-47aa-89b9-7415f90c2152"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"bfe7ff35-c8ff-45c0-8397-a6bb12ad444a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_8f379386_82c8_4851_84aa_e97b83c8b8a7"}],"description":"","message_list":[],"uuid":"c9d7e4e7-dd5b-4161-8c95-663c4991591d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"9cff8912-bddc-4cc5-9199-6a8cfcc46db2"},"name":"SYS_GEN__Runbook_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7"}},{"description":"System action for starting an application","message_list":[],"uuid":"cfb16ac2-4412-4784-b2aa-e1fcbfa14bed","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"},"retries":"0","description":"","type":"DAG","uuid":"e83afcbd-7325-471e-8178-28630e665197","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"8ce7ed41-7698-46ca-9e19-dab16b52d350"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8ce7ed41-7698-46ca-9e19-dab16b52d350","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"13cafd3a-11eb-407b-883b-28cbadb15795","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"e83afcbd-7325-471e-8178-28630e665197"},"name":"SYS_GEN__Runbook_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7"}},{"description":"System action for restarting an application","message_list":[],"uuid":"82da7e25-34a4-4a34-9c84-fbac4aae80c7","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"},"retries":"0","description":"","type":"DAG","uuid":"a3dc3ca0-e024-40d9-9924-e42f52b67db6","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"1137e87e-bef3-43f8-95b3-19effed0a5db"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1137e87e-bef3-43f8-95b3-19effed0a5db","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"ca8cec47-f6e6-4ffb-83f1-eb67ddbb98e2"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"ebfc822e-73e2-49e6-b77e-ffc59a6ce96b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"a3dc3ca0-e024-40d9-9924-e42f52b67db6"},"name":"SYS_GEN__Runbook_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7"}},{"description":"System action for stopping an application","message_list":[],"uuid":"bde84796-bb30-4694-ac4d-932db819390a","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"},"retries":"0","description":"","type":"DAG","uuid":"1bb8116a-55c2-4f24-bd4d-90503192d3ac","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"d437919c-c7dd-46d2-93e0-1387d44a1919"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d437919c-c7dd-46d2-93e0-1387d44a1919","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"e339c505-085e-4a2e-8fd6-b37eefbb45af","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7","uuid":"1bb8116a-55c2-4f24-bd4d-90503192d3ac"},"name":"SYS_GEN__Runbook_Package_8f379386_82c8_4851_84aa_e97b83c8b8a7"}}],"message_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"}],"uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7","state":"ACTIVE","version":"","editables":{},"type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"},"retries":"0","description":"","type":"DAG","uuid":"026f2463-8259-48c4-a015-962ec6ee3c69","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubenetes Version","uuid":"a58ad377-dfbf-4a4b-9cdf-2222d2e78f80"},{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"854219fc-578b-4a46-bc86-f5b1dec3fc6f"},{"kind":"app_task","name":"Generate Certs","uuid":"7af0fa88-eec7-4152-bb5c-768f203e21cb"},{"kind":"app_task","name":"Configure Services","uuid":"2ed591c5-8534-4c09-8dca-ddd4a1aec422"},{"kind":"app_task","name":"Add User Roles","uuid":"7bb62d31-6da2-499e-bab8-6f4dfabff5aa"},{"kind":"app_task","name":"Network Configuration","uuid":"9abf1be0-de41-4b10-8833-8677647a0dd4"},{"kind":"app_task","name":"DNS Configuration","uuid":"5cc056c8-cd5a-4fa1-9013-46e423a85b50"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubenetes Version","uuid":"a58ad377-dfbf-4a4b-9cdf-2222d2e78f80"},"edge_type":"user_defined","type":"","uuid":"84c67d99-e587-4045-9b4a-8d1d64e11f2f","to_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"854219fc-578b-4a46-bc86-f5b1dec3fc6f"}},{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"854219fc-578b-4a46-bc86-f5b1dec3fc6f"},"edge_type":"user_defined","type":"","uuid":"abc2a0aa-e191-45b6-820e-e0f3538abf20","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"7af0fa88-eec7-4152-bb5c-768f203e21cb"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"7af0fa88-eec7-4152-bb5c-768f203e21cb"},"edge_type":"user_defined","type":"","uuid":"1c202d0e-aed1-41fb-8042-f1b6ab9aff87","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"2ed591c5-8534-4c09-8dca-ddd4a1aec422"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"2ed591c5-8534-4c09-8dca-ddd4a1aec422"},"edge_type":"user_defined","type":"","uuid":"22b08f81-dcc4-4593-83fc-817e1bbf4c9c","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"7bb62d31-6da2-499e-bab8-6f4dfabff5aa"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"7bb62d31-6da2-499e-bab8-6f4dfabff5aa"},"edge_type":"user_defined","type":"","uuid":"09095f87-8136-4300-af6a-8359190e98c4","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"9abf1be0-de41-4b10-8833-8677647a0dd4"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"9abf1be0-de41-4b10-8833-8677647a0dd4"},"edge_type":"user_defined","type":"","uuid":"220a64fd-6fba-4c2b-b0d8-46d76c661023","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"5cc056c8-cd5a-4fa1-9013-46e423a85b50"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"e07e43b0_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"a58ad377-dfbf-4a4b-9cdf-2222d2e78f80","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubenetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"854219fc-578b-4a46-bc86-f5b1dec3fc6f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo yum install -y python-setuptools --quiet\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.3.12\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nWORKER_IPS=\"@@{Azure_Centos_K8SW.private_ip_address}@@\" # private Ip's\nPUBLIC_MASTER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_WORKER_IPS=\"@@{Azure_Centos_K8SW.public_ip_address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} master${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"master${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  count=$((count+1))\ndone \n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"7af0fa88-eec7-4152-bb5c-768f203e21cb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\ndeclare -a INSTANCE_IPS\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nWORKER_IPS=\"@@{Azure_Centos_K8SW.private_ip_address}@@\" # private Ip's\nPUBLIC_MASTER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_WORKER_IPS=\"@@{Azure_Centos_K8SM.public_ip_address}@@\"\nINSTANCE_IPS=($(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"))\nMASTER_HOSTNAMES=\"@@{calm_array_name}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"master${count}\",\n  count=$((count+1))\ndone\nMASTER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"worker${count}\",\n  count=$((count+1))\ndone\nWORKER_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${PUBLIC_MASTER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${PUBLIC_MASTER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${PUBLIC_MASTER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json \\\n-hostname=${MASTER_NAMES},${MASTER_IPS},${WORKER_NAMES},${WORKER_IPS},${FIRST_IP_SERVICE_SUBNET},${PUBLIC_MASTER_IPS},${PUBLIC_WORKER_IPS},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local \\\n-profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor name in $(echo ${MASTER_NAMES} | tr \",\" \"\\n\"); do\ninstance=\"master${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${name}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_IPS[$count]} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor name in $(echo ${MASTER_NAMES} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=master${count}.kubeconfig\nkubectl config set-credentials system:node:${name} --client-certificate=master${count}.pem --client-key=master${count}-key.pem --embed-certs=true --kubeconfig=master${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${name} --kubeconfig=master${count}.kubeconfig\nkubectl config use-context default --kubeconfig=master${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"master${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"2ed591c5-8534-4c09-8dca-ddd4a1aec422","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nMASTER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${NODE_NAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${MASTER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=${KUBE_CLUSTER_NAME}\n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n\necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"7bb62d31-6da2-499e-bab8-6f4dfabff5aa","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet\nsudo systemctl enable etcd docker kubelet\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem master* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\n\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF\n\ncat <<EOF | kubectl apply -f -\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: kube-aws:node-proxier\nsubjects:\n  - kind: User\n    name: kube-worker\n  - kind: ServiceAccount\n    name: kube-proxy\n    namespace: kube-system\n  - kind: Group\n    name: system:nodes\nroleRef:\n  kind: ClusterRole\n  name: system:node-proxier\n  apiGroup: rbac.authorization.k8s.io\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"9abf1be0-de41-4b10-8833-8677647a0dd4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ]]; then\nsudo mkdir -p \/etc\/kubernetes\/addons\/canal\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: canal-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  canal_iface: \"\"\n\n  masquerade: \"true\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: canal\n  namespace: kube-system\n  labels:\n    k8s-app: canal\nspec:\n  selector:\n    matchLabels:\n      k8s-app: canal\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: canal\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: canal\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-canal.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              value: \"none\"\n            - name: CLUSTER_TYPE\n              value: \"k8s,canal\"\n            - name: FELIX_IPTABLESREFRESHINTERVAL\n              value: \"60\"\n            - name: IP\n              value: \"\"\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"192.168.0.0\/16\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: \/readiness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n        - name: kube-flannel\n          image: quay.io\/coreos\/flannel:v0.9.1\n          command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n          securityContext:\n            privileged: true\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: FLANNELD_IFACE\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: canal_iface\n            - name: FLANNELD_IP_MASQ\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: masquerade\n          volumeMounts:\n          - mountPath: \/run\/xtables.lock\n            name: xtables-lock\n            readOnly: false\n          - name: flannel-cfg\n            mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: flannel-cfg\n          configMap:\n            name: canal-config\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: canal\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: canal-flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: canal-calico\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/canal\/canal.yml\nkubectl create -f \/etc\/kubernetes\/addons\/canal\/canal.yml\n\nelif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]];then\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/calico\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  calico_backend: \"bird\"\n\n  veth_mtu: \"1440\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: calico-node\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-calico.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CNI_MTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s,bgp\"\n            - name: IP\n              value: \"autodetect\"\n            - name: CALICO_IPV4POOL_IPIP\n              value: \"Always\"\n            - name: FELIX_IPINIPMTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"@@{KUBE_CLUSTER_SUBNET}@@\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            exec:\n              command:\n              - \/bin\/calico-node\n              - -bird-ready\n              - -felix-ready\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPPeer\n    plural: bgppeers\n    singular: bgppeer\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/calico\/calico.yml\nkubectl create -f \/etc\/kubernetes\/addons\/calico\/calico.yml  \n\nelse\n  echo \"Defaulting to flannel\"\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n  - kind: ServiceAccount\n    name: flannel\n    namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"hairpinMode\": true,\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - \/opt\/bin\/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n          limits:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/bin\/sh\", \"-c\", \"set -e -x; cp -f \/etc\/kube-flannel\/cni-conf.json \/etc\/cni\/net.d\/10-flannel.conf; while true; do sleep 3600; done\" ]\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nfi\n\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"5cc056c8-cd5a-4fa1-9013-46e423a85b50","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n  - name: dns\n    port: 53\n    protocol: UDP\n  - name: dns-tcp\n    port: 53\n    protocol: TCP\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: k8s.gcr.io\/k8s-dns-kube-dns:1.14.13\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: k8s.gcr.io\/k8s-dns-dnsmasq-nanny:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --no-negcache\n        - --dns-loop-detect\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: k8s.gcr.io\/k8s-dns-sidecar:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local,5,SRV\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local,5,SRV\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy: Default\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.2.0\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          - --target=Deployment\/kube-dns\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"}],"description":"","message_list":[],"uuid":"eb446d01-8c07-4895-b70a-69c1861525bf","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"e07e43b0_dag","uuid":"026f2463-8259-48c4-a015-962ec6ee3c69"},"name":"26c82c77_runbook_cloned_1"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"},"retries":"0","description":"","type":"DAG","uuid":"0430de1c-4a60-4831-a140-7a42fa1e1204","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6bbde6e8_dag"}],"description":"","message_list":[],"uuid":"1ba020b7-35b3-415f-8a9f-9ea1d90e488b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6bbde6e8_dag","uuid":"0430de1c-4a60-4831-a140-7a42fa1e1204"},"name":"6eaeef4c_runbook_cloned_1"}},"variable_list":[],"name":"Azure_Centos_K8SM_Package"},{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"06bbadbc-3bda-4224-a8d5-732b154a4168","name":"action_install","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"},"retries":"0","description":"","type":"DAG","uuid":"5cc6f1f5-ca7c-46ee-9bb8-089d118a9d7e","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Install_Crb_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"76893639-8434-4f70-8b78-12cd59acb508"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_206d70f4_364d_415d_bb4a_8739e54e57f5"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_INSTALL","uuid":"76893639-8434-4f70-8b78-12cd59acb508","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"},"retries":"0","description":"","type":"DAG","uuid":"e83773dc-a90a-4aa8-8675-4260f2dd31a5","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"09ad5b4e-3a8b-42b7-8f52-5c314ffb1ea1"},{"kind":"app_task","name":"Docker Kubelet Install","uuid":"262028f3-a637-4699-8d16-49e1bffaa57f"},{"kind":"app_task","name":"GetCerts","uuid":"f2494ce8-d46c-4f2b-8b34-3932b54d9d15"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"09ad5b4e-3a8b-42b7-8f52-5c314ffb1ea1"},"edge_type":"user_defined","type":"","uuid":"ea04f9e9-ecbf-4446-8a9d-5bb28828dc88","to_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"262028f3-a637-4699-8d16-49e1bffaa57f"}},{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"262028f3-a637-4699-8d16-49e1bffaa57f"},"edge_type":"user_defined","type":"","uuid":"1013091b-e1f7-4c0d-a2be-cee94d94fb88","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"f2494ce8-d46c-4f2b-8b34-3932b54d9d15"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"709f9264_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"09ad5b4e-3a8b-42b7-8f52-5c314ffb1ea1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"262028f3-a637-4699-8d16-49e1bffaa57f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{Azure_Centos_K8SM.private_ip_address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\n\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"f2494ce8-d46c-4f2b-8b34-3932b54d9d15","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{Azure_Centos_K8SM.private_ip_address[0]}@@\"\nINSTANCE_IP=\"@@{private_ip_address}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; if [[ $count -eq 600 ]]; then echo \"failed to download certs\" && exit 1; fi; count=$(($count+5)) ; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"minion@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${HOSTNAME}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${HOSTNAME},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${HOSTNAME} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${HOSTNAME} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"6deda1b0-c19c-444d-bab4-c3a398474f9d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"709f9264_dag","uuid":"e83773dc-a90a-4aa8-8675-4260f2dd31a5"},"name":"927472a7_runbook_cloned_1"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"},"retries":"0","description":"","type":"DAG","uuid":"545b58be-709a-47d8-8f91-798776914e2b","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"3affc206-189a-4914-a8aa-009da2cb9299"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"fef85962_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"3affc206-189a-4914-a8aa-009da2cb9299","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain 'worker@@{calm_array_index}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node 'worker@@{calm_array_index}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"045b7396-4def-45e7-b87e-fb73be58ee5d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"fef85962_dag","uuid":"545b58be-709a-47d8-8f91-798776914e2b"},"name":"435393f9_runbook_cloned_1"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Install_Crb_206d70f4_364d_415d_bb4a_8739e54e57f5"}],"description":"","message_list":[],"uuid":"dd28a56f-050d-4a92-87ea-44c57f0264d3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"5cc6f1f5-ca7c-46ee-9bb8-089d118a9d7e"},"name":"SYS_GEN__Runbook_Package_206d70f4_364d_415d_bb4a_8739e54e57f5"}},{"description":"System action for creating an application","message_list":[],"uuid":"0abd11d8-f2fb-4f78-8909-e31bdd689edb","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"},"retries":"0","description":"","type":"DAG","uuid":"8feb22e2-275c-4b60-b9bf-d413e26dad64","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"8f35713e-90fe-4e2e-a843-be4463f77ba3"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"6642ce65-4b65-480c-b9fb-8ca157d4a059"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"ba8ef8d5-5435-4c88-8126-177601b5cb52"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"6642ce65-4b65-480c-b9fb-8ca157d4a059"},"edge_type":"inherent","type":"","uuid":"ebcce25d-d36c-48e9-a29f-2641b11a9143","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"ba8ef8d5-5435-4c88-8126-177601b5cb52"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"8f35713e-90fe-4e2e-a843-be4463f77ba3"},"edge_type":"inherent","type":"","uuid":"007e64dd-8cb3-4149-8d99-e7383884346d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"6642ce65-4b65-480c-b9fb-8ca157d4a059"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_206d70f4_364d_415d_bb4a_8739e54e57f5"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8f35713e-90fe-4e2e-a843-be4463f77ba3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"dd28a56f-050d-4a92-87ea-44c57f0264d3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_206d70f4_364d_415d_bb4a_8739e54e57f5"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6642ce65-4b65-480c-b9fb-8ca157d4a059","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"cca906a5-5e79-422e-b15f-7391a907ad07"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ba8ef8d5-5435-4c88-8126-177601b5cb52","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"c42fe639-31b8-4af2-91c6-94fbc1c4e75b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"8feb22e2-275c-4b60-b9bf-d413e26dad64"},"name":"SYS_GEN__Runbook_Package_206d70f4_364d_415d_bb4a_8739e54e57f5"}},{"description":"System action for uninstalling an application","message_list":[],"uuid":"ac3ca73f-00ce-4fd7-88a1-2a79a932d94a","name":"action_uninstall","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"},"retries":"0","description":"","type":"DAG","uuid":"d2c1fcff-2169-4367-bd17-13775bffe6d9","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Uninstall_Crb_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"a2fb933e-f134-425f-8222-42356f06c0a3"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_206d70f4_364d_415d_bb4a_8739e54e57f5"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_UNINSTALL","uuid":"a2fb933e-f134-425f-8222-42356f06c0a3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"},"retries":"0","description":"","type":"DAG","uuid":"e83773dc-a90a-4aa8-8675-4260f2dd31a5","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"09ad5b4e-3a8b-42b7-8f52-5c314ffb1ea1"},{"kind":"app_task","name":"Docker Kubelet Install","uuid":"262028f3-a637-4699-8d16-49e1bffaa57f"},{"kind":"app_task","name":"GetCerts","uuid":"f2494ce8-d46c-4f2b-8b34-3932b54d9d15"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"09ad5b4e-3a8b-42b7-8f52-5c314ffb1ea1"},"edge_type":"user_defined","type":"","uuid":"ea04f9e9-ecbf-4446-8a9d-5bb28828dc88","to_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"262028f3-a637-4699-8d16-49e1bffaa57f"}},{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"262028f3-a637-4699-8d16-49e1bffaa57f"},"edge_type":"user_defined","type":"","uuid":"1013091b-e1f7-4c0d-a2be-cee94d94fb88","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"f2494ce8-d46c-4f2b-8b34-3932b54d9d15"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"709f9264_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"09ad5b4e-3a8b-42b7-8f52-5c314ffb1ea1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"262028f3-a637-4699-8d16-49e1bffaa57f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{Azure_Centos_K8SM.private_ip_address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\n\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"f2494ce8-d46c-4f2b-8b34-3932b54d9d15","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{Azure_Centos_K8SM.private_ip_address[0]}@@\"\nINSTANCE_IP=\"@@{private_ip_address}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; if [[ $count -eq 600 ]]; then echo \"failed to download certs\" && exit 1; fi; count=$(($count+5)) ; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"minion@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${HOSTNAME}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${HOSTNAME},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${HOSTNAME} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${HOSTNAME} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"6deda1b0-c19c-444d-bab4-c3a398474f9d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"709f9264_dag","uuid":"e83773dc-a90a-4aa8-8675-4260f2dd31a5"},"name":"927472a7_runbook_cloned_1"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"},"retries":"0","description":"","type":"DAG","uuid":"545b58be-709a-47d8-8f91-798776914e2b","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"3affc206-189a-4914-a8aa-009da2cb9299"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"fef85962_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"3affc206-189a-4914-a8aa-009da2cb9299","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain 'worker@@{calm_array_index}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node 'worker@@{calm_array_index}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"045b7396-4def-45e7-b87e-fb73be58ee5d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"fef85962_dag","uuid":"545b58be-709a-47d8-8f91-798776914e2b"},"name":"435393f9_runbook_cloned_1"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Uninstall_Crb_206d70f4_364d_415d_bb4a_8739e54e57f5"}],"description":"","message_list":[],"uuid":"652a7c4c-795e-4605-a656-4fb279302091","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"d2c1fcff-2169-4367-bd17-13775bffe6d9"},"name":"SYS_GEN__Runbook_Package_206d70f4_364d_415d_bb4a_8739e54e57f5"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"c6307960-4fdf-4ff1-8f2d-32f24d0446ec","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"},"retries":"0","description":"","type":"DAG","uuid":"7bb62d22-52a8-4497-85b5-4a0117f1d0e2","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"071b4f5d-63a6-473f-9e4a-ef2de6c76088"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"0baa4a4c-93f8-4ba7-8171-97e1c2760199"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"ee76b8ec-7737-4b88-8f5e-5975a30cc7e5"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"071b4f5d-63a6-473f-9e4a-ef2de6c76088"},"edge_type":"inherent","type":"","uuid":"b6a21a01-5c1c-4893-9116-f6fc39cefe2c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"0baa4a4c-93f8-4ba7-8171-97e1c2760199"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"0baa4a4c-93f8-4ba7-8171-97e1c2760199"},"edge_type":"inherent","type":"","uuid":"374c8649-a885-464e-ae3c-e0bec87666fa","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"ee76b8ec-7737-4b88-8f5e-5975a30cc7e5"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_206d70f4_364d_415d_bb4a_8739e54e57f5"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"071b4f5d-63a6-473f-9e4a-ef2de6c76088","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0baa4a4c-93f8-4ba7-8171-97e1c2760199","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"843ab0a6-03bd-4b9c-8f56-7d852e9348e0"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ee76b8ec-7737-4b88-8f5e-5975a30cc7e5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"652a7c4c-795e-4605-a656-4fb279302091"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_206d70f4_364d_415d_bb4a_8739e54e57f5"}],"description":"","message_list":[],"uuid":"de91c127-49aa-4084-9fe2-b9b55e7ea7a0","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"7bb62d22-52a8-4497-85b5-4a0117f1d0e2"},"name":"SYS_GEN__Runbook_Package_206d70f4_364d_415d_bb4a_8739e54e57f5"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"9b3703cc-943a-4663-9de8-5382111b18ec","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"},"retries":"0","description":"","type":"DAG","uuid":"0998bfbb-427b-43d1-ae69-620111014329","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"9127e3a4-0f4d-4087-aab1-4ed25ee73b57"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"26e0f4f0-fac3-4974-915f-9a4668ff8a41"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"9127e3a4-0f4d-4087-aab1-4ed25ee73b57"},"edge_type":"inherent","type":"","uuid":"095331e3-a139-4d2f-abf1-fabda2d5965d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"26e0f4f0-fac3-4974-915f-9a4668ff8a41"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_206d70f4_364d_415d_bb4a_8739e54e57f5"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"9127e3a4-0f4d-4087-aab1-4ed25ee73b57","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"716ea7a7-bc0c-4ac5-ab9c-720c327a498e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"26e0f4f0-fac3-4974-915f-9a4668ff8a41","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_206d70f4_364d_415d_bb4a_8739e54e57f5"}],"description":"","message_list":[],"uuid":"5988ebce-7188-4c9a-bc33-d82d808b7e72","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"0998bfbb-427b-43d1-ae69-620111014329"},"name":"SYS_GEN__Runbook_Package_206d70f4_364d_415d_bb4a_8739e54e57f5"}},{"description":"System action for starting an application","message_list":[],"uuid":"a67df9c9-8570-4a5e-9d13-9cdefce3f383","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"},"retries":"0","description":"","type":"DAG","uuid":"72efb92c-accf-4134-b65d-5eb205d8ef96","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"21521ea2-60d2-4ed4-afe8-b913a128a668"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_206d70f4_364d_415d_bb4a_8739e54e57f5"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"21521ea2-60d2-4ed4-afe8-b913a128a668","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"00f4ddf6-148c-46a1-882a-be3a9a464814","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"72efb92c-accf-4134-b65d-5eb205d8ef96"},"name":"SYS_GEN__Runbook_Package_206d70f4_364d_415d_bb4a_8739e54e57f5"}},{"description":"System action for restarting an application","message_list":[],"uuid":"e0c426b5-63bd-4d26-998f-81c70b1c020b","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"},"retries":"0","description":"","type":"DAG","uuid":"bd1846bc-8cc3-4411-bde1-8870553d1fd8","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"c46aad4b-2ae4-4bd6-ae6a-afaec1f6f704"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_206d70f4_364d_415d_bb4a_8739e54e57f5"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c46aad4b-2ae4-4bd6-ae6a-afaec1f6f704","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"ce602c49-d9cd-44d7-8e10-5671dc407b8b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"ac82649a-6c83-4379-8c06-f817902fe99e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"bd1846bc-8cc3-4411-bde1-8870553d1fd8"},"name":"SYS_GEN__Runbook_Package_206d70f4_364d_415d_bb4a_8739e54e57f5"}},{"description":"System action for stopping an application","message_list":[],"uuid":"cebdedda-50ff-4193-9f86-6c623baf2e97","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"},"retries":"0","description":"","type":"DAG","uuid":"45e32f82-7986-48d0-8d5b-ebd7372865e3","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"bba55dca-7dd8-4194-95db-438c32bbf3fe"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_206d70f4_364d_415d_bb4a_8739e54e57f5"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"bba55dca-7dd8-4194-95db-438c32bbf3fe","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"4311569a-b15b-4b06-ac99-0a47ab9ec828","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_206d70f4_364d_415d_bb4a_8739e54e57f5","uuid":"45e32f82-7986-48d0-8d5b-ebd7372865e3"},"name":"SYS_GEN__Runbook_Package_206d70f4_364d_415d_bb4a_8739e54e57f5"}}],"message_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"}],"uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5","state":"ACTIVE","version":"","editables":{},"type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"},"retries":"0","description":"","type":"DAG","uuid":"e83773dc-a90a-4aa8-8675-4260f2dd31a5","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"09ad5b4e-3a8b-42b7-8f52-5c314ffb1ea1"},{"kind":"app_task","name":"Docker Kubelet Install","uuid":"262028f3-a637-4699-8d16-49e1bffaa57f"},{"kind":"app_task","name":"GetCerts","uuid":"f2494ce8-d46c-4f2b-8b34-3932b54d9d15"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"09ad5b4e-3a8b-42b7-8f52-5c314ffb1ea1"},"edge_type":"user_defined","type":"","uuid":"ea04f9e9-ecbf-4446-8a9d-5bb28828dc88","to_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"262028f3-a637-4699-8d16-49e1bffaa57f"}},{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"262028f3-a637-4699-8d16-49e1bffaa57f"},"edge_type":"user_defined","type":"","uuid":"1013091b-e1f7-4c0d-a2be-cee94d94fb88","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"f2494ce8-d46c-4f2b-8b34-3932b54d9d15"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"709f9264_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"09ad5b4e-3a8b-42b7-8f52-5c314ffb1ea1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"262028f3-a637-4699-8d16-49e1bffaa57f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{Azure_Centos_K8SM.private_ip_address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\n\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"f2494ce8-d46c-4f2b-8b34-3932b54d9d15","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{Azure_Centos_K8SM.private_ip_address[0]}@@\"\nINSTANCE_IP=\"@@{private_ip_address}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; if [[ $count -eq 600 ]]; then echo \"failed to download certs\" && exit 1; fi; count=$(($count+5)) ; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"minion@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${HOSTNAME}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${HOSTNAME},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${HOSTNAME} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${HOSTNAME} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"6deda1b0-c19c-444d-bab4-c3a398474f9d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"709f9264_dag","uuid":"e83773dc-a90a-4aa8-8675-4260f2dd31a5"},"name":"927472a7_runbook_cloned_1"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"},"retries":"0","description":"","type":"DAG","uuid":"545b58be-709a-47d8-8f91-798776914e2b","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"3affc206-189a-4914-a8aa-009da2cb9299"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"fef85962_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"3affc206-189a-4914-a8aa-009da2cb9299","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain 'worker@@{calm_array_index}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node 'worker@@{calm_array_index}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"045b7396-4def-45e7-b87e-fb73be58ee5d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"fef85962_dag","uuid":"545b58be-709a-47d8-8f91-798776914e2b"},"name":"435393f9_runbook_cloned_1"}},"variable_list":[],"name":"Azure_Centos_K8SW_Package"},{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"94da5df6-2cd6-4433-84b8-888b0792b811","name":"action_install","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"},"retries":"0","description":"","type":"DAG","uuid":"5c5df827-65da-4d66-ba5d-30bc5500e901","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Install_Crb_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"ac1570eb-4cde-4d7b-8923-fd584c9bc0b5"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e"},{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_INSTALL","uuid":"ac1570eb-4cde-4d7b-8923-fd584c9bc0b5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"},"retries":"0","description":"","type":"DAG","uuid":"42047288-c092-4490-9d35-8d8f5c2239e8","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"84c2fa42-02fb-42c8-80b9-6195c0ea7907"},{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"5c9d1a9d-edad-4ea4-8d8b-81d7c704a1fc"},{"kind":"app_task","name":"Generate Certs","uuid":"9dc17daa-b875-4653-8e38-eb3795ac5761"},{"kind":"app_task","name":"Configure Services","uuid":"30196e17-512a-4c68-9c37-37f79d0fe550"},{"kind":"app_task","name":"Add User Roles","uuid":"2aa9af2f-5888-4b61-a973-dec61fae506a"},{"kind":"app_task","name":"Network Configuration","uuid":"e937e510-6931-49c9-adcd-5c1520077bf6"},{"kind":"app_task","name":"DNS Configuration","uuid":"d805ac55-d0a5-457c-8124-bedc05e2b070"},{"kind":"app_task","name":"NVP Configuration","uuid":"9070721a-1ddc-4336-84af-8f4b5222f0e0"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"84c2fa42-02fb-42c8-80b9-6195c0ea7907"},"edge_type":"user_defined","type":"","uuid":"b33230cb-473c-4359-8c19-f3169bd93b0c","to_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"5c9d1a9d-edad-4ea4-8d8b-81d7c704a1fc"}},{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"5c9d1a9d-edad-4ea4-8d8b-81d7c704a1fc"},"edge_type":"user_defined","type":"","uuid":"664f2f03-c5c8-476a-9813-7c867f54f56b","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"9dc17daa-b875-4653-8e38-eb3795ac5761"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"9dc17daa-b875-4653-8e38-eb3795ac5761"},"edge_type":"user_defined","type":"","uuid":"a6a6464f-9bde-4736-b77a-935ab0188d37","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"30196e17-512a-4c68-9c37-37f79d0fe550"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"30196e17-512a-4c68-9c37-37f79d0fe550"},"edge_type":"user_defined","type":"","uuid":"97a7b380-e840-4072-a4fb-5afcd7fb3dcf","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"2aa9af2f-5888-4b61-a973-dec61fae506a"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"2aa9af2f-5888-4b61-a973-dec61fae506a"},"edge_type":"user_defined","type":"","uuid":"31f20fbf-0aa5-4f3a-b480-88fb48d2f10d","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"e937e510-6931-49c9-adcd-5c1520077bf6"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"e937e510-6931-49c9-adcd-5c1520077bf6"},"edge_type":"user_defined","type":"","uuid":"6aa5d7f0-e9e7-42f6-a131-94dc90120fa5","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"d805ac55-d0a5-457c-8124-bedc05e2b070"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"d805ac55-d0a5-457c-8124-bedc05e2b070"},"edge_type":"user_defined","type":"","uuid":"db45a437-f025-42d7-81ea-bb5c23a19f8f","to_task_reference":{"kind":"app_task","name":"NVP Configuration","uuid":"9070721a-1ddc-4336-84af-8f4b5222f0e0"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"dac441af_dag_cloned_1"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"84c2fa42-02fb-42c8-80b9-6195c0ea7907","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"5c9d1a9d-edad-4ea4-8d8b-81d7c704a1fc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.3.12\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_IPS=\"@@{VMware_Centos_K8SW.address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} master${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"master${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  count=$((count+1))\ndone   \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate etcd \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/sd{e,f,g}\nsudo vgcreate docker \/dev\/sd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"9dc17daa-b875-4653-8e38-eb3795ac5761","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_IPS=\"@@{VMware_Centos_K8SW.address}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"master${count}\",\n  count=$((count+1))\ndone\n\nMASTER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"worker${count}\",\n  count=$((count+1))\ndone\nWORKER_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${MASTER_NAMES},${MASTER_IPS},${WORKER_NAMES},${WORKER_IPS},${FIRST_IP_SERVICE_SUBNET},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local -profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\ninstance=\"master${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=master${count}.kubeconfig\nkubectl config set-credentials system:node:master${count} --client-certificate=master${count}.pem --client-key=master${count}-key.pem --embed-certs=true --kubeconfig=master${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:master${count} --kubeconfig=master${count}.kubeconfig\nkubectl config use-context default --kubeconfig=master${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"master${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"30196e17-512a-4c68-9c37-37f79d0fe550","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nMASTER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${MASTER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=${KUBE_CLUSTER_NAME}\n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n    \necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"2aa9af2f-5888-4b61-a973-dec61fae506a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet iscsid\nsudo systemctl enable etcd docker kubelet iscsid\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem master* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n    echo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"e937e510-6931-49c9-adcd-5c1520077bf6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ]]; then\nsudo mkdir -p \/etc\/kubernetes\/addons\/canal\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: canal-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  canal_iface: \"\"\n\n  masquerade: \"true\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: canal\n  namespace: kube-system\n  labels:\n    k8s-app: canal\nspec:\n  selector:\n    matchLabels:\n      k8s-app: canal\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: canal\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: canal\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-canal.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              value: \"none\"\n            - name: CLUSTER_TYPE\n              value: \"k8s,canal\"\n            - name: FELIX_IPTABLESREFRESHINTERVAL\n              value: \"60\"\n            - name: IP\n              value: \"\"\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"192.168.0.0\/16\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: \/readiness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n        - name: kube-flannel\n          image: quay.io\/coreos\/flannel:v0.9.1\n          command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n          securityContext:\n            privileged: true\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: FLANNELD_IFACE\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: canal_iface\n            - name: FLANNELD_IP_MASQ\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: masquerade\n          volumeMounts:\n          - mountPath: \/run\/xtables.lock\n            name: xtables-lock\n            readOnly: false\n          - name: flannel-cfg\n            mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: flannel-cfg\n          configMap:\n            name: canal-config\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: canal\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: canal-flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: canal-calico\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/canal\/canal.yml\nkubectl create -f \/etc\/kubernetes\/addons\/canal\/canal.yml\n\nelif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]];then\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/calico\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  calico_backend: \"bird\"\n\n  veth_mtu: \"1440\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: calico-node\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-calico.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CNI_MTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s,bgp\"\n            - name: IP\n              value: \"autodetect\"\n            - name: CALICO_IPV4POOL_IPIP\n              value: \"Always\"\n            - name: FELIX_IPINIPMTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"@@{KUBE_CLUSTER_SUBNET}@@\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            exec:\n              command:\n              - \/bin\/calico-node\n              - -bird-ready\n              - -felix-ready\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPPeer\n    plural: bgppeers\n    singular: bgppeer\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/calico\/calico.yml\nkubectl create -f \/etc\/kubernetes\/addons\/calico\/calico.yml  \n\nelse\n  echo \"Defaulting to flannel\"\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n  - kind: ServiceAccount\n    name: flannel\n    namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"hairpinMode\": true,\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - \/opt\/bin\/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n          limits:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/bin\/sh\", \"-c\", \"set -e -x; cp -f \/etc\/kube-flannel\/cni-conf.json \/etc\/cni\/net.d\/10-flannel.conf; while true; do sleep 3600; done\" ]\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nfi\n\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"d805ac55-d0a5-457c-8124-bedc05e2b070","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n  - name: dns\n    port: 53\n    protocol: UDP\n  - name: dns-tcp\n    port: 53\n    protocol: TCP\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: k8s.gcr.io\/k8s-dns-kube-dns:1.14.13\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: k8s.gcr.io\/k8s-dns-dnsmasq-nanny:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --no-negcache\n        - --dns-loop-detect\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: k8s.gcr.io\/k8s-dns-sidecar:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local,5,SRV\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local,5,SRV\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy: Default\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.2.0\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          - --target=Deployment\/kube-dns\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"9070721a-1ddc-4336-84af-8f4b5222f0e0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nPRISM_CLUSTER_IP=\"@@{PE_CLUSTER_IP}@@\"\nPRISM_DATA_SERVICE_IP=\"@@{PE_CLUSTER_IP}@@\"\n\nif [[ (\"${PRISM_CLUSTER_IP}x\" == \"x\") && (\"${PRISM_DATA_SERVICE_IP}x\" == \"x\") ]]; then exit 0; fi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/volume_plugin\nNTNX_SECRET=$(echo -n \"@@{PE_USERNAME}@@:@@{PE_PASSWORD}@@\" | base64)\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: nutanixabs-provisioner-runner\n  namespace: kube-system\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumes\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumeclaims\"]\n    verbs: [\"get\", \"list\", \"watch\", \"update\"]\n  - apiGroups: [\"storage.k8s.io\"]\n    resources: [\"storageclasses\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"list\", \"watch\", \"create\", \"update\", \"patch\"]\n  - apiGroups: [\"\"]\n    resources: [\"services\"]\n    verbs: [\"get\"]\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"create\", \"delete\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: run-nutanixabs-provisioner\n  namespace: kube-system\nsubjects:\n  - kind: ServiceAccount\n    name: nutanixabs-provisioner\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: nutanixabs-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      labels:\n        app: nutanixabs-provisioner\n    spec:\n      serviceAccount: nutanixabs-provisioner\n      hostNetwork: true\n      containers:\n        -\n          image: \"ntnx\/nutanixabs-provisioner\"\n          name: nutanixabs-provisioner\n          args: [\"--v=4\"]\n          imagePullPolicy: IfNotPresent\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: kube-system\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\n---\nkind: StorageClass\napiVersion: storage.k8s.io\/v1\nmetadata:\n  name: silver \n  namespace: kube-system\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\nprovisioner: nutanix\/abs\nparameters:\n     prismEndPoint: @@{PE_CLUSTER_IP}@@:9440\n     dataServiceEndPoint: @@{PE_DATA_SERVICE_IP}@@:3260\n     secretName: ntnx-secret\n     storageContainer: @@{PE_CONTAINER_NAME}@@\n     fsType: ext4\n     chapAuthEnabled: \"false\"' | sudo tee \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\necho \"apiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: default\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\" | sudo tee -a \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"NVP Configuration"}],"description":"","message_list":[],"uuid":"b566cdff-86b4-4e54-a750-59de52ff15af","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"dac441af_dag_cloned_1","uuid":"42047288-c092-4490-9d35-8d8f5c2239e8"},"name":"8e760b73_runbook_cloned_0"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"},"retries":"0","description":"","type":"DAG","uuid":"ed711bea-3d69-4792-ad72-a0fa36ea05b2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6324786a_dag_cloned_1"}],"description":"","message_list":[],"uuid":"19face75-4a07-4275-a2b7-7a527b6afc94","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6324786a_dag_cloned_1","uuid":"ed711bea-3d69-4792-ad72-a0fa36ea05b2"},"name":"6522ac7a_runbook_cloned_0"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Install_Crb_78d59e2e_ea58_482a_a2b2_6f593da4049e"}],"description":"","message_list":[],"uuid":"2018e0a5-2448-4823-9f5d-9b7d415ea75e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"5c5df827-65da-4d66-ba5d-30bc5500e901"},"name":"SYS_GEN__Runbook_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e"}},{"description":"System action for creating an application","message_list":[],"uuid":"54888d9a-5c99-4ff9-abf4-b1873dddfe00","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"},"retries":"0","description":"","type":"DAG","uuid":"0a702255-89d5-41f5-91be-e0552607509a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"00d80457-a7b9-4453-9ebc-992489d6a849"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"539ee1d0-8bf3-4d8b-ac52-4632cdd7e113"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"1831d3f0-79d0-4e94-8016-736ee008124b"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"539ee1d0-8bf3-4d8b-ac52-4632cdd7e113"},"edge_type":"inherent","type":"","uuid":"51e64df4-39db-458e-a499-1d0f31a9eb1b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"1831d3f0-79d0-4e94-8016-736ee008124b"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"00d80457-a7b9-4453-9ebc-992489d6a849"},"edge_type":"inherent","type":"","uuid":"881c6109-9c34-49ad-8d79-52a47ea5eb09","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"539ee1d0-8bf3-4d8b-ac52-4632cdd7e113"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e"},{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"00d80457-a7b9-4453-9ebc-992489d6a849","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"2018e0a5-2448-4823-9f5d-9b7d415ea75e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"539ee1d0-8bf3-4d8b-ac52-4632cdd7e113","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"384cf3d8-e940-43f1-a289-6c6b363c5371"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1831d3f0-79d0-4e94-8016-736ee008124b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"001106ee-794e-44e4-9ee0-5842abd6b549","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"0a702255-89d5-41f5-91be-e0552607509a"},"name":"SYS_GEN__Runbook_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e"}},{"description":"System action for uninstalling an application","message_list":[],"uuid":"0075844a-9856-481b-a316-282170d72a91","name":"action_uninstall","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"},"retries":"0","description":"","type":"DAG","uuid":"081cb4b7-d7c5-4986-90c4-09402031762b","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Uninstall_Crb_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"122bc245-56d3-48a4-9b82-6728091f7195"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e"},{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_UNINSTALL","uuid":"122bc245-56d3-48a4-9b82-6728091f7195","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"},"retries":"0","description":"","type":"DAG","uuid":"42047288-c092-4490-9d35-8d8f5c2239e8","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"84c2fa42-02fb-42c8-80b9-6195c0ea7907"},{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"5c9d1a9d-edad-4ea4-8d8b-81d7c704a1fc"},{"kind":"app_task","name":"Generate Certs","uuid":"9dc17daa-b875-4653-8e38-eb3795ac5761"},{"kind":"app_task","name":"Configure Services","uuid":"30196e17-512a-4c68-9c37-37f79d0fe550"},{"kind":"app_task","name":"Add User Roles","uuid":"2aa9af2f-5888-4b61-a973-dec61fae506a"},{"kind":"app_task","name":"Network Configuration","uuid":"e937e510-6931-49c9-adcd-5c1520077bf6"},{"kind":"app_task","name":"DNS Configuration","uuid":"d805ac55-d0a5-457c-8124-bedc05e2b070"},{"kind":"app_task","name":"NVP Configuration","uuid":"9070721a-1ddc-4336-84af-8f4b5222f0e0"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"84c2fa42-02fb-42c8-80b9-6195c0ea7907"},"edge_type":"user_defined","type":"","uuid":"b33230cb-473c-4359-8c19-f3169bd93b0c","to_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"5c9d1a9d-edad-4ea4-8d8b-81d7c704a1fc"}},{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"5c9d1a9d-edad-4ea4-8d8b-81d7c704a1fc"},"edge_type":"user_defined","type":"","uuid":"664f2f03-c5c8-476a-9813-7c867f54f56b","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"9dc17daa-b875-4653-8e38-eb3795ac5761"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"9dc17daa-b875-4653-8e38-eb3795ac5761"},"edge_type":"user_defined","type":"","uuid":"a6a6464f-9bde-4736-b77a-935ab0188d37","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"30196e17-512a-4c68-9c37-37f79d0fe550"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"30196e17-512a-4c68-9c37-37f79d0fe550"},"edge_type":"user_defined","type":"","uuid":"97a7b380-e840-4072-a4fb-5afcd7fb3dcf","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"2aa9af2f-5888-4b61-a973-dec61fae506a"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"2aa9af2f-5888-4b61-a973-dec61fae506a"},"edge_type":"user_defined","type":"","uuid":"31f20fbf-0aa5-4f3a-b480-88fb48d2f10d","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"e937e510-6931-49c9-adcd-5c1520077bf6"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"e937e510-6931-49c9-adcd-5c1520077bf6"},"edge_type":"user_defined","type":"","uuid":"6aa5d7f0-e9e7-42f6-a131-94dc90120fa5","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"d805ac55-d0a5-457c-8124-bedc05e2b070"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"d805ac55-d0a5-457c-8124-bedc05e2b070"},"edge_type":"user_defined","type":"","uuid":"db45a437-f025-42d7-81ea-bb5c23a19f8f","to_task_reference":{"kind":"app_task","name":"NVP Configuration","uuid":"9070721a-1ddc-4336-84af-8f4b5222f0e0"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"dac441af_dag_cloned_1"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"84c2fa42-02fb-42c8-80b9-6195c0ea7907","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"5c9d1a9d-edad-4ea4-8d8b-81d7c704a1fc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.3.12\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_IPS=\"@@{VMware_Centos_K8SW.address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} master${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"master${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  count=$((count+1))\ndone   \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate etcd \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/sd{e,f,g}\nsudo vgcreate docker \/dev\/sd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"9dc17daa-b875-4653-8e38-eb3795ac5761","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_IPS=\"@@{VMware_Centos_K8SW.address}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"master${count}\",\n  count=$((count+1))\ndone\n\nMASTER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"worker${count}\",\n  count=$((count+1))\ndone\nWORKER_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${MASTER_NAMES},${MASTER_IPS},${WORKER_NAMES},${WORKER_IPS},${FIRST_IP_SERVICE_SUBNET},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local -profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\ninstance=\"master${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=master${count}.kubeconfig\nkubectl config set-credentials system:node:master${count} --client-certificate=master${count}.pem --client-key=master${count}-key.pem --embed-certs=true --kubeconfig=master${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:master${count} --kubeconfig=master${count}.kubeconfig\nkubectl config use-context default --kubeconfig=master${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"master${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"30196e17-512a-4c68-9c37-37f79d0fe550","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nMASTER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${MASTER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=${KUBE_CLUSTER_NAME}\n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n    \necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"2aa9af2f-5888-4b61-a973-dec61fae506a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet iscsid\nsudo systemctl enable etcd docker kubelet iscsid\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem master* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n    echo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"e937e510-6931-49c9-adcd-5c1520077bf6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ]]; then\nsudo mkdir -p \/etc\/kubernetes\/addons\/canal\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: canal-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  canal_iface: \"\"\n\n  masquerade: \"true\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: canal\n  namespace: kube-system\n  labels:\n    k8s-app: canal\nspec:\n  selector:\n    matchLabels:\n      k8s-app: canal\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: canal\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: canal\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-canal.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              value: \"none\"\n            - name: CLUSTER_TYPE\n              value: \"k8s,canal\"\n            - name: FELIX_IPTABLESREFRESHINTERVAL\n              value: \"60\"\n            - name: IP\n              value: \"\"\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"192.168.0.0\/16\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: \/readiness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n        - name: kube-flannel\n          image: quay.io\/coreos\/flannel:v0.9.1\n          command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n          securityContext:\n            privileged: true\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: FLANNELD_IFACE\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: canal_iface\n            - name: FLANNELD_IP_MASQ\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: masquerade\n          volumeMounts:\n          - mountPath: \/run\/xtables.lock\n            name: xtables-lock\n            readOnly: false\n          - name: flannel-cfg\n            mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: flannel-cfg\n          configMap:\n            name: canal-config\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: canal\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: canal-flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: canal-calico\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/canal\/canal.yml\nkubectl create -f \/etc\/kubernetes\/addons\/canal\/canal.yml\n\nelif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]];then\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/calico\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  calico_backend: \"bird\"\n\n  veth_mtu: \"1440\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: calico-node\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-calico.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CNI_MTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s,bgp\"\n            - name: IP\n              value: \"autodetect\"\n            - name: CALICO_IPV4POOL_IPIP\n              value: \"Always\"\n            - name: FELIX_IPINIPMTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"@@{KUBE_CLUSTER_SUBNET}@@\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            exec:\n              command:\n              - \/bin\/calico-node\n              - -bird-ready\n              - -felix-ready\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPPeer\n    plural: bgppeers\n    singular: bgppeer\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/calico\/calico.yml\nkubectl create -f \/etc\/kubernetes\/addons\/calico\/calico.yml  \n\nelse\n  echo \"Defaulting to flannel\"\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n  - kind: ServiceAccount\n    name: flannel\n    namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"hairpinMode\": true,\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - \/opt\/bin\/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n          limits:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/bin\/sh\", \"-c\", \"set -e -x; cp -f \/etc\/kube-flannel\/cni-conf.json \/etc\/cni\/net.d\/10-flannel.conf; while true; do sleep 3600; done\" ]\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nfi\n\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"d805ac55-d0a5-457c-8124-bedc05e2b070","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n  - name: dns\n    port: 53\n    protocol: UDP\n  - name: dns-tcp\n    port: 53\n    protocol: TCP\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: k8s.gcr.io\/k8s-dns-kube-dns:1.14.13\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: k8s.gcr.io\/k8s-dns-dnsmasq-nanny:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --no-negcache\n        - --dns-loop-detect\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: k8s.gcr.io\/k8s-dns-sidecar:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local,5,SRV\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local,5,SRV\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy: Default\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.2.0\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          - --target=Deployment\/kube-dns\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"9070721a-1ddc-4336-84af-8f4b5222f0e0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nPRISM_CLUSTER_IP=\"@@{PE_CLUSTER_IP}@@\"\nPRISM_DATA_SERVICE_IP=\"@@{PE_CLUSTER_IP}@@\"\n\nif [[ (\"${PRISM_CLUSTER_IP}x\" == \"x\") && (\"${PRISM_DATA_SERVICE_IP}x\" == \"x\") ]]; then exit 0; fi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/volume_plugin\nNTNX_SECRET=$(echo -n \"@@{PE_USERNAME}@@:@@{PE_PASSWORD}@@\" | base64)\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: nutanixabs-provisioner-runner\n  namespace: kube-system\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumes\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumeclaims\"]\n    verbs: [\"get\", \"list\", \"watch\", \"update\"]\n  - apiGroups: [\"storage.k8s.io\"]\n    resources: [\"storageclasses\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"list\", \"watch\", \"create\", \"update\", \"patch\"]\n  - apiGroups: [\"\"]\n    resources: [\"services\"]\n    verbs: [\"get\"]\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"create\", \"delete\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: run-nutanixabs-provisioner\n  namespace: kube-system\nsubjects:\n  - kind: ServiceAccount\n    name: nutanixabs-provisioner\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: nutanixabs-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      labels:\n        app: nutanixabs-provisioner\n    spec:\n      serviceAccount: nutanixabs-provisioner\n      hostNetwork: true\n      containers:\n        -\n          image: \"ntnx\/nutanixabs-provisioner\"\n          name: nutanixabs-provisioner\n          args: [\"--v=4\"]\n          imagePullPolicy: IfNotPresent\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: kube-system\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\n---\nkind: StorageClass\napiVersion: storage.k8s.io\/v1\nmetadata:\n  name: silver \n  namespace: kube-system\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\nprovisioner: nutanix\/abs\nparameters:\n     prismEndPoint: @@{PE_CLUSTER_IP}@@:9440\n     dataServiceEndPoint: @@{PE_DATA_SERVICE_IP}@@:3260\n     secretName: ntnx-secret\n     storageContainer: @@{PE_CONTAINER_NAME}@@\n     fsType: ext4\n     chapAuthEnabled: \"false\"' | sudo tee \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\necho \"apiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: default\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\" | sudo tee -a \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"NVP Configuration"}],"description":"","message_list":[],"uuid":"b566cdff-86b4-4e54-a750-59de52ff15af","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"dac441af_dag_cloned_1","uuid":"42047288-c092-4490-9d35-8d8f5c2239e8"},"name":"8e760b73_runbook_cloned_0"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"},"retries":"0","description":"","type":"DAG","uuid":"ed711bea-3d69-4792-ad72-a0fa36ea05b2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6324786a_dag_cloned_1"}],"description":"","message_list":[],"uuid":"19face75-4a07-4275-a2b7-7a527b6afc94","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6324786a_dag_cloned_1","uuid":"ed711bea-3d69-4792-ad72-a0fa36ea05b2"},"name":"6522ac7a_runbook_cloned_0"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Uninstall_Crb_78d59e2e_ea58_482a_a2b2_6f593da4049e"}],"description":"","message_list":[],"uuid":"3fe526fc-375b-4cfb-8e10-d1106f31be90","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"081cb4b7-d7c5-4986-90c4-09402031762b"},"name":"SYS_GEN__Runbook_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"df103165-91a9-434b-b16b-da1c6b9ed99e","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"},"retries":"0","description":"","type":"DAG","uuid":"96fc6a39-93f8-45c7-8033-30fac814d208","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"169daae3-93ed-42da-a2e8-f51bf9cfe8cc"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"5a1ccb92-a88f-4d57-be3d-647cda016762"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"4031e0b3-9bc7-4e11-9496-fc02a1d00603"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"169daae3-93ed-42da-a2e8-f51bf9cfe8cc"},"edge_type":"inherent","type":"","uuid":"6b8b5d4c-c70c-4144-95b0-c73a19fef6fa","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"5a1ccb92-a88f-4d57-be3d-647cda016762"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"5a1ccb92-a88f-4d57-be3d-647cda016762"},"edge_type":"inherent","type":"","uuid":"9ad6362b-8aad-43b8-9e69-cc6eca647631","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"4031e0b3-9bc7-4e11-9496-fc02a1d00603"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"169daae3-93ed-42da-a2e8-f51bf9cfe8cc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5a1ccb92-a88f-4d57-be3d-647cda016762","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"7f713d48-74e9-4bb6-8dc9-eb8f00371ff3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4031e0b3-9bc7-4e11-9496-fc02a1d00603","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"3fe526fc-375b-4cfb-8e10-d1106f31be90"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e"}],"description":"","message_list":[],"uuid":"cc5c7797-0d3a-433d-8da2-16982f9a5167","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"96fc6a39-93f8-45c7-8033-30fac814d208"},"name":"SYS_GEN__Runbook_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"2acf8e91-666a-4f33-a7e9-1c27776a5dc8","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"},"retries":"0","description":"","type":"DAG","uuid":"89b06efc-ab15-4ded-bf69-5685a13646e2","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"3cc82c6a-6e7e-425b-89a4-8ff1603ce743"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"81062b51-8aa5-4361-b50f-0e5408d2bb84"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"3cc82c6a-6e7e-425b-89a4-8ff1603ce743"},"edge_type":"inherent","type":"","uuid":"c9c6874e-f541-42d7-8547-da0444329d35","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"81062b51-8aa5-4361-b50f-0e5408d2bb84"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3cc82c6a-6e7e-425b-89a4-8ff1603ce743","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"2064d305-852a-47aa-89b9-7415f90c2152"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"},{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"81062b51-8aa5-4361-b50f-0e5408d2bb84","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_78d59e2e_ea58_482a_a2b2_6f593da4049e"}],"description":"","message_list":[],"uuid":"ea75e93c-91da-4c82-aee5-8b5827351dbe","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"89b06efc-ab15-4ded-bf69-5685a13646e2"},"name":"SYS_GEN__Runbook_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e"}},{"description":"System action for starting an application","message_list":[],"uuid":"765efb68-80e4-452a-8682-5864b3a653fc","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"},"retries":"0","description":"","type":"DAG","uuid":"45bbf0fa-edf9-4c83-b8d3-9c4ac0777cb1","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"2e7823c3-64bd-4f64-af1c-9982b191f0b0"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2e7823c3-64bd-4f64-af1c-9982b191f0b0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"7a981276-5cb7-4f7b-b9cb-a26ebd31480a","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"45bbf0fa-edf9-4c83-b8d3-9c4ac0777cb1"},"name":"SYS_GEN__Runbook_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e"}},{"description":"System action for restarting an application","message_list":[],"uuid":"50a4c8ab-8c9a-4a66-93b4-c6a28cf43980","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"},"retries":"0","description":"","type":"DAG","uuid":"e3bfcaf3-30f3-4287-bc28-f865dbb2d41c","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"09c92333-ee8a-4560-91d4-65baa7aa16b2"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"09c92333-ee8a-4560-91d4-65baa7aa16b2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"ca8cec47-f6e6-4ffb-83f1-eb67ddbb98e2"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"e5353954-2091-4b5c-aba7-e71a8b6d897a","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"e3bfcaf3-30f3-4287-bc28-f865dbb2d41c"},"name":"SYS_GEN__Runbook_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e"}},{"description":"System action for stopping an application","message_list":[],"uuid":"8808c89a-1070-42f4-8bd9-c6e3626c6ca4","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"},"retries":"0","description":"","type":"DAG","uuid":"32f74ddb-31e8-4331-92f0-688776a967ac","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255","uuid":"c85924e7-6c83-468e-8564-740c87c22651"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c85924e7-6c83-468e-8564-740c87c22651","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"d47bda45-1029-453f-8f80-28216a9797e4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_cc7c6e36_2710_44cf_97bf_f5ef4cff2255"}],"description":"","message_list":[],"uuid":"99e8a505-c52f-4f46-8c39-d28010170fd4","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e","uuid":"32f74ddb-31e8-4331-92f0-688776a967ac"},"name":"SYS_GEN__Runbook_Package_78d59e2e_ea58_482a_a2b2_6f593da4049e"}}],"message_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"}],"uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e","state":"ACTIVE","version":"","editables":{},"type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"},"retries":"0","description":"","type":"DAG","uuid":"42047288-c092-4490-9d35-8d8f5c2239e8","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"84c2fa42-02fb-42c8-80b9-6195c0ea7907"},{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"5c9d1a9d-edad-4ea4-8d8b-81d7c704a1fc"},{"kind":"app_task","name":"Generate Certs","uuid":"9dc17daa-b875-4653-8e38-eb3795ac5761"},{"kind":"app_task","name":"Configure Services","uuid":"30196e17-512a-4c68-9c37-37f79d0fe550"},{"kind":"app_task","name":"Add User Roles","uuid":"2aa9af2f-5888-4b61-a973-dec61fae506a"},{"kind":"app_task","name":"Network Configuration","uuid":"e937e510-6931-49c9-adcd-5c1520077bf6"},{"kind":"app_task","name":"DNS Configuration","uuid":"d805ac55-d0a5-457c-8124-bedc05e2b070"},{"kind":"app_task","name":"NVP Configuration","uuid":"9070721a-1ddc-4336-84af-8f4b5222f0e0"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"84c2fa42-02fb-42c8-80b9-6195c0ea7907"},"edge_type":"user_defined","type":"","uuid":"b33230cb-473c-4359-8c19-f3169bd93b0c","to_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"5c9d1a9d-edad-4ea4-8d8b-81d7c704a1fc"}},{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"5c9d1a9d-edad-4ea4-8d8b-81d7c704a1fc"},"edge_type":"user_defined","type":"","uuid":"664f2f03-c5c8-476a-9813-7c867f54f56b","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"9dc17daa-b875-4653-8e38-eb3795ac5761"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"9dc17daa-b875-4653-8e38-eb3795ac5761"},"edge_type":"user_defined","type":"","uuid":"a6a6464f-9bde-4736-b77a-935ab0188d37","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"30196e17-512a-4c68-9c37-37f79d0fe550"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"30196e17-512a-4c68-9c37-37f79d0fe550"},"edge_type":"user_defined","type":"","uuid":"97a7b380-e840-4072-a4fb-5afcd7fb3dcf","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"2aa9af2f-5888-4b61-a973-dec61fae506a"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"2aa9af2f-5888-4b61-a973-dec61fae506a"},"edge_type":"user_defined","type":"","uuid":"31f20fbf-0aa5-4f3a-b480-88fb48d2f10d","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"e937e510-6931-49c9-adcd-5c1520077bf6"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"e937e510-6931-49c9-adcd-5c1520077bf6"},"edge_type":"user_defined","type":"","uuid":"6aa5d7f0-e9e7-42f6-a131-94dc90120fa5","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"d805ac55-d0a5-457c-8124-bedc05e2b070"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"d805ac55-d0a5-457c-8124-bedc05e2b070"},"edge_type":"user_defined","type":"","uuid":"db45a437-f025-42d7-81ea-bb5c23a19f8f","to_task_reference":{"kind":"app_task","name":"NVP Configuration","uuid":"9070721a-1ddc-4336-84af-8f4b5222f0e0"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"dac441af_dag_cloned_1"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"84c2fa42-02fb-42c8-80b9-6195c0ea7907","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"5c9d1a9d-edad-4ea4-8d8b-81d7c704a1fc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.3.12\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_IPS=\"@@{VMware_Centos_K8SW.address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} master${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"master${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  count=$((count+1))\ndone   \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate etcd \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/sd{e,f,g}\nsudo vgcreate docker \/dev\/sd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"9dc17daa-b875-4653-8e38-eb3795ac5761","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_IPS=\"@@{VMware_Centos_K8SW.address}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"master${count}\",\n  count=$((count+1))\ndone\n\nMASTER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"worker${count}\",\n  count=$((count+1))\ndone\nWORKER_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${MASTER_NAMES},${MASTER_IPS},${WORKER_NAMES},${WORKER_IPS},${FIRST_IP_SERVICE_SUBNET},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local -profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\ninstance=\"master${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=master${count}.kubeconfig\nkubectl config set-credentials system:node:master${count} --client-certificate=master${count}.pem --client-key=master${count}-key.pem --embed-certs=true --kubeconfig=master${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:master${count} --kubeconfig=master${count}.kubeconfig\nkubectl config use-context default --kubeconfig=master${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"master${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"30196e17-512a-4c68-9c37-37f79d0fe550","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nMASTER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${MASTER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=${KUBE_CLUSTER_NAME}\n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n    \necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"2aa9af2f-5888-4b61-a973-dec61fae506a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet iscsid\nsudo systemctl enable etcd docker kubelet iscsid\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem master* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n    echo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"e937e510-6931-49c9-adcd-5c1520077bf6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ]]; then\nsudo mkdir -p \/etc\/kubernetes\/addons\/canal\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: canal-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  canal_iface: \"\"\n\n  masquerade: \"true\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: canal\n  namespace: kube-system\n  labels:\n    k8s-app: canal\nspec:\n  selector:\n    matchLabels:\n      k8s-app: canal\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: canal\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: canal\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-canal.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              value: \"none\"\n            - name: CLUSTER_TYPE\n              value: \"k8s,canal\"\n            - name: FELIX_IPTABLESREFRESHINTERVAL\n              value: \"60\"\n            - name: IP\n              value: \"\"\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"192.168.0.0\/16\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: \/readiness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n        - name: kube-flannel\n          image: quay.io\/coreos\/flannel:v0.9.1\n          command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n          securityContext:\n            privileged: true\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: FLANNELD_IFACE\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: canal_iface\n            - name: FLANNELD_IP_MASQ\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: masquerade\n          volumeMounts:\n          - mountPath: \/run\/xtables.lock\n            name: xtables-lock\n            readOnly: false\n          - name: flannel-cfg\n            mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: flannel-cfg\n          configMap:\n            name: canal-config\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: canal\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: canal-flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: canal-calico\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/canal\/canal.yml\nkubectl create -f \/etc\/kubernetes\/addons\/canal\/canal.yml\n\nelif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]];then\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/calico\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  calico_backend: \"bird\"\n\n  veth_mtu: \"1440\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: calico-node\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-calico.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CNI_MTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s,bgp\"\n            - name: IP\n              value: \"autodetect\"\n            - name: CALICO_IPV4POOL_IPIP\n              value: \"Always\"\n            - name: FELIX_IPINIPMTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"@@{KUBE_CLUSTER_SUBNET}@@\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            exec:\n              command:\n              - \/bin\/calico-node\n              - -bird-ready\n              - -felix-ready\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPPeer\n    plural: bgppeers\n    singular: bgppeer\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/calico\/calico.yml\nkubectl create -f \/etc\/kubernetes\/addons\/calico\/calico.yml  \n\nelse\n  echo \"Defaulting to flannel\"\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n  - kind: ServiceAccount\n    name: flannel\n    namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"hairpinMode\": true,\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - \/opt\/bin\/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n          limits:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/bin\/sh\", \"-c\", \"set -e -x; cp -f \/etc\/kube-flannel\/cni-conf.json \/etc\/cni\/net.d\/10-flannel.conf; while true; do sleep 3600; done\" ]\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nfi\n\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"d805ac55-d0a5-457c-8124-bedc05e2b070","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n  - name: dns\n    port: 53\n    protocol: UDP\n  - name: dns-tcp\n    port: 53\n    protocol: TCP\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: k8s.gcr.io\/k8s-dns-kube-dns:1.14.13\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: k8s.gcr.io\/k8s-dns-dnsmasq-nanny:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --no-negcache\n        - --dns-loop-detect\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: k8s.gcr.io\/k8s-dns-sidecar:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local,5,SRV\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local,5,SRV\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy: Default\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.2.0\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          - --target=Deployment\/kube-dns\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","description":"","type":"EXEC","uuid":"9070721a-1ddc-4336-84af-8f4b5222f0e0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nPRISM_CLUSTER_IP=\"@@{PE_CLUSTER_IP}@@\"\nPRISM_DATA_SERVICE_IP=\"@@{PE_CLUSTER_IP}@@\"\n\nif [[ (\"${PRISM_CLUSTER_IP}x\" == \"x\") && (\"${PRISM_DATA_SERVICE_IP}x\" == \"x\") ]]; then exit 0; fi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/volume_plugin\nNTNX_SECRET=$(echo -n \"@@{PE_USERNAME}@@:@@{PE_PASSWORD}@@\" | base64)\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: nutanixabs-provisioner-runner\n  namespace: kube-system\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumes\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumeclaims\"]\n    verbs: [\"get\", \"list\", \"watch\", \"update\"]\n  - apiGroups: [\"storage.k8s.io\"]\n    resources: [\"storageclasses\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"list\", \"watch\", \"create\", \"update\", \"patch\"]\n  - apiGroups: [\"\"]\n    resources: [\"services\"]\n    verbs: [\"get\"]\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"create\", \"delete\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: run-nutanixabs-provisioner\n  namespace: kube-system\nsubjects:\n  - kind: ServiceAccount\n    name: nutanixabs-provisioner\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: nutanixabs-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      labels:\n        app: nutanixabs-provisioner\n    spec:\n      serviceAccount: nutanixabs-provisioner\n      hostNetwork: true\n      containers:\n        -\n          image: \"ntnx\/nutanixabs-provisioner\"\n          name: nutanixabs-provisioner\n          args: [\"--v=4\"]\n          imagePullPolicy: IfNotPresent\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: kube-system\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\n---\nkind: StorageClass\napiVersion: storage.k8s.io\/v1\nmetadata:\n  name: silver \n  namespace: kube-system\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\nprovisioner: nutanix\/abs\nparameters:\n     prismEndPoint: @@{PE_CLUSTER_IP}@@:9440\n     dataServiceEndPoint: @@{PE_DATA_SERVICE_IP}@@:3260\n     secretName: ntnx-secret\n     storageContainer: @@{PE_CONTAINER_NAME}@@\n     fsType: ext4\n     chapAuthEnabled: \"false\"' | sudo tee \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\necho \"apiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: default\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\" | sudo tee -a \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"NVP Configuration"}],"description":"","message_list":[],"uuid":"b566cdff-86b4-4e54-a750-59de52ff15af","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"dac441af_dag_cloned_1","uuid":"42047288-c092-4490-9d35-8d8f5c2239e8"},"name":"8e760b73_runbook_cloned_0"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"},"retries":"0","description":"","type":"DAG","uuid":"ed711bea-3d69-4792-ad72-a0fa36ea05b2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6324786a_dag_cloned_1"}],"description":"","message_list":[],"uuid":"19face75-4a07-4275-a2b7-7a527b6afc94","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6324786a_dag_cloned_1","uuid":"ed711bea-3d69-4792-ad72-a0fa36ea05b2"},"name":"6522ac7a_runbook_cloned_0"}},"variable_list":[],"name":"VMware_Centos_K8SM_Package"},{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"d7440a07-0040-4f19-aaa6-8c5c67e980a8","name":"action_install","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"},"retries":"0","description":"","type":"DAG","uuid":"440f8b32-191d-4c32-aa9b-4abb7cdc0303","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Install_Crb_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"5345f2de-c445-49b9-9ea8-034cf41895a0"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_f749fc63_17aa_4814_a56b_c45ca8be030e"},{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_INSTALL","uuid":"5345f2de-c445-49b9-9ea8-034cf41895a0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"},"retries":"0","description":"","type":"DAG","uuid":"fc3253c9-49fc-42e0-a1c6-69b9fd784fad","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"58afc9b7-6344-44f7-8120-66344159c43c"},{"kind":"app_task","name":"Docker Kubelet Install","uuid":"ef55dc25-331e-467b-8a75-93e52a3a9196"},{"kind":"app_task","name":"GetCerts","uuid":"2df62ed9-2fce-4797-99bb-19a885acd436"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"58afc9b7-6344-44f7-8120-66344159c43c"},"edge_type":"user_defined","type":"","uuid":"eb4975a9-1417-4655-9682-e07eece42cc3","to_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"ef55dc25-331e-467b-8a75-93e52a3a9196"}},{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"ef55dc25-331e-467b-8a75-93e52a3a9196"},"edge_type":"user_defined","type":"","uuid":"446e72a6-a593-4d15-8747-09aa5e195b77","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"2df62ed9-2fce-4797-99bb-19a885acd436"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"c1566b3d_dag_cloned_1"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"58afc9b7-6344-44f7-8120-66344159c43c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"ef55dc25-331e-467b-8a75-93e52a3a9196","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{VMware_Centos_K8SM.address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"2df62ed9-2fce-4797-99bb-19a885acd436","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{VMware_Centos_K8SM.address[0]}@@\"\nINSTANCE_IP=\"@@{address}@@\"\ninstance=\"worker@@{calm_array_index}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nsudo systemctl start iscsid\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; if [[ $count -eq 600 ]]; then echo \"failed to download certs\" && exit 1; fi; count=$(($count+5)) ; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${instance} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${instance} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"29817be6-faed-456b-bd8f-baad608aee10","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"c1566b3d_dag_cloned_1","uuid":"fc3253c9-49fc-42e0-a1c6-69b9fd784fad"},"name":"9a6e189b_runbook_cloned_0"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"},"retries":"0","description":"","type":"DAG","uuid":"c187a944-a8fe-4a59-b985-7ad2d7737044","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"6f7ba9c2-106d-4b02-901a-1a72e4921915"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"abd3357c_dag_cloned_1"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"6f7ba9c2-106d-4b02-901a-1a72e4921915","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain 'worker@@{calm_array_index}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node 'worker@@{calm_array_index}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"b72aa6c1-199c-4e8e-9489-f9337ee518b9","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"abd3357c_dag_cloned_1","uuid":"c187a944-a8fe-4a59-b985-7ad2d7737044"},"name":"3cb17acf_runbook_cloned_0"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Install_Crb_f749fc63_17aa_4814_a56b_c45ca8be030e"}],"description":"","message_list":[],"uuid":"3e21f753-bc67-4e4c-81bf-17ff5ace0f8c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"440f8b32-191d-4c32-aa9b-4abb7cdc0303"},"name":"SYS_GEN__Runbook_Package_f749fc63_17aa_4814_a56b_c45ca8be030e"}},{"description":"System action for creating an application","message_list":[],"uuid":"7da33e2c-23c4-4ebe-858d-7370a7baf363","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"},"retries":"0","description":"","type":"DAG","uuid":"aaf179f4-70b1-4de0-934c-d2abd2d9fb14","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"da0ff633-8bb1-40a2-bfa8-5e8799a8af94"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"b6d527e7-d133-40ba-8ea6-f1446c8a9d17"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"5c97f277-3890-4f0f-b7d7-973ccf4c41af"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"b6d527e7-d133-40ba-8ea6-f1446c8a9d17"},"edge_type":"inherent","type":"","uuid":"2a450912-b82d-4c85-93df-611f8535d35a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"5c97f277-3890-4f0f-b7d7-973ccf4c41af"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"da0ff633-8bb1-40a2-bfa8-5e8799a8af94"},"edge_type":"inherent","type":"","uuid":"acfe48fb-b899-45f1-bb46-b0eb5c27bafc","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"b6d527e7-d133-40ba-8ea6-f1446c8a9d17"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_f749fc63_17aa_4814_a56b_c45ca8be030e"},{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"da0ff633-8bb1-40a2-bfa8-5e8799a8af94","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"3e21f753-bc67-4e4c-81bf-17ff5ace0f8c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_f749fc63_17aa_4814_a56b_c45ca8be030e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b6d527e7-d133-40ba-8ea6-f1446c8a9d17","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"cca906a5-5e79-422e-b15f-7391a907ad07"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5c97f277-3890-4f0f-b7d7-973ccf4c41af","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"72849b17-0ae0-4b10-899b-708a67b5af1a","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"aaf179f4-70b1-4de0-934c-d2abd2d9fb14"},"name":"SYS_GEN__Runbook_Package_f749fc63_17aa_4814_a56b_c45ca8be030e"}},{"description":"System action for uninstalling an application","message_list":[],"uuid":"668af134-ab8e-4ba7-b2b8-e5b1fdd5ec17","name":"action_uninstall","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"},"retries":"0","description":"","type":"DAG","uuid":"1f373e85-d412-4961-81b1-747ce7c62d7a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Uninstall_Crb_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"957ae7df-e80d-4563-ae67-e6fba140fe40"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_f749fc63_17aa_4814_a56b_c45ca8be030e"},{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_UNINSTALL","uuid":"957ae7df-e80d-4563-ae67-e6fba140fe40","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"},"retries":"0","description":"","type":"DAG","uuid":"fc3253c9-49fc-42e0-a1c6-69b9fd784fad","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"58afc9b7-6344-44f7-8120-66344159c43c"},{"kind":"app_task","name":"Docker Kubelet Install","uuid":"ef55dc25-331e-467b-8a75-93e52a3a9196"},{"kind":"app_task","name":"GetCerts","uuid":"2df62ed9-2fce-4797-99bb-19a885acd436"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"58afc9b7-6344-44f7-8120-66344159c43c"},"edge_type":"user_defined","type":"","uuid":"eb4975a9-1417-4655-9682-e07eece42cc3","to_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"ef55dc25-331e-467b-8a75-93e52a3a9196"}},{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"ef55dc25-331e-467b-8a75-93e52a3a9196"},"edge_type":"user_defined","type":"","uuid":"446e72a6-a593-4d15-8747-09aa5e195b77","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"2df62ed9-2fce-4797-99bb-19a885acd436"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"c1566b3d_dag_cloned_1"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"58afc9b7-6344-44f7-8120-66344159c43c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"ef55dc25-331e-467b-8a75-93e52a3a9196","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{VMware_Centos_K8SM.address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"2df62ed9-2fce-4797-99bb-19a885acd436","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{VMware_Centos_K8SM.address[0]}@@\"\nINSTANCE_IP=\"@@{address}@@\"\ninstance=\"worker@@{calm_array_index}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nsudo systemctl start iscsid\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; if [[ $count -eq 600 ]]; then echo \"failed to download certs\" && exit 1; fi; count=$(($count+5)) ; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${instance} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${instance} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"29817be6-faed-456b-bd8f-baad608aee10","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"c1566b3d_dag_cloned_1","uuid":"fc3253c9-49fc-42e0-a1c6-69b9fd784fad"},"name":"9a6e189b_runbook_cloned_0"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"},"retries":"0","description":"","type":"DAG","uuid":"c187a944-a8fe-4a59-b985-7ad2d7737044","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"6f7ba9c2-106d-4b02-901a-1a72e4921915"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"abd3357c_dag_cloned_1"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"6f7ba9c2-106d-4b02-901a-1a72e4921915","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain 'worker@@{calm_array_index}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node 'worker@@{calm_array_index}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"b72aa6c1-199c-4e8e-9489-f9337ee518b9","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"abd3357c_dag_cloned_1","uuid":"c187a944-a8fe-4a59-b985-7ad2d7737044"},"name":"3cb17acf_runbook_cloned_0"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Uninstall_Crb_f749fc63_17aa_4814_a56b_c45ca8be030e"}],"description":"","message_list":[],"uuid":"d28d4dd3-fd12-4200-afe4-2f9ef7fe25c8","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"1f373e85-d412-4961-81b1-747ce7c62d7a"},"name":"SYS_GEN__Runbook_Package_f749fc63_17aa_4814_a56b_c45ca8be030e"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"a83973a6-afa0-4dac-84c5-0625bdce33c5","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"},"retries":"0","description":"","type":"DAG","uuid":"956e11de-2124-4503-859e-1fe0f54e7298","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"d4c6f2c1-113e-4c5b-8c8d-e398e1e6a2e2"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"2da7d962-cddc-4b8d-ab14-c6028ff3a903"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"ba65f1f2-7126-4584-b588-26065243fbbe"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"d4c6f2c1-113e-4c5b-8c8d-e398e1e6a2e2"},"edge_type":"inherent","type":"","uuid":"b21f1b4f-48e2-43d5-a9d3-d38fbce0c034","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"2da7d962-cddc-4b8d-ab14-c6028ff3a903"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"2da7d962-cddc-4b8d-ab14-c6028ff3a903"},"edge_type":"inherent","type":"","uuid":"fd9ebf96-adb9-4cf7-861d-c885282bb7f1","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"ba65f1f2-7126-4584-b588-26065243fbbe"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_f749fc63_17aa_4814_a56b_c45ca8be030e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d4c6f2c1-113e-4c5b-8c8d-e398e1e6a2e2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2da7d962-cddc-4b8d-ab14-c6028ff3a903","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"843ab0a6-03bd-4b9c-8f56-7d852e9348e0"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ba65f1f2-7126-4584-b588-26065243fbbe","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"d28d4dd3-fd12-4200-afe4-2f9ef7fe25c8"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_f749fc63_17aa_4814_a56b_c45ca8be030e"}],"description":"","message_list":[],"uuid":"16a971cd-691d-4d43-888a-8749c5718cae","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"956e11de-2124-4503-859e-1fe0f54e7298"},"name":"SYS_GEN__Runbook_Package_f749fc63_17aa_4814_a56b_c45ca8be030e"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"83ad876b-8fea-4a11-b0c4-5db1f348fb33","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"},"retries":"0","description":"","type":"DAG","uuid":"b29b6c69-d388-4711-8cc2-6d94d77d403f","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"9c3d2b90-623d-4442-9eee-67cace0c03c2"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"0ce73401-97d7-4e33-8359-0b0e7d69848a"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"9c3d2b90-623d-4442-9eee-67cace0c03c2"},"edge_type":"inherent","type":"","uuid":"53662c9d-c53b-40ce-a038-5785750612a2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"0ce73401-97d7-4e33-8359-0b0e7d69848a"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_f749fc63_17aa_4814_a56b_c45ca8be030e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"9c3d2b90-623d-4442-9eee-67cace0c03c2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"716ea7a7-bc0c-4ac5-ab9c-720c327a498e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"},{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"0ce73401-97d7-4e33-8359-0b0e7d69848a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_f749fc63_17aa_4814_a56b_c45ca8be030e"}],"description":"","message_list":[],"uuid":"2ea5d294-bd84-4ae1-b15e-52387b8a9eec","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"b29b6c69-d388-4711-8cc2-6d94d77d403f"},"name":"SYS_GEN__Runbook_Package_f749fc63_17aa_4814_a56b_c45ca8be030e"}},{"description":"System action for starting an application","message_list":[],"uuid":"3a2d20ed-ae34-4248-a8e4-cbcc0364931b","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"},"retries":"0","description":"","type":"DAG","uuid":"c46d1311-0837-45b6-825e-6edeabcb0a4a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"58f7996f-b51c-4e47-995e-ea752aeaff28"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_f749fc63_17aa_4814_a56b_c45ca8be030e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"58f7996f-b51c-4e47-995e-ea752aeaff28","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"0a3321b4-b3f0-4094-85c0-ddb71fe0d986","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"c46d1311-0837-45b6-825e-6edeabcb0a4a"},"name":"SYS_GEN__Runbook_Package_f749fc63_17aa_4814_a56b_c45ca8be030e"}},{"description":"System action for restarting an application","message_list":[],"uuid":"60593e99-a112-4d44-92be-fa7ef60588d5","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"},"retries":"0","description":"","type":"DAG","uuid":"c562c610-a38f-48b4-ad5b-9489e5a3915b","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"9476d8c6-4b13-4b52-9cee-1eba50cad192"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_f749fc63_17aa_4814_a56b_c45ca8be030e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"9476d8c6-4b13-4b52-9cee-1eba50cad192","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"ce602c49-d9cd-44d7-8e10-5671dc407b8b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"4aed3cce-9939-485c-a1b3-377d03135d7a","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"c562c610-a38f-48b4-ad5b-9489e5a3915b"},"name":"SYS_GEN__Runbook_Package_f749fc63_17aa_4814_a56b_c45ca8be030e"}},{"description":"System action for stopping an application","message_list":[],"uuid":"31fcd107-cfa2-4b15-ba95-3d262c115ada","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"},"retries":"0","description":"","type":"DAG","uuid":"fcf433c6-e6b2-4f7c-b86f-ffdf66e532fb","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962","uuid":"1c5b11f0-a005-4189-b6e2-d6ecfc8c28d8"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_f749fc63_17aa_4814_a56b_c45ca8be030e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1c5b11f0-a005-4189-b6e2-d6ecfc8c28d8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_045659a2_932c_49c8_9269_3a911f955962"}],"description":"","message_list":[],"uuid":"e4b57219-9438-4ee1-abb5-67e6cbd8249b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_f749fc63_17aa_4814_a56b_c45ca8be030e","uuid":"fcf433c6-e6b2-4f7c-b86f-ffdf66e532fb"},"name":"SYS_GEN__Runbook_Package_f749fc63_17aa_4814_a56b_c45ca8be030e"}}],"message_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"}],"uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e","state":"ACTIVE","version":"","editables":{},"type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"},"retries":"0","description":"","type":"DAG","uuid":"fc3253c9-49fc-42e0-a1c6-69b9fd784fad","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"58afc9b7-6344-44f7-8120-66344159c43c"},{"kind":"app_task","name":"Docker Kubelet Install","uuid":"ef55dc25-331e-467b-8a75-93e52a3a9196"},{"kind":"app_task","name":"GetCerts","uuid":"2df62ed9-2fce-4797-99bb-19a885acd436"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"58afc9b7-6344-44f7-8120-66344159c43c"},"edge_type":"user_defined","type":"","uuid":"eb4975a9-1417-4655-9682-e07eece42cc3","to_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"ef55dc25-331e-467b-8a75-93e52a3a9196"}},{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"ef55dc25-331e-467b-8a75-93e52a3a9196"},"edge_type":"user_defined","type":"","uuid":"446e72a6-a593-4d15-8747-09aa5e195b77","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"2df62ed9-2fce-4797-99bb-19a885acd436"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"c1566b3d_dag_cloned_1"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"58afc9b7-6344-44f7-8120-66344159c43c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"ef55dc25-331e-467b-8a75-93e52a3a9196","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{VMware_Centos_K8SM.address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"2df62ed9-2fce-4797-99bb-19a885acd436","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{VMware_Centos_K8SM.address[0]}@@\"\nINSTANCE_IP=\"@@{address}@@\"\ninstance=\"worker@@{calm_array_index}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nsudo systemctl start iscsid\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; if [[ $count -eq 600 ]]; then echo \"failed to download certs\" && exit 1; fi; count=$(($count+5)) ; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${instance} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${instance} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"29817be6-faed-456b-bd8f-baad608aee10","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"c1566b3d_dag_cloned_1","uuid":"fc3253c9-49fc-42e0-a1c6-69b9fd784fad"},"name":"9a6e189b_runbook_cloned_0"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"},"retries":"0","description":"","type":"DAG","uuid":"c187a944-a8fe-4a59-b985-7ad2d7737044","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"6f7ba9c2-106d-4b02-901a-1a72e4921915"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"abd3357c_dag_cloned_1"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","description":"","type":"EXEC","uuid":"6f7ba9c2-106d-4b02-901a-1a72e4921915","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain 'worker@@{calm_array_index}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node 'worker@@{calm_array_index}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"b72aa6c1-199c-4e8e-9489-f9337ee518b9","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"abd3357c_dag_cloned_1","uuid":"c187a944-a8fe-4a59-b985-7ad2d7737044"},"name":"3cb17acf_runbook_cloned_0"}},"variable_list":[],"name":"VMware_Centos_K8SW_Package"},{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"a8342d0a-2043-4f03-bed1-1ebabd3750a7","name":"action_install","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"ESX_CENTOS_76","uuid":"8fb1dd88-fcf1-444f-a5bb-d5482c87170f"},"retries":"0","description":"","type":"DAG","uuid":"dc25c826-adb3-42ac-8029-0abb8f9f45cc","child_tasks_local_reference_list":[{"kind":"app_task","name":"Image Fetch task for VM","uuid":"99644a15-5fe0-490b-a417-b677e45fa7d2"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f"},{"target_any_local_reference":{"kind":"app_package","name":"ESX_CENTOS_76","uuid":"8fb1dd88-fcf1-444f-a5bb-d5482c87170f"},"retries":"0","description":"","type":"SUBSTRATE_IMAGE_FETCH","uuid":"99644a15-5fe0-490b-a417-b677e45fa7d2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"","name":"CENTOS_76","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/filer.dev.eng.nutanix.com:8080\/GoldImages\/NuCalm\/Ova%20files\/CentOS-7-x86_64-1810.ova","version":{"product_version":"","type":"","product_name":""},"architecture":"X86_64","type":""},"description":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Image Fetch task for VM"}],"description":"","message_list":[],"uuid":"703f1b91-0a54-4823-8853-57d5ce0f664c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f","uuid":"dc25c826-adb3-42ac-8029-0abb8f9f45cc"},"name":"SYS_GEN__Runbook_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f"}},{"description":"System action for creating an application","message_list":[],"uuid":"88c559b9-81fd-4967-98aa-45d4267125f8","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"ESX_CENTOS_76","uuid":"8fb1dd88-fcf1-444f-a5bb-d5482c87170f"},"retries":"0","description":"","type":"DAG","uuid":"fb6efbb5-ab3e-42c5-9b53-14cc05033314","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f","uuid":"c840d613-07c1-42d3-82a3-008141695ff7"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f"},{"target_any_local_reference":{"kind":"app_package","name":"ESX_CENTOS_76","uuid":"8fb1dd88-fcf1-444f-a5bb-d5482c87170f"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c840d613-07c1-42d3-82a3-008141695ff7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f","uuid":"703f1b91-0a54-4823-8853-57d5ce0f664c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f"}],"description":"","message_list":[],"uuid":"a5d88fc3-3058-4dcd-93ca-995233da3383","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f","uuid":"fb6efbb5-ab3e-42c5-9b53-14cc05033314"},"name":"SYS_GEN__Runbook_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f"}},{"description":"System action for starting an application","message_list":[],"uuid":"3520698b-c037-4792-a5d9-6ac5fdea70ab","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"ESX_CENTOS_76","uuid":"8fb1dd88-fcf1-444f-a5bb-d5482c87170f"},"retries":"0","description":"","type":"DAG","uuid":"fab57040-dd1a-4821-bf63-e8a0e0c58d90","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f"}],"description":"","message_list":[],"uuid":"9d216f6c-9a82-41ae-87cf-63f50c26c75c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f","uuid":"fab57040-dd1a-4821-bf63-e8a0e0c58d90"},"name":"SYS_GEN__Runbook_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f"}},{"description":"System action for restarting an application","message_list":[],"uuid":"f0098c15-32c4-41c1-9721-23bd715cdc58","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"ESX_CENTOS_76","uuid":"8fb1dd88-fcf1-444f-a5bb-d5482c87170f"},"retries":"0","description":"","type":"DAG","uuid":"0b6ae81a-0a6f-40ce-bbb5-d16f28c31a52","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f"}],"description":"","message_list":[],"uuid":"a2b65b13-c8e9-4d8e-9623-38884d073890","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f","uuid":"0b6ae81a-0a6f-40ce-bbb5-d16f28c31a52"},"name":"SYS_GEN__Runbook_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f"}},{"description":"System action for stopping an application","message_list":[],"uuid":"2c9e8810-2803-400f-ac61-25376e8690ac","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"ESX_CENTOS_76","uuid":"8fb1dd88-fcf1-444f-a5bb-d5482c87170f"},"retries":"0","description":"","type":"DAG","uuid":"ec540ea3-051f-4f29-908e-1352bb543063","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f"}],"description":"","message_list":[],"uuid":"0cd8ac0c-fe8d-4de1-9f27-533098eabf0b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f","uuid":"ec540ea3-051f-4f29-908e-1352bb543063"},"name":"SYS_GEN__Runbook_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"2bbb17b2-4190-4b94-b3f0-3a6faad62daa","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"ESX_CENTOS_76","uuid":"8fb1dd88-fcf1-444f-a5bb-d5482c87170f"},"retries":"0","description":"","type":"DAG","uuid":"658eb644-6343-4920-bf37-8db06ec51b1b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f"}],"description":"","message_list":[],"uuid":"e0c41d49-9b67-4bb8-8c2e-efe1f850e4f3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f","uuid":"658eb644-6343-4920-bf37-8db06ec51b1b"},"name":"SYS_GEN__Runbook_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"efda5c1e-2ee8-42fc-952a-18f5accc0142","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"ESX_CENTOS_76","uuid":"8fb1dd88-fcf1-444f-a5bb-d5482c87170f"},"retries":"0","description":"","type":"DAG","uuid":"43cb7cc3-7378-4818-873a-87974a3a6fb5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f"}],"description":"","message_list":[],"uuid":"77801075-55f4-454f-809d-e50c93e5b011","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f","uuid":"43cb7cc3-7378-4818-873a-87974a3a6fb5"},"name":"SYS_GEN__Runbook_Package_8fb1dd88_fcf1_444f_a5bb_d5482c87170f"}}],"message_list":[],"service_local_reference_list":[],"uuid":"8fb1dd88-fcf1-444f-a5bb-d5482c87170f","state":"ACTIVE","version":"","editables":{},"type":"SUBSTRATE_IMAGE","options":{"type":"","name":"CENTOS_76","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/filer.dev.eng.nutanix.com:8080\/GoldImages\/NuCalm\/Ova%20files\/CentOS-7-x86_64-1810.ova","version":{"product_version":"","type":"","product_name":""},"architecture":"X86_64","type":""},"description":""},"variable_list":[],"name":"ESX_CENTOS_76"}]},"name":"Kubernetes"},"spec":{"name":"Kubernetes","resources":{"service_definition_list":[{"singleton":false,"name":"Kubernetes_Master","action_list":[{"description":"System action for creating an application","name":"action_create","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"8390c360-30b9-4219-9311-c1f35a4ca40f","child_tasks_local_reference_list":[{"kind":"app_task","name":"Dashboard","uuid":"5ce1c190-3f1e-4bb8-bd10-1e62555a40a0"},{"kind":"app_task","name":"HELM","uuid":"0fc9610c-0fa4-4b6e-bd04-5813c5fb5bba"},{"kind":"app_task","name":"Heapster","uuid":"43a62154-c1c9-47ec-867d-710a5bc4d44d"}],"attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Dashboard","uuid":"5ce1c190-3f1e-4bb8-bd10-1e62555a40a0"},"edge_type":"user_defined","type":"","uuid":"d6df22f4-82c0-411f-a8ef-874bc4b4b9f4","to_task_reference":{"kind":"app_task","name":"HELM","uuid":"0fc9610c-0fa4-4b6e-bd04-5813c5fb5bba"}},{"from_task_reference":{"kind":"app_task","name":"HELM","uuid":"0fc9610c-0fa4-4b6e-bd04-5813c5fb5bba"},"edge_type":"user_defined","type":"","uuid":"8c216cc0-472a-41af-9a4b-a14cf363af94","to_task_reference":{"kind":"app_task","name":"Heapster","uuid":"43a62154-c1c9-47ec-867d-710a5bc4d44d"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"f33eac3f_dag"},{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"5ce1c190-3f1e-4bb8-bd10-1e62555a40a0","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/dashboard\necho '# Copyright 2015 Google Inc. All Rights Reserved.\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#     http:\/\/www.apache.org\/licenses\/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\n# Configuration to deploy release version of the Dashboard UI compatible with\n# Kubernetes 1.7.\n#\n# Example usage: kubectl create -f <this_file>\n\n# ------------------- Dashboard Secret ------------------- #\n\napiVersion: v1\nkind: Secret\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard-certs\n  namespace: kube-system\ntype: Opaque\n\n---\n# ------------------- Dashboard Service Account ------------------- #\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\n\n---\n# ------------------- Dashboard Role & Role Binding ------------------- #\n\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: kubernetes-full-access\n  namespace: kube-system\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: kubernetes-dashboard\n  namespace: kube-system\n\n---\n# ------------------- Dashboard Deployment ------------------- #\n\nkind: Deployment\napiVersion: apps\/v1beta2\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\nspec:\n  replicas: 1\n  revisionHistoryLimit: 10\n  selector:\n    matchLabels:\n      k8s-app: kubernetes-dashboard\n  template:\n    metadata:\n      labels:\n        k8s-app: kubernetes-dashboard\n    spec:\n      containers:\n      - name: kubernetes-dashboard\n        image: k8s.gcr.io\/kubernetes-dashboard-amd64:v1.10.1\n        ports:\n        - containerPort: 8443\n          protocol: TCP\n        args:\n          - --auto-generate-certificates\n          # Uncomment the following line to manually specify Kubernetes API server Host\n          # If not specified, Dashboard will attempt to auto discover the API server and connect\n          # to it. Uncomment only if the default does not work.\n          # - --apiserver-host=http:\/\/my-address:port\n        volumeMounts:\n        - name: kubernetes-dashboard-certs\n          mountPath: \/certs\n          # Create on-disk volume to store exec logs\n        - mountPath: \/tmp\n          name: tmp-volume\n        livenessProbe:\n          httpGet:\n            scheme: HTTPS\n            path: \/\n            port: 8443\n          initialDelaySeconds: 30\n          timeoutSeconds: 30\n      volumes:\n      - name: kubernetes-dashboard-certs\n        secret:\n          secretName: kubernetes-dashboard-certs\n      - name: tmp-volume\n        emptyDir: {}\n      serviceAccountName: kubernetes-dashboard\n      # Comment the following tolerations if Dashboard must not be deployed on master\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        effect: NoSchedule\n\n---\n# ------------------- Dashboard Service ------------------- #\n\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\nspec:\n  type: NodePort\n  ports:\n    - port: 8443\n      nodePort: 30443\n  selector:\n    k8s-app: kubernetes-dashboard' | sudo tee \/etc\/kubernetes\/addons\/dashboard\/kubernetes-dashboard.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/dashboard\/kubernetes-dashboard.yaml\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Dashboard"},{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"0fc9610c-0fa4-4b6e-bd04-5813c5fb5bba","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir \/etc\/kubernetes\/addons\/helm\necho \"#helm init --service-account helm\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: helm\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: helm\n  namespace: kube-system\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: helm\n  namespace: kube-system\" | sudo tee \/etc\/kubernetes\/addons\/helm\/helm.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/helm\/helm.yaml\nhelm init --service-account helm\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"HELM"},{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"43a62154-c1c9-47ec-867d-710a5bc4d44d","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir \/etc\/kubernetes\/addons\/heapster\nkubectl delete ClusterRole system:heapster -n kube-system\n\necho 'apiVersion: rbac.authorization.k8s.io\/v1\nkind: ClusterRole\nmetadata:\n  name: system:heapster\n  namespace: kube-system\nrules:\n- apiGroups:\n  - \"\"\n  resources:\n  - events\n  - namespaces\n  - nodes\n  - pods\n  verbs:\n  - get\n  - list\n  - watch\n- apiGroups:\n  - \"\"\n  resources:\n  - nodes\/stats\n  verbs:\n  - get\n- apiGroups:\n  - extensions\n  resources:\n  - deployments\n  verbs:\n  - get\n  - list\n  - watch\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: heapster\n  namespace: kube-system\n  labels:\n    k8s-app: heapster\n    module: apiserver\n    version: v6\nspec:\n  selector:\n    matchLabels:\n      k8s-app: heapster\n      module: apiserver\n      version: v6\n  template:\n    metadata:\n      name: heapster\n      labels:\n        k8s-app: heapster\n        module: apiserver\n        version: v6\n    spec:\n      serviceAccountName: heapster\n      containers:\n      - name: heapster\n        image: k8s.gcr.io\/heapster-amd64:v1.5.3\n        command:\n        - \/heapster\n        - --source=kubernetes.summary_api:\"\"?useServiceAccount=true&kubeletHttps=true&kubeletPort=10250&insecure=true\n        ports:\n        - containerPort: 6443\n          name: https\n        - containerPort: 8080\n          name: http\n        volumeMounts:\n        - name: ssl-certs\n          mountPath: \/etc\/ssl\/certs\n          readOnly: true\n      volumes:\n      - name: ssl-certs\n        hostPath:\n          path: \/etc\/ssl\/certs\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: heapster\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n---\nkind: Service\napiVersion: v1\nmetadata:\n  name: heapster\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    kubernetes.io\/name: \"Heapster\"\n    k8s-app: heapster\nspec:\n  ports:\n    - port: 80\n      targetPort: 8082\n  selector:\n    k8s-app: heapster\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: heapster\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: heapster\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/heapster\/heapster.yaml\n  \nkubectl create -f \/etc\/kubernetes\/addons\/heapster\/heapster.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Heapster"}],"description":"","uuid":"384cf3d8-e940-43f1-a289-6c6b363c5371","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"f33eac3f_dag","uuid":"8390c360-30b9-4219-9311-c1f35a4ca40f"},"name":"a9639da1_runbook"},"type":"system","uuid":"cac576ea-239c-4acf-973c-d9b4069814d4"},{"description":"System action for deleting an application. Deletes created VMs as well","name":"action_delete","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"df8b9349-996c-4dc9-af64-e4707640efb4","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"62a92d34_dag"}],"description":"","uuid":"7f713d48-74e9-4bb6-8dc9-eb8f00371ff3","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"62a92d34_dag","uuid":"df8b9349-996c-4dc9-af64-e4707640efb4"},"name":"8c4aa276_runbook"},"type":"system","uuid":"0d36bbcc-b0c3-40e9-8468-4715b7f5bea5"},{"description":"System action for starting an application","name":"action_start","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"e34fd574-8610-4ce3-9061-9d4f4c437f98","child_tasks_local_reference_list":[{"kind":"app_task","name":"Start","uuid":"378729ff-78ae-40a9-9096-d98029e614db"}],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"334b4484_dag"},{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"378729ff-78ae-40a9-9096-d98029e614db","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\nsudo systemctl start etcd docker kubelet \nsudo systemctl enable etcd docker kubelet\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Start"}],"description":"","uuid":"0a51eb95-3b3b-4f5c-84b2-6be16571150b","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"334b4484_dag","uuid":"e34fd574-8610-4ce3-9061-9d4f4c437f98"},"name":"daee30ae_runbook"},"type":"system","uuid":"cb53aa3a-a093-41a4-8a91-4d9bd2451bd3"},{"description":"System action for stopping an application","name":"action_stop","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"c0b61a7f-788f-4cf8-9235-64f7f3a32ba5","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"9713c3d0_dag"}],"description":"","uuid":"d47bda45-1029-453f-8f80-28216a9797e4","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"9713c3d0_dag","uuid":"c0b61a7f-788f-4cf8-9235-64f7f3a32ba5"},"name":"6407a345_runbook"},"type":"system","uuid":"973a21ca-9570-41c9-b998-62793dcb278b"},{"description":"System action for restarting an application","name":"action_restart","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"b4e81e27-b062-47a0-8499-2e2da7b7f5ed","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"414912df_dag"}],"description":"","uuid":"ca8cec47-f6e6-4ffb-83f1-eb67ddbb98e2","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"414912df_dag","uuid":"b4e81e27-b062-47a0-8499-2e2da7b7f5ed"},"name":"d5c8316f_runbook"},"type":"system","uuid":"ddca9274-10e3-48ea-bbe0-11c14eb4a5fe"}],"description":"","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","port_list":[],"tier":"","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"06f8b711-cc7e-4c52-ad28-f7c799b6b2aa","value":"","label":"","attrs":{"type":""},"is_hidden":false,"type":"LOCAL","name":"VERSION"}],"depends_on_list":[]},{"singleton":false,"name":"Kubernetes_Worker","action_list":[{"description":"System action for creating an application","name":"action_create","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"045659a2-932c-49c8-9269-3a911f955962","name":"Kubernetes_Worker"},"retries":"0","description":"","uuid":"50756cfa-6874-4edf-b86c-7a53f8a5eaa0","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"4af7c45f_dag"}],"description":"","uuid":"cca906a5-5e79-422e-b15f-7391a907ad07","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"4af7c45f_dag","uuid":"50756cfa-6874-4edf-b86c-7a53f8a5eaa0"},"name":"7c6e4932_runbook"},"type":"system","uuid":"6df9c265-f4f4-4f8f-9f2b-6cc0ca7ec64e"},{"description":"System action for deleting an application. Deletes created VMs as well","name":"action_delete","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"045659a2-932c-49c8-9269-3a911f955962","name":"Kubernetes_Worker"},"retries":"0","description":"","uuid":"725715b1-7f4e-4969-b9d9-8da0496287ec","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"1e2c50bb_dag"}],"description":"","uuid":"843ab0a6-03bd-4b9c-8f56-7d852e9348e0","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"1e2c50bb_dag","uuid":"725715b1-7f4e-4969-b9d9-8da0496287ec"},"name":"1d794193_runbook"},"type":"system","uuid":"c5bfeb62-2a04-4361-82ee-a5e89b659466"},{"description":"System action for starting an application","name":"action_start","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"045659a2-932c-49c8-9269-3a911f955962","name":"Kubernetes_Worker"},"retries":"0","description":"","uuid":"d72f08f3-1dd7-4ee8-b590-adb1dab63e2c","child_tasks_local_reference_list":[{"kind":"app_task","name":"Start","uuid":"11506026-008f-43e1-b571-ec1802f3ed21"}],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"970128c7_dag"},{"target_any_local_reference":{"kind":"app_service","uuid":"045659a2-932c-49c8-9269-3a911f955962","name":"Kubernetes_Worker"},"retries":"0","description":"","uuid":"11506026-008f-43e1-b571-ec1802f3ed21","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nsudo systemctl start docker kubelet\nsudo systemctl enable docker kubelet","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Start"}],"description":"","uuid":"0a5d8d7e-668c-43e9-8e56-a3d6ba3a1b51","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"970128c7_dag","uuid":"d72f08f3-1dd7-4ee8-b590-adb1dab63e2c"},"name":"884352cf_runbook"},"type":"system","uuid":"bdc0fbef-15b3-4964-a51c-760f7b35ab3f"},{"description":"System action for stopping an application","name":"action_stop","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"045659a2-932c-49c8-9269-3a911f955962","name":"Kubernetes_Worker"},"retries":"0","description":"","uuid":"ee72001a-18d8-4e3d-a556-16a343ed37a8","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"6c01dc28_dag"}],"description":"","uuid":"0eda550b-bb9c-46cc-a079-1b9f3ccb3579","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6c01dc28_dag","uuid":"ee72001a-18d8-4e3d-a556-16a343ed37a8"},"name":"0cb172a7_runbook"},"type":"system","uuid":"567704ed-583d-41b0-a5bb-38c826f5a1fc"},{"description":"System action for restarting an application","name":"action_restart","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"045659a2-932c-49c8-9269-3a911f955962","name":"Kubernetes_Worker"},"retries":"0","description":"","uuid":"30e99832-f72a-41fa-921a-5d75d5eb8955","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"1d66b5be_dag"}],"description":"","uuid":"ce602c49-d9cd-44d7-8e10-5671dc407b8b","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"1d66b5be_dag","uuid":"30e99832-f72a-41fa-921a-5d75d5eb8955"},"name":"3a6f587d_runbook"},"type":"system","uuid":"aac6e551-6dcf-40bf-92d4-0ea4ae156851"}],"description":"","uuid":"045659a2-932c-49c8-9269-3a911f955962","port_list":[],"tier":"","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"ad7e3b5e-185d-4f96-a160-791f42bedcbc","value":"","label":"","attrs":{"type":""},"is_hidden":false,"type":"LOCAL","name":"VERSION"}],"depends_on_list":[]}],"substrate_definition_list":[{"name":"AHV_Centos_K8SM","action_list":[],"uuid":"07dace66-598d-4d29-a271-7965340bd074","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS","uuid":"70ea3312-6ea8-4ace-9433-d77766f00ba2"}},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"categories":true,"name":true,"resources":{"nic_list":{"0":{"subnet_reference":true}},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"guest_customization":true,"disk_list":{"1":{"data_source_reference":true,"device_properties":{"disk_address":{"adapter_type":true},"device_type":true},"disk_size_mib":true},"0":{"device_properties":{"disk_address":{}},"disk_size_mib":true},"3":{"data_source_reference":true,"device_properties":{"disk_address":{"adapter_type":true},"device_type":true},"disk_size_mib":true},"2":{"data_source_reference":true,"device_properties":{"disk_address":{"adapter_type":true},"device_type":true},"disk_size_mib":true},"5":{"data_source_reference":true,"device_properties":{"disk_address":{"adapter_type":true},"device_type":true},"disk_size_mib":true},"4":{"data_source_reference":true,"device_properties":{"disk_address":{"adapter_type":true},"device_type":true},"disk_size_mib":true},"6":{"data_source_reference":true,"device_properties":{"disk_address":{"adapter_type":true},"device_type":true},"disk_size_mib":true}}}}},"os_type":"Linux","type":"AHV_VM","create_spec":{"name":"K8SM-@@{calm_array_index}@@-@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"099dbe61-2c00-4964-9567-f547ec224e10"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"gpu_list":[],"memory_size_mib":2048,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"efc034e3-b50e-4a48-b02d-25036aeb8bd3","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"AHV_CENTOS_76","uuid":"691d60b5-9272-4cb0-a4b4-4e8dc6f75277"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":1,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":2,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":3,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":4,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":5,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":6,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[],"description":""},{"name":"AHV_Centos_K8SW","action_list":[],"uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"60","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS","uuid":"70ea3312-6ea8-4ace-9433-d77766f00ba2"}},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"categories":true,"name":true,"resources":{"nic_list":{"0":{"subnet_reference":true}},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"guest_customization":true,"disk_list":{"1":{"data_source_reference":true,"device_properties":{"disk_address":{"adapter_type":true},"device_type":true},"disk_size_mib":true},"0":{"device_properties":{"disk_address":{}},"disk_size_mib":true},"3":{"data_source_reference":true,"device_properties":{"disk_address":{"adapter_type":true},"device_type":true},"disk_size_mib":true},"2":{"data_source_reference":true,"device_properties":{"disk_address":{"adapter_type":true},"device_type":true},"disk_size_mib":true}}}}},"os_type":"Linux","type":"AHV_VM","create_spec":{"name":"K8SW-@@{calm_array_index}@@-@@{calm_time}@@","resources":{"nic_list":[{"nic_type":"NORMAL_NIC","network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"099dbe61-2c00-4964-9567-f547ec224e10"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"gpu_list":[],"memory_size_mib":2048,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"efc034e3-b50e-4a48-b02d-25036aeb8bd3","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"AHV_CENTOS_76","uuid":"691d60b5-9272-4cb0-a4b4-4e8dc6f75277"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":1,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":2,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":3,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[],"description":""},{"name":"AWS_Centos_K8SM","action_list":[],"uuid":"2c077429-6628-4a1d-8153-776c6ecd4247","readiness_probe":{"connection_type":"SSH","retries":"5","connection_port":22,"address":"@@{public_ip_address}@@","delay_secs":"0","disable_readiness_probe":false},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"name":true,"resources":{"instance_profile_name":true,"availability_zone":true,"subnet_id":true,"key_name":true,"region":true,"user_data":true,"image_id":true,"instance_type":true,"security_group_list":true,"block_device_map":{"data_disk_list":{"1":{"size_gb":true},"0":{"size_gb":true},"3":{"size_gb":true},"2":{"size_gb":true},"5":{"size_gb":true},"4":{"size_gb":true}},"root_disk":{"size_gb":true}},"associate_public_ip_address":true,"vpc_id":true,"tag_list":true}}},"os_type":"Linux","type":"AWS_VM","create_spec":{"name":"K8SM-@@{calm_array_index}@@-@@{calm_time}@@","availability_zone_reference":null,"backup_policy":null,"type":"PROVISION_AWS_VM","cluster_reference":null,"resources":{"instance_profile_name":"kubernetes-ebs-volumes","availability_zone":"us-east-1a","subnet_id":"subnet-c599a5ef","key_name":"calm-blueprints","region":"us-east-1","instance_initiated_shutdown_behavior":"","user_data":"","image_id":"ami-0ccec2041ac92b449","instance_type":"t2.medium","state":"RUNNING","security_group_list":[{"type":"","security_group_id":"sg-3b938f40"}],"block_device_map":{"data_disk_list":[{"size_gb":10,"volume_type":"GP2","device_name":"\/dev\/sdb","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"GP2","device_name":"\/dev\/sdc","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"GP2","device_name":"\/dev\/sdd","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"STANDARD","device_name":"\/dev\/sde","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"STANDARD","device_name":"\/dev\/sdf","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"STANDARD","device_name":"\/dev\/sdg","iops":1,"snapshot_id":"","type":"","delete_on_termination":true}],"type":"","root_disk":{"size_gb":10,"volume_type":"GP2","device_name":"\/dev\/sda1","iops":1,"snapshot_id":"","type":"","delete_on_termination":true}},"private_ip_address":"","vpc_id":"vpc-ffd54d98","tag_list":[{"type":"","key":"kubernetes.io\/cluster\/@@{KUBE_CLUSTER_NAME}@@","value":"true"}],"type":"","account_uuid":"8c2e0a6b-620a-c62a-c3f4-e58b101dfd0d","associate_public_ip_address":true}},"variable_list":[],"description":""},{"name":"AWS_Centos_K8SW","action_list":[],"uuid":"190048e5-32e8-44b5-abe9-91374efc543b","readiness_probe":{"connection_type":"SSH","retries":"5","connection_port":22,"address":"@@{public_ip_address}@@","delay_secs":"0","disable_readiness_probe":false},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"name":true,"resources":{"instance_profile_name":true,"availability_zone":true,"subnet_id":true,"key_name":true,"region":true,"user_data":true,"image_id":true,"instance_type":true,"security_group_list":true,"block_device_map":{"data_disk_list":{"1":{"size_gb":true},"0":{"size_gb":true},"2":{"size_gb":true}},"root_disk":{"size_gb":true}},"associate_public_ip_address":true,"vpc_id":true,"tag_list":true}}},"os_type":"Linux","type":"AWS_VM","create_spec":{"name":"K8SW-@@{calm_array_index}@@-@@{calm_time}@@","availability_zone_reference":null,"backup_policy":null,"type":"PROVISION_AWS_VM","cluster_reference":null,"resources":{"instance_profile_name":"kubernetes-ebs-volumes","availability_zone":"us-east-1a","subnet_id":"subnet-9d1085b1","key_name":"calm-blueprints","region":"us-east-1","instance_initiated_shutdown_behavior":"","user_data":"","image_id":"ami-0ccec2041ac92b449","instance_type":"t2.large","state":"RUNNING","security_group_list":[{"type":"","security_group_id":"sg-3b938f40"}],"block_device_map":{"data_disk_list":[{"size_gb":8,"volume_type":"GP2","device_name":"\/dev\/sdb","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":8,"volume_type":"GP2","device_name":"\/dev\/sdc","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":8,"volume_type":"GP2","device_name":"\/dev\/sdd","iops":1,"snapshot_id":"","type":"","delete_on_termination":true}],"type":"","root_disk":{"size_gb":8,"volume_type":"GP2","device_name":"\/dev\/sda1","iops":1,"snapshot_id":"","type":"","delete_on_termination":true}},"private_ip_address":"","vpc_id":"vpc-ffd54d98","tag_list":[{"type":"","key":"kubernetes.io\/cluster\/@@{KUBE_CLUSTER_NAME}@@","value":"owned"}],"type":"","account_uuid":"8c2e0a6b-620a-c62a-c3f4-e58b101dfd0d","associate_public_ip_address":true}},"variable_list":[],"description":""},{"name":"GCP_Centos_K8SM","action_list":[],"uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5","readiness_probe":{"connection_type":"SSH","retries":"5","connection_port":22,"address":"@@{public_ip_address}@@","delay_secs":"0","disable_readiness_probe":false},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"timeout_secs":true,"address":true,"delay_secs":true,"connection_port":true},"create_spec":{"resources":{"labels":true,"machineType":true,"name":true,"zone":true,"tags":{"items":true},"guestCustomization":{"startupScript":true},"disks":{"0":{"initializeParams":{"diskSizeGb":true,"sourceImage":true,"diskType":true},"autoDelete":true}},"blankDisks":{"1":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true},"0":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true},"3":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true},"2":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true},"5":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true},"4":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true}},"networkInterfaces":{"0":{"accessConfigs":{"0":{"config_type":true,"name":true}},"network":true,"subnetwork":true,"associatePublicIP":true}},"sshKeys":{"0":true},"serviceAccounts":{"0":{"scopes":true,"email":true}},"metadata":{"items":true}}}},"os_type":"Linux","type":"GCP_VM","create_spec":{"type":"PROVISION_GCP_VM","resources":{"labels":[],"machineType":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/machineTypes\/n1-highcpu-2","description":"","zone":"us-central1-c","tags":{"items":[],"type":"","fingerprint":""},"guestCustomization":{"type":"","startupScript":""},"labelFingerprint":"","disks":[{"diskEncryptionKey":{"rawKey":"","type":""},"deviceName":"","initializeParams":{"sourceImageEncryptionKey":{"rawKey":"","type":""},"diskName":"","diskType":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","diskSizeGb":10,"sourceImage":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/global\/images\/centos-7","type":""},"autoDelete":true,"boot":true,"source":"","mode":"","interface":"","disk_type":"PERSISTENT","type":""}],"name":"k8sm-@@{calm_array_index}@@-@@{calm_time}@@","sshKeys":["centos:ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDMGAS\/K0Mb\/uwFXwD+hkjguy7VMZk2hpuhwPl9FUZwVBrURf\/i9QMJ5\/paPEZixu8VlRx7Inu4iun7rQfrnfeIYInmBwspXHYiTK3oHJAgZnrAHVEf1p6YaxLINlT1NI5yOAGPRWW6of8rBDBH1ObwU2+wcSx\/1H0uIs3aZNLufr+Rh628ACxAum2Gt8AVRj6ua2BPFyt5VTdclyysAmeh1AiixNgOZXOz6y\/i4TbzpY78I3isuKpxsUeXX6jxEMQol406jHDUF6njEOPIQG2zVZ3QJlTG9OlN+NiyZG9WkZz0VG\/6M8ixxIHHI2dNwUbBFv2HUu+8X9LTLFq2O7KjX9Hp7uZKBAySHA3eKaKHIp2bZuU1bT5PRPkggngX86xg+T+OMNnutbAiMnRJ8+FvD5So+5TIx4b9GgxAxure3x2yRPT9lOiQOB+CVpJPxR0Rn9bOI+wiPnD0kAGvK\/fHT+pqL4PM+hTnJtp9rrCRzIQApBx1263jEcYffhW2epZQRO+he5CMawFJ5TBe08om2AaDJ8GQdrpF6YA3W8DzHbmL3DPVVHdmqPLn10o+LX4gv5SdIIDVGdjKOc1BCnLTRmM28d5+sLDt\/M+kvcQgf0y0yDjMVjGECZkt39hbm4ELMHzZtzYLmHNhBZxRqHeJ7qFTuv1kx88OW3Xc5mbBNQ== centos@nutanix.com\n"],"canIpForward":false,"scheduling":{"automaticRestart":true,"type":"","preemptible":false,"onHostMaintenance":"TERMINATE"},"minCpuPlatform":"","blankDisks":[{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk1-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk2-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk3-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk4-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk5-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk6-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true}],"metadata":{"items":[],"type":"","fingerprint":""},"type":"","account_uuid":"84213a31-4fe8-7e39-3799-e093e5d0dc2e","serviceAccounts":[{"scopes":["https:\/\/www.googleapis.com\/auth\/cloud-platform"],"type":"","email":"108048128720-compute@developer.gserviceaccount.com"}],"networkInterfaces":[{"aliasIpRanges":[],"network":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/global\/networks\/default","accessConfigs":[{"config_type":"ONE_TO_ONE_NAT","type":"","name":"k8sc-acn-@@{calm_array_index}@@-@@{calm_time}@@","natIP":""}],"networkIP":"","subnetwork":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/regions\/us-central1\/subnetworks\/default","type":"","associatePublicIP":true}]}},"variable_list":[],"description":""},{"name":"GCP_Centos_K8SW","action_list":[],"uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab","readiness_probe":{"connection_type":"SSH","retries":"5","connection_port":22,"address":"@@{public_ip_address}@@","delay_secs":"0","disable_readiness_probe":false},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"timeout_secs":true,"address":true,"delay_secs":true,"connection_port":true},"create_spec":{"resources":{"labels":true,"machineType":true,"name":true,"zone":true,"tags":{"items":true},"guestCustomization":{"startupScript":true},"disks":{"0":{"initializeParams":{"diskSizeGb":true,"sourceImage":true,"diskType":true},"autoDelete":true}},"blankDisks":{"1":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true},"0":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true},"2":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true}},"networkInterfaces":{"0":{"accessConfigs":{"0":{"config_type":true,"name":true}},"network":true,"subnetwork":true,"associatePublicIP":true}},"sshKeys":{"0":true},"serviceAccounts":{"0":{"scopes":true,"email":true}},"metadata":{"items":true}}}},"os_type":"Linux","type":"GCP_VM","create_spec":{"type":"PROVISION_GCP_VM","resources":{"labels":[],"machineType":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/machineTypes\/n1-highcpu-4","description":"","zone":"us-central1-c","tags":{"items":[],"type":"","fingerprint":""},"guestCustomization":{"type":"","startupScript":""},"labelFingerprint":"","disks":[{"diskEncryptionKey":{"rawKey":"","type":""},"deviceName":"","initializeParams":{"sourceImageEncryptionKey":{"rawKey":"","type":""},"diskName":"","diskType":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","diskSizeGb":10,"sourceImage":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/global\/images\/centos-7","type":""},"autoDelete":true,"boot":true,"source":"","mode":"","interface":"","disk_type":"PERSISTENT","type":""}],"name":"k8sw-@@{calm_array_index}@@-@@{calm_time}@@","sshKeys":["centos:ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDMGAS\/K0Mb\/uwFXwD+hkjguy7VMZk2hpuhwPl9FUZwVBrURf\/i9QMJ5\/paPEZixu8VlRx7Inu4iun7rQfrnfeIYInmBwspXHYiTK3oHJAgZnrAHVEf1p6YaxLINlT1NI5yOAGPRWW6of8rBDBH1ObwU2+wcSx\/1H0uIs3aZNLufr+Rh628ACxAum2Gt8AVRj6ua2BPFyt5VTdclyysAmeh1AiixNgOZXOz6y\/i4TbzpY78I3isuKpxsUeXX6jxEMQol406jHDUF6njEOPIQG2zVZ3QJlTG9OlN+NiyZG9WkZz0VG\/6M8ixxIHHI2dNwUbBFv2HUu+8X9LTLFq2O7KjX9Hp7uZKBAySHA3eKaKHIp2bZuU1bT5PRPkggngX86xg+T+OMNnutbAiMnRJ8+FvD5So+5TIx4b9GgxAxure3x2yRPT9lOiQOB+CVpJPxR0Rn9bOI+wiPnD0kAGvK\/fHT+pqL4PM+hTnJtp9rrCRzIQApBx1263jEcYffhW2epZQRO+he5CMawFJ5TBe08om2AaDJ8GQdrpF6YA3W8DzHbmL3DPVVHdmqPLn10o+LX4gv5SdIIDVGdjKOc1BCnLTRmM28d5+sLDt\/M+kvcQgf0y0yDjMVjGECZkt39hbm4ELMHzZtzYLmHNhBZxRqHeJ7qFTuv1kx88OW3Xc5mbBNQ== centos@nutanix.com\n"],"canIpForward":false,"scheduling":{"automaticRestart":true,"type":"","preemptible":false,"onHostMaintenance":"TERMINATE"},"minCpuPlatform":"","blankDisks":[{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sm-disk1-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sm-disk2-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sm-disk3-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true}],"metadata":{"items":[],"type":"","fingerprint":""},"type":"","account_uuid":"84213a31-4fe8-7e39-3799-e093e5d0dc2e","serviceAccounts":[{"scopes":["https:\/\/www.googleapis.com\/auth\/cloud-platform"],"type":"","email":"108048128720-compute@developer.gserviceaccount.com"}],"networkInterfaces":[{"aliasIpRanges":[],"network":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/global\/networks\/default","accessConfigs":[{"config_type":"ONE_TO_ONE_NAT","type":"","name":"k8sm-acm-@@{calm_array_index}@@-@@{calm_time}@@","natIP":""}],"networkIP":"","subnetwork":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/regions\/us-central1\/subnetworks\/default","type":"","associatePublicIP":true}]}},"variable_list":[],"description":""},{"name":"Azure_Centos_K8SM","action_list":[],"uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5","readiness_probe":{"connection_type":"SSH","retries":"5","connection_port":22,"address":"@@{platform.publicIPAddressList[0]}@@","delay_secs":"0","disable_readiness_probe":false},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"delay_secs":true,"connection_port":true,"timeout_secs":null},"create_spec":{"resources":{"vm_name":true,"storage_profile":{"is_managed":true,"image_details":{"sku":true,"publisher":true,"offer":true,"source_image_id":true,"use_custom_image":true,"version":true},"os_disk_details":{"storage_type":true,"name":true,"caching_type":true,"create_option":true}},"nw_profile":{"nic_list":{"0":{"nsg_name":true,"vnet_name":true,"private_ip_info":{"ip_allocation_method":true},"nic_name":true,"subnet_name":true,"public_ip_info":{"ip_allocation_method":true,"dns_label":true,"ip_name":true}}}},"resource_group":true,"os_profile":{"linux_config":{"custom_data":true}},"hw_profile":{"vm_size":true},"location":true,"availability_set_id":true,"tag_list":true}}},"os_type":"Linux","type":"AZURE_VM","create_spec":{"type":"PROVISION_AZURE_VM","name":"","resources":{"vm_name":"K8SM-@@{calm_unique_hash}@@-@@{calm_array_index}@@","storage_profile":{"is_managed":true,"image_details":{"sku":"7.4","publisher":"OpenLogic","offer":"CentOS-HPC","source_image_id":"","use_custom_image":false,"version":"7.4.20180719","type":""},"type":"","os_disk_details":{"size_in_gb":127,"name":"os-@@{calm_unique_hash}@@-@@{calm_array_index}@@-disk","storage_name":"","storage_type":"Standard_LRS","caching_type":"ReadWrite","type":"","create_option":"FromImage","lun":-1},"data_disk_list":[]},"nw_profile":{"nic_list":[{"vnet_name":"calm-virtual-network-eastus2","nsg_name":"sg-allow-all-eastus2","private_ip_info":{"ip_allocation_method":"Dynamic"},"nic_name":"nic-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","subnet_name":"default","public_ip_info":{"ip_name":"public-ip-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","dns_label":"dns-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","ip_allocation_method":"Dynamic"}}],"primary_nic":-1,"type":""},"resource_group":"calmrg","os_profile":{"secrets":[],"type":"","windows_config":{"winrm_listeners":[],"time_zone":"","additional_unattend_content":[],"provision_vm_agent":true,"auto_updates":false,"type":""},"linux_config":null},"hw_profile":{"max_data_disk_count":4,"vm_size":"Standard_D1_v2","type":""},"location":"eastus2","tag_list":[],"type":"","account_uuid":"3c0f2d94-878c-f34c-6d39-90b854129782"}},"variable_list":[],"description":""},{"name":"Azure_Centos_K8SW","action_list":[],"uuid":"03295a06-796d-4fa9-acec-3ad99de6e822","readiness_probe":{"connection_type":"SSH","retries":"5","connection_port":22,"address":"@@{platform.publicIPAddressList[0]}@@","delay_secs":"0","disable_readiness_probe":false},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"delay_secs":true,"connection_port":true,"timeout_secs":null},"create_spec":{"resources":{"vm_name":true,"storage_profile":{"is_managed":true,"image_details":{"sku":true,"publisher":true,"offer":true,"source_image_id":true,"use_custom_image":true,"version":true},"os_disk_details":{"storage_type":true,"name":true,"caching_type":true,"create_option":true}},"nw_profile":{"nic_list":{"0":{"nsg_name":true,"vnet_name":true,"private_ip_info":{"ip_allocation_method":true},"nic_name":true,"subnet_name":true,"public_ip_info":{"ip_name":true,"dns_label":true,"ip_allocation_method":true}}}},"resource_group":true,"os_profile":{"linux_config":{"custom_data":true}},"hw_profile":{"vm_size":true},"location":true,"availability_set_id":true,"tag_list":true}}},"os_type":"Linux","type":"AZURE_VM","create_spec":{"type":"PROVISION_AZURE_VM","name":"","resources":{"vm_name":"K8SW-@@{calm_unique_hash}@@-@@{calm_array_index}@@","storage_profile":{"is_managed":true,"image_details":{"sku":"7.4","publisher":"OpenLogic","offer":"CentOS-HPC","source_image_id":"","use_custom_image":false,"version":"7.4.20180719","type":""},"type":"","os_disk_details":{"size_in_gb":127,"name":"os-@@{calm_unique_hash}@@-@@{calm_array_index}@@-disk","storage_name":"","storage_type":"Standard_LRS","caching_type":"ReadWrite","type":"","create_option":"FromImage","lun":-1},"data_disk_list":[]},"nw_profile":{"nic_list":[{"vnet_name":"calm-virtual-network-eastus2","nsg_name":"sg-allow-all-eastus2","private_ip_info":{"ip_allocation_method":"Dynamic"},"nic_name":"nic-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","subnet_name":"default","public_ip_info":{"ip_name":"public-ip-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","dns_label":"dns-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","ip_allocation_method":"Dynamic"}}],"primary_nic":-1,"type":""},"resource_group":"calmrg","os_profile":{"secrets":[],"type":"","windows_config":{"winrm_listeners":[],"time_zone":"","additional_unattend_content":[],"provision_vm_agent":true,"auto_updates":false,"type":""},"linux_config":null},"hw_profile":{"max_data_disk_count":4,"vm_size":"Standard_D1_v2","type":""},"location":"eastus2","tag_list":[],"type":"","account_uuid":"3c0f2d94-878c-f34c-6d39-90b854129782"}},"variable_list":[],"description":""},{"name":"VMware_Centos_K8SM","action_list":[],"uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{platform.ipAddressList[0]}@@","delay_secs":"30","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS","uuid":"70ea3312-6ea8-4ace-9433-d77766f00ba2"}},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"delay_secs":true,"connection_port":true,"timeout_secs":null},"create_spec":{"name":true,"drs_mode":true,"cluster":true,"host":true,"datastore":true,"storage_pod":true,"resources":{"template_nic_list":{},"nic_list":{"0":{"nic_type":true,"net_name":true}},"template_controller_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"controller_list":{},"memory_size_mib":true,"guest_customization":{"customization_name":true,"cloud_init":true},"template_disk_list":{},"disk_list":true}}},"os_type":"Linux","type":"VMWARE_VM","create_spec":{"name":"K8SM-@@{calm_array_index}@@-@@{calm_time}@@","storage_pod":"TestQA","drs_mode":true,"cluster":"Sabine59-Cluster","host":"","clone_is_template":false,"template":"8fb1dd88-fcf1-444f-a5bb-d5482c87170f","datastore":"","type":"PROVISION_VMWARE_VM","resources":{"nic_list":[{"nic_type":"e1000","type":"","net_name":"key-vim.host.PortGroup-VM Network"}],"template_nic_list":[],"template_controller_list":[],"num_vcpus_per_socket":1,"num_sockets":2,"controller_list":[],"memory_size_mib":2048,"power_state":"poweron","guest_customization":{"type":"","cloud_init":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']","customization_type":"GUEST_OS_LINUX"},"template_disk_list":[],"type":"","account_uuid":"7f90399d-ed3d-1c70-447d-17004ef1bd0a","disk_list":[{"disk_size_mb":10240,"disk_mode":"persistent","adapter_type":"SCSI","iso_path":"","location":"ds:\/\/\/vmfs\/volumes\/7b773e05-e06fc970\/","disk_type":"disk","type":""},{"disk_size_mb":10240,"disk_mode":"persistent","adapter_type":"SCSI","iso_path":"","location":"ds:\/\/\/vmfs\/volumes\/7b773e05-e06fc970\/","disk_type":"disk","type":""},{"disk_size_mb":10240,"disk_mode":"persistent","adapter_type":"SCSI","iso_path":"","location":"ds:\/\/\/vmfs\/volumes\/7b773e05-e06fc970\/","disk_type":"disk","type":""},{"disk_size_mb":10240,"disk_mode":"persistent","adapter_type":"SCSI","iso_path":"","location":"ds:\/\/\/vmfs\/volumes\/7b773e05-e06fc970\/","disk_type":"disk","type":""},{"disk_size_mb":10240,"disk_mode":"persistent","adapter_type":"SCSI","iso_path":"","location":"ds:\/\/\/vmfs\/volumes\/7b773e05-e06fc970\/","disk_type":"disk","type":""},{"disk_size_mb":10240,"disk_mode":"persistent","adapter_type":"SCSI","iso_path":"","location":"ds:\/\/\/vmfs\/volumes\/7b773e05-e06fc970\/","disk_type":"disk","type":""}]}},"variable_list":[],"description":""},{"name":"VMware_Centos_K8SW","action_list":[],"uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{platform.ipAddressList[0]}@@","delay_secs":"30","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS","uuid":"70ea3312-6ea8-4ace-9433-d77766f00ba2"}},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"delay_secs":true,"connection_port":true,"timeout_secs":null},"create_spec":{"name":true,"drs_mode":true,"cluster":true,"host":true,"datastore":true,"storage_pod":true,"resources":{"template_nic_list":{},"nic_list":{"0":{"nic_type":true,"net_name":true}},"template_controller_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"controller_list":{},"memory_size_mib":true,"guest_customization":{"customization_name":true,"cloud_init":true},"template_disk_list":{},"disk_list":true}}},"os_type":"Linux","type":"VMWARE_VM","create_spec":{"name":"K8SW-@@{calm_array_index}@@-@@{calm_time}@@","storage_pod":"TestQA","drs_mode":true,"cluster":"Sabine59-Cluster","host":"","clone_is_template":false,"template":"8fb1dd88-fcf1-444f-a5bb-d5482c87170f","datastore":"","type":"PROVISION_VMWARE_VM","resources":{"nic_list":[{"nic_type":"e1000","type":"","net_name":"key-vim.host.PortGroup-VM Network"}],"template_nic_list":[],"template_controller_list":[],"num_vcpus_per_socket":1,"num_sockets":4,"controller_list":[],"memory_size_mib":4096,"power_state":"poweron","guest_customization":{"type":"","cloud_init":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']","customization_type":"GUEST_OS_LINUX"},"template_disk_list":[],"type":"","account_uuid":"7f90399d-ed3d-1c70-447d-17004ef1bd0a","disk_list":[{"disk_size_mb":10240,"disk_mode":"persistent","adapter_type":"SCSI","iso_path":"","location":"ds:\/\/\/vmfs\/volumes\/7b773e05-e06fc970\/","disk_type":"disk","type":""},{"disk_size_mb":10240,"disk_mode":"persistent","adapter_type":"SCSI","iso_path":"","location":"ds:\/\/\/vmfs\/volumes\/7b773e05-e06fc970\/","disk_type":"disk","type":""},{"disk_size_mb":10240,"disk_mode":"persistent","adapter_type":"SCSI","iso_path":"","location":"ds:\/\/\/vmfs\/volumes\/7b773e05-e06fc970\/","disk_type":"disk","type":""}]}},"variable_list":[],"description":""}],"credential_definition_list":[{"username":"centos","description":"","uuid":"70ea3312-6ea8-4ace-9433-d77766f00ba2","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{"uuid":"4697253c-f2fc-4d8b-898e-de45b934d790"}}},"editables":{"username":true,"secret":true},"type":"KEY","name":"CENTOS"}],"type":"USER","app_profile_list":[{"deployment_create_list":[{"name":"2cbb2f6a_deployment","action_list":[],"package_local_reference_list":[{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"}],"description":"","depends_on_list":[],"min_replicas":"3","max_replicas":"3","published_service_local_reference_list":[],"editables":{"min_replicas":true,"max_replicas":true},"substrate_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"07dace66-598d-4d29-a271-7965340bd074"},"type":"GREENFIELD","variable_list":[],"uuid":"56a7c02a-9a6e-46e2-8d39-c786833649db"},{"name":"39cf7283_deployment","action_list":[],"package_local_reference_list":[{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"}],"description":"","depends_on_list":[],"min_replicas":"2","max_replicas":"9","published_service_local_reference_list":[],"editables":{"min_replicas":true,"max_replicas":true},"substrate_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"caf4c659-7d09-49d7-91f5-cfe1c85dbf26"},"type":"GREENFIELD","variable_list":[],"uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f"}],"description":"","action_list":[{"description":"","name":"Upgrade","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"95b09321-5b8d-4031-836d-3d3a40d818fe","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Version Master","uuid":"66c0a5e7-3494-43ba-83f8-9368806ef5b3"},{"kind":"app_task","name":"Upgrade Master","uuid":"e44ef901-81c0-42ca-8ff2-03faae6404a9"},{"kind":"app_task","name":"Set Version Minion","uuid":"7daeb627-0861-419e-9814-1a1450f7fa73"},{"kind":"app_task","name":"Upgrade Minion","uuid":"e8bd1a85-382f-4cd3-b0fe-0b4dadfc4531"},{"kind":"app_task","name":"RestartServices","uuid":"e3242f4f-3997-4600-adfe-7683e768e32b"}],"attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"66c0a5e7-3494-43ba-83f8-9368806ef5b3"},"edge_type":"user_defined","type":"","uuid":"f9dc20ef-b3b3-4776-b89c-22ecfd58f908","to_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"e44ef901-81c0-42ca-8ff2-03faae6404a9"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"e44ef901-81c0-42ca-8ff2-03faae6404a9"},"edge_type":"user_defined","type":"","uuid":"20a8f316-c37b-4633-8822-61d75cf5dddd","to_task_reference":{"kind":"app_task","name":"RestartServices","uuid":"e3242f4f-3997-4600-adfe-7683e768e32b"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"66c0a5e7-3494-43ba-83f8-9368806ef5b3"},"edge_type":"user_defined","type":"","uuid":"00204690-aee8-4934-8ea1-74c86714f130","to_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"7daeb627-0861-419e-9814-1a1450f7fa73"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"7daeb627-0861-419e-9814-1a1450f7fa73"},"edge_type":"user_defined","type":"","uuid":"3ab35cda-e48b-49f1-9147-2522b51ea0dd","to_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"e8bd1a85-382f-4cd3-b0fe-0b4dadfc4531"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"e8bd1a85-382f-4cd3-b0fe-0b4dadfc4531"},"edge_type":"user_defined","type":"","uuid":"8618c7d4-7731-4e67-befe-a38fd9dec9eb","to_task_reference":{"kind":"app_task","name":"RestartServices","uuid":"e3242f4f-3997-4600-adfe-7683e768e32b"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"6ee65d8a_dag"},{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"66c0a5e7-3494-43ba-83f8-9368806ef5b3","child_tasks_local_reference_list":[],"attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[],"name":"Set Version Master"},{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"e44ef901-81c0-42ca-8ff2-03faae6404a9","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nCONTROLLER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n\nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Upgrade Master"},{"target_any_local_reference":{"kind":"app_service","uuid":"045659a2-932c-49c8-9269-3a911f955962","name":"Kubernetes_Worker"},"retries":"0","description":"","uuid":"7daeb627-0861-419e-9814-1a1450f7fa73","child_tasks_local_reference_list":[],"attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[],"name":"Set Version Minion"},{"target_any_local_reference":{"kind":"app_service","uuid":"045659a2-932c-49c8-9269-3a911f955962","name":"Kubernetes_Worker"},"retries":"0","description":"","uuid":"e8bd1a85-382f-4cd3-b0fe-0b4dadfc4531","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/usr\/share\/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Upgrade Minion"},{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"e3242f4f-3997-4600-adfe-7683e768e32b","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_IPS=\"@@{AHV_Centos_K8SW.address}@@\"\nJSONPATH='{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}'\nKUBE_VERSION_NEW=\"@@{KUBE_VERSION_NEW}@@\"\nMASTER_API_HTTPS=6443\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION_NEW}\/bin\/linux\/amd64\/kubectl\nchmod +x kubectl\nsudo mv kubectl \/usr\/local\/bin\/kubectl\n\ncount=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n  echo \"Trying to reach master server https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} : sleep for 5 secs\"\n  sleep 10\n  if [[ $count -eq 10 ]]; then\n    echo \"Unable to reach master server: https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\"\n    exit 1\n  fi\n  count=$((count+1))\ndone\n\ncount=0\nfor ip in $(echo \"${WORKER_IPS}\" | tr \",\" \"\\n\"); do\n  #kubectl drain \"worker${count}\" --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no $ip \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 10\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=worker${count} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon worker${count}\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n  echo \"Upgrade failed on worker nodes\"\n    exit 1\nfi\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  #kubectl drain \"master${count}\" --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no $ip \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 10\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=master${count} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon master${count}\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n  echo \"Upgrade failed on nodes: $(kubectl get nodes -o jsonpath='$JSONPATH' | grep 'Ready=Unknown')\"\n    exit 1\nfi","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"RestartServices"}],"description":"","uuid":"5ae78232-6591-4891-8df4-2b99e50db68e","variable_list":[{"val_type":"STRING","regex":{"should_validate":true,"value":"^v1\\.[0-9]?[0-9]\\.[0-9]?[0-9]$"},"is_mandatory":false,"description":"","uuid":"3977b454-c88e-401f-a15c-0f3bd1b4cbbe","value":"v1.10.13","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_VERSION_NEW"}],"main_task_local_reference":{"kind":"app_task","name":"6ee65d8a_dag","uuid":"95b09321-5b8d-4031-836d-3d3a40d818fe"},"name":"68a7ffd0_runbook"},"type":"user","uuid":"a45e107f-f2c9-409b-b265-986751dfb1fd"},{"description":"","name":"ScaleOut","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"8c235d7f-5db1-4a68-93d7-baebf4d54abc","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Out","uuid":"a9256a47-8d31-4a5e-b209-e440bccb6ffd"},{"kind":"app_task","name":"Set Hosts file","uuid":"4ff6c5cf-e041-4a7f-9de6-bf131fc3d2a3"}],"attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Scale Out","uuid":"a9256a47-8d31-4a5e-b209-e440bccb6ffd"},"edge_type":"user_defined","type":"","uuid":"7c7b1a63-e73a-4fe1-baaa-68db376fe1f8","to_task_reference":{"kind":"app_task","name":"Set Hosts file","uuid":"4ff6c5cf-e041-4a7f-9de6-bf131fc3d2a3"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"03b33121_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f","name":"39cf7283_deployment"},"retries":"0","description":"","uuid":"a9256a47-8d31-4a5e-b209-e440bccb6ffd","child_tasks_local_reference_list":[],"attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","type":"SCALING","variable_list":[],"name":"Scale Out"},{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"4ff6c5cf-e041-4a7f-9de6-bf131fc3d2a3","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nMINION_IPS=\"@@{AHV_Centos_K8SW.address}@@\"\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  if ! (( $(grep -c \"${ip} worker${count}\" \/etc\/hosts) )) ; then\n  \techo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  fi\n  count=$((count+1))\ndone","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Set Hosts file"}],"description":"","uuid":"d5d1289f-cbeb-47d5-9269-9b83993724ab","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"e6a0176b-8b04-48f1-b219-75603ee064d1","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"03b33121_dag","uuid":"8c235d7f-5db1-4a68-93d7-baebf4d54abc"},"name":"00cf5417_runbook"},"type":"user","uuid":"58ed0edc-98f7-4fc5-bf59-d55ff420e69d"},{"description":"","name":"ScaleIn","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"033e90a7-3dc2-4750-8d41-b61bfbfb63a1","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale In","uuid":"a08e85e9-2cb4-4175-9273-527997e392b4"}],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"e72a9133_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","uuid":"7306a3c9-9a76-45c2-90c9-27729ab58b5f","name":"39cf7283_deployment"},"retries":"0","description":"","uuid":"a08e85e9-2cb4-4175-9273-527997e392b4","child_tasks_local_reference_list":[],"attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","type":"SCALING","variable_list":[],"name":"Scale In"}],"description":"","uuid":"a4e423d4-7f36-49e0-95c0-579115dac3f7","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"ff3a40f9-0e4e-49a8-9f44-ef99c3f11bb4","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"e72a9133_dag","uuid":"033e90a7-3dc2-4750-8d41-b61bfbfb63a1"},"name":"96546f6c_runbook"},"type":"user","uuid":"c34277be-b695-48d1-a9c6-e96125e6fff1"}],"name":"Nutanix","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"1d26ced8-e5c1-433d-95b9-8f9b0152f5d4","value":"ahv-kubenetes-cluster","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_CLUSTER_NAME"},{"val_type":"STRING","regex":{"should_validate":true,"value":"^v1\\.[0-9]?[0-9]\\.[0-9]?[0-9]$"},"is_mandatory":false,"description":"","uuid":"58ee33f7-e0b1-4e4a-83b7-522520287607","value":"v1.9.11","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_VERSION"},{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"008b8a10-4cd0-4195-a81c-d63d6b35c841","value":"17.03.3.ce","label":"","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{"type":"PREDEFINED","choices":["17.03.3.ce","17.06.2.ce","17.09.1.ce","17.12.1.ce","18.03.1.ce","18.06.3.ce"]},"name":"DOCKER_VERSION"},{"val_type":"STRING","regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\\/\\d{1,2}$"},"is_mandatory":false,"description":"","uuid":"59a3e3bc-2e54-4781-915b-0aeb2cd0a448","value":"10.200.0.0\/16","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_CLUSTER_SUBNET"},{"val_type":"STRING","regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\\/\\d{1,2}$"},"is_mandatory":false,"description":"","uuid":"b28ecb1f-8807-4eb6-98e3-de166abf429d","value":"10.32.0.0\/24","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_SERVICE_SUBNET"},{"val_type":"STRING","regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$"},"is_mandatory":false,"description":"","uuid":"27600034-0187-463d-8b18-0c9003d3f1a8","value":"10.32.0.10","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_DNS_IP"},{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"eaaf7752-ee90-4f38-be12-f6c664cfc90f","value":"flannel","label":"","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{"type":"PREDEFINED","choices":["flannel","canal","calico"]},"name":"KUBE_CNI_PLUGIN"},{"val_type":"STRING","regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$"},"is_mandatory":false,"description":"","uuid":"5eb939d0-b980-4fba-a472-736426ee8df1","value":"10.46.34.95","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"PE_CLUSTER_IP"},{"val_type":"STRING","regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$"},"is_mandatory":false,"description":"","uuid":"05edf3dd-1198-472b-90d9-4e793d9772a3","value":"10.46.34.96","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"PE_DATA_SERVICE_IP"},{"val_type":"STRING","is_mandatory":false,"uuid":"81f68e72-3225-4b55-8064-9fe5b292f917","name":"PE_USERNAME","value":"admin","label":"","editables":{"value":true},"is_hidden":false,"type":"LOCAL","description":""},{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"97029cb6-ddf4-4f63-9546-a57dab238049","label":"","attrs":{"is_secret_modified":false,"secret_reference":{"uuid":"f9cbde76-f35e-4894-9e88-fceb7d162e00"}},"editables":{"value":true},"is_hidden":false,"type":"SECRET","name":"PE_PASSWORD"},{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"2abdd609-5beb-42e5-9e8e-6a031a44ce24","value":"default-container-69049036518763","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"PE_CONTAINER_NAME"}],"uuid":"ec3b1924-dd2a-4b53-894a-86b92cc06792"},{"deployment_create_list":[{"name":"85fa2262_deployment","action_list":[],"package_local_reference_list":[{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"}],"description":"","depends_on_list":[],"min_replicas":"3","max_replicas":"3","published_service_local_reference_list":[],"editables":{"min_replicas":true,"max_replicas":true},"substrate_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"2c077429-6628-4a1d-8153-776c6ecd4247"},"type":"GREENFIELD","variable_list":[],"uuid":"d0f58896-b535-451c-a462-71690d7d9c43"},{"name":"d6584f2e_deployment","action_list":[],"package_local_reference_list":[{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"}],"description":"","depends_on_list":[],"min_replicas":"3","max_replicas":"9","published_service_local_reference_list":[],"editables":{"min_replicas":true,"max_replicas":true},"substrate_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SW","uuid":"190048e5-32e8-44b5-abe9-91374efc543b"},"type":"GREENFIELD","variable_list":[],"uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97"}],"description":"","action_list":[{"description":"","name":"Upgrade","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"2d64f4b3-5a29-40ba-b263-82f7fec0a1a2","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Version Master","uuid":"f6d4e79a-e7fb-4e99-9651-efd43e883d39"},{"kind":"app_task","name":"Set Version Minion","uuid":"36e20fe8-262f-4fe1-9719-ee99bd361eb7"},{"kind":"app_task","name":"Upgrade Controller","uuid":"b5295be0-9330-4b25-a319-ccf187c92698"},{"kind":"app_task","name":"Upgrade Minion","uuid":"fc8597e4-a24e-465a-8bef-0d4359b3c4b3"},{"kind":"app_task","name":"Restart Services","uuid":"5137ab29-3750-4752-96de-be48c143d8b2"}],"attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"f6d4e79a-e7fb-4e99-9651-efd43e883d39"},"edge_type":"user_defined","type":"","uuid":"3d9910eb-a035-41b4-945b-59252d83d483","to_task_reference":{"kind":"app_task","name":"Upgrade Controller","uuid":"b5295be0-9330-4b25-a319-ccf187c92698"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Controller","uuid":"b5295be0-9330-4b25-a319-ccf187c92698"},"edge_type":"user_defined","type":"","uuid":"417895f5-3366-4b10-92b7-ece43412f27f","to_task_reference":{"kind":"app_task","name":"Restart Services","uuid":"5137ab29-3750-4752-96de-be48c143d8b2"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"36e20fe8-262f-4fe1-9719-ee99bd361eb7"},"edge_type":"user_defined","type":"","uuid":"6230fe0c-0935-4fc4-9553-01acfa7500fc","to_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"fc8597e4-a24e-465a-8bef-0d4359b3c4b3"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"fc8597e4-a24e-465a-8bef-0d4359b3c4b3"},"edge_type":"user_defined","type":"","uuid":"e9cc9f4f-4868-4633-b540-40cf840b34c1","to_task_reference":{"kind":"app_task","name":"Restart Services","uuid":"5137ab29-3750-4752-96de-be48c143d8b2"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"17adda9e_dag"},{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"f6d4e79a-e7fb-4e99-9651-efd43e883d39","child_tasks_local_reference_list":[],"attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[],"name":"Set Version Master"},{"target_any_local_reference":{"kind":"app_service","uuid":"045659a2-932c-49c8-9269-3a911f955962","name":"Kubernetes_Worker"},"retries":"0","description":"","uuid":"36e20fe8-262f-4fe1-9719-ee99bd361eb7","child_tasks_local_reference_list":[],"attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[],"name":"Set Version Worker"},{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"b5295be0-9330-4b25-a319-ccf187c92698","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nCONTROLLER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=aws \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --cloud-provider=aws\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n\nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --cloud-provider=aws\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Upgrade Master"},{"target_any_local_reference":{"kind":"app_service","uuid":"045659a2-932c-49c8-9269-3a911f955962","name":"Kubernetes_Worker"},"retries":"0","description":"","uuid":"fc8597e4-a24e-465a-8bef-0d4359b3c4b3","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=aws \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Upgrade Worker"},{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"5137ab29-3750-4752-96de-be48c143d8b2","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_NAMES=\"@@{calm_array_private_dns_name}@@\" \nWORKER_NAMES=\"@@{AWS_Centos_K8SW.private_dns_name}@@\" \nJSONPATH='{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}'\nKUBE_VERSION_NEW=\"@@{KUBE_VERSION_NEW}@@\"\nMASTER_API_HTTPS=6443\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION_NEW}\/bin\/linux\/amd64\/kubectl\nchmod +x kubectl\nsudo mv kubectl \/usr\/local\/bin\/kubectl\n\ncount=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n  echo \"Trying to reach master server https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} : sleep for 5 secs\"\n  sleep 10\n  if [[ $count -eq 10 ]]; then\n  \techo \"Unable to reach master server: https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\"\n  \texit 1\n  fi\n  count=$((count+1))\ndone\n\nfor name in $(echo \"${WORKER_NAMES}\" | tr \",\" \"\\n\"); do\n  #kubectl drain \"$name\" --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no $name \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 20\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=${name} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon $name\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n\techo \"Upgrade failed on minion nodes\"\n    exit 1\nfi\n\nfor name in $(echo \"${MASTER_NAMES}\" | tr \",\" \"\\n\"); do\n  #kubectl drain \"${name}\" --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no $name \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 20\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=$name -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon $name\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n\techo \"Upgrade failed on nodes: $(kubectl get nodes -o jsonpath='$JSONPATH' | grep 'Ready=Unknown')\"\n    exit 1\nfi","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Restart Services"}],"description":"","uuid":"3be5f65e-36c5-4fa9-880e-0f0e28549370","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"ce94cfdc-536a-4566-bdad-e98e8d95c9e2","value":"v1.10.13","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_VERSION_NEW"}],"main_task_local_reference":{"kind":"app_task","name":"17adda9e_dag","uuid":"2d64f4b3-5a29-40ba-b263-82f7fec0a1a2"},"name":"dfce2dff_runbook"},"type":"user","uuid":"7cda09ba-214d-43ea-b9e2-8efbe2e8e485"},{"description":"","name":"ScaleOut","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"295d0e36-9672-40e8-be38-7767973cd5ec","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Out","uuid":"f15c88bd-2d9e-47df-9eb5-a1f24353f95f"},{"kind":"app_task","name":"Set Hosts File","uuid":"f829587f-e4df-43da-af6e-5caea8fdbda0"}],"attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Scale Out","uuid":"f15c88bd-2d9e-47df-9eb5-a1f24353f95f"},"edge_type":"user_defined","type":"","uuid":"05449fc7-1f82-4732-aba9-28bb2ec9078e","to_task_reference":{"kind":"app_task","name":"Set Hosts File","uuid":"f829587f-e4df-43da-af6e-5caea8fdbda0"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"a0fb1ecf_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97","name":"d6584f2e_deployment"},"retries":"0","description":"","uuid":"f15c88bd-2d9e-47df-9eb5-a1f24353f95f","child_tasks_local_reference_list":[],"attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","type":"SCALING","variable_list":[],"name":"Scale Out"},{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"f829587f-e4df-43da-af6e-5caea8fdbda0","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nWORKER_IPS=\"@@{AWS_Centos_K8SM.private_ip_address}@@\"\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  if ! (( $(grep -c \"${ip} worker${count}\" \/etc\/hosts) )) ; then\n    echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  fi\n  count=$((count+1))\ndone","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Set Hosts File"}],"description":"","uuid":"52c5d06d-3b9a-40e7-9261-b2053f0848ae","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"19428ec1-a3b4-43a7-b4c5-652e3a5cdf89","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"a0fb1ecf_dag","uuid":"295d0e36-9672-40e8-be38-7767973cd5ec"},"name":"55139b34_runbook"},"type":"user","uuid":"c345d056-f618-4983-acfe-49a13abf4536"},{"description":"","name":"ScaleIn","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"943cd2c6-ab32-4ef2-9d26-1f55e22674b5","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale In","uuid":"0ff30ce9-2bc7-40a4-a2b6-aa0e340e04fa"}],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"adfef604_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","uuid":"72e86e92-9738-41e0-bad3-0fcf79e92c97","name":"d6584f2e_deployment"},"retries":"0","description":"","uuid":"0ff30ce9-2bc7-40a4-a2b6-aa0e340e04fa","child_tasks_local_reference_list":[],"attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","type":"SCALING","variable_list":[],"name":"Scale In"}],"description":"","uuid":"98130d2f-61a7-439b-94ef-f5a17947a60d","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"8f5c2148-20e4-43b8-aece-88cdeb123189","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"adfef604_dag","uuid":"943cd2c6-ab32-4ef2-9d26-1f55e22674b5"},"name":"65df2c70_runbook"},"type":"user","uuid":"e9ea3ff6-3f7a-447f-b86e-dd8ef62e2bf2"}],"name":"AWS","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"28055f7b-8ef0-4620-951b-c50a597bdad9","value":"aws-kubenetes-cluster","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_CLUSTER_NAME"},{"val_type":"STRING","regex":{"should_validate":true,"value":"^v1\\.[0-9]?[0-9]\\.[0-9]?[0-9]$"},"is_mandatory":false,"description":"","uuid":"815b95b3-28e1-4250-b90b-07d3bcc41e0f","value":"v1.9.11","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_VERSION"},{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"0e439d74-ac24-469c-98e7-cf0dac220c3e","value":"17.03.3.ce","label":"","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{"type":"PREDEFINED","choices":["17.03.3.ce","17.06.2.ce","17.09.1.ce","17.12.1.ce","18.03.1.ce","18.06.3.ce"]},"name":"DOCKER_VERSION"},{"val_type":"STRING","regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\\/\\d{1,2}$"},"is_mandatory":false,"description":"","uuid":"e58b7529-9dce-430b-a3ae-26962c2556de","value":"10.200.0.0\/16","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_CLUSTER_SUBNET"},{"val_type":"STRING","regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\\/\\d{1,2}$"},"is_mandatory":false,"description":"","uuid":"524e9f26-0e50-409f-8357-0cf6db2eb73a","value":"10.32.0.0\/24","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_SERVICE_SUBNET"},{"val_type":"STRING","regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$"},"is_mandatory":false,"description":"","uuid":"aa75d332-b847-437f-9fc8-7dd5cda5c41e","value":"10.32.0.10","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_DNS_IP"},{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"7a5cf072-8d4d-45db-a864-9daadaeb09ed","value":"flannel","label":"","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{"type":"PREDEFINED","choices":["flannel","canal","calico"]},"name":"KUBE_CNI_PLUGIN"}],"uuid":"a4c73681-f48b-4889-8dfe-532bf51506f9"},{"deployment_create_list":[{"name":"34875daf_deployment","action_list":[],"package_local_reference_list":[{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"}],"description":"","depends_on_list":[],"min_replicas":"3","max_replicas":"3","published_service_local_reference_list":[],"editables":{"min_replicas":true,"max_replicas":true},"substrate_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"ff719bc6-bcca-4c1c-b691-a931bd6e2de5"},"type":"GREENFIELD","variable_list":[],"uuid":"41a81f4c-6289-4f56-aef8-b7f9003bb8fa"},{"name":"77b729d5_deployment","action_list":[],"package_local_reference_list":[{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"}],"description":"","depends_on_list":[],"min_replicas":"3","max_replicas":"9","published_service_local_reference_list":[],"editables":{"min_replicas":true,"max_replicas":true},"substrate_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SW","uuid":"fd41b059-b412-4c19-ba36-ca417a5806ab"},"type":"GREENFIELD","variable_list":[],"uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7"}],"description":"","action_list":[{"description":"","name":"Upgrade","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"6637ee0b-4435-4447-a45b-43c95dcbeb1a","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Version Master","uuid":"3e8012cf-3632-4be4-b4fb-9a357fc50d69"},{"kind":"app_task","name":"Set Version Worker","uuid":"a7d147bd-c7ce-4d0a-b93e-1e397e04ffb5"},{"kind":"app_task","name":"Upgrade Worker","uuid":"57d0630c-c7a2-425f-b4f0-d5717d3e6861"},{"kind":"app_task","name":"Upgrade Master","uuid":"1aba108d-dd2e-4d98-a956-c7360ebbbd30"},{"kind":"app_task","name":"Restart Services","uuid":"8894f79a-40bb-4a98-b27d-171d750eebcf"}],"attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"3e8012cf-3632-4be4-b4fb-9a357fc50d69"},"edge_type":"user_defined","type":"","uuid":"c1038158-7040-45ef-b0a7-8d162bf0abcf","to_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"1aba108d-dd2e-4d98-a956-c7360ebbbd30"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"1aba108d-dd2e-4d98-a956-c7360ebbbd30"},"edge_type":"user_defined","type":"","uuid":"d6b7e5df-edbe-4454-919a-d6601843b66c","to_task_reference":{"kind":"app_task","name":"Restart Services","uuid":"8894f79a-40bb-4a98-b27d-171d750eebcf"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Worker","uuid":"a7d147bd-c7ce-4d0a-b93e-1e397e04ffb5"},"edge_type":"user_defined","type":"","uuid":"59cc81be-110c-4fec-92bd-e30c821732aa","to_task_reference":{"kind":"app_task","name":"Upgrade Worker","uuid":"57d0630c-c7a2-425f-b4f0-d5717d3e6861"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Worker","uuid":"57d0630c-c7a2-425f-b4f0-d5717d3e6861"},"edge_type":"user_defined","type":"","uuid":"4fcda967-f38f-4bdc-9ad9-943235252ee2","to_task_reference":{"kind":"app_task","name":"Restart Services","uuid":"8894f79a-40bb-4a98-b27d-171d750eebcf"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"cbdb4fa8_dag"},{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"3e8012cf-3632-4be4-b4fb-9a357fc50d69","child_tasks_local_reference_list":[],"attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[],"name":"Set Version Master"},{"target_any_local_reference":{"kind":"app_service","uuid":"045659a2-932c-49c8-9269-3a911f955962","name":"Kubernetes_Worker"},"retries":"0","description":"","uuid":"a7d147bd-c7ce-4d0a-b93e-1e397e04ffb5","child_tasks_local_reference_list":[],"attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[],"name":"Set Version Worker"},{"target_any_local_reference":{"kind":"app_service","uuid":"045659a2-932c-49c8-9269-3a911f955962","name":"Kubernetes_Worker"},"retries":"0","description":"","uuid":"57d0630c-c7a2-425f-b4f0-d5717d3e6861","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=gce \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Upgrade Worker"},{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"1aba108d-dd2e-4d98-a956-c7360ebbbd30","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nMASTER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --cloud-provider=gce \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${MASTER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --cloud-provider=gce\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem  \n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --cloud-provider=gce\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Upgrade Master"},{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"8894f79a-40bb-4a98-b27d-171d750eebcf","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_NAMES=\"@@{calm_array_name}@@\" \nWORKER_NAMES=\"@@{GCP_Centos_K8SM.name}@@\" \nJSONPATH='{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}'\nKUBE_VERSION_NEW=\"@@{KUBE_VERSION_NEW}@@\"\nMASTER_API_HTTPS=6443\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION_NEW}\/bin\/linux\/amd64\/kubectl\nchmod +x kubectl\nsudo mv kubectl \/usr\/local\/bin\/kubectl\n\ncount=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n  echo \"Trying to reach master server https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} : sleep for 5 secs\"\n  sleep 10\n  if [[ $count -eq 10 ]]; then\n    echo \"Unable to reach master server: https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\"\n    exit 1\n  fi\n  count=$((count+1))\ndone\n\ncount=0\nfor name in $(echo \"${WORKER_NAMES}\" | tr \",\" \"\\n\"); do\n  #kubectl drain ${name} --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no \"worker${count}\" \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 20\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=${name} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon ${name}\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n  echo \"Upgrade failed on worker nodes\"\n    exit 1\nfi\n\ncount=0\nfor name in $(echo \"${MASTER_NAMES}\" | tr \",\" \"\\n\"); do\n  #kubectl drain $name --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no \"master${count}\" \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 20\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=$name -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon $name\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n  echo \"Upgrade failed on nodes: $(kubectl get nodes -o jsonpath='$JSONPATH' | grep 'Ready=Unknown')\"\n    exit 1\nfi","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Restart Services"}],"description":"","uuid":"e78e5e7b-42d6-428c-a28b-e60dda0687c3","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"188d0974-333c-4b60-a111-f5103ddfc955","value":"v1.10.13","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_VERSION_NEW"}],"main_task_local_reference":{"kind":"app_task","name":"cbdb4fa8_dag","uuid":"6637ee0b-4435-4447-a45b-43c95dcbeb1a"},"name":"8d003d32_runbook"},"type":"user","uuid":"a4e68551-86de-49ab-8271-ca59fd880d56"},{"description":"","name":"ScaleOut","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"509a6d0d-c81b-4d95-9aae-236fda989f16","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Out","uuid":"df3bf615-23dd-475a-97d5-329676c291d1"},{"kind":"app_task","name":"Set Hosts File","uuid":"77ddcd09-75f1-4c24-ac35-f896a0735cfb"}],"attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Scale Out","uuid":"df3bf615-23dd-475a-97d5-329676c291d1"},"edge_type":"user_defined","type":"","uuid":"b32099f3-bee9-427a-99c1-cad37440563d","to_task_reference":{"kind":"app_task","name":"Set Hosts File","uuid":"77ddcd09-75f1-4c24-ac35-f896a0735cfb"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"f3682593_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7","name":"77b729d5_deployment"},"retries":"0","description":"","uuid":"df3bf615-23dd-475a-97d5-329676c291d1","child_tasks_local_reference_list":[],"attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","type":"SCALING","variable_list":[],"name":"Scale Out"},{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"77ddcd09-75f1-4c24-ac35-f896a0735cfb","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nWORKER_IP=\"@@{GCP_Centos_K8SM.private_ip_address}@@\"\nfor ip in $(echo ${WORKER_IP} | tr \",\" \"\\n\"); do\n  if ! (( $(grep -c \"${ip} worker${count}\" \/etc\/hosts) )) ; then\n    echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  fi\n  count=$((count+1))\ndone","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Set Hosts File"}],"description":"","uuid":"31559a06-0af0-412f-9bff-1c7eb4b315ae","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"7d5d9272-a7dc-475a-bed8-0eec169a8a38","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"f3682593_dag","uuid":"509a6d0d-c81b-4d95-9aae-236fda989f16"},"name":"744583cd_runbook"},"type":"user","uuid":"83b597b1-2aeb-4a6c-8705-5c27db1bc8c8"},{"description":"","name":"ScaleIn","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"af79248d-510c-45b4-93c4-2890eeb56130","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale In","uuid":"1c80c7fc-23e2-4c89-acd0-28ee081f639c"}],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"853cb860_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","uuid":"78e07ffd-9c25-4005-aba0-444053ecbcd7","name":"77b729d5_deployment"},"retries":"0","description":"","uuid":"1c80c7fc-23e2-4c89-acd0-28ee081f639c","child_tasks_local_reference_list":[],"attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","type":"SCALING","variable_list":[],"name":"Scale In"}],"description":"","uuid":"85aebc49-2556-4dc3-a4ef-bcf97f67bad9","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"3c2b9b7f-1f1d-445b-a208-1ed32f801412","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"853cb860_dag","uuid":"af79248d-510c-45b4-93c4-2890eeb56130"},"name":"9331a25f_runbook"},"type":"user","uuid":"1ef8e495-de99-4003-bc0d-94d7b91e8b07"}],"name":"GCP","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"9152ff12-b13d-46cf-be40-0caa94292652","value":"gcp-kubenetes-cluster","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_CLUSTER_NAME"},{"val_type":"STRING","regex":{"should_validate":true,"value":"^v1\\.[0-9]?[0-9]\\.[0-9]?[0-9]$"},"is_mandatory":false,"description":"","uuid":"92c3efbd-d51e-4dd8-9dfc-97ed234eaa6a","value":"v1.9.11","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_VERSION"},{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"9724abca-2f8b-49f7-a7c7-7f48a5b4163d","value":"17.03.3.ce","label":"","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{"type":"PREDEFINED","choices":["17.03.3.ce","17.06.2.ce","17.09.1.ce","17.12.1.ce","18.03.1.ce","18.06.3.ce"]},"name":"DOCKER_VERSION"},{"val_type":"STRING","regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\\/\\d{1,2}$"},"is_mandatory":false,"description":"","uuid":"769f48b9-eb0f-4a22-addb-a78e5b12820b","value":"10.200.0.0\/16","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_CLUSTER_SUBNET"},{"val_type":"STRING","regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\\/\\d{1,2}$"},"is_mandatory":false,"description":"","uuid":"f6279bc8-47dd-4f73-a5a7-3fb0e51da17e","value":"10.32.0.0\/24","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_SERVICE_SUBNET"},{"val_type":"STRING","regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$"},"is_mandatory":false,"description":"","uuid":"e720df63-2436-4e79-83f8-441c037a7832","value":"10.32.0.10","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_DNS_IP"},{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"3e7d8b17-802e-4095-a99b-4d78bd483924","value":"flannel","label":"","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{"type":"PREDEFINED","choices":["flannel","canal","calico"]},"name":"KUBE_CNI_PLUGIN"}],"uuid":"234e6716-2347-4711-80e6-0525b24f6004"},{"deployment_create_list":[{"name":"34875daf_deployment_cloned_1","action_list":[],"package_local_reference_list":[{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"}],"description":"","depends_on_list":[],"min_replicas":"3","max_replicas":"3","published_service_local_reference_list":[],"editables":{"min_replicas":true,"max_replicas":true},"substrate_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"2fb2b374-c7af-42d5-b6e1-7cd0a3fe34a5"},"type":"GREENFIELD","variable_list":[],"uuid":"b81c9b76-a47d-4a40-b199-3ea41ef244a9"},{"name":"77b729d5_deployment_cloned_1","action_list":[],"package_local_reference_list":[{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"}],"description":"","depends_on_list":[],"min_replicas":"3","max_replicas":"9","published_service_local_reference_list":[],"editables":{"min_replicas":true,"max_replicas":true},"substrate_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SW","uuid":"03295a06-796d-4fa9-acec-3ad99de6e822"},"type":"GREENFIELD","variable_list":[],"uuid":"5fec9da3-ca77-445c-96cb-726df66c483e"}],"description":"","action_list":[{"description":"","name":"Upgrade","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"e0366f42-64ad-4dd4-8f8c-1b8a688a3564","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Version Master","uuid":"5c9fe27b-4a64-4fa5-be27-7606efa20e88"},{"kind":"app_task","name":"Set Version Worker","uuid":"dc594a7d-2d2c-4657-9e1e-2280f8150cb7"},{"kind":"app_task","name":"Upgrade Worker","uuid":"66935d23-badb-4391-bfce-1e838579ccf6"},{"kind":"app_task","name":"Upgrade Master","uuid":"1198aadb-24ba-405b-9a1b-e509ae2e14af"},{"kind":"app_task","name":"Restart Services","uuid":"892ba5b4-768b-4915-92e2-d6b07453410c"}],"attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"5c9fe27b-4a64-4fa5-be27-7606efa20e88"},"edge_type":"user_defined","type":"","uuid":"cbe1b611-4000-403a-a015-ca15cb7a0a92","to_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"1198aadb-24ba-405b-9a1b-e509ae2e14af"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"1198aadb-24ba-405b-9a1b-e509ae2e14af"},"edge_type":"user_defined","type":"","uuid":"5679158a-9c8e-494f-a8d3-a63df00455f3","to_task_reference":{"kind":"app_task","name":"Restart Services","uuid":"892ba5b4-768b-4915-92e2-d6b07453410c"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Worker","uuid":"dc594a7d-2d2c-4657-9e1e-2280f8150cb7"},"edge_type":"user_defined","type":"","uuid":"06c776bf-6fe7-41ad-aade-b13e63219f19","to_task_reference":{"kind":"app_task","name":"Upgrade Worker","uuid":"66935d23-badb-4391-bfce-1e838579ccf6"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Worker","uuid":"66935d23-badb-4391-bfce-1e838579ccf6"},"edge_type":"user_defined","type":"","uuid":"ff8a50e4-0294-46fa-b967-84200ba7a30f","to_task_reference":{"kind":"app_task","name":"Restart Services","uuid":"892ba5b4-768b-4915-92e2-d6b07453410c"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"cbdb4fa8_dag"},{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"5c9fe27b-4a64-4fa5-be27-7606efa20e88","child_tasks_local_reference_list":[],"attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[],"name":"Set Version Master"},{"target_any_local_reference":{"kind":"app_service","uuid":"045659a2-932c-49c8-9269-3a911f955962","name":"Kubernetes_Worker"},"retries":"0","description":"","uuid":"dc594a7d-2d2c-4657-9e1e-2280f8150cb7","child_tasks_local_reference_list":[],"attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[],"name":"Set Version Worker"},{"target_any_local_reference":{"kind":"app_service","uuid":"045659a2-932c-49c8-9269-3a911f955962","name":"Kubernetes_Worker"},"retries":"0","description":"","uuid":"66935d23-badb-4391-bfce-1e838579ccf6","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{KUBE_VERSION_NEW}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Upgrade Worker"},{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"1198aadb-24ba-405b-9a1b-e509ae2e14af","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{KUBE_VERSION_NEW}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nMASTER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${MASTER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem  \n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Upgrade Master"},{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"892ba5b4-768b-4915-92e2-d6b07453410c","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_NAMES=\"@@{calm_array_name}@@\" \nWORKER_NAMES=\"@@{Azure_Centos_K8SM.name}@@\" \nJSONPATH='{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}'\nKUBE_VERSION_NEW=\"@@{KUBE_VERSION_NEW}@@\"\nMASTER_API_HTTPS=6443\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION_NEW}\/bin\/linux\/amd64\/kubectl\nchmod +x kubectl\nsudo mv kubectl \/usr\/local\/bin\/kubectl\n\ncount=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n  echo \"Trying to reach master server https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} : sleep for 5 secs\"\n  sleep 10\n  if [[ $count -eq 10 ]]; then\n    echo \"Unable to reach master server: https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\"\n    exit 1\n  fi\n  count=$((count+1))\ndone\n\ncount=0\nfor name in $(echo \"${WORKER_NAMES}\" | tr \",\" \"\\n\"); do\n  #kubectl drain ${name} --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no \"worker${count}\" \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 20\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=${name} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon ${name}\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n  echo \"Upgrade failed on worker nodes\"\n    exit 1\nfi\n\ncount=0\nfor name in $(echo \"${MASTER_NAMES}\" | tr \",\" \"\\n\"); do\n  #kubectl drain $name --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no \"master${count}\" \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 20\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=$name -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon $name\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n  echo \"Upgrade failed on nodes: $(kubectl get nodes -o jsonpath='$JSONPATH' | grep 'Ready=Unknown')\"\n    exit 1\nfi","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Restart Services"}],"description":"","uuid":"fd62710a-7148-4d6b-86c9-661f5701050e","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"a8e2c7c3-a143-4525-8503-0b5b1e00447f","value":"v1.10.13","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_VERSION_NEW"}],"main_task_local_reference":{"kind":"app_task","name":"cbdb4fa8_dag","uuid":"e0366f42-64ad-4dd4-8f8c-1b8a688a3564"},"name":"8d003d32_runbook_cloned_1"},"type":"user","uuid":"31ec0369-6c24-4906-88e0-5e6824486dac"},{"description":"","name":"ScaleOut","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"0aebcf85-b0a7-4b70-9299-5c26c1fe271b","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Out","uuid":"2fc474ea-366d-4353-9059-38e1bfbc32ad"},{"kind":"app_task","name":"Set Hosts File","uuid":"e579bef7-4bd7-4718-a0a3-1c6adeeb14ed"}],"attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Scale Out","uuid":"2fc474ea-366d-4353-9059-38e1bfbc32ad"},"edge_type":"user_defined","type":"","uuid":"0cb35f4c-7e1e-4ce8-854b-ee8439a0adc7","to_task_reference":{"kind":"app_task","name":"Set Hosts File","uuid":"e579bef7-4bd7-4718-a0a3-1c6adeeb14ed"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"f3682593_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e","name":"77b729d5_deployment_cloned_1"},"retries":"0","description":"","uuid":"2fc474ea-366d-4353-9059-38e1bfbc32ad","child_tasks_local_reference_list":[],"attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","type":"SCALING","variable_list":[],"name":"Scale Out"},{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"e579bef7-4bd7-4718-a0a3-1c6adeeb14ed","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nWORKER_IPS=\"@@{Azure_Centos_K8SM.private_ip_address}@@\"\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  if ! (( $(grep -c \"${ip} worker${count}\" \/etc\/hosts) )) ; then\n    echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  fi\n  count=$((count+1))\ndone","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Set Hosts File"}],"description":"","uuid":"55f706f6-cbf1-4efc-b52e-46627e9797fd","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"197f1dbd-02bd-4260-981f-8dab982afaa8","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"f3682593_dag","uuid":"0aebcf85-b0a7-4b70-9299-5c26c1fe271b"},"name":"744583cd_runbook_cloned_1"},"type":"user","uuid":"163105fb-33ec-40c6-8462-4ceafb2d4c64"},{"description":"","name":"ScaleIn","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"c7eb6abc-9d8d-4d95-9c3d-901e261fef8c","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale In","uuid":"f99ee624-7029-481d-9e07-2e3536934e2a"}],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"853cb860_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","uuid":"5fec9da3-ca77-445c-96cb-726df66c483e","name":"77b729d5_deployment_cloned_1"},"retries":"0","description":"","uuid":"f99ee624-7029-481d-9e07-2e3536934e2a","child_tasks_local_reference_list":[],"attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","type":"SCALING","variable_list":[],"name":"Scale In"}],"description":"","uuid":"314ad507-aec0-410b-9ef5-7e693ba9f55c","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"81485e82-89bb-4a7f-942b-a471ca893c80","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"853cb860_dag","uuid":"c7eb6abc-9d8d-4d95-9c3d-901e261fef8c"},"name":"9331a25f_runbook_cloned_1"},"type":"user","uuid":"5ee03a07-399b-4ebf-8f8e-e943448b067d"}],"name":"Azure","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"de345935-65ee-4d63-92c4-cd87b4cc9fb0","value":"azure-kubenetes-cluster","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_CLUSTER_NAME"},{"val_type":"STRING","regex":{"should_validate":true,"value":"^v1\\.[0-9]?[0-9]\\.[0-9]?[0-9]$"},"is_mandatory":false,"description":"","uuid":"8377f5cf-7173-4405-ab6d-699c7f4fd2a7","value":"v1.9.11","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_VERSION"},{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"dc2501eb-5c7b-42a1-aac3-506a7286ec8d","value":"17.03.3.ce","label":"","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{"type":"PREDEFINED","choices":["17.03.3.ce","17.06.2.ce","17.09.1.ce","17.12.1.ce","18.03.1.ce","18.06.3.ce"]},"name":"DOCKER_VERSION"},{"val_type":"STRING","regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\\/\\d{1,2}$"},"is_mandatory":false,"description":"","uuid":"19daae5a-df3a-432d-924b-d4dad7607446","value":"10.200.0.0\/16","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_CLUSTER_SUBNET"},{"val_type":"STRING","regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\\/\\d{1,2}$"},"is_mandatory":false,"description":"","uuid":"e51e60a1-c84a-4fa7-8f60-7230c069a239","value":"10.32.0.0\/24","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_SERVICE_SUBNET"},{"val_type":"STRING","regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$"},"is_mandatory":false,"description":"","uuid":"92241c26-051a-4ec9-97cc-dcf7be1422b0","value":"10.32.0.10","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_DNS_IP"},{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"0b690623-eaaf-4790-870e-efeca65562bb","value":"flannel","label":"","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{"type":"PREDEFINED","choices":["flannel","canal","calico"]},"name":"KUBE_CNI_PLUGIN"}],"uuid":"e955aab5-825b-4057-b86d-b28d02bbefde"},{"deployment_create_list":[{"name":"2cbb2f6a_deployment_cloned_0","action_list":[],"package_local_reference_list":[{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"}],"description":"","depends_on_list":[],"min_replicas":"3","max_replicas":"3","published_service_local_reference_list":[],"editables":{"min_replicas":true,"max_replicas":true},"substrate_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SM","uuid":"eb19b05b-0c58-438e-aed0-2efba5c2019d"},"type":"GREENFIELD","variable_list":[],"uuid":"4b3985c8-846b-4321-9603-db0b165c02a9"},{"name":"39cf7283_deployment_cloned_0","action_list":[],"package_local_reference_list":[{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"}],"description":"","depends_on_list":[],"min_replicas":"2","max_replicas":"9","published_service_local_reference_list":[],"editables":{"min_replicas":true,"max_replicas":true},"substrate_local_reference":{"kind":"app_substrate","name":"VMware_Centos_K8SW","uuid":"4c3514f2-78b2-46b7-ba50-05f323515a8e"},"type":"GREENFIELD","variable_list":[],"uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e"}],"description":"","action_list":[{"description":"","name":"Upgrade","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"92bdd175-8835-4d2c-8bc6-a17bb4f43a7d","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Version Minion","uuid":"036cbe52-3fc5-490f-a9a2-d8b59b11acb3"},{"kind":"app_task","name":"Set Version Master","uuid":"b97e3fb1-1894-446e-b613-7f2e6cc56e63"},{"kind":"app_task","name":"Upgrade Minion","uuid":"46d8ca17-da47-4226-9f3b-99a317a0349d"},{"kind":"app_task","name":"Upgrade Master","uuid":"6ad16d9a-91c6-404b-ad11-a63bf08162b7"},{"kind":"app_task","name":"RestartServices","uuid":"21502b1b-e95e-45db-84f0-3994571aaca0"}],"attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"b97e3fb1-1894-446e-b613-7f2e6cc56e63"},"edge_type":"user_defined","type":"","uuid":"7e972475-df92-417d-a614-d89abacf86bb","to_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"6ad16d9a-91c6-404b-ad11-a63bf08162b7"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"6ad16d9a-91c6-404b-ad11-a63bf08162b7"},"edge_type":"user_defined","type":"","uuid":"f5b53dbf-615a-4611-9bda-aaa50b5e57dc","to_task_reference":{"kind":"app_task","name":"RestartServices","uuid":"21502b1b-e95e-45db-84f0-3994571aaca0"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"036cbe52-3fc5-490f-a9a2-d8b59b11acb3"},"edge_type":"user_defined","type":"","uuid":"4772b56c-4bc3-4ac9-a670-c10bb6273cd6","to_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"46d8ca17-da47-4226-9f3b-99a317a0349d"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"46d8ca17-da47-4226-9f3b-99a317a0349d"},"edge_type":"user_defined","type":"","uuid":"eba27cdd-98f0-45bc-9c0b-7554f58a0126","to_task_reference":{"kind":"app_task","name":"RestartServices","uuid":"21502b1b-e95e-45db-84f0-3994571aaca0"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"6ee65d8a_dag_cloned_1"},{"target_any_local_reference":{"kind":"app_service","uuid":"045659a2-932c-49c8-9269-3a911f955962","name":"Kubernetes_Worker"},"retries":"0","description":"","uuid":"036cbe52-3fc5-490f-a9a2-d8b59b11acb3","child_tasks_local_reference_list":[],"attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[],"name":"Set Version Minion"},{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"b97e3fb1-1894-446e-b613-7f2e6cc56e63","child_tasks_local_reference_list":[],"attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[],"name":"Set Version Master"},{"target_any_local_reference":{"kind":"app_service","uuid":"045659a2-932c-49c8-9269-3a911f955962","name":"Kubernetes_Worker"},"retries":"0","description":"","uuid":"46d8ca17-da47-4226-9f3b-99a317a0349d","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Upgrade Minion"},{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"6ad16d9a-91c6-404b-ad11-a63bf08162b7","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nMASTER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${MASTER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false \n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Upgrade Master"},{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"21502b1b-e95e-45db-84f0-3994571aaca0","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_NAMES=\"@@{VMware_Centos_K8SW.address}@@\"\nJSONPATH='{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}'\nKUBE_VERSION_NEW=\"@@{KUBE_VERSION_NEW}@@\"\nMASTER_API_HTTPS=6443\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION_NEW}\/bin\/linux\/amd64\/kubectl\nchmod +x kubectl\nsudo mv kubectl \/usr\/local\/bin\/kubectl\n\ncount=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n  echo \"Trying to reach master server https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} : sleep for 5 secs\"\n  sleep 10\n  if [[ $count -eq 10 ]]; then\n    echo \"Unable to reach master server: https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\"\n    exit 1\n  fi\n  count=$((count+1))\ndone\n\ncount=0\nfor ip in $(echo \"${WORKER_NAMES}\" | tr \",\" \"\\n\"); do\n  #kubectl drain \"worker${count}\" --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no $ip \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 10\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=worker${count} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon worker${count}\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n  echo \"Upgrade failed on worker nodes\"\n    exit 1\nfi\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  #kubectl drain \"master${count}\" --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no $ip \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 10\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=master${count} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon master${count}\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n  echo \"Upgrade failed on nodes: $(kubectl get nodes -o jsonpath='$JSONPATH' | grep 'Ready=Unknown')\"\n    exit 1\nfi","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"RestartServices"}],"description":"","uuid":"8208b8bb-6803-4cf6-98f7-486858546a33","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"7e38c6d8-9217-4d26-b901-79a99d439261","value":"v1.10.13","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_VERSION_NEW"}],"main_task_local_reference":{"kind":"app_task","name":"6ee65d8a_dag_cloned_1","uuid":"92bdd175-8835-4d2c-8bc6-a17bb4f43a7d"},"name":"68a7ffd0_runbook_cloned_0"},"type":"user","uuid":"b588f833-9ab3-4660-8bce-46fc9241452b"},{"description":"","name":"ScaleOut","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"3a80fefb-860c-4532-8c7a-6c6c765f7132","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Out","uuid":"e1ef73bd-cd0f-4fe4-9023-da96388ae6c1"},{"kind":"app_task","name":"Set Hosts file","uuid":"0ff769e7-d60c-4086-a68d-f5b82461e4be"}],"attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Scale Out","uuid":"e1ef73bd-cd0f-4fe4-9023-da96388ae6c1"},"edge_type":"user_defined","type":"","uuid":"83b9e564-9f2d-4e44-9c11-8d33fc5c51d0","to_task_reference":{"kind":"app_task","name":"Set Hosts file","uuid":"0ff769e7-d60c-4086-a68d-f5b82461e4be"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"03b33121_dag_cloned_1"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e","name":"39cf7283_deployment_cloned_0"},"retries":"0","description":"","uuid":"e1ef73bd-cd0f-4fe4-9023-da96388ae6c1","child_tasks_local_reference_list":[],"attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","type":"SCALING","variable_list":[],"name":"Scale Out"},{"target_any_local_reference":{"kind":"app_service","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"0ff769e7-d60c-4086-a68d-f5b82461e4be","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nMINION_IPS=\"@@{VMware_Centos_K8SM.address}@@\"\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  if ! (( $(grep -c \"${ip} minion${count}\" \/etc\/hosts) )) ; then\n  \techo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  fi\n  count=$((count+1))\ndone","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Set Hosts file"}],"description":"","uuid":"cb22e4c9-c256-434f-a553-4b59f022bfc4","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"6efc1add-f50b-4353-b7a0-af46316f8425","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"03b33121_dag_cloned_1","uuid":"3a80fefb-860c-4532-8c7a-6c6c765f7132"},"name":"00cf5417_runbook_cloned_0"},"type":"user","uuid":"9b1c7248-8451-441d-a8d5-25a08002fd9c"},{"description":"","name":"ScaleIn","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"56530059-4668-43c9-91b7-3d6261842e6f","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale In","uuid":"3f7a2048-8271-44a4-81a9-c1976a1be83b"}],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"e72a9133_dag_cloned_1"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","uuid":"e51f257b-fa1f-4293-8b25-64b1e57d824e","name":"39cf7283_deployment_cloned_0"},"retries":"0","description":"","uuid":"3f7a2048-8271-44a4-81a9-c1976a1be83b","child_tasks_local_reference_list":[],"attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","type":"SCALING","variable_list":[],"name":"Scale In"}],"description":"","uuid":"5e54ded6-d632-47c1-8fcb-998eecd48fe2","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"942292cc-68d7-4e1c-981e-f1aeb26ce1c1","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"e72a9133_dag_cloned_1","uuid":"56530059-4668-43c9-91b7-3d6261842e6f"},"name":"96546f6c_runbook_cloned_0"},"type":"user","uuid":"427b9818-cb0d-4575-a7be-1080b0569a98"}],"name":"VMware","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"61f5cb6e-b1f4-4696-99e2-5e29ba0fda24","value":"vmware-kubenetes-cluster","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_CLUSTER_NAME"},{"val_type":"STRING","regex":{"should_validate":true,"value":"^v1\\.[0-9]?[0-9]\\.[0-9]?[0-9]$"},"is_mandatory":false,"description":"","uuid":"242ab196-7a93-4a1b-b131-58178311ae91","value":"v1.9.11","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_VERSION"},{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"ab81f35c-8e24-46b8-bc48-923c0a7a8093","value":"17.03.3.ce","label":"","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{"type":"PREDEFINED","choices":["17.03.3.ce","17.06.2.ce","17.09.1.ce","17.12.1.ce","18.03.1.ce","18.06.3.ce"]},"name":"DOCKER_VERSION"},{"val_type":"STRING","regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\\/\\d{1,2}$"},"is_mandatory":false,"description":"","uuid":"19a52dd5-04c6-4358-8382-7429130abf09","value":"10.200.0.0\/16","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_CLUSTER_SUBNET"},{"val_type":"STRING","regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\\/\\d{1,2}$"},"is_mandatory":false,"description":"","uuid":"b7e59261-7a0c-4f27-badc-d66057fd0953","value":"10.32.0.0\/24","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_SERVICE_SUBNET"},{"val_type":"STRING","regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$"},"is_mandatory":false,"description":"","uuid":"233d7887-4060-451d-a0d3-6f998a339f24","value":"10.32.0.10","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"KUBE_DNS_IP"},{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"d1238e53-69cb-4283-9c7c-d8ece2ca8c49","value":"flannel","label":"","attrs":{"type":"LOCAL"},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{"type":"PREDEFINED","choices":["flannel","canal","calico"]},"name":"KUBE_CNI_PLUGIN"},{"val_type":"STRING","regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$"},"is_mandatory":false,"description":"","uuid":"f1163ab1-219d-4bfb-a887-6177a5c5f73d","value":"10.46.33.177","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"PE_CLUSTER_IP"},{"val_type":"STRING","regex":{"should_validate":true,"value":"^\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}$"},"is_mandatory":false,"description":"","uuid":"cc1ce60a-200c-4418-b260-7e2f3e1a8cf4","value":"10.46.33.4","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"PE_DATA_SERVICE_IP"},{"val_type":"STRING","is_mandatory":false,"uuid":"064697b0-4c94-483b-a6f3-0b0d6908a2f9","name":"PE_USERNAME","value":"admin","label":"","editables":{"value":true},"is_hidden":false,"type":"LOCAL","description":""},{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"d9cf57f5-c30c-4f86-a63f-b02f4824c49b","label":"","attrs":{"is_secret_modified":false,"secret_reference":{"uuid":"6a818714-97c5-4320-9773-81c8cb1d2479"}},"editables":{"value":true},"is_hidden":false,"type":"SECRET","name":"PE_PASSWORD"},{"val_type":"STRING","is_mandatory":false,"description":"","uuid":"2efcb003-0592-4bbd-a5b8-eacf660172b0","value":"default-container-71224","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","name":"PE_CONTAINER_NAME"}],"uuid":"a1ec0f17-c623-4c1b-bb5f-c9672dfa6fea"}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"CENTOS","uuid":"70ea3312-6ea8-4ace-9433-d77766f00ba2"},"package_definition_list":[{"uuid":"22e18386-fa75-402e-9fd9-aa32056cb746","action_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"}],"name":"AHV_Centos_K8SM_Package","version":"","type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"},"retries":"0","name":"dac441af_dag","type":"DAG","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"fe928d5c-3674-4e54-be1a-ceff751b83fc"},{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"60a50e8a-e2fb-4d88-82f7-e0821461371b"},{"kind":"app_task","name":"Generate Certs","uuid":"3cc49ad3-44d3-4b81-8252-af87eb1816e6"},{"kind":"app_task","name":"Configure Services","uuid":"056a3681-f7b5-4937-9f8c-83ec8c45e753"},{"kind":"app_task","name":"Add User Roles","uuid":"13077133-beda-4566-ac35-e637c8d504ed"},{"kind":"app_task","name":"Network Configuration","uuid":"8fab44c0-5cd6-4e36-9b77-db6fd8fd6993"},{"kind":"app_task","name":"DNS Configuration","uuid":"edeb2357-deeb-49ae-be66-7d6066b60c7f"},{"kind":"app_task","name":"NVP Configuration","uuid":"bff2dae4-0d71-404e-ab32-cd4db81a887a"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"fe928d5c-3674-4e54-be1a-ceff751b83fc"},"edge_type":"user_defined","type":"","uuid":"36d1c5b8-2355-426c-ba27-903ebbf6b195","to_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"60a50e8a-e2fb-4d88-82f7-e0821461371b"}},{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"60a50e8a-e2fb-4d88-82f7-e0821461371b"},"edge_type":"user_defined","type":"","uuid":"1a31216d-aa38-42ed-a18a-60226580df1a","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"3cc49ad3-44d3-4b81-8252-af87eb1816e6"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"3cc49ad3-44d3-4b81-8252-af87eb1816e6"},"edge_type":"user_defined","type":"","uuid":"3ba5aff3-4ae7-4fee-b071-1fe06251fcb9","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"056a3681-f7b5-4937-9f8c-83ec8c45e753"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"056a3681-f7b5-4937-9f8c-83ec8c45e753"},"edge_type":"user_defined","type":"","uuid":"1bf63fa5-1194-4c46-a9e1-60dcdb5c8132","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"13077133-beda-4566-ac35-e637c8d504ed"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"13077133-beda-4566-ac35-e637c8d504ed"},"edge_type":"user_defined","type":"","uuid":"cf6f6dce-44a8-4ea2-a099-40684682c7bf","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"8fab44c0-5cd6-4e36-9b77-db6fd8fd6993"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"8fab44c0-5cd6-4e36-9b77-db6fd8fd6993"},"edge_type":"user_defined","type":"","uuid":"e6445df3-e8d2-4fc6-a974-b1021fd35bff","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"edeb2357-deeb-49ae-be66-7d6066b60c7f"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"edeb2357-deeb-49ae-be66-7d6066b60c7f"},"edge_type":"user_defined","type":"","uuid":"691a7fe4-bc87-472c-9b45-a30fba2ac0c8","to_task_reference":{"kind":"app_task","name":"NVP Configuration","uuid":"bff2dae4-0d71-404e-ab32-cd4db81a887a"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"8fe8c5d1-5aaa-48f6-a089-811b9d7d0d0e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"Set Kubernetes Version","type":"SET_VARIABLE","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"fe928d5c-3674-4e54-be1a-ceff751b83fc"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"ETCD Docker Kubelet Install","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\ncount=0\n# Verify access to Centos mirror before yum update\ncheck_mirror() {\ncurl -s mirrorlist.centos.org >\/dev\/null | true\nif [ \"${PIPESTATUS[0]}\" -ne 0 ]; then\n    if [ ${count} -lt 60 ]; then\n        echo \"Sleeping for 5 seconds before repeating the check\" | sudo tee -a \/var\/log\/messages\n        sleep 5\n        count=$((count+1))\n        check_mirror\n    else\n        echo \"DNS resolution failed after 5 minutes, exiting\" | sudo tee -a \/var\/log\/messages\n        exit 1\n    fi\nfi\n}\ncheck_mirror\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.3.12\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_IPS=\"@@{AHV_Centos_K8SW.address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} master${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"master${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  count=$((count+1))\ndone  \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\necho \"if \\$programname == 'etcd' then \/var\/log\/etcd.log\n& stop\" | sudo tee \/etc\/rsyslog.d\/etcd.conf\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"if \\$programname == 'kubelet' then \/var\/log\/kubelet.log\n& stop\" | sudo tee \/etc\/rsyslog.d\/kubelet.conf\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate etcd \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/sd{e,f,g}\nsudo vgcreate docker \/dev\/sd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"60a50e8a-e2fb-4d88-82f7-e0821461371b"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"Generate Certs","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_IPS=\"@@{AHV_Centos_K8SW.address}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"master${count}\",\n  count=$((count+1))\ndone\n\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"worker${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_NAMES},${MASTER_IPS},${MINION_NAMES},${WORKER_IPS},${FIRST_IP_SERVICE_SUBNET},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local -profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\ninstance=\"master${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=master${count}.kubeconfig\nkubectl config set-credentials system:node:master${count} --client-certificate=master${count}.pem --client-key=master${count}-key.pem --embed-certs=true --kubeconfig=master${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:master${count} --kubeconfig=master${count}.kubeconfig\nkubectl config use-context default --kubeconfig=master${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"master${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"3cc49ad3-44d3-4b81-8252-af87eb1816e6"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"Configure Services","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nCONTROLLER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=${KUBE_CLUSTER_NAME}\n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n    \necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"056a3681-f7b5-4937-9f8c-83ec8c45e753"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"Add User Roles","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet iscsid\nsudo systemctl enable etcd docker kubelet iscsid\nsudo systemctl restart rsyslog\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem master* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"13077133-beda-4566-ac35-e637c8d504ed"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"Network Configuration","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ]]; then\nsudo mkdir -p \/etc\/kubernetes\/addons\/canal\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: canal-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  canal_iface: \"\"\n\n  masquerade: \"true\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: canal\n  namespace: kube-system\n  labels:\n    k8s-app: canal\nspec:\n  selector:\n    matchLabels:\n      k8s-app: canal\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: canal\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: canal\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-canal.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              value: \"none\"\n            - name: CLUSTER_TYPE\n              value: \"k8s,canal\"\n            - name: FELIX_IPTABLESREFRESHINTERVAL\n              value: \"60\"\n            - name: IP\n              value: \"\"\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"192.168.0.0\/16\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: \/readiness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n        - name: kube-flannel\n          image: quay.io\/coreos\/flannel:v0.9.1\n          command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n          securityContext:\n            privileged: true\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: FLANNELD_IFACE\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: canal_iface\n            - name: FLANNELD_IP_MASQ\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: masquerade\n          volumeMounts:\n          - mountPath: \/run\/xtables.lock\n            name: xtables-lock\n            readOnly: false\n          - name: flannel-cfg\n            mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: flannel-cfg\n          configMap:\n            name: canal-config\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: canal\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: canal-flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: canal-calico\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/canal\/canal.yml\nkubectl create -f \/etc\/kubernetes\/addons\/canal\/canal.yml\n\nelif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]];then\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/calico\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  calico_backend: \"bird\"\n\n  veth_mtu: \"1440\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: calico-node\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-calico.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CNI_MTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s,bgp\"\n            - name: IP\n              value: \"autodetect\"\n            - name: CALICO_IPV4POOL_IPIP\n              value: \"Always\"\n            - name: FELIX_IPINIPMTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"@@{KUBE_CLUSTER_SUBNET}@@\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            exec:\n              command:\n              - \/bin\/calico-node\n              - -bird-ready\n              - -felix-ready\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPPeer\n    plural: bgppeers\n    singular: bgppeer\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/calico\/calico.yml\nkubectl create -f \/etc\/kubernetes\/addons\/calico\/calico.yml  \n\nelse\n  echo \"Defaulting to flannel\"\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n  - kind: ServiceAccount\n    name: flannel\n    namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"hairpinMode\": true,\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - \/opt\/bin\/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n          limits:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/bin\/sh\", \"-c\", \"set -e -x; cp -f \/etc\/kube-flannel\/cni-conf.json \/etc\/cni\/net.d\/10-flannel.conf; while true; do sleep 3600; done\" ]\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nfi\n\nsleep 15\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"8fab44c0-5cd6-4e36-9b77-db6fd8fd6993"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"DNS Configuration","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n  - name: dns\n    port: 53\n    protocol: UDP\n  - name: dns-tcp\n    port: 53\n    protocol: TCP\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: k8s.gcr.io\/k8s-dns-kube-dns:1.14.13\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: k8s.gcr.io\/k8s-dns-dnsmasq-nanny:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --no-negcache\n        - --dns-loop-detect\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: k8s.gcr.io\/k8s-dns-sidecar:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local,5,SRV\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local,5,SRV\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy: Default\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.2.0\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          - --target=Deployment\/kube-dns\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"edeb2357-deeb-49ae-be66-7d6066b60c7f"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"NVP Configuration","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nPRISM_CLUSTER_IP=\"@@{PE_CLUSTER_IP}@@\"\nPRISM_DATA_SERVICE_IP=\"@@{PE_CLUSTER_IP}@@\"\n\nif [[ (\"${PRISM_CLUSTER_IP}x\" == \"x\") && (\"${PRISM_DATA_SERVICE_IP}x\" == \"x\") ]]; then exit 0; fi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/volume_plugin\nNTNX_SECRET=$(echo -n \"@@{PE_USERNAME}@@:@@{PE_PASSWORD}@@\" | base64)\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: nutanixabs-provisioner-runner\n  namespace: kube-system\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumes\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumeclaims\"]\n    verbs: [\"get\", \"list\", \"watch\", \"update\"]\n  - apiGroups: [\"storage.k8s.io\"]\n    resources: [\"storageclasses\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"list\", \"watch\", \"create\", \"update\", \"patch\"]\n  - apiGroups: [\"\"]\n    resources: [\"services\"]\n    verbs: [\"get\"]\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"create\", \"delete\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: run-nutanixabs-provisioner\n  namespace: kube-system\nsubjects:\n  - kind: ServiceAccount\n    name: nutanixabs-provisioner\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: nutanixabs-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      labels:\n        app: nutanixabs-provisioner\n    spec:\n      serviceAccount: nutanixabs-provisioner\n      hostNetwork: true\n      containers:\n        -\n          image: \"ntnx\/nutanixabs-provisioner\"\n          name: nutanixabs-provisioner\n          args: [\"--v=4\"]\n          imagePullPolicy: IfNotPresent\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: kube-system\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\n---\nkind: StorageClass\napiVersion: storage.k8s.io\/v1\nmetadata:\n  name: silver \n  namespace: kube-system\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\nprovisioner: nutanix\/abs\nparameters:\n     prismEndPoint: @@{PE_CLUSTER_IP}@@:9440\n     dataServiceEndPoint: @@{PE_DATA_SERVICE_IP}@@:3260\n     secretName: ntnx-secret\n     storageContainer: @@{PE_CONTAINER_NAME}@@\n     fsType: ext4\n     chapAuthEnabled: \"false\"' | sudo tee \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\necho \"apiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: default\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\" | sudo tee -a \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"bff2dae4-0d71-404e-ab32-cd4db81a887a"}],"name":"8e760b73_runbook","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"dac441af_dag","uuid":"8fe8c5d1-5aaa-48f6-a089-811b9d7d0d0e"},"uuid":"73124b74-b2af-4082-bec4-7cecb8d5f8bb"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"22e18386-fa75-402e-9fd9-aa32056cb746"},"retries":"0","name":"6324786a_dag","type":"DAG","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"c7f90cc3-f508-41b2-a289-7a55fc30de35"}],"name":"6522ac7a_runbook","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"6324786a_dag","uuid":"c7f90cc3-f508-41b2-a289-7a55fc30de35"},"uuid":"ca5f1ae4-f604-456d-9302-d1c6858e9cca"}},"variable_list":[],"description":""},{"uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e","action_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"}],"name":"AHV_Centos_K8SW_Package","version":"","type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"},"retries":"0","name":"c1566b3d_dag","type":"DAG","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"1ba5c814-58b2-4ef7-abd4-c45bb1597e77"},{"kind":"app_task","name":"Docker Kubelet Install","uuid":"099fff07-8d75-49fc-9034-6c5f8906334d"},{"kind":"app_task","name":"GetCerts","uuid":"c36fc474-4fc7-42d9-8e63-b5cf37e2ecba"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"1ba5c814-58b2-4ef7-abd4-c45bb1597e77"},"edge_type":"user_defined","type":"","uuid":"36a33d61-9fe9-4ebf-9c33-dd90e113e992","to_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"099fff07-8d75-49fc-9034-6c5f8906334d"}},{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"099fff07-8d75-49fc-9034-6c5f8906334d"},"edge_type":"user_defined","type":"","uuid":"dfcf0803-d531-4422-bdf7-99c7539461ba","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"c36fc474-4fc7-42d9-8e63-b5cf37e2ecba"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"e0360d55-975f-4b97-a73c-e1eaabd0390f"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","name":"Set Kubernetes Version","type":"SET_VARIABLE","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"1ba5c814-58b2-4ef7-abd4-c45bb1597e77"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","name":"Docker Kubelet Install","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\ncount=0\n# Verify access to Centos mirror before yum update\ncheck_mirror() {\ncurl -s mirrorlist.centos.org >\/dev\/null | true\nif [ \"${PIPESTATUS[0]}\" -ne 0 ]; then\n    if [ ${count} -lt 60 ]; then\n        echo \"Sleeping for 5 seconds before repeating the check\"\n        sleep 5\n        count=$((count+1))\n        check_mirror\n    else\n        echo \"DNS resolution failed after 5 minutes, exiting\"\n        exit 1\n    fi\nfi\n}\ncheck_mirror\n\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"if \\$programname == 'kubelet' then \/var\/log\/kubelet.log\n& stop\" | sudo tee \/etc\/rsyslog.d\/kubelet.conf\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"099fff07-8d75-49fc-9034-6c5f8906334d"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","name":"GetCerts","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{AHV_Centos_K8SM.address[0]}@@\"\nINSTANCE_IP=\"@@{address}@@\"\ninstance=\"worker@@{calm_array_index}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nsudo systemctl start iscsid\nsudo systemctl restart rsyslog\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; if [[ $count -eq 600 ]]; then echo \"failed to download certs\" && exit 1; fi; count=$(($count+5)) ; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${instance} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${instance} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"c36fc474-4fc7-42d9-8e63-b5cf37e2ecba"}],"name":"9a6e189b_runbook","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"c1566b3d_dag","uuid":"e0360d55-975f-4b97-a73c-e1eaabd0390f"},"uuid":"ca7feba8-9c3a-45b2-89e4-136abdc49c2b"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"24dd623b-a6ae-43d6-b8ef-adad0e20ce9e"},"retries":"0","name":"abd3357c_dag","type":"DAG","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"d7e9ee5d-0644-416e-98fe-edc0d0828cd3"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"1e7d26f2-668f-4fbc-802a-a434951b94d4"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","name":"Remove Node","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain 'worker@@{calm_array_index}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node 'worker@@{calm_array_index}@@'\"","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"d7e9ee5d-0644-416e-98fe-edc0d0828cd3"}],"name":"3cb17acf_runbook","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"abd3357c_dag","uuid":"1e7d26f2-668f-4fbc-802a-a434951b94d4"},"uuid":"6f422867-891e-4b13-977d-fa640f0d3330"}},"variable_list":[],"description":""},{"uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6","action_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"}],"name":"AWS_Centos_K8SM_Package","version":"","type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"},"retries":"0","name":"84e097cf_dag","type":"DAG","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"f542c0ea-1657-4039-92e4-171897dc94cd"},{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"5e8f303d-fefa-4900-b070-d8f6086a3684"},{"kind":"app_task","name":"Generate Certs","uuid":"3772aab0-cf05-4779-b657-672a951c97a3"},{"kind":"app_task","name":"Configure Services","uuid":"0609cf4d-8689-4c65-8464-49aec84b95a1"},{"kind":"app_task","name":"Add User Roles","uuid":"ae1b7bbc-a3e9-4fc3-bf46-71c15a8b2c90"},{"kind":"app_task","name":"Network Configuration","uuid":"fdb6b70e-e4a8-452a-bfdb-7125ec563f87"},{"kind":"app_task","name":"DNS Configuration","uuid":"9b102b01-091c-4e25-b54c-faf1e8744c7e"},{"kind":"app_task","name":"EBS VolumePlugin","uuid":"bb84fcf0-b54f-4e39-92a0-14c53ca802af"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"f542c0ea-1657-4039-92e4-171897dc94cd"},"edge_type":"user_defined","type":"","uuid":"393b023b-e6d2-41a4-8c81-dd74bccce4c1","to_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"5e8f303d-fefa-4900-b070-d8f6086a3684"}},{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"5e8f303d-fefa-4900-b070-d8f6086a3684"},"edge_type":"user_defined","type":"","uuid":"364ee192-14bc-45cd-abf0-f85442c23a1a","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"3772aab0-cf05-4779-b657-672a951c97a3"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"3772aab0-cf05-4779-b657-672a951c97a3"},"edge_type":"user_defined","type":"","uuid":"297c9e2b-ae2e-4fe1-b1fb-769d1b0f62fe","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"0609cf4d-8689-4c65-8464-49aec84b95a1"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"0609cf4d-8689-4c65-8464-49aec84b95a1"},"edge_type":"user_defined","type":"","uuid":"44f5a8a2-6171-4ac1-b60d-c4f2fd5937ca","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"ae1b7bbc-a3e9-4fc3-bf46-71c15a8b2c90"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"ae1b7bbc-a3e9-4fc3-bf46-71c15a8b2c90"},"edge_type":"user_defined","type":"","uuid":"4b966a75-83ca-4ebb-910f-818f08ea5489","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"fdb6b70e-e4a8-452a-bfdb-7125ec563f87"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"fdb6b70e-e4a8-452a-bfdb-7125ec563f87"},"edge_type":"user_defined","type":"","uuid":"c337bb68-9651-4eb1-b6e7-bc5a875249e4","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"9b102b01-091c-4e25-b54c-faf1e8744c7e"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"9b102b01-091c-4e25-b54c-faf1e8744c7e"},"edge_type":"user_defined","type":"","uuid":"76e183c1-30d8-4507-9698-42b6da4461d5","to_task_reference":{"kind":"app_task","name":"EBS VolumePlugin","uuid":"bb84fcf0-b54f-4e39-92a0-14c53ca802af"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"eb0a4fbb-7076-41cd-904a-0eab8de3d5e4"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"Set Kubernetes Version","type":"SET_VARIABLE","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"f542c0ea-1657-4039-92e4-171897dc94cd"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"ETCD Docker Kubelet Install","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.3.12\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nWORKER_IPS=\"@@{AWS_Centos_K8SW.private_ip_address}@@\" # private Ip's\nMASTER_DNS=\"@@{calm_array_private_dns_name}@@\" # private Dns\nWORKER_DNS=\"@@{AWS_Centos_K8SW.private_dns_name}@@\" # private Dns\nPUBLIC_MASTER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_WORKER_IPS=\"@@{AWS_Centos_K8SW.public_ip_address}@@\"\nPUBLIC_MASTER_DNS=\"@@{calm_array_public_dns_name}@@\"\nPUBLIC_WORKER_DNS=\"@@{AWS_Centos_K8SW.public_dns_name}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y --quiet\nsudo yum install -y wget iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} master${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"master${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  count=$((count+1))\ndone   \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=aws \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/xvd{b,c,d}\nsudo vgcreate etcd \/dev\/xvd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/xvd{e,f,g}\nsudo vgcreate docker \/dev\/xvd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"5e8f303d-fefa-4900-b070-d8f6086a3684"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"Generate Certs","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\ndeclare -a INSTANCE_IPS\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nWORKER_IPS=\"@@{AWS_Centos_K8SW.private_ip_address}@@\" # private Ip's\nMASTER_DNS=\"@@{calm_array_private_dns_name}@@\" # private Dns\nWORKER_DNS=\"@@{AWS_Centos_K8SW.private_dns_name}@@\" # private Dns\nINSTANCE_IPS=($(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"))\nPUBLIC_MASTER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_WORKER_IPS=\"@@{AWS_Centos_K8SW.public_ip_address}@@\"\nPUBLIC_MASTER_DNS=\"@@{calm_array_public_dns_name}@@\"\nPUBLIC_WORKER_DNS=\"@@{AWS_Centos_K8SW.public_dns_name}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"master${count}\",\n  count=$((count+1))\ndone\nMASTER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"worker${count}\",\n  count=$((count+1))\ndone\nWORKER_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${MASTER_DNS},${PUBLIC_MASTER_IPS},${PUBLIC_MASTER_DNS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${MASTER_DNS},${PUBLIC_MASTER_IPS},${PUBLIC_MASTER_DNS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${MASTER_DNS},${PUBLIC_MASTER_IPS},${PUBLIC_MASTER_DNS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json \\\n-hostname=${MASTER_NAMES},${MASTER_IPS},${WORKER_NAMES},${WORKER_IPS},${FIRST_IP_SERVICE_SUBNET},${MASTER_DNS},${WORKER_DNS},${PUBLIC_MASTER_IPS},${PUBLIC_WORKER_IPS},${PUBLIC_MASTER_DNS},${PUBLIC_WORKER_DNS},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local \\\n-profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor name in $(echo ${MASTER_DNS} | tr \",\" \"\\n\"); do\ninstance=\"master${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${name}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${name},${INSTANCE_IPS[$count]} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor name in $(echo ${MASTER_DNS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=master${count}.kubeconfig\nkubectl config set-credentials system:node:${name} --client-certificate=master${count}.pem --client-key=master${count}-key.pem --embed-certs=true --kubeconfig=master${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${name} --kubeconfig=master${count}.kubeconfig\nkubectl config use-context default --kubeconfig=master${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"master${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"3772aab0-cf05-4779-b657-672a951c97a3"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"Configure Services","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nCONTROLLER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --cloud-provider=aws\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=${KUBE_CLUSTER_NAME}  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --cloud-provider=aws\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n    \necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"0609cf4d-8689-4c65-8464-49aec84b95a1"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"Add User Roles","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet\nsudo systemctl enable etcd docker kubelet\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem master* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\n\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n    echo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF\n\ncat <<EOF | kubectl apply -f -\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: kube-aws:node-proxier\nsubjects:\n  - kind: User\n    name: kube-worker\n  - kind: ServiceAccount\n    name: kube-proxy\n    namespace: kube-system\n  - kind: Group\n    name: system:nodes\nroleRef:\n  kind: ClusterRole\n  name: system:node-proxier\n  apiGroup: rbac.authorization.k8s.io\nEOF","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"ae1b7bbc-a3e9-4fc3-bf46-71c15a8b2c90"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"Network Configuration","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ]]; then\nsudo mkdir -p \/etc\/kubernetes\/addons\/canal\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: canal-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  canal_iface: \"\"\n\n  masquerade: \"true\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: canal\n  namespace: kube-system\n  labels:\n    k8s-app: canal\nspec:\n  selector:\n    matchLabels:\n      k8s-app: canal\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: canal\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: canal\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-canal.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              value: \"none\"\n            - name: CLUSTER_TYPE\n              value: \"k8s,canal\"\n            - name: FELIX_IPTABLESREFRESHINTERVAL\n              value: \"60\"\n            - name: IP\n              value: \"\"\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"192.168.0.0\/16\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: \/readiness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n        - name: kube-flannel\n          image: quay.io\/coreos\/flannel:v0.9.1\n          command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n          securityContext:\n            privileged: true\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: FLANNELD_IFACE\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: canal_iface\n            - name: FLANNELD_IP_MASQ\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: masquerade\n          volumeMounts:\n          - mountPath: \/run\/xtables.lock\n            name: xtables-lock\n            readOnly: false\n          - name: flannel-cfg\n            mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: flannel-cfg\n          configMap:\n            name: canal-config\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: canal\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: canal-flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: canal-calico\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/canal\/canal.yml\nkubectl create -f \/etc\/kubernetes\/addons\/canal\/canal.yml\n\nelif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]];then\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/calico\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  calico_backend: \"bird\"\n\n  veth_mtu: \"1440\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: calico-node\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-calico.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CNI_MTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s,bgp\"\n            - name: IP\n              value: \"autodetect\"\n            - name: CALICO_IPV4POOL_IPIP\n              value: \"Always\"\n            - name: FELIX_IPINIPMTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"@@{KUBE_CLUSTER_SUBNET}@@\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            exec:\n              command:\n              - \/bin\/calico-node\n              - -bird-ready\n              - -felix-ready\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPPeer\n    plural: bgppeers\n    singular: bgppeer\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/calico\/calico.yml\nkubectl create -f \/etc\/kubernetes\/addons\/calico\/calico.yml  \n\nelse\n  echo \"Defaulting to flannel\"\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n  - kind: ServiceAccount\n    name: flannel\n    namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"hairpinMode\": true,\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - \/opt\/bin\/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n          limits:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/bin\/sh\", \"-c\", \"set -e -x; cp -f \/etc\/kube-flannel\/cni-conf.json \/etc\/cni\/net.d\/10-flannel.conf; while true; do sleep 3600; done\" ]\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nfi\n\nsleep 15\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"fdb6b70e-e4a8-452a-bfdb-7125ec563f87"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"DNS Configuration","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n  - name: dns\n    port: 53\n    protocol: UDP\n  - name: dns-tcp\n    port: 53\n    protocol: TCP\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: k8s.gcr.io\/k8s-dns-kube-dns:1.14.13\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: k8s.gcr.io\/k8s-dns-dnsmasq-nanny:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --no-negcache\n        - --dns-loop-detect\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: k8s.gcr.io\/k8s-dns-sidecar:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local,5,SRV\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local,5,SRV\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy: Default\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.2.0\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          - --target=Deployment\/kube-dns\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"9b102b01-091c-4e25-b54c-faf1e8744c7e"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"EBS VolumePlugin","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nsudo mkdir \"\/etc\/kubernetes\/addons\/volume\"\n\necho 'apiVersion: storage.k8s.io\/v1\nkind: StorageClass\nmetadata:\n  name: gp2\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: EnsureExists\nprovisioner: kubernetes.io\/aws-ebs\nparameters:\n  type: gp2' | sudo tee \/etc\/kubernetes\/addons\/volume\/default.yaml\n \nkubectl create -f \/etc\/kubernetes\/addons\/volume\/default.yaml ","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"bb84fcf0-b54f-4e39-92a0-14c53ca802af"}],"name":"e836616a_runbook","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"84e097cf_dag","uuid":"eb0a4fbb-7076-41cd-904a-0eab8de3d5e4"},"uuid":"94b46989-f45b-486e-9dff-731f3a0d6e2f"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"6ab2b3c5-fdb8-4960-9757-2248632372d6"},"retries":"0","name":"4226cd9d_dag","type":"DAG","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"aba7e289-21f7-4815-a99e-7f25116aa325"}],"name":"18f2756f_runbook","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"4226cd9d_dag","uuid":"aba7e289-21f7-4815-a99e-7f25116aa325"},"uuid":"b7c46034-6f60-40ce-aa4d-48473098d05f"}},"variable_list":[],"description":""},{"uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463","action_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"}],"name":"AWS_Centos_K8SW_Package","version":"","type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"},"retries":"0","name":"a4ecbecd_dag","type":"DAG","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"9bdba192-a92b-4feb-bd3a-878d2f244be9"},{"kind":"app_task","name":"Docker Kubelet Install","uuid":"9f41602f-a83b-46ac-9ff7-ed38194e32f9"},{"kind":"app_task","name":"GetCerts","uuid":"3b02cb43-dd35-4a39-849a-bddf6b3d2c31"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"9bdba192-a92b-4feb-bd3a-878d2f244be9"},"edge_type":"user_defined","type":"","uuid":"8f7035f9-fc53-4970-98dd-2f01c3bad943","to_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"9f41602f-a83b-46ac-9ff7-ed38194e32f9"}},{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"9f41602f-a83b-46ac-9ff7-ed38194e32f9"},"edge_type":"user_defined","type":"","uuid":"8d6c31eb-238b-42f6-b125-10c0f7137eb4","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"3b02cb43-dd35-4a39-849a-bddf6b3d2c31"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"4fe416c6-2a45-450a-83e3-a8e063791ef6"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","name":"Set Kubernetes Version","type":"SET_VARIABLE","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"9bdba192-a92b-4feb-bd3a-878d2f244be9"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","name":"Docker Kubelet Install","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{AWS_Centos_K8SM.private_ip_address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y --quiet\nsudo yum install -y wget socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\n\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=aws \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/xvd{b,c,d}\nsudo vgcreate docker \/dev\/xvd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"9f41602f-a83b-46ac-9ff7-ed38194e32f9"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","name":"GetCerts","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{AWS_Centos_K8SM.private_ip_address[0]}@@\"\nINSTANCE_NAME=\"@@{private_dns_name}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nINSTANCE_IP=\"@@{private_ip_address}@@\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; if [[ $count -eq 600 ]]; then echo \"failed to download certs\" && exit 1; fi; count=$(($count+5)) ; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"worker@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${INSTANCE_NAME}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_NAME},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${INSTANCE_NAME} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${INSTANCE_NAME} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"3b02cb43-dd35-4a39-849a-bddf6b3d2c31"}],"name":"dca27b9e_runbook","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"a4ecbecd_dag","uuid":"4fe416c6-2a45-450a-83e3-a8e063791ef6"},"uuid":"ed0655ff-a96b-4d98-bec8-62c619c68992"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SW_Package","uuid":"9d79b4a5-8fba-4074-80e9-4e490e46c463"},"retries":"0","name":"9e5b50bc_dag","type":"DAG","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"e28691ec-bd93-4ca2-9e16-2c548ce7c98c"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"77e5b22b-1f9d-4e62-b9bc-466dbda4ebd2"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","name":"Remove Node","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain '@@{private_dns_name}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node '@@{private_dns_name}@@'\"","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"e28691ec-bd93-4ca2-9e16-2c548ce7c98c"}],"name":"137c8a73_runbook","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"9e5b50bc_dag","uuid":"77e5b22b-1f9d-4e62-b9bc-466dbda4ebd2"},"uuid":"59a6bd18-ad76-4e6c-93de-40d50b63136d"}},"variable_list":[],"description":""},{"uuid":"0ad182b1-b1e7-476c-894c-8121c7440601","action_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"}],"name":"GCP_Centos_K8SM_Package","version":"","type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"},"retries":"0","name":"e07e43b0_dag","type":"DAG","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"862c4e6c-0ac7-4d77-8a4d-0664a4b37c70"},{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"3e053207-7390-4d73-bada-954aee9817d3"},{"kind":"app_task","name":"Generate Certs","uuid":"9a3a04de-6409-4a59-a4a6-9c00082650dd"},{"kind":"app_task","name":"Configure Services","uuid":"c33329b2-13f3-4de0-ae12-a8dec0fdc9e4"},{"kind":"app_task","name":"Add User Roles","uuid":"1d4e7b6f-c2eb-4a2f-b1ce-d1d55c94f864"},{"kind":"app_task","name":"Network Configuration","uuid":"e0cf5979-5306-4e72-a93d-78311bfcad69"},{"kind":"app_task","name":"DNS Configuration","uuid":"987bc3c7-2a2c-4592-bd68-fc6431d2898d"},{"kind":"app_task","name":"GCE VolumePlugin","uuid":"31eb5b6b-5c67-48c0-9a56-00b7277a19c4"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"862c4e6c-0ac7-4d77-8a4d-0664a4b37c70"},"edge_type":"user_defined","type":"","uuid":"de2348c7-2318-4257-9e79-dfb66281958b","to_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"3e053207-7390-4d73-bada-954aee9817d3"}},{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"3e053207-7390-4d73-bada-954aee9817d3"},"edge_type":"user_defined","type":"","uuid":"51d6c43f-d565-4866-a416-61e095af11bd","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"9a3a04de-6409-4a59-a4a6-9c00082650dd"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"9a3a04de-6409-4a59-a4a6-9c00082650dd"},"edge_type":"user_defined","type":"","uuid":"2488676d-2476-40f6-903e-baa4e0df0d58","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"c33329b2-13f3-4de0-ae12-a8dec0fdc9e4"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"c33329b2-13f3-4de0-ae12-a8dec0fdc9e4"},"edge_type":"user_defined","type":"","uuid":"4ebf67a3-1920-4153-b24f-ae45d14eba9f","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"1d4e7b6f-c2eb-4a2f-b1ce-d1d55c94f864"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"1d4e7b6f-c2eb-4a2f-b1ce-d1d55c94f864"},"edge_type":"user_defined","type":"","uuid":"9bd97b41-84b0-450e-9c25-bca582b0a992","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"e0cf5979-5306-4e72-a93d-78311bfcad69"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"e0cf5979-5306-4e72-a93d-78311bfcad69"},"edge_type":"user_defined","type":"","uuid":"6a02b957-08e3-40e0-844d-c96e3100ef8a","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"987bc3c7-2a2c-4592-bd68-fc6431d2898d"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"987bc3c7-2a2c-4592-bd68-fc6431d2898d"},"edge_type":"user_defined","type":"","uuid":"7f2718af-3bff-4d17-8935-31f1e67111fc","to_task_reference":{"kind":"app_task","name":"GCE VolumePlugin","uuid":"31eb5b6b-5c67-48c0-9a56-00b7277a19c4"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"5d4b721d-3fd2-4fff-9f01-e389a6276b61"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"Set Kubernetes Version","type":"SET_VARIABLE","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"862c4e6c-0ac7-4d77-8a4d-0664a4b37c70"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"ETCD Docker Kubelet Install","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.3.12\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nWORKER_IPS=\"@@{GCP_Centos_K8SW.private_ip_address}@@\" # private Ip's\nPUBLIC_MASTER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_WORKER_IPS=\"@@{GCP_Centos_K8SW.public_ip_address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} master${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"master${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  count=$((count+1))\ndone   \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=gce \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate etcd \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/sd{e,f,g}\nsudo vgcreate docker \/dev\/sd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"3e053207-7390-4d73-bada-954aee9817d3"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"Generate Certs","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\ndeclare -a INSTANCE_IPS\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nWORKER_IPS=\"@@{GCP_Centos_K8SM.private_ip_address}@@\" # private Ip's\nPUBLIC_MASTER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_WORKER_IPS=\"@@{GCP_Centos_K8SM.public_ip_address}@@\"\nINSTANCE_IPS=($(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"))\nMASTER_NAMES=\"@@{calm_array_name}@@\"\nWORKER_NAMES=\"@@{GCP_Centos_K8SW.name}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${PUBLIC_MASTER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${PUBLIC_MASTER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${PUBLIC_MASTER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json \\\n-hostname=${MASTER_NAMES},${MASTER_IPS},${WORKER_NAMES},${WORKER_IPS},${FIRST_IP_SERVICE_SUBNET},${PUBLIC_MASTER_IPS},${PUBLIC_WORKER_IPS},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local \\\n-profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor name in $(echo ${MASTER_NAMES} | tr \",\" \"\\n\"); do\ninstance=\"master${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${name}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${name},${INSTANCE_IPS[$count]} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor name in $(echo ${MASTER_NAMES} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=master${count}.kubeconfig\nkubectl config set-credentials system:node:${name} --client-certificate=master${count}.pem --client-key=master${count}-key.pem --embed-certs=true --kubeconfig=master${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${name} --kubeconfig=master${count}.kubeconfig\nkubectl config use-context default --kubeconfig=master${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"master${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"9a3a04de-6409-4a59-a4a6-9c00082650dd"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"Configure Services","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nMASTER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${NODE_NAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${MASTER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --cloud-provider=gce\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=${KUBE_CLUSTER_NAME}\n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --cloud-provider=gce\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n\necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"c33329b2-13f3-4de0-ae12-a8dec0fdc9e4"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"Add User Roles","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet\nsudo systemctl enable etcd docker kubelet\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem master* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\n\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF\n\ncat <<EOF | kubectl apply -f -\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: kube-aws:node-proxier\nsubjects:\n  - kind: User\n    name: kube-worker\n  - kind: ServiceAccount\n    name: kube-proxy\n    namespace: kube-system\n  - kind: Group\n    name: system:nodes\nroleRef:\n  kind: ClusterRole\n  name: system:node-proxier\n  apiGroup: rbac.authorization.k8s.io\nEOF","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"1d4e7b6f-c2eb-4a2f-b1ce-d1d55c94f864"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"Network Configuration","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ]]; then\nsudo mkdir -p \/etc\/kubernetes\/addons\/canal\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: canal-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  canal_iface: \"\"\n\n  masquerade: \"true\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: canal\n  namespace: kube-system\n  labels:\n    k8s-app: canal\nspec:\n  selector:\n    matchLabels:\n      k8s-app: canal\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: canal\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: canal\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-canal.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              value: \"none\"\n            - name: CLUSTER_TYPE\n              value: \"k8s,canal\"\n            - name: FELIX_IPTABLESREFRESHINTERVAL\n              value: \"60\"\n            - name: IP\n              value: \"\"\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"192.168.0.0\/16\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: \/readiness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n        - name: kube-flannel\n          image: quay.io\/coreos\/flannel:v0.9.1\n          command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n          securityContext:\n            privileged: true\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: FLANNELD_IFACE\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: canal_iface\n            - name: FLANNELD_IP_MASQ\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: masquerade\n          volumeMounts:\n          - mountPath: \/run\/xtables.lock\n            name: xtables-lock\n            readOnly: false\n          - name: flannel-cfg\n            mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: flannel-cfg\n          configMap:\n            name: canal-config\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: canal\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: canal-flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: canal-calico\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/canal\/canal.yml\nkubectl create -f \/etc\/kubernetes\/addons\/canal\/canal.yml\n\nelif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]];then\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/calico\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  calico_backend: \"bird\"\n\n  veth_mtu: \"1440\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: calico-node\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-calico.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CNI_MTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s,bgp\"\n            - name: IP\n              value: \"autodetect\"\n            - name: CALICO_IPV4POOL_IPIP\n              value: \"Always\"\n            - name: FELIX_IPINIPMTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"@@{KUBE_CLUSTER_SUBNET}@@\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            exec:\n              command:\n              - \/bin\/calico-node\n              - -bird-ready\n              - -felix-ready\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPPeer\n    plural: bgppeers\n    singular: bgppeer\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/calico\/calico.yml\nkubectl create -f \/etc\/kubernetes\/addons\/calico\/calico.yml  \n\nelse\n  echo \"Defaulting to flannel\"\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n  - kind: ServiceAccount\n    name: flannel\n    namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"hairpinMode\": true,\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - \/opt\/bin\/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n          limits:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/bin\/sh\", \"-c\", \"set -e -x; cp -f \/etc\/kube-flannel\/cni-conf.json \/etc\/cni\/net.d\/10-flannel.conf; while true; do sleep 3600; done\" ]\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nfi\n\nsleep 15\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"e0cf5979-5306-4e72-a93d-78311bfcad69"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"DNS Configuration","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n  - name: dns\n    port: 53\n    protocol: UDP\n  - name: dns-tcp\n    port: 53\n    protocol: TCP\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: k8s.gcr.io\/k8s-dns-kube-dns:1.14.13\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: k8s.gcr.io\/k8s-dns-dnsmasq-nanny:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --no-negcache\n        - --dns-loop-detect\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: k8s.gcr.io\/k8s-dns-sidecar:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local,5,SRV\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local,5,SRV\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy: Default\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.2.0\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          - --target=Deployment\/kube-dns\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"987bc3c7-2a2c-4592-bd68-fc6431d2898d"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"GCE VolumePlugin","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nsudo mkdir \"\/etc\/kubernetes\/addons\/volume\"\n\necho 'apiVersion: storage.k8s.io\/v1\nkind: StorageClass\nmetadata:\n  name: standard\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: EnsureExists\nprovisioner: kubernetes.io\/gce-pd\nparameters:\n  type: pd-standard' | sudo tee \/etc\/kubernetes\/addons\/volume\/default.yaml\n \nkubectl create -f \/etc\/kubernetes\/addons\/volume\/default.yaml ","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"31eb5b6b-5c67-48c0-9a56-00b7277a19c4"}],"name":"26c82c77_runbook","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"e07e43b0_dag","uuid":"5d4b721d-3fd2-4fff-9f01-e389a6276b61"},"uuid":"157634a8-f391-47c0-98bb-3a0647057d1b"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"0ad182b1-b1e7-476c-894c-8121c7440601"},"retries":"0","name":"6bbde6e8_dag","type":"DAG","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"6b789466-f815-4bc0-a283-e1312f9d3c3d"}],"name":"6eaeef4c_runbook","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"6bbde6e8_dag","uuid":"6b789466-f815-4bc0-a283-e1312f9d3c3d"},"uuid":"176acdaa-f7d6-4e53-9387-6d5cf06af409"}},"variable_list":[],"description":""},{"uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a","action_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"}],"name":"GCP_Centos_K8SW_Package","version":"","type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"},"retries":"0","name":"709f9264_dag","type":"DAG","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"b1c78264-62cd-4a54-b4e2-7b6304dd7a52"},{"kind":"app_task","name":"Docker Kubelet Install","uuid":"08cabc37-3932-4742-b73e-ed1a59080736"},{"kind":"app_task","name":"GetCerts","uuid":"d74356af-8e3f-4e28-a257-98fd3d83fd18"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"b1c78264-62cd-4a54-b4e2-7b6304dd7a52"},"edge_type":"user_defined","type":"","uuid":"360d0984-ea28-4735-9844-52198ccbc247","to_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"08cabc37-3932-4742-b73e-ed1a59080736"}},{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"08cabc37-3932-4742-b73e-ed1a59080736"},"edge_type":"user_defined","type":"","uuid":"39614adb-74d1-4814-a16d-69dcceba6c1c","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"d74356af-8e3f-4e28-a257-98fd3d83fd18"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"828f838c-097d-45f3-a3e5-8520f50d545b"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","name":"Set Kubernetes Version","type":"SET_VARIABLE","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"b1c78264-62cd-4a54-b4e2-7b6304dd7a52"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","name":"Docker Kubelet Install","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{GCP_Centos_K8SM.private_ip_address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\n\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=gce \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"08cabc37-3932-4742-b73e-ed1a59080736"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","name":"GetCerts","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{GCP_Centos_K8SM.private_ip_address[0]}@@\"\nINSTANCE_IP=\"@@{private_ip_address}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; if [[ $count -eq 600 ]]; then echo \"failed to download certs\" && exit 1; fi; count=$(($count+5)) ; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"worker@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${HOSTNAME}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${HOSTNAME},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${HOSTNAME} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${HOSTNAME} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"d74356af-8e3f-4e28-a257-98fd3d83fd18"}],"name":"927472a7_runbook","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"709f9264_dag","uuid":"828f838c-097d-45f3-a3e5-8520f50d545b"},"uuid":"b66a864e-fe6a-4a0c-ab6b-a6871fa37e09"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SW_Package","uuid":"5c74eb52-ea4c-4c67-bc85-5bcbff0fc85a"},"retries":"0","name":"fef85962_dag","type":"DAG","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"6e2d5148-258e-4415-a37d-0c3e228725a2"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"99d854d9-c1b5-4c20-a0a6-269d00f91213"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","name":"Remove Node","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nNODE_NAME=${HOSTNAME}\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain '${NODE_NAME}' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node '${NODE_NAME}'\"","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"6e2d5148-258e-4415-a37d-0c3e228725a2"}],"name":"435393f9_runbook","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"fef85962_dag","uuid":"99d854d9-c1b5-4c20-a0a6-269d00f91213"},"uuid":"7ff9b6f9-15ee-4acc-9640-de3153dd7c3b"}},"variable_list":[],"description":""},{"uuid":"691d60b5-9272-4cb0-a4b4-4e8dc6f75277","action_list":[],"service_local_reference_list":[],"name":"AHV_CENTOS_76","version":"","type":"SUBSTRATE_IMAGE","options":{"type":"","name":"CENTOS_76","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-1810.qcow2","version":{"product_version":"","type":"","product_name":""},"architecture":"X86_64","type":""},"description":""},"variable_list":[],"description":""},{"uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7","action_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"}],"name":"Azure_Centos_K8SM_Package","version":"","type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"},"retries":"0","name":"e07e43b0_dag","type":"DAG","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubenetes Version","uuid":"a58ad377-dfbf-4a4b-9cdf-2222d2e78f80"},{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"854219fc-578b-4a46-bc86-f5b1dec3fc6f"},{"kind":"app_task","name":"Generate Certs","uuid":"7af0fa88-eec7-4152-bb5c-768f203e21cb"},{"kind":"app_task","name":"Configure Services","uuid":"2ed591c5-8534-4c09-8dca-ddd4a1aec422"},{"kind":"app_task","name":"Add User Roles","uuid":"7bb62d31-6da2-499e-bab8-6f4dfabff5aa"},{"kind":"app_task","name":"Network Configuration","uuid":"9abf1be0-de41-4b10-8833-8677647a0dd4"},{"kind":"app_task","name":"DNS Configuration","uuid":"5cc056c8-cd5a-4fa1-9013-46e423a85b50"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubenetes Version","uuid":"a58ad377-dfbf-4a4b-9cdf-2222d2e78f80"},"edge_type":"user_defined","type":"","uuid":"84c67d99-e587-4045-9b4a-8d1d64e11f2f","to_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"854219fc-578b-4a46-bc86-f5b1dec3fc6f"}},{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"854219fc-578b-4a46-bc86-f5b1dec3fc6f"},"edge_type":"user_defined","type":"","uuid":"abc2a0aa-e191-45b6-820e-e0f3538abf20","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"7af0fa88-eec7-4152-bb5c-768f203e21cb"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"7af0fa88-eec7-4152-bb5c-768f203e21cb"},"edge_type":"user_defined","type":"","uuid":"1c202d0e-aed1-41fb-8042-f1b6ab9aff87","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"2ed591c5-8534-4c09-8dca-ddd4a1aec422"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"2ed591c5-8534-4c09-8dca-ddd4a1aec422"},"edge_type":"user_defined","type":"","uuid":"22b08f81-dcc4-4593-83fc-817e1bbf4c9c","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"7bb62d31-6da2-499e-bab8-6f4dfabff5aa"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"7bb62d31-6da2-499e-bab8-6f4dfabff5aa"},"edge_type":"user_defined","type":"","uuid":"09095f87-8136-4300-af6a-8359190e98c4","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"9abf1be0-de41-4b10-8833-8677647a0dd4"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"9abf1be0-de41-4b10-8833-8677647a0dd4"},"edge_type":"user_defined","type":"","uuid":"220a64fd-6fba-4c2b-b0d8-46d76c661023","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"5cc056c8-cd5a-4fa1-9013-46e423a85b50"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"026f2463-8259-48c4-a015-962ec6ee3c69"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"Set Kubenetes Version","type":"SET_VARIABLE","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"a58ad377-dfbf-4a4b-9cdf-2222d2e78f80"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"ETCD Docker Kubelet Install","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nsudo yum install -y python-setuptools --quiet\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.3.12\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nWORKER_IPS=\"@@{Azure_Centos_K8SW.private_ip_address}@@\" # private Ip's\nPUBLIC_MASTER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_WORKER_IPS=\"@@{Azure_Centos_K8SW.public_ip_address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} master${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"master${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  count=$((count+1))\ndone \n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"854219fc-578b-4a46-bc86-f5b1dec3fc6f"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"Generate Certs","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\ndeclare -a INSTANCE_IPS\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nWORKER_IPS=\"@@{Azure_Centos_K8SW.private_ip_address}@@\" # private Ip's\nPUBLIC_MASTER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_WORKER_IPS=\"@@{Azure_Centos_K8SM.public_ip_address}@@\"\nINSTANCE_IPS=($(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"))\nMASTER_HOSTNAMES=\"@@{calm_array_name}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"master${count}\",\n  count=$((count+1))\ndone\nMASTER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"worker${count}\",\n  count=$((count+1))\ndone\nWORKER_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${PUBLIC_MASTER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${PUBLIC_MASTER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS},${PUBLIC_MASTER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json \\\n-hostname=${MASTER_NAMES},${MASTER_IPS},${WORKER_NAMES},${WORKER_IPS},${FIRST_IP_SERVICE_SUBNET},${PUBLIC_MASTER_IPS},${PUBLIC_WORKER_IPS},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local \\\n-profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor name in $(echo ${MASTER_NAMES} | tr \",\" \"\\n\"); do\ninstance=\"master${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${name}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_IPS[$count]} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor name in $(echo ${MASTER_NAMES} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=master${count}.kubeconfig\nkubectl config set-credentials system:node:${name} --client-certificate=master${count}.pem --client-key=master${count}-key.pem --embed-certs=true --kubeconfig=master${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${name} --kubeconfig=master${count}.kubeconfig\nkubectl config use-context default --kubeconfig=master${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"master${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"7af0fa88-eec7-4152-bb5c-768f203e21cb"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"Configure Services","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{calm_array_private_ip_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nMASTER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${NODE_NAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${MASTER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=${KUBE_CLUSTER_NAME}\n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n\necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"2ed591c5-8534-4c09-8dca-ddd4a1aec422"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"Add User Roles","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet\nsudo systemctl enable etcd docker kubelet\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem master* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\n\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF\n\ncat <<EOF | kubectl apply -f -\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: kube-aws:node-proxier\nsubjects:\n  - kind: User\n    name: kube-worker\n  - kind: ServiceAccount\n    name: kube-proxy\n    namespace: kube-system\n  - kind: Group\n    name: system:nodes\nroleRef:\n  kind: ClusterRole\n  name: system:node-proxier\n  apiGroup: rbac.authorization.k8s.io\nEOF","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"7bb62d31-6da2-499e-bab8-6f4dfabff5aa"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"Network Configuration","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ]]; then\nsudo mkdir -p \/etc\/kubernetes\/addons\/canal\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: canal-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  canal_iface: \"\"\n\n  masquerade: \"true\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: canal\n  namespace: kube-system\n  labels:\n    k8s-app: canal\nspec:\n  selector:\n    matchLabels:\n      k8s-app: canal\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: canal\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: canal\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-canal.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              value: \"none\"\n            - name: CLUSTER_TYPE\n              value: \"k8s,canal\"\n            - name: FELIX_IPTABLESREFRESHINTERVAL\n              value: \"60\"\n            - name: IP\n              value: \"\"\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"192.168.0.0\/16\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: \/readiness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n        - name: kube-flannel\n          image: quay.io\/coreos\/flannel:v0.9.1\n          command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n          securityContext:\n            privileged: true\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: FLANNELD_IFACE\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: canal_iface\n            - name: FLANNELD_IP_MASQ\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: masquerade\n          volumeMounts:\n          - mountPath: \/run\/xtables.lock\n            name: xtables-lock\n            readOnly: false\n          - name: flannel-cfg\n            mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: flannel-cfg\n          configMap:\n            name: canal-config\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: canal\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: canal-flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: canal-calico\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/canal\/canal.yml\nkubectl create -f \/etc\/kubernetes\/addons\/canal\/canal.yml\n\nelif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]];then\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/calico\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  calico_backend: \"bird\"\n\n  veth_mtu: \"1440\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: calico-node\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-calico.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CNI_MTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s,bgp\"\n            - name: IP\n              value: \"autodetect\"\n            - name: CALICO_IPV4POOL_IPIP\n              value: \"Always\"\n            - name: FELIX_IPINIPMTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"@@{KUBE_CLUSTER_SUBNET}@@\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            exec:\n              command:\n              - \/bin\/calico-node\n              - -bird-ready\n              - -felix-ready\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPPeer\n    plural: bgppeers\n    singular: bgppeer\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/calico\/calico.yml\nkubectl create -f \/etc\/kubernetes\/addons\/calico\/calico.yml  \n\nelse\n  echo \"Defaulting to flannel\"\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n  - kind: ServiceAccount\n    name: flannel\n    namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"hairpinMode\": true,\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - \/opt\/bin\/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n          limits:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/bin\/sh\", \"-c\", \"set -e -x; cp -f \/etc\/kube-flannel\/cni-conf.json \/etc\/cni\/net.d\/10-flannel.conf; while true; do sleep 3600; done\" ]\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nfi\n\nsleep 15\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"9abf1be0-de41-4b10-8833-8677647a0dd4"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"DNS Configuration","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n  - name: dns\n    port: 53\n    protocol: UDP\n  - name: dns-tcp\n    port: 53\n    protocol: TCP\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: k8s.gcr.io\/k8s-dns-kube-dns:1.14.13\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: k8s.gcr.io\/k8s-dns-dnsmasq-nanny:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --no-negcache\n        - --dns-loop-detect\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: k8s.gcr.io\/k8s-dns-sidecar:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local,5,SRV\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local,5,SRV\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy: Default\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.2.0\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          - --target=Deployment\/kube-dns\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"5cc056c8-cd5a-4fa1-9013-46e423a85b50"}],"name":"26c82c77_runbook_cloned_1","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"e07e43b0_dag","uuid":"026f2463-8259-48c4-a015-962ec6ee3c69"},"uuid":"eb446d01-8c07-4895-b70a-69c1861525bf"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"8f379386-82c8-4851-84aa-e97b83c8b8a7"},"retries":"0","name":"6bbde6e8_dag","type":"DAG","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"0430de1c-4a60-4831-a140-7a42fa1e1204"}],"name":"6eaeef4c_runbook_cloned_1","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"6bbde6e8_dag","uuid":"0430de1c-4a60-4831-a140-7a42fa1e1204"},"uuid":"1ba020b7-35b3-415f-8a9f-9ea1d90e488b"}},"variable_list":[],"description":""},{"uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5","action_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"}],"name":"Azure_Centos_K8SW_Package","version":"","type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"},"retries":"0","name":"709f9264_dag","type":"DAG","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"09ad5b4e-3a8b-42b7-8f52-5c314ffb1ea1"},{"kind":"app_task","name":"Docker Kubelet Install","uuid":"262028f3-a637-4699-8d16-49e1bffaa57f"},{"kind":"app_task","name":"GetCerts","uuid":"f2494ce8-d46c-4f2b-8b34-3932b54d9d15"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"09ad5b4e-3a8b-42b7-8f52-5c314ffb1ea1"},"edge_type":"user_defined","type":"","uuid":"ea04f9e9-ecbf-4446-8a9d-5bb28828dc88","to_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"262028f3-a637-4699-8d16-49e1bffaa57f"}},{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"262028f3-a637-4699-8d16-49e1bffaa57f"},"edge_type":"user_defined","type":"","uuid":"1013091b-e1f7-4c0d-a2be-cee94d94fb88","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"f2494ce8-d46c-4f2b-8b34-3932b54d9d15"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"e83773dc-a90a-4aa8-8675-4260f2dd31a5"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","name":"Set Kubernetes Version","type":"SET_VARIABLE","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"09ad5b4e-3a8b-42b7-8f52-5c314ffb1ea1"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","name":"Docker Kubelet Install","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nMASTER_IPS=\"@@{Azure_Centos_K8SM.private_ip_address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\n\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"262028f3-a637-4699-8d16-49e1bffaa57f"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","name":"GetCerts","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{Azure_Centos_K8SM.private_ip_address[0]}@@\"\nINSTANCE_IP=\"@@{private_ip_address}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; if [[ $count -eq 600 ]]; then echo \"failed to download certs\" && exit 1; fi; count=$(($count+5)) ; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"minion@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${HOSTNAME}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${HOSTNAME},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${HOSTNAME} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${HOSTNAME} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"f2494ce8-d46c-4f2b-8b34-3932b54d9d15"}],"name":"927472a7_runbook_cloned_1","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"709f9264_dag","uuid":"e83773dc-a90a-4aa8-8675-4260f2dd31a5"},"uuid":"6deda1b0-c19c-444d-bab4-c3a398474f9d"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SW_Package","uuid":"206d70f4-364d-415d-bb4a-8739e54e57f5"},"retries":"0","name":"fef85962_dag","type":"DAG","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"3affc206-189a-4914-a8aa-009da2cb9299"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"545b58be-709a-47d8-8f91-798776914e2b"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","name":"Remove Node","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain 'worker@@{calm_array_index}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node 'worker@@{calm_array_index}@@'\"","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"3affc206-189a-4914-a8aa-009da2cb9299"}],"name":"435393f9_runbook_cloned_1","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"fef85962_dag","uuid":"545b58be-709a-47d8-8f91-798776914e2b"},"uuid":"045b7396-4def-45e7-b87e-fb73be58ee5d"}},"variable_list":[],"description":""},{"uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e","action_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"}],"name":"VMware_Centos_K8SM_Package","version":"","type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"},"retries":"0","name":"dac441af_dag_cloned_1","type":"DAG","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"84c2fa42-02fb-42c8-80b9-6195c0ea7907"},{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"5c9d1a9d-edad-4ea4-8d8b-81d7c704a1fc"},{"kind":"app_task","name":"Generate Certs","uuid":"9dc17daa-b875-4653-8e38-eb3795ac5761"},{"kind":"app_task","name":"Configure Services","uuid":"30196e17-512a-4c68-9c37-37f79d0fe550"},{"kind":"app_task","name":"Add User Roles","uuid":"2aa9af2f-5888-4b61-a973-dec61fae506a"},{"kind":"app_task","name":"Network Configuration","uuid":"e937e510-6931-49c9-adcd-5c1520077bf6"},{"kind":"app_task","name":"DNS Configuration","uuid":"d805ac55-d0a5-457c-8124-bedc05e2b070"},{"kind":"app_task","name":"NVP Configuration","uuid":"9070721a-1ddc-4336-84af-8f4b5222f0e0"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"84c2fa42-02fb-42c8-80b9-6195c0ea7907"},"edge_type":"user_defined","type":"","uuid":"b33230cb-473c-4359-8c19-f3169bd93b0c","to_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"5c9d1a9d-edad-4ea4-8d8b-81d7c704a1fc"}},{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"5c9d1a9d-edad-4ea4-8d8b-81d7c704a1fc"},"edge_type":"user_defined","type":"","uuid":"664f2f03-c5c8-476a-9813-7c867f54f56b","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"9dc17daa-b875-4653-8e38-eb3795ac5761"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"9dc17daa-b875-4653-8e38-eb3795ac5761"},"edge_type":"user_defined","type":"","uuid":"a6a6464f-9bde-4736-b77a-935ab0188d37","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"30196e17-512a-4c68-9c37-37f79d0fe550"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"30196e17-512a-4c68-9c37-37f79d0fe550"},"edge_type":"user_defined","type":"","uuid":"97a7b380-e840-4072-a4fb-5afcd7fb3dcf","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"2aa9af2f-5888-4b61-a973-dec61fae506a"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"2aa9af2f-5888-4b61-a973-dec61fae506a"},"edge_type":"user_defined","type":"","uuid":"31f20fbf-0aa5-4f3a-b480-88fb48d2f10d","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"e937e510-6931-49c9-adcd-5c1520077bf6"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"e937e510-6931-49c9-adcd-5c1520077bf6"},"edge_type":"user_defined","type":"","uuid":"6aa5d7f0-e9e7-42f6-a131-94dc90120fa5","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"d805ac55-d0a5-457c-8124-bedc05e2b070"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"d805ac55-d0a5-457c-8124-bedc05e2b070"},"edge_type":"user_defined","type":"","uuid":"db45a437-f025-42d7-81ea-bb5c23a19f8f","to_task_reference":{"kind":"app_task","name":"NVP Configuration","uuid":"9070721a-1ddc-4336-84af-8f4b5222f0e0"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"42047288-c092-4490-9d35-8d8f5c2239e8"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"Set Kubernetes Version","type":"SET_VARIABLE","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"84c2fa42-02fb-42c8-80b9-6195c0ea7907"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"ETCD Docker Kubelet Install","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.3.12\"\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_IPS=\"@@{VMware_Centos_K8SW.address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} master${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"master${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  count=$((count+1))\ndone   \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate etcd \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/sd{e,f,g}\nsudo vgcreate docker \/dev\/sd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"5c9d1a9d-edad-4ea4-8d8b-81d7c704a1fc"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"Generate Certs","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_IPS=\"@@{VMware_Centos_K8SW.address}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"master${count}\",\n  count=$((count+1))\ndone\n\nMASTER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"worker${count}\",\n  count=$((count+1))\ndone\nWORKER_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${MASTER_NAMES},${MASTER_IPS},${WORKER_NAMES},${WORKER_IPS},${FIRST_IP_SERVICE_SUBNET},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local -profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\ninstance=\"master${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=master${count}.kubeconfig\nkubectl config set-credentials system:node:master${count} --client-certificate=master${count}.pem --client-key=master${count}-key.pem --embed-certs=true --kubeconfig=master${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:master${count} --kubeconfig=master${count}.kubeconfig\nkubectl config use-context default --kubeconfig=master${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"master${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"9dc17daa-b875-4653-8e38-eb3795ac5761"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"Configure Services","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nMASTER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${MASTER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=${KUBE_CLUSTER_NAME}\n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n    \necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"30196e17-512a-4c68-9c37-37f79d0fe550"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"Add User Roles","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet iscsid\nsudo systemctl enable etcd docker kubelet iscsid\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem master* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n    echo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"2aa9af2f-5888-4b61-a973-dec61fae506a"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"Network Configuration","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ]]; then\nsudo mkdir -p \/etc\/kubernetes\/addons\/canal\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: canal-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  canal_iface: \"\"\n\n  masquerade: \"true\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: canal\n  namespace: kube-system\n  labels:\n    k8s-app: canal\nspec:\n  selector:\n    matchLabels:\n      k8s-app: canal\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: canal\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: canal\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-canal.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              value: \"none\"\n            - name: CLUSTER_TYPE\n              value: \"k8s,canal\"\n            - name: FELIX_IPTABLESREFRESHINTERVAL\n              value: \"60\"\n            - name: IP\n              value: \"\"\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"192.168.0.0\/16\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: \/readiness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n        - name: kube-flannel\n          image: quay.io\/coreos\/flannel:v0.9.1\n          command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n          securityContext:\n            privileged: true\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: FLANNELD_IFACE\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: canal_iface\n            - name: FLANNELD_IP_MASQ\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: masquerade\n          volumeMounts:\n          - mountPath: \/run\/xtables.lock\n            name: xtables-lock\n            readOnly: false\n          - name: flannel-cfg\n            mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: flannel-cfg\n          configMap:\n            name: canal-config\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: canal\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: canal-flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: canal-calico\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/canal\/canal.yml\nkubectl create -f \/etc\/kubernetes\/addons\/canal\/canal.yml\n\nelif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]];then\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/calico\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  calico_backend: \"bird\"\n\n  veth_mtu: \"1440\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: calico-node\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-calico.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CNI_MTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s,bgp\"\n            - name: IP\n              value: \"autodetect\"\n            - name: CALICO_IPV4POOL_IPIP\n              value: \"Always\"\n            - name: FELIX_IPINIPMTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"@@{KUBE_CLUSTER_SUBNET}@@\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            exec:\n              command:\n              - \/bin\/calico-node\n              - -bird-ready\n              - -felix-ready\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPPeer\n    plural: bgppeers\n    singular: bgppeer\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/calico\/calico.yml\nkubectl create -f \/etc\/kubernetes\/addons\/calico\/calico.yml  \n\nelse\n  echo \"Defaulting to flannel\"\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n  - kind: ServiceAccount\n    name: flannel\n    namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"hairpinMode\": true,\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - \/opt\/bin\/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n          limits:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/bin\/sh\", \"-c\", \"set -e -x; cp -f \/etc\/kube-flannel\/cni-conf.json \/etc\/cni\/net.d\/10-flannel.conf; while true; do sleep 3600; done\" ]\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nfi\n\nsleep 15\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"e937e510-6931-49c9-adcd-5c1520077bf6"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"DNS Configuration","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n  - name: dns\n    port: 53\n    protocol: UDP\n  - name: dns-tcp\n    port: 53\n    protocol: TCP\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: k8s.gcr.io\/k8s-dns-kube-dns:1.14.13\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: k8s.gcr.io\/k8s-dns-dnsmasq-nanny:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --no-negcache\n        - --dns-loop-detect\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: k8s.gcr.io\/k8s-dns-sidecar:1.14.13\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local,5,SRV\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local,5,SRV\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy: Default\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.2.0\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          - --target=Deployment\/kube-dns\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"d805ac55-d0a5-457c-8124-bedc05e2b070"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"cc7c6e36-2710-44cf-97bf-f5ef4cff2255"},"retries":"0","name":"NVP Configuration","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nPRISM_CLUSTER_IP=\"@@{PE_CLUSTER_IP}@@\"\nPRISM_DATA_SERVICE_IP=\"@@{PE_CLUSTER_IP}@@\"\n\nif [[ (\"${PRISM_CLUSTER_IP}x\" == \"x\") && (\"${PRISM_DATA_SERVICE_IP}x\" == \"x\") ]]; then exit 0; fi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/volume_plugin\nNTNX_SECRET=$(echo -n \"@@{PE_USERNAME}@@:@@{PE_PASSWORD}@@\" | base64)\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: nutanixabs-provisioner-runner\n  namespace: kube-system\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumes\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumeclaims\"]\n    verbs: [\"get\", \"list\", \"watch\", \"update\"]\n  - apiGroups: [\"storage.k8s.io\"]\n    resources: [\"storageclasses\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"list\", \"watch\", \"create\", \"update\", \"patch\"]\n  - apiGroups: [\"\"]\n    resources: [\"services\"]\n    verbs: [\"get\"]\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"create\", \"delete\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: run-nutanixabs-provisioner\n  namespace: kube-system\nsubjects:\n  - kind: ServiceAccount\n    name: nutanixabs-provisioner\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: nutanixabs-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      labels:\n        app: nutanixabs-provisioner\n    spec:\n      serviceAccount: nutanixabs-provisioner\n      hostNetwork: true\n      containers:\n        -\n          image: \"ntnx\/nutanixabs-provisioner\"\n          name: nutanixabs-provisioner\n          args: [\"--v=4\"]\n          imagePullPolicy: IfNotPresent\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: kube-system\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\n---\nkind: StorageClass\napiVersion: storage.k8s.io\/v1\nmetadata:\n  name: silver \n  namespace: kube-system\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\nprovisioner: nutanix\/abs\nparameters:\n     prismEndPoint: @@{PE_CLUSTER_IP}@@:9440\n     dataServiceEndPoint: @@{PE_DATA_SERVICE_IP}@@:3260\n     secretName: ntnx-secret\n     storageContainer: @@{PE_CONTAINER_NAME}@@\n     fsType: ext4\n     chapAuthEnabled: \"false\"' | sudo tee \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\necho \"apiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: default\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\" | sudo tee -a \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"9070721a-1ddc-4336-84af-8f4b5222f0e0"}],"name":"8e760b73_runbook_cloned_0","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"dac441af_dag_cloned_1","uuid":"42047288-c092-4490-9d35-8d8f5c2239e8"},"uuid":"b566cdff-86b4-4e54-a750-59de52ff15af"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SM_Package","uuid":"78d59e2e-ea58-482a-a2b2-6f593da4049e"},"retries":"0","name":"6324786a_dag_cloned_1","type":"DAG","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"ed711bea-3d69-4792-ad72-a0fa36ea05b2"}],"name":"6522ac7a_runbook_cloned_0","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"6324786a_dag_cloned_1","uuid":"ed711bea-3d69-4792-ad72-a0fa36ea05b2"},"uuid":"19face75-4a07-4275-a2b7-7a527b6afc94"}},"variable_list":[],"description":""},{"uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e","action_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"}],"name":"VMware_Centos_K8SW_Package","version":"","type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"},"retries":"0","name":"c1566b3d_dag_cloned_1","type":"DAG","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"58afc9b7-6344-44f7-8120-66344159c43c"},{"kind":"app_task","name":"Docker Kubelet Install","uuid":"ef55dc25-331e-467b-8a75-93e52a3a9196"},{"kind":"app_task","name":"GetCerts","uuid":"2df62ed9-2fce-4797-99bb-19a885acd436"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"58afc9b7-6344-44f7-8120-66344159c43c"},"edge_type":"user_defined","type":"","uuid":"eb4975a9-1417-4655-9682-e07eece42cc3","to_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"ef55dc25-331e-467b-8a75-93e52a3a9196"}},{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"ef55dc25-331e-467b-8a75-93e52a3a9196"},"edge_type":"user_defined","type":"","uuid":"446e72a6-a593-4d15-8747-09aa5e195b77","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"2df62ed9-2fce-4797-99bb-19a885acd436"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"fc3253c9-49fc-42e0-a1c6-69b9fd784fad"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","name":"Set Kubernetes Version","type":"SET_VARIABLE","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"58afc9b7-6344-44f7-8120-66344159c43c"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","name":"Docker Kubelet Install","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{calm_array_VERSION[0]}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{VMware_Centos_K8SM.address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v*.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    - --masquerade-all=true\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masquerade-all\/d' ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\nfi \n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"ef55dc25-331e-467b-8a75-93e52a3a9196"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","name":"GetCerts","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{VMware_Centos_K8SM.address[0]}@@\"\nINSTANCE_IP=\"@@{address}@@\"\ninstance=\"worker@@{calm_array_index}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nsudo systemctl start iscsid\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; if [[ $count -eq 600 ]]; then echo \"failed to download certs\" && exit 1; fi; count=$(($count+5)) ; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${instance} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${instance} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"2df62ed9-2fce-4797-99bb-19a885acd436"}],"name":"9a6e189b_runbook_cloned_0","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"c1566b3d_dag_cloned_1","uuid":"fc3253c9-49fc-42e0-a1c6-69b9fd784fad"},"uuid":"29817be6-faed-456b-bd8f-baad608aee10"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"VMware_Centos_K8SW_Package","uuid":"f749fc63-17aa-4814-a56b-c45ca8be030e"},"retries":"0","name":"abd3357c_dag_cloned_1","type":"DAG","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node_cloned_1","uuid":"6f7ba9c2-106d-4b02-901a-1a72e4921915"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"c187a944-a8fe-4a59-b985-7ad2d7737044"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"045659a2-932c-49c8-9269-3a911f955962"},"retries":"0","name":"Remove Node","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain 'worker@@{calm_array_index}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node 'worker@@{calm_array_index}@@'\"","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"6f7ba9c2-106d-4b02-901a-1a72e4921915"}],"name":"3cb17acf_runbook_cloned_0","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"abd3357c_dag_cloned_1","uuid":"c187a944-a8fe-4a59-b985-7ad2d7737044"},"uuid":"b72aa6c1-199c-4e8e-9489-f9337ee518b9"}},"variable_list":[],"description":""},{"uuid":"8fb1dd88-fcf1-444f-a5bb-d5482c87170f","action_list":[],"service_local_reference_list":[],"name":"ESX_CENTOS_76","version":"","type":"SUBSTRATE_IMAGE","options":{"type":"","name":"CENTOS_76","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/filer.dev.eng.nutanix.com:8080\/GoldImages\/NuCalm\/Ova%20files\/CentOS-7-x86_64-1810.ova","version":{"product_version":"","type":"","product_name":""},"architecture":"X86_64","type":""},"description":""},"variable_list":[],"description":""}],"client_attrs":{"5fec9da3-ca77-445c-96cb-726df66c483e":{"y":413.0940071326,"x":768.9612911807},"56a7c02a-9a6e-46e2-8d39-c786833649db":{"y":151.1603651085,"x":418},"e51f257b-fa1f-4293-8b25-64b1e57d824e":{"y":413.0940071326,"x":768.9612911807},"d0f58896-b535-451c-a462-71690d7d9c43":{"y":151.1603651085,"x":418},"41a81f4c-6289-4f56-aef8-b7f9003bb8fa":{"y":151.1603651085,"x":418},"7306a3c9-9a76-45c2-90c9-27729ab58b5f":{"y":413.0940071326,"x":768.9612911807},"72e86e92-9738-41e0-bad3-0fcf79e92c97":{"y":413.0940071326,"x":768.9612911807},"b81c9b76-a47d-4a40-b199-3ea41ef244a9":{"y":151.1603651085,"x":418},"4b3985c8-846b-4321-9603-db0b165c02a9":{"y":151.1603651085,"x":418},"78e07ffd-9c25-4005-aba0-444053ecbcd7":{"y":413.0940071326,"x":768.9612911807}}},"description":"* [Kubernetes API](https:\/\/@@{Kubernetes_Master.address[0]}@@:6443)\n* [Kubernetes Dashboard](https:\/\/@@{Kubernetes_Master.address[0]}@@:30443)"},"api_version":"3.0","metadata":{"last_update_time":"1558088963671897","owner_reference":{"kind":"user","uuid":"00000000-0000-0000-0000-000000000000","name":"admin"},"kind":"blueprint","uuid":"14d3faec-37f8-421f-ada4-bc633922d4f6","project_reference":{"kind":"project","name":"default","uuid":"209e0a42-6f2d-4999-9a9b-5aa705d25661"},"spec_version":58,"creation_time":"1554807102958211","name":"Kubernetes"}}