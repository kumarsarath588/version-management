{"status":{"description":"* [Kubernetes API](https:\/\/@@{Kubernetes_Master.address[0]}@@:6443)\n* [Kubernetes Dashboard](https:\/\/@@{Kubernetes_Master.address[0]}@@:30443)","source_mpi":"","state":"ACTIVE","is_cloned":false,"message_list":[],"resources":{"service_definition_list":[{"port_list":[],"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"2dab1398-5f4e-4312-9de2-a47650fa1a88","name":"action_create","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"DAG","uuid":"3a8535ac-4cef-4ea1-8a0f-0511df9796b5","child_tasks_local_reference_list":[{"kind":"app_task","name":"Dashboard","uuid":"b78869cd-4bdd-4789-9b7f-a3a9af35df6a"},{"kind":"app_task","name":"HELM","uuid":"0fb90d2a-ff76-4b43-b67e-ff89e7e903e1"},{"kind":"app_task","name":"MetricsServer","uuid":"973147f0-ea02-4401-a76f-612d810beb74"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Dashboard","uuid":"b78869cd-4bdd-4789-9b7f-a3a9af35df6a"},"edge_type":"user_defined","type":"","uuid":"7c5a5e88-f8b5-4bd5-8f2f-120582ba7ac0","to_task_reference":{"kind":"app_task","name":"HELM","uuid":"0fb90d2a-ff76-4b43-b67e-ff89e7e903e1"}},{"from_task_reference":{"kind":"app_task","name":"HELM","uuid":"0fb90d2a-ff76-4b43-b67e-ff89e7e903e1"},"edge_type":"user_defined","type":"","uuid":"d5af30e4-bc4e-468d-bfc6-85056382af85","to_task_reference":{"kind":"app_task","name":"MetricsServer","uuid":"973147f0-ea02-4401-a76f-612d810beb74"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"f33eac3f_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"EXEC","uuid":"b78869cd-4bdd-4789-9b7f-a3a9af35df6a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/dashboard\necho '# Copyright 2015 Google Inc. All Rights Reserved.\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#     http:\/\/www.apache.org\/licenses\/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\n# Configuration to deploy release version of the Dashboard UI compatible with\n# Kubernetes 1.7.\n#\n# Example usage: kubectl create -f <this_file>\n\n# ------------------- Dashboard Secret ------------------- #\n\napiVersion: v1\nkind: Secret\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard-certs\n  namespace: kube-system\ntype: Opaque\n\n---\n# ------------------- Dashboard Service Account ------------------- #\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\n\n---\n# ------------------- Dashboard Role & Role Binding ------------------- #\n\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: kubernetes-full-access\n  namespace: kube-system\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: kubernetes-dashboard\n  namespace: kube-system\n\n---\n# ------------------- Dashboard Deployment ------------------- #\n\nkind: Deployment\napiVersion: apps\/v1beta2\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\nspec:\n  replicas: 1\n  revisionHistoryLimit: 10\n  selector:\n    matchLabels:\n      k8s-app: kubernetes-dashboard\n  template:\n    metadata:\n      labels:\n        k8s-app: kubernetes-dashboard\n    spec:\n      containers:\n      - name: kubernetes-dashboard\n        image: k8s.gcr.io\/kubernetes-dashboard-amd64:v1.10.1\n        ports:\n        - containerPort: 8443\n          protocol: TCP\n        args:\n          - --auto-generate-certificates\n          # Uncomment the following line to manually specify Kubernetes API server Host\n          # If not specified, Dashboard will attempt to auto discover the API server and connect\n          # to it. Uncomment only if the default does not work.\n          # - --apiserver-host=http:\/\/my-address:port\n        volumeMounts:\n        - name: kubernetes-dashboard-certs\n          mountPath: \/certs\n          # Create on-disk volume to store exec logs\n        - mountPath: \/tmp\n          name: tmp-volume\n        livenessProbe:\n          httpGet:\n            scheme: HTTPS\n            path: \/\n            port: 8443\n          initialDelaySeconds: 30\n          timeoutSeconds: 30\n      volumes:\n      - name: kubernetes-dashboard-certs\n        secret:\n          secretName: kubernetes-dashboard-certs\n      - name: tmp-volume\n        emptyDir: {}\n      serviceAccountName: kubernetes-dashboard\n      # Comment the following tolerations if Dashboard must not be deployed on master\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        effect: NoSchedule\n\n---\n# ------------------- Dashboard Service ------------------- #\n\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\nspec:\n  type: NodePort\n  ports:\n    - port: 8443\n      nodePort: 30443\n  selector:\n    k8s-app: kubernetes-dashboard' | sudo tee \/etc\/kubernetes\/addons\/dashboard\/kubernetes-dashboard.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/dashboard\/kubernetes-dashboard.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Dashboard"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"EXEC","uuid":"0fb90d2a-ff76-4b43-b67e-ff89e7e903e1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir \/etc\/kubernetes\/addons\/helm\necho \"#helm init --service-account helm\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: helm\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: helm\n  namespace: kube-system\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: helm\n  namespace: kube-system\" | sudo tee \/etc\/kubernetes\/addons\/helm\/helm.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/helm\/helm.yaml\nhelm init --service-account helm\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"HELM"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"EXEC","uuid":"973147f0-ea02-4401-a76f-612d810beb74","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir \/etc\/kubernetes\/addons\/metricsserver\n\n\necho 'apiVersion: rbac.authorization.k8s.io\/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: metrics-server:system:auth-delegator\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:auth-delegator\nsubjects:\n- kind: ServiceAccount\n  name: metrics-server\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1\nkind: RoleBinding\nmetadata:\n  name: metrics-server-auth-reader\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: Role\n  name: extension-apiserver-authentication-reader\nsubjects:\n- kind: ServiceAccount\n  name: metrics-server\n  namespace: kube-system\n---\napiVersion: apiregistration.k8s.io\/v1beta1\nkind: APIService\nmetadata:\n  name: v1beta1.metrics.k8s.io\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  service:\n    name: metrics-server\n    namespace: kube-system\n  group: metrics.k8s.io\n  version: v1beta1\n  insecureSkipTLSVerify: true\n  groupPriorityMinimum: 100\n  versionPriority: 100\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: metrics-server\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: metrics-server-config\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  NannyConfiguration: |-\n    apiVersion: nannyconfig\/v1alpha1\n    kind: NannyConfiguration\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: metrics-server-v0.3.3\n  namespace: kube-system\n  labels:\n    k8s-app: metrics-server\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    version: v0.3.3\nspec:\n  selector:\n    matchLabels:\n      k8s-app: metrics-server\n      version: v0.3.3\n  template:\n    metadata:\n      name: metrics-server\n      labels:\n        k8s-app: metrics-server\n        version: v0.3.3\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      serviceAccountName: metrics-server\n      containers:\n      - name: metrics-server\n        image: k8s.gcr.io\/metrics-server-amd64:v0.3.3\n        command:\n        - \/metrics-server\n        - --metric-resolution=30s\n        - --kubelet-preferred-address-types=InternalIP,Hostname,InternalDNS,ExternalDNS,ExternalIP\n        ports:\n        - containerPort: 443\n          name: https\n          protocol: TCP\n      - name: metrics-server-nanny\n        image: k8s.gcr.io\/addon-resizer:1.8.4\n        resources:\n          limits:\n            cpu: 100m\n            memory: 300Mi\n          requests:\n            cpu: 5m\n            memory: 50Mi\n        env:\n          - name: MY_POD_NAME\n            valueFrom:\n              fieldRef:\n                fieldPath: metadata.name\n          - name: MY_POD_NAMESPACE\n            valueFrom:\n              fieldRef:\n                fieldPath: metadata.namespace\n        volumeMounts:\n        - name: metrics-server-config-volume\n          mountPath: \/etc\/config\n        command:\n          - \/pod_nanny\n          - --config-dir=\/etc\/config\n          - --cpu=1\n          - --extra-cpu=0.5m\n          - --memory=40\n          - --extra-memory=4Mi\n          - --threshold=5\n          - --deployment=metrics-server-v0.3.3\n          - --container=metrics-server\n          - --poll-period=300000\n          - --estimator=exponential\n          - --minClusterSize=3\n      volumes:\n        - name: metrics-server-config-volume\n          configMap:\n            name: metrics-server-config\n      tolerations:\n        - key: \"CriticalAddonsOnly\"\n          operator: \"Exists\"\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: metrics-server\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/cluster-service: \"true\"\n    kubernetes.io\/name: \"Metrics-server\"\nspec:\n  selector:\n    k8s-app: metrics-server\n  ports:\n  - port: 443\n    protocol: TCP\n    targetPort: https\n---\napiVersion: rbac.authorization.k8s.io\/v1\nkind: ClusterRole\nmetadata:\n  name: system:metrics-server\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n- apiGroups:\n  - \"\"\n  resources:\n  - pods\n  - nodes\n  - nodes\/stats\n  - namespaces\n  verbs:\n  - get\n  - list\n  - watch\n- apiGroups:\n  - \"extensions\"\n  resources:\n  - deployments\n  verbs:\n  - get\n  - list\n  - update\n  - watch\n---\napiVersion: rbac.authorization.k8s.io\/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:metrics-server\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:metrics-server\nsubjects:\n- kind: ServiceAccount\n  name: metrics-server\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/metricsserver\/metricsserver.yaml\n  \nkubectl create -f \/etc\/kubernetes\/addons\/metricsserver\/metricsserver.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"MetricsServer"}],"description":"","message_list":[],"uuid":"337c08c1-d983-4234-bb61-802e5a642090","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"f33eac3f_dag","uuid":"3a8535ac-4cef-4ea1-8a0f-0511df9796b5"},"name":"a9639da1_runbook"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"4806ed5a-3821-4c8e-882c-59daa9a1bcb9","name":"action_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"DAG","uuid":"80f6321b-cacf-48b3-ac08-84797e785a35","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"62a92d34_dag"}],"description":"","message_list":[],"uuid":"26ce2713-05fa-4b65-ac37-579626d25b62","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"62a92d34_dag","uuid":"80f6321b-cacf-48b3-ac08-84797e785a35"},"name":"8c4aa276_runbook"}},{"description":"System action for starting an application","message_list":[],"uuid":"a5492ffc-5d09-4dc5-81b2-dde463997d65","name":"action_start","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"DAG","uuid":"3176680b-a2a7-4827-9e53-7134037cd307","child_tasks_local_reference_list":[{"kind":"app_task","name":"Start","uuid":"e2f9f724-9a4a-49b3-91aa-7bb792d4a054"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"334b4484_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"EXEC","uuid":"e2f9f724-9a4a-49b3-91aa-7bb792d4a054","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\nsudo systemctl start etcd docker kubelet \nsudo systemctl enable etcd docker kubelet\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Start"}],"description":"","message_list":[],"uuid":"dfd5bd01-3ebf-47c9-9501-e21346d9e5ef","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"334b4484_dag","uuid":"3176680b-a2a7-4827-9e53-7134037cd307"},"name":"daee30ae_runbook"}},{"description":"System action for stopping an application","message_list":[],"uuid":"ae96608f-55a2-4b97-bcb1-14bf21746733","name":"action_stop","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"DAG","uuid":"853a243e-8b76-463f-95c7-09f9de5a7928","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"9713c3d0_dag"}],"description":"","message_list":[],"uuid":"4fde4266-9dcc-48ff-9ff0-b3b3ff53d82c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"9713c3d0_dag","uuid":"853a243e-8b76-463f-95c7-09f9de5a7928"},"name":"6407a345_runbook"}},{"description":"System action for restarting an application","message_list":[],"uuid":"072bbe7b-8832-4832-aff7-e9818d7df759","name":"action_restart","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"DAG","uuid":"b6f5d74b-ab0e-41dd-a787-6155d6e64891","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"414912df_dag"}],"description":"","message_list":[],"uuid":"dae0b6c4-1f7d-4497-9710-8f360bc20831","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"414912df_dag","uuid":"b6f5d74b-ab0e-41dd-a787-6155d6e64891"},"name":"d5c8316f_runbook"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"740ccf4c-86a0-4d62-ad96-b2419eb0eaf0","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"DAG","uuid":"8c7c9a96-8c9d-4244-a42f-500348e0bd4f","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Service_Element_Delete_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"ad6bcf07-be1e-4333-8265-897c91e4afd0"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"ad6bcf07-be1e-4333-8265-897c91e4afd0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Service_Element_Delete_64a2dda5_481c_4a03_80cb_9cb9b954e1e0"}],"description":"","message_list":[],"uuid":"83064c0f-b87b-4e8f-b4ae-0d9be93e1f13","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"8c7c9a96-8c9d-4244-a42f-500348e0bd4f"},"name":"SYS_GEN__Runbook_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0"}}],"message_list":[],"uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0","state":"ACTIVE","depends_on_list":[],"editables":{},"tier":"","singleton":false,"variable_list":[{"val_type":"STRING","description":"","message_list":[],"uuid":"f76eacd2-8090-4840-b4e3-8ada58ebe1e9","value":"","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{},"type":"LOCAL","name":"VERSION"}],"name":"Kubernetes_Master"},{"port_list":[],"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"b524b43e-e34a-4b36-9fc4-8b97796dcad5","name":"action_create","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"DAG","uuid":"923300fb-07a2-47d5-80da-c3f479ff345d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"4af7c45f_dag"}],"description":"","message_list":[],"uuid":"9bd65d16-65b7-45ae-99ab-298f6f137505","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"4af7c45f_dag","uuid":"923300fb-07a2-47d5-80da-c3f479ff345d"},"name":"7c6e4932_runbook"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"93b924ac-b77b-4ae4-870e-f44bf3540c43","name":"action_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"DAG","uuid":"2f417209-bdde-42bc-bbe6-3a04ac005398","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"1e2c50bb_dag"}],"description":"","message_list":[],"uuid":"09962a62-e984-4f41-bd3f-98968b698ac0","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"1e2c50bb_dag","uuid":"2f417209-bdde-42bc-bbe6-3a04ac005398"},"name":"1d794193_runbook"}},{"description":"System action for starting an application","message_list":[],"uuid":"b7f65a96-487b-4d84-8c2a-e9cf27df0d44","name":"action_start","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"DAG","uuid":"06cc2e88-c5c6-4bd3-ac5c-11a3bfb6a10f","child_tasks_local_reference_list":[{"kind":"app_task","name":"Start","uuid":"8888d396-2780-46cf-afcd-803cb5596643"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"970128c7_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"EXEC","uuid":"8888d396-2780-46cf-afcd-803cb5596643","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo systemctl start docker kubelet\nsudo systemctl enable docker kubelet"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Start"}],"description":"","message_list":[],"uuid":"d2212910-a48e-4c21-96d4-009c61505cad","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"970128c7_dag","uuid":"06cc2e88-c5c6-4bd3-ac5c-11a3bfb6a10f"},"name":"884352cf_runbook"}},{"description":"System action for stopping an application","message_list":[],"uuid":"529e0ba8-6ba4-47f0-affd-e3bf2cb299a1","name":"action_stop","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"DAG","uuid":"d77034d2-3188-45a9-89f1-44a7a276137a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6c01dc28_dag"}],"description":"","message_list":[],"uuid":"b769d338-4161-4626-972a-7c9bcf413eac","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6c01dc28_dag","uuid":"d77034d2-3188-45a9-89f1-44a7a276137a"},"name":"0cb172a7_runbook"}},{"description":"System action for restarting an application","message_list":[],"uuid":"235dc97c-abbd-47bc-96dc-a2187b53f16e","name":"action_restart","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"DAG","uuid":"8143fc4d-46d3-4d13-b12e-a1c277d04668","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"1d66b5be_dag"}],"description":"","message_list":[],"uuid":"cd09b8ce-f3e9-43e8-a843-6623eb53b961","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"1d66b5be_dag","uuid":"8143fc4d-46d3-4d13-b12e-a1c277d04668"},"name":"3a6f587d_runbook"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"731c2ea2-f27f-484b-8cc9-3f5f06552bd6","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"DAG","uuid":"ded911aa-2d99-4746-8182-d8c30336d2ae","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Service_Element_Delete_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"db11c504-a700-4d71-ad2a-ad1fa7924a71"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Service_d59081fe_18e1_4b9b_a76e_a674108df517"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"db11c504-a700-4d71-ad2a-ad1fa7924a71","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Service_Element_Delete_d59081fe_18e1_4b9b_a76e_a674108df517"}],"description":"","message_list":[],"uuid":"b28fd8da-c23e-45fb-86d4-4f1f6222b794","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"ded911aa-2d99-4746-8182-d8c30336d2ae"},"name":"SYS_GEN__Runbook_Service_d59081fe_18e1_4b9b_a76e_a674108df517"}}],"message_list":[],"uuid":"d59081fe-18e1-4b9b-a76e-a674108df517","state":"ACTIVE","depends_on_list":[],"editables":{},"tier":"","singleton":false,"variable_list":[{"val_type":"STRING","description":"","message_list":[],"uuid":"e205abf6-b94b-4d59-bf6c-29e25d46f663","value":"","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{},"type":"LOCAL","name":"VERSION"}],"name":"Kubernetes_Worker"}],"substrate_definition_list":[{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"d3767e8b-7962-4872-b85e-a981deb614c2","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"DAG","uuid":"3c2dc6cc-1eca-44d4-b0da-7d8a3e0472f3","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Provision_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"ead611d4-6626-4918-8925-242294369a73"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"e5f1e718-7e57-4e88-99cc-5fe3500b0526"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Provision_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"ead611d4-6626-4918-8925-242294369a73"},"edge_type":"inherent","type":"","uuid":"9cf36edb-1ae3-4888-89e7-7ff0af76d658","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"e5f1e718-7e57-4e88-99cc-5fe3500b0526"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"PROVISION_NUTANIX","uuid":"ead611d4-6626-4918-8925-242294369a73","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"name":"K8SM-@@{calm_array_index}@@-@@{calm_time}@@","categories":"","availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"718f9bd2-7aed-43cb-9fae-fe984c162b57"},"type":""}],"parent_reference":null,"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"serial_port_list":[],"gpu_list":[],"memory_size_mib":2048,"power_state":"ON","hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"type":"","boot_config":{"boot_device":{"type":"","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CENTOS_76","uuid":"04ab0470-1aae-4704-9624-b3cff5cd25b7"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":1,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":2,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":3,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":4,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":5,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":6,"type":""}}}]}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Provision_ea96440f_ce01_43e0_893d_b5bd8347d8a1"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"e5f1e718-7e57-4e88-99cc-5fe3500b0526","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_ea96440f_ce01_43e0_893d_b5bd8347d8a1"}],"description":"","message_list":[],"uuid":"c89908b2-4da4-4179-9db3-708d8b3d88cd","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"3c2dc6cc-1eca-44d4-b0da-7d8a3e0472f3"},"name":"SYS_GEN__Runbook_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1"}},{"description":"System action for powering on an application","message_list":[],"uuid":"9afcb062-8a4e-4860-8045-5fae270af6db","name":"action_poweron","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"DAG","uuid":"ad5c60d6-1f6f-485e-8dc8-afb7c519b7f6","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOn_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"f3e909a7-e901-4d5c-861e-56a3f5ce9091"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"a2853764-d0c4-45c1-aa89-3f5215e43033"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOn_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"f3e909a7-e901-4d5c-861e-56a3f5ce9091"},"edge_type":"inherent","type":"","uuid":"7a75bed0-03f5-42ff-80fc-4937e2028064","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"a2853764-d0c4-45c1-aa89-3f5215e43033"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"f3e909a7-e901-4d5c-861e-56a3f5ce9091","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_PowerOn_ea96440f_ce01_43e0_893d_b5bd8347d8a1"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"a2853764-d0c4-45c1-aa89-3f5215e43033","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_ea96440f_ce01_43e0_893d_b5bd8347d8a1"}],"description":"","message_list":[],"uuid":"3abad12e-8d11-4552-b2bf-85bfe2e4007a","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"ad5c60d6-1f6f-485e-8dc8-afb7c519b7f6"},"name":"SYS_GEN__Runbook_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1"}},{"description":"System action for restarting an application","message_list":[],"uuid":"8e223ee8-56e4-466b-bf6b-d7b83d89e028","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"DAG","uuid":"097e4c26-7e9a-4f87-b7bc-6e7c35057432","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_Restart_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"840b74fa-8715-4c65-988b-82342135a3fb"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"70c3140e-f9af-460a-8e03-d3d82c287c8d"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_Restart_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"840b74fa-8715-4c65-988b-82342135a3fb"},"edge_type":"inherent","type":"","uuid":"2f9b12c1-720c-4fd8-978d-56cb0074e4b5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"70c3140e-f9af-460a-8e03-d3d82c287c8d"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"840b74fa-8715-4c65-988b-82342135a3fb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_Restart_ea96440f_ce01_43e0_893d_b5bd8347d8a1"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"70c3140e-f9af-460a-8e03-d3d82c287c8d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_ea96440f_ce01_43e0_893d_b5bd8347d8a1"}],"description":"","message_list":[],"uuid":"f8dbff75-b18f-411c-b1b9-684afaae49cb","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"097e4c26-7e9a-4f87-b7bc-6e7c35057432"},"name":"SYS_GEN__Runbook_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1"}},{"description":"System action for suspending an application","message_list":[],"uuid":"275445a7-9f53-4b93-9daf-c68bfd892505","name":"action_suspend","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"DAG","uuid":"7d7fd5c2-d21f-4c5e-bc1d-5615f91c6e72","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1"}],"description":"","message_list":[],"uuid":"8322edf2-7bf8-411a-b8f6-92232c37aadd","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"7d7fd5c2-d21f-4c5e-bc1d-5615f91c6e72"},"name":"SYS_GEN__Runbook_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1"}},{"description":"System action for modifying an application","message_list":[],"uuid":"ec3c194b-3c24-435c-8901-de4df6b46f0b","name":"action_modify","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"DAG","uuid":"8d892e9f-ff0e-46ff-829b-4fc40170cc49","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1"}],"description":"","message_list":[],"uuid":"968c83c4-daa6-4015-b88f-34f720b7c431","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"8d892e9f-ff0e-46ff-829b-4fc40170cc49"},"name":"SYS_GEN__Runbook_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1"}},{"description":"System action for powering off an application","message_list":[],"uuid":"6c71c980-53f1-49aa-b647-884a2bac6cd0","name":"action_poweroff","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"DAG","uuid":"7d7abe18-f891-4557-b5c7-c7183157b841","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOff_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"ad9267bd-c63d-4447-a584-f2a19ee5ca0e"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"ad9267bd-c63d-4447-a584-f2a19ee5ca0e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_PowerOff_ea96440f_ce01_43e0_893d_b5bd8347d8a1"}],"description":"","message_list":[],"uuid":"c1a97631-2b1e-4195-a6f6-6cf248c79516","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"7d7abe18-f891-4557-b5c7-c7183157b841"},"name":"SYS_GEN__Runbook_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"075d8ad7-b757-410f-8c25-3a86bf4c5334","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"DAG","uuid":"d03c2ad1-990d-4b0d-bc2a-12aa3d3afc06","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Delete_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"1e88760c-4b9b-494b-923f-9a318e8e5714"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"DELETE_NUTANIX","uuid":"1e88760c-4b9b-494b-923f-9a318e8e5714","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Delete_ea96440f_ce01_43e0_893d_b5bd8347d8a1"}],"description":"","message_list":[],"uuid":"13fe4599-64aa-4971-af0f-5cfc3695bd46","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"d03c2ad1-990d-4b0d-bc2a-12aa3d3afc06"},"name":"SYS_GEN__Runbook_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"6548d61e-9ca1-41d1-b39c-6c3b4db72aef","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"DAG","uuid":"a6f006f6-3983-4bbe-bedf-1511bde211b6","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Substrate_Element_Delete_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"4a352607-dc33-4007-b78c-19c52d0cdcf5"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"4a352607-dc33-4007-b78c-19c52d0cdcf5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Substrate_Element_Delete_ea96440f_ce01_43e0_893d_b5bd8347d8a1"}],"description":"","message_list":[],"uuid":"7a67c432-dd10-40ce-a045-3008b6c54ed2","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"a6f006f6-3983-4bbe-bedf-1511bde211b6"},"name":"SYS_GEN__Runbook_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1"}}],"message_list":[],"uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1","state":"ACTIVE","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"0","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS","uuid":"7f504213-fb04-443e-8007-1547bccadb97"}},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"name":true,"resources":{"nic_list":{"0":{"subnet_reference":true}},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"guest_customization":true,"disk_list":{"1":{"disk_size_mib":true},"3":{"disk_size_mib":true},"2":{"disk_size_mib":true},"5":{"disk_size_mib":true},"4":{"disk_size_mib":true},"6":{"disk_size_mib":true}}}}},"os_type":"Linux","type":"AHV_VM","create_spec":{"name":"K8SM-@@{calm_array_index}@@-@@{calm_time}@@","categories":"","availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"718f9bd2-7aed-43cb-9fae-fe984c162b57"},"type":""}],"parent_reference":null,"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"serial_port_list":[],"gpu_list":[],"memory_size_mib":2048,"power_state":"ON","hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"type":"","boot_config":{"boot_device":{"type":"","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CENTOS_76","uuid":"04ab0470-1aae-4704-9624-b3cff5cd25b7"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":1,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":2,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":3,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":4,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":5,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":6,"type":""}}}]}},"variable_list":[],"name":"AHV_Centos_K8SM"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"f16e7177-b408-4483-82f7-0161f9f89a4c","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"DAG","uuid":"889ec870-4c8c-41e5-9eae-6c8bcad244d9","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Provision_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"61cc5c33-fe0e-4252-93f9-f737c4fbb097"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SW_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"8f166c78-a804-42c5-9b2c-c5095fc82ea4"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Provision_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"61cc5c33-fe0e-4252-93f9-f737c4fbb097"},"edge_type":"inherent","type":"","uuid":"a5598605-5cd4-474d-b287-39923183b3f1","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SW_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"8f166c78-a804-42c5-9b2c-c5095fc82ea4"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"PROVISION_NUTANIX","uuid":"61cc5c33-fe0e-4252-93f9-f737c4fbb097","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"name":"K8SW-@@{calm_array_index}@@-@@{calm_time}@@","categories":"","availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"718f9bd2-7aed-43cb-9fae-fe984c162b57"},"type":""}],"parent_reference":null,"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"serial_port_list":[],"gpu_list":[],"memory_size_mib":4096,"power_state":"ON","hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"type":"","boot_config":{"boot_device":{"type":"","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CENTOS_76","uuid":"04ab0470-1aae-4704-9624-b3cff5cd25b7"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":1,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":2,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":3,"type":""}}}]}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Provision_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"8f166c78-a804-42c5-9b2c-c5095fc82ea4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_Centos_K8SW_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"}],"description":"","message_list":[],"uuid":"0a7cb0fa-8ce2-4ca1-ba00-69e0e254cf89","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"889ec870-4c8c-41e5-9eae-6c8bcad244d9"},"name":"SYS_GEN__Runbook_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"}},{"description":"System action for powering on an application","message_list":[],"uuid":"319f6e72-4370-487d-9b3e-e0254c518da1","name":"action_poweron","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"DAG","uuid":"af518aa8-3e41-4dee-b65b-77dca89c6bc6","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOn_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"978f12bc-01e6-4239-971b-b6b34b34071e"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SW_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"f370306c-a77d-46b5-9b80-125029c75ee9"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOn_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"978f12bc-01e6-4239-971b-b6b34b34071e"},"edge_type":"inherent","type":"","uuid":"73d17342-4953-44b4-99a4-1b8dfed0b9fb","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SW_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"f370306c-a77d-46b5-9b80-125029c75ee9"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"978f12bc-01e6-4239-971b-b6b34b34071e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_PowerOn_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"f370306c-a77d-46b5-9b80-125029c75ee9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_Centos_K8SW_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"}],"description":"","message_list":[],"uuid":"487e3b1f-2401-4384-9b10-902b111f7b54","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"af518aa8-3e41-4dee-b65b-77dca89c6bc6"},"name":"SYS_GEN__Runbook_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"}},{"description":"System action for restarting an application","message_list":[],"uuid":"502abfa5-408d-4053-be08-a9e9e39a585e","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"DAG","uuid":"3cc71bf8-99b8-41ee-8e68-d89d298840fe","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_Restart_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"f8a37519-3d07-408f-9a44-4f769f743d4f"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SW_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"00bda974-b68c-4a59-b6a6-fe301e1e613f"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_Restart_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"f8a37519-3d07-408f-9a44-4f769f743d4f"},"edge_type":"inherent","type":"","uuid":"dae7f5ce-6c4f-400c-9948-373478b79691","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SW_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"00bda974-b68c-4a59-b6a6-fe301e1e613f"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"f8a37519-3d07-408f-9a44-4f769f743d4f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_Restart_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"00bda974-b68c-4a59-b6a6-fe301e1e613f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_Centos_K8SW_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"}],"description":"","message_list":[],"uuid":"cb870644-7c11-486e-881d-ad74d77112cf","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"3cc71bf8-99b8-41ee-8e68-d89d298840fe"},"name":"SYS_GEN__Runbook_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"}},{"description":"System action for suspending an application","message_list":[],"uuid":"d1babb4d-6540-43df-a109-f17ab5a5284f","name":"action_suspend","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"DAG","uuid":"85315171-0e00-4f57-ba07-2f0eaedebfb0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"}],"description":"","message_list":[],"uuid":"bb5d60e5-c8d4-443c-aa91-8f6eff525f63","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"85315171-0e00-4f57-ba07-2f0eaedebfb0"},"name":"SYS_GEN__Runbook_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"}},{"description":"System action for modifying an application","message_list":[],"uuid":"9a8a4ce6-d949-438d-b0a6-187e48ce4f15","name":"action_modify","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"DAG","uuid":"ddfd3571-2778-4155-bf17-3a633e075a8c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"}],"description":"","message_list":[],"uuid":"0995b86d-a7cc-4a23-a98f-5a79217c3565","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"ddfd3571-2778-4155-bf17-3a633e075a8c"},"name":"SYS_GEN__Runbook_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"}},{"description":"System action for powering off an application","message_list":[],"uuid":"cf0a3906-2f04-453b-946b-2d98408da26e","name":"action_poweroff","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"DAG","uuid":"a90d5897-2164-4057-b016-7fa8913d7f10","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOff_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"e44df8b5-4629-4181-b0ee-a8473831d66c"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"e44df8b5-4629-4181-b0ee-a8473831d66c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_PowerOff_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"}],"description":"","message_list":[],"uuid":"089a6dff-8e7f-44d0-92ca-8188c6bac3f6","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"a90d5897-2164-4057-b016-7fa8913d7f10"},"name":"SYS_GEN__Runbook_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"7c45c217-9730-46e0-8293-6663fe01f49e","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"DAG","uuid":"436c85b3-2563-43dc-abc0-5d884b5333a2","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Delete_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"8a69827d-9a31-45de-aeef-ec6467fcb4da"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"DELETE_NUTANIX","uuid":"8a69827d-9a31-45de-aeef-ec6467fcb4da","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Delete_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"}],"description":"","message_list":[],"uuid":"a6b80b68-4571-4ca2-aa57-bc80bc9d9004","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"436c85b3-2563-43dc-abc0-5d884b5333a2"},"name":"SYS_GEN__Runbook_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"29d2af2d-543e-4d02-9277-afd5564ac45b","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"DAG","uuid":"6b6a301f-ffa4-42b0-8edf-f7521ec5d726","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Substrate_Element_Delete_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"e2187f35-a4d3-45c5-ba48-fd428e6c57e2"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"e2187f35-a4d3-45c5-ba48-fd428e6c57e2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Substrate_Element_Delete_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"}],"description":"","message_list":[],"uuid":"9909f3ce-8c36-4ec7-a2ed-caa33bd71bac","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"6b6a301f-ffa4-42b0-8edf-f7521ec5d726"},"name":"SYS_GEN__Runbook_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"}}],"message_list":[],"uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9","state":"ACTIVE","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"0","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS","uuid":"7f504213-fb04-443e-8007-1547bccadb97"}},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"name":true,"resources":{"nic_list":{"0":{"subnet_reference":true}},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"guest_customization":true,"disk_list":{"1":{"disk_size_mib":true},"3":{"disk_size_mib":true},"2":{"disk_size_mib":true}}}}},"os_type":"Linux","type":"AHV_VM","create_spec":{"name":"K8SW-@@{calm_array_index}@@-@@{calm_time}@@","categories":"","availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"718f9bd2-7aed-43cb-9fae-fe984c162b57"},"type":""}],"parent_reference":null,"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"serial_port_list":[],"gpu_list":[],"memory_size_mib":4096,"power_state":"ON","hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"type":"","boot_config":{"boot_device":{"type":"","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CENTOS_76","uuid":"04ab0470-1aae-4704-9624-b3cff5cd25b7"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":1,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":2,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":3,"type":""}}}]}},"variable_list":[],"name":"AHV_Centos_K8SW"}],"credential_definition_list":[{"username":"centos","description":"","state":"ACTIVE","message_list":[],"uuid":"7f504213-fb04-443e-8007-1547bccadb97","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"editables":{"username":true,"secret":true},"type":"KEY","name":"CENTOS"}],"type":"USER","app_profile_list":[{"deployment_create_list":[{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"9407928e-f55a-4b6a-858f-5c3af4608130","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"retries":"0","description":"","type":"DAG","uuid":"eb1def2e-04b2-487b-ba45-ad3f32f5212e","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_36fc342b_cfd9_4914_a44e_33ec8e2269d9","uuid":"efe4750d-e313-4a37-a1f4-3c29e060c9a6"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7","uuid":"3c4b40f0-1bfe-46eb-89ef-40a953d2a75d"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"75102045-88f6-4735-9678-0fc6ba6902bc"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"35df7ed1-e2bd-44b8-bff8-9f0879459e3e"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"d99386a3-979b-42ca-b433-faa9fbbfe6f8"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"019b01fb-49ab-486d-b8a3-30517e551140"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"d99386a3-979b-42ca-b433-faa9fbbfe6f8"},"edge_type":"inherent","type":"","uuid":"7a7e321c-d90a-4321-b446-d5fbb8a2cd7a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"019b01fb-49ab-486d-b8a3-30517e551140"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"35df7ed1-e2bd-44b8-bff8-9f0879459e3e"},"edge_type":"inherent","type":"","uuid":"dff6508a-43a3-4fbd-93e6-cfdac932eead","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"d99386a3-979b-42ca-b433-faa9fbbfe6f8"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_36fc342b_cfd9_4914_a44e_33ec8e2269d9","uuid":"efe4750d-e313-4a37-a1f4-3c29e060c9a6"},"edge_type":"inherent","type":"","uuid":"6f0091ba-93ff-4953-b62d-db27c3da814e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"75102045-88f6-4735-9678-0fc6ba6902bc"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"75102045-88f6-4735-9678-0fc6ba6902bc"},"edge_type":"inherent","type":"","uuid":"9a87e91d-fcd6-4dca-a2cb-b4c4bbc4d920","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"35df7ed1-e2bd-44b8-bff8-9f0879459e3e"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7","uuid":"3c4b40f0-1bfe-46eb-89ef-40a953d2a75d"},"edge_type":"inherent","type":"","uuid":"8f009bb0-6fd2-477e-9699-d7f323b9f5fa","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"75102045-88f6-4735-9678-0fc6ba6902bc"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_36fc342b_cfd9_4914_a44e_33ec8e2269d9","uuid":"efe4750d-e313-4a37-a1f4-3c29e060c9a6"},"edge_type":"inherent","type":"","uuid":"2a3c07ac-5408-4f0c-84a3-c77e7546e58b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7","uuid":"3c4b40f0-1bfe-46eb-89ef-40a953d2a75d"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_36fc342b_cfd9_4914_a44e_33ec8e2269d9"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"efe4750d-e313-4a37-a1f4-3c29e060c9a6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_36fc342b_cfd9_4914_a44e_33ec8e2269d9"},{"target_any_local_reference":{"kind":"app_package","name":"CENTOS_76","uuid":"04ab0470-1aae-4704-9624-b3cff5cd25b7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3c4b40f0-1bfe-46eb-89ef-40a953d2a75d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7","uuid":"43e52d70-aea2-445c-995d-86ac65d2cf10"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"75102045-88f6-4735-9678-0fc6ba6902bc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"c89908b2-4da4-4179-9db3-708d8b3d88cd"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"35df7ed1-e2bd-44b8-bff8-9f0879459e3e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"e6312c8e-6e32-49f9-856a-ae52860a786e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d99386a3-979b-42ca-b433-faa9fbbfe6f8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"337c08c1-d983-4234-bb61-802e5a642090"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"019b01fb-49ab-486d-b8a3-30517e551140","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"dfd5bd01-3ebf-47c9-9501-e21346d9e5ef"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0"}],"description":"","message_list":[],"uuid":"6953fd28-d3d7-4329-a65f-9867165d4ee9","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_36fc342b_cfd9_4914_a44e_33ec8e2269d9","uuid":"eb1def2e-04b2-487b-ba45-ad3f32f5212e"},"name":"SYS_GEN__Runbook_Deployment_36fc342b_cfd9_4914_a44e_33ec8e2269d9"}},{"description":"System action for starting an application","message_list":[],"uuid":"1d77e2d7-5e49-42fa-a99c-0d01d037ffaa","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"retries":"0","description":"","type":"DAG","uuid":"ac48c969-c549-4a91-8831-2525b9f33c7e","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"6b667ce7-f6e8-43fe-8432-1f4385cff93f"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"c361758d-c0d5-4289-8bb3-cad4b018a56a"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"6b667ce7-f6e8-43fe-8432-1f4385cff93f"},"edge_type":"inherent","type":"","uuid":"bac9cad2-cf19-4685-8b13-9591a66b16f5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"c361758d-c0d5-4289-8bb3-cad4b018a56a"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_36fc342b_cfd9_4914_a44e_33ec8e2269d9"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6b667ce7-f6e8-43fe-8432-1f4385cff93f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"3abad12e-8d11-4552-b2bf-85bfe2e4007a"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c361758d-c0d5-4289-8bb3-cad4b018a56a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"dfd5bd01-3ebf-47c9-9501-e21346d9e5ef"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0"}],"description":"","message_list":[],"uuid":"8cb0954d-2589-490f-ab41-243a4718b9e8","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_36fc342b_cfd9_4914_a44e_33ec8e2269d9","uuid":"ac48c969-c549-4a91-8831-2525b9f33c7e"},"name":"SYS_GEN__Runbook_Deployment_36fc342b_cfd9_4914_a44e_33ec8e2269d9"}},{"description":"System action for restarting an application","message_list":[],"uuid":"c2cff3d1-8427-4490-9ead-e94d603d950e","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"retries":"0","description":"","type":"DAG","uuid":"ad7ea6a5-0dfb-45b5-8407-ad3760a725bc","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"4843aae7-c920-406f-b254-f47a7406b291"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"8bf259b0-6981-4523-959a-49a5777fd272"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"4843aae7-c920-406f-b254-f47a7406b291"},"edge_type":"inherent","type":"","uuid":"5aaf5e6b-ba32-4477-b892-767c56201fb4","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"8bf259b0-6981-4523-959a-49a5777fd272"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_36fc342b_cfd9_4914_a44e_33ec8e2269d9"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4843aae7-c920-406f-b254-f47a7406b291","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"f8dbff75-b18f-411c-b1b9-684afaae49cb"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8bf259b0-6981-4523-959a-49a5777fd272","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"dae0b6c4-1f7d-4497-9710-8f360bc20831"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0"}],"description":"","message_list":[],"uuid":"c169743c-0cec-4fc2-9479-32ffefb1b55d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_36fc342b_cfd9_4914_a44e_33ec8e2269d9","uuid":"ad7ea6a5-0dfb-45b5-8407-ad3760a725bc"},"name":"SYS_GEN__Runbook_Deployment_36fc342b_cfd9_4914_a44e_33ec8e2269d9"}},{"description":"System action for stopping an application","message_list":[],"uuid":"a49ad69f-636b-4866-ab52-930ec04183e4","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"retries":"0","description":"","type":"DAG","uuid":"6389b86f-ba89-4a04-8f72-e2f20e1e7cb2","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"b449722c-13df-4328-8b03-5c5437c32780"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"b99cd67e-1537-4d4f-9a48-86bd570f97ea"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"b449722c-13df-4328-8b03-5c5437c32780"},"edge_type":"inherent","type":"","uuid":"3affd262-2572-4394-b8e7-d53bd273b7a8","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"b99cd67e-1537-4d4f-9a48-86bd570f97ea"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_36fc342b_cfd9_4914_a44e_33ec8e2269d9"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b449722c-13df-4328-8b03-5c5437c32780","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"4fde4266-9dcc-48ff-9ff0-b3b3ff53d82c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b99cd67e-1537-4d4f-9a48-86bd570f97ea","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"c1a97631-2b1e-4195-a6f6-6cf248c79516"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1"}],"description":"","message_list":[],"uuid":"9a8815a4-ff3b-422b-8964-9f0e35602767","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_36fc342b_cfd9_4914_a44e_33ec8e2269d9","uuid":"6389b86f-ba89-4a04-8f72-e2f20e1e7cb2"},"name":"SYS_GEN__Runbook_Deployment_36fc342b_cfd9_4914_a44e_33ec8e2269d9"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"44a442ca-599c-4455-8e9e-40edc8d35968","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"retries":"0","description":"","type":"DAG","uuid":"2fa53dab-9ef3-4286-a9a4-001e3dbef897","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"acbca15d-4a75-4e0b-9159-61a5488dd29b"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"0640d1ff-cdb6-401d-8b13-a4660d12331c"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"378bcd14-2f08-41b4-a0b8-5d22fc69f1fb"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"971f83aa-bd08-4cc0-8fbe-1d84c90c7411"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_36fc342b_cfd9_4914_a44e_33ec8e2269d9","uuid":"92afe226-2e0d-4796-a7a3-4d55eb997a0e"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"acbca15d-4a75-4e0b-9159-61a5488dd29b"},"edge_type":"inherent","type":"","uuid":"51642b7c-450f-435d-a725-09335bd21584","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"0640d1ff-cdb6-401d-8b13-a4660d12331c"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"0640d1ff-cdb6-401d-8b13-a4660d12331c"},"edge_type":"inherent","type":"","uuid":"06d29224-aee1-4e85-b7bb-81958637b725","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"378bcd14-2f08-41b4-a0b8-5d22fc69f1fb"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"971f83aa-bd08-4cc0-8fbe-1d84c90c7411"},"edge_type":"inherent","type":"","uuid":"218fa65a-640a-4744-b25c-ab9f49547c85","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_36fc342b_cfd9_4914_a44e_33ec8e2269d9","uuid":"92afe226-2e0d-4796-a7a3-4d55eb997a0e"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"378bcd14-2f08-41b4-a0b8-5d22fc69f1fb"},"edge_type":"inherent","type":"","uuid":"7cb3f7e7-b1f5-4142-aad2-17e1a6e809d7","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"971f83aa-bd08-4cc0-8fbe-1d84c90c7411"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_36fc342b_cfd9_4914_a44e_33ec8e2269d9"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"acbca15d-4a75-4e0b-9159-61a5488dd29b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"4fde4266-9dcc-48ff-9ff0-b3b3ff53d82c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0640d1ff-cdb6-401d-8b13-a4660d12331c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"26ce2713-05fa-4b65-ac37-579626d25b62"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"378bcd14-2f08-41b4-a0b8-5d22fc69f1fb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"a0c65fcd-72cf-40f4-b38c-e7de5bce4776"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"971f83aa-bd08-4cc0-8fbe-1d84c90c7411","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"13fe4599-64aa-4971-af0f-5cfc3695bd46"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"92afe226-2e0d-4796-a7a3-4d55eb997a0e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_36fc342b_cfd9_4914_a44e_33ec8e2269d9"}],"description":"","message_list":[],"uuid":"bdcafb54-d29b-4114-8b8a-ff32e0d54e3f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_36fc342b_cfd9_4914_a44e_33ec8e2269d9","uuid":"2fa53dab-9ef3-4286-a9a4-001e3dbef897"},"name":"SYS_GEN__Runbook_Deployment_36fc342b_cfd9_4914_a44e_33ec8e2269d9"}},{"description":"System action for scaleout","message_list":[],"uuid":"7a4953ec-e324-483d-8cc4-f7c0f7d0bd5f","name":"action_scaleout","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"retries":"0","description":"","type":"DAG","uuid":"7c3f3163-eeca-41f3-bc64-f2aa88216663","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scaleout_36fc342b_cfd9_4914_a44e_33ec8e2269d9","uuid":"1eb96da0-e280-4dd8-bbea-7160f44494d2"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_36fc342b_cfd9_4914_a44e_33ec8e2269d9"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"retries":"0","description":"","type":"SCALING","uuid":"1eb96da0-e280-4dd8-bbea-7160f44494d2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scaleout_36fc342b_cfd9_4914_a44e_33ec8e2269d9"}],"description":"","message_list":[],"uuid":"b108d55e-a5ff-4ad3-bb3a-cbbf5897606f","state":"ACTIVE","variable_list":[{"val_type":"STRING","description":"","message_list":[],"uuid":"a3e4b697-8996-4276-a55e-73c3126bc05b","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"type":"LOCAL","name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_36fc342b_cfd9_4914_a44e_33ec8e2269d9","uuid":"7c3f3163-eeca-41f3-bc64-f2aa88216663"},"name":"SYS_GEN__Runbook_Deployment_36fc342b_cfd9_4914_a44e_33ec8e2269d9"}},{"description":"System action for scalein","message_list":[],"uuid":"5cada829-9211-4ff6-a01c-0b71cc6041a8","name":"action_scalein","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"retries":"0","description":"","type":"DAG","uuid":"17d3b5ea-3e75-41b2-a316-42b070118a03","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scalein_36fc342b_cfd9_4914_a44e_33ec8e2269d9","uuid":"c32b7043-aafb-42d0-a02a-8bf9989b7745"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_36fc342b_cfd9_4914_a44e_33ec8e2269d9"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"retries":"0","description":"","type":"SCALING","uuid":"c32b7043-aafb-42d0-a02a-8bf9989b7745","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scalein_36fc342b_cfd9_4914_a44e_33ec8e2269d9"}],"description":"","message_list":[],"uuid":"675d4891-1efd-44e9-b5eb-5aa859ed9346","state":"ACTIVE","variable_list":[{"val_type":"STRING","description":"","message_list":[],"uuid":"6235ab1a-873d-456f-a4cc-ba022a0d8f30","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"type":"LOCAL","name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_36fc342b_cfd9_4914_a44e_33ec8e2269d9","uuid":"17d3b5ea-3e75-41b2-a316-42b070118a03"},"name":"SYS_GEN__Runbook_Deployment_36fc342b_cfd9_4914_a44e_33ec8e2269d9"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"3c122c13-9b90-4989-a8cb-2caf130b6c51","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"retries":"0","description":"","type":"DAG","uuid":"12fc7ac7-8ac6-4e83-b966-92d2d937d35a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"e480ae38-6750-4f8b-ae18-ab0418b623e7"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"e64ddae0-4fef-428b-a1ba-df118075a79a"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"009a2835-8e9b-48d2-a832-c67d2dc7d53f"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_36fc342b_cfd9_4914_a44e_33ec8e2269d9","uuid":"2c1c2899-1ed2-4158-85ce-d34c4f339229"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"e480ae38-6750-4f8b-ae18-ab0418b623e7"},"edge_type":"inherent","type":"","uuid":"571232a2-e096-4032-be8e-cd8721ae7111","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"e64ddae0-4fef-428b-a1ba-df118075a79a"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"009a2835-8e9b-48d2-a832-c67d2dc7d53f"},"edge_type":"inherent","type":"","uuid":"c52bc97a-6fe1-4639-a4d4-7228c0f1adbf","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_36fc342b_cfd9_4914_a44e_33ec8e2269d9","uuid":"2c1c2899-1ed2-4158-85ce-d34c4f339229"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"e64ddae0-4fef-428b-a1ba-df118075a79a"},"edge_type":"inherent","type":"","uuid":"bdbeaf24-b30f-467d-a3ca-509c412cbe4c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"009a2835-8e9b-48d2-a832-c67d2dc7d53f"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_36fc342b_cfd9_4914_a44e_33ec8e2269d9"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e480ae38-6750-4f8b-ae18-ab0418b623e7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"83064c0f-b87b-4e8f-b4ae-0d9be93e1f13"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"e64ddae0-4fef-428b-a1ba-df118075a79a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"009a2835-8e9b-48d2-a832-c67d2dc7d53f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"7a67c432-dd10-40ce-a045-3008b6c54ed2"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"2c1c2899-1ed2-4158-85ce-d34c4f339229","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_36fc342b_cfd9_4914_a44e_33ec8e2269d9"}],"description":"","message_list":[],"uuid":"2ac41947-8818-4f71-aabd-158311d0cb44","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_36fc342b_cfd9_4914_a44e_33ec8e2269d9","uuid":"12fc7ac7-8ac6-4e83-b966-92d2d937d35a"},"name":"SYS_GEN__Runbook_Deployment_36fc342b_cfd9_4914_a44e_33ec8e2269d9"}}],"message_list":[],"published_service_local_reference_list":[],"uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9","min_replicas":"3","state":"ACTIVE","max_replicas":"3","depends_on_list":[],"editables":{"min_replicas":true,"max_replicas":true},"package_local_reference_list":[{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"}],"substrate_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"type":"GREENFIELD","options":{},"variable_list":[],"name":"2cbb2f6a_deployment"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"b36e5227-2c3d-4e77-8cb3-c77efa41dcac","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"retries":"0","description":"","type":"DAG","uuid":"ebd1d8dd-7923-43d9-860f-294175e791cc","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_65413f34_f6c9_4167_a384_430b589f40c5","uuid":"4f3df714-75c6-4d20-83f3-92529b0c4a85"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7","uuid":"f5a149cb-6443-4997-9c8b-069f2d85580b"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"d884ad37-3dd8-4138-9983-38cd776d8eba"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"d2a45f93-8c2e-45be-af4b-30e09e169cb0"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"ac125a4f-a88b-40d4-b6c5-47f83c605252"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"2b65a4bd-270a-4a2f-8b1e-bcc4417b09d2"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"ac125a4f-a88b-40d4-b6c5-47f83c605252"},"edge_type":"inherent","type":"","uuid":"a7514323-a1cb-4ff3-943d-f998d3ff3249","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"2b65a4bd-270a-4a2f-8b1e-bcc4417b09d2"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"d2a45f93-8c2e-45be-af4b-30e09e169cb0"},"edge_type":"inherent","type":"","uuid":"abe854a0-06e3-4f8e-a7ed-b3df54ed073e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"ac125a4f-a88b-40d4-b6c5-47f83c605252"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"d884ad37-3dd8-4138-9983-38cd776d8eba"},"edge_type":"inherent","type":"","uuid":"d618f9b5-b5f4-45fe-a117-84e6b38870e2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"d2a45f93-8c2e-45be-af4b-30e09e169cb0"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_65413f34_f6c9_4167_a384_430b589f40c5","uuid":"4f3df714-75c6-4d20-83f3-92529b0c4a85"},"edge_type":"inherent","type":"","uuid":"54eb1e2f-1843-403b-8583-69d8b5a7abd4","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"d884ad37-3dd8-4138-9983-38cd776d8eba"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7","uuid":"f5a149cb-6443-4997-9c8b-069f2d85580b"},"edge_type":"inherent","type":"","uuid":"762c90b3-244a-4037-ad1f-6be91955658a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"d884ad37-3dd8-4138-9983-38cd776d8eba"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_65413f34_f6c9_4167_a384_430b589f40c5","uuid":"4f3df714-75c6-4d20-83f3-92529b0c4a85"},"edge_type":"inherent","type":"","uuid":"c1fd6857-b968-49e4-87c8-fe85e2e47601","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7","uuid":"f5a149cb-6443-4997-9c8b-069f2d85580b"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_65413f34_f6c9_4167_a384_430b589f40c5"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"4f3df714-75c6-4d20-83f3-92529b0c4a85","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_65413f34_f6c9_4167_a384_430b589f40c5"},{"target_any_local_reference":{"kind":"app_package","name":"CENTOS_76","uuid":"04ab0470-1aae-4704-9624-b3cff5cd25b7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f5a149cb-6443-4997-9c8b-069f2d85580b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7","uuid":"43e52d70-aea2-445c-995d-86ac65d2cf10"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d884ad37-3dd8-4138-9983-38cd776d8eba","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"0a7cb0fa-8ce2-4ca1-ba00-69e0e254cf89"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d2a45f93-8c2e-45be-af4b-30e09e169cb0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"2972cfc3-804b-49db-ace6-db5748a9201d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_99092116_88f3_49fd_81d3_15220edf6824"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ac125a4f-a88b-40d4-b6c5-47f83c605252","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"9bd65d16-65b7-45ae-99ab-298f6f137505"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2b65a4bd-270a-4a2f-8b1e-bcc4417b09d2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"d2212910-a48e-4c21-96d4-009c61505cad"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517"}],"description":"","message_list":[],"uuid":"0b720707-44cf-4c39-8789-5f76bd87d323","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_65413f34_f6c9_4167_a384_430b589f40c5","uuid":"ebd1d8dd-7923-43d9-860f-294175e791cc"},"name":"SYS_GEN__Runbook_Deployment_65413f34_f6c9_4167_a384_430b589f40c5"}},{"description":"System action for starting an application","message_list":[],"uuid":"3f5c1b0c-d200-486d-8695-f07ae4c99251","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"retries":"0","description":"","type":"DAG","uuid":"18edb881-c1b3-48d8-ae18-bedbeabff20a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"eac8030e-0274-4967-8f23-77a555d1de7a"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"8f6f95fb-2b4f-450b-a280-098b65f98144"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"eac8030e-0274-4967-8f23-77a555d1de7a"},"edge_type":"inherent","type":"","uuid":"24800298-7238-4c4e-9cd2-eb83098d11a4","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"8f6f95fb-2b4f-450b-a280-098b65f98144"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_65413f34_f6c9_4167_a384_430b589f40c5"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"eac8030e-0274-4967-8f23-77a555d1de7a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"487e3b1f-2401-4384-9b10-902b111f7b54"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8f6f95fb-2b4f-450b-a280-098b65f98144","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"d2212910-a48e-4c21-96d4-009c61505cad"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517"}],"description":"","message_list":[],"uuid":"8a9b299e-040e-4c7c-b761-6b58e2ede819","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_65413f34_f6c9_4167_a384_430b589f40c5","uuid":"18edb881-c1b3-48d8-ae18-bedbeabff20a"},"name":"SYS_GEN__Runbook_Deployment_65413f34_f6c9_4167_a384_430b589f40c5"}},{"description":"System action for restarting an application","message_list":[],"uuid":"9827ba06-8ec4-43b6-b6d1-d1bb18e8295d","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"retries":"0","description":"","type":"DAG","uuid":"557ed6b3-4997-4247-b71c-953ae4eaca08","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"1647b954-adf6-4349-aecb-2ad255e52daf"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"a5eb09e5-502a-408a-9461-d9498d227cbf"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"1647b954-adf6-4349-aecb-2ad255e52daf"},"edge_type":"inherent","type":"","uuid":"fbc5481d-0761-47fd-948f-d4c8fbfe05c4","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"a5eb09e5-502a-408a-9461-d9498d227cbf"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_65413f34_f6c9_4167_a384_430b589f40c5"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1647b954-adf6-4349-aecb-2ad255e52daf","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"cb870644-7c11-486e-881d-ad74d77112cf"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a5eb09e5-502a-408a-9461-d9498d227cbf","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"cd09b8ce-f3e9-43e8-a843-6623eb53b961"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517"}],"description":"","message_list":[],"uuid":"34c36bde-f74b-4239-903d-617b3e8337fc","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_65413f34_f6c9_4167_a384_430b589f40c5","uuid":"557ed6b3-4997-4247-b71c-953ae4eaca08"},"name":"SYS_GEN__Runbook_Deployment_65413f34_f6c9_4167_a384_430b589f40c5"}},{"description":"System action for stopping an application","message_list":[],"uuid":"d4da8f13-5f05-4a2d-9b6f-8492f696c386","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"retries":"0","description":"","type":"DAG","uuid":"2e210c0d-a416-497c-8e62-3e7c55f55b88","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"3bb9228a-2c50-4a81-a1b5-04d27cdc730b"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"9c19b65f-5319-46bc-97fc-d8666be681f7"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"3bb9228a-2c50-4a81-a1b5-04d27cdc730b"},"edge_type":"inherent","type":"","uuid":"bcf7c0b8-f0ad-4928-a92a-d3019a2470f4","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"9c19b65f-5319-46bc-97fc-d8666be681f7"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_65413f34_f6c9_4167_a384_430b589f40c5"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3bb9228a-2c50-4a81-a1b5-04d27cdc730b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"b769d338-4161-4626-972a-7c9bcf413eac"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"9c19b65f-5319-46bc-97fc-d8666be681f7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"089a6dff-8e7f-44d0-92ca-8188c6bac3f6"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"}],"description":"","message_list":[],"uuid":"725e4395-506b-480c-979a-835a291dae23","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_65413f34_f6c9_4167_a384_430b589f40c5","uuid":"2e210c0d-a416-497c-8e62-3e7c55f55b88"},"name":"SYS_GEN__Runbook_Deployment_65413f34_f6c9_4167_a384_430b589f40c5"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"e31fe188-1500-4a8b-b16e-5c0ebbff4a26","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"retries":"0","description":"","type":"DAG","uuid":"1ceda537-ab78-4b99-9ee9-138d1076212d","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"c496157c-3143-439f-b36a-73c41a401e7e"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"de7b198b-33ee-4537-950d-6bdf0ead3cdd"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"157f973e-9187-484b-9f33-a9f510d8c502"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"d0812ff7-19c1-4094-ba84-e5989419e49f"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_65413f34_f6c9_4167_a384_430b589f40c5","uuid":"a4ba4fe4-cbe5-4f7d-be34-b85a8ca101e0"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"c496157c-3143-439f-b36a-73c41a401e7e"},"edge_type":"inherent","type":"","uuid":"fa5436d5-6b6c-4649-97d9-0c795274d5ba","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"de7b198b-33ee-4537-950d-6bdf0ead3cdd"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"de7b198b-33ee-4537-950d-6bdf0ead3cdd"},"edge_type":"inherent","type":"","uuid":"08059dd1-8fa2-4ce8-802e-8574215be51e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"157f973e-9187-484b-9f33-a9f510d8c502"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"d0812ff7-19c1-4094-ba84-e5989419e49f"},"edge_type":"inherent","type":"","uuid":"08a717e4-62d6-4358-a544-c78c986bdf7b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_65413f34_f6c9_4167_a384_430b589f40c5","uuid":"a4ba4fe4-cbe5-4f7d-be34-b85a8ca101e0"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"157f973e-9187-484b-9f33-a9f510d8c502"},"edge_type":"inherent","type":"","uuid":"14da438a-88e0-42c4-ba91-140ee10b23e7","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"d0812ff7-19c1-4094-ba84-e5989419e49f"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_65413f34_f6c9_4167_a384_430b589f40c5"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c496157c-3143-439f-b36a-73c41a401e7e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"b769d338-4161-4626-972a-7c9bcf413eac"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"de7b198b-33ee-4537-950d-6bdf0ead3cdd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"09962a62-e984-4f41-bd3f-98968b698ac0"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"157f973e-9187-484b-9f33-a9f510d8c502","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"3b9dfc22-8db7-42ff-864f-f70d6a4dda3d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_99092116_88f3_49fd_81d3_15220edf6824"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d0812ff7-19c1-4094-ba84-e5989419e49f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"a6b80b68-4571-4ca2-aa57-bc80bc9d9004"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"a4ba4fe4-cbe5-4f7d-be34-b85a8ca101e0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_65413f34_f6c9_4167_a384_430b589f40c5"}],"description":"","message_list":[],"uuid":"531a649f-082f-476e-8713-57918bc7cb5c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_65413f34_f6c9_4167_a384_430b589f40c5","uuid":"1ceda537-ab78-4b99-9ee9-138d1076212d"},"name":"SYS_GEN__Runbook_Deployment_65413f34_f6c9_4167_a384_430b589f40c5"}},{"description":"System action for scaleout","message_list":[],"uuid":"5257b188-a03b-473f-8064-f4f007ae0078","name":"action_scaleout","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"retries":"0","description":"","type":"DAG","uuid":"a0549abb-ccfb-4727-acab-e1dbfa2b0f72","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scaleout_65413f34_f6c9_4167_a384_430b589f40c5","uuid":"84812195-8c40-4261-a7ca-bc9bdf6e0486"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_65413f34_f6c9_4167_a384_430b589f40c5"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"retries":"0","description":"","type":"SCALING","uuid":"84812195-8c40-4261-a7ca-bc9bdf6e0486","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scaleout_65413f34_f6c9_4167_a384_430b589f40c5"}],"description":"","message_list":[],"uuid":"67b72211-19b3-4124-9ec2-7a2f98d203d5","state":"ACTIVE","variable_list":[{"val_type":"STRING","description":"","message_list":[],"uuid":"1fcefb36-df7a-4a56-a785-04936a2013d5","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"type":"LOCAL","name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_65413f34_f6c9_4167_a384_430b589f40c5","uuid":"a0549abb-ccfb-4727-acab-e1dbfa2b0f72"},"name":"SYS_GEN__Runbook_Deployment_65413f34_f6c9_4167_a384_430b589f40c5"}},{"description":"System action for scalein","message_list":[],"uuid":"fbcd8bcd-ff2c-4b6c-b303-6ad882240ce9","name":"action_scalein","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"retries":"0","description":"","type":"DAG","uuid":"f74357bd-21e7-43aa-8b80-1998c0b26892","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scalein_65413f34_f6c9_4167_a384_430b589f40c5","uuid":"d6ea539a-6e52-4803-83a0-6fc398eeed8b"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_65413f34_f6c9_4167_a384_430b589f40c5"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"retries":"0","description":"","type":"SCALING","uuid":"d6ea539a-6e52-4803-83a0-6fc398eeed8b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scalein_65413f34_f6c9_4167_a384_430b589f40c5"}],"description":"","message_list":[],"uuid":"1b51a250-ec8e-429e-bb3d-d15c39ff6d2e","state":"ACTIVE","variable_list":[{"val_type":"STRING","description":"","message_list":[],"uuid":"5774f157-ce81-4a57-bbea-393791128ca9","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"type":"LOCAL","name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_65413f34_f6c9_4167_a384_430b589f40c5","uuid":"f74357bd-21e7-43aa-8b80-1998c0b26892"},"name":"SYS_GEN__Runbook_Deployment_65413f34_f6c9_4167_a384_430b589f40c5"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"05108a44-5a9a-4757-8301-91b738cdcaf2","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"retries":"0","description":"","type":"DAG","uuid":"3de5e683-5ccf-4c48-913c-16988b880fae","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"2c496ca6-0f89-4517-b625-52ea613e4317"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_99092116_88f3_49fd_81d3_15220edf6824","uuid":"8d15ad3c-aeab-4c24-8624-093e43acb316"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"e23c7fef-9afc-4270-8315-0730d520b187"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_65413f34_f6c9_4167_a384_430b589f40c5","uuid":"67966c01-7108-4bbd-ba20-e5507d082cc4"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"2c496ca6-0f89-4517-b625-52ea613e4317"},"edge_type":"inherent","type":"","uuid":"e9d6101f-b268-487d-a491-69458b259c65","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_99092116_88f3_49fd_81d3_15220edf6824","uuid":"8d15ad3c-aeab-4c24-8624-093e43acb316"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_99092116_88f3_49fd_81d3_15220edf6824","uuid":"8d15ad3c-aeab-4c24-8624-093e43acb316"},"edge_type":"inherent","type":"","uuid":"9a5b44bb-70c2-4eb2-935a-bd4104b05765","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"e23c7fef-9afc-4270-8315-0730d520b187"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"e23c7fef-9afc-4270-8315-0730d520b187"},"edge_type":"inherent","type":"","uuid":"9eb12706-95ef-478d-ada5-5407f416b3bc","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_65413f34_f6c9_4167_a384_430b589f40c5","uuid":"67966c01-7108-4bbd-ba20-e5507d082cc4"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_65413f34_f6c9_4167_a384_430b589f40c5"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2c496ca6-0f89-4517-b625-52ea613e4317","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"b28fd8da-c23e-45fb-86d4-4f1f6222b794"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"8d15ad3c-aeab-4c24-8624-093e43acb316","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_99092116_88f3_49fd_81d3_15220edf6824"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e23c7fef-9afc-4270-8315-0730d520b187","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"9909f3ce-8c36-4ec7-a2ed-caa33bd71bac"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"67966c01-7108-4bbd-ba20-e5507d082cc4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_65413f34_f6c9_4167_a384_430b589f40c5"}],"description":"","message_list":[],"uuid":"02b62780-0920-4e3c-bf5f-9029dca44ef7","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_65413f34_f6c9_4167_a384_430b589f40c5","uuid":"3de5e683-5ccf-4c48-913c-16988b880fae"},"name":"SYS_GEN__Runbook_Deployment_65413f34_f6c9_4167_a384_430b589f40c5"}}],"message_list":[],"published_service_local_reference_list":[],"uuid":"65413f34-f6c9-4167-a384-430b589f40c5","min_replicas":"3","state":"ACTIVE","max_replicas":"9","depends_on_list":[],"editables":{"min_replicas":true,"max_replicas":true},"package_local_reference_list":[{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"}],"substrate_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"type":"GREENFIELD","options":{},"variable_list":[],"name":"39cf7283_deployment"}],"description":"","action_list":[{"description":"","message_list":[],"uuid":"88582175-dd84-40bb-a241-92ec4b05b918","name":"Upgrade","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"65901a08-e868-4ef9-98dd-7216d3934e01","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Version Master","uuid":"8f050b84-fb14-436a-81dc-ec6d20e23e50"},{"kind":"app_task","name":"Upgrade Master","uuid":"0aa32e3a-bb3c-4822-b9d2-cb9060412401"},{"kind":"app_task","name":"Set Version Minion","uuid":"5b1c753a-3bb5-4438-879f-bafd3ad37f22"},{"kind":"app_task","name":"Upgrade Minion","uuid":"21c45b67-ecc7-4777-ba8e-53df1495c11d"},{"kind":"app_task","name":"RestartServices","uuid":"7c68be97-fbeb-40ce-b035-3c01582e2bef"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"8f050b84-fb14-436a-81dc-ec6d20e23e50"},"edge_type":"user_defined","type":"","uuid":"bd2cd381-4457-44f2-a421-3b7cd5f1b89b","to_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"0aa32e3a-bb3c-4822-b9d2-cb9060412401"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"0aa32e3a-bb3c-4822-b9d2-cb9060412401"},"edge_type":"user_defined","type":"","uuid":"906ab28f-39ca-4429-8578-6a1baf3cc72f","to_task_reference":{"kind":"app_task","name":"RestartServices","uuid":"7c68be97-fbeb-40ce-b035-3c01582e2bef"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"8f050b84-fb14-436a-81dc-ec6d20e23e50"},"edge_type":"user_defined","type":"","uuid":"51a27b67-c217-42bc-9e59-74d832ed4d12","to_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"5b1c753a-3bb5-4438-879f-bafd3ad37f22"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"5b1c753a-3bb5-4438-879f-bafd3ad37f22"},"edge_type":"user_defined","type":"","uuid":"f449a41e-d86a-4aaa-bb53-b8549ee9439c","to_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"21c45b67-ecc7-4777-ba8e-53df1495c11d"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"21c45b67-ecc7-4777-ba8e-53df1495c11d"},"edge_type":"user_defined","type":"","uuid":"01b55b23-cdb9-4f2e-9e32-70e4d79cd577","to_task_reference":{"kind":"app_task","name":"RestartServices","uuid":"7c68be97-fbeb-40ce-b035-3c01582e2bef"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6ee65d8a_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"8f050b84-fb14-436a-81dc-ec6d20e23e50","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Version Master"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"EXEC","uuid":"0aa32e3a-bb3c-4822-b9d2-cb9060412401","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CONFIG_PATH=\"\/etc\/kubernetes\/config\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nCONTROLLER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --enable-admission-plugins=NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --config=${KUBE_CONFIG_PATH}\/kube-proxy-config.yaml\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/lib\/modules\n      name: lib-modules-host\n      readOnly: true\n    - mountPath: ${KUBE_CONFIG_PATH}\n      name: kube-config-path\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/lib\/modules\n    name: lib-modules-host\n  - hostPath:\n      path: ${KUBE_CONFIG_PATH}\n    name: kube-config-path\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --bind-address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=${KUBE_CLUSTER_NAME}\n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n   \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --config=${KUBE_CONFIG_PATH}\/kube-scheduler.yaml\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: ${KUBE_CONFIG_PATH}\n      name: kube-config-path\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: ${KUBE_CONFIG_PATH}\n    name: kube-config-path\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Upgrade Master"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"5b1c753a-3bb5-4438-879f-bafd3ad37f22","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Version Minion"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"EXEC","uuid":"21c45b67-ecc7-4777-ba8e-53df1495c11d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CONFIG_PATH=\"\/etc\/kubernetes\/config\"\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --config=${KUBE_CONFIG_PATH}\/kube-proxy-config.yaml\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/lib\/modules\n      name: lib-modules-host\n      readOnly: true\n    - mountPath: ${KUBE_CONFIG_PATH}\n      name: kube-config-path\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/lib\/modules\n    name: lib-modules-host\n  - hostPath:\n      path: ${KUBE_CONFIG_PATH}\n    name: kube-config-path\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Upgrade Minion"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"EXEC","uuid":"7c68be97-fbeb-40ce-b035-3c01582e2bef","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_IPS=\"@@{AHV_Centos_K8SW.address}@@\"\nJSONPATH='{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}'\nKUBE_VERSION_NEW=\"@@{KUBE_VERSION_NEW}@@\"\nMASTER_API_HTTPS=6443\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION_NEW}\/bin\/linux\/amd64\/kubectl\nchmod +x kubectl\nsudo mv kubectl \/usr\/local\/bin\/kubectl\n\ncount=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n  echo \"Trying to reach master server https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} : sleep for 5 secs\"\n  sleep 10\n  if [[ $count -eq 10 ]]; then\n    echo \"Unable to reach master server: https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\"\n    exit 1\n  fi\n  count=$((count+1))\ndone\n\ncount=0\nfor ip in $(echo \"${WORKER_IPS}\" | tr \",\" \"\\n\"); do\n  #kubectl drain \"worker${count}\" --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no $ip \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 10\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=worker${count} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon worker${count}\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n  echo \"Upgrade failed on worker nodes\"\n    exit 1\nfi\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  #kubectl drain \"master${count}\" --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no $ip \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 10\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=master${count} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon master${count}\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n  echo \"Upgrade failed on nodes: $(kubectl get nodes -o jsonpath='$JSONPATH' | grep 'Ready=Unknown')\"\n    exit 1\nfi"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"RestartServices"}],"description":"","message_list":[],"uuid":"29ecd07e-c7e9-4712-a807-6975aa4cf819","state":"ACTIVE","variable_list":[{"val_type":"STRING","description":"","message_list":[],"uuid":"61d31174-d6f5-4f2e-91c6-6b191b9404b7","value":"v1.14.2","label":"","state":"NOT_VALIDATED","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_VERSION_NEW"}],"main_task_local_reference":{"kind":"app_task","name":"6ee65d8a_dag","uuid":"65901a08-e868-4ef9-98dd-7216d3934e01"},"name":"68a7ffd0_runbook"}},{"description":"","message_list":[],"uuid":"b2ba9d00-acf8-430e-b1b8-aff8229992d8","name":"ScaleOut","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"8dc15feb-3df5-48dd-a417-f7535f2bc6c2","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Out","uuid":"df853e37-f9a6-430e-9ae9-af6066bb894e"},{"kind":"app_task","name":"Set Hosts file","uuid":"9be84ec9-e0c5-4ea7-b533-bd499888327c"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Scale Out","uuid":"df853e37-f9a6-430e-9ae9-af6066bb894e"},"edge_type":"user_defined","type":"","uuid":"b31d44df-12e2-45ca-8e1d-1d30cad63950","to_task_reference":{"kind":"app_task","name":"Set Hosts file","uuid":"9be84ec9-e0c5-4ea7-b533-bd499888327c"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"03b33121_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"retries":"0","description":"","type":"SCALING","uuid":"df853e37-f9a6-430e-9ae9-af6066bb894e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Scale Out"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"EXEC","uuid":"9be84ec9-e0c5-4ea7-b533-bd499888327c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMINION_IPS=\"@@{AHV_Centos_K8SW.address}@@\"\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  if ! (( $(grep -c \"${ip} worker${count}\" \/etc\/hosts) )) ; then\n  \techo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  fi\n  count=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Hosts file"}],"description":"","message_list":[],"uuid":"abdef5b4-fff1-41a9-b274-b991c91ed96c","state":"ACTIVE","variable_list":[{"val_type":"STRING","description":"","message_list":[],"uuid":"8c96dc28-0375-42cb-b241-f816aade96a9","value":"1","label":"","state":"NOT_VALIDATED","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"03b33121_dag","uuid":"8dc15feb-3df5-48dd-a417-f7535f2bc6c2"},"name":"00cf5417_runbook"}},{"description":"","message_list":[],"uuid":"3644087e-e621-4012-854a-62ab3f964476","name":"ScaleIn","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"39111cb6-b10e-4c99-b275-72e3ae67c61b","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale In","uuid":"89c4a32a-5488-49a7-9a7f-b478d9118b11"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"e72a9133_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"retries":"0","description":"","type":"SCALING","uuid":"89c4a32a-5488-49a7-9a7f-b478d9118b11","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Scale In"}],"description":"","message_list":[],"uuid":"b5651495-f3c1-47b9-b4e7-67fc6338b2ac","state":"ACTIVE","variable_list":[{"val_type":"STRING","description":"","message_list":[],"uuid":"b4793aac-12ae-4e23-a8cd-b49f762c6cec","value":"1","label":"","state":"NOT_VALIDATED","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"e72a9133_dag","uuid":"39111cb6-b10e-4c99-b275-72e3ae67c61b"},"name":"96546f6c_runbook"}},{"description":"System action for creating an application","message_list":[],"uuid":"de0321ae-c26a-45ed-baa6-bda50cb266f6","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"5379eb2d-47d6-4a38-9aa8-7cd3d16130b5"},"retries":"0","description":"","type":"DAG","uuid":"71849ae5-83cd-4bed-95e2-901ac1cfbc38","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_36fc342b_cfd9_4914_a44e_33ec8e2269d9","uuid":"9f405815-ca35-43f0-b6dc-b037c5d3fffa"},{"kind":"app_task","name":"SYS_GEN__DE_Provision_65413f34_f6c9_4167_a384_430b589f40c5","uuid":"bc3e1239-4ad7-49bb-ae67-a84b8fee593f"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7_1","uuid":"b16397d9-0a37-45ce-a0f6-a84ecf4d18e2"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7","uuid":"7433698b-93cf-4cc5-b9e2-03f8746f7244"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"9bf742c8-ea09-423e-ad4a-5672a59e2796"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"5a2e9424-9463-48de-9753-66426ccaaaec"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"e84c52c2-0945-4902-b730-df019d15d1ee"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"3830ae02-dc04-43ee-a7cc-354183636a03"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"cad0983d-08aa-4813-92b8-ecd0948c5a3e"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"431fb954-edc8-43eb-8065-c7edcabd7864"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"617b8bcd-6a91-4239-9f55-797d002e4ca5"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"d1b24a4c-2ab7-4d97-8402-7044fbbc1496"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"cad0983d-08aa-4813-92b8-ecd0948c5a3e"},"edge_type":"inherent","type":"","uuid":"c704c3c4-298e-415f-94d5-9c60e6831b5f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"617b8bcd-6a91-4239-9f55-797d002e4ca5"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"e84c52c2-0945-4902-b730-df019d15d1ee"},"edge_type":"inherent","type":"","uuid":"e506199a-3f61-4593-8eed-5c32f341f840","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"cad0983d-08aa-4813-92b8-ecd0948c5a3e"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_36fc342b_cfd9_4914_a44e_33ec8e2269d9","uuid":"9f405815-ca35-43f0-b6dc-b037c5d3fffa"},"edge_type":"inherent","type":"","uuid":"ce63908e-a322-46e9-a931-3d8f208f0bbf","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"9bf742c8-ea09-423e-ad4a-5672a59e2796"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"9bf742c8-ea09-423e-ad4a-5672a59e2796"},"edge_type":"inherent","type":"","uuid":"204bd47e-787f-4655-a149-19d01d0067a8","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"e84c52c2-0945-4902-b730-df019d15d1ee"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7","uuid":"7433698b-93cf-4cc5-b9e2-03f8746f7244"},"edge_type":"inherent","type":"","uuid":"42e463c2-63ce-4a98-895c-54380c7efac9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"9bf742c8-ea09-423e-ad4a-5672a59e2796"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_36fc342b_cfd9_4914_a44e_33ec8e2269d9","uuid":"9f405815-ca35-43f0-b6dc-b037c5d3fffa"},"edge_type":"inherent","type":"","uuid":"083b9626-024f-491b-8b80-e40ffbf8b0f1","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7","uuid":"7433698b-93cf-4cc5-b9e2-03f8746f7244"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"431fb954-edc8-43eb-8065-c7edcabd7864"},"edge_type":"inherent","type":"","uuid":"5858209c-dad7-434c-bee2-58c034693de9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"d1b24a4c-2ab7-4d97-8402-7044fbbc1496"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"3830ae02-dc04-43ee-a7cc-354183636a03"},"edge_type":"inherent","type":"","uuid":"68c82ec2-a8cc-4c59-b0c3-944ebae9d69c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"431fb954-edc8-43eb-8065-c7edcabd7864"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"5a2e9424-9463-48de-9753-66426ccaaaec"},"edge_type":"inherent","type":"","uuid":"91df45d8-727d-448e-add0-0edaf41419f9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"3830ae02-dc04-43ee-a7cc-354183636a03"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_65413f34_f6c9_4167_a384_430b589f40c5","uuid":"bc3e1239-4ad7-49bb-ae67-a84b8fee593f"},"edge_type":"inherent","type":"","uuid":"5b33c3a8-e8e4-467e-95a0-98b72a31bd15","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"5a2e9424-9463-48de-9753-66426ccaaaec"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7_1","uuid":"b16397d9-0a37-45ce-a0f6-a84ecf4d18e2"},"edge_type":"inherent","type":"","uuid":"5cb81adb-2191-47c3-b4bf-1cbe7bd173c1","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"5a2e9424-9463-48de-9753-66426ccaaaec"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_65413f34_f6c9_4167_a384_430b589f40c5","uuid":"bc3e1239-4ad7-49bb-ae67-a84b8fee593f"},"edge_type":"inherent","type":"","uuid":"e5e30457-6555-48a7-b8de-13822b54dbdd","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7_1","uuid":"b16397d9-0a37-45ce-a0f6-a84ecf4d18e2"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"5a2e9424-9463-48de-9753-66426ccaaaec"},"edge_type":"dependency","type":"","uuid":"b9aa3315-19a1-4c95-b7d9-7d776db73715","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"e84c52c2-0945-4902-b730-df019d15d1ee"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"9bf742c8-ea09-423e-ad4a-5672a59e2796"},"edge_type":"dependency","type":"","uuid":"6674110b-e85d-447c-afad-a0ece5c3b4c1","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"3830ae02-dc04-43ee-a7cc-354183636a03"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_5379eb2d_47d6_4a38_9aa8_7cd3d16130b5"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"9f405815-ca35-43f0-b6dc-b037c5d3fffa","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_36fc342b_cfd9_4914_a44e_33ec8e2269d9"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"bc3e1239-4ad7-49bb-ae67-a84b8fee593f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_65413f34_f6c9_4167_a384_430b589f40c5"},{"target_any_local_reference":{"kind":"app_package","name":"CENTOS_76","uuid":"04ab0470-1aae-4704-9624-b3cff5cd25b7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b16397d9-0a37-45ce-a0f6-a84ecf4d18e2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7","uuid":"43e52d70-aea2-445c-995d-86ac65d2cf10"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7_1"},{"target_any_local_reference":{"kind":"app_package","name":"CENTOS_76","uuid":"04ab0470-1aae-4704-9624-b3cff5cd25b7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"7433698b-93cf-4cc5-b9e2-03f8746f7244","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7","uuid":"43e52d70-aea2-445c-995d-86ac65d2cf10"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"9bf742c8-ea09-423e-ad4a-5672a59e2796","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"c89908b2-4da4-4179-9db3-708d8b3d88cd"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5a2e9424-9463-48de-9753-66426ccaaaec","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"0a7cb0fa-8ce2-4ca1-ba00-69e0e254cf89"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e84c52c2-0945-4902-b730-df019d15d1ee","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"e6312c8e-6e32-49f9-856a-ae52860a786e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3830ae02-dc04-43ee-a7cc-354183636a03","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"2972cfc3-804b-49db-ace6-db5748a9201d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_99092116_88f3_49fd_81d3_15220edf6824"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"cad0983d-08aa-4813-92b8-ecd0948c5a3e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"337c08c1-d983-4234-bb61-802e5a642090"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"431fb954-edc8-43eb-8065-c7edcabd7864","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"9bd65d16-65b7-45ae-99ab-298f6f137505"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"617b8bcd-6a91-4239-9f55-797d002e4ca5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"dfd5bd01-3ebf-47c9-9501-e21346d9e5ef"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d1b24a4c-2ab7-4d97-8402-7044fbbc1496","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"d2212910-a48e-4c21-96d4-009c61505cad"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517"}],"description":"","message_list":[],"uuid":"1d690448-1905-4eb7-8b45-61393498a943","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_5379eb2d_47d6_4a38_9aa8_7cd3d16130b5","uuid":"71849ae5-83cd-4bed-95e2-901ac1cfbc38"},"name":"SYS_GEN__Runbook_Application_5379eb2d_47d6_4a38_9aa8_7cd3d16130b5"}},{"description":"System action for starting an application","message_list":[],"uuid":"1f9067db-bb47-4fe5-bd48-eba2c2d7e53d","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"5379eb2d-47d6-4a38-9aa8-7cd3d16130b5"},"retries":"0","description":"","type":"DAG","uuid":"c3929b19-7bad-46c8-950a-85a038f34bbe","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"fa3289fb-ce74-45c1-9ef0-0f9cca038de4"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"4c7dc240-e62f-4bec-8bf1-dec3bd877e50"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"6954e468-2f6c-477e-9927-756acc0e6e8f"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"65885556-89e1-4b7d-b60e-100750d2ae07"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"4c7dc240-e62f-4bec-8bf1-dec3bd877e50"},"edge_type":"inherent","type":"","uuid":"a2936620-56b7-47d5-b6e6-60191ef0602c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"65885556-89e1-4b7d-b60e-100750d2ae07"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"fa3289fb-ce74-45c1-9ef0-0f9cca038de4"},"edge_type":"inherent","type":"","uuid":"011df594-72c6-4668-9d94-ab27bb5c2e49","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"6954e468-2f6c-477e-9927-756acc0e6e8f"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_5379eb2d_47d6_4a38_9aa8_7cd3d16130b5"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"fa3289fb-ce74-45c1-9ef0-0f9cca038de4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"487e3b1f-2401-4384-9b10-902b111f7b54"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4c7dc240-e62f-4bec-8bf1-dec3bd877e50","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"3abad12e-8d11-4552-b2bf-85bfe2e4007a"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6954e468-2f6c-477e-9927-756acc0e6e8f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"d2212910-a48e-4c21-96d4-009c61505cad"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"65885556-89e1-4b7d-b60e-100750d2ae07","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"dfd5bd01-3ebf-47c9-9501-e21346d9e5ef"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0"}],"description":"","message_list":[],"uuid":"228a05d7-487e-4804-8f27-f2da5b29681d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_5379eb2d_47d6_4a38_9aa8_7cd3d16130b5","uuid":"c3929b19-7bad-46c8-950a-85a038f34bbe"},"name":"SYS_GEN__Runbook_Application_5379eb2d_47d6_4a38_9aa8_7cd3d16130b5"}},{"description":"System action for restarting an application","message_list":[],"uuid":"f0e8836f-da00-40fa-a7e9-f0ba1e1f2793","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"5379eb2d-47d6-4a38-9aa8-7cd3d16130b5"},"retries":"0","description":"","type":"DAG","uuid":"2c44289c-c7f6-482f-95cd-8a22c614cef4","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"fe3c412d-b856-46dd-93b9-0701f6df8edc"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"24c9070f-6773-4186-b028-5b8a8cfc932f"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"5234ae67-1159-478a-ae06-13fb204e79f7"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"557c1676-ab57-4c16-9bf1-4d59c0d494ee"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"fe3c412d-b856-46dd-93b9-0701f6df8edc"},"edge_type":"inherent","type":"","uuid":"f9379221-8ad0-4d3a-b0f5-4ed441164119","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"5234ae67-1159-478a-ae06-13fb204e79f7"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"24c9070f-6773-4186-b028-5b8a8cfc932f"},"edge_type":"inherent","type":"","uuid":"88b11f2b-37fa-46af-a5df-6111098c565a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"557c1676-ab57-4c16-9bf1-4d59c0d494ee"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_5379eb2d_47d6_4a38_9aa8_7cd3d16130b5"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"fe3c412d-b856-46dd-93b9-0701f6df8edc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"f8dbff75-b18f-411c-b1b9-684afaae49cb"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"24c9070f-6773-4186-b028-5b8a8cfc932f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"cb870644-7c11-486e-881d-ad74d77112cf"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5234ae67-1159-478a-ae06-13fb204e79f7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"dae0b6c4-1f7d-4497-9710-8f360bc20831"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"557c1676-ab57-4c16-9bf1-4d59c0d494ee","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"cd09b8ce-f3e9-43e8-a843-6623eb53b961"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517"}],"description":"","message_list":[],"uuid":"cd26ba59-c720-4cc4-a4e7-5fe77f3d7a8c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_5379eb2d_47d6_4a38_9aa8_7cd3d16130b5","uuid":"2c44289c-c7f6-482f-95cd-8a22c614cef4"},"name":"SYS_GEN__Runbook_Application_5379eb2d_47d6_4a38_9aa8_7cd3d16130b5"}},{"description":"System action for stopping an application","message_list":[],"uuid":"ac4cd9ad-20d3-4cd6-92e6-6474f1aa81d8","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"5379eb2d-47d6-4a38-9aa8-7cd3d16130b5"},"retries":"0","description":"","type":"DAG","uuid":"35c7ae3c-d88f-4695-8d36-4e8df70ccb05","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"6ded6258-d468-41a4-be6a-9d238d9737c2"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"8c9916fd-eb40-4d67-ad54-fc63df943f84"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"e7f21bac-3418-4181-9d14-7e91a4529186"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"c0ded02a-428b-4c4a-a057-d4041adc887a"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"6ded6258-d468-41a4-be6a-9d238d9737c2"},"edge_type":"inherent","type":"","uuid":"1b20c91e-5d37-4593-bce6-c4b19ec53702","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"c0ded02a-428b-4c4a-a057-d4041adc887a"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"8c9916fd-eb40-4d67-ad54-fc63df943f84"},"edge_type":"inherent","type":"","uuid":"843004e6-aacd-45a1-a9c3-1e24b6f5f6ba","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"e7f21bac-3418-4181-9d14-7e91a4529186"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_5379eb2d_47d6_4a38_9aa8_7cd3d16130b5"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6ded6258-d468-41a4-be6a-9d238d9737c2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"4fde4266-9dcc-48ff-9ff0-b3b3ff53d82c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8c9916fd-eb40-4d67-ad54-fc63df943f84","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"b769d338-4161-4626-972a-7c9bcf413eac"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e7f21bac-3418-4181-9d14-7e91a4529186","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"089a6dff-8e7f-44d0-92ca-8188c6bac3f6"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c0ded02a-428b-4c4a-a057-d4041adc887a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"c1a97631-2b1e-4195-a6f6-6cf248c79516"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1"}],"description":"","message_list":[],"uuid":"b6596d93-659d-44e3-b807-c0099b79a191","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_5379eb2d_47d6_4a38_9aa8_7cd3d16130b5","uuid":"35c7ae3c-d88f-4695-8d36-4e8df70ccb05"},"name":"SYS_GEN__Runbook_Application_5379eb2d_47d6_4a38_9aa8_7cd3d16130b5"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"c4d605fe-22a4-4fd9-9ce2-bb7e16596219","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"5379eb2d-47d6-4a38-9aa8-7cd3d16130b5"},"retries":"0","description":"","type":"DAG","uuid":"da8ef8f7-2a74-4c38-9476-0510a42f18d1","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"bf8e43d1-b2a6-47c6-964a-be2b2d27c0ab"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"7950532d-f87d-428c-8918-b15824a53b30"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"43470852-4e6b-4da4-a17f-34c7f732ed31"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"64f3a8bc-e9eb-43c2-860d-981d3e9efdc5"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"ceedaa4b-f959-4ec1-aca4-f7f66f366bf8"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"3955a297-eab3-41c2-a62a-01e460518bc4"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"def04ec6-8695-4c17-979b-5e5397d1d4b6"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"181ccdbc-f6c2-4a3c-af91-6fb4b4a7ad97"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_65413f34_f6c9_4167_a384_430b589f40c5","uuid":"fb737b9f-ff64-4a71-82f4-80c887fa965a"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_36fc342b_cfd9_4914_a44e_33ec8e2269d9","uuid":"7dcf912f-5f82-4da9-ab2c-0e70b1ba5ec2"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"bf8e43d1-b2a6-47c6-964a-be2b2d27c0ab"},"edge_type":"inherent","type":"","uuid":"9404e5a3-2a7e-42de-9a9e-1a67636bb941","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"64f3a8bc-e9eb-43c2-860d-981d3e9efdc5"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"64f3a8bc-e9eb-43c2-860d-981d3e9efdc5"},"edge_type":"inherent","type":"","uuid":"3b45cde4-a37d-4caf-9c1f-5832171936c9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"ceedaa4b-f959-4ec1-aca4-f7f66f366bf8"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"181ccdbc-f6c2-4a3c-af91-6fb4b4a7ad97"},"edge_type":"inherent","type":"","uuid":"3137c042-409c-493b-afd7-c95314fbbe40","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_36fc342b_cfd9_4914_a44e_33ec8e2269d9","uuid":"7dcf912f-5f82-4da9-ab2c-0e70b1ba5ec2"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"ceedaa4b-f959-4ec1-aca4-f7f66f366bf8"},"edge_type":"inherent","type":"","uuid":"e36376c1-c841-444d-a6dc-5a5907576004","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"181ccdbc-f6c2-4a3c-af91-6fb4b4a7ad97"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"7950532d-f87d-428c-8918-b15824a53b30"},"edge_type":"inherent","type":"","uuid":"d0ee94d1-ab65-41a0-9b0e-c809ccc0c34f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"43470852-4e6b-4da4-a17f-34c7f732ed31"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"43470852-4e6b-4da4-a17f-34c7f732ed31"},"edge_type":"inherent","type":"","uuid":"5b27318d-2c20-4028-85e0-5990b04704f1","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"3955a297-eab3-41c2-a62a-01e460518bc4"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"def04ec6-8695-4c17-979b-5e5397d1d4b6"},"edge_type":"inherent","type":"","uuid":"c17af6c3-1b20-4c9f-a41d-3d1e5b95f156","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_65413f34_f6c9_4167_a384_430b589f40c5","uuid":"fb737b9f-ff64-4a71-82f4-80c887fa965a"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"3955a297-eab3-41c2-a62a-01e460518bc4"},"edge_type":"inherent","type":"","uuid":"03cd3fc4-7f79-422e-bed7-a16971115fa0","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"def04ec6-8695-4c17-979b-5e5397d1d4b6"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"ceedaa4b-f959-4ec1-aca4-f7f66f366bf8"},"edge_type":"create_action_edge","type":"","uuid":"ed51ba2c-b867-4d15-be7a-545eb9b2aeb0","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"def04ec6-8695-4c17-979b-5e5397d1d4b6"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"3955a297-eab3-41c2-a62a-01e460518bc4"},"edge_type":"create_action_edge","type":"","uuid":"933b9e99-144a-4f82-bb34-d0fd77bcb929","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"181ccdbc-f6c2-4a3c-af91-6fb4b4a7ad97"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"64f3a8bc-e9eb-43c2-860d-981d3e9efdc5"},"edge_type":"dependency","type":"","uuid":"aae311e1-9661-47ee-ac71-90a382799cf5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"3955a297-eab3-41c2-a62a-01e460518bc4"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_5379eb2d_47d6_4a38_9aa8_7cd3d16130b5"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"bf8e43d1-b2a6-47c6-964a-be2b2d27c0ab","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"4fde4266-9dcc-48ff-9ff0-b3b3ff53d82c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"7950532d-f87d-428c-8918-b15824a53b30","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"b769d338-4161-4626-972a-7c9bcf413eac"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"43470852-4e6b-4da4-a17f-34c7f732ed31","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"09962a62-e984-4f41-bd3f-98968b698ac0"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"64f3a8bc-e9eb-43c2-860d-981d3e9efdc5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"26ce2713-05fa-4b65-ac37-579626d25b62"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ceedaa4b-f959-4ec1-aca4-f7f66f366bf8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"a0c65fcd-72cf-40f4-b38c-e7de5bce4776"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3955a297-eab3-41c2-a62a-01e460518bc4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"3b9dfc22-8db7-42ff-864f-f70d6a4dda3d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_99092116_88f3_49fd_81d3_15220edf6824"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"def04ec6-8695-4c17-979b-5e5397d1d4b6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"a6b80b68-4571-4ca2-aa57-bc80bc9d9004"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"181ccdbc-f6c2-4a3c-af91-6fb4b4a7ad97","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"13fe4599-64aa-4971-af0f-5cfc3695bd46"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"fb737b9f-ff64-4a71-82f4-80c887fa965a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_65413f34_f6c9_4167_a384_430b589f40c5"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"7dcf912f-5f82-4da9-ab2c-0e70b1ba5ec2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_36fc342b_cfd9_4914_a44e_33ec8e2269d9"}],"description":"","message_list":[],"uuid":"83777dfd-978b-45cd-ab03-4cb2d2c7ee16","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_5379eb2d_47d6_4a38_9aa8_7cd3d16130b5","uuid":"da8ef8f7-2a74-4c38-9476-0510a42f18d1"},"name":"SYS_GEN__Runbook_Application_5379eb2d_47d6_4a38_9aa8_7cd3d16130b5"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"ca4e30c3-5b92-4a78-95b1-f51ecb1b74e5","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"5379eb2d-47d6-4a38-9aa8-7cd3d16130b5"},"retries":"0","description":"","type":"DAG","uuid":"12e32cde-8dff-406f-8a81-37e05187badc","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"bf5faf8f-283e-4b1e-a22c-80032252d217"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"e241e891-6e56-4728-a2f6-b021d8e8ba2e"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"774dceb1-cc06-4b4c-ab63-bc7e5cddd5ae"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_99092116_88f3_49fd_81d3_15220edf6824","uuid":"77a81a3d-550a-4524-bbee-f5ba21c28cee"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"b900efab-7f6a-4f07-a98a-308a0ed9eda2"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"7605a758-dde0-4dd9-b856-c6899be6fc99"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_36fc342b_cfd9_4914_a44e_33ec8e2269d9","uuid":"9b729051-d454-4c80-b249-72e37f708e6d"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_65413f34_f6c9_4167_a384_430b589f40c5","uuid":"70084811-5c23-4d9a-ae0b-e3c98933f166"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"bf5faf8f-283e-4b1e-a22c-80032252d217"},"edge_type":"inherent","type":"","uuid":"f02d1a13-b90e-4485-b8c2-0a19459543d2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"774dceb1-cc06-4b4c-ab63-bc7e5cddd5ae"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"7605a758-dde0-4dd9-b856-c6899be6fc99"},"edge_type":"inherent","type":"","uuid":"186b2329-4ed2-4b15-aa28-e397ea26b77e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_36fc342b_cfd9_4914_a44e_33ec8e2269d9","uuid":"9b729051-d454-4c80-b249-72e37f708e6d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"774dceb1-cc06-4b4c-ab63-bc7e5cddd5ae"},"edge_type":"inherent","type":"","uuid":"ef210893-6cc6-46b2-8739-6b0d0cb92c43","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"7605a758-dde0-4dd9-b856-c6899be6fc99"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"e241e891-6e56-4728-a2f6-b021d8e8ba2e"},"edge_type":"inherent","type":"","uuid":"aa95e7c2-0746-42f5-ba2c-8973d49705ef","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_99092116_88f3_49fd_81d3_15220edf6824","uuid":"77a81a3d-550a-4524-bbee-f5ba21c28cee"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_99092116_88f3_49fd_81d3_15220edf6824","uuid":"77a81a3d-550a-4524-bbee-f5ba21c28cee"},"edge_type":"inherent","type":"","uuid":"4011737b-b4d4-4b3f-95ef-c910137b8aa9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"b900efab-7f6a-4f07-a98a-308a0ed9eda2"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"b900efab-7f6a-4f07-a98a-308a0ed9eda2"},"edge_type":"inherent","type":"","uuid":"9de7c01c-ef20-478e-a050-9b5cbe36f529","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_65413f34_f6c9_4167_a384_430b589f40c5","uuid":"70084811-5c23-4d9a-ae0b-e3c98933f166"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"774dceb1-cc06-4b4c-ab63-bc7e5cddd5ae"},"edge_type":"create_action_edge","type":"","uuid":"b5cd9e70-0cac-4e5b-b4b1-73d59d14e9f5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"b900efab-7f6a-4f07-a98a-308a0ed9eda2"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_99092116_88f3_49fd_81d3_15220edf6824","uuid":"77a81a3d-550a-4524-bbee-f5ba21c28cee"},"edge_type":"create_action_edge","type":"","uuid":"651109ea-f7b2-489a-a514-6d1c91e70616","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"7605a758-dde0-4dd9-b856-c6899be6fc99"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_5379eb2d_47d6_4a38_9aa8_7cd3d16130b5"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"bf5faf8f-283e-4b1e-a22c-80032252d217","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"83064c0f-b87b-4e8f-b4ae-0d9be93e1f13"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e241e891-6e56-4728-a2f6-b021d8e8ba2e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"b28fd8da-c23e-45fb-86d4-4f1f6222b794"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"774dceb1-cc06-4b4c-ab63-bc7e5cddd5ae","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"77a81a3d-550a-4524-bbee-f5ba21c28cee","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_99092116_88f3_49fd_81d3_15220edf6824"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SW","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b900efab-7f6a-4f07-a98a-308a0ed9eda2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9","uuid":"9909f3ce-8c36-4ec7-a2ed-caa33bd71bac"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_4d669bf0_f18a_40d0_97fe_d3be8ad5c7d9"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"7605a758-dde0-4dd9-b856-c6899be6fc99","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1","uuid":"7a67c432-dd10-40ce-a045-3008b6c54ed2"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_ea96440f_ce01_43e0_893d_b5bd8347d8a1"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"9b729051-d454-4c80-b249-72e37f708e6d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_36fc342b_cfd9_4914_a44e_33ec8e2269d9"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"70084811-5c23-4d9a-ae0b-e3c98933f166","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_65413f34_f6c9_4167_a384_430b589f40c5"}],"description":"","message_list":[],"uuid":"2fc1e53a-5236-494a-bfb9-056bda68bd78","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_5379eb2d_47d6_4a38_9aa8_7cd3d16130b5","uuid":"12e32cde-8dff-406f-8a81-37e05187badc"},"name":"SYS_GEN__Runbook_Application_5379eb2d_47d6_4a38_9aa8_7cd3d16130b5"}}],"message_list":[],"uuid":"5379eb2d-47d6-4a38-9aa8-7cd3d16130b5","state":"ACTIVE","dependency_list":[{"getter_resource_kind":"PackageCfg","setter_resource_attr":"address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"AHV_Centos_K8SW","action_name":"action_create","action_resource_name":"Nutanix","getter_resource_name":"AHV_Centos_K8SM_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"AHV_Centos_K8SM","action_name":"action_create","action_resource_name":"Nutanix","getter_resource_name":"AHV_Centos_K8SW_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"address","setter_resource_kind":"ServiceCfg","setter_resource_name":"Kubernetes_Master","action_name":"action_delete","action_resource_name":"Nutanix","getter_resource_name":"AHV_Centos_K8SW_Package","action_resource_kind":"ApplicationCfg"}],"variable_list":[{"val_type":"STRING","description":"","message_list":[],"uuid":"0ed70cb3-6cef-4cd7-b582-eb7ed6ef3ca1","value":"ahv-kubenetes-cluster","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_CLUSTER_NAME"},{"val_type":"STRING","description":"","message_list":[],"uuid":"d342abf7-8cdb-4159-98b9-f767dc9600b7","value":"v1.14.2","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_VERSION"},{"val_type":"STRING","description":"","message_list":[],"uuid":"8ab025e6-192f-46ff-8c71-325d8e6a7304","value":"17.03.3.ce","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"DOCKER_VERSION"},{"val_type":"STRING","description":"","message_list":[],"uuid":"2e51c4fc-0170-4989-b427-ecce862d64a2","value":"10.200.0.0\/16","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_CLUSTER_SUBNET"},{"val_type":"STRING","description":"","message_list":[],"uuid":"a4ab6187-1ed4-45ab-9e5d-999686b68585","value":"10.32.0.0\/24","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_SERVICE_SUBNET"},{"val_type":"STRING","description":"","message_list":[],"uuid":"d4623004-9117-4eac-83d0-1a6908c76fc6","value":"10.32.0.10","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_DNS_IP"},{"val_type":"STRING","description":"","message_list":[],"uuid":"b60647c2-73e8-4577-a30b-7cbc73a0cafe","value":"10.5.68.20","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"PE_CLUSTER_IP"},{"val_type":"STRING","description":"","message_list":[],"uuid":"e9998b23-0e15-4d12-a293-51b514899f98","value":"10.5.68.27","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"PE_DATA_SERVICE_IP"},{"val_type":"STRING","description":"","message_list":[],"uuid":"db122700-c561-4b3d-a619-36be3d17c164","value":"admin","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"PE_USERNAME"},{"val_type":"STRING","description":"","message_list":[],"uuid":"4dadfc60-368c-47dc-92ab-d2a15932c0bf","value":"","label":"","state":"ACTIVE","attrs":{"is_secret_modified":false,"secret_reference":{"uuid":"4b5aad23-9c65-4c35-80c7-d9d7ead87cb6"},"type":""},"editables":{"value":true},"type":"SECRET","name":"PE_PASSWORD"},{"val_type":"STRING","description":"","message_list":[],"uuid":"782de374-59f1-40e6-a6d7-d861d9e2fe66","value":"default-container-71229","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"PE_CONTAINER_NAME"},{"val_type":"STRING","description":"","message_list":[],"uuid":"dcda56d7-1780-642c-601f-1871f2d2d2d4","value":"flannel","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_CNI_PLUGIN"}],"name":"Nutanix"}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"CENTOS","uuid":"7f504213-fb04-443e-8007-1547bccadb97"},"package_definition_list":[{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"d976cddf-ad79-4548-a140-bd5fd3e6528e","name":"action_install","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"},"retries":"0","description":"","type":"DAG","uuid":"32025af6-8953-4a58-82df-ef00947101b1","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Install_Crb_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"a1da79e0-f41b-480e-9363-59a60e2752ca"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_INSTALL","uuid":"a1da79e0-f41b-480e-9363-59a60e2752ca","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"},"retries":"0","description":"","type":"DAG","uuid":"5da059ca-9790-4ec3-a9e2-0603c4351cd7","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"eabe5f6b-5085-4bf3-89d6-e5a2efada38b"},{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"ebe27231-bc7c-4ef4-93d9-ad716bef85a6"},{"kind":"app_task","name":"Generate Certs","uuid":"376f7cc1-2ab0-4e69-aa31-b86c5245b7ab"},{"kind":"app_task","name":"Configure Services","uuid":"838cf56b-04f7-44b1-864a-0d8fa995894a"},{"kind":"app_task","name":"Add User Roles","uuid":"0176e204-3e8b-4f15-ac53-bc9931a118c9"},{"kind":"app_task","name":"Network Configuration","uuid":"962d2407-d998-45d9-8f93-4753c589cfea"},{"kind":"app_task","name":"DNS Configuration","uuid":"bc76166c-44b1-455c-8a4d-d51a275a2622"},{"kind":"app_task","name":"NVP Configuration","uuid":"38621149-0471-9d76-68db-f0156b4d23b0"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"eabe5f6b-5085-4bf3-89d6-e5a2efada38b"},"edge_type":"user_defined","type":"","uuid":"97ec3a23-dc95-4129-b687-16208661a683","to_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"ebe27231-bc7c-4ef4-93d9-ad716bef85a6"}},{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"ebe27231-bc7c-4ef4-93d9-ad716bef85a6"},"edge_type":"user_defined","type":"","uuid":"5189d82f-d25c-4546-a6b5-cd518c7edebc","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"376f7cc1-2ab0-4e69-aa31-b86c5245b7ab"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"376f7cc1-2ab0-4e69-aa31-b86c5245b7ab"},"edge_type":"user_defined","type":"","uuid":"8fa3fcd5-69dc-481d-8331-132288e42728","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"838cf56b-04f7-44b1-864a-0d8fa995894a"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"838cf56b-04f7-44b1-864a-0d8fa995894a"},"edge_type":"user_defined","type":"","uuid":"e3237e7f-ae2a-41c8-bb5d-9cfc1070eb37","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"0176e204-3e8b-4f15-ac53-bc9931a118c9"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"0176e204-3e8b-4f15-ac53-bc9931a118c9"},"edge_type":"user_defined","type":"","uuid":"1957525b-a91b-4832-97d2-0103e08c70a5","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"962d2407-d998-45d9-8f93-4753c589cfea"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"962d2407-d998-45d9-8f93-4753c589cfea"},"edge_type":"user_defined","type":"","uuid":"9874f072-49e5-4196-9687-d6bdb24c6272","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"bc76166c-44b1-455c-8a4d-d51a275a2622"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"bc76166c-44b1-455c-8a4d-d51a275a2622"},"edge_type":"user_defined","type":"","uuid":"c0c7aedf-6b39-22f0-4128-294c22a12e3c","to_task_reference":{"kind":"app_task","name":"NVP Configuration","uuid":"38621149-0471-9d76-68db-f0156b4d23b0"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"dac441af_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"eabe5f6b-5085-4bf3-89d6-e5a2efada38b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"EXEC","uuid":"ebe27231-bc7c-4ef4-93d9-ad716bef85a6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\ncount=0\n# Verify access to Centos mirror before yum update\ncheck_mirror() {\ncurl -s mirrorlist.centos.org >\/dev\/null | true\nif [ \"${PIPESTATUS[0]}\" -ne 0 ]; then\n    if [ ${count} -lt 60 ]; then\n        echo \"Sleeping for 5 seconds before repeating the check\" | sudo tee -a \/var\/log\/messages\n        sleep 5\n        count=$((count+1))\n        check_mirror\n    else\n        echo \"DNS resolution failed after 5 minutes, exiting\" | sudo tee -a \/var\/log\/messages\n        exit 1\n    fi\nfi\n}\ncheck_mirror\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.3.12\"\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_IPS=\"@@{AHV_Centos_K8SW.address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_CONFIG_PATH=\"\/etc\/kubernetes\/config\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CONFIG_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} master${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"master${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  count=$((count+1))\ndone  \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\necho \"if \\$programname == 'etcd' then \/var\/log\/etcd.log\n& stop\" | sudo tee \/etc\/rsyslog.d\/etcd.conf\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-*.tgz\n\ncat <<EOF | sudo tee ${KUBE_CONFIG_PATH}\/kubelet-config.yaml\nkind: KubeletConfiguration\napiVersion: kubelet.config.k8s.io\/v1beta1\nauthentication:\n  anonymous:\n    enabled: false\n  webhook:\n    enabled: true\n  x509:\n    clientCAFile: \"${KUBE_CERT_PATH}\/ca.pem\"\nauthorization:\n  mode: Webhook\nclusterDomain: \"cluster.local\"\nclusterDNS:\n  - \"${KUBE_CLUSTER_DNS}\"\nstaticPodPath: \"${KUBE_MANIFEST_PATH}\"\npodCIDR: \"${CLUSTER_SUBNET}\"\nruntimeRequestTimeout: \"10m\"\ntlsCertFile: \"${KUBE_CERT_PATH}\/${NODE_NAME}.pem\"\ntlsPrivateKeyFile: \"${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem\"\nreadOnlyPort: 0\nprotectKernelDefaults: false\nmakeIPTablesUtilChains: true\neventRecordQPS: 0\nkubeletCgroups: \"\/systemd\/system.slice\"\nEOF\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --config=${KUBE_CONFIG_PATH}\/kubelet-config.yaml \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --register-node=true \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"if \\$programname == 'kubelet' then \/var\/log\/kubelet.log\n& stop\" | sudo tee \/etc\/rsyslog.d\/kubelet.conf\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate etcd \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/sd{e,f,g}\nsudo vgcreate docker \/dev\/sd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"EXEC","uuid":"376f7cc1-2ab0-4e69-aa31-b86c5245b7ab","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_IPS=\"@@{AHV_Centos_K8SW.address}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"master${count}\",\n  count=$((count+1))\ndone\n\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"worker${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_NAMES},${MASTER_IPS},${MINION_NAMES},${WORKER_IPS},${FIRST_IP_SERVICE_SUBNET},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local -profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\ninstance=\"master${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=master${count}.kubeconfig\nkubectl config set-credentials system:node:master${count} --client-certificate=master${count}.pem --client-key=master${count}-key.pem --embed-certs=true --kubeconfig=master${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:master${count} --kubeconfig=master${count}.kubeconfig\nkubectl config use-context default --kubeconfig=master${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"master${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"EXEC","uuid":"838cf56b-04f7-44b1-864a-0d8fa995894a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CONFIG_PATH=\"\/etc\/kubernetes\/config\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nCONTROLLER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --enable-admission-plugins=NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\ncat <<EOF | sudo tee ${KUBE_CONFIG_PATH}\/kube-proxy-config.yaml\nkind: KubeProxyConfiguration\napiVersion: kubeproxy.config.k8s.io\/v1alpha1\nclientConnection:\n  kubeconfig: \"${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\"\nmode: \"iptables\"\nclusterCIDR: \"${CLUSTER_SUBNET}\"\niptables:\n  masqueradeAll: true\nEOF\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --config=${KUBE_CONFIG_PATH}\/kube-proxy-config.yaml\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/lib\/modules\n      name: lib-modules-host\n      readOnly: true\n    - mountPath: ${KUBE_CONFIG_PATH}\n      name: kube-config-path\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/lib\/modules\n    name: lib-modules-host\n  - hostPath:\n      path: ${KUBE_CONFIG_PATH}\n    name: kube-config-path\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masqueradeAll\/d' ${KUBE_CONFIG_PATH}\/kube-proxy-config.yaml\nfi \n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --bind-address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=${KUBE_CLUSTER_NAME}\n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n   \ncat <<EOF | sudo tee ${KUBE_CONFIG_PATH}\/kube-scheduler.yaml\napiVersion: kubescheduler.config.k8s.io\/v1alpha1\nkind: KubeSchedulerConfiguration\nclientConnection:\n  kubeconfig: \"${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\"\nleaderElection:\n  leaderElect: true\nEOF\n   \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --config=${KUBE_CONFIG_PATH}\/kube-scheduler.yaml\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: ${KUBE_CONFIG_PATH}\n      name: kube-config-path\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: ${KUBE_CONFIG_PATH}\n    name: kube-config-path\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n    \necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"EXEC","uuid":"0176e204-3e8b-4f15-ac53-bc9931a118c9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet iscsid\nsudo systemctl enable etcd docker kubelet iscsid\nsudo systemctl restart rsyslog\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem master* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"EXEC","uuid":"962d2407-d998-45d9-8f93-4753c589cfea","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ]]; then\nsudo mkdir -p \/etc\/kubernetes\/addons\/canal\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: canal-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  canal_iface: \"\"\n\n  masquerade: \"true\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: canal\n  namespace: kube-system\n  labels:\n    k8s-app: canal\nspec:\n  selector:\n    matchLabels:\n      k8s-app: canal\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: canal\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: canal\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-canal.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              value: \"none\"\n            - name: CLUSTER_TYPE\n              value: \"k8s,canal\"\n            - name: FELIX_IPTABLESREFRESHINTERVAL\n              value: \"60\"\n            - name: IP\n              value: \"\"\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"192.168.0.0\/16\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: \/readiness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n        - name: kube-flannel\n          image: quay.io\/coreos\/flannel:v0.9.1\n          command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n          securityContext:\n            privileged: true\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: FLANNELD_IFACE\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: canal_iface\n            - name: FLANNELD_IP_MASQ\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: masquerade\n          volumeMounts:\n          - mountPath: \/run\/xtables.lock\n            name: xtables-lock\n            readOnly: false\n          - name: flannel-cfg\n            mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: flannel-cfg\n          configMap:\n            name: canal-config\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: canal\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: canal-flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: canal-calico\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/canal\/canal.yml\nkubectl create -f \/etc\/kubernetes\/addons\/canal\/canal.yml\n\nelif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]];then\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/calico\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  calico_backend: \"bird\"\n\n  veth_mtu: \"1440\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: calico-node\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-calico.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CNI_MTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s,bgp\"\n            - name: IP\n              value: \"autodetect\"\n            - name: CALICO_IPV4POOL_IPIP\n              value: \"Always\"\n            - name: FELIX_IPINIPMTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"@@{KUBE_CLUSTER_SUBNET}@@\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            exec:\n              command:\n              - \/bin\/calico-node\n              - -bird-ready\n              - -felix-ready\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPPeer\n    plural: bgppeers\n    singular: bgppeer\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/calico\/calico.yml\nkubectl create -f \/etc\/kubernetes\/addons\/calico\/calico.yml  \n\nelse\n  echo \"Defaulting to flannel\"\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n  - kind: ServiceAccount\n    name: flannel\n    namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"hairpinMode\": true,\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - \/opt\/bin\/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n          limits:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/bin\/sh\", \"-c\", \"set -e -x; cp -f \/etc\/kube-flannel\/cni-conf.json \/etc\/cni\/net.d\/10-flannel.conf; while true; do sleep 3600; done\" ]\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nfi\n\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"EXEC","uuid":"bc76166c-44b1-455c-8a4d-d51a275a2622","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/coredns \necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: coredns\n  namespace: kube-system\n  labels:\n      kubernetes.io\/cluster-service: \"true\"\n      addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: rbac.authorization.k8s.io\/v1\nkind: ClusterRole\nmetadata:\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n    addonmanager.kubernetes.io\/mode: Reconcile\n  name: system:coredns\nrules:\n- apiGroups:\n  - \"\"\n  resources:\n  - endpoints\n  - services\n  - pods\n  - namespaces\n  verbs:\n  - list\n  - watch\n- apiGroups:\n  - \"\"\n  resources:\n  - nodes\n  verbs:\n  - get\n---\napiVersion: rbac.authorization.k8s.io\/v1\nkind: ClusterRoleBinding\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n    addonmanager.kubernetes.io\/mode: EnsureExists\n  name: system:coredns\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:coredns\nsubjects:\n- kind: ServiceAccount\n  name: coredns\n  namespace: kube-system\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: coredns\n  namespace: kube-system\n  labels:\n      addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  Corefile: |\n    .:53 {\n        errors\n        health\n        kubernetes cluster.local. in-addr.arpa ip6.arpa {\n            pods insecure\n            upstream\n            fallthrough in-addr.arpa ip6.arpa\n        }\n        prometheus :9153\n        forward . \/etc\/resolv.conf\n        cache 30\n        loop\n        reload\n        loadbalance\n    }\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: coredns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/name: \"CoreDNS\"\nspec:\n  strategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      serviceAccountName: coredns\n      tolerations:\n        - key: \"CriticalAddonsOnly\"\n          operator: \"Exists\"\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      containers:\n      - name: coredns\n        image: k8s.gcr.io\/coredns:1.3.1\n        imagePullPolicy: IfNotPresent\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        args: [ \"-conf\", \"\/etc\/coredns\/Corefile\" ]\n        volumeMounts:\n        - name: config-volume\n          mountPath: \/etc\/coredns\n          readOnly: true\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        - containerPort: 9153\n          name: metrics\n          protocol: TCP\n        livenessProbe:\n          httpGet:\n            path: \/health\n            port: 8080\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/health\n            port: 8080\n            scheme: HTTP\n        securityContext:\n          allowPrivilegeEscalation: false\n          capabilities:\n            add:\n            - NET_BIND_SERVICE\n            drop:\n            - all\n          readOnlyRootFilesystem: true\n      dnsPolicy: Default\n      volumes:\n        - name: config-volume\n          configMap:\n            name: coredns\n            items:\n            - key: Corefile\n              path: Corefile\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  annotations:\n    prometheus.io\/port: \"9153\"\n    prometheus.io\/scrape: \"true\"\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/name: \"CoreDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n  - name: dns\n    port: 53\n    protocol: UDP\n  - name: dns-tcp\n    port: 53\n    protocol: TCP\n  - name: metrics\n    port: 9153\n    protocol: TCP' | sudo tee \/etc\/kubernetes\/addons\/coredns\/coredns.yaml\n    \nkubectl create -f \/etc\/kubernetes\/addons\/coredns\/coredns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.2.0\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          - --target=Deployment\/coredns\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/coredns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/coredns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"EXEC","uuid":"38621149-0471-9d76-68db-f0156b4d23b0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nPRISM_CLUSTER_IP=\"@@{PE_CLUSTER_IP}@@\"\nPRISM_DATA_SERVICE_IP=\"@@{PE_CLUSTER_IP}@@\"\n\nif [[ (\"${PRISM_CLUSTER_IP}x\" == \"x\") && (\"${PRISM_DATA_SERVICE_IP}x\" == \"x\") ]]; then exit 0; fi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/volume_plugin\nNTNX_SECRET=$(echo -n \"@@{PE_USERNAME}@@:@@{PE_PASSWORD}@@\" | base64)\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: nutanixabs-provisioner-runner\n  namespace: kube-system\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumes\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumeclaims\"]\n    verbs: [\"get\", \"list\", \"watch\", \"update\"]\n  - apiGroups: [\"storage.k8s.io\"]\n    resources: [\"storageclasses\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"list\", \"watch\", \"create\", \"update\", \"patch\"]\n  - apiGroups: [\"\"]\n    resources: [\"services\"]\n    verbs: [\"get\"]\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"create\", \"delete\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: run-nutanixabs-provisioner\n  namespace: kube-system\nsubjects:\n  - kind: ServiceAccount\n    name: nutanixabs-provisioner\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: nutanixabs-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      labels:\n        app: nutanixabs-provisioner\n    spec:\n      serviceAccount: nutanixabs-provisioner\n      hostNetwork: true\n      containers:\n        -\n          image: \"ntnx\/nutanixabs-provisioner\"\n          name: nutanixabs-provisioner\n          args: [\"--v=4\"]\n          imagePullPolicy: IfNotPresent\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: kube-system\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\n---\nkind: StorageClass\napiVersion: storage.k8s.io\/v1\nmetadata:\n  name: silver \n  namespace: kube-system\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\nprovisioner: nutanix\/abs\nparameters:\n     prismEndPoint: @@{PE_CLUSTER_IP}@@:9440\n     dataServiceEndPoint: @@{PE_DATA_SERVICE_IP}@@:3260\n     secretName: ntnx-secret\n     storageContainer: @@{PE_CONTAINER_NAME}@@\n     fsType: ext4\n     chapAuthEnabled: \"false\"' | sudo tee \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\necho \"apiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: default\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\" | sudo tee -a \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"NVP Configuration"}],"description":"","message_list":[],"uuid":"90359548-587c-4ebb-8203-2d8f67ba25d0","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"dac441af_dag","uuid":"5da059ca-9790-4ec3-a9e2-0603c4351cd7"},"name":"8e760b73_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"},"retries":"0","description":"","type":"DAG","uuid":"55e668d6-c865-44da-9e1b-b33595b22f32","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6324786a_dag"}],"description":"","message_list":[],"uuid":"be04318d-ff24-4ce9-a752-08a7064ecebd","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6324786a_dag","uuid":"55e668d6-c865-44da-9e1b-b33595b22f32"},"name":"6522ac7a_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Install_Crb_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41"}],"description":"","message_list":[],"uuid":"e6312c8e-6e32-49f9-856a-ae52860a786e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"32025af6-8953-4a58-82df-ef00947101b1"},"name":"SYS_GEN__Runbook_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41"}},{"description":"System action for creating an application","message_list":[],"uuid":"42344a48-a13b-4381-8f18-7a5ba8a04a0f","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"},"retries":"0","description":"","type":"DAG","uuid":"31197610-9b3b-4a20-b4f7-8722338a7e6b","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"838ee972-1a00-4966-ba28-9804b97973b5"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"84f3ef27-520c-4f93-97e9-b2ad6be6275f"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"851fe92d-a938-48a2-a7b8-4dfb1daf9a45"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"84f3ef27-520c-4f93-97e9-b2ad6be6275f"},"edge_type":"inherent","type":"","uuid":"acd4ece3-1bbb-4846-bfda-84e11ac37b78","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"851fe92d-a938-48a2-a7b8-4dfb1daf9a45"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"838ee972-1a00-4966-ba28-9804b97973b5"},"edge_type":"inherent","type":"","uuid":"3a773efa-e3d3-454c-b184-69197ead61b6","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"84f3ef27-520c-4f93-97e9-b2ad6be6275f"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"838ee972-1a00-4966-ba28-9804b97973b5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"e6312c8e-6e32-49f9-856a-ae52860a786e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"84f3ef27-520c-4f93-97e9-b2ad6be6275f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"337c08c1-d983-4234-bb61-802e5a642090"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"851fe92d-a938-48a2-a7b8-4dfb1daf9a45","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"dfd5bd01-3ebf-47c9-9501-e21346d9e5ef"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0"}],"description":"","message_list":[],"uuid":"3c03e6b3-6045-48ed-8949-10be9874daf7","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"31197610-9b3b-4a20-b4f7-8722338a7e6b"},"name":"SYS_GEN__Runbook_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41"}},{"description":"System action for uninstalling an application","message_list":[],"uuid":"1d57bf03-71a8-4513-983c-a532b7b5a3ba","name":"action_uninstall","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"},"retries":"0","description":"","type":"DAG","uuid":"84b1e41a-9030-4007-8ad4-4c45df4f4028","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Uninstall_Crb_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"55cd32b4-0a30-4e3d-8eee-113d6441197d"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_UNINSTALL","uuid":"55cd32b4-0a30-4e3d-8eee-113d6441197d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"},"retries":"0","description":"","type":"DAG","uuid":"5da059ca-9790-4ec3-a9e2-0603c4351cd7","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"eabe5f6b-5085-4bf3-89d6-e5a2efada38b"},{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"ebe27231-bc7c-4ef4-93d9-ad716bef85a6"},{"kind":"app_task","name":"Generate Certs","uuid":"376f7cc1-2ab0-4e69-aa31-b86c5245b7ab"},{"kind":"app_task","name":"Configure Services","uuid":"838cf56b-04f7-44b1-864a-0d8fa995894a"},{"kind":"app_task","name":"Add User Roles","uuid":"0176e204-3e8b-4f15-ac53-bc9931a118c9"},{"kind":"app_task","name":"Network Configuration","uuid":"962d2407-d998-45d9-8f93-4753c589cfea"},{"kind":"app_task","name":"DNS Configuration","uuid":"bc76166c-44b1-455c-8a4d-d51a275a2622"},{"kind":"app_task","name":"NVP Configuration","uuid":"38621149-0471-9d76-68db-f0156b4d23b0"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"eabe5f6b-5085-4bf3-89d6-e5a2efada38b"},"edge_type":"user_defined","type":"","uuid":"97ec3a23-dc95-4129-b687-16208661a683","to_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"ebe27231-bc7c-4ef4-93d9-ad716bef85a6"}},{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"ebe27231-bc7c-4ef4-93d9-ad716bef85a6"},"edge_type":"user_defined","type":"","uuid":"5189d82f-d25c-4546-a6b5-cd518c7edebc","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"376f7cc1-2ab0-4e69-aa31-b86c5245b7ab"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"376f7cc1-2ab0-4e69-aa31-b86c5245b7ab"},"edge_type":"user_defined","type":"","uuid":"8fa3fcd5-69dc-481d-8331-132288e42728","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"838cf56b-04f7-44b1-864a-0d8fa995894a"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"838cf56b-04f7-44b1-864a-0d8fa995894a"},"edge_type":"user_defined","type":"","uuid":"e3237e7f-ae2a-41c8-bb5d-9cfc1070eb37","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"0176e204-3e8b-4f15-ac53-bc9931a118c9"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"0176e204-3e8b-4f15-ac53-bc9931a118c9"},"edge_type":"user_defined","type":"","uuid":"1957525b-a91b-4832-97d2-0103e08c70a5","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"962d2407-d998-45d9-8f93-4753c589cfea"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"962d2407-d998-45d9-8f93-4753c589cfea"},"edge_type":"user_defined","type":"","uuid":"9874f072-49e5-4196-9687-d6bdb24c6272","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"bc76166c-44b1-455c-8a4d-d51a275a2622"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"bc76166c-44b1-455c-8a4d-d51a275a2622"},"edge_type":"user_defined","type":"","uuid":"c0c7aedf-6b39-22f0-4128-294c22a12e3c","to_task_reference":{"kind":"app_task","name":"NVP Configuration","uuid":"38621149-0471-9d76-68db-f0156b4d23b0"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"dac441af_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"eabe5f6b-5085-4bf3-89d6-e5a2efada38b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"EXEC","uuid":"ebe27231-bc7c-4ef4-93d9-ad716bef85a6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\ncount=0\n# Verify access to Centos mirror before yum update\ncheck_mirror() {\ncurl -s mirrorlist.centos.org >\/dev\/null | true\nif [ \"${PIPESTATUS[0]}\" -ne 0 ]; then\n    if [ ${count} -lt 60 ]; then\n        echo \"Sleeping for 5 seconds before repeating the check\" | sudo tee -a \/var\/log\/messages\n        sleep 5\n        count=$((count+1))\n        check_mirror\n    else\n        echo \"DNS resolution failed after 5 minutes, exiting\" | sudo tee -a \/var\/log\/messages\n        exit 1\n    fi\nfi\n}\ncheck_mirror\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.3.12\"\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_IPS=\"@@{AHV_Centos_K8SW.address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_CONFIG_PATH=\"\/etc\/kubernetes\/config\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CONFIG_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} master${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"master${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  count=$((count+1))\ndone  \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\necho \"if \\$programname == 'etcd' then \/var\/log\/etcd.log\n& stop\" | sudo tee \/etc\/rsyslog.d\/etcd.conf\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-*.tgz\n\ncat <<EOF | sudo tee ${KUBE_CONFIG_PATH}\/kubelet-config.yaml\nkind: KubeletConfiguration\napiVersion: kubelet.config.k8s.io\/v1beta1\nauthentication:\n  anonymous:\n    enabled: false\n  webhook:\n    enabled: true\n  x509:\n    clientCAFile: \"${KUBE_CERT_PATH}\/ca.pem\"\nauthorization:\n  mode: Webhook\nclusterDomain: \"cluster.local\"\nclusterDNS:\n  - \"${KUBE_CLUSTER_DNS}\"\nstaticPodPath: \"${KUBE_MANIFEST_PATH}\"\npodCIDR: \"${CLUSTER_SUBNET}\"\nruntimeRequestTimeout: \"10m\"\ntlsCertFile: \"${KUBE_CERT_PATH}\/${NODE_NAME}.pem\"\ntlsPrivateKeyFile: \"${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem\"\nreadOnlyPort: 0\nprotectKernelDefaults: false\nmakeIPTablesUtilChains: true\neventRecordQPS: 0\nkubeletCgroups: \"\/systemd\/system.slice\"\nEOF\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --config=${KUBE_CONFIG_PATH}\/kubelet-config.yaml \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --register-node=true \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"if \\$programname == 'kubelet' then \/var\/log\/kubelet.log\n& stop\" | sudo tee \/etc\/rsyslog.d\/kubelet.conf\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate etcd \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/sd{e,f,g}\nsudo vgcreate docker \/dev\/sd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"EXEC","uuid":"376f7cc1-2ab0-4e69-aa31-b86c5245b7ab","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_IPS=\"@@{AHV_Centos_K8SW.address}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"master${count}\",\n  count=$((count+1))\ndone\n\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"worker${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_NAMES},${MASTER_IPS},${MINION_NAMES},${WORKER_IPS},${FIRST_IP_SERVICE_SUBNET},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local -profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\ninstance=\"master${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=master${count}.kubeconfig\nkubectl config set-credentials system:node:master${count} --client-certificate=master${count}.pem --client-key=master${count}-key.pem --embed-certs=true --kubeconfig=master${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:master${count} --kubeconfig=master${count}.kubeconfig\nkubectl config use-context default --kubeconfig=master${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"master${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"EXEC","uuid":"838cf56b-04f7-44b1-864a-0d8fa995894a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CONFIG_PATH=\"\/etc\/kubernetes\/config\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nCONTROLLER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --enable-admission-plugins=NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\ncat <<EOF | sudo tee ${KUBE_CONFIG_PATH}\/kube-proxy-config.yaml\nkind: KubeProxyConfiguration\napiVersion: kubeproxy.config.k8s.io\/v1alpha1\nclientConnection:\n  kubeconfig: \"${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\"\nmode: \"iptables\"\nclusterCIDR: \"${CLUSTER_SUBNET}\"\niptables:\n  masqueradeAll: true\nEOF\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --config=${KUBE_CONFIG_PATH}\/kube-proxy-config.yaml\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/lib\/modules\n      name: lib-modules-host\n      readOnly: true\n    - mountPath: ${KUBE_CONFIG_PATH}\n      name: kube-config-path\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/lib\/modules\n    name: lib-modules-host\n  - hostPath:\n      path: ${KUBE_CONFIG_PATH}\n    name: kube-config-path\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masqueradeAll\/d' ${KUBE_CONFIG_PATH}\/kube-proxy-config.yaml\nfi \n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --bind-address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=${KUBE_CLUSTER_NAME}\n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n   \ncat <<EOF | sudo tee ${KUBE_CONFIG_PATH}\/kube-scheduler.yaml\napiVersion: kubescheduler.config.k8s.io\/v1alpha1\nkind: KubeSchedulerConfiguration\nclientConnection:\n  kubeconfig: \"${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\"\nleaderElection:\n  leaderElect: true\nEOF\n   \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --config=${KUBE_CONFIG_PATH}\/kube-scheduler.yaml\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: ${KUBE_CONFIG_PATH}\n      name: kube-config-path\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: ${KUBE_CONFIG_PATH}\n    name: kube-config-path\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n    \necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"EXEC","uuid":"0176e204-3e8b-4f15-ac53-bc9931a118c9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet iscsid\nsudo systemctl enable etcd docker kubelet iscsid\nsudo systemctl restart rsyslog\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem master* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"EXEC","uuid":"962d2407-d998-45d9-8f93-4753c589cfea","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ]]; then\nsudo mkdir -p \/etc\/kubernetes\/addons\/canal\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: canal-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  canal_iface: \"\"\n\n  masquerade: \"true\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: canal\n  namespace: kube-system\n  labels:\n    k8s-app: canal\nspec:\n  selector:\n    matchLabels:\n      k8s-app: canal\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: canal\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: canal\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-canal.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              value: \"none\"\n            - name: CLUSTER_TYPE\n              value: \"k8s,canal\"\n            - name: FELIX_IPTABLESREFRESHINTERVAL\n              value: \"60\"\n            - name: IP\n              value: \"\"\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"192.168.0.0\/16\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: \/readiness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n        - name: kube-flannel\n          image: quay.io\/coreos\/flannel:v0.9.1\n          command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n          securityContext:\n            privileged: true\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: FLANNELD_IFACE\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: canal_iface\n            - name: FLANNELD_IP_MASQ\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: masquerade\n          volumeMounts:\n          - mountPath: \/run\/xtables.lock\n            name: xtables-lock\n            readOnly: false\n          - name: flannel-cfg\n            mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: flannel-cfg\n          configMap:\n            name: canal-config\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: canal\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: canal-flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: canal-calico\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/canal\/canal.yml\nkubectl create -f \/etc\/kubernetes\/addons\/canal\/canal.yml\n\nelif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]];then\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/calico\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  calico_backend: \"bird\"\n\n  veth_mtu: \"1440\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: calico-node\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-calico.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CNI_MTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s,bgp\"\n            - name: IP\n              value: \"autodetect\"\n            - name: CALICO_IPV4POOL_IPIP\n              value: \"Always\"\n            - name: FELIX_IPINIPMTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"@@{KUBE_CLUSTER_SUBNET}@@\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            exec:\n              command:\n              - \/bin\/calico-node\n              - -bird-ready\n              - -felix-ready\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPPeer\n    plural: bgppeers\n    singular: bgppeer\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/calico\/calico.yml\nkubectl create -f \/etc\/kubernetes\/addons\/calico\/calico.yml  \n\nelse\n  echo \"Defaulting to flannel\"\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n  - kind: ServiceAccount\n    name: flannel\n    namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"hairpinMode\": true,\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - \/opt\/bin\/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n          limits:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/bin\/sh\", \"-c\", \"set -e -x; cp -f \/etc\/kube-flannel\/cni-conf.json \/etc\/cni\/net.d\/10-flannel.conf; while true; do sleep 3600; done\" ]\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nfi\n\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"EXEC","uuid":"bc76166c-44b1-455c-8a4d-d51a275a2622","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/coredns \necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: coredns\n  namespace: kube-system\n  labels:\n      kubernetes.io\/cluster-service: \"true\"\n      addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: rbac.authorization.k8s.io\/v1\nkind: ClusterRole\nmetadata:\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n    addonmanager.kubernetes.io\/mode: Reconcile\n  name: system:coredns\nrules:\n- apiGroups:\n  - \"\"\n  resources:\n  - endpoints\n  - services\n  - pods\n  - namespaces\n  verbs:\n  - list\n  - watch\n- apiGroups:\n  - \"\"\n  resources:\n  - nodes\n  verbs:\n  - get\n---\napiVersion: rbac.authorization.k8s.io\/v1\nkind: ClusterRoleBinding\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n    addonmanager.kubernetes.io\/mode: EnsureExists\n  name: system:coredns\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:coredns\nsubjects:\n- kind: ServiceAccount\n  name: coredns\n  namespace: kube-system\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: coredns\n  namespace: kube-system\n  labels:\n      addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  Corefile: |\n    .:53 {\n        errors\n        health\n        kubernetes cluster.local. in-addr.arpa ip6.arpa {\n            pods insecure\n            upstream\n            fallthrough in-addr.arpa ip6.arpa\n        }\n        prometheus :9153\n        forward . \/etc\/resolv.conf\n        cache 30\n        loop\n        reload\n        loadbalance\n    }\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: coredns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/name: \"CoreDNS\"\nspec:\n  strategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      serviceAccountName: coredns\n      tolerations:\n        - key: \"CriticalAddonsOnly\"\n          operator: \"Exists\"\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      containers:\n      - name: coredns\n        image: k8s.gcr.io\/coredns:1.3.1\n        imagePullPolicy: IfNotPresent\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        args: [ \"-conf\", \"\/etc\/coredns\/Corefile\" ]\n        volumeMounts:\n        - name: config-volume\n          mountPath: \/etc\/coredns\n          readOnly: true\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        - containerPort: 9153\n          name: metrics\n          protocol: TCP\n        livenessProbe:\n          httpGet:\n            path: \/health\n            port: 8080\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/health\n            port: 8080\n            scheme: HTTP\n        securityContext:\n          allowPrivilegeEscalation: false\n          capabilities:\n            add:\n            - NET_BIND_SERVICE\n            drop:\n            - all\n          readOnlyRootFilesystem: true\n      dnsPolicy: Default\n      volumes:\n        - name: config-volume\n          configMap:\n            name: coredns\n            items:\n            - key: Corefile\n              path: Corefile\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  annotations:\n    prometheus.io\/port: \"9153\"\n    prometheus.io\/scrape: \"true\"\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/name: \"CoreDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n  - name: dns\n    port: 53\n    protocol: UDP\n  - name: dns-tcp\n    port: 53\n    protocol: TCP\n  - name: metrics\n    port: 9153\n    protocol: TCP' | sudo tee \/etc\/kubernetes\/addons\/coredns\/coredns.yaml\n    \nkubectl create -f \/etc\/kubernetes\/addons\/coredns\/coredns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.2.0\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          - --target=Deployment\/coredns\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/coredns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/coredns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"EXEC","uuid":"38621149-0471-9d76-68db-f0156b4d23b0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nPRISM_CLUSTER_IP=\"@@{PE_CLUSTER_IP}@@\"\nPRISM_DATA_SERVICE_IP=\"@@{PE_CLUSTER_IP}@@\"\n\nif [[ (\"${PRISM_CLUSTER_IP}x\" == \"x\") && (\"${PRISM_DATA_SERVICE_IP}x\" == \"x\") ]]; then exit 0; fi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/volume_plugin\nNTNX_SECRET=$(echo -n \"@@{PE_USERNAME}@@:@@{PE_PASSWORD}@@\" | base64)\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: nutanixabs-provisioner-runner\n  namespace: kube-system\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumes\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumeclaims\"]\n    verbs: [\"get\", \"list\", \"watch\", \"update\"]\n  - apiGroups: [\"storage.k8s.io\"]\n    resources: [\"storageclasses\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"list\", \"watch\", \"create\", \"update\", \"patch\"]\n  - apiGroups: [\"\"]\n    resources: [\"services\"]\n    verbs: [\"get\"]\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"create\", \"delete\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: run-nutanixabs-provisioner\n  namespace: kube-system\nsubjects:\n  - kind: ServiceAccount\n    name: nutanixabs-provisioner\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: nutanixabs-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      labels:\n        app: nutanixabs-provisioner\n    spec:\n      serviceAccount: nutanixabs-provisioner\n      hostNetwork: true\n      containers:\n        -\n          image: \"ntnx\/nutanixabs-provisioner\"\n          name: nutanixabs-provisioner\n          args: [\"--v=4\"]\n          imagePullPolicy: IfNotPresent\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: kube-system\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\n---\nkind: StorageClass\napiVersion: storage.k8s.io\/v1\nmetadata:\n  name: silver \n  namespace: kube-system\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\nprovisioner: nutanix\/abs\nparameters:\n     prismEndPoint: @@{PE_CLUSTER_IP}@@:9440\n     dataServiceEndPoint: @@{PE_DATA_SERVICE_IP}@@:3260\n     secretName: ntnx-secret\n     storageContainer: @@{PE_CONTAINER_NAME}@@\n     fsType: ext4\n     chapAuthEnabled: \"false\"' | sudo tee \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\necho \"apiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: default\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\" | sudo tee -a \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"NVP Configuration"}],"description":"","message_list":[],"uuid":"90359548-587c-4ebb-8203-2d8f67ba25d0","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"dac441af_dag","uuid":"5da059ca-9790-4ec3-a9e2-0603c4351cd7"},"name":"8e760b73_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"},"retries":"0","description":"","type":"DAG","uuid":"55e668d6-c865-44da-9e1b-b33595b22f32","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6324786a_dag"}],"description":"","message_list":[],"uuid":"be04318d-ff24-4ce9-a752-08a7064ecebd","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6324786a_dag","uuid":"55e668d6-c865-44da-9e1b-b33595b22f32"},"name":"6522ac7a_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Uninstall_Crb_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41"}],"description":"","message_list":[],"uuid":"a0c65fcd-72cf-40f4-b38c-e7de5bce4776","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"84b1e41a-9030-4007-8ad4-4c45df4f4028"},"name":"SYS_GEN__Runbook_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"536ac8ac-7c51-4682-bc05-4f4471230ecf","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"},"retries":"0","description":"","type":"DAG","uuid":"82278155-6c5d-42e0-98b1-cc8fd320b317","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"2c4adbda-a1e0-434f-b5c3-60fe9db27114"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"e57953b3-101b-47da-b943-f53017964ffd"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"a37bec04-be4b-4c54-8a20-339a2b4f5ea0"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"2c4adbda-a1e0-434f-b5c3-60fe9db27114"},"edge_type":"inherent","type":"","uuid":"0301e1da-8280-46a4-8903-e2368f346499","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"e57953b3-101b-47da-b943-f53017964ffd"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"e57953b3-101b-47da-b943-f53017964ffd"},"edge_type":"inherent","type":"","uuid":"30262828-33e4-4da2-91ee-9a0905074d34","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"a37bec04-be4b-4c54-8a20-339a2b4f5ea0"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2c4adbda-a1e0-434f-b5c3-60fe9db27114","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"4fde4266-9dcc-48ff-9ff0-b3b3ff53d82c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e57953b3-101b-47da-b943-f53017964ffd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"26ce2713-05fa-4b65-ac37-579626d25b62"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a37bec04-be4b-4c54-8a20-339a2b4f5ea0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"a0c65fcd-72cf-40f4-b38c-e7de5bce4776"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41"}],"description":"","message_list":[],"uuid":"243d04da-d522-4b59-9698-ba7aa80d03bf","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"82278155-6c5d-42e0-98b1-cc8fd320b317"},"name":"SYS_GEN__Runbook_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"45e3cb9a-2788-4632-8016-62e9cd5193bf","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"},"retries":"0","description":"","type":"DAG","uuid":"c687c3f0-ab68-436f-9d27-90ceeae87f69","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"632d1a36-eb76-4c87-ba90-a0bd3530c857"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"f06e4856-3e7d-43d0-823d-78b43775ae54"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"632d1a36-eb76-4c87-ba90-a0bd3530c857"},"edge_type":"inherent","type":"","uuid":"c6228e11-b989-428b-a33e-8482cb25fc72","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"f06e4856-3e7d-43d0-823d-78b43775ae54"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"632d1a36-eb76-4c87-ba90-a0bd3530c857","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"83064c0f-b87b-4e8f-b4ae-0d9be93e1f13"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"f06e4856-3e7d-43d0-823d-78b43775ae54","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41"}],"description":"","message_list":[],"uuid":"caed2c37-83df-462c-96f6-9a8d9866e445","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"c687c3f0-ab68-436f-9d27-90ceeae87f69"},"name":"SYS_GEN__Runbook_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41"}},{"description":"System action for starting an application","message_list":[],"uuid":"db6dd1e5-808e-4fa0-a076-01ffec9434b6","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"},"retries":"0","description":"","type":"DAG","uuid":"5ab1712a-a983-4828-ad06-e388662b368a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"a94cf53f-8e4c-4343-8e8a-4aa588f4d6f0"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a94cf53f-8e4c-4343-8e8a-4aa588f4d6f0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"dfd5bd01-3ebf-47c9-9501-e21346d9e5ef"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0"}],"description":"","message_list":[],"uuid":"c743c32b-1015-4738-bc4f-c59f11b7fe36","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"5ab1712a-a983-4828-ad06-e388662b368a"},"name":"SYS_GEN__Runbook_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41"}},{"description":"System action for restarting an application","message_list":[],"uuid":"76fd3f28-692b-4b4f-a044-536b1b16773d","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"},"retries":"0","description":"","type":"DAG","uuid":"100616a3-9731-4988-a238-b6f371845491","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"21225a85-480e-4c7d-8424-2295a1fc6b2b"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"21225a85-480e-4c7d-8424-2295a1fc6b2b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"dae0b6c4-1f7d-4497-9710-8f360bc20831"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0"}],"description":"","message_list":[],"uuid":"e28d676c-3963-451d-853b-2d55992d2606","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"100616a3-9731-4988-a238-b6f371845491"},"name":"SYS_GEN__Runbook_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41"}},{"description":"System action for stopping an application","message_list":[],"uuid":"01723229-a6f6-4e60-854b-df6e6f37d28b","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"},"retries":"0","description":"","type":"DAG","uuid":"592bca2c-edc2-4122-a1c5-3950f7bc0580","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0","uuid":"6e4e9058-9a82-4bbc-8456-75a7e52e4f14"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6e4e9058-9a82-4bbc-8456-75a7e52e4f14","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"4fde4266-9dcc-48ff-9ff0-b3b3ff53d82c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_64a2dda5_481c_4a03_80cb_9cb9b954e1e0"}],"description":"","message_list":[],"uuid":"099797da-621f-493f-81ae-6dd7cc78e68b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41","uuid":"592bca2c-edc2-4122-a1c5-3950f7bc0580"},"name":"SYS_GEN__Runbook_Package_dd5a8351_d4fe_4d18_92cb_f1bcbce0fb41"}}],"message_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"}],"uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41","state":"ACTIVE","version":"","editables":{},"type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"},"retries":"0","description":"","type":"DAG","uuid":"5da059ca-9790-4ec3-a9e2-0603c4351cd7","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"eabe5f6b-5085-4bf3-89d6-e5a2efada38b"},{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"ebe27231-bc7c-4ef4-93d9-ad716bef85a6"},{"kind":"app_task","name":"Generate Certs","uuid":"376f7cc1-2ab0-4e69-aa31-b86c5245b7ab"},{"kind":"app_task","name":"Configure Services","uuid":"838cf56b-04f7-44b1-864a-0d8fa995894a"},{"kind":"app_task","name":"Add User Roles","uuid":"0176e204-3e8b-4f15-ac53-bc9931a118c9"},{"kind":"app_task","name":"Network Configuration","uuid":"962d2407-d998-45d9-8f93-4753c589cfea"},{"kind":"app_task","name":"DNS Configuration","uuid":"bc76166c-44b1-455c-8a4d-d51a275a2622"},{"kind":"app_task","name":"NVP Configuration","uuid":"38621149-0471-9d76-68db-f0156b4d23b0"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"eabe5f6b-5085-4bf3-89d6-e5a2efada38b"},"edge_type":"user_defined","type":"","uuid":"97ec3a23-dc95-4129-b687-16208661a683","to_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"ebe27231-bc7c-4ef4-93d9-ad716bef85a6"}},{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"ebe27231-bc7c-4ef4-93d9-ad716bef85a6"},"edge_type":"user_defined","type":"","uuid":"5189d82f-d25c-4546-a6b5-cd518c7edebc","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"376f7cc1-2ab0-4e69-aa31-b86c5245b7ab"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"376f7cc1-2ab0-4e69-aa31-b86c5245b7ab"},"edge_type":"user_defined","type":"","uuid":"8fa3fcd5-69dc-481d-8331-132288e42728","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"838cf56b-04f7-44b1-864a-0d8fa995894a"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"838cf56b-04f7-44b1-864a-0d8fa995894a"},"edge_type":"user_defined","type":"","uuid":"e3237e7f-ae2a-41c8-bb5d-9cfc1070eb37","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"0176e204-3e8b-4f15-ac53-bc9931a118c9"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"0176e204-3e8b-4f15-ac53-bc9931a118c9"},"edge_type":"user_defined","type":"","uuid":"1957525b-a91b-4832-97d2-0103e08c70a5","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"962d2407-d998-45d9-8f93-4753c589cfea"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"962d2407-d998-45d9-8f93-4753c589cfea"},"edge_type":"user_defined","type":"","uuid":"9874f072-49e5-4196-9687-d6bdb24c6272","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"bc76166c-44b1-455c-8a4d-d51a275a2622"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"bc76166c-44b1-455c-8a4d-d51a275a2622"},"edge_type":"user_defined","type":"","uuid":"c0c7aedf-6b39-22f0-4128-294c22a12e3c","to_task_reference":{"kind":"app_task","name":"NVP Configuration","uuid":"38621149-0471-9d76-68db-f0156b4d23b0"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"dac441af_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"eabe5f6b-5085-4bf3-89d6-e5a2efada38b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"EXEC","uuid":"ebe27231-bc7c-4ef4-93d9-ad716bef85a6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\ncount=0\n# Verify access to Centos mirror before yum update\ncheck_mirror() {\ncurl -s mirrorlist.centos.org >\/dev\/null | true\nif [ \"${PIPESTATUS[0]}\" -ne 0 ]; then\n    if [ ${count} -lt 60 ]; then\n        echo \"Sleeping for 5 seconds before repeating the check\" | sudo tee -a \/var\/log\/messages\n        sleep 5\n        count=$((count+1))\n        check_mirror\n    else\n        echo \"DNS resolution failed after 5 minutes, exiting\" | sudo tee -a \/var\/log\/messages\n        exit 1\n    fi\nfi\n}\ncheck_mirror\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.3.12\"\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_IPS=\"@@{AHV_Centos_K8SW.address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_CONFIG_PATH=\"\/etc\/kubernetes\/config\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CONFIG_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} master${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"master${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  count=$((count+1))\ndone  \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\necho \"if \\$programname == 'etcd' then \/var\/log\/etcd.log\n& stop\" | sudo tee \/etc\/rsyslog.d\/etcd.conf\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-*.tgz\n\ncat <<EOF | sudo tee ${KUBE_CONFIG_PATH}\/kubelet-config.yaml\nkind: KubeletConfiguration\napiVersion: kubelet.config.k8s.io\/v1beta1\nauthentication:\n  anonymous:\n    enabled: false\n  webhook:\n    enabled: true\n  x509:\n    clientCAFile: \"${KUBE_CERT_PATH}\/ca.pem\"\nauthorization:\n  mode: Webhook\nclusterDomain: \"cluster.local\"\nclusterDNS:\n  - \"${KUBE_CLUSTER_DNS}\"\nstaticPodPath: \"${KUBE_MANIFEST_PATH}\"\npodCIDR: \"${CLUSTER_SUBNET}\"\nruntimeRequestTimeout: \"10m\"\ntlsCertFile: \"${KUBE_CERT_PATH}\/${NODE_NAME}.pem\"\ntlsPrivateKeyFile: \"${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem\"\nreadOnlyPort: 0\nprotectKernelDefaults: false\nmakeIPTablesUtilChains: true\neventRecordQPS: 0\nkubeletCgroups: \"\/systemd\/system.slice\"\nEOF\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --config=${KUBE_CONFIG_PATH}\/kubelet-config.yaml \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --register-node=true \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"if \\$programname == 'kubelet' then \/var\/log\/kubelet.log\n& stop\" | sudo tee \/etc\/rsyslog.d\/kubelet.conf\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate etcd \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/sd{e,f,g}\nsudo vgcreate docker \/dev\/sd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"EXEC","uuid":"376f7cc1-2ab0-4e69-aa31-b86c5245b7ab","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_IPS=\"@@{AHV_Centos_K8SW.address}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"master${count}\",\n  count=$((count+1))\ndone\n\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"worker${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_NAMES},${MASTER_IPS},${MINION_NAMES},${WORKER_IPS},${FIRST_IP_SERVICE_SUBNET},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local -profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\ninstance=\"master${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=master${count}.kubeconfig\nkubectl config set-credentials system:node:master${count} --client-certificate=master${count}.pem --client-key=master${count}-key.pem --embed-certs=true --kubeconfig=master${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:master${count} --kubeconfig=master${count}.kubeconfig\nkubectl config use-context default --kubeconfig=master${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"master${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"EXEC","uuid":"838cf56b-04f7-44b1-864a-0d8fa995894a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CONFIG_PATH=\"\/etc\/kubernetes\/config\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nCONTROLLER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --enable-admission-plugins=NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\ncat <<EOF | sudo tee ${KUBE_CONFIG_PATH}\/kube-proxy-config.yaml\nkind: KubeProxyConfiguration\napiVersion: kubeproxy.config.k8s.io\/v1alpha1\nclientConnection:\n  kubeconfig: \"${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\"\nmode: \"iptables\"\nclusterCIDR: \"${CLUSTER_SUBNET}\"\niptables:\n  masqueradeAll: true\nEOF\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --config=${KUBE_CONFIG_PATH}\/kube-proxy-config.yaml\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/lib\/modules\n      name: lib-modules-host\n      readOnly: true\n    - mountPath: ${KUBE_CONFIG_PATH}\n      name: kube-config-path\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/lib\/modules\n    name: lib-modules-host\n  - hostPath:\n      path: ${KUBE_CONFIG_PATH}\n    name: kube-config-path\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masqueradeAll\/d' ${KUBE_CONFIG_PATH}\/kube-proxy-config.yaml\nfi \n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --bind-address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=${KUBE_CLUSTER_NAME}\n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n   \ncat <<EOF | sudo tee ${KUBE_CONFIG_PATH}\/kube-scheduler.yaml\napiVersion: kubescheduler.config.k8s.io\/v1alpha1\nkind: KubeSchedulerConfiguration\nclientConnection:\n  kubeconfig: \"${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\"\nleaderElection:\n  leaderElect: true\nEOF\n   \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --config=${KUBE_CONFIG_PATH}\/kube-scheduler.yaml\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: ${KUBE_CONFIG_PATH}\n      name: kube-config-path\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: ${KUBE_CONFIG_PATH}\n    name: kube-config-path\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n    \necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"EXEC","uuid":"0176e204-3e8b-4f15-ac53-bc9931a118c9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet iscsid\nsudo systemctl enable etcd docker kubelet iscsid\nsudo systemctl restart rsyslog\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem master* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"EXEC","uuid":"962d2407-d998-45d9-8f93-4753c589cfea","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ]]; then\nsudo mkdir -p \/etc\/kubernetes\/addons\/canal\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: canal-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  canal_iface: \"\"\n\n  masquerade: \"true\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: canal\n  namespace: kube-system\n  labels:\n    k8s-app: canal\nspec:\n  selector:\n    matchLabels:\n      k8s-app: canal\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: canal\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: canal\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-canal.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              value: \"none\"\n            - name: CLUSTER_TYPE\n              value: \"k8s,canal\"\n            - name: FELIX_IPTABLESREFRESHINTERVAL\n              value: \"60\"\n            - name: IP\n              value: \"\"\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"192.168.0.0\/16\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: \/readiness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n        - name: kube-flannel\n          image: quay.io\/coreos\/flannel:v0.9.1\n          command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n          securityContext:\n            privileged: true\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: FLANNELD_IFACE\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: canal_iface\n            - name: FLANNELD_IP_MASQ\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: masquerade\n          volumeMounts:\n          - mountPath: \/run\/xtables.lock\n            name: xtables-lock\n            readOnly: false\n          - name: flannel-cfg\n            mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: flannel-cfg\n          configMap:\n            name: canal-config\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: canal\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: canal-flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: canal-calico\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/canal\/canal.yml\nkubectl create -f \/etc\/kubernetes\/addons\/canal\/canal.yml\n\nelif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]];then\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/calico\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  calico_backend: \"bird\"\n\n  veth_mtu: \"1440\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: calico-node\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-calico.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CNI_MTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s,bgp\"\n            - name: IP\n              value: \"autodetect\"\n            - name: CALICO_IPV4POOL_IPIP\n              value: \"Always\"\n            - name: FELIX_IPINIPMTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"@@{KUBE_CLUSTER_SUBNET}@@\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            exec:\n              command:\n              - \/bin\/calico-node\n              - -bird-ready\n              - -felix-ready\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPPeer\n    plural: bgppeers\n    singular: bgppeer\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/calico\/calico.yml\nkubectl create -f \/etc\/kubernetes\/addons\/calico\/calico.yml  \n\nelse\n  echo \"Defaulting to flannel\"\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n  - kind: ServiceAccount\n    name: flannel\n    namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"hairpinMode\": true,\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - \/opt\/bin\/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n          limits:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/bin\/sh\", \"-c\", \"set -e -x; cp -f \/etc\/kube-flannel\/cni-conf.json \/etc\/cni\/net.d\/10-flannel.conf; while true; do sleep 3600; done\" ]\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nfi\n\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"EXEC","uuid":"bc76166c-44b1-455c-8a4d-d51a275a2622","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/coredns \necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: coredns\n  namespace: kube-system\n  labels:\n      kubernetes.io\/cluster-service: \"true\"\n      addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: rbac.authorization.k8s.io\/v1\nkind: ClusterRole\nmetadata:\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n    addonmanager.kubernetes.io\/mode: Reconcile\n  name: system:coredns\nrules:\n- apiGroups:\n  - \"\"\n  resources:\n  - endpoints\n  - services\n  - pods\n  - namespaces\n  verbs:\n  - list\n  - watch\n- apiGroups:\n  - \"\"\n  resources:\n  - nodes\n  verbs:\n  - get\n---\napiVersion: rbac.authorization.k8s.io\/v1\nkind: ClusterRoleBinding\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n    addonmanager.kubernetes.io\/mode: EnsureExists\n  name: system:coredns\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:coredns\nsubjects:\n- kind: ServiceAccount\n  name: coredns\n  namespace: kube-system\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: coredns\n  namespace: kube-system\n  labels:\n      addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  Corefile: |\n    .:53 {\n        errors\n        health\n        kubernetes cluster.local. in-addr.arpa ip6.arpa {\n            pods insecure\n            upstream\n            fallthrough in-addr.arpa ip6.arpa\n        }\n        prometheus :9153\n        forward . \/etc\/resolv.conf\n        cache 30\n        loop\n        reload\n        loadbalance\n    }\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: coredns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/name: \"CoreDNS\"\nspec:\n  strategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      serviceAccountName: coredns\n      tolerations:\n        - key: \"CriticalAddonsOnly\"\n          operator: \"Exists\"\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      containers:\n      - name: coredns\n        image: k8s.gcr.io\/coredns:1.3.1\n        imagePullPolicy: IfNotPresent\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        args: [ \"-conf\", \"\/etc\/coredns\/Corefile\" ]\n        volumeMounts:\n        - name: config-volume\n          mountPath: \/etc\/coredns\n          readOnly: true\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        - containerPort: 9153\n          name: metrics\n          protocol: TCP\n        livenessProbe:\n          httpGet:\n            path: \/health\n            port: 8080\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/health\n            port: 8080\n            scheme: HTTP\n        securityContext:\n          allowPrivilegeEscalation: false\n          capabilities:\n            add:\n            - NET_BIND_SERVICE\n            drop:\n            - all\n          readOnlyRootFilesystem: true\n      dnsPolicy: Default\n      volumes:\n        - name: config-volume\n          configMap:\n            name: coredns\n            items:\n            - key: Corefile\n              path: Corefile\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  annotations:\n    prometheus.io\/port: \"9153\"\n    prometheus.io\/scrape: \"true\"\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/name: \"CoreDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n  - name: dns\n    port: 53\n    protocol: UDP\n  - name: dns-tcp\n    port: 53\n    protocol: TCP\n  - name: metrics\n    port: 9153\n    protocol: TCP' | sudo tee \/etc\/kubernetes\/addons\/coredns\/coredns.yaml\n    \nkubectl create -f \/etc\/kubernetes\/addons\/coredns\/coredns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.2.0\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          - --target=Deployment\/coredns\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/coredns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/coredns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","description":"","type":"EXEC","uuid":"38621149-0471-9d76-68db-f0156b4d23b0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nPRISM_CLUSTER_IP=\"@@{PE_CLUSTER_IP}@@\"\nPRISM_DATA_SERVICE_IP=\"@@{PE_CLUSTER_IP}@@\"\n\nif [[ (\"${PRISM_CLUSTER_IP}x\" == \"x\") && (\"${PRISM_DATA_SERVICE_IP}x\" == \"x\") ]]; then exit 0; fi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/volume_plugin\nNTNX_SECRET=$(echo -n \"@@{PE_USERNAME}@@:@@{PE_PASSWORD}@@\" | base64)\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: nutanixabs-provisioner-runner\n  namespace: kube-system\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumes\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumeclaims\"]\n    verbs: [\"get\", \"list\", \"watch\", \"update\"]\n  - apiGroups: [\"storage.k8s.io\"]\n    resources: [\"storageclasses\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"list\", \"watch\", \"create\", \"update\", \"patch\"]\n  - apiGroups: [\"\"]\n    resources: [\"services\"]\n    verbs: [\"get\"]\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"create\", \"delete\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: run-nutanixabs-provisioner\n  namespace: kube-system\nsubjects:\n  - kind: ServiceAccount\n    name: nutanixabs-provisioner\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: nutanixabs-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      labels:\n        app: nutanixabs-provisioner\n    spec:\n      serviceAccount: nutanixabs-provisioner\n      hostNetwork: true\n      containers:\n        -\n          image: \"ntnx\/nutanixabs-provisioner\"\n          name: nutanixabs-provisioner\n          args: [\"--v=4\"]\n          imagePullPolicy: IfNotPresent\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: kube-system\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\n---\nkind: StorageClass\napiVersion: storage.k8s.io\/v1\nmetadata:\n  name: silver \n  namespace: kube-system\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\nprovisioner: nutanix\/abs\nparameters:\n     prismEndPoint: @@{PE_CLUSTER_IP}@@:9440\n     dataServiceEndPoint: @@{PE_DATA_SERVICE_IP}@@:3260\n     secretName: ntnx-secret\n     storageContainer: @@{PE_CONTAINER_NAME}@@\n     fsType: ext4\n     chapAuthEnabled: \"false\"' | sudo tee \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\necho \"apiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: default\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\" | sudo tee -a \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"NVP Configuration"}],"description":"","message_list":[],"uuid":"90359548-587c-4ebb-8203-2d8f67ba25d0","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"dac441af_dag","uuid":"5da059ca-9790-4ec3-a9e2-0603c4351cd7"},"name":"8e760b73_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"},"retries":"0","description":"","type":"DAG","uuid":"55e668d6-c865-44da-9e1b-b33595b22f32","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6324786a_dag"}],"description":"","message_list":[],"uuid":"be04318d-ff24-4ce9-a752-08a7064ecebd","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6324786a_dag","uuid":"55e668d6-c865-44da-9e1b-b33595b22f32"},"name":"6522ac7a_runbook"}},"variable_list":[],"name":"AHV_Centos_K8SM_Package"},{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"b1869f43-6d55-468d-8792-31dc3e7c2fb7","name":"action_install","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"},"retries":"0","description":"","type":"DAG","uuid":"e80def7d-622d-4d97-8f65-fc65365ffc96","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Install_Crb_99092116_88f3_49fd_81d3_15220edf6824","uuid":"ab5df8f7-69f6-48e5-8238-6f3686482c6d"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_99092116_88f3_49fd_81d3_15220edf6824"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_INSTALL","uuid":"ab5df8f7-69f6-48e5-8238-6f3686482c6d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"},"retries":"0","description":"","type":"DAG","uuid":"420e79e4-fb92-45ea-846a-f98e9712c902","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"e0ecec97-6c96-4ef8-927c-eb3a4b24d618"},{"kind":"app_task","name":"Docker Kubelet Install","uuid":"526a6a44-f0ef-4558-9c41-44e5005ca5f8"},{"kind":"app_task","name":"GetCerts","uuid":"6b1c7b2a-f14e-4e89-f18b-6ae7fd5e130d"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"e0ecec97-6c96-4ef8-927c-eb3a4b24d618"},"edge_type":"user_defined","type":"","uuid":"263b0ae0-ac56-4734-88d9-5cfb1d6e7b3a","to_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"526a6a44-f0ef-4558-9c41-44e5005ca5f8"}},{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"526a6a44-f0ef-4558-9c41-44e5005ca5f8"},"edge_type":"user_defined","type":"","uuid":"37561b9b-dc31-f40f-0f61-08e5f36b6a3c","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"6b1c7b2a-f14e-4e89-f18b-6ae7fd5e130d"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"c1566b3d_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"e0ecec97-6c96-4ef8-927c-eb3a4b24d618","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"EXEC","uuid":"526a6a44-f0ef-4558-9c41-44e5005ca5f8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\ncount=0\n# Verify access to Centos mirror before yum update\ncheck_mirror() {\ncurl -s mirrorlist.centos.org >\/dev\/null | true\nif [ \"${PIPESTATUS[0]}\" -ne 0 ]; then\n    if [ ${count} -lt 60 ]; then\n        echo \"Sleeping for 5 seconds before repeating the check\"\n        sleep 5\n        count=$((count+1))\n        check_mirror\n    else\n        echo \"DNS resolution failed after 5 minutes, exiting\"\n        exit 1\n    fi\nfi\n}\ncheck_mirror\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CONFIG_PATH=\"\/etc\/kubernetes\/config\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH} ${KUBE_CONFIG_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-*.tgz\n\ncat <<EOF | sudo tee ${KUBE_CONFIG_PATH}\/kubelet-config.yaml\nkind: KubeletConfiguration\napiVersion: kubelet.config.k8s.io\/v1beta1\nauthentication:\n  anonymous:\n    enabled: false\n  webhook:\n    enabled: true\n  x509:\n    clientCAFile: \"${KUBE_CERT_PATH}\/ca.pem\"\nauthorization:\n  mode: Webhook\nclusterDomain: \"cluster.local\"\nclusterDNS:\n  - \"${KUBE_CLUSTER_DNS}\"\nstaticPodPath: \"${KUBE_MANIFEST_PATH}\"\npodCIDR: \"${CLUSTER_SUBNET}\"\nruntimeRequestTimeout: \"10m\"\ntlsCertFile: \"${KUBE_CERT_PATH}\/${NODE_NAME}.pem\"\ntlsPrivateKeyFile: \"${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem\"\nreadOnlyPort: 0\nprotectKernelDefaults: false\nmakeIPTablesUtilChains: true\neventRecordQPS: 0\nkubeletCgroups: \"\/systemd\/system.slice\"\nevictionHard:\n  memory.available: \"200Mi\"\n  nodefs.available:  \"10%\"\n  nodefs.inodesFree: \"5%\"\nEOF\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --config=${KUBE_CONFIG_PATH}\/kubelet-config.yaml \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --register-node=true \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"if \\$programname == 'kubelet' then \/var\/log\/kubelet.log\n& stop\" | sudo tee \/etc\/rsyslog.d\/kubelet.conf\n\ncat <<EOF | sudo tee ${KUBE_CONFIG_PATH}\/kube-proxy-config.yaml\nkind: KubeProxyConfiguration\napiVersion: kubeproxy.config.k8s.io\/v1alpha1\nclientConnection:\n  kubeconfig: \"${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\"\nmode: \"iptables\"\nclusterCIDR: \"${CLUSTER_SUBNET}\"\niptables:\n  masqueradeAll: true\nEOF\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --config=${KUBE_CONFIG_PATH}\/kube-proxy-config.yaml\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/lib\/modules\n      name: lib-modules-host\n      readOnly: true\n    - mountPath: ${KUBE_CONFIG_PATH}\n      name: kube-config-path\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/lib\/modules\n    name: lib-modules-host\n  - hostPath:\n      path: ${KUBE_CONFIG_PATH}\n    name: kube-config-path\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masqueradeAll\/d' ${KUBE_CONFIG_PATH}\/kube-proxy-config.yaml\nfi \n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"EXEC","uuid":"6b1c7b2a-f14e-4e89-f18b-6ae7fd5e130d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{AHV_Centos_K8SM.address[0]}@@\"\nINSTANCE_IP=\"@@{address}@@\"\ninstance=\"worker@@{calm_array_index}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nsudo systemctl start iscsid\nsudo systemctl restart rsyslog\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; if [[ $count -eq 600 ]]; then echo \"failed to download certs\" && exit 1; fi; count=$(($count+5)) ; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${instance} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${instance} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"877193d4-5eb9-44b0-8429-10e00c9ddb30","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"c1566b3d_dag","uuid":"420e79e4-fb92-45ea-846a-f98e9712c902"},"name":"9a6e189b_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"},"retries":"0","description":"","type":"DAG","uuid":"1f7496d5-7ba0-4e06-a2f5-210cb8af0797","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"6dfc257b-10e4-4a8b-a480-c3aef4829f35"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"abd3357c_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"EXEC","uuid":"6dfc257b-10e4-4a8b-a480-c3aef4829f35","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain 'worker@@{calm_array_index}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node 'worker@@{calm_array_index}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"61dcd773-5492-4877-9837-e8ed32e4cea3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"abd3357c_dag","uuid":"1f7496d5-7ba0-4e06-a2f5-210cb8af0797"},"name":"3cb17acf_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Install_Crb_99092116_88f3_49fd_81d3_15220edf6824"}],"description":"","message_list":[],"uuid":"2972cfc3-804b-49db-ace6-db5748a9201d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"e80def7d-622d-4d97-8f65-fc65365ffc96"},"name":"SYS_GEN__Runbook_Package_99092116_88f3_49fd_81d3_15220edf6824"}},{"description":"System action for creating an application","message_list":[],"uuid":"2372d88e-a7bf-4bcd-b7a6-9015cbc1e233","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"},"retries":"0","description":"","type":"DAG","uuid":"863d11b2-25a4-4138-953a-fa747a7cdce0","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"c3d7c5f2-c705-4ee5-bcda-816cb600f715"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"2102260a-3591-45b5-9e0c-fb313ef9e7c1"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"bb848fa0-a9bd-4a86-a98a-394e4eb6c301"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"2102260a-3591-45b5-9e0c-fb313ef9e7c1"},"edge_type":"inherent","type":"","uuid":"8104aef7-e3fb-4ac1-8fce-68737f94f004","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"bb848fa0-a9bd-4a86-a98a-394e4eb6c301"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"c3d7c5f2-c705-4ee5-bcda-816cb600f715"},"edge_type":"inherent","type":"","uuid":"ea017d78-832a-4fb8-b1f1-7e2c72b4ff60","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"2102260a-3591-45b5-9e0c-fb313ef9e7c1"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_99092116_88f3_49fd_81d3_15220edf6824"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c3d7c5f2-c705-4ee5-bcda-816cb600f715","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"2972cfc3-804b-49db-ace6-db5748a9201d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_99092116_88f3_49fd_81d3_15220edf6824"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2102260a-3591-45b5-9e0c-fb313ef9e7c1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"9bd65d16-65b7-45ae-99ab-298f6f137505"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"bb848fa0-a9bd-4a86-a98a-394e4eb6c301","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"d2212910-a48e-4c21-96d4-009c61505cad"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517"}],"description":"","message_list":[],"uuid":"3e5d1b88-be4e-41ff-aee4-ebdfb6a9eb27","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"863d11b2-25a4-4138-953a-fa747a7cdce0"},"name":"SYS_GEN__Runbook_Package_99092116_88f3_49fd_81d3_15220edf6824"}},{"description":"System action for uninstalling an application","message_list":[],"uuid":"fd1319b5-a7c6-4272-85bd-48b563b55433","name":"action_uninstall","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"},"retries":"0","description":"","type":"DAG","uuid":"bd480eab-586a-4868-8b82-69f7146558f9","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Uninstall_Crb_99092116_88f3_49fd_81d3_15220edf6824","uuid":"758b1b4f-3a3d-4a24-ab0c-a8bd033bb1ca"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_99092116_88f3_49fd_81d3_15220edf6824"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_UNINSTALL","uuid":"758b1b4f-3a3d-4a24-ab0c-a8bd033bb1ca","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"},"retries":"0","description":"","type":"DAG","uuid":"420e79e4-fb92-45ea-846a-f98e9712c902","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"e0ecec97-6c96-4ef8-927c-eb3a4b24d618"},{"kind":"app_task","name":"Docker Kubelet Install","uuid":"526a6a44-f0ef-4558-9c41-44e5005ca5f8"},{"kind":"app_task","name":"GetCerts","uuid":"6b1c7b2a-f14e-4e89-f18b-6ae7fd5e130d"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"e0ecec97-6c96-4ef8-927c-eb3a4b24d618"},"edge_type":"user_defined","type":"","uuid":"263b0ae0-ac56-4734-88d9-5cfb1d6e7b3a","to_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"526a6a44-f0ef-4558-9c41-44e5005ca5f8"}},{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"526a6a44-f0ef-4558-9c41-44e5005ca5f8"},"edge_type":"user_defined","type":"","uuid":"37561b9b-dc31-f40f-0f61-08e5f36b6a3c","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"6b1c7b2a-f14e-4e89-f18b-6ae7fd5e130d"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"c1566b3d_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"e0ecec97-6c96-4ef8-927c-eb3a4b24d618","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"EXEC","uuid":"526a6a44-f0ef-4558-9c41-44e5005ca5f8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\ncount=0\n# Verify access to Centos mirror before yum update\ncheck_mirror() {\ncurl -s mirrorlist.centos.org >\/dev\/null | true\nif [ \"${PIPESTATUS[0]}\" -ne 0 ]; then\n    if [ ${count} -lt 60 ]; then\n        echo \"Sleeping for 5 seconds before repeating the check\"\n        sleep 5\n        count=$((count+1))\n        check_mirror\n    else\n        echo \"DNS resolution failed after 5 minutes, exiting\"\n        exit 1\n    fi\nfi\n}\ncheck_mirror\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CONFIG_PATH=\"\/etc\/kubernetes\/config\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH} ${KUBE_CONFIG_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-*.tgz\n\ncat <<EOF | sudo tee ${KUBE_CONFIG_PATH}\/kubelet-config.yaml\nkind: KubeletConfiguration\napiVersion: kubelet.config.k8s.io\/v1beta1\nauthentication:\n  anonymous:\n    enabled: false\n  webhook:\n    enabled: true\n  x509:\n    clientCAFile: \"${KUBE_CERT_PATH}\/ca.pem\"\nauthorization:\n  mode: Webhook\nclusterDomain: \"cluster.local\"\nclusterDNS:\n  - \"${KUBE_CLUSTER_DNS}\"\nstaticPodPath: \"${KUBE_MANIFEST_PATH}\"\npodCIDR: \"${CLUSTER_SUBNET}\"\nruntimeRequestTimeout: \"10m\"\ntlsCertFile: \"${KUBE_CERT_PATH}\/${NODE_NAME}.pem\"\ntlsPrivateKeyFile: \"${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem\"\nreadOnlyPort: 0\nprotectKernelDefaults: false\nmakeIPTablesUtilChains: true\neventRecordQPS: 0\nkubeletCgroups: \"\/systemd\/system.slice\"\nevictionHard:\n  memory.available: \"200Mi\"\n  nodefs.available:  \"10%\"\n  nodefs.inodesFree: \"5%\"\nEOF\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --config=${KUBE_CONFIG_PATH}\/kubelet-config.yaml \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --register-node=true \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"if \\$programname == 'kubelet' then \/var\/log\/kubelet.log\n& stop\" | sudo tee \/etc\/rsyslog.d\/kubelet.conf\n\ncat <<EOF | sudo tee ${KUBE_CONFIG_PATH}\/kube-proxy-config.yaml\nkind: KubeProxyConfiguration\napiVersion: kubeproxy.config.k8s.io\/v1alpha1\nclientConnection:\n  kubeconfig: \"${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\"\nmode: \"iptables\"\nclusterCIDR: \"${CLUSTER_SUBNET}\"\niptables:\n  masqueradeAll: true\nEOF\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --config=${KUBE_CONFIG_PATH}\/kube-proxy-config.yaml\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/lib\/modules\n      name: lib-modules-host\n      readOnly: true\n    - mountPath: ${KUBE_CONFIG_PATH}\n      name: kube-config-path\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/lib\/modules\n    name: lib-modules-host\n  - hostPath:\n      path: ${KUBE_CONFIG_PATH}\n    name: kube-config-path\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masqueradeAll\/d' ${KUBE_CONFIG_PATH}\/kube-proxy-config.yaml\nfi \n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"EXEC","uuid":"6b1c7b2a-f14e-4e89-f18b-6ae7fd5e130d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{AHV_Centos_K8SM.address[0]}@@\"\nINSTANCE_IP=\"@@{address}@@\"\ninstance=\"worker@@{calm_array_index}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nsudo systemctl start iscsid\nsudo systemctl restart rsyslog\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; if [[ $count -eq 600 ]]; then echo \"failed to download certs\" && exit 1; fi; count=$(($count+5)) ; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${instance} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${instance} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"877193d4-5eb9-44b0-8429-10e00c9ddb30","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"c1566b3d_dag","uuid":"420e79e4-fb92-45ea-846a-f98e9712c902"},"name":"9a6e189b_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"},"retries":"0","description":"","type":"DAG","uuid":"1f7496d5-7ba0-4e06-a2f5-210cb8af0797","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"6dfc257b-10e4-4a8b-a480-c3aef4829f35"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"abd3357c_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"EXEC","uuid":"6dfc257b-10e4-4a8b-a480-c3aef4829f35","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain 'worker@@{calm_array_index}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node 'worker@@{calm_array_index}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"61dcd773-5492-4877-9837-e8ed32e4cea3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"abd3357c_dag","uuid":"1f7496d5-7ba0-4e06-a2f5-210cb8af0797"},"name":"3cb17acf_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Uninstall_Crb_99092116_88f3_49fd_81d3_15220edf6824"}],"description":"","message_list":[],"uuid":"3b9dfc22-8db7-42ff-864f-f70d6a4dda3d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"bd480eab-586a-4868-8b82-69f7146558f9"},"name":"SYS_GEN__Runbook_Package_99092116_88f3_49fd_81d3_15220edf6824"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"ace663c2-0c77-433c-96f7-ba74265dae48","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"},"retries":"0","description":"","type":"DAG","uuid":"ef9f4145-bf77-4972-b67b-ffff673215ac","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"40963fee-8c67-44d9-b232-7d61752feb44"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"47fa098b-6a3c-43c9-a4aa-58c89c8c13bd"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"1b6c11be-e99d-415e-a5a1-015662c06e40"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"40963fee-8c67-44d9-b232-7d61752feb44"},"edge_type":"inherent","type":"","uuid":"5180462a-0d0c-44d9-b755-e16996ec1fd1","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"47fa098b-6a3c-43c9-a4aa-58c89c8c13bd"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"47fa098b-6a3c-43c9-a4aa-58c89c8c13bd"},"edge_type":"inherent","type":"","uuid":"a0bc8c09-2f7b-48ea-a9ce-c86c9923c05c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"1b6c11be-e99d-415e-a5a1-015662c06e40"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_99092116_88f3_49fd_81d3_15220edf6824"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"40963fee-8c67-44d9-b232-7d61752feb44","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"b769d338-4161-4626-972a-7c9bcf413eac"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"47fa098b-6a3c-43c9-a4aa-58c89c8c13bd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"09962a62-e984-4f41-bd3f-98968b698ac0"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1b6c11be-e99d-415e-a5a1-015662c06e40","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"3b9dfc22-8db7-42ff-864f-f70d6a4dda3d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_99092116_88f3_49fd_81d3_15220edf6824"}],"description":"","message_list":[],"uuid":"b83c6fcd-8b31-46ff-8983-12917c708d56","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"ef9f4145-bf77-4972-b67b-ffff673215ac"},"name":"SYS_GEN__Runbook_Package_99092116_88f3_49fd_81d3_15220edf6824"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"95f3ebd4-fbc8-4017-a825-ea7bdc83b549","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"},"retries":"0","description":"","type":"DAG","uuid":"94ca1a48-9412-4adf-9721-683e3698b59a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"e621e718-fe15-407c-b4a4-935fa1effc6b"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_99092116_88f3_49fd_81d3_15220edf6824","uuid":"19a259cc-9a69-4040-a559-7ebf7b90aeae"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"e621e718-fe15-407c-b4a4-935fa1effc6b"},"edge_type":"inherent","type":"","uuid":"e75cbd3e-67cc-4d24-90b5-115fc49d3d3b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_99092116_88f3_49fd_81d3_15220edf6824","uuid":"19a259cc-9a69-4040-a559-7ebf7b90aeae"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_99092116_88f3_49fd_81d3_15220edf6824"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e621e718-fe15-407c-b4a4-935fa1effc6b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"b28fd8da-c23e-45fb-86d4-4f1f6222b794"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"19a259cc-9a69-4040-a559-7ebf7b90aeae","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_99092116_88f3_49fd_81d3_15220edf6824"}],"description":"","message_list":[],"uuid":"3a65a43d-4f4d-4a42-b5c5-2543e8a01184","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"94ca1a48-9412-4adf-9721-683e3698b59a"},"name":"SYS_GEN__Runbook_Package_99092116_88f3_49fd_81d3_15220edf6824"}},{"description":"System action for starting an application","message_list":[],"uuid":"d9904fd5-88b6-4cca-87b6-029d04bdee55","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"},"retries":"0","description":"","type":"DAG","uuid":"7686bd4a-f289-483c-9231-82eec730bab7","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"5f5f7199-6084-4187-b287-18114bce03a7"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_99092116_88f3_49fd_81d3_15220edf6824"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5f5f7199-6084-4187-b287-18114bce03a7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"d2212910-a48e-4c21-96d4-009c61505cad"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517"}],"description":"","message_list":[],"uuid":"37419dbc-efb2-4074-a2d9-ce1d39befe2e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"7686bd4a-f289-483c-9231-82eec730bab7"},"name":"SYS_GEN__Runbook_Package_99092116_88f3_49fd_81d3_15220edf6824"}},{"description":"System action for restarting an application","message_list":[],"uuid":"6182a936-e215-4c69-9e90-39e8be8ead7a","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"},"retries":"0","description":"","type":"DAG","uuid":"dd423944-8b98-4657-9284-ceab2a223460","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"6fbc774d-b334-43b8-9fd2-2bedbe08e472"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_99092116_88f3_49fd_81d3_15220edf6824"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6fbc774d-b334-43b8-9fd2-2bedbe08e472","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"cd09b8ce-f3e9-43e8-a843-6623eb53b961"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517"}],"description":"","message_list":[],"uuid":"b4aa67d1-e779-49ff-8541-8c84d906fbb1","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"dd423944-8b98-4657-9284-ceab2a223460"},"name":"SYS_GEN__Runbook_Package_99092116_88f3_49fd_81d3_15220edf6824"}},{"description":"System action for stopping an application","message_list":[],"uuid":"62f81ad6-8cc8-4a68-900b-853f3fd03d82","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"},"retries":"0","description":"","type":"DAG","uuid":"a3d0a471-1ecf-49f7-9b56-174f0b423c98","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517","uuid":"b6f16a28-cb0c-4e9b-899f-ff7483c91011"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_99092116_88f3_49fd_81d3_15220edf6824"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b6f16a28-cb0c-4e9b-899f-ff7483c91011","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"b769d338-4161-4626-972a-7c9bcf413eac"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_d59081fe_18e1_4b9b_a76e_a674108df517"}],"description":"","message_list":[],"uuid":"f81040b4-24ff-4749-bc86-cbbb19265da3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_99092116_88f3_49fd_81d3_15220edf6824","uuid":"a3d0a471-1ecf-49f7-9b56-174f0b423c98"},"name":"SYS_GEN__Runbook_Package_99092116_88f3_49fd_81d3_15220edf6824"}}],"message_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"}],"uuid":"99092116-88f3-49fd-81d3-15220edf6824","state":"ACTIVE","version":"","editables":{},"type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"},"retries":"0","description":"","type":"DAG","uuid":"420e79e4-fb92-45ea-846a-f98e9712c902","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Kubernetes Version","uuid":"e0ecec97-6c96-4ef8-927c-eb3a4b24d618"},{"kind":"app_task","name":"Docker Kubelet Install","uuid":"526a6a44-f0ef-4558-9c41-44e5005ca5f8"},{"kind":"app_task","name":"GetCerts","uuid":"6b1c7b2a-f14e-4e89-f18b-6ae7fd5e130d"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Kubernetes Version","uuid":"e0ecec97-6c96-4ef8-927c-eb3a4b24d618"},"edge_type":"user_defined","type":"","uuid":"263b0ae0-ac56-4734-88d9-5cfb1d6e7b3a","to_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"526a6a44-f0ef-4558-9c41-44e5005ca5f8"}},{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"526a6a44-f0ef-4558-9c41-44e5005ca5f8"},"edge_type":"user_defined","type":"","uuid":"37561b9b-dc31-f40f-0f61-08e5f36b6a3c","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"6b1c7b2a-f14e-4e89-f18b-6ae7fd5e130d"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"c1566b3d_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"e0ecec97-6c96-4ef8-927c-eb3a4b24d618","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Kubernetes Version"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"EXEC","uuid":"526a6a44-f0ef-4558-9c41-44e5005ca5f8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\ncount=0\n# Verify access to Centos mirror before yum update\ncheck_mirror() {\ncurl -s mirrorlist.centos.org >\/dev\/null | true\nif [ \"${PIPESTATUS[0]}\" -ne 0 ]; then\n    if [ ${count} -lt 60 ]; then\n        echo \"Sleeping for 5 seconds before repeating the check\"\n        sleep 5\n        count=$((count+1))\n        check_mirror\n    else\n        echo \"DNS resolution failed after 5 minutes, exiting\"\n        exit 1\n    fi\nfi\n}\ncheck_mirror\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CONFIG_PATH=\"\/etc\/kubernetes\/config\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH} ${KUBE_CONFIG_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-*.tgz\n\ncat <<EOF | sudo tee ${KUBE_CONFIG_PATH}\/kubelet-config.yaml\nkind: KubeletConfiguration\napiVersion: kubelet.config.k8s.io\/v1beta1\nauthentication:\n  anonymous:\n    enabled: false\n  webhook:\n    enabled: true\n  x509:\n    clientCAFile: \"${KUBE_CERT_PATH}\/ca.pem\"\nauthorization:\n  mode: Webhook\nclusterDomain: \"cluster.local\"\nclusterDNS:\n  - \"${KUBE_CLUSTER_DNS}\"\nstaticPodPath: \"${KUBE_MANIFEST_PATH}\"\npodCIDR: \"${CLUSTER_SUBNET}\"\nruntimeRequestTimeout: \"10m\"\ntlsCertFile: \"${KUBE_CERT_PATH}\/${NODE_NAME}.pem\"\ntlsPrivateKeyFile: \"${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem\"\nreadOnlyPort: 0\nprotectKernelDefaults: false\nmakeIPTablesUtilChains: true\neventRecordQPS: 0\nkubeletCgroups: \"\/systemd\/system.slice\"\nevictionHard:\n  memory.available: \"200Mi\"\n  nodefs.available:  \"10%\"\n  nodefs.inodesFree: \"5%\"\nEOF\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --config=${KUBE_CONFIG_PATH}\/kubelet-config.yaml \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --register-node=true \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"if \\$programname == 'kubelet' then \/var\/log\/kubelet.log\n& stop\" | sudo tee \/etc\/rsyslog.d\/kubelet.conf\n\ncat <<EOF | sudo tee ${KUBE_CONFIG_PATH}\/kube-proxy-config.yaml\nkind: KubeProxyConfiguration\napiVersion: kubeproxy.config.k8s.io\/v1alpha1\nclientConnection:\n  kubeconfig: \"${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\"\nmode: \"iptables\"\nclusterCIDR: \"${CLUSTER_SUBNET}\"\niptables:\n  masqueradeAll: true\nEOF\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --config=${KUBE_CONFIG_PATH}\/kube-proxy-config.yaml\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/lib\/modules\n      name: lib-modules-host\n      readOnly: true\n    - mountPath: ${KUBE_CONFIG_PATH}\n      name: kube-config-path\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/lib\/modules\n    name: lib-modules-host\n  - hostPath:\n      path: ${KUBE_CONFIG_PATH}\n    name: kube-config-path\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masqueradeAll\/d' ${KUBE_CONFIG_PATH}\/kube-proxy-config.yaml\nfi \n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"EXEC","uuid":"6b1c7b2a-f14e-4e89-f18b-6ae7fd5e130d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{AHV_Centos_K8SM.address[0]}@@\"\nINSTANCE_IP=\"@@{address}@@\"\ninstance=\"worker@@{calm_array_index}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nsudo systemctl start iscsid\nsudo systemctl restart rsyslog\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; if [[ $count -eq 600 ]]; then echo \"failed to download certs\" && exit 1; fi; count=$(($count+5)) ; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${instance} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${instance} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"877193d4-5eb9-44b0-8429-10e00c9ddb30","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"c1566b3d_dag","uuid":"420e79e4-fb92-45ea-846a-f98e9712c902"},"name":"9a6e189b_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SW_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"},"retries":"0","description":"","type":"DAG","uuid":"1f7496d5-7ba0-4e06-a2f5-210cb8af0797","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"6dfc257b-10e4-4a8b-a480-c3aef4829f35"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"abd3357c_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Worker","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","description":"","type":"EXEC","uuid":"6dfc257b-10e4-4a8b-a480-c3aef4829f35","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain 'worker@@{calm_array_index}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node 'worker@@{calm_array_index}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"61dcd773-5492-4877-9837-e8ed32e4cea3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"abd3357c_dag","uuid":"1f7496d5-7ba0-4e06-a2f5-210cb8af0797"},"name":"3cb17acf_runbook"}},"variable_list":[],"name":"AHV_Centos_K8SW_Package"},{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"98d52ce6-ea88-40ad-b297-cd1c626e7035","name":"action_install","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"CENTOS_76","uuid":"04ab0470-1aae-4704-9624-b3cff5cd25b7"},"retries":"0","description":"","type":"DAG","uuid":"381d1bed-312d-4233-82dd-2ac105433a82","child_tasks_local_reference_list":[{"kind":"app_task","name":"Image Fetch task for VM","uuid":"51fd30e7-5c80-4a40-90e4-2639b2366172"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7"},{"target_any_local_reference":{"kind":"app_package","name":"CENTOS_76","uuid":"04ab0470-1aae-4704-9624-b3cff5cd25b7"},"retries":"0","description":"","type":"SUBSTRATE_IMAGE_FETCH","uuid":"51fd30e7-5c80-4a40-90e4-2639b2366172","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"","name":"CENTOS_76","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-1810.qcow2","version":{"product_version":"","type":"","product_name":""},"architecture":"X86_64","type":""},"description":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Image Fetch task for VM"}],"description":"","message_list":[],"uuid":"43e52d70-aea2-445c-995d-86ac65d2cf10","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7","uuid":"381d1bed-312d-4233-82dd-2ac105433a82"},"name":"SYS_GEN__Runbook_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7"}},{"description":"System action for creating an application","message_list":[],"uuid":"2bfc6c67-380c-4dc2-8e1c-77b990c2e318","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"CENTOS_76","uuid":"04ab0470-1aae-4704-9624-b3cff5cd25b7"},"retries":"0","description":"","type":"DAG","uuid":"1563ee90-ddae-48b7-b91d-6063d1cf3635","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7","uuid":"288884b3-c88e-456e-be9c-23dcbe5b506c"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7"},{"target_any_local_reference":{"kind":"app_package","name":"CENTOS_76","uuid":"04ab0470-1aae-4704-9624-b3cff5cd25b7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"288884b3-c88e-456e-be9c-23dcbe5b506c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7","uuid":"43e52d70-aea2-445c-995d-86ac65d2cf10"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7"}],"description":"","message_list":[],"uuid":"0eeb2727-f7ab-476f-881f-331eababd8d2","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7","uuid":"1563ee90-ddae-48b7-b91d-6063d1cf3635"},"name":"SYS_GEN__Runbook_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7"}},{"description":"System action for starting an application","message_list":[],"uuid":"959640c4-2229-44ed-988e-957829bebbf8","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"CENTOS_76","uuid":"04ab0470-1aae-4704-9624-b3cff5cd25b7"},"retries":"0","description":"","type":"DAG","uuid":"28c64077-ec4a-4661-bd25-c76114240813","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7"}],"description":"","message_list":[],"uuid":"fd0e4867-12b0-400b-a2c5-50041721dfdc","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7","uuid":"28c64077-ec4a-4661-bd25-c76114240813"},"name":"SYS_GEN__Runbook_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7"}},{"description":"System action for restarting an application","message_list":[],"uuid":"79e05b88-dc40-4776-89f6-572855d5c87b","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"CENTOS_76","uuid":"04ab0470-1aae-4704-9624-b3cff5cd25b7"},"retries":"0","description":"","type":"DAG","uuid":"5ce3d740-8473-4920-8215-b5995e3dc6a2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7"}],"description":"","message_list":[],"uuid":"2bda8fc7-39e0-4701-92b8-3ab1cae521e0","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7","uuid":"5ce3d740-8473-4920-8215-b5995e3dc6a2"},"name":"SYS_GEN__Runbook_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7"}},{"description":"System action for stopping an application","message_list":[],"uuid":"4d721154-f2d2-4d54-aa9f-1d8971aa69c1","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"CENTOS_76","uuid":"04ab0470-1aae-4704-9624-b3cff5cd25b7"},"retries":"0","description":"","type":"DAG","uuid":"5525b948-f430-4c0c-8527-3f856b500aaf","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7"}],"description":"","message_list":[],"uuid":"dcea1559-a38b-42b5-960c-0004ae1e665e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7","uuid":"5525b948-f430-4c0c-8527-3f856b500aaf"},"name":"SYS_GEN__Runbook_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"ff2c605b-e757-44fe-bc1e-e5bf1a82f91f","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"CENTOS_76","uuid":"04ab0470-1aae-4704-9624-b3cff5cd25b7"},"retries":"0","description":"","type":"DAG","uuid":"61520707-51ee-4c3a-8162-68ae14f5d140","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7"}],"description":"","message_list":[],"uuid":"8b0aef68-f54e-423b-8c5c-79c86860df57","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7","uuid":"61520707-51ee-4c3a-8162-68ae14f5d140"},"name":"SYS_GEN__Runbook_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"1293249b-6e64-4142-ae79-07b48485aeca","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"CENTOS_76","uuid":"04ab0470-1aae-4704-9624-b3cff5cd25b7"},"retries":"0","description":"","type":"DAG","uuid":"bcfd5841-cd1d-48a6-8517-b419dc74fe9e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7"}],"description":"","message_list":[],"uuid":"cf624994-251e-45f9-b91b-27c6f83904e1","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7","uuid":"bcfd5841-cd1d-48a6-8517-b419dc74fe9e"},"name":"SYS_GEN__Runbook_Package_04ab0470_1aae_4704_9624_b3cff5cd25b7"}}],"message_list":[],"service_local_reference_list":[],"uuid":"04ab0470-1aae-4704-9624-b3cff5cd25b7","state":"ACTIVE","version":"","editables":{},"type":"SUBSTRATE_IMAGE","options":{"type":"","name":"CENTOS_76","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-1810.qcow2","version":{"product_version":"","type":"","product_name":""},"architecture":"X86_64","type":""},"description":""},"variable_list":[],"name":"CENTOS_76"}]},"name":"Kubernetes_AHV"},"spec":{"name":"Kubernetes_AHV","resources":{"service_definition_list":[{"singleton":false,"name":"Kubernetes_Master","action_list":[{"description":"System action for creating an application","name":"action_create","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"3a8535ac-4cef-4ea1-8a0f-0511df9796b5","child_tasks_local_reference_list":[{"kind":"app_task","name":"Dashboard","uuid":"b78869cd-4bdd-4789-9b7f-a3a9af35df6a"},{"kind":"app_task","name":"HELM","uuid":"0fb90d2a-ff76-4b43-b67e-ff89e7e903e1"},{"kind":"app_task","name":"Heapster","uuid":"973147f0-ea02-4401-a76f-612d810beb74"}],"attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Dashboard","uuid":"b78869cd-4bdd-4789-9b7f-a3a9af35df6a"},"edge_type":"user_defined","type":"","uuid":"7c5a5e88-f8b5-4bd5-8f2f-120582ba7ac0","to_task_reference":{"kind":"app_task","name":"HELM","uuid":"0fb90d2a-ff76-4b43-b67e-ff89e7e903e1"}},{"from_task_reference":{"kind":"app_task","name":"HELM","uuid":"0fb90d2a-ff76-4b43-b67e-ff89e7e903e1"},"edge_type":"user_defined","type":"","uuid":"d5af30e4-bc4e-468d-bfc6-85056382af85","to_task_reference":{"kind":"app_task","name":"Heapster","uuid":"973147f0-ea02-4401-a76f-612d810beb74"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"f33eac3f_dag"},{"target_any_local_reference":{"kind":"app_service","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"b78869cd-4bdd-4789-9b7f-a3a9af35df6a","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/dashboard\necho '# Copyright 2015 Google Inc. All Rights Reserved.\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#     http:\/\/www.apache.org\/licenses\/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\n# Configuration to deploy release version of the Dashboard UI compatible with\n# Kubernetes 1.7.\n#\n# Example usage: kubectl create -f <this_file>\n\n# ------------------- Dashboard Secret ------------------- #\n\napiVersion: v1\nkind: Secret\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard-certs\n  namespace: kube-system\ntype: Opaque\n\n---\n# ------------------- Dashboard Service Account ------------------- #\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\n\n---\n# ------------------- Dashboard Role & Role Binding ------------------- #\n\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: kubernetes-full-access\n  namespace: kube-system\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: kubernetes-dashboard\n  namespace: kube-system\n\n---\n# ------------------- Dashboard Deployment ------------------- #\n\nkind: Deployment\napiVersion: apps\/v1beta2\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\nspec:\n  replicas: 1\n  revisionHistoryLimit: 10\n  selector:\n    matchLabels:\n      k8s-app: kubernetes-dashboard\n  template:\n    metadata:\n      labels:\n        k8s-app: kubernetes-dashboard\n    spec:\n      containers:\n      - name: kubernetes-dashboard\n        image: k8s.gcr.io\/kubernetes-dashboard-amd64:v1.10.1\n        ports:\n        - containerPort: 8443\n          protocol: TCP\n        args:\n          - --auto-generate-certificates\n          # Uncomment the following line to manually specify Kubernetes API server Host\n          # If not specified, Dashboard will attempt to auto discover the API server and connect\n          # to it. Uncomment only if the default does not work.\n          # - --apiserver-host=http:\/\/my-address:port\n        volumeMounts:\n        - name: kubernetes-dashboard-certs\n          mountPath: \/certs\n          # Create on-disk volume to store exec logs\n        - mountPath: \/tmp\n          name: tmp-volume\n        livenessProbe:\n          httpGet:\n            scheme: HTTPS\n            path: \/\n            port: 8443\n          initialDelaySeconds: 30\n          timeoutSeconds: 30\n      volumes:\n      - name: kubernetes-dashboard-certs\n        secret:\n          secretName: kubernetes-dashboard-certs\n      - name: tmp-volume\n        emptyDir: {}\n      serviceAccountName: kubernetes-dashboard\n      # Comment the following tolerations if Dashboard must not be deployed on master\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        effect: NoSchedule\n\n---\n# ------------------- Dashboard Service ------------------- #\n\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\nspec:\n  type: NodePort\n  ports:\n    - port: 8443\n      nodePort: 30443\n  selector:\n    k8s-app: kubernetes-dashboard' | sudo tee \/etc\/kubernetes\/addons\/dashboard\/kubernetes-dashboard.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/dashboard\/kubernetes-dashboard.yaml\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Dashboard"},{"target_any_local_reference":{"kind":"app_service","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"0fb90d2a-ff76-4b43-b67e-ff89e7e903e1","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir \/etc\/kubernetes\/addons\/helm\necho \"#helm init --service-account helm\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: helm\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: helm\n  namespace: kube-system\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: helm\n  namespace: kube-system\" | sudo tee \/etc\/kubernetes\/addons\/helm\/helm.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/helm\/helm.yaml\nhelm init --service-account helm\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"HELM"},{"target_any_local_reference":{"kind":"app_service","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"973147f0-ea02-4401-a76f-612d810beb74","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir \/etc\/kubernetes\/addons\/metricsserver\n\n\necho 'apiVersion: rbac.authorization.k8s.io\/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: metrics-server:system:auth-delegator\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:auth-delegator\nsubjects:\n- kind: ServiceAccount\n  name: metrics-server\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1\nkind: RoleBinding\nmetadata:\n  name: metrics-server-auth-reader\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: Role\n  name: extension-apiserver-authentication-reader\nsubjects:\n- kind: ServiceAccount\n  name: metrics-server\n  namespace: kube-system\n---\napiVersion: apiregistration.k8s.io\/v1beta1\nkind: APIService\nmetadata:\n  name: v1beta1.metrics.k8s.io\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  service:\n    name: metrics-server\n    namespace: kube-system\n  group: metrics.k8s.io\n  version: v1beta1\n  insecureSkipTLSVerify: true\n  groupPriorityMinimum: 100\n  versionPriority: 100\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: metrics-server\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: metrics-server-config\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  NannyConfiguration: |-\n    apiVersion: nannyconfig\/v1alpha1\n    kind: NannyConfiguration\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: metrics-server-v0.3.3\n  namespace: kube-system\n  labels:\n    k8s-app: metrics-server\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    version: v0.3.3\nspec:\n  selector:\n    matchLabels:\n      k8s-app: metrics-server\n      version: v0.3.3\n  template:\n    metadata:\n      name: metrics-server\n      labels:\n        k8s-app: metrics-server\n        version: v0.3.3\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      serviceAccountName: metrics-server\n      containers:\n      - name: metrics-server\n        image: k8s.gcr.io\/metrics-server-amd64:v0.3.3\n        command:\n        - \/metrics-server\n        - --metric-resolution=30s\n        - --kubelet-preferred-address-types=InternalIP,Hostname,InternalDNS,ExternalDNS,ExternalIP\n        ports:\n        - containerPort: 443\n          name: https\n          protocol: TCP\n      - name: metrics-server-nanny\n        image: k8s.gcr.io\/addon-resizer:1.8.4\n        resources:\n          limits:\n            cpu: 100m\n            memory: 300Mi\n          requests:\n            cpu: 5m\n            memory: 50Mi\n        env:\n          - name: MY_POD_NAME\n            valueFrom:\n              fieldRef:\n                fieldPath: metadata.name\n          - name: MY_POD_NAMESPACE\n            valueFrom:\n              fieldRef:\n                fieldPath: metadata.namespace\n        volumeMounts:\n        - name: metrics-server-config-volume\n          mountPath: \/etc\/config\n        command:\n          - \/pod_nanny\n          - --config-dir=\/etc\/config\n          - --cpu=1\n          - --extra-cpu=0.5m\n          - --memory=40\n          - --extra-memory=4Mi\n          - --threshold=5\n          - --deployment=metrics-server-v0.3.3\n          - --container=metrics-server\n          - --poll-period=300000\n          - --estimator=exponential\n          - --minClusterSize=3\n      volumes:\n        - name: metrics-server-config-volume\n          configMap:\n            name: metrics-server-config\n      tolerations:\n        - key: \"CriticalAddonsOnly\"\n          operator: \"Exists\"\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: metrics-server\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/cluster-service: \"true\"\n    kubernetes.io\/name: \"Metrics-server\"\nspec:\n  selector:\n    k8s-app: metrics-server\n  ports:\n  - port: 443\n    protocol: TCP\n    targetPort: https\n---\napiVersion: rbac.authorization.k8s.io\/v1\nkind: ClusterRole\nmetadata:\n  name: system:metrics-server\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n- apiGroups:\n  - \"\"\n  resources:\n  - pods\n  - nodes\n  - nodes\/stats\n  - namespaces\n  verbs:\n  - get\n  - list\n  - watch\n- apiGroups:\n  - \"extensions\"\n  resources:\n  - deployments\n  verbs:\n  - get\n  - list\n  - update\n  - watch\n---\napiVersion: rbac.authorization.k8s.io\/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:metrics-server\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:metrics-server\nsubjects:\n- kind: ServiceAccount\n  name: metrics-server\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/metricsserver\/metricsserver.yaml\n  \nkubectl create -f \/etc\/kubernetes\/addons\/metricsserver\/metricsserver.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"MetricsServer"}],"description":"","uuid":"337c08c1-d983-4234-bb61-802e5a642090","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"f33eac3f_dag","uuid":"3a8535ac-4cef-4ea1-8a0f-0511df9796b5"},"name":"a9639da1_runbook"},"type":"system","uuid":"2dab1398-5f4e-4312-9de2-a47650fa1a88"},{"description":"System action for deleting an application. Deletes created VMs as well","name":"action_delete","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"80f6321b-cacf-48b3-ac08-84797e785a35","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"62a92d34_dag"}],"description":"","uuid":"26ce2713-05fa-4b65-ac37-579626d25b62","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"62a92d34_dag","uuid":"80f6321b-cacf-48b3-ac08-84797e785a35"},"name":"8c4aa276_runbook"},"type":"system","uuid":"4806ed5a-3821-4c8e-882c-59daa9a1bcb9"},{"description":"System action for starting an application","name":"action_start","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"3176680b-a2a7-4827-9e53-7134037cd307","child_tasks_local_reference_list":[{"kind":"app_task","name":"Start","uuid":"e2f9f724-9a4a-49b3-91aa-7bb792d4a054"}],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"334b4484_dag"},{"target_any_local_reference":{"kind":"app_service","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"e2f9f724-9a4a-49b3-91aa-7bb792d4a054","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\nsudo systemctl start etcd docker kubelet \nsudo systemctl enable etcd docker kubelet\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Start"}],"description":"","uuid":"dfd5bd01-3ebf-47c9-9501-e21346d9e5ef","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"334b4484_dag","uuid":"3176680b-a2a7-4827-9e53-7134037cd307"},"name":"daee30ae_runbook"},"type":"system","uuid":"a5492ffc-5d09-4dc5-81b2-dde463997d65"},{"description":"System action for stopping an application","name":"action_stop","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"853a243e-8b76-463f-95c7-09f9de5a7928","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"9713c3d0_dag"}],"description":"","uuid":"4fde4266-9dcc-48ff-9ff0-b3b3ff53d82c","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"9713c3d0_dag","uuid":"853a243e-8b76-463f-95c7-09f9de5a7928"},"name":"6407a345_runbook"},"type":"system","uuid":"ae96608f-55a2-4b97-bcb1-14bf21746733"},{"description":"System action for restarting an application","name":"action_restart","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"b6f5d74b-ab0e-41dd-a787-6155d6e64891","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"414912df_dag"}],"description":"","uuid":"dae0b6c4-1f7d-4497-9710-8f360bc20831","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"414912df_dag","uuid":"b6f5d74b-ab0e-41dd-a787-6155d6e64891"},"name":"d5c8316f_runbook"},"type":"system","uuid":"072bbe7b-8832-4832-aff7-e9818d7df759"}],"description":"","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0","port_list":[],"tier":"","variable_list":[{"val_type":"STRING","description":"","uuid":"f76eacd2-8090-4840-b4e3-8ada58ebe1e9","value":"","label":"","attrs":{"type":""},"type":"LOCAL","name":"VERSION"}],"depends_on_list":[]},{"singleton":false,"name":"Kubernetes_Worker","action_list":[{"description":"System action for creating an application","name":"action_create","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517","name":"Kubernetes_Minion"},"retries":"0","description":"","uuid":"923300fb-07a2-47d5-80da-c3f479ff345d","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"4af7c45f_dag"}],"description":"","uuid":"9bd65d16-65b7-45ae-99ab-298f6f137505","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"4af7c45f_dag","uuid":"923300fb-07a2-47d5-80da-c3f479ff345d"},"name":"7c6e4932_runbook"},"type":"system","uuid":"b524b43e-e34a-4b36-9fc4-8b97796dcad5"},{"description":"System action for deleting an application. Deletes created VMs as well","name":"action_delete","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517","name":"Kubernetes_Minion"},"retries":"0","description":"","uuid":"2f417209-bdde-42bc-bbe6-3a04ac005398","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"1e2c50bb_dag"}],"description":"","uuid":"09962a62-e984-4f41-bd3f-98968b698ac0","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"1e2c50bb_dag","uuid":"2f417209-bdde-42bc-bbe6-3a04ac005398"},"name":"1d794193_runbook"},"type":"system","uuid":"93b924ac-b77b-4ae4-870e-f44bf3540c43"},{"description":"System action for starting an application","name":"action_start","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517","name":"Kubernetes_Minion"},"retries":"0","description":"","uuid":"06cc2e88-c5c6-4bd3-ac5c-11a3bfb6a10f","child_tasks_local_reference_list":[{"kind":"app_task","name":"Start","uuid":"8888d396-2780-46cf-afcd-803cb5596643"}],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"970128c7_dag"},{"target_any_local_reference":{"kind":"app_service","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517","name":"Kubernetes_Minion"},"retries":"0","description":"","uuid":"8888d396-2780-46cf-afcd-803cb5596643","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nsudo systemctl start docker kubelet\nsudo systemctl enable docker kubelet","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Start"}],"description":"","uuid":"d2212910-a48e-4c21-96d4-009c61505cad","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"970128c7_dag","uuid":"06cc2e88-c5c6-4bd3-ac5c-11a3bfb6a10f"},"name":"884352cf_runbook"},"type":"system","uuid":"b7f65a96-487b-4d84-8c2a-e9cf27df0d44"},{"description":"System action for stopping an application","name":"action_stop","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517","name":"Kubernetes_Minion"},"retries":"0","description":"","uuid":"d77034d2-3188-45a9-89f1-44a7a276137a","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"6c01dc28_dag"}],"description":"","uuid":"b769d338-4161-4626-972a-7c9bcf413eac","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6c01dc28_dag","uuid":"d77034d2-3188-45a9-89f1-44a7a276137a"},"name":"0cb172a7_runbook"},"type":"system","uuid":"529e0ba8-6ba4-47f0-affd-e3bf2cb299a1"},{"description":"System action for restarting an application","name":"action_restart","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517","name":"Kubernetes_Minion"},"retries":"0","description":"","uuid":"8143fc4d-46d3-4d13-b12e-a1c277d04668","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"1d66b5be_dag"}],"description":"","uuid":"cd09b8ce-f3e9-43e8-a843-6623eb53b961","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"1d66b5be_dag","uuid":"8143fc4d-46d3-4d13-b12e-a1c277d04668"},"name":"3a6f587d_runbook"},"type":"system","uuid":"235dc97c-abbd-47bc-96dc-a2187b53f16e"}],"description":"","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517","port_list":[],"tier":"","variable_list":[{"val_type":"STRING","description":"","uuid":"e205abf6-b94b-4d59-bf6c-29e25d46f663","value":"","label":"","attrs":{"type":""},"type":"LOCAL","name":"VERSION"}],"depends_on_list":[]}],"substrate_definition_list":[{"name":"AHV_Centos_K8SM","action_list":[],"uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"timeout_secs":"300","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"0","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS","uuid":"7f504213-fb04-443e-8007-1547bccadb97"}},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"name":true,"resources":{"nic_list":{"0":{"subnet_reference":true}},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"guest_customization":true,"disk_list":{"1":{"disk_size_mib":true},"3":{"disk_size_mib":true},"2":{"disk_size_mib":true},"5":{"disk_size_mib":true},"4":{"disk_size_mib":true},"6":{"disk_size_mib":true}}}}},"os_type":"Linux","type":"AHV_VM","create_spec":{"name":"K8SM-@@{calm_array_index}@@-@@{calm_time}@@","resources":{"nic_list":[{"subnet_reference":{"uuid":"718f9bd2-7aed-43cb-9fae-fe984c162b57"}}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"gpu_list":[],"memory_size_mib":2048,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"718f9bd2-7aed-43cb-9fae-fe984c162b57","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","name":"CENTOS_76","uuid":"04ab0470-1aae-4704-9624-b3cff5cd25b7"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":1,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":2,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":3,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":4,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":5,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":6,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[],"description":""},{"name":"AHV_Centos_K8SW","action_list":[],"uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"timeout_secs":"300","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"0","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS","uuid":"7f504213-fb04-443e-8007-1547bccadb97"}},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"name":true,"resources":{"nic_list":{"0":{"subnet_reference":true}},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"guest_customization":true,"disk_list":{"1":{"disk_size_mib":true},"3":{"disk_size_mib":true},"2":{"disk_size_mib":true}}}}},"os_type":"Linux","type":"AHV_VM","create_spec":{"name":"K8SW-@@{calm_array_index}@@-@@{calm_time}@@","resources":{"nic_list":[{"subnet_reference":{"uuid":"718f9bd2-7aed-43cb-9fae-fe984c162b57"}}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"gpu_list":[],"memory_size_mib":4096,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"718f9bd2-7aed-43cb-9fae-fe984c162b57","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","name":"CENTOS_76","uuid":"04ab0470-1aae-4704-9624-b3cff5cd25b7"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":1,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":2,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":3,"adapter_type":"SCSI"},"device_type":"DISK"}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[],"description":""}],"credential_definition_list":[{"username":"centos","description":"","uuid":"7f504213-fb04-443e-8007-1547bccadb97","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{"uuid":"9fe4d9e8-7998-43db-9067-a38ce4122c27"}}},"editables":{"username":true,"secret":true},"type":"KEY","name":"CENTOS"}],"type":"USER","app_profile_list":[{"deployment_create_list":[{"max_replicas":"3","action_list":[],"package_local_reference_list":[{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"}],"description":"","uuid":"36fc342b-cfd9-4914-a44e-33ec8e2269d9","min_replicas":"3","editables":{"min_replicas":true,"max_replicas":true},"substrate_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"ea96440f-ce01-43e0-893d-b5bd8347d8a1"},"type":"GREENFIELD","variable_list":[],"name":"2cbb2f6a_deployment"},{"max_replicas":"9","action_list":[],"package_local_reference_list":[{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"}],"description":"","uuid":"65413f34-f6c9-4167-a384-430b589f40c5","min_replicas":"3","editables":{"min_replicas":true,"max_replicas":true},"substrate_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"4d669bf0-f18a-40d0-97fe-d3be8ad5c7d9"},"type":"GREENFIELD","variable_list":[],"name":"39cf7283_deployment"}],"description":"","action_list":[{"description":"","name":"Upgrade","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"65901a08-e868-4ef9-98dd-7216d3934e01","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Version Master","uuid":"8f050b84-fb14-436a-81dc-ec6d20e23e50"},{"kind":"app_task","name":"Set Version Minion","uuid":"5b1c753a-3bb5-4438-879f-bafd3ad37f22"},{"kind":"app_task","name":"Upgrade Master","uuid":"0aa32e3a-bb3c-4822-b9d2-cb9060412401"},{"kind":"app_task","name":"Upgrade Minion","uuid":"21c45b67-ecc7-4777-ba8e-53df1495c11d"},{"kind":"app_task","name":"RestartServices","uuid":"7c68be97-fbeb-40ce-b035-3c01582e2bef"}],"attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"8f050b84-fb14-436a-81dc-ec6d20e23e50"},"edge_type":"user_defined","type":"","uuid":"bd2cd381-4457-44f2-a421-3b7cd5f1b89b","to_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"0aa32e3a-bb3c-4822-b9d2-cb9060412401"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"0aa32e3a-bb3c-4822-b9d2-cb9060412401"},"edge_type":"user_defined","type":"","uuid":"906ab28f-39ca-4429-8578-6a1baf3cc72f","to_task_reference":{"kind":"app_task","name":"RestartServices","uuid":"7c68be97-fbeb-40ce-b035-3c01582e2bef"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"8f050b84-fb14-436a-81dc-ec6d20e23e50"},"edge_type":"user_defined","type":"","uuid":"51a27b67-c217-42bc-9e59-74d832ed4d12","to_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"5b1c753a-3bb5-4438-879f-bafd3ad37f22"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"5b1c753a-3bb5-4438-879f-bafd3ad37f22"},"edge_type":"user_defined","type":"","uuid":"f449a41e-d86a-4aaa-bb53-b8549ee9439c","to_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"21c45b67-ecc7-4777-ba8e-53df1495c11d"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"21c45b67-ecc7-4777-ba8e-53df1495c11d"},"edge_type":"user_defined","type":"","uuid":"01b55b23-cdb9-4f2e-9e32-70e4d79cd577","to_task_reference":{"kind":"app_task","name":"RestartServices","uuid":"7c68be97-fbeb-40ce-b035-3c01582e2bef"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"6ee65d8a_dag"},{"target_any_local_reference":{"kind":"app_service","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"8f050b84-fb14-436a-81dc-ec6d20e23e50","child_tasks_local_reference_list":[],"attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[],"name":"Set Version Master"},{"target_any_local_reference":{"kind":"app_service","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517","name":"Kubernetes_Minion"},"retries":"0","description":"","uuid":"5b1c753a-3bb5-4438-879f-bafd3ad37f22","child_tasks_local_reference_list":[],"attrs":{"exit_status":[],"script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[],"name":"Set Version Minion"},{"target_any_local_reference":{"kind":"app_service","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"0aa32e3a-bb3c-4822-b9d2-cb9060412401","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CONFIG_PATH=\"\/etc\/kubernetes\/config\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nCONTROLLER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --enable-admission-plugins=NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --config=${KUBE_CONFIG_PATH}\/kube-proxy-config.yaml\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/lib\/modules\n      name: lib-modules-host\n      readOnly: true\n    - mountPath: ${KUBE_CONFIG_PATH}\n      name: kube-config-path\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/lib\/modules\n    name: lib-modules-host\n  - hostPath:\n      path: ${KUBE_CONFIG_PATH}\n    name: kube-config-path\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --bind-address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=${KUBE_CLUSTER_NAME}\n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n   \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --config=${KUBE_CONFIG_PATH}\/kube-scheduler.yaml\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: ${KUBE_CONFIG_PATH}\n      name: kube-config-path\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: ${KUBE_CONFIG_PATH}\n    name: kube-config-path\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Upgrade Master"},{"target_any_local_reference":{"kind":"app_service","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517","name":"Kubernetes_Minion"},"retries":"0","description":"","uuid":"21c45b67-ecc7-4777-ba8e-53df1495c11d","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CONFIG_PATH=\"\/etc\/kubernetes\/config\"\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --config=${KUBE_CONFIG_PATH}\/kube-proxy-config.yaml\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/lib\/modules\n      name: lib-modules-host\n      readOnly: true\n    - mountPath: ${KUBE_CONFIG_PATH}\n      name: kube-config-path\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/lib\/modules\n    name: lib-modules-host\n  - hostPath:\n      path: ${KUBE_CONFIG_PATH}\n    name: kube-config-path\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Upgrade Minion"},{"target_any_local_reference":{"kind":"app_service","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"7c68be97-fbeb-40ce-b035-3c01582e2bef","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_IPS=\"@@{AHV_Centos_K8SW.address}@@\"\nJSONPATH='{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}'\nKUBE_VERSION_NEW=\"@@{KUBE_VERSION_NEW}@@\"\nMASTER_API_HTTPS=6443\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION_NEW}\/bin\/linux\/amd64\/kubectl\nchmod +x kubectl\nsudo mv kubectl \/usr\/local\/bin\/kubectl\n\ncount=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n  echo \"Trying to reach master server https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} : sleep for 5 secs\"\n  sleep 10\n  if [[ $count -eq 10 ]]; then\n    echo \"Unable to reach master server: https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\"\n    exit 1\n  fi\n  count=$((count+1))\ndone\n\ncount=0\nfor ip in $(echo \"${WORKER_IPS}\" | tr \",\" \"\\n\"); do\n  #kubectl drain \"worker${count}\" --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no $ip \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 10\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=worker${count} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon worker${count}\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n  echo \"Upgrade failed on worker nodes\"\n    exit 1\nfi\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  #kubectl drain \"master${count}\" --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no $ip \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 10\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=master${count} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon master${count}\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n  echo \"Upgrade failed on nodes: $(kubectl get nodes -o jsonpath='$JSONPATH' | grep 'Ready=Unknown')\"\n    exit 1\nfi","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"RestartServices"}],"description":"","uuid":"29ecd07e-c7e9-4712-a807-6975aa4cf819","variable_list":[{"val_type":"STRING","description":"","uuid":"61d31174-d6f5-4f2e-91c6-6b191b9404b7","value":"v1.14.2","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_VERSION_NEW"}],"main_task_local_reference":{"kind":"app_task","name":"6ee65d8a_dag","uuid":"65901a08-e868-4ef9-98dd-7216d3934e01"},"name":"68a7ffd0_runbook"},"type":"user","uuid":"88582175-dd84-40bb-a241-92ec4b05b918"},{"description":"","name":"ScaleOut","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"8dc15feb-3df5-48dd-a417-f7535f2bc6c2","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Out","uuid":"df853e37-f9a6-430e-9ae9-af6066bb894e"},{"kind":"app_task","name":"Set Hosts file","uuid":"9be84ec9-e0c5-4ea7-b533-bd499888327c"}],"attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Scale Out","uuid":"df853e37-f9a6-430e-9ae9-af6066bb894e"},"edge_type":"user_defined","type":"","uuid":"b31d44df-12e2-45ca-8e1d-1d30cad63950","to_task_reference":{"kind":"app_task","name":"Set Hosts file","uuid":"9be84ec9-e0c5-4ea7-b533-bd499888327c"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"03b33121_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5","name":"39cf7283_deployment"},"retries":"0","description":"","uuid":"df853e37-f9a6-430e-9ae9-af6066bb894e","child_tasks_local_reference_list":[],"attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","type":"SCALING","variable_list":[],"name":"Scale Out"},{"target_any_local_reference":{"kind":"app_service","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"9be84ec9-e0c5-4ea7-b533-bd499888327c","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nMINION_IPS=\"@@{AHV_Centos_K8SW.address}@@\"\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  if ! (( $(grep -c \"${ip} worker${count}\" \/etc\/hosts) )) ; then\n  \techo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  fi\n  count=$((count+1))\ndone","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Set Hosts file"}],"description":"","uuid":"abdef5b4-fff1-41a9-b274-b991c91ed96c","variable_list":[{"val_type":"STRING","description":"","uuid":"8c96dc28-0375-42cb-b241-f816aade96a9","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"03b33121_dag","uuid":"8dc15feb-3df5-48dd-a417-f7535f2bc6c2"},"name":"00cf5417_runbook"},"type":"user","uuid":"b2ba9d00-acf8-430e-b1b8-aff8229992d8"},{"description":"","name":"ScaleIn","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"39111cb6-b10e-4c99-b275-72e3ae67c61b","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale In","uuid":"89c4a32a-5488-49a7-9a7f-b478d9118b11"}],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"e72a9133_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","uuid":"65413f34-f6c9-4167-a384-430b589f40c5","name":"39cf7283_deployment"},"retries":"0","description":"","uuid":"89c4a32a-5488-49a7-9a7f-b478d9118b11","child_tasks_local_reference_list":[],"attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","type":"SCALING","variable_list":[],"name":"Scale In"}],"description":"","uuid":"b5651495-f3c1-47b9-b4e7-67fc6338b2ac","variable_list":[{"val_type":"STRING","description":"","uuid":"b4793aac-12ae-4e23-a8cd-b49f762c6cec","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"e72a9133_dag","uuid":"39111cb6-b10e-4c99-b275-72e3ae67c61b"},"name":"96546f6c_runbook"},"type":"user","uuid":"3644087e-e621-4012-854a-62ab3f964476"}],"name":"Nutanix","variable_list":[{"val_type":"STRING","description":"","uuid":"0ed70cb3-6cef-4cd7-b582-eb7ed6ef3ca1","value":"ahv-kubenetes-cluster","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_CLUSTER_NAME"},{"val_type":"STRING","description":"","uuid":"d342abf7-8cdb-4159-98b9-f767dc9600b7","value":"v1.14.2","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_VERSION"},{"val_type":"STRING","description":"","uuid":"8ab025e6-192f-46ff-8c71-325d8e6a7304","value":"17.03.3.ce","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"DOCKER_VERSION"},{"val_type":"STRING","description":"","uuid":"2e51c4fc-0170-4989-b427-ecce862d64a2","value":"10.200.0.0\/16","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_CLUSTER_SUBNET"},{"val_type":"STRING","description":"","uuid":"a4ab6187-1ed4-45ab-9e5d-999686b68585","value":"10.32.0.0\/24","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_SERVICE_SUBNET"},{"val_type":"STRING","description":"","uuid":"d4623004-9117-4eac-83d0-1a6908c76fc6","value":"10.32.0.10","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_DNS_IP"},{"val_type":"STRING","description":"","uuid":"b60647c2-73e8-4577-a30b-7cbc73a0cafe","value":"10.5.68.20","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"PE_CLUSTER_IP"},{"val_type":"STRING","description":"","uuid":"e9998b23-0e15-4d12-a293-51b514899f98","value":"10.5.68.27","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"PE_DATA_SERVICE_IP"},{"val_type":"STRING","description":"","uuid":"db122700-c561-4b3d-a619-36be3d17c164","value":"admin","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"PE_USERNAME"},{"val_type":"STRING","description":"","uuid":"4dadfc60-368c-47dc-92ab-d2a15932c0bf","label":"","attrs":{"is_secret_modified":false,"secret_reference":{"uuid":"48d49c45-f86d-43b1-af80-5e7d21eca4b3"}},"editables":{"value":true},"type":"SECRET","name":"PE_PASSWORD"},{"val_type":"STRING","description":"","uuid":"782de374-59f1-40e6-a6d7-d861d9e2fe66","value":"default-container-71229","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"PE_CONTAINER_NAME"},{"val_type":"STRING","description":"","uuid":"dcda56d7-1780-642c-601f-1871f2d2d2d4","value":"flannel","label":"","attrs":{},"editables":{"value":true},"type":"LOCAL","name":"KUBE_CNI_PLUGIN"}],"uuid":"5379eb2d-47d6-4a38-9aa8-7cd3d16130b5"}],"default_credential_local_reference":{"kind":"app_credential","name":"CENTOS","uuid":"7f504213-fb04-443e-8007-1547bccadb97"},"package_definition_list":[{"uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41","action_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"}],"name":"AHV_Centos_K8SM_Package","version":"","type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"},"retries":"0","name":"dac441af_dag","type":"DAG","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"eabe5f6b-5085-4bf3-89d6-e5a2efada38b"},{"kind":"app_task","name":"Generate Certs","uuid":"ebe27231-bc7c-4ef4-93d9-ad716bef85a6"},{"kind":"app_task","name":"Configure Services","uuid":"376f7cc1-2ab0-4e69-aa31-b86c5245b7ab"},{"kind":"app_task","name":"Add User Roles","uuid":"838cf56b-04f7-44b1-864a-0d8fa995894a"},{"kind":"app_task","name":"Network Configuration","uuid":"0176e204-3e8b-4f15-ac53-bc9931a118c9"},{"kind":"app_task","name":"DNS Configuration","uuid":"962d2407-d998-45d9-8f93-4753c589cfea"},{"kind":"app_task","name":"NVP Configuration","uuid":"bc76166c-44b1-455c-8a4d-d51a275a2622"},{"kind":"app_task","uuid":"38621149-0471-9d76-68db-f0156b4d23b0"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"eabe5f6b-5085-4bf3-89d6-e5a2efada38b"},"edge_type":"user_defined","type":"","uuid":"97ec3a23-dc95-4129-b687-16208661a683","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"ebe27231-bc7c-4ef4-93d9-ad716bef85a6"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"ebe27231-bc7c-4ef4-93d9-ad716bef85a6"},"edge_type":"user_defined","type":"","uuid":"5189d82f-d25c-4546-a6b5-cd518c7edebc","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"376f7cc1-2ab0-4e69-aa31-b86c5245b7ab"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"376f7cc1-2ab0-4e69-aa31-b86c5245b7ab"},"edge_type":"user_defined","type":"","uuid":"8fa3fcd5-69dc-481d-8331-132288e42728","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"838cf56b-04f7-44b1-864a-0d8fa995894a"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"838cf56b-04f7-44b1-864a-0d8fa995894a"},"edge_type":"user_defined","type":"","uuid":"e3237e7f-ae2a-41c8-bb5d-9cfc1070eb37","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"0176e204-3e8b-4f15-ac53-bc9931a118c9"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"0176e204-3e8b-4f15-ac53-bc9931a118c9"},"edge_type":"user_defined","type":"","uuid":"1957525b-a91b-4832-97d2-0103e08c70a5","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"962d2407-d998-45d9-8f93-4753c589cfea"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"962d2407-d998-45d9-8f93-4753c589cfea"},"edge_type":"user_defined","type":"","uuid":"9874f072-49e5-4196-9687-d6bdb24c6272","to_task_reference":{"kind":"app_task","name":"NVP Configuration","uuid":"bc76166c-44b1-455c-8a4d-d51a275a2622"}},{"from_task_reference":{"kind":"app_task","uuid":"bc76166c-44b1-455c-8a4d-d51a275a2622"},"uuid":"c0c7aedf-6b39-22f0-4128-294c22a12e3c","to_task_reference":{"kind":"app_task","uuid":"38621149-0471-9d76-68db-f0156b4d23b0"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"5da059ca-9790-4ec3-a9e2-0603c4351cd7"},{"target_any_local_reference":{"kind":"app_service","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","name":"Set Kubernetes Version","type":"SET_VARIABLE","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"eval_variables":["VERSION"],"script_type":"static","script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"eabe5f6b-5085-4bf3-89d6-e5a2efada38b"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","name":"ETCD Docker Kubelet Install","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\ncount=0\n# Verify access to Centos mirror before yum update\ncheck_mirror() {\ncurl -s mirrorlist.centos.org >\/dev\/null | true\nif [ \"${PIPESTATUS[0]}\" -ne 0 ]; then\n    if [ ${count} -lt 60 ]; then\n        echo \"Sleeping for 5 seconds before repeating the check\" | sudo tee -a \/var\/log\/messages\n        sleep 5\n        count=$((count+1))\n        check_mirror\n    else\n        echo \"DNS resolution failed after 5 minutes, exiting\" | sudo tee -a \/var\/log\/messages\n        exit 1\n    fi\nfi\n}\ncheck_mirror\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.3.12\"\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_IPS=\"@@{AHV_Centos_K8SW.address}@@\"\nNODE_NAME=\"master@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_CONFIG_PATH=\"\/etc\/kubernetes\/config\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CONFIG_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} master${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"master${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} worker${count}\" | sudo tee -a \/etc\/hosts\n  count=$((count+1))\ndone  \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\necho \"if \\$programname == 'etcd' then \/var\/log\/etcd.log\n& stop\" | sudo tee \/etc\/rsyslog.d\/etcd.conf\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-*.tgz\n\ncat <<EOF | sudo tee ${KUBE_CONFIG_PATH}\/kubelet-config.yaml\nkind: KubeletConfiguration\napiVersion: kubelet.config.k8s.io\/v1beta1\nauthentication:\n  anonymous:\n    enabled: false\n  webhook:\n    enabled: true\n  x509:\n    clientCAFile: \"${KUBE_CERT_PATH}\/ca.pem\"\nauthorization:\n  mode: Webhook\nclusterDomain: \"cluster.local\"\nclusterDNS:\n  - \"${KUBE_CLUSTER_DNS}\"\nstaticPodPath: \"${KUBE_MANIFEST_PATH}\"\npodCIDR: \"${CLUSTER_SUBNET}\"\nruntimeRequestTimeout: \"10m\"\ntlsCertFile: \"${KUBE_CERT_PATH}\/${NODE_NAME}.pem\"\ntlsPrivateKeyFile: \"${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem\"\nreadOnlyPort: 0\nprotectKernelDefaults: false\nmakeIPTablesUtilChains: true\neventRecordQPS: 0\nkubeletCgroups: \"\/systemd\/system.slice\"\nEOF\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --config=${KUBE_CONFIG_PATH}\/kubelet-config.yaml \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --register-node=true \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"if \\$programname == 'kubelet' then \/var\/log\/kubelet.log\n& stop\" | sudo tee \/etc\/rsyslog.d\/kubelet.conf\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate etcd \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/sd{e,f,g}\nsudo vgcreate docker \/dev\/sd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"ebe27231-bc7c-4ef4-93d9-ad716bef85a6"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","name":"Generate Certs","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nWORKER_IPS=\"@@{AHV_Centos_K8SW.address}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"master${count}\",\n  count=$((count+1))\ndone\n\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${WORKER_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"worker${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${MASTER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_NAMES},${MASTER_IPS},${MINION_NAMES},${WORKER_IPS},${FIRST_IP_SERVICE_SUBNET},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local -profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\ninstance=\"master${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=master${count}.kubeconfig\nkubectl config set-credentials system:node:master${count} --client-certificate=master${count}.pem --client-key=master${count}-key.pem --embed-certs=true --kubeconfig=master${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:master${count} --kubeconfig=master${count}.kubeconfig\nkubectl config use-context default --kubeconfig=master${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${MASTER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"master${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"376f7cc1-2ab0-4e69-aa31-b86c5245b7ab"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","name":"Configure Services","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{calm_array_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CONFIG_PATH=\"\/etc\/kubernetes\/config\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nCONTROLLER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${MASTER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --enable-admission-plugins=NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\ncat <<EOF | sudo tee ${KUBE_CONFIG_PATH}\/kube-proxy-config.yaml\nkind: KubeProxyConfiguration\napiVersion: kubeproxy.config.k8s.io\/v1alpha1\nclientConnection:\n  kubeconfig: \"${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\"\nmode: \"iptables\"\nclusterCIDR: \"${CLUSTER_SUBNET}\"\niptables:\n  masqueradeAll: true\nEOF\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --config=${KUBE_CONFIG_PATH}\/kube-proxy-config.yaml\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/lib\/modules\n      name: lib-modules-host\n      readOnly: true\n    - mountPath: ${KUBE_CONFIG_PATH}\n      name: kube-config-path\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/lib\/modules\n    name: lib-modules-host\n  - hostPath:\n      path: ${KUBE_CONFIG_PATH}\n    name: kube-config-path\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masqueradeAll\/d' ${KUBE_CONFIG_PATH}\/kube-proxy-config.yaml\nfi \n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --bind-address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=${KUBE_CLUSTER_NAME}\n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n   \ncat <<EOF | sudo tee ${KUBE_CONFIG_PATH}\/kube-scheduler.yaml\napiVersion: kubescheduler.config.k8s.io\/v1alpha1\nkind: KubeSchedulerConfiguration\nclientConnection:\n  kubeconfig: \"${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\"\nleaderElection:\n  leaderElect: true\nEOF\n   \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --config=${KUBE_CONFIG_PATH}\/kube-scheduler.yaml\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: ${KUBE_CONFIG_PATH}\n      name: kube-config-path\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: ${KUBE_CONFIG_PATH}\n    name: kube-config-path\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n    \necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"838cf56b-04f7-44b1-864a-0d8fa995894a"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","name":"Add User Roles","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet iscsid\nsudo systemctl enable etcd docker kubelet iscsid\nsudo systemctl restart rsyslog\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem master* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"0176e204-3e8b-4f15-ac53-bc9931a118c9"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","name":"Network Configuration","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ]]; then\nsudo mkdir -p \/etc\/kubernetes\/addons\/canal\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: canal-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  canal_iface: \"\"\n\n  masquerade: \"true\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: canal\n  namespace: kube-system\n  labels:\n    k8s-app: canal\nspec:\n  selector:\n    matchLabels:\n      k8s-app: canal\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: canal\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: canal\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-canal.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              value: \"none\"\n            - name: CLUSTER_TYPE\n              value: \"k8s,canal\"\n            - name: FELIX_IPTABLESREFRESHINTERVAL\n              value: \"60\"\n            - name: IP\n              value: \"\"\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"192.168.0.0\/16\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: \/readiness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n        - name: kube-flannel\n          image: quay.io\/coreos\/flannel:v0.9.1\n          command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n          securityContext:\n            privileged: true\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: FLANNELD_IFACE\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: canal_iface\n            - name: FLANNELD_IP_MASQ\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: masquerade\n          volumeMounts:\n          - mountPath: \/run\/xtables.lock\n            name: xtables-lock\n            readOnly: false\n          - name: flannel-cfg\n            mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: flannel-cfg\n          configMap:\n            name: canal-config\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: canal\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: canal-flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: canal-calico\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/canal\/canal.yml\nkubectl create -f \/etc\/kubernetes\/addons\/canal\/canal.yml\n\nelif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]];then\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/calico\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  calico_backend: \"bird\"\n\n  veth_mtu: \"1440\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: calico-node\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.4\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-calico.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CNI_MTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.4\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s,bgp\"\n            - name: IP\n              value: \"autodetect\"\n            - name: CALICO_IPV4POOL_IPIP\n              value: \"Always\"\n            - name: FELIX_IPINIPMTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"@@{KUBE_CLUSTER_SUBNET}@@\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            exec:\n              command:\n              - \/bin\/calico-node\n              - -bird-ready\n              - -felix-ready\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPPeer\n    plural: bgppeers\n    singular: bgppeer\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/calico\/calico.yml\nkubectl create -f \/etc\/kubernetes\/addons\/calico\/calico.yml  \n\nelse\n  echo \"Defaulting to flannel\"\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n  - kind: ServiceAccount\n    name: flannel\n    namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"hairpinMode\": true,\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - \/opt\/bin\/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        resources:\n          requests:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n          limits:\n            cpu: \"100m\"\n            memory: \"50Mi\"\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/bin\/sh\", \"-c\", \"set -e -x; cp -f \/etc\/kube-flannel\/cni-conf.json \/etc\/cni\/net.d\/10-flannel.conf; while true; do sleep 3600; done\" ]\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nfi\n\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"962d2407-d998-45d9-8f93-4753c589cfea"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"retries":"0","name":"DNS Configuration","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/coredns \necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: coredns\n  namespace: kube-system\n  labels:\n      kubernetes.io\/cluster-service: \"true\"\n      addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: rbac.authorization.k8s.io\/v1\nkind: ClusterRole\nmetadata:\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n    addonmanager.kubernetes.io\/mode: Reconcile\n  name: system:coredns\nrules:\n- apiGroups:\n  - \"\"\n  resources:\n  - endpoints\n  - services\n  - pods\n  - namespaces\n  verbs:\n  - list\n  - watch\n- apiGroups:\n  - \"\"\n  resources:\n  - nodes\n  verbs:\n  - get\n---\napiVersion: rbac.authorization.k8s.io\/v1\nkind: ClusterRoleBinding\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n    addonmanager.kubernetes.io\/mode: EnsureExists\n  name: system:coredns\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:coredns\nsubjects:\n- kind: ServiceAccount\n  name: coredns\n  namespace: kube-system\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: coredns\n  namespace: kube-system\n  labels:\n      addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  Corefile: |\n    .:53 {\n        errors\n        health\n        kubernetes cluster.local. in-addr.arpa ip6.arpa {\n            pods insecure\n            upstream\n            fallthrough in-addr.arpa ip6.arpa\n        }\n        prometheus :9153\n        forward . \/etc\/resolv.conf\n        cache 30\n        loop\n        reload\n        loadbalance\n    }\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: coredns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/name: \"CoreDNS\"\nspec:\n  strategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      serviceAccountName: coredns\n      tolerations:\n        - key: \"CriticalAddonsOnly\"\n          operator: \"Exists\"\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      containers:\n      - name: coredns\n        image: k8s.gcr.io\/coredns:1.3.1\n        imagePullPolicy: IfNotPresent\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        args: [ \"-conf\", \"\/etc\/coredns\/Corefile\" ]\n        volumeMounts:\n        - name: config-volume\n          mountPath: \/etc\/coredns\n          readOnly: true\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        - containerPort: 9153\n          name: metrics\n          protocol: TCP\n        livenessProbe:\n          httpGet:\n            path: \/health\n            port: 8080\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/health\n            port: 8080\n            scheme: HTTP\n        securityContext:\n          allowPrivilegeEscalation: false\n          capabilities:\n            add:\n            - NET_BIND_SERVICE\n            drop:\n            - all\n          readOnlyRootFilesystem: true\n      dnsPolicy: Default\n      volumes:\n        - name: config-volume\n          configMap:\n            name: coredns\n            items:\n            - key: Corefile\n              path: Corefile\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  annotations:\n    prometheus.io\/port: \"9153\"\n    prometheus.io\/scrape: \"true\"\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n    kubernetes.io\/name: \"CoreDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n  - name: dns\n    port: 53\n    protocol: UDP\n  - name: dns-tcp\n    port: 53\n    protocol: TCP\n  - name: metrics\n    port: 9153\n    protocol: TCP' | sudo tee \/etc\/kubernetes\/addons\/coredns\/coredns.yaml\n    \nkubectl create -f \/etc\/kubernetes\/addons\/coredns\/coredns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n        seccomp.security.alpha.kubernetes.io\/pod: \"docker\/default\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.2.0\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          - --target=Deployment\/coredns\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/coredns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/coredns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"bc76166c-44b1-455c-8a4d-d51a275a2622"},{"target_any_local_reference":{"kind":"app_service","uuid":"64a2dda5-481c-4a03-80cb-9cb9b954e1e0"},"name":"NVP Configuration","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nPRISM_CLUSTER_IP=\"@@{PE_CLUSTER_IP}@@\"\nPRISM_DATA_SERVICE_IP=\"@@{PE_CLUSTER_IP}@@\"\n\nif [[ (\"${PRISM_CLUSTER_IP}x\" == \"x\") && (\"${PRISM_DATA_SERVICE_IP}x\" == \"x\") ]]; then exit 0; fi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/volume_plugin\nNTNX_SECRET=$(echo -n \"@@{PE_USERNAME}@@:@@{PE_PASSWORD}@@\" | base64)\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: nutanixabs-provisioner-runner\n  namespace: kube-system\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumes\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumeclaims\"]\n    verbs: [\"get\", \"list\", \"watch\", \"update\"]\n  - apiGroups: [\"storage.k8s.io\"]\n    resources: [\"storageclasses\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"list\", \"watch\", \"create\", \"update\", \"patch\"]\n  - apiGroups: [\"\"]\n    resources: [\"services\"]\n    verbs: [\"get\"]\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"create\", \"delete\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: run-nutanixabs-provisioner\n  namespace: kube-system\nsubjects:\n  - kind: ServiceAccount\n    name: nutanixabs-provisioner\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: nutanixabs-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      labels:\n        app: nutanixabs-provisioner\n    spec:\n      serviceAccount: nutanixabs-provisioner\n      hostNetwork: true\n      containers:\n        -\n          image: \"ntnx\/nutanixabs-provisioner\"\n          name: nutanixabs-provisioner\n          args: [\"--v=4\"]\n          imagePullPolicy: IfNotPresent\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: kube-system\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\n---\nkind: StorageClass\napiVersion: storage.k8s.io\/v1\nmetadata:\n  name: silver \n  namespace: kube-system\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\nprovisioner: nutanix\/abs\nparameters:\n     prismEndPoint: @@{PE_CLUSTER_IP}@@:9440\n     dataServiceEndPoint: @@{PE_DATA_SERVICE_IP}@@:3260\n     secretName: ntnx-secret\n     storageContainer: @@{PE_CONTAINER_NAME}@@\n     fsType: ext4\n     chapAuthEnabled: \"false\"' | sudo tee \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\necho \"apiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: default\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\" | sudo tee -a \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\n","script_type":"sh"},"type":"EXEC","variable_list":[],"uuid":"38621149-0471-9d76-68db-f0156b4d23b0"}],"name":"8e760b73_runbook","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"dac441af_dag","uuid":"5da059ca-9790-4ec3-a9e2-0603c4351cd7"},"uuid":"90359548-587c-4ebb-8203-2d8f67ba25d0"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"dd5a8351-d4fe-4d18-92cb-f1bcbce0fb41"},"retries":"0","name":"6324786a_dag","type":"DAG","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"55e668d6-c865-44da-9e1b-b33595b22f32"}],"name":"6522ac7a_runbook","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"6324786a_dag","uuid":"55e668d6-c865-44da-9e1b-b33595b22f32"},"uuid":"be04318d-ff24-4ce9-a752-08a7064ecebd"}},"variable_list":[],"description":""},{"uuid":"99092116-88f3-49fd-81d3-15220edf6824","action_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Minion","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"}],"name":"AHV_Centos_K8SW_Package","version":"","type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"},"retries":"0","name":"c1566b3d_dag","type":"DAG","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Docker Kubelet Install","uuid":"e0ecec97-6c96-4ef8-927c-eb3a4b24d618"},{"kind":"app_task","name":"GetCerts","uuid":"526a6a44-f0ef-4558-9c41-44e5005ca5f8"},{"kind":"app_task","uuid":"6b1c7b2a-f14e-4e89-f18b-6ae7fd5e130d"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"e0ecec97-6c96-4ef8-927c-eb3a4b24d618"},"edge_type":"user_defined","type":"","uuid":"263b0ae0-ac56-4734-88d9-5cfb1d6e7b3a","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"526a6a44-f0ef-4558-9c41-44e5005ca5f8"}},{"from_task_reference":{"kind":"app_task","uuid":"526a6a44-f0ef-4558-9c41-44e5005ca5f8"},"uuid":"37561b9b-dc31-f40f-0f61-08e5f36b6a3c","to_task_reference":{"kind":"app_task","uuid":"6b1c7b2a-f14e-4e89-f18b-6ae7fd5e130d"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"420e79e4-fb92-45ea-846a-f98e9712c902"},{"target_any_local_reference":{"kind":"app_service","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","name":"Set Kubernetes Version","type":"SET_VARIABLE","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"eval_variables":["VERSION"],"script_type":"static","script":"#script\n#if \"@@{calm_array_index}@@\" == \"0\":\nprint \"VERSION=@@{KUBE_VERSION}@@\""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"e0ecec97-6c96-4ef8-927c-eb3a4b24d618"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","name":"Docker Kubelet Install","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\ncount=0\n# Verify access to Centos mirror before yum update\ncheck_mirror() {\ncurl -s mirrorlist.centos.org >\/dev\/null | true\nif [ \"${PIPESTATUS[0]}\" -ne 0 ]; then\n    if [ ${count} -lt 60 ]; then\n        echo \"Sleeping for 5 seconds before repeating the check\"\n        sleep 5\n        count=$((count+1))\n        check_mirror\n    else\n        echo \"DNS resolution failed after 5 minutes, exiting\"\n        exit 1\n    fi\nfi\n}\ncheck_mirror\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nINTERNAL_IP=\"@@{address}@@\"\nMASTER_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nNODE_NAME=\"worker@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CONFIG_PATH=\"\/etc\/kubernetes\/config\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH} ${KUBE_CONFIG_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.7.5\/cni-plugins-amd64-v0.7.5.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nif [[ \"${DOCKER_VERSION}\" == \"17.03.3.ce\" ]]; then\n  sudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\nelse\n  sudo yum install -y --quiet docker-ce-${DOCKER_VERSION}\nfi\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-*.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-*.tgz\n\ncat <<EOF | sudo tee ${KUBE_CONFIG_PATH}\/kubelet-config.yaml\nkind: KubeletConfiguration\napiVersion: kubelet.config.k8s.io\/v1beta1\nauthentication:\n  anonymous:\n    enabled: false\n  webhook:\n    enabled: true\n  x509:\n    clientCAFile: \"${KUBE_CERT_PATH}\/ca.pem\"\nauthorization:\n  mode: Webhook\nclusterDomain: \"cluster.local\"\nclusterDNS:\n  - \"${KUBE_CLUSTER_DNS}\"\nstaticPodPath: \"${KUBE_MANIFEST_PATH}\"\npodCIDR: \"${CLUSTER_SUBNET}\"\nruntimeRequestTimeout: \"10m\"\ntlsCertFile: \"${KUBE_CERT_PATH}\/${NODE_NAME}.pem\"\ntlsPrivateKeyFile: \"${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem\"\nreadOnlyPort: 0\nprotectKernelDefaults: false\nmakeIPTablesUtilChains: true\neventRecordQPS: 0\nkubeletCgroups: \"\/systemd\/system.slice\"\nevictionHard:\n  memory.available: \"200Mi\"\n  nodefs.available:  \"10%\"\n  nodefs.inodesFree: \"5%\"\nEOF\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --config=${KUBE_CONFIG_PATH}\/kubelet-config.yaml \\\\\n  --container-runtime=docker \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --register-node=true \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"if \\$programname == 'kubelet' then \/var\/log\/kubelet.log\n& stop\" | sudo tee \/etc\/rsyslog.d\/kubelet.conf\n\ncat <<EOF | sudo tee ${KUBE_CONFIG_PATH}\/kube-proxy-config.yaml\nkind: KubeProxyConfiguration\napiVersion: kubeproxy.config.k8s.io\/v1alpha1\nclientConnection:\n  kubeconfig: \"${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\"\nmode: \"iptables\"\nclusterCIDR: \"${CLUSTER_SUBNET}\"\niptables:\n  masqueradeAll: true\nEOF\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: gcr.io\/google-containers\/hyperkube:${KUBE_VERSION}\n    command:\n    - \/hyperkube\n    - proxy\n    - --config=${KUBE_CONFIG_PATH}\/kube-proxy-config.yaml\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/lib\/modules\n      name: lib-modules-host\n      readOnly: true\n    - mountPath: ${KUBE_CONFIG_PATH}\n      name: kube-config-path\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/lib\/modules\n    name: lib-modules-host\n  - hostPath:\n      path: ${KUBE_CONFIG_PATH}\n    name: kube-config-path\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \nif [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ] ||  [ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]; then\n\tsudo sed -i '\/masqueradeAll\/d' ${KUBE_CONFIG_PATH}\/kube-proxy-config.yaml\nfi \n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"526a6a44-f0ef-4558-9c41-44e5005ca5f8"},{"target_any_local_reference":{"kind":"app_service","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"name":"GetCerts","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{AHV_Centos_K8SM.address[0]}@@\"\nINSTANCE_IP=\"@@{address}@@\"\ninstance=\"worker@@{calm_array_index}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nsudo systemctl start iscsid\nsudo systemctl restart rsyslog\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; if [[ $count -eq 600 ]]; then echo \"failed to download certs\" && exit 1; fi; count=$(($count+5)) ; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${instance} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${instance} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json","script_type":"sh"},"type":"EXEC","variable_list":[],"uuid":"6b1c7b2a-f14e-4e89-f18b-6ae7fd5e130d"}],"name":"9a6e189b_runbook","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"c1566b3d_dag","uuid":"420e79e4-fb92-45ea-846a-f98e9712c902"},"uuid":"877193d4-5eb9-44b0-8429-10e00c9ddb30"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"99092116-88f3-49fd-81d3-15220edf6824"},"retries":"0","name":"abd3357c_dag","type":"DAG","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"6dfc257b-10e4-4a8b-a480-c3aef4829f35"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"1f7496d5-7ba0-4e06-a2f5-210cb8af0797"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"d59081fe-18e1-4b9b-a76e-a674108df517"},"retries":"0","name":"Remove Node","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain 'worker@@{calm_array_index}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node 'worker@@{calm_array_index}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"6dfc257b-10e4-4a8b-a480-c3aef4829f35"}],"name":"3cb17acf_runbook","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"abd3357c_dag","uuid":"1f7496d5-7ba0-4e06-a2f5-210cb8af0797"},"uuid":"61dcd773-5492-4877-9837-e8ed32e4cea3"}},"variable_list":[],"description":""},{"uuid":"04ab0470-1aae-4704-9624-b3cff5cd25b7","action_list":[],"service_local_reference_list":[],"name":"CENTOS_76","version":"","type":"SUBSTRATE_IMAGE","options":{"type":"","description":"","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-1810.qcow2","version":{"product_version":"","type":"","product_name":""},"architecture":"X86_64","type":""},"name":"CENTOS_76"},"variable_list":[],"description":""}],"client_attrs":{"d4389398-b75e-4ddf-9196-3e2e69ca68c4":{"y":151.1603651085,"x":418},"113ac65d-b93b-48da-8673-b09258f7ff42":{"y":413.0940071326,"x":768.9612911807},"4c4d5206-e22f-455f-88a1-e1a5430fa5b1":{"y":413.0940071326,"x":768.9612911807},"5175796a-d993-4fee-a8d6-a93995777116":{"y":151.1603651085,"x":418},"65413f34-f6c9-4167-a384-430b589f40c5":{"y":413.0940071326,"x":768.9612911807},"73563755-c3cc-45a1-a770-be1ea7fc8e29":{"y":413.0940071326,"x":768.9612911807},"36fc342b-cfd9-4914-a44e-33ec8e2269d9":{"y":151.1603651085,"x":418},"c85ab0c1-812c-4ce4-af01-5b900c004068":{"y":151.1603651085,"x":418}}},"description":"* [Kubernetes API](https:\/\/@@{Kubernetes_Master.address[0]}@@:6443)\n* [Kubernetes Dashboard](https:\/\/@@{Kubernetes_Master.address[0]}@@:30443)"},"api_version":"3.0","metadata":{"last_update_time":"1558435075319990","owner_reference":{"kind":"user","uuid":"00000000-0000-0000-0000-000000000000","name":"admin"},"kind":"blueprint","uuid":"5a4f9e7f-d581-49bd-bfb5-dba3174fc880","project_reference":{"kind":"project","name":"default","uuid":"22ca180e-f065-4728-95ad-9eed952de20f"},"spec_version":15,"creation_time":"1558416973217170","categories":{"AppFamily":"Containers"},"name":"Kubernetes_AHV"}}