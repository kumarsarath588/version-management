{"status":{"description":"* [Kubernetes API](https:\/\/@@{Kubernetes_Master.address[0]}@@:6443)","source_mpi":"","state":"DRAFT","is_cloned":false,"message_list":[{"message":"Credential is invalid","reason":"INVALID_CREDENTIAL","details":[{"attribute_name":"default_credential"}]}],"resources":{"service_definition_list":[{"port_list":[],"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"6ac8a4aa-5d2d-4872-a3ea-f8fc1fa8522e","name":"action_create","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"DAG","uuid":"f9a1754f-f3f5-48ff-a8c5-3dfca6be79c1","child_tasks_local_reference_list":[{"kind":"app_task","name":"Dashboard","uuid":"178fbbc4-9358-4da6-a35e-df59c4559bad"},{"kind":"app_task","name":"HELM","uuid":"79484302-2775-40aa-9bc2-ba3bfa323998"},{"kind":"app_task","name":"Heapster","uuid":"d459078d-b4f5-49ad-bf25-6e0d880053a0"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Dashboard","uuid":"178fbbc4-9358-4da6-a35e-df59c4559bad"},"edge_type":"user_defined","type":"","uuid":"a416ccf0-d63b-4697-8e7e-9f2a9b69ee62","to_task_reference":{"kind":"app_task","name":"HELM","uuid":"79484302-2775-40aa-9bc2-ba3bfa323998"}},{"from_task_reference":{"kind":"app_task","name":"HELM","uuid":"79484302-2775-40aa-9bc2-ba3bfa323998"},"edge_type":"user_defined","type":"","uuid":"343bc895-a0b1-417c-9f69-9e2dd5f2b296","to_task_reference":{"kind":"app_task","name":"Heapster","uuid":"d459078d-b4f5-49ad-bf25-6e0d880053a0"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"f33eac3f_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"178fbbc4-9358-4da6-a35e-df59c4559bad","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/dashboard\necho '# Copyright 2015 Google Inc. All Rights Reserved.\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#     http:\/\/www.apache.org\/licenses\/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\n# Configuration to deploy release version of the Dashboard UI compatible with\n# Kubernetes 1.7.\n#\n# Example usage: kubectl create -f <this_file>\n\n# ------------------- Dashboard Secret ------------------- #\n\napiVersion: v1\nkind: Secret\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard-certs\n  namespace: kube-system\ntype: Opaque\n\n---\n# ------------------- Dashboard Service Account ------------------- #\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\n\n---\n# ------------------- Dashboard Role & Role Binding ------------------- #\n\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: kubernetes-full-access\n  namespace: kube-system\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: kubernetes-dashboard\n  namespace: kube-system\n\n---\n# ------------------- Dashboard Deployment ------------------- #\n\nkind: Deployment\napiVersion: apps\/v1beta2\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\nspec:\n  replicas: 1\n  revisionHistoryLimit: 10\n  selector:\n    matchLabels:\n      k8s-app: kubernetes-dashboard\n  template:\n    metadata:\n      labels:\n        k8s-app: kubernetes-dashboard\n    spec:\n      containers:\n      - name: kubernetes-dashboard\n        image: k8s.gcr.io\/kubernetes-dashboard-amd64:v1.8.3\n        ports:\n        - containerPort: 8443\n          protocol: TCP\n        args:\n          - --auto-generate-certificates\n          # Uncomment the following line to manually specify Kubernetes API server Host\n          # If not specified, Dashboard will attempt to auto discover the API server and connect\n          # to it. Uncomment only if the default does not work.\n          # - --apiserver-host=http:\/\/my-address:port\n        volumeMounts:\n        - name: kubernetes-dashboard-certs\n          mountPath: \/certs\n          # Create on-disk volume to store exec logs\n        - mountPath: \/tmp\n          name: tmp-volume\n        livenessProbe:\n          httpGet:\n            scheme: HTTPS\n            path: \/\n            port: 8443\n          initialDelaySeconds: 30\n          timeoutSeconds: 30\n      volumes:\n      - name: kubernetes-dashboard-certs\n        secret:\n          secretName: kubernetes-dashboard-certs\n      - name: tmp-volume\n        emptyDir: {}\n      serviceAccountName: kubernetes-dashboard\n      # Comment the following tolerations if Dashboard must not be deployed on master\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        effect: NoSchedule\n\n---\n# ------------------- Dashboard Service ------------------- #\n\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\nspec:\n  type: NodePort\n  ports:\n    - port: 8443\n      nodePort: 30443\n  selector:\n    k8s-app: kubernetes-dashboard' | sudo tee \/etc\/kubernetes\/addons\/dashboard\/kubernetes-dashboard.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/dashboard\/kubernetes-dashboard.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Dashboard"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"79484302-2775-40aa-9bc2-ba3bfa323998","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir \/etc\/kubernetes\/addons\/helm\necho \"#helm init --service-account helm\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: helm\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: helm\n  namespace: kube-system\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: helm\n  namespace: kube-system\" | sudo tee \/etc\/kubernetes\/addons\/helm\/helm.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/helm\/helm.yaml\nhelm init --service-account helm\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"HELM"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"d459078d-b4f5-49ad-bf25-6e0d880053a0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir \/etc\/kubernetes\/addons\/heapster\nkubectl delete ClusterRole system:heapster -n kube-system\n\necho 'apiVersion: rbac.authorization.k8s.io\/v1\nkind: ClusterRole\nmetadata:\n  name: system:heapster\n  namespace: kube-system\nrules:\n- apiGroups:\n  - \"\"\n  resources:\n  - events\n  - namespaces\n  - nodes\n  - pods\n  verbs:\n  - get\n  - list\n  - watch\n- apiGroups:\n  - \"\"\n  resources:\n  - nodes\/stats\n  verbs:\n  - get\n- apiGroups:\n  - extensions\n  resources:\n  - deployments\n  verbs:\n  - get\n  - list\n  - watch\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: heapster\n  namespace: kube-system\n  labels:\n    k8s-app: heapster\n    module: apiserver\n    version: v6\nspec:\n  selector:\n    matchLabels:\n      k8s-app: heapster\n      module: apiserver\n      version: v6\n  template:\n    metadata:\n      name: heapster\n      labels:\n        k8s-app: heapster\n        module: apiserver\n        version: v6\n    spec:\n      serviceAccountName: heapster\n      containers:\n      - name: heapster\n        image: k8s.gcr.io\/heapster-amd64:v1.5.3\n        command:\n        - \/heapster\n        - --source=kubernetes.summary_api:\"\"?useServiceAccount=true&kubeletHttps=true&kubeletPort=10250&insecure=true\n        ports:\n        - containerPort: 6443\n          name: https\n        - containerPort: 8080\n          name: http\n        volumeMounts:\n        - name: ssl-certs\n          mountPath: \/etc\/ssl\/certs\n          readOnly: true\n      volumes:\n      - name: ssl-certs\n        hostPath:\n          path: \/etc\/ssl\/certs\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: heapster\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n---\nkind: Service\napiVersion: v1\nmetadata:\n  name: heapster\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    kubernetes.io\/name: \"Heapster\"\n    k8s-app: heapster\nspec:\n  ports:\n    - port: 80\n      targetPort: 8082\n  selector:\n    k8s-app: heapster\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: heapster\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: heapster\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/heapster\/heapster.yaml\n  \nkubectl create -f \/etc\/kubernetes\/addons\/heapster\/heapster.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Heapster"}],"description":"","message_list":[],"uuid":"aa8dd27e-4bd1-4b85-86c6-750c0a49579f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"f33eac3f_dag","uuid":"f9a1754f-f3f5-48ff-a8c5-3dfca6be79c1"},"name":"a9639da1_runbook"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"d424376b-92ac-4c83-b463-acaccddb4b01","name":"action_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"DAG","uuid":"2b96e4c1-d55e-4878-b250-cfdb20a314ec","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"62a92d34_dag"}],"description":"","message_list":[],"uuid":"a2ac512f-d272-4905-bafb-4733f7e58c9b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"62a92d34_dag","uuid":"2b96e4c1-d55e-4878-b250-cfdb20a314ec"},"name":"8c4aa276_runbook"}},{"description":"System action for starting an application","message_list":[],"uuid":"16704805-0ac9-49ef-b7ed-70b5f8c96531","name":"action_start","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"DAG","uuid":"6b1e66ab-fa56-478b-89b0-e46bbaad3abb","child_tasks_local_reference_list":[{"kind":"app_task","name":"Start","uuid":"e106bccf-2588-4947-984e-4241ff723ddc"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"334b4484_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"e106bccf-2588-4947-984e-4241ff723ddc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\nsudo systemctl start etcd docker kubelet\nsudo systemctl enable etcd docker kubelet\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Start"}],"description":"","message_list":[],"uuid":"64e5991c-fbcd-4d1f-8b72-4b4956e9702e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"334b4484_dag","uuid":"6b1e66ab-fa56-478b-89b0-e46bbaad3abb"},"name":"daee30ae_runbook"}},{"description":"System action for stopping an application","message_list":[],"uuid":"522b46ec-3b21-4daf-b761-9681c508a498","name":"action_stop","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"DAG","uuid":"a482f42b-56cb-4b17-801b-c6468ee259a8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"9713c3d0_dag"}],"description":"","message_list":[],"uuid":"1fdd3541-2eca-471a-a4be-4ef82887d4de","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"9713c3d0_dag","uuid":"a482f42b-56cb-4b17-801b-c6468ee259a8"},"name":"6407a345_runbook"}},{"description":"System action for restarting an application","message_list":[],"uuid":"49e1c7a2-6b20-414a-a1f0-094c07a6ac3e","name":"action_restart","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"DAG","uuid":"c65cf6b8-285b-4fb7-9fee-dcaa5191015e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"414912df_dag"}],"description":"","message_list":[],"uuid":"526cc0d4-3d9e-49c6-840b-f42e056f5d89","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"414912df_dag","uuid":"c65cf6b8-285b-4fb7-9fee-dcaa5191015e"},"name":"d5c8316f_runbook"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"2d9b4cd2-8a2f-49bf-9dac-f82717dfbf4e","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"DAG","uuid":"5eb8ce91-4fa9-4ad9-99ab-1e954f993def","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Service_Element_Delete_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"72b59742-fd3b-4968-89c0-75d5df69aaf9"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"72b59742-fd3b-4968-89c0-75d5df69aaf9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Service_Element_Delete_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"50a769a7-5b0a-4546-9e12-4f0a3ceff21b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"5eb8ce91-4fa9-4ad9-99ab-1e954f993def"},"name":"SYS_GEN__Runbook_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}}],"message_list":[],"uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7","state":"ACTIVE","depends_on_list":[],"editables":{},"tier":"","singleton":false,"variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"a5c98a70-c80a-423d-9638-18a88919ec40","value":"@@{KUBE_VERSION}@@","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{},"is_hidden":false,"type":"LOCAL","options":{},"name":"VERSION"}],"name":"Kubernetes_Master"},{"port_list":[],"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"4904165e-6133-4e59-8c7b-cbf36b00a799","name":"action_create","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"DAG","uuid":"6742ec8c-3ab9-4b02-b7ef-5aafd6fad055","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"4af7c45f_dag"}],"description":"","message_list":[],"uuid":"cabcfd41-35e6-45f0-a791-00daf17de059","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"4af7c45f_dag","uuid":"6742ec8c-3ab9-4b02-b7ef-5aafd6fad055"},"name":"7c6e4932_runbook"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"652b8beb-e3fb-4448-917c-0dff4ac4ff3f","name":"action_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"DAG","uuid":"4ebfba89-7616-4bcd-b24f-bcf58292f826","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"1e2c50bb_dag"}],"description":"","message_list":[],"uuid":"6b0fd64c-e97f-4968-998d-ff058e95d9e9","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"1e2c50bb_dag","uuid":"4ebfba89-7616-4bcd-b24f-bcf58292f826"},"name":"1d794193_runbook"}},{"description":"System action for starting an application","message_list":[],"uuid":"5af53d26-a260-4688-b49d-f2d46247a174","name":"action_start","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"DAG","uuid":"cb741869-4ba2-49cd-9ac6-7a842f4a2277","child_tasks_local_reference_list":[{"kind":"app_task","name":"Start","uuid":"1e8228fb-5b7d-452e-a343-3366b1f324bc"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"970128c7_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"1e8228fb-5b7d-452e-a343-3366b1f324bc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo systemctl start docker kubelet\nsudo systemctl enable docker kubelet"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Start"}],"description":"","message_list":[],"uuid":"91f453c1-d2fc-47b1-93d4-4b49476235be","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"970128c7_dag","uuid":"cb741869-4ba2-49cd-9ac6-7a842f4a2277"},"name":"884352cf_runbook"}},{"description":"System action for stopping an application","message_list":[],"uuid":"0947a9b2-f508-445d-bba0-f319d80147e4","name":"action_stop","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"DAG","uuid":"0c3f910c-af0d-4ecf-a673-f4ae4ae0a8ad","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6c01dc28_dag"}],"description":"","message_list":[],"uuid":"12105be2-ee67-451d-8054-4546855e277c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6c01dc28_dag","uuid":"0c3f910c-af0d-4ecf-a673-f4ae4ae0a8ad"},"name":"0cb172a7_runbook"}},{"description":"System action for restarting an application","message_list":[],"uuid":"d52f5f4f-caef-49b7-a035-87aae7738a48","name":"action_restart","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"DAG","uuid":"9eda0f35-503d-4766-b93b-4e14968b559b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"1d66b5be_dag"}],"description":"","message_list":[],"uuid":"3fd75c09-a79f-4731-98fc-b65b96bc9fe7","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"1d66b5be_dag","uuid":"9eda0f35-503d-4766-b93b-4e14968b559b"},"name":"3a6f587d_runbook"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"2be5b2e0-d36b-43dc-b651-77ae3a275784","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"DAG","uuid":"392c9b6e-9300-4d01-a87e-7eb322844800","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Service_Element_Delete_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"480b6793-13b7-4a40-8662-924a8a26025c"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"480b6793-13b7-4a40-8662-924a8a26025c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Service_Element_Delete_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"d44a642f-9468-432a-9b7e-e69a7c1c08e7","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"392c9b6e-9300-4d01-a87e-7eb322844800"},"name":"SYS_GEN__Runbook_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}}],"message_list":[],"uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68","state":"ACTIVE","depends_on_list":[],"editables":{},"tier":"","singleton":false,"variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"c35b595e-283b-45c2-8512-071ad2d372ec","value":"@@{KUBE_VERSION}@@","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{},"is_hidden":false,"type":"LOCAL","options":{},"name":"VERSION"}],"name":"Kubernetes_Minion"}],"substrate_definition_list":[{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"61ddbac5-7ffc-494a-bdd0-60a9bf058b92","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"DAG","uuid":"0f0eddf2-8f26-43ae-b156-cf32fe185797","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Provision_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"44fbc525-0680-4c7f-9242-a1854c9474b3"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SC_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"eee54db9-ee1d-45d8-8e7a-94b48349b4f7"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Provision_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"44fbc525-0680-4c7f-9242-a1854c9474b3"},"edge_type":"inherent","type":"","uuid":"90a46cf6-001e-46eb-a520-6486083ca4bc","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SC_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"eee54db9-ee1d-45d8-8e7a-94b48349b4f7"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"PROVISION_NUTANIX","uuid":"44fbc525-0680-4c7f-9242-a1854c9474b3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"name":"K8SC-@@{calm_array_index}@@-@@{calm_time}@@","categories":"","availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"resources":{"nic_list":[],"parent_reference":null,"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"serial_port_list":[],"gpu_list":[],"memory_size_mib":2048,"power_state":"ON","hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{INSTANCE_PUBLIC_KEY}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"type":"","boot_config":{"boot_device":{"type":"","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CENTOS_74","uuid":"6cbb9b5f-3255-4d45-8d8f-0891f27ac147"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":1,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":2,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":3,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":4,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":5,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":6,"type":""}}}]}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Provision_36dbce6d_ca23_448a_91ee_69ef8735b2cf"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"eee54db9-ee1d-45d8-8e7a-94b48349b4f7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_Centos_K8SC_36dbce6d_ca23_448a_91ee_69ef8735b2cf"}],"description":"","message_list":[],"uuid":"9adb6919-b3c1-4abf-a7b2-49a04e78704f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"0f0eddf2-8f26-43ae-b156-cf32fe185797"},"name":"SYS_GEN__Runbook_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf"}},{"description":"System action for powering on an application","message_list":[],"uuid":"73d8c6c9-dad5-46f9-8d52-d5b5f2091486","name":"action_poweron","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"DAG","uuid":"193bf38b-8ca5-4358-ba2f-9db33c126bdd","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOn_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"4514e5f6-e32e-4c2e-8e60-2f8fdc09f40f"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SC_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"c2c668dd-c48c-4246-af4e-730e331e7c02"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOn_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"4514e5f6-e32e-4c2e-8e60-2f8fdc09f40f"},"edge_type":"inherent","type":"","uuid":"affb962e-53fa-4519-b16b-1174ad3b9265","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SC_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"c2c668dd-c48c-4246-af4e-730e331e7c02"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"4514e5f6-e32e-4c2e-8e60-2f8fdc09f40f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_PowerOn_36dbce6d_ca23_448a_91ee_69ef8735b2cf"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"c2c668dd-c48c-4246-af4e-730e331e7c02","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_Centos_K8SC_36dbce6d_ca23_448a_91ee_69ef8735b2cf"}],"description":"","message_list":[],"uuid":"065b517e-f244-4120-864d-d018ef13315b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"193bf38b-8ca5-4358-ba2f-9db33c126bdd"},"name":"SYS_GEN__Runbook_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf"}},{"description":"System action for restarting an application","message_list":[],"uuid":"a875bf24-506c-401c-b0d4-b66ac9ba70a7","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"DAG","uuid":"4371a7b3-3725-4442-8e32-52fc00f07862","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_Restart_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"118ef3c0-f64d-4767-b7d1-9b2b2df23a20"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SC_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"75e6d82f-30b3-442c-980f-a7b82fc2be13"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_Restart_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"118ef3c0-f64d-4767-b7d1-9b2b2df23a20"},"edge_type":"inherent","type":"","uuid":"caaec50b-8378-4636-aec9-427abb47f2e2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SC_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"75e6d82f-30b3-442c-980f-a7b82fc2be13"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"118ef3c0-f64d-4767-b7d1-9b2b2df23a20","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_Restart_36dbce6d_ca23_448a_91ee_69ef8735b2cf"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"75e6d82f-30b3-442c-980f-a7b82fc2be13","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_Centos_K8SC_36dbce6d_ca23_448a_91ee_69ef8735b2cf"}],"description":"","message_list":[],"uuid":"7892c56e-ed00-4e96-b932-83b17646490d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"4371a7b3-3725-4442-8e32-52fc00f07862"},"name":"SYS_GEN__Runbook_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf"}},{"description":"System action for suspending an application","message_list":[],"uuid":"41170c42-62eb-419c-b7a7-0f38a23fac02","name":"action_suspend","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"DAG","uuid":"3ff450a3-76d8-4661-92f7-d58286277a93","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf"}],"description":"","message_list":[],"uuid":"2b6fdd72-ee7e-4c01-828e-a5cee839be2a","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"3ff450a3-76d8-4661-92f7-d58286277a93"},"name":"SYS_GEN__Runbook_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf"}},{"description":"System action for modifying an application","message_list":[],"uuid":"cce4e813-35fe-469d-b7b7-f14424ffb2c7","name":"action_modify","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"DAG","uuid":"a6aa1707-d000-4ae8-885a-8a535e02f9e6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf"}],"description":"","message_list":[],"uuid":"cb6f523b-3fb0-4af2-b6c3-75a432b3ba94","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"a6aa1707-d000-4ae8-885a-8a535e02f9e6"},"name":"SYS_GEN__Runbook_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf"}},{"description":"System action for powering off an application","message_list":[],"uuid":"b982848a-1c3c-450c-8091-0e2deaf2e6a9","name":"action_poweroff","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"DAG","uuid":"c2db7881-521b-4bb6-b43e-59a7bf7a60eb","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOff_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"955e1c33-32e3-43c9-8504-52a6e4230426"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"955e1c33-32e3-43c9-8504-52a6e4230426","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_PowerOff_36dbce6d_ca23_448a_91ee_69ef8735b2cf"}],"description":"","message_list":[],"uuid":"0d2bb72a-8cc6-4e7b-b5ab-dc0f5be4af24","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"c2db7881-521b-4bb6-b43e-59a7bf7a60eb"},"name":"SYS_GEN__Runbook_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"fcde3368-c576-41a5-a35f-d3471db99d6b","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"DAG","uuid":"cdaccf05-2c88-4c7a-a306-3ae84a893638","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Delete_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"cf2af47f-d09a-473b-88a7-82c67c10eca5"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"DELETE_NUTANIX","uuid":"cf2af47f-d09a-473b-88a7-82c67c10eca5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Delete_36dbce6d_ca23_448a_91ee_69ef8735b2cf"}],"description":"","message_list":[],"uuid":"cc6eb93f-a61a-455f-bcc8-fdd5ebb03ee9","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"cdaccf05-2c88-4c7a-a306-3ae84a893638"},"name":"SYS_GEN__Runbook_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"14ecc4d4-27db-4f22-876b-1b0d2c98db6c","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"DAG","uuid":"991367e6-b172-46c0-8f81-b4dbbfb6f7c4","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Substrate_Element_Delete_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"7e586fa3-0247-4235-a9da-d1ae6eef0e8f"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"7e586fa3-0247-4235-a9da-d1ae6eef0e8f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Substrate_Element_Delete_36dbce6d_ca23_448a_91ee_69ef8735b2cf"}],"description":"","message_list":[],"uuid":"3e7fe7d8-5436-46f0-99a0-ee0a1f411c44","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"991367e6-b172-46c0-8f81-b4dbbfb6f7c4"},"name":"SYS_GEN__Runbook_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf"}}],"message_list":[{"message":"editable 0 is not a valid list index","reason":"INVALID_EDITABLE","details":[{"attribute_name":"0"}]}],"uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf","state":"DRAFT","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"0","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS","uuid":"5314d554-0539-406b-95eb-faa834a6ef81"}},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"name":true,"resources":{"nic_list":{"0":{"subnet_reference":true}},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"guest_customization":true,"disk_list":{"1":{"disk_size_mib":true},"3":{"disk_size_mib":true},"2":{"disk_size_mib":true},"5":{"disk_size_mib":true},"4":{"disk_size_mib":true},"6":{"disk_size_mib":true}}}}},"os_type":"Linux","type":"AHV_VM","create_spec":{"name":"K8SC-@@{calm_array_index}@@-@@{calm_time}@@","categories":"","availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"resources":{"nic_list":[],"parent_reference":null,"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"serial_port_list":[],"gpu_list":[],"memory_size_mib":2048,"power_state":"ON","hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{INSTANCE_PUBLIC_KEY}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"type":"","boot_config":{"boot_device":{"type":"","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CENTOS_74","uuid":"6cbb9b5f-3255-4d45-8d8f-0891f27ac147"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":1,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":2,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":3,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":4,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":5,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":6,"type":""}}}]}},"variable_list":[],"name":"AHV_Centos_K8SC"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"f61b3b0c-3353-4129-ab57-f047df50d043","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"DAG","uuid":"f6e7825b-b511-4688-ab09-c8db77b5cd79","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Provision_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"4dfa5928-306b-45a0-8a98-76cf72f8ebbb"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"58f5b57d-0211-421b-9f61-6aef6252a124"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Provision_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"4dfa5928-306b-45a0-8a98-76cf72f8ebbb"},"edge_type":"inherent","type":"","uuid":"1f05984a-a1fd-4fe6-949c-690d1a719f1b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"58f5b57d-0211-421b-9f61-6aef6252a124"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"PROVISION_NUTANIX","uuid":"4dfa5928-306b-45a0-8a98-76cf72f8ebbb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"name":"K8SM-@@{calm_array_index}@@-@@{calm_time}@@","categories":"","availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"resources":{"nic_list":[],"parent_reference":null,"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"serial_port_list":[],"gpu_list":[],"memory_size_mib":2048,"power_state":"ON","hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{INSTANCE_PUBLIC_KEY}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"type":"","boot_config":{"boot_device":{"type":"","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CENTOS_74","uuid":"6cbb9b5f-3255-4d45-8d8f-0891f27ac147"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":1,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":2,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":3,"type":""}}}]}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Provision_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"58f5b57d-0211-421b-9f61-6aef6252a124","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"}],"description":"","message_list":[],"uuid":"741ae977-6c62-4a73-af5d-0616318987d9","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"f6e7825b-b511-4688-ab09-c8db77b5cd79"},"name":"SYS_GEN__Runbook_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"}},{"description":"System action for powering on an application","message_list":[],"uuid":"efa2298f-6f12-4b67-bf97-77288dbdac19","name":"action_poweron","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"DAG","uuid":"2a1da486-8ada-422b-a8c3-11263aac1c08","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOn_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"3b5f97b0-04f6-4bc6-92c1-7570e76a47e1"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"0e5f039e-9d5c-4196-b844-fcaab5065004"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOn_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"3b5f97b0-04f6-4bc6-92c1-7570e76a47e1"},"edge_type":"inherent","type":"","uuid":"a7d20deb-5e38-411c-a7ed-8186fbac9a06","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"0e5f039e-9d5c-4196-b844-fcaab5065004"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"3b5f97b0-04f6-4bc6-92c1-7570e76a47e1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_PowerOn_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"0e5f039e-9d5c-4196-b844-fcaab5065004","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"}],"description":"","message_list":[],"uuid":"75216d24-aace-4a81-b784-609a5faa5be6","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"2a1da486-8ada-422b-a8c3-11263aac1c08"},"name":"SYS_GEN__Runbook_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"}},{"description":"System action for restarting an application","message_list":[],"uuid":"70501c2d-eb0d-413d-93c3-7c2ae963c3dd","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"DAG","uuid":"8bf92f3e-72e2-437b-8cdd-4dc0fcd55d19","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_Restart_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"73442992-d46f-40ff-87d2-91c474e346fb"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"94093609-ae59-4d9a-b659-50c8fb0eec67"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_Restart_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"73442992-d46f-40ff-87d2-91c474e346fb"},"edge_type":"inherent","type":"","uuid":"11af953a-e640-448e-96ee-7faa8e49af2c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"94093609-ae59-4d9a-b659-50c8fb0eec67"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"73442992-d46f-40ff-87d2-91c474e346fb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_Restart_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"94093609-ae59-4d9a-b659-50c8fb0eec67","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"}],"description":"","message_list":[],"uuid":"58877011-609a-4aa8-9014-3c64fe37229e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"8bf92f3e-72e2-437b-8cdd-4dc0fcd55d19"},"name":"SYS_GEN__Runbook_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"}},{"description":"System action for suspending an application","message_list":[],"uuid":"a676c9a8-3481-453d-bf06-502d79f6d374","name":"action_suspend","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"DAG","uuid":"81a6ad2b-098e-47b6-aedb-0f0c6b9afa60","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"}],"description":"","message_list":[],"uuid":"c9cb127f-6472-4994-bfd7-17ce063f9866","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"81a6ad2b-098e-47b6-aedb-0f0c6b9afa60"},"name":"SYS_GEN__Runbook_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"}},{"description":"System action for modifying an application","message_list":[],"uuid":"f8ca7744-bf12-4559-b86c-3166bd287ebe","name":"action_modify","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"DAG","uuid":"4b254970-c491-4a25-b44a-99b5f738c134","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"}],"description":"","message_list":[],"uuid":"0eae75d4-592b-4c76-8151-e20bb9541076","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"4b254970-c491-4a25-b44a-99b5f738c134"},"name":"SYS_GEN__Runbook_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"}},{"description":"System action for powering off an application","message_list":[],"uuid":"f7dbc3f8-10f5-4b66-a531-199fe8748bfe","name":"action_poweroff","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"DAG","uuid":"eeafcb77-f473-4d36-a77b-3c45927bbea3","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOff_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"7b1985c5-7e60-4975-929d-551f238a8d2a"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"7b1985c5-7e60-4975-929d-551f238a8d2a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_PowerOff_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"}],"description":"","message_list":[],"uuid":"4cca75d8-075a-41cd-ad38-e833d4c269df","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"eeafcb77-f473-4d36-a77b-3c45927bbea3"},"name":"SYS_GEN__Runbook_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"1113ba86-a41b-4685-b22b-14697fd77c9b","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"DAG","uuid":"341a6931-aadb-415d-be7c-2ad253d7657f","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Delete_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"b8921e43-2411-475c-bf1e-3376ce78ba17"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"DELETE_NUTANIX","uuid":"b8921e43-2411-475c-bf1e-3376ce78ba17","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Delete_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"}],"description":"","message_list":[],"uuid":"4a69cf91-6008-41ca-961d-7bf1f8a03ae3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"341a6931-aadb-415d-be7c-2ad253d7657f"},"name":"SYS_GEN__Runbook_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"9a7410eb-2aa9-46c0-98ba-6cf8f8346eba","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"DAG","uuid":"6a660b8b-2820-4617-ad73-f2b1fce1a624","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Substrate_Element_Delete_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"06760c43-11e3-4725-8d25-eba99b12d22b"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"06760c43-11e3-4725-8d25-eba99b12d22b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Substrate_Element_Delete_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"}],"description":"","message_list":[],"uuid":"ea14db9b-6d77-4831-9085-1808af033e31","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"6a660b8b-2820-4617-ad73-f2b1fce1a624"},"name":"SYS_GEN__Runbook_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"}}],"message_list":[{"message":"editable 0 is not a valid list index","reason":"INVALID_EDITABLE","details":[{"attribute_name":"0"}]}],"uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1","state":"DRAFT","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"0","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS","uuid":"5314d554-0539-406b-95eb-faa834a6ef81"}},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"name":true,"resources":{"nic_list":{"0":{"subnet_reference":true}},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"guest_customization":true,"disk_list":{"1":{"disk_size_mib":true},"3":{"disk_size_mib":true},"2":{"disk_size_mib":true}}}}},"os_type":"Linux","type":"AHV_VM","create_spec":{"name":"K8SM-@@{calm_array_index}@@-@@{calm_time}@@","categories":"","availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"resources":{"nic_list":[],"parent_reference":null,"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"serial_port_list":[],"gpu_list":[],"memory_size_mib":2048,"power_state":"ON","hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{INSTANCE_PUBLIC_KEY}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"type":"","boot_config":{"boot_device":{"type":"","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CENTOS_74","uuid":"6cbb9b5f-3255-4d45-8d8f-0891f27ac147"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":1,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":2,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":3,"type":""}}}]}},"variable_list":[],"name":"AHV_Centos_K8SM"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"3d4ca798-e63d-4e18-93d2-96edcd752446","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"DAG","uuid":"d4206629-3c90-48bf-b05a-7ab1738f2101","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Aws_Provision_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"aa54d3e1-9e10-4f6e-8da5-8d2893b5043b"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AWS_Centos_K8SC_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"f3c85de2-c73b-4883-91f8-fc5c9c0f048c"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Aws_Provision_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"aa54d3e1-9e10-4f6e-8da5-8d2893b5043b"},"edge_type":"inherent","type":"","uuid":"de5c7b19-ecce-4ce8-b0ec-61ef689ffd16","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AWS_Centos_K8SC_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"f3c85de2-c73b-4883-91f8-fc5c9c0f048c"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"PROVISION_AWS_VM","uuid":"aa54d3e1-9e10-4f6e-8da5-8d2893b5043b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"name":"K8SC-@@{calm_array_index}@@-@@{calm_time}@@","availability_zone_reference":null,"backup_policy":null,"type":"PROVISION_AWS_VM","cluster_reference":null,"resources":{"instance_profile_name":"","instance_type":"","subnet_id":"","key_name":"","region":"","availability_zone":"","instance_initiated_shutdown_behavior":"","user_data":"","image_id":"","state":"RUNNING","security_group_list":[{"type":"","security_group_id":""}],"block_device_map":{"data_disk_list":[{"size_gb":10,"volume_type":"GP2","device_name":"\/dev\/sdb","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"GP2","device_name":"\/dev\/sdc","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"GP2","device_name":"\/dev\/sdd","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"STANDARD","device_name":"\/dev\/sde","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"STANDARD","device_name":"\/dev\/sdf","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"STANDARD","device_name":"\/dev\/sdg","iops":1,"snapshot_id":"","type":"","delete_on_termination":true}],"type":"","root_disk":{"size_gb":10,"volume_type":"GP2","device_name":"\/dev\/sda1","iops":1,"snapshot_id":"","type":"","delete_on_termination":true}},"private_ip_address":"","vpc_id":"","tag_list":[{"type":"","value":"true","key":"kubernetes.io\/cluster\/@@{KUBE_CLUSTER_NAME}@@"}],"type":"","account_uuid":"8c2e0a6b-620a-c62a-c3f4-e58b101dfd0d","associate_public_ip_address":true}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Aws_Provision_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"f3c85de2-c73b-4883-91f8-fc5c9c0f048c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{public_ip_address}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AWS_Centos_K8SC_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"}],"description":"","message_list":[],"uuid":"8483e6d4-c7f2-4892-9db9-bf02f918ed0e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"d4206629-3c90-48bf-b05a-7ab1738f2101"},"name":"SYS_GEN__Runbook_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"}},{"description":"System action for powering on an application","message_list":[],"uuid":"51436ba5-2aef-420d-9009-09669be1fa3d","name":"action_poweron","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"DAG","uuid":"ecfafc14-e830-413d-8dde-7b47701cdfbe","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Aws_Operation_PowerOn_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"445d3543-e478-46fb-a449-e1191d63a779"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AWS_Centos_K8SC_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"7c8c6d85-641c-4427-bc25-671881d679ff"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Aws_Operation_PowerOn_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"445d3543-e478-46fb-a449-e1191d63a779"},"edge_type":"inherent","type":"","uuid":"6f5dee37-9a1d-4277-8424-49d68cfd4698","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AWS_Centos_K8SC_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"7c8c6d85-641c-4427-bc25-671881d679ff"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"VMOPERATION_AWS_VM","uuid":"445d3543-e478-46fb-a449-e1191d63a779","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Aws_Operation_PowerOn_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"7c8c6d85-641c-4427-bc25-671881d679ff","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{public_ip_address}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AWS_Centos_K8SC_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"}],"description":"","message_list":[],"uuid":"959c1cfd-ac3c-4780-a3c6-78006fe552d8","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"ecfafc14-e830-413d-8dde-7b47701cdfbe"},"name":"SYS_GEN__Runbook_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"}},{"description":"System action for restarting an application","message_list":[],"uuid":"15ffcefa-4ac3-40a0-bb34-73c65b92bc04","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"DAG","uuid":"8af934dd-dcc7-472a-8a40-bae4f7142355","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Aws_Operation_Restart_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"b57003bf-7969-47cc-ae87-e1be65b84bc3"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AWS_Centos_K8SC_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"23640ce3-a2dc-47a6-b88b-d50ac9485399"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Aws_Operation_Restart_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"b57003bf-7969-47cc-ae87-e1be65b84bc3"},"edge_type":"inherent","type":"","uuid":"35422baa-eaa4-4746-bcca-5a63e8e6fba3","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AWS_Centos_K8SC_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"23640ce3-a2dc-47a6-b88b-d50ac9485399"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"VMOPERATION_AWS_VM","uuid":"b57003bf-7969-47cc-ae87-e1be65b84bc3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Aws_Operation_Restart_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"23640ce3-a2dc-47a6-b88b-d50ac9485399","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{public_ip_address}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AWS_Centos_K8SC_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"}],"description":"","message_list":[],"uuid":"5a293fb1-1872-4c27-8463-927e83b262ab","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"8af934dd-dcc7-472a-8a40-bae4f7142355"},"name":"SYS_GEN__Runbook_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"}},{"description":"System action for suspending an application","message_list":[],"uuid":"432da9c8-017e-486b-b67d-e4c18cd5318f","name":"action_suspend","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"DAG","uuid":"436ca727-ceb3-4fba-a341-c832a32e2be6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"}],"description":"","message_list":[],"uuid":"b462220f-c96e-45d7-9615-bf415a3d776d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"436ca727-ceb3-4fba-a341-c832a32e2be6"},"name":"SYS_GEN__Runbook_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"}},{"description":"System action for modifying an application","message_list":[],"uuid":"7a8b74ab-ad97-4076-8ad1-703818f11083","name":"action_modify","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"DAG","uuid":"98bc979d-cbc1-4ba0-b5eb-41e723948b97","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"}],"description":"","message_list":[],"uuid":"10367e72-ddfe-4319-9c0b-03ca27879607","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"98bc979d-cbc1-4ba0-b5eb-41e723948b97"},"name":"SYS_GEN__Runbook_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"}},{"description":"System action for powering off an application","message_list":[],"uuid":"0622866d-78b2-4de4-9462-ec45f739603a","name":"action_poweroff","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"DAG","uuid":"fade42ef-918b-4fce-942d-0d2377911d54","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Aws_Operation_PowerOff_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"5e3162c6-2556-4a0f-94f5-5824a71fa58e"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"VMOPERATION_AWS_VM","uuid":"5e3162c6-2556-4a0f-94f5-5824a71fa58e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Aws_Operation_PowerOff_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"}],"description":"","message_list":[],"uuid":"18e921b6-2c59-410e-ae6c-b1270ba17b36","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"fade42ef-918b-4fce-942d-0d2377911d54"},"name":"SYS_GEN__Runbook_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"7ba0246b-2593-4a06-9064-01edcb88296d","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"DAG","uuid":"cb0fbc96-dab8-4805-a571-f38dd30ecb04","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Aws_Delete_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"a10f7b06-5dbf-4e99-aa1c-70f01faea5f2"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"DELETE_AWS_VM","uuid":"a10f7b06-5dbf-4e99-aa1c-70f01faea5f2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Aws_Delete_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"}],"description":"","message_list":[],"uuid":"6265517c-4786-44ff-a8eb-9973562e5492","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"cb0fbc96-dab8-4805-a571-f38dd30ecb04"},"name":"SYS_GEN__Runbook_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"d6cf732c-55f9-4cda-9a30-4e9fb628f6c7","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"DAG","uuid":"f71096ed-0e2e-4fe7-8e2d-e542dbca82f5","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Substrate_Element_Delete_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"74190218-126e-4413-af2b-b653601762c8"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"74190218-126e-4413-af2b-b653601762c8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Substrate_Element_Delete_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"}],"description":"","message_list":[],"uuid":"69afda04-66da-4e92-a707-33e3d9483d51","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"f71096ed-0e2e-4fe7-8e2d-e542dbca82f5"},"name":"SYS_GEN__Runbook_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"}}],"message_list":[{"message":"Region is a required field","reason":"EMPTY_VALUE","details":[{"attribute_name":"region"}]}],"uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61","state":"DRAFT","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{public_ip_address}@@","delay_secs":"0","connection_port":22},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"name":true,"resources":{"instance_type":true,"instance_profile_name":true,"availability_zone":true,"subnet_id":true,"key_name":true,"region":true,"user_data":true,"image_id":true,"security_group_list":true,"block_device_map":{"data_disk_list":{"1":{"size_gb":true},"0":{"size_gb":true},"3":{"size_gb":true},"2":{"size_gb":true},"5":{"size_gb":true},"4":{"size_gb":true}},"root_disk":{"size_gb":true}},"associate_public_ip_address":true,"vpc_id":true,"tag_list":true}}},"os_type":"Linux","type":"AWS_VM","create_spec":{"name":"K8SC-@@{calm_array_index}@@-@@{calm_time}@@","availability_zone_reference":null,"backup_policy":null,"type":"PROVISION_AWS_VM","cluster_reference":null,"resources":{"instance_profile_name":"","instance_type":"","subnet_id":"","key_name":"","region":"","availability_zone":"","instance_initiated_shutdown_behavior":"","user_data":"","image_id":"","state":"RUNNING","security_group_list":[{"type":"","security_group_id":""}],"block_device_map":{"data_disk_list":[{"size_gb":10,"volume_type":"GP2","device_name":"\/dev\/sdb","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"GP2","device_name":"\/dev\/sdc","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"GP2","device_name":"\/dev\/sdd","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"STANDARD","device_name":"\/dev\/sde","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"STANDARD","device_name":"\/dev\/sdf","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"STANDARD","device_name":"\/dev\/sdg","iops":1,"snapshot_id":"","type":"","delete_on_termination":true}],"type":"","root_disk":{"size_gb":10,"volume_type":"GP2","device_name":"\/dev\/sda1","iops":1,"snapshot_id":"","type":"","delete_on_termination":true}},"private_ip_address":"","vpc_id":"","tag_list":[{"type":"","value":"true","key":"kubernetes.io\/cluster\/@@{KUBE_CLUSTER_NAME}@@"}],"type":"","account_uuid":"8c2e0a6b-620a-c62a-c3f4-e58b101dfd0d","associate_public_ip_address":true}},"variable_list":[],"name":"AWS_Centos_K8SC"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"0805d910-7143-4b4d-a755-1402c5d3d42e","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"DAG","uuid":"a6cc9313-16b3-47de-818d-8bc2f7dc0858","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Aws_Provision_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"f8895d35-9517-4fab-a280-1e1da3b69269"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AWS_Centos_K8SM_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"6f5fb139-987a-465a-93b6-b75c11a198fe"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Aws_Provision_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"f8895d35-9517-4fab-a280-1e1da3b69269"},"edge_type":"inherent","type":"","uuid":"33080e1d-8a38-4d86-8578-709069b30d05","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AWS_Centos_K8SM_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"6f5fb139-987a-465a-93b6-b75c11a198fe"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"PROVISION_AWS_VM","uuid":"f8895d35-9517-4fab-a280-1e1da3b69269","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"name":"K8SM-@@{calm_array_index}@@-@@{calm_time}@@","availability_zone_reference":null,"backup_policy":null,"type":"PROVISION_AWS_VM","cluster_reference":null,"resources":{"instance_profile_name":"","instance_type":"","subnet_id":"","key_name":"","region":"","availability_zone":"","instance_initiated_shutdown_behavior":"","user_data":"","image_id":"","state":"RUNNING","security_group_list":[{"type":"","security_group_id":""}],"block_device_map":{"data_disk_list":[{"size_gb":8,"volume_type":"GP2","device_name":"\/dev\/sdb","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":8,"volume_type":"GP2","device_name":"\/dev\/sdc","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":8,"volume_type":"GP2","device_name":"\/dev\/sdd","iops":1,"snapshot_id":"","type":"","delete_on_termination":true}],"type":"","root_disk":{"size_gb":8,"volume_type":"GP2","device_name":"\/dev\/sda1","iops":1,"snapshot_id":"","type":"","delete_on_termination":true}},"private_ip_address":"","vpc_id":"","tag_list":[{"type":"","value":"owned","key":"kubernetes.io\/cluster\/@@{KUBE_CLUSTER_NAME}@@"}],"type":"","account_uuid":"8c2e0a6b-620a-c62a-c3f4-e58b101dfd0d","associate_public_ip_address":true}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Aws_Provision_a1988180_74c0_4c96_8ef4_78df7d762950"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"6f5fb139-987a-465a-93b6-b75c11a198fe","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{public_ip_address}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AWS_Centos_K8SM_a1988180_74c0_4c96_8ef4_78df7d762950"}],"description":"","message_list":[],"uuid":"def6e2c5-b303-4ec8-b188-15372bb95b3c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"a6cc9313-16b3-47de-818d-8bc2f7dc0858"},"name":"SYS_GEN__Runbook_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950"}},{"description":"System action for powering on an application","message_list":[],"uuid":"00a638a2-6af3-4d5d-8978-d585b35fe3b4","name":"action_poweron","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"DAG","uuid":"6f3bb3c7-df28-42f8-ac34-87230fd358c0","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Aws_Operation_PowerOn_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"c79cc789-503e-46ff-a347-74532f5eb094"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AWS_Centos_K8SM_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"c346a50d-7d46-44c7-9278-7b7b325ff3ce"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Aws_Operation_PowerOn_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"c79cc789-503e-46ff-a347-74532f5eb094"},"edge_type":"inherent","type":"","uuid":"693dd0d8-46a0-4e7f-a5c0-240bdff317eb","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AWS_Centos_K8SM_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"c346a50d-7d46-44c7-9278-7b7b325ff3ce"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"VMOPERATION_AWS_VM","uuid":"c79cc789-503e-46ff-a347-74532f5eb094","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Aws_Operation_PowerOn_a1988180_74c0_4c96_8ef4_78df7d762950"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"c346a50d-7d46-44c7-9278-7b7b325ff3ce","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{public_ip_address}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AWS_Centos_K8SM_a1988180_74c0_4c96_8ef4_78df7d762950"}],"description":"","message_list":[],"uuid":"57f10355-32b0-465b-98d7-569944a5b82d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"6f3bb3c7-df28-42f8-ac34-87230fd358c0"},"name":"SYS_GEN__Runbook_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950"}},{"description":"System action for restarting an application","message_list":[],"uuid":"39c461ff-2829-4723-abba-01255fc90f23","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"DAG","uuid":"078fd0a8-13e4-4503-94a7-32ef0fe6c9e2","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Aws_Operation_Restart_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"0917c7d0-b447-4aff-883c-6a1133929c9b"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AWS_Centos_K8SM_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"dac29ceb-f44f-48ed-aa12-b5d727cb11c1"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Aws_Operation_Restart_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"0917c7d0-b447-4aff-883c-6a1133929c9b"},"edge_type":"inherent","type":"","uuid":"1eb7139f-9f82-4042-9a3b-a2526d7a6b73","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AWS_Centos_K8SM_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"dac29ceb-f44f-48ed-aa12-b5d727cb11c1"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"VMOPERATION_AWS_VM","uuid":"0917c7d0-b447-4aff-883c-6a1133929c9b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Aws_Operation_Restart_a1988180_74c0_4c96_8ef4_78df7d762950"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"dac29ceb-f44f-48ed-aa12-b5d727cb11c1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{public_ip_address}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AWS_Centos_K8SM_a1988180_74c0_4c96_8ef4_78df7d762950"}],"description":"","message_list":[],"uuid":"b588a0aa-9805-4e09-aba8-895eab6ce1fc","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"078fd0a8-13e4-4503-94a7-32ef0fe6c9e2"},"name":"SYS_GEN__Runbook_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950"}},{"description":"System action for suspending an application","message_list":[],"uuid":"df709100-002d-4314-b611-dab35c034290","name":"action_suspend","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"DAG","uuid":"40373bc6-c640-4b45-b2ea-67256a896002","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950"}],"description":"","message_list":[],"uuid":"0b61292f-58a5-4ceb-984e-b696defbbfd4","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"40373bc6-c640-4b45-b2ea-67256a896002"},"name":"SYS_GEN__Runbook_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950"}},{"description":"System action for modifying an application","message_list":[],"uuid":"4521afee-18b6-4005-a894-8e3b860de448","name":"action_modify","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"DAG","uuid":"0bebb5cf-efc7-4f9b-b9eb-82def64d43fc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950"}],"description":"","message_list":[],"uuid":"e4cf1e2e-d648-4578-8fce-d4f81bb96c56","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"0bebb5cf-efc7-4f9b-b9eb-82def64d43fc"},"name":"SYS_GEN__Runbook_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950"}},{"description":"System action for powering off an application","message_list":[],"uuid":"04523384-d9a9-4f34-bc80-00ee65305f3f","name":"action_poweroff","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"DAG","uuid":"2db52fdc-9027-43d0-af65-cada0dfaee8c","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Aws_Operation_PowerOff_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"c13d61e0-081a-4fb0-af49-5c1bd04c5346"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"VMOPERATION_AWS_VM","uuid":"c13d61e0-081a-4fb0-af49-5c1bd04c5346","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Aws_Operation_PowerOff_a1988180_74c0_4c96_8ef4_78df7d762950"}],"description":"","message_list":[],"uuid":"40427dd3-54dc-4590-81fe-773009583773","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"2db52fdc-9027-43d0-af65-cada0dfaee8c"},"name":"SYS_GEN__Runbook_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"1d304b2f-c41c-41ea-9e83-af09cf49a150","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"DAG","uuid":"26e9174a-af0b-43f0-b84a-6b310afd094f","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Aws_Delete_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"c2366f06-11e5-45f4-9235-4c4e41d34036"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"DELETE_AWS_VM","uuid":"c2366f06-11e5-45f4-9235-4c4e41d34036","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Aws_Delete_a1988180_74c0_4c96_8ef4_78df7d762950"}],"description":"","message_list":[],"uuid":"93942b54-fdd6-47fd-9032-05631aa55b79","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"26e9174a-af0b-43f0-b84a-6b310afd094f"},"name":"SYS_GEN__Runbook_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"a9be22ea-244f-45df-9431-c63e50bc859b","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"DAG","uuid":"2cfec175-b203-40ed-87dd-fe35d5d1b340","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Substrate_Element_Delete_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"e21e636f-ab9d-4d2c-bd91-4d92dab30647"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"e21e636f-ab9d-4d2c-bd91-4d92dab30647","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Substrate_Element_Delete_a1988180_74c0_4c96_8ef4_78df7d762950"}],"description":"","message_list":[],"uuid":"f8a5bf98-f18f-44d5-bf70-d5cd0568e9ab","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"2cfec175-b203-40ed-87dd-fe35d5d1b340"},"name":"SYS_GEN__Runbook_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950"}}],"message_list":[{"message":"Region is a required field","reason":"EMPTY_VALUE","details":[{"attribute_name":"region"}]}],"uuid":"a1988180-74c0-4c96-8ef4-78df7d762950","state":"DRAFT","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{public_ip_address}@@","delay_secs":"0","connection_port":22},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"name":true,"resources":{"instance_type":true,"instance_profile_name":true,"availability_zone":true,"subnet_id":true,"key_name":true,"region":true,"user_data":true,"image_id":true,"security_group_list":true,"block_device_map":{"data_disk_list":{"1":{"size_gb":true},"0":{"size_gb":true},"2":{"size_gb":true}},"root_disk":{"size_gb":true}},"associate_public_ip_address":true,"vpc_id":true,"tag_list":true}}},"os_type":"Linux","type":"AWS_VM","create_spec":{"name":"K8SM-@@{calm_array_index}@@-@@{calm_time}@@","availability_zone_reference":null,"backup_policy":null,"type":"PROVISION_AWS_VM","cluster_reference":null,"resources":{"instance_profile_name":"","instance_type":"","subnet_id":"","key_name":"","region":"","availability_zone":"","instance_initiated_shutdown_behavior":"","user_data":"","image_id":"","state":"RUNNING","security_group_list":[{"type":"","security_group_id":""}],"block_device_map":{"data_disk_list":[{"size_gb":8,"volume_type":"GP2","device_name":"\/dev\/sdb","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":8,"volume_type":"GP2","device_name":"\/dev\/sdc","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":8,"volume_type":"GP2","device_name":"\/dev\/sdd","iops":1,"snapshot_id":"","type":"","delete_on_termination":true}],"type":"","root_disk":{"size_gb":8,"volume_type":"GP2","device_name":"\/dev\/sda1","iops":1,"snapshot_id":"","type":"","delete_on_termination":true}},"private_ip_address":"","vpc_id":"","tag_list":[{"type":"","value":"owned","key":"kubernetes.io\/cluster\/@@{KUBE_CLUSTER_NAME}@@"}],"type":"","account_uuid":"8c2e0a6b-620a-c62a-c3f4-e58b101dfd0d","associate_public_ip_address":true}},"variable_list":[],"name":"AWS_Centos_K8SM"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"d51c20f9-0db4-4d40-8273-d74a770307ec","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"DAG","uuid":"d02cdc9d-e095-4fa5-803e-3e251b74dd47","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Gcp_Provision_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"f35a035e-71f2-4e67-b123-f95b29581fd7"},{"kind":"app_task","name":"SYS_GEN__check_login_for_GCP_Centos_K8SC_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"da6aec80-c9a5-4254-88e1-114f80fae47c"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Gcp_Provision_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"f35a035e-71f2-4e67-b123-f95b29581fd7"},"edge_type":"inherent","type":"","uuid":"cd543c52-1d0f-4f8e-b117-7e7ba5a585a6","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_GCP_Centos_K8SC_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"da6aec80-c9a5-4254-88e1-114f80fae47c"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"PROVISION_GCP_VM","uuid":"f35a035e-71f2-4e67-b123-f95b29581fd7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"PROVISION_GCP_VM","resources":{"labels":[],"machineType":"","description":"","zone":"","tags":{"items":[],"type":"","fingerprint":""},"guestCustomization":{"type":"","sysprep":"","startupScript":""},"labelFingerprint":"","disks":[{"diskEncryptionKey":{"rawKey":"","type":""},"deviceName":"","initializeParams":{"sourceImageEncryptionKey":{"rawKey":"","type":""},"diskName":"","diskType":"","diskSizeGb":10,"sourceImage":"","type":""},"autoDelete":true,"boot":true,"source":"","mode":"","interface":"","disk_type":"PERSISTENT","type":""}],"metadata":{"items":[],"type":"","fingerprint":""},"sshKeys":["centos:ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDMGAS\/K0Mb\/uwFXwD+hkjguy7VMZk2hpuhwPl9FUZwVBrURf\/i9QMJ5\/paPEZixu8VlRx7Inu4iun7rQfrnfeIYInmBwspXHYiTK3oHJAgZnrAHVEf1p6YaxLINlT1NI5yOAGPRWW6of8rBDBH1ObwU2+wcSx\/1H0uIs3aZNLufr+Rh628ACxAum2Gt8AVRj6ua2BPFyt5VTdclyysAmeh1AiixNgOZXOz6y\/i4TbzpY78I3isuKpxsUeXX6jxEMQol406jHDUF6njEOPIQG2zVZ3QJlTG9OlN+NiyZG9WkZz0VG\/6M8ixxIHHI2dNwUbBFv2HUu+8X9LTLFq2O7KjX9Hp7uZKBAySHA3eKaKHIp2bZuU1bT5PRPkggngX86xg+T+OMNnutbAiMnRJ8+FvD5So+5TIx4b9GgxAxure3x2yRPT9lOiQOB+CVpJPxR0Rn9bOI+wiPnD0kAGvK\/fHT+pqL4PM+hTnJtp9rrCRzIQApBx1263jEcYffhW2epZQRO+he5CMawFJ5TBe08om2AaDJ8GQdrpF6YA3W8DzHbmL3DPVVHdmqPLn10o+LX4gv5SdIIDVGdjKOc1BCnLTRmM28d5+sLDt\/M+kvcQgf0y0yDjMVjGECZkt39hbm4ELMHzZtzYLmHNhBZxRqHeJ7qFTuv1kx88OW3Xc5mbBNQ== centos@nutanix.com\n"],"minCpuPlatform":"","scheduling":{"automaticRestart":true,"type":"","preemptible":false,"onHostMaintenance":"TERMINATE"},"canIpForward":false,"blankDisks":[{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk1-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk2-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk3-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk4-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk5-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk6-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true}],"networkInterfaces":[{"aliasIpRanges":[],"network":"","accessConfigs":[{"config_type":"ONE_TO_ONE_NAT","type":"","name":"k8sc-acn-@@{calm_array_index}@@-@@{calm_time}@@","natIP":""}],"networkIP":"","subnetwork":"","type":"","associatePublicIP":true}],"type":"","account_uuid":"84213a31-4fe8-7e39-3799-e093e5d0dc2e","serviceAccounts":[{"scopes":[],"type":"","email":"108048128720-compute@developer.gserviceaccount.com"}],"name":"k8sc-@@{calm_array_index}@@-@@{calm_time}@@"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Gcp_Provision_b970ceaa_d23f_40d6_80ae_26f475a587e3"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"da6aec80-c9a5-4254-88e1-114f80fae47c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{public_ip_address}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_GCP_Centos_K8SC_b970ceaa_d23f_40d6_80ae_26f475a587e3"}],"description":"","message_list":[],"uuid":"cee442f5-479a-4b78-ac00-d34a2169f479","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"d02cdc9d-e095-4fa5-803e-3e251b74dd47"},"name":"SYS_GEN__Runbook_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3"}},{"description":"System action for powering on an application","message_list":[],"uuid":"f5eeed5b-cfbd-48e5-90f3-1c9f370604f4","name":"action_poweron","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"DAG","uuid":"b52f7cd0-0672-4307-9dc9-89da320f30af","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Gcp_Operation_PowerOn_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"ab7b6218-c2d9-4e4f-836d-accdc9389aaa"},{"kind":"app_task","name":"SYS_GEN__check_login_for_GCP_Centos_K8SC_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"62c21c5a-612e-47c8-a7ce-2a6026044682"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Gcp_Operation_PowerOn_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"ab7b6218-c2d9-4e4f-836d-accdc9389aaa"},"edge_type":"inherent","type":"","uuid":"775d81e3-8aab-4925-a78f-49545e0d51d9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_GCP_Centos_K8SC_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"62c21c5a-612e-47c8-a7ce-2a6026044682"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"VMOPERATION_GCP_VM","uuid":"ab7b6218-c2d9-4e4f-836d-accdc9389aaa","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Gcp_Operation_PowerOn_b970ceaa_d23f_40d6_80ae_26f475a587e3"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"62c21c5a-612e-47c8-a7ce-2a6026044682","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{public_ip_address}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_GCP_Centos_K8SC_b970ceaa_d23f_40d6_80ae_26f475a587e3"}],"description":"","message_list":[],"uuid":"3d0c95eb-529e-42af-adbf-b7248e8cd33b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"b52f7cd0-0672-4307-9dc9-89da320f30af"},"name":"SYS_GEN__Runbook_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3"}},{"description":"System action for restarting an application","message_list":[],"uuid":"0f29f73d-46ba-4790-ae32-609953f68c81","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"DAG","uuid":"b3d5dffa-c90d-4a65-ab30-108338fdc130","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Gcp_Operation_Restart_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"7593ff66-5378-4854-bba1-51057ffbcb35"},{"kind":"app_task","name":"SYS_GEN__check_login_for_GCP_Centos_K8SC_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"cbfaa455-18f5-4fd8-913a-d36b3d2cca12"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Gcp_Operation_Restart_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"7593ff66-5378-4854-bba1-51057ffbcb35"},"edge_type":"inherent","type":"","uuid":"78d75ec8-8517-4bb9-a6bf-49324d84bfe6","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_GCP_Centos_K8SC_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"cbfaa455-18f5-4fd8-913a-d36b3d2cca12"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"VMOPERATION_GCP_VM","uuid":"7593ff66-5378-4854-bba1-51057ffbcb35","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Gcp_Operation_Restart_b970ceaa_d23f_40d6_80ae_26f475a587e3"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"cbfaa455-18f5-4fd8-913a-d36b3d2cca12","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{public_ip_address}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_GCP_Centos_K8SC_b970ceaa_d23f_40d6_80ae_26f475a587e3"}],"description":"","message_list":[],"uuid":"3f4a46b1-bc49-426d-80ce-ee54ce5fd40a","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"b3d5dffa-c90d-4a65-ab30-108338fdc130"},"name":"SYS_GEN__Runbook_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3"}},{"description":"System action for suspending an application","message_list":[],"uuid":"49e29802-e6de-4e5e-b146-f5afb9dcd658","name":"action_suspend","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"DAG","uuid":"3e8d506f-08ce-490b-8e06-dc43bde2444c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3"}],"description":"","message_list":[],"uuid":"d5aec6b7-ee1b-4860-9df1-7108a93570e0","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"3e8d506f-08ce-490b-8e06-dc43bde2444c"},"name":"SYS_GEN__Runbook_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3"}},{"description":"System action for modifying an application","message_list":[],"uuid":"97f590bb-3150-4950-bacc-50be9fab9252","name":"action_modify","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"DAG","uuid":"dd56ed48-2981-4b7f-bf74-84368fe37bd9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3"}],"description":"","message_list":[],"uuid":"45a4a32e-8241-4162-9980-bd03ce57fab2","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"dd56ed48-2981-4b7f-bf74-84368fe37bd9"},"name":"SYS_GEN__Runbook_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3"}},{"description":"System action for powering off an application","message_list":[],"uuid":"833788b5-a969-4260-9dd1-72c40f3dbdff","name":"action_poweroff","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"DAG","uuid":"0fdb3a16-bf76-417d-a9cd-9b2e16895cf7","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Gcp_Operation_PowerOff_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"fb339c71-816c-4a99-bd5f-edff5f4a7134"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"VMOPERATION_GCP_VM","uuid":"fb339c71-816c-4a99-bd5f-edff5f4a7134","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Gcp_Operation_PowerOff_b970ceaa_d23f_40d6_80ae_26f475a587e3"}],"description":"","message_list":[],"uuid":"6236dfbc-4e3e-4f48-8c7e-bc77d5eb300d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"0fdb3a16-bf76-417d-a9cd-9b2e16895cf7"},"name":"SYS_GEN__Runbook_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"349b924e-13a3-44bc-af0b-abc822845ef0","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"DAG","uuid":"36aee9cc-cf68-4984-bfba-a25a8b8df414","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Gcp_Delete_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"2767e646-a8c8-44a2-97e5-35279717b13d"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"DELETE_GCP_VM","uuid":"2767e646-a8c8-44a2-97e5-35279717b13d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Gcp_Delete_b970ceaa_d23f_40d6_80ae_26f475a587e3"}],"description":"","message_list":[],"uuid":"8b6d072e-7e87-4c04-a89f-88296a863ed8","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"36aee9cc-cf68-4984-bfba-a25a8b8df414"},"name":"SYS_GEN__Runbook_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"3c72f758-236d-4903-8a94-98f0a94afe2f","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"DAG","uuid":"3be23119-98e8-41d5-87f3-1ae541d5eb78","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Substrate_Element_Delete_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"c99a9156-b752-456c-a6eb-a3e9e771e82f"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"c99a9156-b752-456c-a6eb-a3e9e771e82f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Substrate_Element_Delete_b970ceaa_d23f_40d6_80ae_26f475a587e3"}],"description":"","message_list":[],"uuid":"212033aa-f4d3-4ba4-82a1-a2629db48907","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"3be23119-98e8-41d5-87f3-1ae541d5eb78"},"name":"SYS_GEN__Runbook_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3"}}],"message_list":[{"message":"Zone is a required field","reason":"EMPTY_VALUE","details":[{"attribute_name":"zone"}]},{"message":"Machine type is a required field","reason":"EMPTY_VALUE","details":[{"attribute_name":"machineType"}]},{"message":"Either source image or disk source should be specified in custom disks","reason":"MISSING_VALUE","details":[{"attribute_name":"source"}]}],"uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3","state":"DRAFT","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{public_ip_address}@@","delay_secs":"0","connection_port":22},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"resources":{"disks":{"0":{"initializeParams":{"diskSizeGb":true,"sourceImage":true,"diskType":true},"autoDelete":true}},"machineType":true,"name":true,"zone":true,"tags":{"items":true},"guestCustomization":{"startupScript":true},"labels":true,"blankDisks":{"1":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true},"0":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true},"3":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true},"2":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true},"5":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true},"4":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true}},"metadata":{"items":true},"sshKeys":{"0":true},"serviceAccounts":{"0":{"scopes":true,"email":true}},"networkInterfaces":{"0":{"accessConfigs":{"0":{"config_type":true,"name":true}},"network":true,"subnetwork":true}}}}},"os_type":"Linux","type":"GCP_VM","create_spec":{"type":"PROVISION_GCP_VM","resources":{"labels":[],"machineType":"","description":"","zone":"","tags":{"items":[],"type":"","fingerprint":""},"guestCustomization":{"type":"","sysprep":"","startupScript":""},"labelFingerprint":"","disks":[{"diskEncryptionKey":{"rawKey":"","type":""},"deviceName":"","initializeParams":{"sourceImageEncryptionKey":{"rawKey":"","type":""},"diskName":"","diskType":"","diskSizeGb":10,"sourceImage":"","type":""},"autoDelete":true,"boot":true,"source":"","mode":"","interface":"","disk_type":"PERSISTENT","type":""}],"metadata":{"items":[],"type":"","fingerprint":""},"sshKeys":["centos:ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDMGAS\/K0Mb\/uwFXwD+hkjguy7VMZk2hpuhwPl9FUZwVBrURf\/i9QMJ5\/paPEZixu8VlRx7Inu4iun7rQfrnfeIYInmBwspXHYiTK3oHJAgZnrAHVEf1p6YaxLINlT1NI5yOAGPRWW6of8rBDBH1ObwU2+wcSx\/1H0uIs3aZNLufr+Rh628ACxAum2Gt8AVRj6ua2BPFyt5VTdclyysAmeh1AiixNgOZXOz6y\/i4TbzpY78I3isuKpxsUeXX6jxEMQol406jHDUF6njEOPIQG2zVZ3QJlTG9OlN+NiyZG9WkZz0VG\/6M8ixxIHHI2dNwUbBFv2HUu+8X9LTLFq2O7KjX9Hp7uZKBAySHA3eKaKHIp2bZuU1bT5PRPkggngX86xg+T+OMNnutbAiMnRJ8+FvD5So+5TIx4b9GgxAxure3x2yRPT9lOiQOB+CVpJPxR0Rn9bOI+wiPnD0kAGvK\/fHT+pqL4PM+hTnJtp9rrCRzIQApBx1263jEcYffhW2epZQRO+he5CMawFJ5TBe08om2AaDJ8GQdrpF6YA3W8DzHbmL3DPVVHdmqPLn10o+LX4gv5SdIIDVGdjKOc1BCnLTRmM28d5+sLDt\/M+kvcQgf0y0yDjMVjGECZkt39hbm4ELMHzZtzYLmHNhBZxRqHeJ7qFTuv1kx88OW3Xc5mbBNQ== centos@nutanix.com\n"],"minCpuPlatform":"","scheduling":{"automaticRestart":true,"type":"","preemptible":false,"onHostMaintenance":"TERMINATE"},"canIpForward":false,"blankDisks":[{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk1-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk2-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk3-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk4-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk5-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk6-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true}],"networkInterfaces":[{"aliasIpRanges":[],"network":"","accessConfigs":[{"config_type":"ONE_TO_ONE_NAT","type":"","name":"k8sc-acn-@@{calm_array_index}@@-@@{calm_time}@@","natIP":""}],"networkIP":"","subnetwork":"","type":"","associatePublicIP":true}],"type":"","account_uuid":"84213a31-4fe8-7e39-3799-e093e5d0dc2e","serviceAccounts":[{"scopes":[],"type":"","email":"108048128720-compute@developer.gserviceaccount.com"}],"name":"k8sc-@@{calm_array_index}@@-@@{calm_time}@@"}},"variable_list":[],"name":"GCP_Centos_K8SC"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"6eab8d59-b901-428f-80a1-137f95554a7b","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"DAG","uuid":"c76fd12b-e3a7-4ac4-bcb6-6e4d29bb6d53","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Gcp_Provision_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"b7f4e6f9-1858-486f-aca1-309d6e3c2f37"},{"kind":"app_task","name":"SYS_GEN__check_login_for_GCP_Centos_K8SM_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"0e75559c-cc4c-4f22-bf51-452f11553bd6"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Gcp_Provision_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"b7f4e6f9-1858-486f-aca1-309d6e3c2f37"},"edge_type":"inherent","type":"","uuid":"96b237c9-430c-4fa7-adbc-009b899088b2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_GCP_Centos_K8SM_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"0e75559c-cc4c-4f22-bf51-452f11553bd6"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"PROVISION_GCP_VM","uuid":"b7f4e6f9-1858-486f-aca1-309d6e3c2f37","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"PROVISION_GCP_VM","resources":{"labels":[],"machineType":"","description":"","zone":"","tags":{"items":[],"type":"","fingerprint":""},"guestCustomization":{"type":"","sysprep":"","startupScript":""},"labelFingerprint":"","disks":[{"diskEncryptionKey":{"rawKey":"","type":""},"deviceName":"","initializeParams":{"sourceImageEncryptionKey":{"rawKey":"","type":""},"diskName":"","diskType":"","diskSizeGb":10,"sourceImage":"","type":""},"autoDelete":true,"boot":true,"source":"","mode":"","interface":"","disk_type":"PERSISTENT","type":""}],"metadata":{"items":[],"type":"","fingerprint":""},"sshKeys":["centos:ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDMGAS\/K0Mb\/uwFXwD+hkjguy7VMZk2hpuhwPl9FUZwVBrURf\/i9QMJ5\/paPEZixu8VlRx7Inu4iun7rQfrnfeIYInmBwspXHYiTK3oHJAgZnrAHVEf1p6YaxLINlT1NI5yOAGPRWW6of8rBDBH1ObwU2+wcSx\/1H0uIs3aZNLufr+Rh628ACxAum2Gt8AVRj6ua2BPFyt5VTdclyysAmeh1AiixNgOZXOz6y\/i4TbzpY78I3isuKpxsUeXX6jxEMQol406jHDUF6njEOPIQG2zVZ3QJlTG9OlN+NiyZG9WkZz0VG\/6M8ixxIHHI2dNwUbBFv2HUu+8X9LTLFq2O7KjX9Hp7uZKBAySHA3eKaKHIp2bZuU1bT5PRPkggngX86xg+T+OMNnutbAiMnRJ8+FvD5So+5TIx4b9GgxAxure3x2yRPT9lOiQOB+CVpJPxR0Rn9bOI+wiPnD0kAGvK\/fHT+pqL4PM+hTnJtp9rrCRzIQApBx1263jEcYffhW2epZQRO+he5CMawFJ5TBe08om2AaDJ8GQdrpF6YA3W8DzHbmL3DPVVHdmqPLn10o+LX4gv5SdIIDVGdjKOc1BCnLTRmM28d5+sLDt\/M+kvcQgf0y0yDjMVjGECZkt39hbm4ELMHzZtzYLmHNhBZxRqHeJ7qFTuv1kx88OW3Xc5mbBNQ== centos@nutanix.com\n"],"minCpuPlatform":"","scheduling":{"automaticRestart":true,"type":"","preemptible":false,"onHostMaintenance":"TERMINATE"},"canIpForward":false,"blankDisks":[{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sm-disk1-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sm-disk2-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sm-disk3-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true}],"networkInterfaces":[{"aliasIpRanges":[],"network":"","accessConfigs":[{"config_type":"ONE_TO_ONE_NAT","type":"","name":"k8sm-acm-@@{calm_array_index}@@-@@{calm_time}@@","natIP":""}],"networkIP":"","subnetwork":"","type":"","associatePublicIP":true}],"type":"","account_uuid":"84213a31-4fe8-7e39-3799-e093e5d0dc2e","serviceAccounts":[{"scopes":[],"type":"","email":"108048128720-compute@developer.gserviceaccount.com"}],"name":"k8sm-@@{calm_array_index}@@-@@{calm_time}@@"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Gcp_Provision_6b0f177a_9572_4df1_a6b8_71e996333516"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"0e75559c-cc4c-4f22-bf51-452f11553bd6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{public_ip_address}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_GCP_Centos_K8SM_6b0f177a_9572_4df1_a6b8_71e996333516"}],"description":"","message_list":[],"uuid":"0d56375e-2923-437e-bf82-3fcadfe99d53","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"c76fd12b-e3a7-4ac4-bcb6-6e4d29bb6d53"},"name":"SYS_GEN__Runbook_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516"}},{"description":"System action for powering on an application","message_list":[],"uuid":"09c23862-8fad-4fb6-9bdf-4847f69a7186","name":"action_poweron","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"DAG","uuid":"9eae9768-7a83-47f4-a6f6-19f95bcacfdb","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Gcp_Operation_PowerOn_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"112f5323-d36b-481f-a754-ea69f7227f5a"},{"kind":"app_task","name":"SYS_GEN__check_login_for_GCP_Centos_K8SM_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"df10f625-8a06-4193-b6e7-bcda2e4b292c"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Gcp_Operation_PowerOn_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"112f5323-d36b-481f-a754-ea69f7227f5a"},"edge_type":"inherent","type":"","uuid":"4b23a524-1e44-4c25-ba16-8fde03a0af47","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_GCP_Centos_K8SM_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"df10f625-8a06-4193-b6e7-bcda2e4b292c"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"VMOPERATION_GCP_VM","uuid":"112f5323-d36b-481f-a754-ea69f7227f5a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Gcp_Operation_PowerOn_6b0f177a_9572_4df1_a6b8_71e996333516"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"df10f625-8a06-4193-b6e7-bcda2e4b292c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{public_ip_address}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_GCP_Centos_K8SM_6b0f177a_9572_4df1_a6b8_71e996333516"}],"description":"","message_list":[],"uuid":"d21339ff-d200-48c4-af20-6a0d4d22d471","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"9eae9768-7a83-47f4-a6f6-19f95bcacfdb"},"name":"SYS_GEN__Runbook_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516"}},{"description":"System action for restarting an application","message_list":[],"uuid":"55885780-385b-44a2-acc6-367de108e7ca","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"DAG","uuid":"3ecac7ae-7f22-400b-ae32-68fe41a96dcc","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Gcp_Operation_Restart_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"aabd39cb-64a4-4bfc-9072-32c23b50b8c7"},{"kind":"app_task","name":"SYS_GEN__check_login_for_GCP_Centos_K8SM_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"86d9e473-16d3-493e-a686-fad7c1006e0d"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Gcp_Operation_Restart_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"aabd39cb-64a4-4bfc-9072-32c23b50b8c7"},"edge_type":"inherent","type":"","uuid":"c4981823-33d9-47d7-b29e-cb374e0f818a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_GCP_Centos_K8SM_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"86d9e473-16d3-493e-a686-fad7c1006e0d"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"VMOPERATION_GCP_VM","uuid":"aabd39cb-64a4-4bfc-9072-32c23b50b8c7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Gcp_Operation_Restart_6b0f177a_9572_4df1_a6b8_71e996333516"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"86d9e473-16d3-493e-a686-fad7c1006e0d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{public_ip_address}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_GCP_Centos_K8SM_6b0f177a_9572_4df1_a6b8_71e996333516"}],"description":"","message_list":[],"uuid":"791cffbe-7c39-4058-b17a-4a6f9687217d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"3ecac7ae-7f22-400b-ae32-68fe41a96dcc"},"name":"SYS_GEN__Runbook_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516"}},{"description":"System action for suspending an application","message_list":[],"uuid":"887e6494-1b9e-4635-8048-ab9d24af7db5","name":"action_suspend","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"DAG","uuid":"0ba85630-26b2-4a1d-8e05-5d03f143aa00","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516"}],"description":"","message_list":[],"uuid":"8119229f-66a7-4cd0-a63d-fba65a0dd712","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"0ba85630-26b2-4a1d-8e05-5d03f143aa00"},"name":"SYS_GEN__Runbook_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516"}},{"description":"System action for modifying an application","message_list":[],"uuid":"b1c00371-af65-433a-b6c3-e557a89acd13","name":"action_modify","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"DAG","uuid":"9fc5cc1f-455a-4d42-be42-3051aa78833b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516"}],"description":"","message_list":[],"uuid":"afcb466b-5aa4-44ca-ae32-3531d281e831","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"9fc5cc1f-455a-4d42-be42-3051aa78833b"},"name":"SYS_GEN__Runbook_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516"}},{"description":"System action for powering off an application","message_list":[],"uuid":"5b52a973-eb28-4710-a689-f6ae81799c10","name":"action_poweroff","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"DAG","uuid":"e7f019a2-4fd0-4d83-8cde-c65128a3c2ad","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Gcp_Operation_PowerOff_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"8e29f1ea-4ca3-45bc-955d-1e5056933868"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"VMOPERATION_GCP_VM","uuid":"8e29f1ea-4ca3-45bc-955d-1e5056933868","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Gcp_Operation_PowerOff_6b0f177a_9572_4df1_a6b8_71e996333516"}],"description":"","message_list":[],"uuid":"0769bd6e-10a3-4790-8366-90653ae53f9e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"e7f019a2-4fd0-4d83-8cde-c65128a3c2ad"},"name":"SYS_GEN__Runbook_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"d8fd9d86-dd16-4488-ae30-2137da809343","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"DAG","uuid":"f29bd688-4cbe-4e1c-b212-10b6679cffda","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Gcp_Delete_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"e0f61571-1958-4f37-943e-99d3f48a58e5"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"DELETE_GCP_VM","uuid":"e0f61571-1958-4f37-943e-99d3f48a58e5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Gcp_Delete_6b0f177a_9572_4df1_a6b8_71e996333516"}],"description":"","message_list":[],"uuid":"f13ba8c1-6ea6-4b3f-a059-2f2a9732b44c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"f29bd688-4cbe-4e1c-b212-10b6679cffda"},"name":"SYS_GEN__Runbook_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"d889b874-80df-47fb-aceb-7daf98b135ba","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"DAG","uuid":"42307e19-c757-49e0-a781-75143be509ef","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Substrate_Element_Delete_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"136d1b56-41ae-41c9-80ed-57da7648b6d9"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"136d1b56-41ae-41c9-80ed-57da7648b6d9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Substrate_Element_Delete_6b0f177a_9572_4df1_a6b8_71e996333516"}],"description":"","message_list":[],"uuid":"7e0d47ae-0f98-417b-954e-569e55bf9333","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"42307e19-c757-49e0-a781-75143be509ef"},"name":"SYS_GEN__Runbook_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516"}}],"message_list":[{"message":"Zone is a required field","reason":"EMPTY_VALUE","details":[{"attribute_name":"zone"}]},{"message":"Machine type is a required field","reason":"EMPTY_VALUE","details":[{"attribute_name":"machineType"}]},{"message":"Either source image or disk source should be specified in custom disks","reason":"MISSING_VALUE","details":[{"attribute_name":"source"}]}],"uuid":"6b0f177a-9572-4df1-a6b8-71e996333516","state":"DRAFT","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{public_ip_address}@@","delay_secs":"0","connection_port":22},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"resources":{"disks":{"0":{"initializeParams":{"diskSizeGb":true,"sourceImage":true,"diskType":true},"autoDelete":true}},"machineType":true,"name":true,"zone":true,"tags":{"items":true},"guestCustomization":{"startupScript":true},"labels":true,"blankDisks":{"1":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true},"0":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true},"2":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true}},"metadata":{"items":true},"sshKeys":{"0":true},"serviceAccounts":{"0":{"scopes":true,"email":true}},"networkInterfaces":{"0":{"accessConfigs":{"0":{"config_type":true,"name":true}},"network":true,"subnetwork":true}}}}},"os_type":"Linux","type":"GCP_VM","create_spec":{"type":"PROVISION_GCP_VM","resources":{"labels":[],"machineType":"","description":"","zone":"","tags":{"items":[],"type":"","fingerprint":""},"guestCustomization":{"type":"","sysprep":"","startupScript":""},"labelFingerprint":"","disks":[{"diskEncryptionKey":{"rawKey":"","type":""},"deviceName":"","initializeParams":{"sourceImageEncryptionKey":{"rawKey":"","type":""},"diskName":"","diskType":"","diskSizeGb":10,"sourceImage":"","type":""},"autoDelete":true,"boot":true,"source":"","mode":"","interface":"","disk_type":"PERSISTENT","type":""}],"metadata":{"items":[],"type":"","fingerprint":""},"sshKeys":["centos:ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDMGAS\/K0Mb\/uwFXwD+hkjguy7VMZk2hpuhwPl9FUZwVBrURf\/i9QMJ5\/paPEZixu8VlRx7Inu4iun7rQfrnfeIYInmBwspXHYiTK3oHJAgZnrAHVEf1p6YaxLINlT1NI5yOAGPRWW6of8rBDBH1ObwU2+wcSx\/1H0uIs3aZNLufr+Rh628ACxAum2Gt8AVRj6ua2BPFyt5VTdclyysAmeh1AiixNgOZXOz6y\/i4TbzpY78I3isuKpxsUeXX6jxEMQol406jHDUF6njEOPIQG2zVZ3QJlTG9OlN+NiyZG9WkZz0VG\/6M8ixxIHHI2dNwUbBFv2HUu+8X9LTLFq2O7KjX9Hp7uZKBAySHA3eKaKHIp2bZuU1bT5PRPkggngX86xg+T+OMNnutbAiMnRJ8+FvD5So+5TIx4b9GgxAxure3x2yRPT9lOiQOB+CVpJPxR0Rn9bOI+wiPnD0kAGvK\/fHT+pqL4PM+hTnJtp9rrCRzIQApBx1263jEcYffhW2epZQRO+he5CMawFJ5TBe08om2AaDJ8GQdrpF6YA3W8DzHbmL3DPVVHdmqPLn10o+LX4gv5SdIIDVGdjKOc1BCnLTRmM28d5+sLDt\/M+kvcQgf0y0yDjMVjGECZkt39hbm4ELMHzZtzYLmHNhBZxRqHeJ7qFTuv1kx88OW3Xc5mbBNQ== centos@nutanix.com\n"],"minCpuPlatform":"","scheduling":{"automaticRestart":true,"type":"","preemptible":false,"onHostMaintenance":"TERMINATE"},"canIpForward":false,"blankDisks":[{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sm-disk1-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sm-disk2-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sm-disk3-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true}],"networkInterfaces":[{"aliasIpRanges":[],"network":"","accessConfigs":[{"config_type":"ONE_TO_ONE_NAT","type":"","name":"k8sm-acm-@@{calm_array_index}@@-@@{calm_time}@@","natIP":""}],"networkIP":"","subnetwork":"","type":"","associatePublicIP":true}],"type":"","account_uuid":"84213a31-4fe8-7e39-3799-e093e5d0dc2e","serviceAccounts":[{"scopes":[],"type":"","email":"108048128720-compute@developer.gserviceaccount.com"}],"name":"k8sm-@@{calm_array_index}@@-@@{calm_time}@@"}},"variable_list":[],"name":"GCP_Centos_K8SM"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"4971f809-1b0f-49c0-8675-163845802108","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"DAG","uuid":"a6abc7c4-a7e3-44cb-85d2-ec3ca6b3fe1a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Azure_Provision_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"c14fa33e-2924-4064-81be-b3e23a7fcaec"},{"kind":"app_task","name":"SYS_GEN__check_login_for_Azure_Centos_K8SC_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"6b8c84db-162b-4de6-a05a-a6ca4f36bbba"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Azure_Provision_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"c14fa33e-2924-4064-81be-b3e23a7fcaec"},"edge_type":"inherent","type":"","uuid":"6c7e4e07-806d-4999-943b-fddda9ed8d42","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_Azure_Centos_K8SC_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"6b8c84db-162b-4de6-a05a-a6ca4f36bbba"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"PROVISION_AZURE_VM","uuid":"c14fa33e-2924-4064-81be-b3e23a7fcaec","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"PROVISION_AZURE_VM","name":"","resources":{"vm_name":"K8SC-@@{calm_unique_hash}@@-@@{calm_array_index}@@","storage_profile":{"is_managed":true,"image_details":{"sku":"","publisher":"","offer":"","source_image_id":"","use_custom_image":false,"version":"","type":""},"type":"","os_disk_details":{"size_in_gb":127,"name":"os-@@{calm_unique_hash}@@-@@{calm_array_index}@@-disk","storage_name":"","storage_type":"Standard_LRS","lun":-1,"type":"","create_option":"FromImage","caching_type":"ReadWrite"},"data_disk_list":[]},"nw_profile":{"nic_list":[{"nsg_name":"","vnet_name":"","private_ip_info":{"ip_address":"","ip_allocation_method":"Dynamic","type":""},"nic_name":"nic-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","subnet_name":"","type":"","public_ip_info":{"ip_name":"public-ip-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","dns_label":"dns-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","ip_allocation_method":"Dynamic","type":""}}],"primary_nic":-1,"type":""},"resource_group":"","os_profile":{"secrets":[],"type":"","windows_config":{"winrm_listeners":[],"time_zone":"","additional_unattend_content":[],"provision_vm_agent":true,"auto_updates":false,"type":""},"linux_config":null},"hw_profile":{"max_data_disk_count":0,"vm_size":"","type":""},"location":"","availability_set_id":"","tag_list":[],"type":"","account_uuid":""}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Azure_Provision_2eaf885a_749d_4746_9a1a_b532a461b696"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"6b8c84db-162b-4de6-a05a-a6ca4f36bbba","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{platform.publicIPAddressList[0]}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_Azure_Centos_K8SC_2eaf885a_749d_4746_9a1a_b532a461b696"}],"description":"","message_list":[],"uuid":"ab8b18aa-5c5d-4fdf-af20-5d8518c51208","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"a6abc7c4-a7e3-44cb-85d2-ec3ca6b3fe1a"},"name":"SYS_GEN__Runbook_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696"}},{"description":"System action for powering on an application","message_list":[],"uuid":"06f7a02b-1f92-415a-9ee3-34beaeeb1912","name":"action_poweron","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"DAG","uuid":"78f4db37-9e5c-441e-8155-8687cee2d178","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Azure_Operation_PowerOn_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"c75de159-45c4-4c2b-a5aa-6789a2e05192"},{"kind":"app_task","name":"SYS_GEN__check_login_for_Azure_Centos_K8SC_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"cccd3471-2c4e-4e26-a59e-e9b07647e850"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Azure_Operation_PowerOn_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"c75de159-45c4-4c2b-a5aa-6789a2e05192"},"edge_type":"inherent","type":"","uuid":"f89b14b1-d492-4bfb-9880-0eb56699530f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_Azure_Centos_K8SC_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"cccd3471-2c4e-4e26-a59e-e9b07647e850"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"VMOPERATION_AZURE_VM","uuid":"c75de159-45c4-4c2b-a5aa-6789a2e05192","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Azure_Operation_PowerOn_2eaf885a_749d_4746_9a1a_b532a461b696"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"cccd3471-2c4e-4e26-a59e-e9b07647e850","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{platform.publicIPAddressList[0]}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_Azure_Centos_K8SC_2eaf885a_749d_4746_9a1a_b532a461b696"}],"description":"","message_list":[],"uuid":"e4bc2b12-cac9-4f26-8469-1f583923f11c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"78f4db37-9e5c-441e-8155-8687cee2d178"},"name":"SYS_GEN__Runbook_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696"}},{"description":"System action for restarting an application","message_list":[],"uuid":"ccc1af04-4410-44bd-b746-2d53ddda5aa8","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"DAG","uuid":"25119cdc-7351-412f-8292-297b18085de0","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Azure_Operation_Restart2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"6c2f7d00-4e48-4c12-82ef-818276de86f0"},{"kind":"app_task","name":"SYS_GEN__check_login_for_Azure_Centos_K8SC_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"e17383a7-fc62-401b-a942-047e8043bf67"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Azure_Operation_Restart2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"6c2f7d00-4e48-4c12-82ef-818276de86f0"},"edge_type":"inherent","type":"","uuid":"393937e7-f9c3-4e92-b51c-0bb52d4944b4","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_Azure_Centos_K8SC_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"e17383a7-fc62-401b-a942-047e8043bf67"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"VMOPERATION_AZURE_VM","uuid":"6c2f7d00-4e48-4c12-82ef-818276de86f0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Azure_Operation_Restart2eaf885a_749d_4746_9a1a_b532a461b696"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"e17383a7-fc62-401b-a942-047e8043bf67","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{platform.publicIPAddressList[0]}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_Azure_Centos_K8SC_2eaf885a_749d_4746_9a1a_b532a461b696"}],"description":"","message_list":[],"uuid":"c04252fb-c52d-4e8e-a2ce-b575118ef155","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"25119cdc-7351-412f-8292-297b18085de0"},"name":"SYS_GEN__Runbook_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696"}},{"description":"System action for suspending an application","message_list":[],"uuid":"8226238c-f0ee-49dc-a2b0-2f0cece5ab1c","name":"action_suspend","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"DAG","uuid":"1dab42bb-c21b-4ba5-85fe-abe12dca8514","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696"}],"description":"","message_list":[],"uuid":"888ae73c-4f1a-4b9b-90bc-d7705b12779d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"1dab42bb-c21b-4ba5-85fe-abe12dca8514"},"name":"SYS_GEN__Runbook_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696"}},{"description":"System action for modifying an application","message_list":[],"uuid":"9b2fa18f-0619-47cd-ad8d-7b2ec9d07425","name":"action_modify","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"DAG","uuid":"be6bbe3d-2957-4f1b-89bf-3c339b742ef7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696"}],"description":"","message_list":[],"uuid":"a9725688-4169-44e4-b55f-8ba7db1e8612","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"be6bbe3d-2957-4f1b-89bf-3c339b742ef7"},"name":"SYS_GEN__Runbook_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696"}},{"description":"System action for powering off an application","message_list":[],"uuid":"2a277175-c985-4524-b5d4-381148cb7ca3","name":"action_poweroff","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"DAG","uuid":"42ee4cba-42d2-4994-8e3e-19e6b95f8a90","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Azure_Operation_Poweroff_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"aad25987-6286-483b-882e-905a795126f4"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"VMOPERATION_AZURE_VM","uuid":"aad25987-6286-483b-882e-905a795126f4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Azure_Operation_Poweroff_2eaf885a_749d_4746_9a1a_b532a461b696"}],"description":"","message_list":[],"uuid":"c893037e-bcd3-4b89-93d2-c25cfa602f13","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"42ee4cba-42d2-4994-8e3e-19e6b95f8a90"},"name":"SYS_GEN__Runbook_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"513c9876-2c7c-498d-999d-f0aab2d141bd","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"DAG","uuid":"dfe8f52a-40af-4d00-ae43-fb5da8d1353f","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Azure_Delete_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"40f1dac3-dbdf-4d75-8b7e-ac5f98fd7ca2"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"DELETE_AZURE_VM","uuid":"40f1dac3-dbdf-4d75-8b7e-ac5f98fd7ca2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Azure_Delete_2eaf885a_749d_4746_9a1a_b532a461b696"}],"description":"","message_list":[],"uuid":"ff697210-af55-4a6f-a695-115768d31ce4","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"dfe8f52a-40af-4d00-ae43-fb5da8d1353f"},"name":"SYS_GEN__Runbook_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"d8dc8585-82df-4e33-90dd-ce7260f54b27","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"DAG","uuid":"56c6dea8-774d-4c8f-8f39-a2fad8bd8caa","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Substrate_Element_Delete_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"7945657e-7c50-43fa-97ea-aaacac1b3998"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"7945657e-7c50-43fa-97ea-aaacac1b3998","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Substrate_Element_Delete_2eaf885a_749d_4746_9a1a_b532a461b696"}],"description":"","message_list":[],"uuid":"cb24613d-b9bb-4fc9-ad8a-98a1f1f2c77a","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"56c6dea8-774d-4c8f-8f39-a2fad8bd8caa"},"name":"SYS_GEN__Runbook_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696"}}],"message_list":[{"message":"resource_group is a required field","reason":"EMPTY_VALUE","details":[{"attribute_name":"resource_group"}]},{"message":"account_uuid is a required field","reason":"EMPTY_VALUE","details":[{"attribute_name":"account_uuid"}]},{"message":"location is a required field","reason":"EMPTY_VALUE","details":[{"attribute_name":"location"}]},{"message":"Hardware Profile is a required field","reason":"EMPTY_VALUE","details":[{"attribute_name":"vm_size"}]},{"message":"Incomplete VM Image details. Please select a Public Image for VM provisioning","reason":"EMPTY_VALUE","details":[{"attribute_name":"image_details"}]},{"message":"nsg_name is a required field","reason":"EMPTY_VALUE","details":[{"attribute_name":"nsg_name"}]},{"message":"vnet_name is a required field","reason":"EMPTY_VALUE","details":[{"attribute_name":"vnet_name"}]},{"message":"subnet_name is a required field","reason":"EMPTY_VALUE","details":[{"attribute_name":"subnet_name"}]}],"uuid":"2eaf885a-749d-4746-9a1a-b532a461b696","state":"DRAFT","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{platform.publicIPAddressList[0]}@@","delay_secs":"0","connection_port":22},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":null},"create_spec":{"resources":{"vm_name":true,"storage_profile":{"is_managed":true,"image_details":{"sku":true,"publisher":true,"offer":true,"version":true,"use_custom_image":true},"os_disk_details":{"storage_type":true,"name":true,"caching_type":true,"create_option":true}},"nw_profile":{"nic_list":{"0":{"nsg_name":true,"vnet_name":true,"private_ip_info":{"ip_allocation_method":true},"nic_name":true,"subnet_name":true,"public_ip_info":{"ip_allocation_method":true,"dns_label":true,"ip_name":true}}}},"resource_group":true,"os_profile":{"linux_config":{"custom_data":true}},"hw_profile":{"vm_size":true},"location":true,"availability_set_id":true,"tag_list":true}}},"os_type":"Linux","type":"AZURE_VM","create_spec":{"type":"PROVISION_AZURE_VM","name":"","resources":{"vm_name":"K8SC-@@{calm_unique_hash}@@-@@{calm_array_index}@@","storage_profile":{"is_managed":true,"image_details":{"sku":"","publisher":"","offer":"","source_image_id":"","use_custom_image":false,"version":"","type":""},"type":"","os_disk_details":{"size_in_gb":127,"name":"os-@@{calm_unique_hash}@@-@@{calm_array_index}@@-disk","storage_name":"","storage_type":"Standard_LRS","lun":-1,"type":"","create_option":"FromImage","caching_type":"ReadWrite"},"data_disk_list":[]},"nw_profile":{"nic_list":[{"nsg_name":"","vnet_name":"","private_ip_info":{"ip_address":"","ip_allocation_method":"Dynamic","type":""},"nic_name":"nic-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","subnet_name":"","type":"","public_ip_info":{"ip_name":"public-ip-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","dns_label":"dns-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","ip_allocation_method":"Dynamic","type":""}}],"primary_nic":-1,"type":""},"resource_group":"","os_profile":{"secrets":[],"type":"","windows_config":{"winrm_listeners":[],"time_zone":"","additional_unattend_content":[],"provision_vm_agent":true,"auto_updates":false,"type":""},"linux_config":null},"hw_profile":{"max_data_disk_count":0,"vm_size":"","type":""},"location":"","availability_set_id":"","tag_list":[],"type":"","account_uuid":""}},"variable_list":[],"name":"Azure_Centos_K8SC"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"6f9b9d19-7763-4f9f-a736-4bc872a72ad2","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"DAG","uuid":"0efb8c5d-7677-4752-af9d-c75f06090fb3","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Azure_Provision_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"d1939f98-9d9e-4769-8567-d45f786e3b3e"},{"kind":"app_task","name":"SYS_GEN__check_login_for_Azure_Centos_K8SM_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"82de7f01-05a2-47d0-9ce2-aa50d78a6e6f"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Azure_Provision_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"d1939f98-9d9e-4769-8567-d45f786e3b3e"},"edge_type":"inherent","type":"","uuid":"ed8ab76f-e80c-4580-a53f-0731fffb43b8","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_Azure_Centos_K8SM_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"82de7f01-05a2-47d0-9ce2-aa50d78a6e6f"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"PROVISION_AZURE_VM","uuid":"d1939f98-9d9e-4769-8567-d45f786e3b3e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"PROVISION_AZURE_VM","name":"","resources":{"vm_name":"K8SM-@@{calm_unique_hash}@@-@@{calm_array_index}@@","storage_profile":{"is_managed":true,"image_details":{"sku":"","publisher":"","offer":"","source_image_id":"","use_custom_image":false,"version":"","type":""},"type":"","os_disk_details":{"size_in_gb":127,"name":"os-@@{calm_unique_hash}@@-@@{calm_array_index}@@-disk","storage_name":"","storage_type":"Standard_LRS","lun":-1,"type":"","create_option":"FromImage","caching_type":"ReadWrite"},"data_disk_list":[]},"nw_profile":{"nic_list":[{"nsg_name":"","vnet_name":"","private_ip_info":{"ip_address":"","ip_allocation_method":"Dynamic","type":""},"nic_name":"nic-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","subnet_name":"","type":"","public_ip_info":{"ip_name":"public-ip-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","dns_label":"dns-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","ip_allocation_method":"Dynamic","type":""}}],"primary_nic":-1,"type":""},"resource_group":"","os_profile":{"secrets":[],"type":"","windows_config":{"winrm_listeners":[],"time_zone":"","additional_unattend_content":[],"provision_vm_agent":true,"auto_updates":false,"type":""},"linux_config":null},"hw_profile":{"max_data_disk_count":0,"vm_size":"","type":""},"location":"","availability_set_id":"","tag_list":[],"type":"","account_uuid":""}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Azure_Provision_85f444bf_ac07_4e13_a199_1e98a4019380"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"82de7f01-05a2-47d0-9ce2-aa50d78a6e6f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{platform.publicIPAddressList[0]}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_Azure_Centos_K8SM_85f444bf_ac07_4e13_a199_1e98a4019380"}],"description":"","message_list":[],"uuid":"559e173f-784d-4416-bffd-385d336ac054","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"0efb8c5d-7677-4752-af9d-c75f06090fb3"},"name":"SYS_GEN__Runbook_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380"}},{"description":"System action for powering on an application","message_list":[],"uuid":"49612e10-9bdc-40d4-83f3-6b18f7c2d88d","name":"action_poweron","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"DAG","uuid":"f0676784-43ef-46f7-8ddf-fcf79bc6307a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Azure_Operation_PowerOn_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"a3b3055b-8cdf-4c99-922b-48f20b3ba3f1"},{"kind":"app_task","name":"SYS_GEN__check_login_for_Azure_Centos_K8SM_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"3a69115f-7c36-4e71-bd60-5be08f6ad22a"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Azure_Operation_PowerOn_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"a3b3055b-8cdf-4c99-922b-48f20b3ba3f1"},"edge_type":"inherent","type":"","uuid":"608b5433-a282-4b58-b411-9396543ef19c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_Azure_Centos_K8SM_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"3a69115f-7c36-4e71-bd60-5be08f6ad22a"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"VMOPERATION_AZURE_VM","uuid":"a3b3055b-8cdf-4c99-922b-48f20b3ba3f1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Azure_Operation_PowerOn_85f444bf_ac07_4e13_a199_1e98a4019380"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"3a69115f-7c36-4e71-bd60-5be08f6ad22a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{platform.publicIPAddressList[0]}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_Azure_Centos_K8SM_85f444bf_ac07_4e13_a199_1e98a4019380"}],"description":"","message_list":[],"uuid":"59d69a24-d569-4d64-9def-9d16a3593d6e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"f0676784-43ef-46f7-8ddf-fcf79bc6307a"},"name":"SYS_GEN__Runbook_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380"}},{"description":"System action for restarting an application","message_list":[],"uuid":"089fd308-e0e3-4954-82bf-f2ad96cec5db","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"DAG","uuid":"6e32379a-a382-47ac-a0c1-ac57c7decca6","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Azure_Operation_Restart85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"9b1b72b2-aa68-40be-b9bc-2ec798233699"},{"kind":"app_task","name":"SYS_GEN__check_login_for_Azure_Centos_K8SM_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"298cc8b9-ea43-4d86-9c0f-54f44f619446"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Azure_Operation_Restart85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"9b1b72b2-aa68-40be-b9bc-2ec798233699"},"edge_type":"inherent","type":"","uuid":"8ccb5299-1f72-4a3b-9f17-8b1e7e6c3dbf","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_Azure_Centos_K8SM_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"298cc8b9-ea43-4d86-9c0f-54f44f619446"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"VMOPERATION_AZURE_VM","uuid":"9b1b72b2-aa68-40be-b9bc-2ec798233699","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Azure_Operation_Restart85f444bf_ac07_4e13_a199_1e98a4019380"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"298cc8b9-ea43-4d86-9c0f-54f44f619446","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"300","address":"@@{platform.publicIPAddressList[0]}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_Azure_Centos_K8SM_85f444bf_ac07_4e13_a199_1e98a4019380"}],"description":"","message_list":[],"uuid":"52365d7c-8b63-477b-bbbd-285320567682","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"6e32379a-a382-47ac-a0c1-ac57c7decca6"},"name":"SYS_GEN__Runbook_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380"}},{"description":"System action for suspending an application","message_list":[],"uuid":"4bbaad8b-f225-475f-88b2-44d05eafe6ff","name":"action_suspend","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"DAG","uuid":"3d9f6338-a297-4892-8633-865efcf3f643","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380"}],"description":"","message_list":[],"uuid":"7ed1684c-961f-4aaa-b931-0dc7753db529","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"3d9f6338-a297-4892-8633-865efcf3f643"},"name":"SYS_GEN__Runbook_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380"}},{"description":"System action for modifying an application","message_list":[],"uuid":"3c2e7bd2-6e6c-4b8f-9d42-9ef4e31d8785","name":"action_modify","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"DAG","uuid":"f6f30fb4-5cc1-4b68-a420-b5766e3db59d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380"}],"description":"","message_list":[],"uuid":"8abcdaac-21ec-4363-83fc-14d5adf90d55","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"f6f30fb4-5cc1-4b68-a420-b5766e3db59d"},"name":"SYS_GEN__Runbook_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380"}},{"description":"System action for powering off an application","message_list":[],"uuid":"067b5842-38e5-478e-9709-5cdeb7916d71","name":"action_poweroff","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"DAG","uuid":"0925e924-e0d9-40a8-8e50-42797408bff0","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Azure_Operation_Poweroff_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"eea88860-8f50-4cbb-b8a6-eb8129c5561a"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"VMOPERATION_AZURE_VM","uuid":"eea88860-8f50-4cbb-b8a6-eb8129c5561a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Azure_Operation_Poweroff_85f444bf_ac07_4e13_a199_1e98a4019380"}],"description":"","message_list":[],"uuid":"62c6362d-e0ca-42f2-bbb0-5283c445eb98","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"0925e924-e0d9-40a8-8e50-42797408bff0"},"name":"SYS_GEN__Runbook_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"1b5fccce-700d-4307-adcd-746123cfa54c","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"DAG","uuid":"c13a6541-b779-41a0-b097-3f89c66ac0d0","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Azure_Delete_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"2487d87b-68ba-4c69-bedd-529d26dc39fb"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"DELETE_AZURE_VM","uuid":"2487d87b-68ba-4c69-bedd-529d26dc39fb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Azure_Delete_85f444bf_ac07_4e13_a199_1e98a4019380"}],"description":"","message_list":[],"uuid":"f5d199f7-edb1-4ff1-b7e4-adc165c26e1d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"c13a6541-b779-41a0-b097-3f89c66ac0d0"},"name":"SYS_GEN__Runbook_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"d7bcac9b-e0ef-4636-b468-d74af271fe1f","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"DAG","uuid":"9ce60bad-15f8-461b-bc09-3e6d7fbcd038","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Substrate_Element_Delete_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"445d23f9-560d-44d9-8e9f-c73a7ed42821"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"445d23f9-560d-44d9-8e9f-c73a7ed42821","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Substrate_Element_Delete_85f444bf_ac07_4e13_a199_1e98a4019380"}],"description":"","message_list":[],"uuid":"340de4aa-b1bf-43d4-8e8a-3ed138af90f9","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"9ce60bad-15f8-461b-bc09-3e6d7fbcd038"},"name":"SYS_GEN__Runbook_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380"}}],"message_list":[{"message":"resource_group is a required field","reason":"EMPTY_VALUE","details":[{"attribute_name":"resource_group"}]},{"message":"account_uuid is a required field","reason":"EMPTY_VALUE","details":[{"attribute_name":"account_uuid"}]},{"message":"location is a required field","reason":"EMPTY_VALUE","details":[{"attribute_name":"location"}]},{"message":"Hardware Profile is a required field","reason":"EMPTY_VALUE","details":[{"attribute_name":"vm_size"}]},{"message":"Incomplete VM Image details. Please select a Public Image for VM provisioning","reason":"EMPTY_VALUE","details":[{"attribute_name":"image_details"}]},{"message":"nsg_name is a required field","reason":"EMPTY_VALUE","details":[{"attribute_name":"nsg_name"}]},{"message":"vnet_name is a required field","reason":"EMPTY_VALUE","details":[{"attribute_name":"vnet_name"}]},{"message":"subnet_name is a required field","reason":"EMPTY_VALUE","details":[{"attribute_name":"subnet_name"}]}],"uuid":"85f444bf-ac07-4e13-a199-1e98a4019380","state":"DRAFT","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{platform.publicIPAddressList[0]}@@","delay_secs":"0","connection_port":22},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":null},"create_spec":{"resources":{"vm_name":true,"storage_profile":{"is_managed":true,"image_details":{"sku":true,"publisher":true,"offer":true,"version":true,"use_custom_image":true},"os_disk_details":{"storage_type":true,"name":true,"caching_type":true,"create_option":true}},"nw_profile":{"nic_list":{"0":{"nsg_name":true,"vnet_name":true,"private_ip_info":{"ip_allocation_method":true},"nic_name":true,"subnet_name":true,"public_ip_info":{"ip_name":true,"dns_label":true,"ip_allocation_method":true}}}},"resource_group":true,"os_profile":{"linux_config":{"custom_data":true}},"hw_profile":{"vm_size":true},"location":true,"availability_set_id":true,"tag_list":true}}},"os_type":"Linux","type":"AZURE_VM","create_spec":{"type":"PROVISION_AZURE_VM","name":"","resources":{"vm_name":"K8SM-@@{calm_unique_hash}@@-@@{calm_array_index}@@","storage_profile":{"is_managed":true,"image_details":{"sku":"","publisher":"","offer":"","source_image_id":"","use_custom_image":false,"version":"","type":""},"type":"","os_disk_details":{"size_in_gb":127,"name":"os-@@{calm_unique_hash}@@-@@{calm_array_index}@@-disk","storage_name":"","storage_type":"Standard_LRS","lun":-1,"type":"","create_option":"FromImage","caching_type":"ReadWrite"},"data_disk_list":[]},"nw_profile":{"nic_list":[{"nsg_name":"","vnet_name":"","private_ip_info":{"ip_address":"","ip_allocation_method":"Dynamic","type":""},"nic_name":"nic-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","subnet_name":"","type":"","public_ip_info":{"ip_name":"public-ip-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","dns_label":"dns-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","ip_allocation_method":"Dynamic","type":""}}],"primary_nic":-1,"type":""},"resource_group":"","os_profile":{"secrets":[],"type":"","windows_config":{"winrm_listeners":[],"time_zone":"","additional_unattend_content":[],"provision_vm_agent":true,"auto_updates":false,"type":""},"linux_config":null},"hw_profile":{"max_data_disk_count":0,"vm_size":"","type":""},"location":"","availability_set_id":"","tag_list":[],"type":"","account_uuid":""}},"variable_list":[],"name":"Azure_Centos_K8SM"}],"credential_definition_list":[{"username":"centos","description":"","state":"DRAFT","message_list":[{"message":"Secret value for credential is empty","reason":"EMPTY_VALUE","details":[{"attribute_name":"secret"}]}],"uuid":"5314d554-0539-406b-95eb-faa834a6ef81","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"editables":{"username":true,"secret":true},"type":"KEY","name":"CENTOS"}],"type":"USER","app_profile_list":[{"deployment_create_list":[{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"cfa874cf-a541-45ca-ae2c-eb2e02fc0829","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"retries":"0","description":"","type":"DAG","uuid":"f87043ee-071b-44bf-abcf-1ad96aa82225","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778","uuid":"79d27966-7ef7-4b2d-ab88-7212a92cf807"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147","uuid":"4016c1d8-f498-4e59-967a-92cd0f2e022e"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"e993db5d-81d0-4bfe-aab0-ee3cde37c599"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"d1e63212-64ae-49b7-b6c7-bef0088dae59"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"70a4de72-0d94-45a1-a71b-ce013c1517fe"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"a9bf9dde-cc37-4d19-8c39-3e3c99f7a79d"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"70a4de72-0d94-45a1-a71b-ce013c1517fe"},"edge_type":"inherent","type":"","uuid":"175c3a46-4639-4efd-bba0-246dc7a35f36","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"a9bf9dde-cc37-4d19-8c39-3e3c99f7a79d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"d1e63212-64ae-49b7-b6c7-bef0088dae59"},"edge_type":"inherent","type":"","uuid":"3cfd99a0-0b53-4bcc-b070-8ccff211b898","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"70a4de72-0d94-45a1-a71b-ce013c1517fe"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778","uuid":"79d27966-7ef7-4b2d-ab88-7212a92cf807"},"edge_type":"inherent","type":"","uuid":"4a551786-544e-4345-9e27-95e8ae040a10","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"e993db5d-81d0-4bfe-aab0-ee3cde37c599"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147","uuid":"4016c1d8-f498-4e59-967a-92cd0f2e022e"},"edge_type":"inherent","type":"","uuid":"089bf473-6141-45e3-a73a-4fc1e3008de5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"e993db5d-81d0-4bfe-aab0-ee3cde37c599"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"e993db5d-81d0-4bfe-aab0-ee3cde37c599"},"edge_type":"inherent","type":"","uuid":"edd77842-0d32-4b73-9532-fd671055173a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"d1e63212-64ae-49b7-b6c7-bef0088dae59"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778","uuid":"79d27966-7ef7-4b2d-ab88-7212a92cf807"},"edge_type":"inherent","type":"","uuid":"03956c49-268c-4f1e-affa-918019c93360","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147","uuid":"4016c1d8-f498-4e59-967a-92cd0f2e022e"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"79d27966-7ef7-4b2d-ab88-7212a92cf807","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778"},{"target_any_local_reference":{"kind":"app_package","name":"CENTOS_74","uuid":"6cbb9b5f-3255-4d45-8d8f-0891f27ac147"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4016c1d8-f498-4e59-967a-92cd0f2e022e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147","uuid":"d428ae02-ea02-4587-b9ee-8020e81686c6"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e993db5d-81d0-4bfe-aab0-ee3cde37c599","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"9adb6919-b3c1-4abf-a7b2-49a04e78704f"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d1e63212-64ae-49b7-b6c7-bef0088dae59","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"8eda840d-20b1-4ce1-8d3d-7da38a9aee82"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_56b66f14_39cc_4320_8394_17636712b055"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"70a4de72-0d94-45a1-a71b-ce013c1517fe","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"aa8dd27e-4bd1-4b85-86c6-750c0a49579f"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a9bf9dde-cc37-4d19-8c39-3e3c99f7a79d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"64e5991c-fbcd-4d1f-8b72-4b4956e9702e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"2f0ea227-1d1b-42a7-9b02-8c99d6356442","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778","uuid":"f87043ee-071b-44bf-abcf-1ad96aa82225"},"name":"SYS_GEN__Runbook_Deployment_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778"}},{"description":"System action for starting an application","message_list":[],"uuid":"2d02de7b-b4b5-4440-8678-4b3b22ec93db","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"retries":"0","description":"","type":"DAG","uuid":"e83d9074-49f5-4b95-a2eb-95f58df24125","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"080c5e3d-13f0-4cff-8798-581b6c043cb7"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"552ef792-35c0-49aa-8c2a-0a82a1981fcf"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"080c5e3d-13f0-4cff-8798-581b6c043cb7"},"edge_type":"inherent","type":"","uuid":"86aae459-c06b-4125-8f25-e2bf9791d538","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"552ef792-35c0-49aa-8c2a-0a82a1981fcf"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"080c5e3d-13f0-4cff-8798-581b6c043cb7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"065b517e-f244-4120-864d-d018ef13315b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"552ef792-35c0-49aa-8c2a-0a82a1981fcf","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"64e5991c-fbcd-4d1f-8b72-4b4956e9702e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"92c99a64-2a7f-44ac-9396-13bd42e804c2","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778","uuid":"e83d9074-49f5-4b95-a2eb-95f58df24125"},"name":"SYS_GEN__Runbook_Deployment_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778"}},{"description":"System action for restarting an application","message_list":[],"uuid":"52c325fa-850e-457e-bd45-643b803996b3","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"retries":"0","description":"","type":"DAG","uuid":"31f2417e-459a-44f6-835c-4588b5d204de","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"b319636f-0435-480a-a592-5b509a9a9234"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"79a7c2dd-05bd-4e74-9be7-7cb682a9c921"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"b319636f-0435-480a-a592-5b509a9a9234"},"edge_type":"inherent","type":"","uuid":"910c54c2-4552-474e-b2bd-683e1608a3b7","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"79a7c2dd-05bd-4e74-9be7-7cb682a9c921"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b319636f-0435-480a-a592-5b509a9a9234","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"7892c56e-ed00-4e96-b932-83b17646490d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"79a7c2dd-05bd-4e74-9be7-7cb682a9c921","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"526cc0d4-3d9e-49c6-840b-f42e056f5d89"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"aba4e9f1-fcd9-4d96-88df-747f53a334d3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778","uuid":"31f2417e-459a-44f6-835c-4588b5d204de"},"name":"SYS_GEN__Runbook_Deployment_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778"}},{"description":"System action for stopping an application","message_list":[],"uuid":"53e51970-a2b0-4d83-b808-dcc75e42e2e0","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"retries":"0","description":"","type":"DAG","uuid":"df4ef1f6-2ca5-4c22-86c0-472b5c8c4499","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"43e05edb-eb07-4576-9841-6c1bb202e473"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"d057c1ff-bf0d-445f-a6fb-48e444f24618"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"43e05edb-eb07-4576-9841-6c1bb202e473"},"edge_type":"inherent","type":"","uuid":"a07c7fa9-f1e7-42a7-9c16-962023674504","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"d057c1ff-bf0d-445f-a6fb-48e444f24618"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"43e05edb-eb07-4576-9841-6c1bb202e473","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"1fdd3541-2eca-471a-a4be-4ef82887d4de"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d057c1ff-bf0d-445f-a6fb-48e444f24618","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"0d2bb72a-8cc6-4e7b-b5ab-dc0f5be4af24"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf"}],"description":"","message_list":[],"uuid":"63b88a2b-cda9-4213-b179-71ea181d263d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778","uuid":"df4ef1f6-2ca5-4c22-86c0-472b5c8c4499"},"name":"SYS_GEN__Runbook_Deployment_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"b229ebd9-3384-4c1a-ac20-cb0ef167405f","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"retries":"0","description":"","type":"DAG","uuid":"4da00aa2-7c15-4db9-bdd8-20d22cf54093","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"04098527-88c4-4ad5-a1bc-ed60835a9319"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"b39a68e2-99c1-4532-9a38-8edb9a07241d"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"ece3b213-5d53-4f8f-b0bc-22a5e3803f9c"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"7d063c2d-e292-4cb7-8cfa-e6945ac90ed7"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778","uuid":"5d3cc160-e919-4ed1-a5e9-e35d44e483ad"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"04098527-88c4-4ad5-a1bc-ed60835a9319"},"edge_type":"inherent","type":"","uuid":"5cbb3ace-1372-476b-857c-f0251d86ef68","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"b39a68e2-99c1-4532-9a38-8edb9a07241d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"b39a68e2-99c1-4532-9a38-8edb9a07241d"},"edge_type":"inherent","type":"","uuid":"7ada1430-634e-4259-ac57-a56fc63b88be","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"ece3b213-5d53-4f8f-b0bc-22a5e3803f9c"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"ece3b213-5d53-4f8f-b0bc-22a5e3803f9c"},"edge_type":"inherent","type":"","uuid":"2499315a-8a59-4a1c-bdcb-5797c9dc97ae","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"7d063c2d-e292-4cb7-8cfa-e6945ac90ed7"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"7d063c2d-e292-4cb7-8cfa-e6945ac90ed7"},"edge_type":"inherent","type":"","uuid":"dfa5f0be-b49c-45b7-8dc3-149f851f37bd","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778","uuid":"5d3cc160-e919-4ed1-a5e9-e35d44e483ad"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"04098527-88c4-4ad5-a1bc-ed60835a9319","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"1fdd3541-2eca-471a-a4be-4ef82887d4de"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b39a68e2-99c1-4532-9a38-8edb9a07241d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"a2ac512f-d272-4905-bafb-4733f7e58c9b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ece3b213-5d53-4f8f-b0bc-22a5e3803f9c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"f385c2c1-849a-4ea0-bb13-2a5c0a754ad3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_56b66f14_39cc_4320_8394_17636712b055"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"7d063c2d-e292-4cb7-8cfa-e6945ac90ed7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"cc6eb93f-a61a-455f-bcc8-fdd5ebb03ee9"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"5d3cc160-e919-4ed1-a5e9-e35d44e483ad","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778"}],"description":"","message_list":[],"uuid":"d15805c7-329d-47e0-821c-0ec4bbbcc597","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778","uuid":"4da00aa2-7c15-4db9-bdd8-20d22cf54093"},"name":"SYS_GEN__Runbook_Deployment_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778"}},{"description":"System action for scaleout","message_list":[],"uuid":"9ea79960-5155-453a-84cd-61ba6c5fee24","name":"action_scaleout","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"retries":"0","description":"","type":"DAG","uuid":"13af9dfe-c9e2-45a8-9510-66dd287ad756","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scaleout_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778","uuid":"5350ced8-4bf4-4dfa-80d2-418b7d3d98bb"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"retries":"0","description":"","type":"SCALING","uuid":"5350ced8-4bf4-4dfa-80d2-418b7d3d98bb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scaleout_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778"}],"description":"","message_list":[],"uuid":"814abc6c-f9e2-4d5c-9f0f-a0547116d21d","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"755e8753-ea0c-4614-bc4c-56e18643cfce","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778","uuid":"13af9dfe-c9e2-45a8-9510-66dd287ad756"},"name":"SYS_GEN__Runbook_Deployment_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778"}},{"description":"System action for scalein","message_list":[],"uuid":"6e4079bd-1b87-4fc9-acd1-925c24e5356c","name":"action_scalein","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"retries":"0","description":"","type":"DAG","uuid":"0953e64d-ea7b-40e9-b02a-bdbd1514739c","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scalein_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778","uuid":"ed7a9092-e6b3-4e6f-9856-5dffad3e2f9d"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"retries":"0","description":"","type":"SCALING","uuid":"ed7a9092-e6b3-4e6f-9856-5dffad3e2f9d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scalein_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778"}],"description":"","message_list":[],"uuid":"2e068b5f-d46d-48ec-82ef-9ec34b2b38cf","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"b061f98e-daf6-4275-872c-f4b01c806d4f","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778","uuid":"0953e64d-ea7b-40e9-b02a-bdbd1514739c"},"name":"SYS_GEN__Runbook_Deployment_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"4c813781-939f-4401-afd3-170b7aba096f","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"retries":"0","description":"","type":"DAG","uuid":"b9be0c62-9e8c-4dcd-8edf-e199250f70d5","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"684eed09-38a6-498f-b83d-bbf151325ab0"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_56b66f14_39cc_4320_8394_17636712b055","uuid":"234bdf3f-a11a-4fa1-8714-df4fb69cd820"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"289a7fd3-9b2e-46c0-afba-9e7f457b42b4"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778","uuid":"5adb201d-f53a-4f12-ae7b-fef23f043518"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"684eed09-38a6-498f-b83d-bbf151325ab0"},"edge_type":"inherent","type":"","uuid":"c807a654-465a-46ad-9040-65d7f5a4bf30","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_56b66f14_39cc_4320_8394_17636712b055","uuid":"234bdf3f-a11a-4fa1-8714-df4fb69cd820"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"289a7fd3-9b2e-46c0-afba-9e7f457b42b4"},"edge_type":"inherent","type":"","uuid":"9c52e5b5-ed15-4c53-880b-f602222461f4","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778","uuid":"5adb201d-f53a-4f12-ae7b-fef23f043518"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_56b66f14_39cc_4320_8394_17636712b055","uuid":"234bdf3f-a11a-4fa1-8714-df4fb69cd820"},"edge_type":"inherent","type":"","uuid":"e8b4b650-5415-4398-9a1c-81a10faa0fae","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"289a7fd3-9b2e-46c0-afba-9e7f457b42b4"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"684eed09-38a6-498f-b83d-bbf151325ab0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"50a769a7-5b0a-4546-9e12-4f0a3ceff21b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"234bdf3f-a11a-4fa1-8714-df4fb69cd820","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_56b66f14_39cc_4320_8394_17636712b055"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"289a7fd3-9b2e-46c0-afba-9e7f457b42b4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"3e7fe7d8-5436-46f0-99a0-ee0a1f411c44"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"5adb201d-f53a-4f12-ae7b-fef23f043518","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778"}],"description":"","message_list":[],"uuid":"2cd14727-3c90-485f-8a08-1242bf30a409","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778","uuid":"b9be0c62-9e8c-4dcd-8edf-e199250f70d5"},"name":"SYS_GEN__Runbook_Deployment_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778"}}],"message_list":[],"published_service_local_reference_list":[],"uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778","min_replicas":"3","state":"DRAFT","max_replicas":"3","depends_on_list":[],"editables":{"min_replicas":true,"max_replicas":true},"package_local_reference_list":[{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"}],"substrate_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"type":"GREENFIELD","options":{},"variable_list":[],"name":"2cbb2f6a_deployment"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"01203c48-0101-4008-9bfb-a99b90040b11","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"retries":"0","description":"","type":"DAG","uuid":"4b869865-4e77-452e-92c4-f23c4c236526","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_fc3bf5ce_7070_4a40_bc68_179c74c82418","uuid":"ef8323d9-ce68-4e8a-9a1a-3ba4b6869a7b"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147","uuid":"9bee88eb-22ec-4afe-8519-7da8fec691d3"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"6c687a1f-e0c4-496c-9863-f03443b27561"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"2208688e-e944-4b8c-a525-3678accd4943"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"d917231f-e770-4ea7-a966-29d985b6e3be"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"dcb3e26a-fd71-4c76-be09-5dd147209428"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"d917231f-e770-4ea7-a966-29d985b6e3be"},"edge_type":"inherent","type":"","uuid":"0d99dd34-fb7a-47f6-8dc4-b40134cc994f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"dcb3e26a-fd71-4c76-be09-5dd147209428"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"2208688e-e944-4b8c-a525-3678accd4943"},"edge_type":"inherent","type":"","uuid":"eb5ba56a-da52-48fa-85e6-80c7e25b0ffa","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"d917231f-e770-4ea7-a966-29d985b6e3be"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"6c687a1f-e0c4-496c-9863-f03443b27561"},"edge_type":"inherent","type":"","uuid":"11469703-b92c-4964-9eb3-a149da898d19","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"2208688e-e944-4b8c-a525-3678accd4943"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147","uuid":"9bee88eb-22ec-4afe-8519-7da8fec691d3"},"edge_type":"inherent","type":"","uuid":"50e3a3c4-9701-4e2a-ba23-f6c0c9ad8095","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"6c687a1f-e0c4-496c-9863-f03443b27561"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_fc3bf5ce_7070_4a40_bc68_179c74c82418","uuid":"ef8323d9-ce68-4e8a-9a1a-3ba4b6869a7b"},"edge_type":"inherent","type":"","uuid":"2faf18f2-81d5-4a91-8ccb-01b6b3b0a2cd","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"6c687a1f-e0c4-496c-9863-f03443b27561"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_fc3bf5ce_7070_4a40_bc68_179c74c82418","uuid":"ef8323d9-ce68-4e8a-9a1a-3ba4b6869a7b"},"edge_type":"inherent","type":"","uuid":"3e504e45-f333-479c-9d99-b6288d4e8d51","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147","uuid":"9bee88eb-22ec-4afe-8519-7da8fec691d3"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_fc3bf5ce_7070_4a40_bc68_179c74c82418"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"ef8323d9-ce68-4e8a-9a1a-3ba4b6869a7b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_fc3bf5ce_7070_4a40_bc68_179c74c82418"},{"target_any_local_reference":{"kind":"app_package","name":"CENTOS_74","uuid":"6cbb9b5f-3255-4d45-8d8f-0891f27ac147"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"9bee88eb-22ec-4afe-8519-7da8fec691d3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147","uuid":"d428ae02-ea02-4587-b9ee-8020e81686c6"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6c687a1f-e0c4-496c-9863-f03443b27561","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"741ae977-6c62-4a73-af5d-0616318987d9"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2208688e-e944-4b8c-a525-3678accd4943","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"241eb780-c41d-4b86-9adb-377699867bd7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_c41ebbe6_49ab_4a43_8618_22679865e405"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d917231f-e770-4ea7-a966-29d985b6e3be","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"cabcfd41-35e6-45f0-a791-00daf17de059"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"dcb3e26a-fd71-4c76-be09-5dd147209428","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"91f453c1-d2fc-47b1-93d4-4b49476235be"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"12a627c4-42a8-40c2-93c0-962e451a4768","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_fc3bf5ce_7070_4a40_bc68_179c74c82418","uuid":"4b869865-4e77-452e-92c4-f23c4c236526"},"name":"SYS_GEN__Runbook_Deployment_fc3bf5ce_7070_4a40_bc68_179c74c82418"}},{"description":"System action for starting an application","message_list":[],"uuid":"24e49313-9479-45fc-9bad-ce8e5d3d059e","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"retries":"0","description":"","type":"DAG","uuid":"d85eedc1-aff1-4ed7-b91d-3764c8699b9a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"4d1b4eb1-3d74-4509-8e42-3a573fc79a7f"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"14375ced-c172-44fb-915c-ed2e03b8825d"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"4d1b4eb1-3d74-4509-8e42-3a573fc79a7f"},"edge_type":"inherent","type":"","uuid":"dc583b1f-654b-4630-a3fb-a54c5d38d22a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"14375ced-c172-44fb-915c-ed2e03b8825d"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_fc3bf5ce_7070_4a40_bc68_179c74c82418"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4d1b4eb1-3d74-4509-8e42-3a573fc79a7f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"75216d24-aace-4a81-b784-609a5faa5be6"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"14375ced-c172-44fb-915c-ed2e03b8825d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"91f453c1-d2fc-47b1-93d4-4b49476235be"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"cc254cd0-0a5e-48b5-a497-641a3bd76986","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_fc3bf5ce_7070_4a40_bc68_179c74c82418","uuid":"d85eedc1-aff1-4ed7-b91d-3764c8699b9a"},"name":"SYS_GEN__Runbook_Deployment_fc3bf5ce_7070_4a40_bc68_179c74c82418"}},{"description":"System action for restarting an application","message_list":[],"uuid":"3e4052f4-bfbc-454c-a30d-522c78530c16","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"retries":"0","description":"","type":"DAG","uuid":"f1f1e4b1-28ea-447d-bf2c-0297f5a2f6b6","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"e7096967-1d80-428a-849c-a53213a7399e"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"74998065-7c99-4de0-bf53-007c4f11f551"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"e7096967-1d80-428a-849c-a53213a7399e"},"edge_type":"inherent","type":"","uuid":"3a7f0a3b-de88-487e-a957-cf8710eb5208","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"74998065-7c99-4de0-bf53-007c4f11f551"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_fc3bf5ce_7070_4a40_bc68_179c74c82418"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e7096967-1d80-428a-849c-a53213a7399e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"58877011-609a-4aa8-9014-3c64fe37229e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"74998065-7c99-4de0-bf53-007c4f11f551","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"3fd75c09-a79f-4731-98fc-b65b96bc9fe7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"8e942b1b-8a89-4750-8ec4-33f8513e474b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_fc3bf5ce_7070_4a40_bc68_179c74c82418","uuid":"f1f1e4b1-28ea-447d-bf2c-0297f5a2f6b6"},"name":"SYS_GEN__Runbook_Deployment_fc3bf5ce_7070_4a40_bc68_179c74c82418"}},{"description":"System action for stopping an application","message_list":[],"uuid":"5fb4b5d8-d51e-4e2e-b37b-b41cb2397e94","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"retries":"0","description":"","type":"DAG","uuid":"c6f453a4-f347-4204-b1af-b7a7bc036b8d","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"b6cb5390-5c77-432a-a8e7-56198d6da1ae"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"3a2144fa-2b32-423e-9efa-da3815e03181"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"b6cb5390-5c77-432a-a8e7-56198d6da1ae"},"edge_type":"inherent","type":"","uuid":"74c00d9f-c5d9-4787-b886-157cb2992ba1","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"3a2144fa-2b32-423e-9efa-da3815e03181"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_fc3bf5ce_7070_4a40_bc68_179c74c82418"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b6cb5390-5c77-432a-a8e7-56198d6da1ae","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12105be2-ee67-451d-8054-4546855e277c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3a2144fa-2b32-423e-9efa-da3815e03181","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"4cca75d8-075a-41cd-ad38-e833d4c269df"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"}],"description":"","message_list":[],"uuid":"e8845237-9bcb-4af4-bc3a-363885b5962c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_fc3bf5ce_7070_4a40_bc68_179c74c82418","uuid":"c6f453a4-f347-4204-b1af-b7a7bc036b8d"},"name":"SYS_GEN__Runbook_Deployment_fc3bf5ce_7070_4a40_bc68_179c74c82418"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"adfd4e75-b2e4-492a-83c6-0bbfdd277b94","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"retries":"0","description":"","type":"DAG","uuid":"bba3fe14-7348-4ebc-b663-f4ecda3e2e35","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"134ca693-2d3a-4917-9b34-361714a45996"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"0bdabf12-b95a-463d-b724-29acf0b934f7"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"bceb8615-60c2-4d37-9d35-a6251818cdca"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"e63030d0-dedd-4216-a5c7-7069e70bfce4"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_fc3bf5ce_7070_4a40_bc68_179c74c82418","uuid":"8fa7a338-9278-40e5-8928-011b0c253e91"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"134ca693-2d3a-4917-9b34-361714a45996"},"edge_type":"inherent","type":"","uuid":"df44d178-3423-400e-a709-d3a055c83caf","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"0bdabf12-b95a-463d-b724-29acf0b934f7"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"0bdabf12-b95a-463d-b724-29acf0b934f7"},"edge_type":"inherent","type":"","uuid":"4fce56cf-d291-4faa-ad9f-4f030bdcfea3","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"bceb8615-60c2-4d37-9d35-a6251818cdca"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"e63030d0-dedd-4216-a5c7-7069e70bfce4"},"edge_type":"inherent","type":"","uuid":"eb75bffd-a96f-44c3-89eb-2d78b62498ab","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_fc3bf5ce_7070_4a40_bc68_179c74c82418","uuid":"8fa7a338-9278-40e5-8928-011b0c253e91"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"bceb8615-60c2-4d37-9d35-a6251818cdca"},"edge_type":"inherent","type":"","uuid":"3a3862dd-e881-447a-ad03-7204f48ecba5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"e63030d0-dedd-4216-a5c7-7069e70bfce4"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_fc3bf5ce_7070_4a40_bc68_179c74c82418"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"134ca693-2d3a-4917-9b34-361714a45996","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12105be2-ee67-451d-8054-4546855e277c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0bdabf12-b95a-463d-b724-29acf0b934f7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"6b0fd64c-e97f-4968-998d-ff058e95d9e9"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"bceb8615-60c2-4d37-9d35-a6251818cdca","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"c9c66e34-5944-40a2-9d4a-9d37168ba0fc"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_c41ebbe6_49ab_4a43_8618_22679865e405"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e63030d0-dedd-4216-a5c7-7069e70bfce4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"4a69cf91-6008-41ca-961d-7bf1f8a03ae3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"8fa7a338-9278-40e5-8928-011b0c253e91","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_fc3bf5ce_7070_4a40_bc68_179c74c82418"}],"description":"","message_list":[],"uuid":"7fe2715f-61ab-44fc-ae75-378f2f793d0f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_fc3bf5ce_7070_4a40_bc68_179c74c82418","uuid":"bba3fe14-7348-4ebc-b663-f4ecda3e2e35"},"name":"SYS_GEN__Runbook_Deployment_fc3bf5ce_7070_4a40_bc68_179c74c82418"}},{"description":"System action for scaleout","message_list":[],"uuid":"50c4ca92-b815-42bf-89e9-ebf3b10e49d9","name":"action_scaleout","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"retries":"0","description":"","type":"DAG","uuid":"4296e642-89c4-40f4-87cd-7870d36138cb","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scaleout_fc3bf5ce_7070_4a40_bc68_179c74c82418","uuid":"748c04f7-dee2-4667-89f4-700476eb6a56"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_fc3bf5ce_7070_4a40_bc68_179c74c82418"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"retries":"0","description":"","type":"SCALING","uuid":"748c04f7-dee2-4667-89f4-700476eb6a56","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scaleout_fc3bf5ce_7070_4a40_bc68_179c74c82418"}],"description":"","message_list":[],"uuid":"4cfba4f0-095a-4539-863a-45d3795a5076","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"087b0bbd-1e13-4e01-93f2-69bec37a8ee0","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_fc3bf5ce_7070_4a40_bc68_179c74c82418","uuid":"4296e642-89c4-40f4-87cd-7870d36138cb"},"name":"SYS_GEN__Runbook_Deployment_fc3bf5ce_7070_4a40_bc68_179c74c82418"}},{"description":"System action for scalein","message_list":[],"uuid":"018d749e-db33-4a03-8e82-a39fb8e92102","name":"action_scalein","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"retries":"0","description":"","type":"DAG","uuid":"bc808890-6515-448c-9fe4-0c8f82abb4cb","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scalein_fc3bf5ce_7070_4a40_bc68_179c74c82418","uuid":"d5187fda-6860-4eeb-a76a-2f60b2034e8d"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_fc3bf5ce_7070_4a40_bc68_179c74c82418"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"retries":"0","description":"","type":"SCALING","uuid":"d5187fda-6860-4eeb-a76a-2f60b2034e8d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scalein_fc3bf5ce_7070_4a40_bc68_179c74c82418"}],"description":"","message_list":[],"uuid":"dfbbfb5e-c11f-4034-b2f7-695ac276d47c","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"c9b4047e-a5e2-4003-b070-d14b09b5bf22","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_fc3bf5ce_7070_4a40_bc68_179c74c82418","uuid":"bc808890-6515-448c-9fe4-0c8f82abb4cb"},"name":"SYS_GEN__Runbook_Deployment_fc3bf5ce_7070_4a40_bc68_179c74c82418"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"05fc8bcd-0642-4820-ac43-0a4d2885d877","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"retries":"0","description":"","type":"DAG","uuid":"65eff9b5-d1f4-4f40-bfd9-f4458a44e877","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"325eb0d8-06b7-496c-b275-a7e95ecfee11"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"557531f0-fe84-4de1-a482-5c77a10848d2"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"0d5beafb-2148-43c4-96fe-70f2b57245ba"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_fc3bf5ce_7070_4a40_bc68_179c74c82418","uuid":"7a9fbcb8-4d79-411c-94d0-0e5bba35dc8d"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"325eb0d8-06b7-496c-b275-a7e95ecfee11"},"edge_type":"inherent","type":"","uuid":"e6228597-92e5-4f98-abcd-c212f4308d36","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"557531f0-fe84-4de1-a482-5c77a10848d2"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"0d5beafb-2148-43c4-96fe-70f2b57245ba"},"edge_type":"inherent","type":"","uuid":"64e5e79b-88ed-41a1-8122-f7ede0b06840","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_fc3bf5ce_7070_4a40_bc68_179c74c82418","uuid":"7a9fbcb8-4d79-411c-94d0-0e5bba35dc8d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"557531f0-fe84-4de1-a482-5c77a10848d2"},"edge_type":"inherent","type":"","uuid":"4412053d-2fc4-416d-9426-a15bad642baa","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"0d5beafb-2148-43c4-96fe-70f2b57245ba"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_fc3bf5ce_7070_4a40_bc68_179c74c82418"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"325eb0d8-06b7-496c-b275-a7e95ecfee11","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"d44a642f-9468-432a-9b7e-e69a7c1c08e7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"557531f0-fe84-4de1-a482-5c77a10848d2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_c41ebbe6_49ab_4a43_8618_22679865e405"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0d5beafb-2148-43c4-96fe-70f2b57245ba","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"ea14db9b-6d77-4831-9085-1808af033e31"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"7a9fbcb8-4d79-411c-94d0-0e5bba35dc8d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_fc3bf5ce_7070_4a40_bc68_179c74c82418"}],"description":"","message_list":[],"uuid":"5ec39070-bad5-4120-9b49-5279ec3dc3ea","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_fc3bf5ce_7070_4a40_bc68_179c74c82418","uuid":"65eff9b5-d1f4-4f40-bfd9-f4458a44e877"},"name":"SYS_GEN__Runbook_Deployment_fc3bf5ce_7070_4a40_bc68_179c74c82418"}}],"message_list":[],"published_service_local_reference_list":[],"uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418","min_replicas":"2","state":"DRAFT","max_replicas":"9","depends_on_list":[],"editables":{"min_replicas":true,"max_replicas":true},"package_local_reference_list":[{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"}],"substrate_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"type":"GREENFIELD","options":{},"variable_list":[],"name":"39cf7283_deployment"}],"description":"","action_list":[{"description":"","message_list":[],"uuid":"8df48e43-7721-4abd-8683-ae43bc5d9a15","name":"Upgrade","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"52ef32b7-658e-44bf-b409-9c4b0e259927","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Version Master","uuid":"b1165af4-fc50-45af-aca6-b3a6da147144"},{"kind":"app_task","name":"Upgrade Master","uuid":"e7ed1437-3bed-4981-96a6-5c9cf02f8920"},{"kind":"app_task","name":"Set Version Minion","uuid":"9d38d3ff-c4e3-4e19-9af8-a33bd77c59ee"},{"kind":"app_task","name":"Upgrade Minion","uuid":"6b7804fd-ef9c-45b0-b0f9-a47c0d4a0d13"},{"kind":"app_task","name":"RestartServices","uuid":"7bdf0e2b-5a44-4196-8c32-295d5481bf5a"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"b1165af4-fc50-45af-aca6-b3a6da147144"},"edge_type":"user_defined","type":"","uuid":"9aed1018-f53d-4e41-b8b2-eafd2482f3e8","to_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"e7ed1437-3bed-4981-96a6-5c9cf02f8920"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"e7ed1437-3bed-4981-96a6-5c9cf02f8920"},"edge_type":"user_defined","type":"","uuid":"58a5f2b7-f87c-44b6-9eaf-2a0146eb3264","to_task_reference":{"kind":"app_task","name":"RestartServices","uuid":"7bdf0e2b-5a44-4196-8c32-295d5481bf5a"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"b1165af4-fc50-45af-aca6-b3a6da147144"},"edge_type":"user_defined","type":"","uuid":"608fca6e-9d32-4497-a872-f88272162ac2","to_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"9d38d3ff-c4e3-4e19-9af8-a33bd77c59ee"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"9d38d3ff-c4e3-4e19-9af8-a33bd77c59ee"},"edge_type":"user_defined","type":"","uuid":"c2a52bd3-1a83-47bb-bff6-10989b039704","to_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"6b7804fd-ef9c-45b0-b0f9-a47c0d4a0d13"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"6b7804fd-ef9c-45b0-b0f9-a47c0d4a0d13"},"edge_type":"user_defined","type":"","uuid":"3888636f-e123-41bd-a551-5ce993657ce0","to_task_reference":{"kind":"app_task","name":"RestartServices","uuid":"7bdf0e2b-5a44-4196-8c32-295d5481bf5a"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6ee65d8a_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"b1165af4-fc50-45af-aca6-b3a6da147144","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"if \"@@{calm_array_index}@@\" == \"0\":\n\tprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Version Master"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"e7ed1437-3bed-4981-96a6-5c9cf02f8920","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{KUBE_VERSION_NEW}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nCONTROLLER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,AlwaysPullImages,DenyEscalatingExec,SecurityContextDeny,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false \n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Upgrade Master"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"9d38d3ff-c4e3-4e19-9af8-a33bd77c59ee","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"if \"@@{calm_array_index}@@\" == \"0\":\n\tprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Version Minion"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"6b7804fd-ef9c-45b0-b0f9-a47c0d4a0d13","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{KUBE_VERSION_NEW}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Upgrade Minion"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"7bdf0e2b-5a44-4196-8c32-295d5481bf5a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nMINION_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nJSONPATH='{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}'\nKUBE_VERSION_NEW=\"@@{KUBE_VERSION_NEW}@@\"\nMASTER_API_HTTPS=6443\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION_NEW}\/bin\/linux\/amd64\/kubectl\nchmod +x kubectl\nsudo mv kubectl \/usr\/local\/bin\/kubectl\n\ncount=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n  echo \"Trying to reach master server https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} : sleep for 5 secs\"\n  sleep 10\n  if [[ $count -eq 10 ]]; then\n  \techo \"Unable to reach master server: https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\"\n  \texit 1\n  fi\n  count=$((count+1))\ndone\n\ncount=0\nfor ip in $(echo \"${MINION_IPS}\" | tr \",\" \"\\n\"); do\n  #kubectl drain \"minion${count}\" --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no $ip \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 10\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=minion${count} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon minion${count}\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n\techo \"Upgrade failed on minion nodes\"\n    exit 1\nfi\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  #kubectl drain \"controller${count}\" --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no $ip \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 10\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=controller${count} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon controller${count}\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n\techo \"Upgrade failed on nodes: $(kubectl get nodes -o jsonpath='$JSONPATH' | grep 'Ready=Unknown')\"\n    exit 1\nfi"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"RestartServices"}],"description":"","message_list":[],"uuid":"c3ec0eab-79cc-4b1a-b51f-0e71968588ab","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"49b2515e-dd46-4b17-9eab-39b2a6b3acf7","value":"v1.8.14","label":"","state":"NOT_VALIDATED","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_VERSION_NEW"}],"main_task_local_reference":{"kind":"app_task","name":"6ee65d8a_dag","uuid":"52ef32b7-658e-44bf-b409-9c4b0e259927"},"name":"68a7ffd0_runbook"}},{"description":"","message_list":[],"uuid":"541eae7e-8d41-442b-ae29-81192fb1af0d","name":"ScaleOut","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"8266d7d6-332f-4928-aafa-f3f13a7bd0ac","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Out","uuid":"baa95372-5ba8-4cd6-ba97-9f8957aac695"},{"kind":"app_task","name":"Set Hosts file","uuid":"20c45d3c-7c3a-4538-a5aa-954b7cbe4176"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Scale Out","uuid":"baa95372-5ba8-4cd6-ba97-9f8957aac695"},"edge_type":"user_defined","type":"","uuid":"9a82a174-70af-4dce-87ae-117fd9ab5921","to_task_reference":{"kind":"app_task","name":"Set Hosts file","uuid":"20c45d3c-7c3a-4538-a5aa-954b7cbe4176"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"03b33121_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"retries":"0","description":"","type":"SCALING","uuid":"baa95372-5ba8-4cd6-ba97-9f8957aac695","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Scale Out"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"20c45d3c-7c3a-4538-a5aa-954b7cbe4176","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMINION_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  if ! (( $(grep -c \"${ip} minion${count}\" \/etc\/hosts) )) ; then\n  \techo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  fi\n  count=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Hosts file"}],"description":"","message_list":[],"uuid":"4af27fbc-fada-4b75-986a-176445a6d03a","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"1f237a1b-8194-4967-9180-eb4006e0c3a1","value":"1","label":"","state":"NOT_VALIDATED","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"03b33121_dag","uuid":"8266d7d6-332f-4928-aafa-f3f13a7bd0ac"},"name":"00cf5417_runbook"}},{"description":"","message_list":[],"uuid":"d0b6b1e1-1f41-4f0a-989f-e2509ff10cb1","name":"ScaleIn","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"b51fe409-5ef5-4ce7-b393-565bcdcff1af","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale In","uuid":"aa58b812-afd5-4a10-9d6f-f231897f722e"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"e72a9133_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"retries":"0","description":"","type":"SCALING","uuid":"aa58b812-afd5-4a10-9d6f-f231897f722e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Scale In"}],"description":"","message_list":[],"uuid":"012e53d8-3810-46d2-9085-a56d149b39de","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"b9748588-8d49-4c60-aa12-1344ac24da84","value":"1","label":"","state":"NOT_VALIDATED","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"e72a9133_dag","uuid":"b51fe409-5ef5-4ce7-b393-565bcdcff1af"},"name":"96546f6c_runbook"}},{"description":"System action for creating an application","message_list":[],"uuid":"11abc250-b0eb-4658-a0bd-2d2a219a96ad","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"67de5c53-dd3c-4c6a-8503-d5ee5a087af3"},"retries":"0","description":"","type":"DAG","uuid":"7d1f4bc5-83eb-41dd-9033-20bca0774f83","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778","uuid":"81917546-e41e-4a6f-82c3-abac9c73ba50"},{"kind":"app_task","name":"SYS_GEN__DE_Provision_fc3bf5ce_7070_4a40_bc68_179c74c82418","uuid":"bb7295b3-bd0b-4048-a77c-1fd1f622896f"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147","uuid":"8edff39f-3072-4497-a188-e4cb4aaf6b06"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147_1","uuid":"1eaa070c-bc37-4abe-8015-104f041f5629"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"031ff218-89bb-4b48-8f5c-c39607e7949b"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"e171ba1c-a5a3-4191-bbec-a9592118a346"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"f681ac4a-5730-4d35-a6ad-c588b0a4184f"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"4f5db527-863f-4a5f-9db4-8f3cf1c52bc7"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"caf8f461-548e-4359-9b20-0eac3d61cbb9"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"84c42d75-dd17-4764-b0e0-fd39e62512a0"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"08008a1e-dfa3-4ecc-aabc-9a8ea8a4642c"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"74b74fba-d7b5-419b-855a-49ad4058398d"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"caf8f461-548e-4359-9b20-0eac3d61cbb9"},"edge_type":"inherent","type":"","uuid":"9d7dab20-b698-4f48-ab8c-203ac13e14f8","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"08008a1e-dfa3-4ecc-aabc-9a8ea8a4642c"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"f681ac4a-5730-4d35-a6ad-c588b0a4184f"},"edge_type":"inherent","type":"","uuid":"441056c5-461c-4117-b239-6dab2ca48070","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"caf8f461-548e-4359-9b20-0eac3d61cbb9"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778","uuid":"81917546-e41e-4a6f-82c3-abac9c73ba50"},"edge_type":"inherent","type":"","uuid":"702bd405-3a16-4aec-b22e-6181ca6d1967","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"031ff218-89bb-4b48-8f5c-c39607e7949b"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147","uuid":"8edff39f-3072-4497-a188-e4cb4aaf6b06"},"edge_type":"inherent","type":"","uuid":"cc73f07d-2a0e-4bba-985d-62c837214937","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"031ff218-89bb-4b48-8f5c-c39607e7949b"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"031ff218-89bb-4b48-8f5c-c39607e7949b"},"edge_type":"inherent","type":"","uuid":"b7cdee26-c7a5-48f7-a1e9-6176161357eb","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"f681ac4a-5730-4d35-a6ad-c588b0a4184f"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778","uuid":"81917546-e41e-4a6f-82c3-abac9c73ba50"},"edge_type":"inherent","type":"","uuid":"e975d959-134e-46a9-a37c-455f5a6c8d1d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147","uuid":"8edff39f-3072-4497-a188-e4cb4aaf6b06"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"84c42d75-dd17-4764-b0e0-fd39e62512a0"},"edge_type":"inherent","type":"","uuid":"c21f0afb-3774-4e0e-b814-5f8c07a84344","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"74b74fba-d7b5-419b-855a-49ad4058398d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"4f5db527-863f-4a5f-9db4-8f3cf1c52bc7"},"edge_type":"inherent","type":"","uuid":"4a644e3e-8d7e-471f-9609-2138354d21fd","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"84c42d75-dd17-4764-b0e0-fd39e62512a0"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"e171ba1c-a5a3-4191-bbec-a9592118a346"},"edge_type":"inherent","type":"","uuid":"c9f13982-54e4-4b52-b77b-833f281c669b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"4f5db527-863f-4a5f-9db4-8f3cf1c52bc7"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147_1","uuid":"1eaa070c-bc37-4abe-8015-104f041f5629"},"edge_type":"inherent","type":"","uuid":"e3c5e7c5-1401-415a-afe8-345d251ad78b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"e171ba1c-a5a3-4191-bbec-a9592118a346"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_fc3bf5ce_7070_4a40_bc68_179c74c82418","uuid":"bb7295b3-bd0b-4048-a77c-1fd1f622896f"},"edge_type":"inherent","type":"","uuid":"92bff742-eb1a-4159-b0e5-58d0b076e1f7","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"e171ba1c-a5a3-4191-bbec-a9592118a346"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_fc3bf5ce_7070_4a40_bc68_179c74c82418","uuid":"bb7295b3-bd0b-4048-a77c-1fd1f622896f"},"edge_type":"inherent","type":"","uuid":"d2a43346-50c1-4da4-b90f-00d49a34f482","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147_1","uuid":"1eaa070c-bc37-4abe-8015-104f041f5629"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"e171ba1c-a5a3-4191-bbec-a9592118a346"},"edge_type":"dependency","type":"","uuid":"52a992a2-9035-466a-a406-9e53c18ab220","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"f681ac4a-5730-4d35-a6ad-c588b0a4184f"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"031ff218-89bb-4b48-8f5c-c39607e7949b"},"edge_type":"dependency","type":"","uuid":"c878518c-7be7-46f0-95b6-78a87966fa6e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"4f5db527-863f-4a5f-9db4-8f3cf1c52bc7"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_67de5c53_dd3c_4c6a_8503_d5ee5a087af3"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"81917546-e41e-4a6f-82c3-abac9c73ba50","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"bb7295b3-bd0b-4048-a77c-1fd1f622896f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_fc3bf5ce_7070_4a40_bc68_179c74c82418"},{"target_any_local_reference":{"kind":"app_package","name":"CENTOS_74","uuid":"6cbb9b5f-3255-4d45-8d8f-0891f27ac147"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8edff39f-3072-4497-a188-e4cb4aaf6b06","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147","uuid":"d428ae02-ea02-4587-b9ee-8020e81686c6"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147"},{"target_any_local_reference":{"kind":"app_package","name":"CENTOS_74","uuid":"6cbb9b5f-3255-4d45-8d8f-0891f27ac147"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1eaa070c-bc37-4abe-8015-104f041f5629","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147","uuid":"d428ae02-ea02-4587-b9ee-8020e81686c6"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147_1"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"031ff218-89bb-4b48-8f5c-c39607e7949b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"9adb6919-b3c1-4abf-a7b2-49a04e78704f"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e171ba1c-a5a3-4191-bbec-a9592118a346","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"741ae977-6c62-4a73-af5d-0616318987d9"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f681ac4a-5730-4d35-a6ad-c588b0a4184f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"8eda840d-20b1-4ce1-8d3d-7da38a9aee82"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_56b66f14_39cc_4320_8394_17636712b055"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4f5db527-863f-4a5f-9db4-8f3cf1c52bc7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"241eb780-c41d-4b86-9adb-377699867bd7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_c41ebbe6_49ab_4a43_8618_22679865e405"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"caf8f461-548e-4359-9b20-0eac3d61cbb9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"aa8dd27e-4bd1-4b85-86c6-750c0a49579f"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"84c42d75-dd17-4764-b0e0-fd39e62512a0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"cabcfd41-35e6-45f0-a791-00daf17de059"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"08008a1e-dfa3-4ecc-aabc-9a8ea8a4642c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"64e5991c-fbcd-4d1f-8b72-4b4956e9702e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"74b74fba-d7b5-419b-855a-49ad4058398d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"91f453c1-d2fc-47b1-93d4-4b49476235be"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"789eea6d-4c1a-413e-aa93-da95efa6b12a","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_67de5c53_dd3c_4c6a_8503_d5ee5a087af3","uuid":"7d1f4bc5-83eb-41dd-9033-20bca0774f83"},"name":"SYS_GEN__Runbook_Application_67de5c53_dd3c_4c6a_8503_d5ee5a087af3"}},{"description":"System action for starting an application","message_list":[],"uuid":"3cb84bfe-40a2-4218-bf97-a8795d8bc4f7","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"67de5c53-dd3c-4c6a-8503-d5ee5a087af3"},"retries":"0","description":"","type":"DAG","uuid":"dff55e0b-5ce6-40ec-b5ac-09ccbc553d45","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"b6c1afdc-dff0-4c81-bdff-8cd65c6b0ef5"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"3c8956cc-ff5c-455e-a794-409f1ff9aa53"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"4425e139-dcbe-43b3-849a-b4a0e0319f1e"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"0bf49de7-8ef7-4039-a859-09fa75b6d12a"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"3c8956cc-ff5c-455e-a794-409f1ff9aa53"},"edge_type":"inherent","type":"","uuid":"78b496d1-a5a3-45f0-a37f-743c7d3737d6","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"0bf49de7-8ef7-4039-a859-09fa75b6d12a"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"b6c1afdc-dff0-4c81-bdff-8cd65c6b0ef5"},"edge_type":"inherent","type":"","uuid":"50fe1c1e-b45d-4391-b8c1-3dfbc4ba5fe1","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"4425e139-dcbe-43b3-849a-b4a0e0319f1e"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_67de5c53_dd3c_4c6a_8503_d5ee5a087af3"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b6c1afdc-dff0-4c81-bdff-8cd65c6b0ef5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"75216d24-aace-4a81-b784-609a5faa5be6"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3c8956cc-ff5c-455e-a794-409f1ff9aa53","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"065b517e-f244-4120-864d-d018ef13315b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4425e139-dcbe-43b3-849a-b4a0e0319f1e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"91f453c1-d2fc-47b1-93d4-4b49476235be"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0bf49de7-8ef7-4039-a859-09fa75b6d12a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"64e5991c-fbcd-4d1f-8b72-4b4956e9702e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"49058ef9-bcff-4155-88d9-7e1e2f8f3d2f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_67de5c53_dd3c_4c6a_8503_d5ee5a087af3","uuid":"dff55e0b-5ce6-40ec-b5ac-09ccbc553d45"},"name":"SYS_GEN__Runbook_Application_67de5c53_dd3c_4c6a_8503_d5ee5a087af3"}},{"description":"System action for restarting an application","message_list":[],"uuid":"c620031e-6c14-4b3b-a1d4-cc621f133840","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"67de5c53-dd3c-4c6a-8503-d5ee5a087af3"},"retries":"0","description":"","type":"DAG","uuid":"6e2423dd-35c8-469a-a437-de4124e2b6b8","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"145720ea-3fba-43f5-bc09-69315110c296"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"d975a6ff-682d-48c4-a4ad-bcd21352dc82"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"0bac193e-3cb6-49d5-9311-5ec59fbfe2c2"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"1b907eb5-5fca-4357-8101-e6d75f9aaffd"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"d975a6ff-682d-48c4-a4ad-bcd21352dc82"},"edge_type":"inherent","type":"","uuid":"d7bb9636-bcfc-4c64-bbd5-35a4d8bd4060","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"1b907eb5-5fca-4357-8101-e6d75f9aaffd"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"145720ea-3fba-43f5-bc09-69315110c296"},"edge_type":"inherent","type":"","uuid":"adec5e98-5c42-4fba-8318-d903f3b2102b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"0bac193e-3cb6-49d5-9311-5ec59fbfe2c2"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_67de5c53_dd3c_4c6a_8503_d5ee5a087af3"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"145720ea-3fba-43f5-bc09-69315110c296","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"58877011-609a-4aa8-9014-3c64fe37229e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d975a6ff-682d-48c4-a4ad-bcd21352dc82","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"7892c56e-ed00-4e96-b932-83b17646490d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0bac193e-3cb6-49d5-9311-5ec59fbfe2c2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"3fd75c09-a79f-4731-98fc-b65b96bc9fe7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1b907eb5-5fca-4357-8101-e6d75f9aaffd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"526cc0d4-3d9e-49c6-840b-f42e056f5d89"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"8ccc4650-f5f1-4a10-bae3-df1a42def77c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_67de5c53_dd3c_4c6a_8503_d5ee5a087af3","uuid":"6e2423dd-35c8-469a-a437-de4124e2b6b8"},"name":"SYS_GEN__Runbook_Application_67de5c53_dd3c_4c6a_8503_d5ee5a087af3"}},{"description":"System action for stopping an application","message_list":[],"uuid":"db444638-994d-40bf-950b-a80fb88b0253","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"67de5c53-dd3c-4c6a-8503-d5ee5a087af3"},"retries":"0","description":"","type":"DAG","uuid":"3312b2fa-db98-442d-a2cd-057aee3863d0","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"5c6c4f2b-bd08-44a6-bc48-a0d8cdbf0803"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"da2d5b95-f7ec-4bf5-8e10-d2b18d3165c0"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"200e5a25-928f-467a-80c9-4b608b11cb28"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"666e7b4d-511a-4db4-ac07-b0416eafcde3"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"5c6c4f2b-bd08-44a6-bc48-a0d8cdbf0803"},"edge_type":"inherent","type":"","uuid":"3de86238-ae15-42b8-a939-66df02b2eb9f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"666e7b4d-511a-4db4-ac07-b0416eafcde3"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"da2d5b95-f7ec-4bf5-8e10-d2b18d3165c0"},"edge_type":"inherent","type":"","uuid":"96d34c48-adaf-40af-bd80-fbfa7893dac0","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"200e5a25-928f-467a-80c9-4b608b11cb28"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_67de5c53_dd3c_4c6a_8503_d5ee5a087af3"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5c6c4f2b-bd08-44a6-bc48-a0d8cdbf0803","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"1fdd3541-2eca-471a-a4be-4ef82887d4de"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"da2d5b95-f7ec-4bf5-8e10-d2b18d3165c0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12105be2-ee67-451d-8054-4546855e277c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"200e5a25-928f-467a-80c9-4b608b11cb28","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"4cca75d8-075a-41cd-ad38-e833d4c269df"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"666e7b4d-511a-4db4-ac07-b0416eafcde3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"0d2bb72a-8cc6-4e7b-b5ab-dc0f5be4af24"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf"}],"description":"","message_list":[],"uuid":"5c7714d9-f6af-4fb6-9588-14ff2f77156e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_67de5c53_dd3c_4c6a_8503_d5ee5a087af3","uuid":"3312b2fa-db98-442d-a2cd-057aee3863d0"},"name":"SYS_GEN__Runbook_Application_67de5c53_dd3c_4c6a_8503_d5ee5a087af3"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"89febcc2-97f1-4185-8d1b-2d8c51f0967e","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"67de5c53-dd3c-4c6a-8503-d5ee5a087af3"},"retries":"0","description":"","type":"DAG","uuid":"dfffe646-9f04-4691-a4a5-127d0ba752c3","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"1a6c5009-fc32-4551-9543-f775d42e6491"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"ab74ca92-d1d6-45ee-8d1d-82dffdb0db59"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"bf8c8cab-e4e9-473a-94c3-664c06930b1f"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"6c6757e3-7a68-4886-94df-bf85874e9751"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"bde16c30-0225-4da3-93ba-86173cec27cb"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"ba95eb8b-f9ef-4575-91d8-66ad5d652d73"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"65814bf8-d19c-4106-9d31-1da3f50cc14c"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"66d6ae5b-6688-4d49-a71b-8a187c0e92d4"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_fc3bf5ce_7070_4a40_bc68_179c74c82418","uuid":"80cfd063-08f2-40d9-a319-819a8ffc1486"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778","uuid":"9b3f4b6e-02bc-4de6-8b5a-f73fadcafcf9"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"ab74ca92-d1d6-45ee-8d1d-82dffdb0db59"},"edge_type":"inherent","type":"","uuid":"2b17293b-8c93-4ce6-a9fa-491eaa0ed834","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"bf8c8cab-e4e9-473a-94c3-664c06930b1f"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"bf8c8cab-e4e9-473a-94c3-664c06930b1f"},"edge_type":"inherent","type":"","uuid":"848bf6ae-b68c-40fa-926e-e739726d60b2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"ba95eb8b-f9ef-4575-91d8-66ad5d652d73"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"ba95eb8b-f9ef-4575-91d8-66ad5d652d73"},"edge_type":"inherent","type":"","uuid":"52429416-c813-4688-8d1e-cf23bfe2157b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"66d6ae5b-6688-4d49-a71b-8a187c0e92d4"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"66d6ae5b-6688-4d49-a71b-8a187c0e92d4"},"edge_type":"inherent","type":"","uuid":"940ff107-fa7f-439c-8453-f1052c6f4e88","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778","uuid":"9b3f4b6e-02bc-4de6-8b5a-f73fadcafcf9"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"1a6c5009-fc32-4551-9543-f775d42e6491"},"edge_type":"inherent","type":"","uuid":"5f7cc951-88ba-47e6-9b96-d68d160e8609","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"6c6757e3-7a68-4886-94df-bf85874e9751"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"6c6757e3-7a68-4886-94df-bf85874e9751"},"edge_type":"inherent","type":"","uuid":"64691b42-4a6e-4686-897a-6393fef7f3c8","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"bde16c30-0225-4da3-93ba-86173cec27cb"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"65814bf8-d19c-4106-9d31-1da3f50cc14c"},"edge_type":"inherent","type":"","uuid":"a2380638-7781-438e-a564-6806adef6aa4","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_fc3bf5ce_7070_4a40_bc68_179c74c82418","uuid":"80cfd063-08f2-40d9-a319-819a8ffc1486"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"bde16c30-0225-4da3-93ba-86173cec27cb"},"edge_type":"inherent","type":"","uuid":"90b71e12-37a2-413b-afb0-65fd3414c0e7","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"65814bf8-d19c-4106-9d31-1da3f50cc14c"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"ba95eb8b-f9ef-4575-91d8-66ad5d652d73"},"edge_type":"create_action_edge","type":"","uuid":"d120e02f-8929-41e8-b398-4b0bc1c82fe6","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"65814bf8-d19c-4106-9d31-1da3f50cc14c"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"bde16c30-0225-4da3-93ba-86173cec27cb"},"edge_type":"create_action_edge","type":"","uuid":"b2e10e15-5df3-4183-a00b-ed142e92ceac","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"66d6ae5b-6688-4d49-a71b-8a187c0e92d4"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"bf8c8cab-e4e9-473a-94c3-664c06930b1f"},"edge_type":"dependency","type":"","uuid":"5293f765-ae84-4dd3-8039-933d31c75c6d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"bde16c30-0225-4da3-93ba-86173cec27cb"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_67de5c53_dd3c_4c6a_8503_d5ee5a087af3"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1a6c5009-fc32-4551-9543-f775d42e6491","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12105be2-ee67-451d-8054-4546855e277c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ab74ca92-d1d6-45ee-8d1d-82dffdb0db59","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"1fdd3541-2eca-471a-a4be-4ef82887d4de"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"bf8c8cab-e4e9-473a-94c3-664c06930b1f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"a2ac512f-d272-4905-bafb-4733f7e58c9b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6c6757e3-7a68-4886-94df-bf85874e9751","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"6b0fd64c-e97f-4968-998d-ff058e95d9e9"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"bde16c30-0225-4da3-93ba-86173cec27cb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"c9c66e34-5944-40a2-9d4a-9d37168ba0fc"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_c41ebbe6_49ab_4a43_8618_22679865e405"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ba95eb8b-f9ef-4575-91d8-66ad5d652d73","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"f385c2c1-849a-4ea0-bb13-2a5c0a754ad3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_56b66f14_39cc_4320_8394_17636712b055"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"65814bf8-d19c-4106-9d31-1da3f50cc14c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"4a69cf91-6008-41ca-961d-7bf1f8a03ae3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"66d6ae5b-6688-4d49-a71b-8a187c0e92d4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"cc6eb93f-a61a-455f-bcc8-fdd5ebb03ee9"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"80cfd063-08f2-40d9-a319-819a8ffc1486","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_fc3bf5ce_7070_4a40_bc68_179c74c82418"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"9b3f4b6e-02bc-4de6-8b5a-f73fadcafcf9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778"}],"description":"","message_list":[],"uuid":"b38bc0cb-eaa7-4425-8f7c-9a517c030f40","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_67de5c53_dd3c_4c6a_8503_d5ee5a087af3","uuid":"dfffe646-9f04-4691-a4a5-127d0ba752c3"},"name":"SYS_GEN__Runbook_Application_67de5c53_dd3c_4c6a_8503_d5ee5a087af3"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"d18bea8a-18f0-4474-9895-68ef4cfeb7b3","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"67de5c53-dd3c-4c6a-8503-d5ee5a087af3"},"retries":"0","description":"","type":"DAG","uuid":"d4f6ed7a-bccd-4696-8e68-a70a0fd18515","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"49974769-d1e1-4f5c-9d76-ebe987d152be"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"44b8e9a3-95e7-49a1-a950-22e05edbb343"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_56b66f14_39cc_4320_8394_17636712b055","uuid":"da2fe1ca-56df-4815-8eb0-a6001a64d5dc"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"de7cbea6-92ea-4414-b067-b7c2df217ea9"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"8178f3bd-0ab7-4bb1-9dac-51231a4b8710"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"47107eaf-48c8-4128-a1e6-d525b6710bc8"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778","uuid":"983e5a14-64a1-43e5-8f7f-6c2f00f89d2c"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_fc3bf5ce_7070_4a40_bc68_179c74c82418","uuid":"eafd7c07-d1de-41bd-a961-9fdd1237811c"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"44b8e9a3-95e7-49a1-a950-22e05edbb343"},"edge_type":"inherent","type":"","uuid":"e61cd114-cb50-465c-a8d9-abf9c63cb215","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_56b66f14_39cc_4320_8394_17636712b055","uuid":"da2fe1ca-56df-4815-8eb0-a6001a64d5dc"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"8178f3bd-0ab7-4bb1-9dac-51231a4b8710"},"edge_type":"inherent","type":"","uuid":"36b252ff-db6a-453c-a1ee-8b3c6dbee9a2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778","uuid":"983e5a14-64a1-43e5-8f7f-6c2f00f89d2c"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_56b66f14_39cc_4320_8394_17636712b055","uuid":"da2fe1ca-56df-4815-8eb0-a6001a64d5dc"},"edge_type":"inherent","type":"","uuid":"9f15531d-6a4c-4894-9a04-066739e9b415","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"8178f3bd-0ab7-4bb1-9dac-51231a4b8710"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"49974769-d1e1-4f5c-9d76-ebe987d152be"},"edge_type":"inherent","type":"","uuid":"02954979-6a41-4dd2-9a64-61b1647fc76a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"de7cbea6-92ea-4414-b067-b7c2df217ea9"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"47107eaf-48c8-4128-a1e6-d525b6710bc8"},"edge_type":"inherent","type":"","uuid":"17cbaec1-1440-4799-8d3c-d925c464aafc","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_fc3bf5ce_7070_4a40_bc68_179c74c82418","uuid":"eafd7c07-d1de-41bd-a961-9fdd1237811c"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"de7cbea6-92ea-4414-b067-b7c2df217ea9"},"edge_type":"inherent","type":"","uuid":"755bb0d5-2851-4e20-8c52-80cb05d8c8ec","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"47107eaf-48c8-4128-a1e6-d525b6710bc8"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_56b66f14_39cc_4320_8394_17636712b055","uuid":"da2fe1ca-56df-4815-8eb0-a6001a64d5dc"},"edge_type":"create_action_edge","type":"","uuid":"17a9734f-066f-4729-9a80-1c133e143dbe","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"47107eaf-48c8-4128-a1e6-d525b6710bc8"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"de7cbea6-92ea-4414-b067-b7c2df217ea9"},"edge_type":"create_action_edge","type":"","uuid":"88489c24-d9e0-45b9-ae20-6522f636500d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"8178f3bd-0ab7-4bb1-9dac-51231a4b8710"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_67de5c53_dd3c_4c6a_8503_d5ee5a087af3"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"49974769-d1e1-4f5c-9d76-ebe987d152be","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"d44a642f-9468-432a-9b7e-e69a7c1c08e7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"44b8e9a3-95e7-49a1-a950-22e05edbb343","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"50a769a7-5b0a-4546-9e12-4f0a3ceff21b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"da2fe1ca-56df-4815-8eb0-a6001a64d5dc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_56b66f14_39cc_4320_8394_17636712b055"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"de7cbea6-92ea-4414-b067-b7c2df217ea9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_c41ebbe6_49ab_4a43_8618_22679865e405"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8178f3bd-0ab7-4bb1-9dac-51231a4b8710","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf","uuid":"3e7fe7d8-5436-46f0-99a0-ee0a1f411c44"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_36dbce6d_ca23_448a_91ee_69ef8735b2cf"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"47107eaf-48c8-4128-a1e6-d525b6710bc8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1","uuid":"ea14db9b-6d77-4831-9085-1808af033e31"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_da1cd62d_f7f6_48ee_b6fb_63c633eae3d1"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"983e5a14-64a1-43e5-8f7f-6c2f00f89d2c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_ac3359e0_f3f0_4bcf_8ff9_9483b0ae2778"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"eafd7c07-d1de-41bd-a961-9fdd1237811c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_fc3bf5ce_7070_4a40_bc68_179c74c82418"}],"description":"","message_list":[],"uuid":"f369923d-b220-45de-b99f-4b272f0e952c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_67de5c53_dd3c_4c6a_8503_d5ee5a087af3","uuid":"d4f6ed7a-bccd-4696-8e68-a70a0fd18515"},"name":"SYS_GEN__Runbook_Application_67de5c53_dd3c_4c6a_8503_d5ee5a087af3"}}],"message_list":[],"uuid":"67de5c53-dd3c-4c6a-8503-d5ee5a087af3","state":"DRAFT","dependency_list":[{"getter_resource_kind":"PackageCfg","setter_resource_attr":"address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"AHV_Centos_K8SM","action_name":"action_create","action_resource_name":"Nutanix","getter_resource_name":"AHV_Centos_K8SC_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"AHV_Centos_K8SC","action_name":"action_create","action_resource_name":"Nutanix","getter_resource_name":"AHV_Centos_K8SM_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"address","setter_resource_kind":"ServiceCfg","setter_resource_name":"Kubernetes_Master","action_name":"action_delete","action_resource_name":"Nutanix","getter_resource_name":"AHV_Centos_K8SM_Package","action_resource_kind":"ApplicationCfg"}],"variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"a9cde443-81ca-4b3f-a241-7b5c329f0268","value":"kube-calm","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_CLUSTER_NAME"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"c9a4bd83-ff61-4e3e-9958-3319e13db038","value":"v1.8.0","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_VERSION"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"c90d50cf-add7-4e47-817b-2669b4db4769","value":"17.03.2.ce","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"DOCKER_VERSION"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"ea654b1b-ec70-46fa-b61d-9bb5eb09e85f","value":"10.200.0.0\/16","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_CLUSTER_SUBNET"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"73c62af9-dd56-4e4b-9db4-625389f88503","value":"10.32.0.0\/24","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_SERVICE_SUBNET"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"92475432-f8e5-4223-8b36-76200cae509c","value":"10.32.0.10","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_DNS_IP"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"ba461b6f-30da-4ed6-9f71-c8142415a9bf","value":"10.5.68.20","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"PE_CLUSTER_IP"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"ca26ae6f-5fd0-403b-9775-79913a485449","value":"10.5.68.27","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"PE_DATA_SERVICE_IP"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"62338d48-f33f-4301-83c0-f98a6a1983f2","value":"admin","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"PE_USERNAME"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[{"message":"Secret value for variable is empty","reason":"EMPTY_VALUE","details":[{"attribute_name":"secret"}]},{"message":"Value of secret variable is empty","reason":"EMPTY_VALUE","details":[{"attribute_name":"value"}]}],"uuid":"3d9f1936-188f-4d49-b5e2-66bd547ddc24","value":"","label":"","state":"ACTIVE","attrs":{"is_secret_modified":false,"secret_reference":{"uuid":"1fd3b902-509c-490d-a0a0-c3f3a7745e22"},"type":""},"editables":{"value":true},"is_hidden":false,"type":"SECRET","options":{},"name":"PE_PASSWORD"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"f5ef95f1-2154-4590-8254-ba9aac7eebe4","value":"default-container-71229","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"PE_CONTAINER_NAME"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"a1bd93c4-dcc6-4cff-b427-7daf72c06768","value":"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDMGAS\/K0Mb\/uwFXwD+hkjguy7VMZk2hpuhwPl9FUZwVBrURf\/i9QMJ5\/paPEZixu8VlRx7Inu4iun7rQfrnfeIYInmBwspXHYiTK3oHJAgZnrAHVEf1p6YaxLINlT1NI5yOAGPRWW6of8rBDBH1ObwU2+wcSx\/1H0uIs3aZNLufr+Rh628ACxAum2Gt8AVRj6ua2BPFyt5VTdclyysAmeh1AiixNgOZXOz6y\/i4TbzpY78I3isuKpxsUeXX6jxEMQol406jHDUF6njEOPIQG2zVZ3QJlTG9OlN+NiyZG9WkZz0VG\/6M8ixxIHHI2dNwUbBFv2HUu+8X9LTLFq2O7KjX9Hp7uZKBAySHA3eKaKHIp2bZuU1bT5PRPkggngX86xg+T+OMNnutbAiMnRJ8+FvD5So+5TIx4b9GgxAxure3x2yRPT9lOiQOB+CVpJPxR0Rn9bOI+wiPnD0kAGvK\/fHT+pqL4PM+hTnJtp9rrCRzIQApBx1263jEcYffhW2epZQRO+he5CMawFJ5TBe08om2AaDJ8GQdrpF6YA3W8DzHbmL3DPVVHdmqPLn10o+LX4gv5SdIIDVGdjKOc1BCnLTRmM28d5+sLDt\/M+kvcQgf0y0yDjMVjGECZkt39hbm4ELMHzZtzYLmHNhBZxRqHeJ7qFTuv1kx88OW3Xc5mbBNQ== centos@nutanix.com","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"INSTANCE_PUBLIC_KEY"}],"name":"Nutanix"},{"deployment_create_list":[{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"179c0dad-a85d-451e-be24-16a42f6e6da9","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"retries":"0","description":"","type":"DAG","uuid":"66c0c64c-ba0d-4d88-b465-149b17c652d9","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_f5bcb26d_6a13_4eb5_91c5_202d025130f0","uuid":"0adc40c0-f07c-4ed9-a55d-81724b1bd6be"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"da53aa8e-3993-450e-bb0f-72d320be7d70"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"1309ad9a-8550-4991-a817-9227902689b0"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"02acc407-7ef4-4a34-9488-781cd3e3bc7c"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"8af5de75-ae21-452b-96a2-7ae6aae6ba38"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"02acc407-7ef4-4a34-9488-781cd3e3bc7c"},"edge_type":"inherent","type":"","uuid":"45668a23-d35a-4c19-b906-9f483ef84201","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"8af5de75-ae21-452b-96a2-7ae6aae6ba38"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"1309ad9a-8550-4991-a817-9227902689b0"},"edge_type":"inherent","type":"","uuid":"78fe5f56-f340-4eae-93d6-48e4b071012c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"02acc407-7ef4-4a34-9488-781cd3e3bc7c"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_f5bcb26d_6a13_4eb5_91c5_202d025130f0","uuid":"0adc40c0-f07c-4ed9-a55d-81724b1bd6be"},"edge_type":"inherent","type":"","uuid":"70faf98c-8b42-413a-b9cf-1b217183cacb","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"da53aa8e-3993-450e-bb0f-72d320be7d70"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"da53aa8e-3993-450e-bb0f-72d320be7d70"},"edge_type":"inherent","type":"","uuid":"a8ed9dcf-5e53-41a0-8ad1-20e224c9c60e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"1309ad9a-8550-4991-a817-9227902689b0"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_f5bcb26d_6a13_4eb5_91c5_202d025130f0"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"0adc40c0-f07c-4ed9-a55d-81724b1bd6be","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_f5bcb26d_6a13_4eb5_91c5_202d025130f0"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"da53aa8e-3993-450e-bb0f-72d320be7d70","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"8483e6d4-c7f2-4892-9db9-bf02f918ed0e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1309ad9a-8550-4991-a817-9227902689b0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"585fde78-19e6-48c9-ba86-a4a9e5ac1e92"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"02acc407-7ef4-4a34-9488-781cd3e3bc7c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"aa8dd27e-4bd1-4b85-86c6-750c0a49579f"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8af5de75-ae21-452b-96a2-7ae6aae6ba38","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"64e5991c-fbcd-4d1f-8b72-4b4956e9702e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"de264fd7-265f-4948-83b6-4c46b3a05964","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_f5bcb26d_6a13_4eb5_91c5_202d025130f0","uuid":"66c0c64c-ba0d-4d88-b465-149b17c652d9"},"name":"SYS_GEN__Runbook_Deployment_f5bcb26d_6a13_4eb5_91c5_202d025130f0"}},{"description":"System action for starting an application","message_list":[],"uuid":"89426586-8f65-44d7-8b5c-d274f30e6faf","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"retries":"0","description":"","type":"DAG","uuid":"978724e2-7251-498d-9b49-648d4e4628c4","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"e07b3123-b9fd-4ee6-a357-b0e0dba04f0d"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"f8aa2861-9acd-44f0-99c9-8c7a2491c80b"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"e07b3123-b9fd-4ee6-a357-b0e0dba04f0d"},"edge_type":"inherent","type":"","uuid":"19913b50-36d5-4c86-8b1e-4ade48c8147d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"f8aa2861-9acd-44f0-99c9-8c7a2491c80b"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_f5bcb26d_6a13_4eb5_91c5_202d025130f0"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e07b3123-b9fd-4ee6-a357-b0e0dba04f0d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"959c1cfd-ac3c-4780-a3c6-78006fe552d8"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f8aa2861-9acd-44f0-99c9-8c7a2491c80b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"64e5991c-fbcd-4d1f-8b72-4b4956e9702e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"4129db6d-65a9-44ed-be85-59fb44caeb20","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_f5bcb26d_6a13_4eb5_91c5_202d025130f0","uuid":"978724e2-7251-498d-9b49-648d4e4628c4"},"name":"SYS_GEN__Runbook_Deployment_f5bcb26d_6a13_4eb5_91c5_202d025130f0"}},{"description":"System action for restarting an application","message_list":[],"uuid":"c595644d-dad5-4849-b5fc-f7b2a1f02abf","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"retries":"0","description":"","type":"DAG","uuid":"b9ecbb9c-7734-428d-967b-b0b296a0e728","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"7feace28-b939-40da-8a07-f1f8ac65a5b1"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"341c6a79-4126-4656-b7c7-4ce498b16a18"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"7feace28-b939-40da-8a07-f1f8ac65a5b1"},"edge_type":"inherent","type":"","uuid":"84745aa9-3776-45d2-b062-4781a72dc3dd","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"341c6a79-4126-4656-b7c7-4ce498b16a18"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_f5bcb26d_6a13_4eb5_91c5_202d025130f0"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"7feace28-b939-40da-8a07-f1f8ac65a5b1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"5a293fb1-1872-4c27-8463-927e83b262ab"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"341c6a79-4126-4656-b7c7-4ce498b16a18","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"526cc0d4-3d9e-49c6-840b-f42e056f5d89"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"38365355-18ff-48b1-a508-4fe49c12d874","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_f5bcb26d_6a13_4eb5_91c5_202d025130f0","uuid":"b9ecbb9c-7734-428d-967b-b0b296a0e728"},"name":"SYS_GEN__Runbook_Deployment_f5bcb26d_6a13_4eb5_91c5_202d025130f0"}},{"description":"System action for stopping an application","message_list":[],"uuid":"97ec0378-0541-44a0-9ef9-dc6d16c8cb12","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"retries":"0","description":"","type":"DAG","uuid":"a746f838-89ad-45bd-b022-ee1c9211a93b","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"646183fc-2000-4681-bfc4-259623035ee6"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"2a70a52c-e2f2-4f1e-914e-758949a1c98b"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"646183fc-2000-4681-bfc4-259623035ee6"},"edge_type":"inherent","type":"","uuid":"77b83b92-4c61-49ab-a7a6-03777431370a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"2a70a52c-e2f2-4f1e-914e-758949a1c98b"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_f5bcb26d_6a13_4eb5_91c5_202d025130f0"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"646183fc-2000-4681-bfc4-259623035ee6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"1fdd3541-2eca-471a-a4be-4ef82887d4de"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2a70a52c-e2f2-4f1e-914e-758949a1c98b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"18e921b6-2c59-410e-ae6c-b1270ba17b36"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"}],"description":"","message_list":[],"uuid":"ba1805db-8d83-45c2-9c4e-2f9444e8f7d6","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_f5bcb26d_6a13_4eb5_91c5_202d025130f0","uuid":"a746f838-89ad-45bd-b022-ee1c9211a93b"},"name":"SYS_GEN__Runbook_Deployment_f5bcb26d_6a13_4eb5_91c5_202d025130f0"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"a1ba9dff-44d9-4567-8a60-6f29591568d6","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"retries":"0","description":"","type":"DAG","uuid":"9e317f07-7d85-4bb8-b058-1dceb000a4ea","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"0f26442d-58b0-45b8-ba45-0957bdc1b37b"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"8cea4f59-9417-4217-98df-371badc7992f"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"6c50e809-54a1-447f-ba74-32220b9a8196"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"a1e466c6-54c5-4617-962a-fcaa5250243e"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_f5bcb26d_6a13_4eb5_91c5_202d025130f0","uuid":"1266e1c1-9e31-476a-8584-6e5d86604507"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"0f26442d-58b0-45b8-ba45-0957bdc1b37b"},"edge_type":"inherent","type":"","uuid":"536ebe56-5b44-4eb3-9404-b454c6be02fa","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"8cea4f59-9417-4217-98df-371badc7992f"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"8cea4f59-9417-4217-98df-371badc7992f"},"edge_type":"inherent","type":"","uuid":"43d37d10-b5b2-4a66-9472-642a771b4c94","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"6c50e809-54a1-447f-ba74-32220b9a8196"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"a1e466c6-54c5-4617-962a-fcaa5250243e"},"edge_type":"inherent","type":"","uuid":"daed633e-2438-422f-9862-df3b58bec683","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_f5bcb26d_6a13_4eb5_91c5_202d025130f0","uuid":"1266e1c1-9e31-476a-8584-6e5d86604507"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"6c50e809-54a1-447f-ba74-32220b9a8196"},"edge_type":"inherent","type":"","uuid":"8dd0b01c-ee00-4a5d-a2ed-7500dacbc5f3","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"a1e466c6-54c5-4617-962a-fcaa5250243e"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_f5bcb26d_6a13_4eb5_91c5_202d025130f0"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0f26442d-58b0-45b8-ba45-0957bdc1b37b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"1fdd3541-2eca-471a-a4be-4ef82887d4de"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8cea4f59-9417-4217-98df-371badc7992f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"a2ac512f-d272-4905-bafb-4733f7e58c9b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6c50e809-54a1-447f-ba74-32220b9a8196","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"db7bd1e1-71d4-4755-8088-596bc82d1960"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a1e466c6-54c5-4617-962a-fcaa5250243e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"6265517c-4786-44ff-a8eb-9973562e5492"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"1266e1c1-9e31-476a-8584-6e5d86604507","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_f5bcb26d_6a13_4eb5_91c5_202d025130f0"}],"description":"","message_list":[],"uuid":"84e7a208-400b-4918-8747-19de2bb51181","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_f5bcb26d_6a13_4eb5_91c5_202d025130f0","uuid":"9e317f07-7d85-4bb8-b058-1dceb000a4ea"},"name":"SYS_GEN__Runbook_Deployment_f5bcb26d_6a13_4eb5_91c5_202d025130f0"}},{"description":"System action for scaleout","message_list":[],"uuid":"c24391d5-a415-4742-a009-db0b3ad868dc","name":"action_scaleout","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"retries":"0","description":"","type":"DAG","uuid":"8fdb2910-7940-491b-b4e3-83a2d346047e","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scaleout_f5bcb26d_6a13_4eb5_91c5_202d025130f0","uuid":"47bf2883-c508-4384-bcf8-dab5ce71e315"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_f5bcb26d_6a13_4eb5_91c5_202d025130f0"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"retries":"0","description":"","type":"SCALING","uuid":"47bf2883-c508-4384-bcf8-dab5ce71e315","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scaleout_f5bcb26d_6a13_4eb5_91c5_202d025130f0"}],"description":"","message_list":[],"uuid":"8aa77d25-cf64-401b-b9a0-511feceb9b73","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"50bd6884-5336-4e80-bc9a-8b0e8648e20f","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_f5bcb26d_6a13_4eb5_91c5_202d025130f0","uuid":"8fdb2910-7940-491b-b4e3-83a2d346047e"},"name":"SYS_GEN__Runbook_Deployment_f5bcb26d_6a13_4eb5_91c5_202d025130f0"}},{"description":"System action for scalein","message_list":[],"uuid":"613b32a4-33ab-489a-87bc-b660906c7270","name":"action_scalein","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"retries":"0","description":"","type":"DAG","uuid":"47c5210d-1f59-4d12-b8ed-a66bb4343179","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scalein_f5bcb26d_6a13_4eb5_91c5_202d025130f0","uuid":"2b0ffb7b-1534-4b7c-9d6f-b457e98c6b1d"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_f5bcb26d_6a13_4eb5_91c5_202d025130f0"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"retries":"0","description":"","type":"SCALING","uuid":"2b0ffb7b-1534-4b7c-9d6f-b457e98c6b1d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scalein_f5bcb26d_6a13_4eb5_91c5_202d025130f0"}],"description":"","message_list":[],"uuid":"0e5ae479-7daa-4e2e-a42f-885427f98f26","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"b4db592a-779f-401d-988e-3433708b7c68","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_f5bcb26d_6a13_4eb5_91c5_202d025130f0","uuid":"47c5210d-1f59-4d12-b8ed-a66bb4343179"},"name":"SYS_GEN__Runbook_Deployment_f5bcb26d_6a13_4eb5_91c5_202d025130f0"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"b749722d-9a55-4405-a91c-08e5101e173e","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"retries":"0","description":"","type":"DAG","uuid":"bc81314c-e11f-40cb-a7fd-9c042177c6f9","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"b5f931b4-7956-411f-a2d5-7cc08e816ff2"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"5593bf6a-0048-4349-8037-42b3c9c5f5e7"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"24803e30-ac8d-4b7d-8d00-dc9828616b4e"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_f5bcb26d_6a13_4eb5_91c5_202d025130f0","uuid":"0cad87d3-2db5-43be-a9cf-7f0534035775"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"b5f931b4-7956-411f-a2d5-7cc08e816ff2"},"edge_type":"inherent","type":"","uuid":"84681999-0c1e-425d-ae25-61fcf2443036","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"5593bf6a-0048-4349-8037-42b3c9c5f5e7"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"24803e30-ac8d-4b7d-8d00-dc9828616b4e"},"edge_type":"inherent","type":"","uuid":"3262cc01-e87a-4a4f-836d-62ba8d080d81","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_f5bcb26d_6a13_4eb5_91c5_202d025130f0","uuid":"0cad87d3-2db5-43be-a9cf-7f0534035775"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"5593bf6a-0048-4349-8037-42b3c9c5f5e7"},"edge_type":"inherent","type":"","uuid":"f957f796-5ec2-4c7d-9c6f-26ef21fa519a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"24803e30-ac8d-4b7d-8d00-dc9828616b4e"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_f5bcb26d_6a13_4eb5_91c5_202d025130f0"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b5f931b4-7956-411f-a2d5-7cc08e816ff2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"50a769a7-5b0a-4546-9e12-4f0a3ceff21b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"5593bf6a-0048-4349-8037-42b3c9c5f5e7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_f5299fdf_a772_41d5_9925_c87ddaec8f1f"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"24803e30-ac8d-4b7d-8d00-dc9828616b4e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"69afda04-66da-4e92-a707-33e3d9483d51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"0cad87d3-2db5-43be-a9cf-7f0534035775","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_f5bcb26d_6a13_4eb5_91c5_202d025130f0"}],"description":"","message_list":[],"uuid":"7b038cfe-9419-4253-86c4-f12d524d448c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_f5bcb26d_6a13_4eb5_91c5_202d025130f0","uuid":"bc81314c-e11f-40cb-a7fd-9c042177c6f9"},"name":"SYS_GEN__Runbook_Deployment_f5bcb26d_6a13_4eb5_91c5_202d025130f0"}}],"message_list":[],"published_service_local_reference_list":[],"uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0","min_replicas":"3","state":"DRAFT","max_replicas":"3","depends_on_list":[],"editables":{"min_replicas":true,"max_replicas":true},"package_local_reference_list":[{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"}],"substrate_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"type":"GREENFIELD","options":{},"variable_list":[],"name":"85fa2262_deployment"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"64ace714-3f1b-48a2-a51a-a3b986e3c7db","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"retries":"0","description":"","type":"DAG","uuid":"54f84cb8-c868-4f39-bfcc-353c4d865202","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_a49dec52_b184_47d2_b1db_43be87961d75","uuid":"c85a9958-7fb5-41a1-9b08-2ce2ccf666e8"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"33e1d318-c43d-428d-a35f-0d729e7deab8"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"a4850ecf-9e6b-4b8c-b185-29653e4dab47"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"1ca86d83-182e-4a5e-9c42-944d0d852544"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"6e5ecf96-aa21-4680-a79d-9d75bb48ecb0"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"1ca86d83-182e-4a5e-9c42-944d0d852544"},"edge_type":"inherent","type":"","uuid":"5aa04863-32f9-4f42-a640-b9c7474a47c7","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"6e5ecf96-aa21-4680-a79d-9d75bb48ecb0"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"a4850ecf-9e6b-4b8c-b185-29653e4dab47"},"edge_type":"inherent","type":"","uuid":"252dc87c-540c-442b-bf58-36440ef705ac","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"1ca86d83-182e-4a5e-9c42-944d0d852544"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_a49dec52_b184_47d2_b1db_43be87961d75","uuid":"c85a9958-7fb5-41a1-9b08-2ce2ccf666e8"},"edge_type":"inherent","type":"","uuid":"592086f8-f43b-4825-b281-9f0b4b0518ce","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"33e1d318-c43d-428d-a35f-0d729e7deab8"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"33e1d318-c43d-428d-a35f-0d729e7deab8"},"edge_type":"inherent","type":"","uuid":"300b5c5d-dbb9-4a5d-b29b-f164e8dd5f5f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"a4850ecf-9e6b-4b8c-b185-29653e4dab47"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_a49dec52_b184_47d2_b1db_43be87961d75"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"c85a9958-7fb5-41a1-9b08-2ce2ccf666e8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_a49dec52_b184_47d2_b1db_43be87961d75"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"33e1d318-c43d-428d-a35f-0d729e7deab8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"def6e2c5-b303-4ec8-b188-15372bb95b3c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a4850ecf-9e6b-4b8c-b185-29653e4dab47","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"fb9ba7b7-3d51-4c90-9bbc-47181df49fd4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_50dfc849_7772_4832_9398_4cd2048be3e7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1ca86d83-182e-4a5e-9c42-944d0d852544","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"cabcfd41-35e6-45f0-a791-00daf17de059"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6e5ecf96-aa21-4680-a79d-9d75bb48ecb0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"91f453c1-d2fc-47b1-93d4-4b49476235be"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"c1c9a636-7d3c-48d5-b871-3aa07df329d3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_a49dec52_b184_47d2_b1db_43be87961d75","uuid":"54f84cb8-c868-4f39-bfcc-353c4d865202"},"name":"SYS_GEN__Runbook_Deployment_a49dec52_b184_47d2_b1db_43be87961d75"}},{"description":"System action for starting an application","message_list":[],"uuid":"a156da8d-ff56-47ff-866f-8691aa857467","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"retries":"0","description":"","type":"DAG","uuid":"e4bd4e13-34b2-4ff0-be7d-2dc332a51c75","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"174aa824-3a61-475d-8cca-e4008baa068b"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"a2104217-f910-4155-ae74-544aa66db572"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"174aa824-3a61-475d-8cca-e4008baa068b"},"edge_type":"inherent","type":"","uuid":"b7a6b00d-b039-452b-97b2-4aaef7d96bbc","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"a2104217-f910-4155-ae74-544aa66db572"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_a49dec52_b184_47d2_b1db_43be87961d75"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"174aa824-3a61-475d-8cca-e4008baa068b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"57f10355-32b0-465b-98d7-569944a5b82d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a2104217-f910-4155-ae74-544aa66db572","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"91f453c1-d2fc-47b1-93d4-4b49476235be"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"25762fda-e5f4-4358-994f-c183948f9bfb","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_a49dec52_b184_47d2_b1db_43be87961d75","uuid":"e4bd4e13-34b2-4ff0-be7d-2dc332a51c75"},"name":"SYS_GEN__Runbook_Deployment_a49dec52_b184_47d2_b1db_43be87961d75"}},{"description":"System action for restarting an application","message_list":[],"uuid":"6f091ccf-ea10-494a-a955-a1370a6bf223","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"retries":"0","description":"","type":"DAG","uuid":"e9d3296f-994b-4031-bb84-1949a20073ab","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"fedb7392-0281-44cf-8547-a231832b6ae9"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"c82dac84-f1c0-4c92-993b-47eaf484ec47"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"fedb7392-0281-44cf-8547-a231832b6ae9"},"edge_type":"inherent","type":"","uuid":"c87f5741-0ba1-4a45-b145-6915f7f9b8eb","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"c82dac84-f1c0-4c92-993b-47eaf484ec47"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_a49dec52_b184_47d2_b1db_43be87961d75"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"fedb7392-0281-44cf-8547-a231832b6ae9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"b588a0aa-9805-4e09-aba8-895eab6ce1fc"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c82dac84-f1c0-4c92-993b-47eaf484ec47","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"3fd75c09-a79f-4731-98fc-b65b96bc9fe7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"b179aa23-007b-47b4-a338-5ac2fba02204","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_a49dec52_b184_47d2_b1db_43be87961d75","uuid":"e9d3296f-994b-4031-bb84-1949a20073ab"},"name":"SYS_GEN__Runbook_Deployment_a49dec52_b184_47d2_b1db_43be87961d75"}},{"description":"System action for stopping an application","message_list":[],"uuid":"a2cb1292-89e8-4675-b1c2-590db22ace49","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"retries":"0","description":"","type":"DAG","uuid":"2caa7ee8-89f6-4746-8f80-58f89f200792","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"2bae272f-fa14-409f-bf43-b605055f284a"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"dc9825f2-3cc5-46d5-b076-af021e87c72f"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"2bae272f-fa14-409f-bf43-b605055f284a"},"edge_type":"inherent","type":"","uuid":"8ecd29de-d519-4af5-aada-90f7d58281a9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"dc9825f2-3cc5-46d5-b076-af021e87c72f"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_a49dec52_b184_47d2_b1db_43be87961d75"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2bae272f-fa14-409f-bf43-b605055f284a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12105be2-ee67-451d-8054-4546855e277c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"dc9825f2-3cc5-46d5-b076-af021e87c72f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"40427dd3-54dc-4590-81fe-773009583773"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950"}],"description":"","message_list":[],"uuid":"a6ee3a92-f77e-4f44-82e3-6f88e62d885a","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_a49dec52_b184_47d2_b1db_43be87961d75","uuid":"2caa7ee8-89f6-4746-8f80-58f89f200792"},"name":"SYS_GEN__Runbook_Deployment_a49dec52_b184_47d2_b1db_43be87961d75"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"86d82927-c124-4b9e-b9f2-39e92b2b2056","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"retries":"0","description":"","type":"DAG","uuid":"3b810e8c-538e-49e3-95ad-69a63c7bdd9d","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"acc6ddd0-258e-4c50-9862-22eea6343d7a"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"b6195568-a2d6-494a-abbf-daed6604e291"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"5034033a-ca96-4804-8fe1-011952e220cf"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"0e81003c-aa54-41a2-bcd0-45d8009eb91f"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_a49dec52_b184_47d2_b1db_43be87961d75","uuid":"f9d45a2c-bba8-474f-9411-3a8a6d1aa035"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"acc6ddd0-258e-4c50-9862-22eea6343d7a"},"edge_type":"inherent","type":"","uuid":"3dd5c568-cc25-4c8d-b971-38672ea1877d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"b6195568-a2d6-494a-abbf-daed6604e291"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"b6195568-a2d6-494a-abbf-daed6604e291"},"edge_type":"inherent","type":"","uuid":"239087ed-7392-4004-8087-52f280a2f29b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"5034033a-ca96-4804-8fe1-011952e220cf"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"5034033a-ca96-4804-8fe1-011952e220cf"},"edge_type":"inherent","type":"","uuid":"352d830f-c394-474f-a365-af04dd9d17fb","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"0e81003c-aa54-41a2-bcd0-45d8009eb91f"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"0e81003c-aa54-41a2-bcd0-45d8009eb91f"},"edge_type":"inherent","type":"","uuid":"bf1864f0-289c-49ae-9e07-fe2eda23b8d5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_a49dec52_b184_47d2_b1db_43be87961d75","uuid":"f9d45a2c-bba8-474f-9411-3a8a6d1aa035"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_a49dec52_b184_47d2_b1db_43be87961d75"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"acc6ddd0-258e-4c50-9862-22eea6343d7a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12105be2-ee67-451d-8054-4546855e277c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b6195568-a2d6-494a-abbf-daed6604e291","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"6b0fd64c-e97f-4968-998d-ff058e95d9e9"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5034033a-ca96-4804-8fe1-011952e220cf","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"ae954a62-63c8-4a91-8fa4-1cf584c94f3e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_50dfc849_7772_4832_9398_4cd2048be3e7"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0e81003c-aa54-41a2-bcd0-45d8009eb91f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"93942b54-fdd6-47fd-9032-05631aa55b79"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"f9d45a2c-bba8-474f-9411-3a8a6d1aa035","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_a49dec52_b184_47d2_b1db_43be87961d75"}],"description":"","message_list":[],"uuid":"7da866ae-624e-4483-822a-a7aa8ea12cb9","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_a49dec52_b184_47d2_b1db_43be87961d75","uuid":"3b810e8c-538e-49e3-95ad-69a63c7bdd9d"},"name":"SYS_GEN__Runbook_Deployment_a49dec52_b184_47d2_b1db_43be87961d75"}},{"description":"System action for scaleout","message_list":[],"uuid":"8ee0c172-ab64-4893-9cb7-460ea1610f5d","name":"action_scaleout","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"retries":"0","description":"","type":"DAG","uuid":"fae76164-8010-4c98-ac11-64938ef9460b","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scaleout_a49dec52_b184_47d2_b1db_43be87961d75","uuid":"0a5c07ff-0c41-4b7b-beca-18cf7ea45eb5"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_a49dec52_b184_47d2_b1db_43be87961d75"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"retries":"0","description":"","type":"SCALING","uuid":"0a5c07ff-0c41-4b7b-beca-18cf7ea45eb5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scaleout_a49dec52_b184_47d2_b1db_43be87961d75"}],"description":"","message_list":[],"uuid":"788bea5a-b55e-479c-be6b-13ae89e0cd3c","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"66dbd537-dc92-4aeb-a540-6244b3746ef4","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_a49dec52_b184_47d2_b1db_43be87961d75","uuid":"fae76164-8010-4c98-ac11-64938ef9460b"},"name":"SYS_GEN__Runbook_Deployment_a49dec52_b184_47d2_b1db_43be87961d75"}},{"description":"System action for scalein","message_list":[],"uuid":"45c49ebd-87c7-4b5c-89c1-84c246587fcd","name":"action_scalein","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"retries":"0","description":"","type":"DAG","uuid":"256d430a-0190-4873-aae6-3d864c3edfd7","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scalein_a49dec52_b184_47d2_b1db_43be87961d75","uuid":"36f6e228-7bb0-43d3-9b68-9cc76d6e1640"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_a49dec52_b184_47d2_b1db_43be87961d75"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"retries":"0","description":"","type":"SCALING","uuid":"36f6e228-7bb0-43d3-9b68-9cc76d6e1640","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scalein_a49dec52_b184_47d2_b1db_43be87961d75"}],"description":"","message_list":[],"uuid":"563ab564-a1c2-486f-942c-d0817f88b7c6","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"409165a3-76c8-4df6-8ebd-9b783095abd0","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_a49dec52_b184_47d2_b1db_43be87961d75","uuid":"256d430a-0190-4873-aae6-3d864c3edfd7"},"name":"SYS_GEN__Runbook_Deployment_a49dec52_b184_47d2_b1db_43be87961d75"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"a5371dbd-3090-43b8-90be-f728d8ff318e","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"retries":"0","description":"","type":"DAG","uuid":"ef884520-50cc-42b1-bdee-24d3f49bfcd3","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"b5c827e9-1de9-46da-8e1f-c3424019fe2e"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"e22ae495-cfa1-41a6-8f22-223dfda3269c"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"d5c48548-8a0b-4c86-bfa4-8a82ed53f69e"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_a49dec52_b184_47d2_b1db_43be87961d75","uuid":"65e9c6fd-042d-455b-b7fc-eb7a11c4d7c7"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"b5c827e9-1de9-46da-8e1f-c3424019fe2e"},"edge_type":"inherent","type":"","uuid":"1c9e9f1a-e533-44ba-a2a2-fe9b714d2010","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"e22ae495-cfa1-41a6-8f22-223dfda3269c"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"e22ae495-cfa1-41a6-8f22-223dfda3269c"},"edge_type":"inherent","type":"","uuid":"5f6f2a21-0b05-4b67-bb15-ca0609bb51d5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"d5c48548-8a0b-4c86-bfa4-8a82ed53f69e"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"d5c48548-8a0b-4c86-bfa4-8a82ed53f69e"},"edge_type":"inherent","type":"","uuid":"a265963b-fc8d-4d74-96a2-1adf4bccee0b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_a49dec52_b184_47d2_b1db_43be87961d75","uuid":"65e9c6fd-042d-455b-b7fc-eb7a11c4d7c7"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_a49dec52_b184_47d2_b1db_43be87961d75"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b5c827e9-1de9-46da-8e1f-c3424019fe2e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"d44a642f-9468-432a-9b7e-e69a7c1c08e7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"e22ae495-cfa1-41a6-8f22-223dfda3269c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_50dfc849_7772_4832_9398_4cd2048be3e7"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d5c48548-8a0b-4c86-bfa4-8a82ed53f69e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"f8a5bf98-f18f-44d5-bf70-d5cd0568e9ab"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"65e9c6fd-042d-455b-b7fc-eb7a11c4d7c7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_a49dec52_b184_47d2_b1db_43be87961d75"}],"description":"","message_list":[],"uuid":"3b97dcf3-6b05-42ce-bfe9-dbe2d8ae6f32","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_a49dec52_b184_47d2_b1db_43be87961d75","uuid":"ef884520-50cc-42b1-bdee-24d3f49bfcd3"},"name":"SYS_GEN__Runbook_Deployment_a49dec52_b184_47d2_b1db_43be87961d75"}}],"message_list":[],"published_service_local_reference_list":[],"uuid":"a49dec52-b184-47d2-b1db-43be87961d75","min_replicas":"3","state":"DRAFT","max_replicas":"9","depends_on_list":[],"editables":{"min_replicas":true,"max_replicas":true},"package_local_reference_list":[{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"}],"substrate_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"type":"GREENFIELD","options":{},"variable_list":[],"name":"d6584f2e_deployment"}],"description":"","action_list":[{"description":"","message_list":[],"uuid":"814c5c05-42be-4bb3-817f-8b2199915599","name":"Upgrade","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"66458b52-fd26-4e25-b2f9-14799bbd5147","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Version Master","uuid":"11db2829-cbc1-48ad-92a6-78a3d3900b4c"},{"kind":"app_task","name":"Upgrade Controller","uuid":"931e4355-5d87-4674-83e3-4cbd3c611a9b"},{"kind":"app_task","name":"Set Version Minion","uuid":"bd4414b2-8ba3-4f55-8612-98d1fcda2984"},{"kind":"app_task","name":"Upgrade Minion","uuid":"00da6f94-0f2d-44ac-b0bf-6bdb5beed842"},{"kind":"app_task","name":"Restart Services","uuid":"187c3f31-ca02-4b04-8b27-d4c27e205019"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"11db2829-cbc1-48ad-92a6-78a3d3900b4c"},"edge_type":"user_defined","type":"","uuid":"28870c3f-d312-42a1-baa6-fafdaf04a236","to_task_reference":{"kind":"app_task","name":"Upgrade Controller","uuid":"931e4355-5d87-4674-83e3-4cbd3c611a9b"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Controller","uuid":"931e4355-5d87-4674-83e3-4cbd3c611a9b"},"edge_type":"user_defined","type":"","uuid":"50e19759-aa38-4886-af0d-288dd3c32a21","to_task_reference":{"kind":"app_task","name":"Restart Services","uuid":"187c3f31-ca02-4b04-8b27-d4c27e205019"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"bd4414b2-8ba3-4f55-8612-98d1fcda2984"},"edge_type":"user_defined","type":"","uuid":"f2d61f9e-4d5c-4691-8a4f-e577747dfd7b","to_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"00da6f94-0f2d-44ac-b0bf-6bdb5beed842"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"11db2829-cbc1-48ad-92a6-78a3d3900b4c"},"edge_type":"user_defined","type":"","uuid":"51f29400-d1a5-4ec9-89b8-d3c71372c73f","to_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"bd4414b2-8ba3-4f55-8612-98d1fcda2984"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"00da6f94-0f2d-44ac-b0bf-6bdb5beed842"},"edge_type":"user_defined","type":"","uuid":"9a48f57f-3bdc-4408-81aa-d0f55b3a305c","to_task_reference":{"kind":"app_task","name":"Restart Services","uuid":"187c3f31-ca02-4b04-8b27-d4c27e205019"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"17adda9e_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"11db2829-cbc1-48ad-92a6-78a3d3900b4c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"if \"@@{calm_array_index}@@\" == \"0\":\n\tprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Version Master"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"931e4355-5d87-4674-83e3-4cbd3c611a9b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{KUBE_VERSION_NEW}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nCONTROLLER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=aws \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,AlwaysPullImages,DenyEscalatingExec,SecurityContextDeny,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --cloud-provider=aws\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --cloud-provider=aws\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Upgrade Controller"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"bd4414b2-8ba3-4f55-8612-98d1fcda2984","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"if \"@@{calm_array_index}@@\" == \"0\":\n\tprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Version Minion"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"00da6f94-0f2d-44ac-b0bf-6bdb5beed842","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{KUBE_VERSION_NEW}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=aws \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Upgrade Minion"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"187c3f31-ca02-4b04-8b27-d4c27e205019","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_DNS=\"@@{calm_array_private_dns_name}@@\" \nMINION_DNS=\"@@{AWS_Centos_K8SM.private_dns_name}@@\" \nJSONPATH='{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}'\nKUBE_VERSION_NEW=\"@@{KUBE_VERSION_NEW}@@\"\nMASTER_API_HTTPS=6443\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION_NEW}\/bin\/linux\/amd64\/kubectl\nchmod +x kubectl\nsudo mv kubectl \/usr\/local\/bin\/kubectl\n\ncount=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n  echo \"Trying to reach master server https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} : sleep for 5 secs\"\n  sleep 10\n  if [[ $count -eq 10 ]]; then\n  \techo \"Unable to reach master server: https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\"\n  \texit 1\n  fi\n  count=$((count+1))\ndone\n\nfor name in $(echo \"${MINION_DNS}\" | tr \",\" \"\\n\"); do\n  #kubectl drain \"$name\" --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no $name \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 20\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=${name} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon $name\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n\techo \"Upgrade failed on minion nodes\"\n    exit 1\nfi\n\nfor name in $(echo \"${CONTROLLER_DNS}\" | tr \",\" \"\\n\"); do\n  #kubectl drain \"${name}\" --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no $name \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 20\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=$name -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon $name\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n\techo \"Upgrade failed on nodes: $(kubectl get nodes -o jsonpath='$JSONPATH' | grep 'Ready=Unknown')\"\n    exit 1\nfi"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Restart Services"}],"description":"","message_list":[],"uuid":"ce36d34b-264d-451e-8c48-dedecfab3d5d","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"b30d62a2-4a8a-48c6-9d0d-e6c3ee8dee5a","value":"v1.8.14","label":"","state":"NOT_VALIDATED","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_VERSION_NEW"}],"main_task_local_reference":{"kind":"app_task","name":"17adda9e_dag","uuid":"66458b52-fd26-4e25-b2f9-14799bbd5147"},"name":"dfce2dff_runbook"}},{"description":"","message_list":[],"uuid":"bfe6e048-4c25-4c65-85b5-c9dd46d4d40d","name":"ScaleOut","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"c109e84a-7bac-452c-92a2-4627ba9e456d","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Out","uuid":"88866b4c-6846-4482-b0e6-1253a167a3de"},{"kind":"app_task","name":"Set Hosts File","uuid":"690492f7-8a10-4c0e-80c2-abaef54f4d0c"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Scale Out","uuid":"88866b4c-6846-4482-b0e6-1253a167a3de"},"edge_type":"user_defined","type":"","uuid":"8df80031-b4db-4d2b-87ea-9c7c93888b81","to_task_reference":{"kind":"app_task","name":"Set Hosts File","uuid":"690492f7-8a10-4c0e-80c2-abaef54f4d0c"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"a0fb1ecf_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"retries":"0","description":"","type":"SCALING","uuid":"88866b4c-6846-4482-b0e6-1253a167a3de","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Scale Out"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"690492f7-8a10-4c0e-80c2-abaef54f4d0c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMINION_IPS=\"@@{AWS_Centos_K8SM.private_ip_address}@@\"\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  if ! (( $(grep -c \"${ip} minion${count}\" \/etc\/hosts) )) ; then\n  \techo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  fi\n  count=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Hosts File"}],"description":"","message_list":[],"uuid":"5382e080-a744-4549-a47e-df5b01c0f8ff","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"fa4b3882-c2b1-4221-9bf8-a50f0e65a56c","value":"1","label":"","state":"NOT_VALIDATED","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"a0fb1ecf_dag","uuid":"c109e84a-7bac-452c-92a2-4627ba9e456d"},"name":"55139b34_runbook"}},{"description":"","message_list":[],"uuid":"d2e6cd45-c6bc-42a2-a450-c5263ec4d5bd","name":"ScaleIn","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"164394ee-9b15-4edb-b0a7-79df3f7b3c17","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale In","uuid":"7eaa902d-3fe0-4bc8-a12a-428e0160386f"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"adfef604_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"retries":"0","description":"","type":"SCALING","uuid":"7eaa902d-3fe0-4bc8-a12a-428e0160386f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Scale In"}],"description":"","message_list":[],"uuid":"6ee7fb3c-91ca-4bdb-abf7-6b6c6819c5b6","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"1aca702d-a358-44c2-ba91-00eabc9eab26","value":"1","label":"","state":"NOT_VALIDATED","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"adfef604_dag","uuid":"164394ee-9b15-4edb-b0a7-79df3f7b3c17"},"name":"65df2c70_runbook"}},{"description":"System action for creating an application","message_list":[],"uuid":"25b06dca-7cf8-4e9a-99a8-4fcb87a69d43","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"AWS","uuid":"8fb0934d-e5f1-467c-8890-2714d6fae8ab"},"retries":"0","description":"","type":"DAG","uuid":"4f02c33b-5001-4bad-bd7f-8935796baf93","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_f5bcb26d_6a13_4eb5_91c5_202d025130f0","uuid":"583c282c-44bf-4e1d-bf26-3a2fad93e63f"},{"kind":"app_task","name":"SYS_GEN__DE_Provision_a49dec52_b184_47d2_b1db_43be87961d75","uuid":"c039d17a-9b82-4cbc-9e15-9176eec09f4a"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"a8bdf84e-1dbb-4c5e-bc4d-22c8f1abb1da"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"a4771ce0-c5a5-4972-9310-c20ace0d980b"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"629e387f-bb0d-4c9f-b640-4c8e3f7558b4"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"ef180aef-80c5-4cd7-9b22-da778b519d60"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"22efedcf-3709-4736-acf4-aa56b8cc17fb"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"b81b300f-08c2-4235-ac34-dd25b751cca7"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"978bd136-d2c6-42e1-902c-2d20fba1e2b9"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"f5d43228-066d-4417-b647-35ff59fe7763"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"22efedcf-3709-4736-acf4-aa56b8cc17fb"},"edge_type":"inherent","type":"","uuid":"d9b60c58-54ff-4496-aa2e-a7f44ac99ea2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"978bd136-d2c6-42e1-902c-2d20fba1e2b9"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"629e387f-bb0d-4c9f-b640-4c8e3f7558b4"},"edge_type":"inherent","type":"","uuid":"e9168c03-19ae-4680-8c0d-0fbd8262ca81","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"22efedcf-3709-4736-acf4-aa56b8cc17fb"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_f5bcb26d_6a13_4eb5_91c5_202d025130f0","uuid":"583c282c-44bf-4e1d-bf26-3a2fad93e63f"},"edge_type":"inherent","type":"","uuid":"67bcd415-f636-4079-943c-f1d1874e8c56","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"a8bdf84e-1dbb-4c5e-bc4d-22c8f1abb1da"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"a8bdf84e-1dbb-4c5e-bc4d-22c8f1abb1da"},"edge_type":"inherent","type":"","uuid":"480aa774-f069-415a-98c5-a6e248bd1cbf","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"629e387f-bb0d-4c9f-b640-4c8e3f7558b4"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"b81b300f-08c2-4235-ac34-dd25b751cca7"},"edge_type":"inherent","type":"","uuid":"687db5ec-e8df-405a-885d-5dbb55764939","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"f5d43228-066d-4417-b647-35ff59fe7763"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"ef180aef-80c5-4cd7-9b22-da778b519d60"},"edge_type":"inherent","type":"","uuid":"b1da433f-d249-4105-8c21-14bfad1d54c8","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"b81b300f-08c2-4235-ac34-dd25b751cca7"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_a49dec52_b184_47d2_b1db_43be87961d75","uuid":"c039d17a-9b82-4cbc-9e15-9176eec09f4a"},"edge_type":"inherent","type":"","uuid":"776b65d9-3c03-4931-8d4e-d084afd393bb","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"a4771ce0-c5a5-4972-9310-c20ace0d980b"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"a4771ce0-c5a5-4972-9310-c20ace0d980b"},"edge_type":"inherent","type":"","uuid":"50ae6174-69bd-47fe-bb9a-552169fdc1eb","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"ef180aef-80c5-4cd7-9b22-da778b519d60"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"a4771ce0-c5a5-4972-9310-c20ace0d980b"},"edge_type":"dependency","type":"","uuid":"eff0ad57-dae4-452b-ba35-f4923de5c22a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"629e387f-bb0d-4c9f-b640-4c8e3f7558b4"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"a8bdf84e-1dbb-4c5e-bc4d-22c8f1abb1da"},"edge_type":"dependency","type":"","uuid":"4be63c5a-0e7e-489f-8da6-f7b911dd4aad","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"ef180aef-80c5-4cd7-9b22-da778b519d60"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_8fb0934d_e5f1_467c_8890_2714d6fae8ab"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"583c282c-44bf-4e1d-bf26-3a2fad93e63f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_f5bcb26d_6a13_4eb5_91c5_202d025130f0"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"c039d17a-9b82-4cbc-9e15-9176eec09f4a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_a49dec52_b184_47d2_b1db_43be87961d75"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a8bdf84e-1dbb-4c5e-bc4d-22c8f1abb1da","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"8483e6d4-c7f2-4892-9db9-bf02f918ed0e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a4771ce0-c5a5-4972-9310-c20ace0d980b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"def6e2c5-b303-4ec8-b188-15372bb95b3c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"629e387f-bb0d-4c9f-b640-4c8e3f7558b4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"585fde78-19e6-48c9-ba86-a4a9e5ac1e92"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ef180aef-80c5-4cd7-9b22-da778b519d60","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"fb9ba7b7-3d51-4c90-9bbc-47181df49fd4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_50dfc849_7772_4832_9398_4cd2048be3e7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"22efedcf-3709-4736-acf4-aa56b8cc17fb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"aa8dd27e-4bd1-4b85-86c6-750c0a49579f"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b81b300f-08c2-4235-ac34-dd25b751cca7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"cabcfd41-35e6-45f0-a791-00daf17de059"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"978bd136-d2c6-42e1-902c-2d20fba1e2b9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"64e5991c-fbcd-4d1f-8b72-4b4956e9702e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f5d43228-066d-4417-b647-35ff59fe7763","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"91f453c1-d2fc-47b1-93d4-4b49476235be"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"31d826de-149b-4a50-963b-fdd6b5cfe352","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_8fb0934d_e5f1_467c_8890_2714d6fae8ab","uuid":"4f02c33b-5001-4bad-bd7f-8935796baf93"},"name":"SYS_GEN__Runbook_Application_8fb0934d_e5f1_467c_8890_2714d6fae8ab"}},{"description":"System action for starting an application","message_list":[],"uuid":"bad66ec7-6edb-401f-8ad4-c6ba43afbec1","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"AWS","uuid":"8fb0934d-e5f1-467c-8890-2714d6fae8ab"},"retries":"0","description":"","type":"DAG","uuid":"dc580de9-099a-4af5-b488-0f441043e01d","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"f6460d3f-5b89-4713-969f-e8dcde3f797e"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"432e006b-cdc0-42d2-90a5-3da107ef9680"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"f96746c2-1c48-4d8b-992d-4c19c4d4f4c9"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"56a17c80-1b6a-4efe-9133-bc5656bd0153"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"432e006b-cdc0-42d2-90a5-3da107ef9680"},"edge_type":"inherent","type":"","uuid":"c5422dd2-8745-4e7c-9615-22aba27cfd1d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"56a17c80-1b6a-4efe-9133-bc5656bd0153"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"f6460d3f-5b89-4713-969f-e8dcde3f797e"},"edge_type":"inherent","type":"","uuid":"d976f29d-8ced-480d-b10a-51d67a6fe375","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"f96746c2-1c48-4d8b-992d-4c19c4d4f4c9"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_8fb0934d_e5f1_467c_8890_2714d6fae8ab"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f6460d3f-5b89-4713-969f-e8dcde3f797e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"57f10355-32b0-465b-98d7-569944a5b82d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"432e006b-cdc0-42d2-90a5-3da107ef9680","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"959c1cfd-ac3c-4780-a3c6-78006fe552d8"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f96746c2-1c48-4d8b-992d-4c19c4d4f4c9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"91f453c1-d2fc-47b1-93d4-4b49476235be"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"56a17c80-1b6a-4efe-9133-bc5656bd0153","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"64e5991c-fbcd-4d1f-8b72-4b4956e9702e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"c8a6f3c9-047d-455a-a0a4-3298dc81a679","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_8fb0934d_e5f1_467c_8890_2714d6fae8ab","uuid":"dc580de9-099a-4af5-b488-0f441043e01d"},"name":"SYS_GEN__Runbook_Application_8fb0934d_e5f1_467c_8890_2714d6fae8ab"}},{"description":"System action for restarting an application","message_list":[],"uuid":"5821ab68-5668-4df2-b459-96bf9e224c3d","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"AWS","uuid":"8fb0934d-e5f1-467c-8890-2714d6fae8ab"},"retries":"0","description":"","type":"DAG","uuid":"10a76d82-acc4-4ec7-9820-42102489fcaa","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"c1a74ba4-091f-4a9c-9592-4fa5b7687cf8"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"aa26e4d5-fb74-45dd-9949-233424cf8b91"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"880b6426-9e5f-477e-bdab-9555533e0e4a"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"cbc85614-19d0-47dd-8900-cf6b96601bac"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"c1a74ba4-091f-4a9c-9592-4fa5b7687cf8"},"edge_type":"inherent","type":"","uuid":"7c279b70-dc1b-491e-a604-2656a54ff8d0","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"880b6426-9e5f-477e-bdab-9555533e0e4a"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"aa26e4d5-fb74-45dd-9949-233424cf8b91"},"edge_type":"inherent","type":"","uuid":"e01eb0dd-e4c4-496d-a6ef-5d2d3494b96e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"cbc85614-19d0-47dd-8900-cf6b96601bac"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_8fb0934d_e5f1_467c_8890_2714d6fae8ab"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c1a74ba4-091f-4a9c-9592-4fa5b7687cf8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"5a293fb1-1872-4c27-8463-927e83b262ab"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"aa26e4d5-fb74-45dd-9949-233424cf8b91","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"b588a0aa-9805-4e09-aba8-895eab6ce1fc"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"880b6426-9e5f-477e-bdab-9555533e0e4a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"526cc0d4-3d9e-49c6-840b-f42e056f5d89"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"cbc85614-19d0-47dd-8900-cf6b96601bac","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"3fd75c09-a79f-4731-98fc-b65b96bc9fe7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"885592ad-cbdf-45e4-9659-25ea035057b6","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_8fb0934d_e5f1_467c_8890_2714d6fae8ab","uuid":"10a76d82-acc4-4ec7-9820-42102489fcaa"},"name":"SYS_GEN__Runbook_Application_8fb0934d_e5f1_467c_8890_2714d6fae8ab"}},{"description":"System action for stopping an application","message_list":[],"uuid":"effa6f59-e786-429c-bbee-ae976fe963ce","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"AWS","uuid":"8fb0934d-e5f1-467c-8890-2714d6fae8ab"},"retries":"0","description":"","type":"DAG","uuid":"b1064fcf-4c62-47c3-a520-966427df5d84","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"34c201b2-908a-45f6-ab96-bd7e1989bb26"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"472035b0-4e2d-4a9a-b284-107d0d676926"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"341ef9ad-2571-4110-b9c8-326f38ca167b"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"67fc2c42-652b-4f22-9c03-41e14c6bfa2b"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"472035b0-4e2d-4a9a-b284-107d0d676926"},"edge_type":"inherent","type":"","uuid":"36500128-66de-4214-a40c-2de2d9774ad4","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"67fc2c42-652b-4f22-9c03-41e14c6bfa2b"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"34c201b2-908a-45f6-ab96-bd7e1989bb26"},"edge_type":"inherent","type":"","uuid":"43e7ca97-1c85-4ba2-a8ff-bd3f89cb4f35","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"341ef9ad-2571-4110-b9c8-326f38ca167b"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_8fb0934d_e5f1_467c_8890_2714d6fae8ab"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"34c201b2-908a-45f6-ab96-bd7e1989bb26","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12105be2-ee67-451d-8054-4546855e277c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"472035b0-4e2d-4a9a-b284-107d0d676926","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"1fdd3541-2eca-471a-a4be-4ef82887d4de"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"341ef9ad-2571-4110-b9c8-326f38ca167b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"40427dd3-54dc-4590-81fe-773009583773"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"67fc2c42-652b-4f22-9c03-41e14c6bfa2b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"18e921b6-2c59-410e-ae6c-b1270ba17b36"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"}],"description":"","message_list":[],"uuid":"ee380a37-92a7-4da7-9c77-6831bf4e6411","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_8fb0934d_e5f1_467c_8890_2714d6fae8ab","uuid":"b1064fcf-4c62-47c3-a520-966427df5d84"},"name":"SYS_GEN__Runbook_Application_8fb0934d_e5f1_467c_8890_2714d6fae8ab"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"6549765b-d322-4f9f-8ac9-5602b5435b6d","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"AWS","uuid":"8fb0934d-e5f1-467c-8890-2714d6fae8ab"},"retries":"0","description":"","type":"DAG","uuid":"d736a057-3bdf-496f-b1a9-e362a9217333","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"6caee485-1852-488d-967c-8074cd1eebce"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"e2b54f14-3922-4f75-8aba-d3722d1b1efc"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"e327560e-db5b-4974-91f0-bb1e71e8b969"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"91f18e96-c19a-438e-87b2-5908585b8d50"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"d967ca71-ceeb-4004-82d0-6e589cc7b9e6"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"c47d951b-27de-4aa7-965f-c157cb027ace"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"22293ce1-26c3-4890-b7cb-ba5c2d431aa8"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"97c78836-b1d4-4d4b-81d0-da4fe4f6c514"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_a49dec52_b184_47d2_b1db_43be87961d75","uuid":"add3b147-e61e-46ec-b06c-aea420cac5d9"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_f5bcb26d_6a13_4eb5_91c5_202d025130f0","uuid":"c9bd25db-92a8-43ab-95d1-31af26158697"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"e2b54f14-3922-4f75-8aba-d3722d1b1efc"},"edge_type":"inherent","type":"","uuid":"60fd4ebe-c2d4-43ce-9d22-620e1500e6bb","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"e327560e-db5b-4974-91f0-bb1e71e8b969"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"e327560e-db5b-4974-91f0-bb1e71e8b969"},"edge_type":"inherent","type":"","uuid":"e2d99597-0022-48f2-a15b-bdbfc2e44d4c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"c47d951b-27de-4aa7-965f-c157cb027ace"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"97c78836-b1d4-4d4b-81d0-da4fe4f6c514"},"edge_type":"inherent","type":"","uuid":"6e6d1fe3-e922-448d-a3e1-cfec5398b62e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_f5bcb26d_6a13_4eb5_91c5_202d025130f0","uuid":"c9bd25db-92a8-43ab-95d1-31af26158697"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"c47d951b-27de-4aa7-965f-c157cb027ace"},"edge_type":"inherent","type":"","uuid":"5e0c90b4-6146-4361-97ea-10e78d9ab5ca","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"97c78836-b1d4-4d4b-81d0-da4fe4f6c514"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"6caee485-1852-488d-967c-8074cd1eebce"},"edge_type":"inherent","type":"","uuid":"7ddafa9e-f1b8-48f1-98a2-45d98c8146ae","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"91f18e96-c19a-438e-87b2-5908585b8d50"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"91f18e96-c19a-438e-87b2-5908585b8d50"},"edge_type":"inherent","type":"","uuid":"9381c785-fb3c-419b-8899-e509f8e11718","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"d967ca71-ceeb-4004-82d0-6e589cc7b9e6"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"d967ca71-ceeb-4004-82d0-6e589cc7b9e6"},"edge_type":"inherent","type":"","uuid":"01be66cc-b1c7-4886-afbb-bc698b72105a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"22293ce1-26c3-4890-b7cb-ba5c2d431aa8"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"22293ce1-26c3-4890-b7cb-ba5c2d431aa8"},"edge_type":"inherent","type":"","uuid":"e4c426fe-f418-4fca-b651-0089d2fd3e94","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_a49dec52_b184_47d2_b1db_43be87961d75","uuid":"add3b147-e61e-46ec-b06c-aea420cac5d9"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"c47d951b-27de-4aa7-965f-c157cb027ace"},"edge_type":"create_action_edge","type":"","uuid":"599aa5ed-f5c4-4021-b4d6-bb082aadb5f5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"22293ce1-26c3-4890-b7cb-ba5c2d431aa8"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"d967ca71-ceeb-4004-82d0-6e589cc7b9e6"},"edge_type":"create_action_edge","type":"","uuid":"b7d9c8a3-5901-42a4-accb-b45208a9ff30","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"97c78836-b1d4-4d4b-81d0-da4fe4f6c514"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"e327560e-db5b-4974-91f0-bb1e71e8b969"},"edge_type":"dependency","type":"","uuid":"748cc2f7-6aa3-4e80-a096-49a54f7ea2fb","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"d967ca71-ceeb-4004-82d0-6e589cc7b9e6"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_8fb0934d_e5f1_467c_8890_2714d6fae8ab"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6caee485-1852-488d-967c-8074cd1eebce","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12105be2-ee67-451d-8054-4546855e277c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e2b54f14-3922-4f75-8aba-d3722d1b1efc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"1fdd3541-2eca-471a-a4be-4ef82887d4de"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e327560e-db5b-4974-91f0-bb1e71e8b969","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"a2ac512f-d272-4905-bafb-4733f7e58c9b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"91f18e96-c19a-438e-87b2-5908585b8d50","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"6b0fd64c-e97f-4968-998d-ff058e95d9e9"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d967ca71-ceeb-4004-82d0-6e589cc7b9e6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"ae954a62-63c8-4a91-8fa4-1cf584c94f3e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_50dfc849_7772_4832_9398_4cd2048be3e7"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c47d951b-27de-4aa7-965f-c157cb027ace","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"db7bd1e1-71d4-4755-8088-596bc82d1960"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"22293ce1-26c3-4890-b7cb-ba5c2d431aa8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"93942b54-fdd6-47fd-9032-05631aa55b79"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"97c78836-b1d4-4d4b-81d0-da4fe4f6c514","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"6265517c-4786-44ff-a8eb-9973562e5492"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"add3b147-e61e-46ec-b06c-aea420cac5d9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_a49dec52_b184_47d2_b1db_43be87961d75"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"c9bd25db-92a8-43ab-95d1-31af26158697","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_f5bcb26d_6a13_4eb5_91c5_202d025130f0"}],"description":"","message_list":[],"uuid":"b4b3523f-2eef-4682-8ee4-10dccae21e1f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_8fb0934d_e5f1_467c_8890_2714d6fae8ab","uuid":"d736a057-3bdf-496f-b1a9-e362a9217333"},"name":"SYS_GEN__Runbook_Application_8fb0934d_e5f1_467c_8890_2714d6fae8ab"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"7d0c2530-ef15-40ed-b716-71ed3febe16d","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"AWS","uuid":"8fb0934d-e5f1-467c-8890-2714d6fae8ab"},"retries":"0","description":"","type":"DAG","uuid":"102d7c2d-0844-48f8-8e85-427dc145e752","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"8b282873-980d-4f39-b152-ffdca04cd2b3"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"f399b581-7d90-444b-9fe1-f44f5844a789"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"e0f97713-0eee-462f-81b4-1a3c05493e8f"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"1288f217-662d-4a10-af1b-36bd862cc254"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"8ed9ed6d-2bc6-444a-823f-2aead3fe3600"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"12f4e8ef-f10a-408b-a77f-998469fcf7c8"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_a49dec52_b184_47d2_b1db_43be87961d75","uuid":"b3bbeb90-7634-4abc-a9c4-85d2daeae49e"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_f5bcb26d_6a13_4eb5_91c5_202d025130f0","uuid":"709f32a2-3b84-4785-8ee1-c1d301ce12d4"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"f399b581-7d90-444b-9fe1-f44f5844a789"},"edge_type":"inherent","type":"","uuid":"4a507e32-5034-4246-aa55-a569fa0846ff","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"e0f97713-0eee-462f-81b4-1a3c05493e8f"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"12f4e8ef-f10a-408b-a77f-998469fcf7c8"},"edge_type":"inherent","type":"","uuid":"dd3ca311-2b18-4a98-85f1-b285e8facd49","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_f5bcb26d_6a13_4eb5_91c5_202d025130f0","uuid":"709f32a2-3b84-4785-8ee1-c1d301ce12d4"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"e0f97713-0eee-462f-81b4-1a3c05493e8f"},"edge_type":"inherent","type":"","uuid":"01365b3c-40a8-49bb-839d-e00df5ac04ce","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"12f4e8ef-f10a-408b-a77f-998469fcf7c8"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"8b282873-980d-4f39-b152-ffdca04cd2b3"},"edge_type":"inherent","type":"","uuid":"bb155f6d-5c41-47a4-aef8-552fa26b4291","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"1288f217-662d-4a10-af1b-36bd862cc254"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"1288f217-662d-4a10-af1b-36bd862cc254"},"edge_type":"inherent","type":"","uuid":"11e2b491-9e4e-4a4d-b061-2f9ba71905dc","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"8ed9ed6d-2bc6-444a-823f-2aead3fe3600"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"8ed9ed6d-2bc6-444a-823f-2aead3fe3600"},"edge_type":"inherent","type":"","uuid":"0f9b7f6f-48af-4906-bb27-4a2faad6cd6a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_a49dec52_b184_47d2_b1db_43be87961d75","uuid":"b3bbeb90-7634-4abc-a9c4-85d2daeae49e"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"e0f97713-0eee-462f-81b4-1a3c05493e8f"},"edge_type":"create_action_edge","type":"","uuid":"46fefd1d-571f-4137-b6ac-6e209f062f12","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"8ed9ed6d-2bc6-444a-823f-2aead3fe3600"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"1288f217-662d-4a10-af1b-36bd862cc254"},"edge_type":"create_action_edge","type":"","uuid":"90aafef6-b07a-41d5-9bb7-f6d261f5ba03","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"12f4e8ef-f10a-408b-a77f-998469fcf7c8"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_8fb0934d_e5f1_467c_8890_2714d6fae8ab"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8b282873-980d-4f39-b152-ffdca04cd2b3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"d44a642f-9468-432a-9b7e-e69a7c1c08e7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f399b581-7d90-444b-9fe1-f44f5844a789","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"50a769a7-5b0a-4546-9e12-4f0a3ceff21b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"e0f97713-0eee-462f-81b4-1a3c05493e8f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_f5299fdf_a772_41d5_9925_c87ddaec8f1f"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"1288f217-662d-4a10-af1b-36bd862cc254","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_50dfc849_7772_4832_9398_4cd2048be3e7"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8ed9ed6d-2bc6-444a-823f-2aead3fe3600","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950","uuid":"f8a5bf98-f18f-44d5-bf70-d5cd0568e9ab"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_a1988180_74c0_4c96_8ef4_78df7d762950"},{"target_any_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"12f4e8ef-f10a-408b-a77f-998469fcf7c8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61","uuid":"69afda04-66da-4e92-a707-33e3d9483d51"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_038d0ef5_037e_4ca6_a9c6_fa4afe0c2b61"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"b3bbeb90-7634-4abc-a9c4-85d2daeae49e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_a49dec52_b184_47d2_b1db_43be87961d75"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"85fa2262_deployment","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"709f32a2-3b84-4785-8ee1-c1d301ce12d4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_f5bcb26d_6a13_4eb5_91c5_202d025130f0"}],"description":"","message_list":[],"uuid":"954e2741-44b7-4d72-b46d-d04561247f8f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_8fb0934d_e5f1_467c_8890_2714d6fae8ab","uuid":"102d7c2d-0844-48f8-8e85-427dc145e752"},"name":"SYS_GEN__Runbook_Application_8fb0934d_e5f1_467c_8890_2714d6fae8ab"}}],"message_list":[],"uuid":"8fb0934d-e5f1-467c-8890-2714d6fae8ab","state":"DRAFT","dependency_list":[{"getter_resource_kind":"PackageCfg","setter_resource_attr":"private_ip_address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"AWS_Centos_K8SM","action_name":"action_create","action_resource_name":"AWS","getter_resource_name":"AWS_Centos_K8SC_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"public_dns_name","setter_resource_kind":"SubstrateCfg","setter_resource_name":"AWS_Centos_K8SM","action_name":"action_create","action_resource_name":"AWS","getter_resource_name":"AWS_Centos_K8SC_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"private_dns_name","setter_resource_kind":"SubstrateCfg","setter_resource_name":"AWS_Centos_K8SM","action_name":"action_create","action_resource_name":"AWS","getter_resource_name":"AWS_Centos_K8SC_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"public_ip_address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"AWS_Centos_K8SM","action_name":"action_create","action_resource_name":"AWS","getter_resource_name":"AWS_Centos_K8SC_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"private_ip_address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"AWS_Centos_K8SC","action_name":"action_create","action_resource_name":"AWS","getter_resource_name":"AWS_Centos_K8SM_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"address","setter_resource_kind":"ServiceCfg","setter_resource_name":"Kubernetes_Master","action_name":"action_delete","action_resource_name":"AWS","getter_resource_name":"AWS_Centos_K8SM_Package","action_resource_kind":"ApplicationCfg"}],"variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"31cc8396-d8fa-47fc-b27c-c4c613939d70","value":"kube-calm-aws1","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_CLUSTER_NAME"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"c1afae35-4f4c-4cfe-aed6-a1f81295308b","value":"v1.8.0","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_VERSION"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"a8daabf3-fc53-4eb5-8942-fc391003738a","value":"17.03.2.ce","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"DOCKER_VERSION"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"d3303548-5cee-4aca-abe8-f33502bf36a6","value":"10.200.0.0\/16","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_CLUSTER_SUBNET"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"966538d4-ce8b-4ce8-817a-4c40419bfb97","value":"10.32.0.0\/24","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_SERVICE_SUBNET"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"ef6cf7dc-8a0e-4ddd-9085-230d2af6e897","value":"10.32.0.10","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_DNS_IP"}],"name":"AWS"},{"deployment_create_list":[{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"f0f7dc14-471e-406a-969a-b55d0d765db0","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"retries":"0","description":"","type":"DAG","uuid":"59a1df4a-cf44-4aff-8cae-5439b4cb54e3","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_e54dd002_50e1_4051_bc5a_c2bb008669ee","uuid":"b46e8f90-be9b-44d7-96af-bcc7b6e310e6"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"d3a88c11-1ed3-4b8e-9695-6726661adb85"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"4ef7c812-58a1-4c3f-95ca-7fef1c69325e"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"1c5fc1ac-b106-45a2-a7df-0cfffa344605"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"68be6631-17ab-4806-a893-31eb8ca20678"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"1c5fc1ac-b106-45a2-a7df-0cfffa344605"},"edge_type":"inherent","type":"","uuid":"0414879e-05bd-4502-ae32-c6fa417c8e8d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"68be6631-17ab-4806-a893-31eb8ca20678"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"4ef7c812-58a1-4c3f-95ca-7fef1c69325e"},"edge_type":"inherent","type":"","uuid":"c15df714-4261-477c-bc4b-8c70194ef9c2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"1c5fc1ac-b106-45a2-a7df-0cfffa344605"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_e54dd002_50e1_4051_bc5a_c2bb008669ee","uuid":"b46e8f90-be9b-44d7-96af-bcc7b6e310e6"},"edge_type":"inherent","type":"","uuid":"e11b5a95-a932-43e8-92e9-1bd43385876c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"d3a88c11-1ed3-4b8e-9695-6726661adb85"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"d3a88c11-1ed3-4b8e-9695-6726661adb85"},"edge_type":"inherent","type":"","uuid":"5e1a6575-ba2a-4752-895a-471b9f93b080","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"4ef7c812-58a1-4c3f-95ca-7fef1c69325e"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_e54dd002_50e1_4051_bc5a_c2bb008669ee"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"b46e8f90-be9b-44d7-96af-bcc7b6e310e6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_e54dd002_50e1_4051_bc5a_c2bb008669ee"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d3a88c11-1ed3-4b8e-9695-6726661adb85","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"cee442f5-479a-4b78-ac00-d34a2169f479"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4ef7c812-58a1-4c3f-95ca-7fef1c69325e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"5549bf8a-88d8-4690-9c7d-36ab75ab6c8b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_dd402e71_0337_4f3e_9693_06781cf08182"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1c5fc1ac-b106-45a2-a7df-0cfffa344605","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"aa8dd27e-4bd1-4b85-86c6-750c0a49579f"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"68be6631-17ab-4806-a893-31eb8ca20678","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"64e5991c-fbcd-4d1f-8b72-4b4956e9702e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"afe588f6-e9ac-44cd-a3bb-f61d8b98f3c0","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_e54dd002_50e1_4051_bc5a_c2bb008669ee","uuid":"59a1df4a-cf44-4aff-8cae-5439b4cb54e3"},"name":"SYS_GEN__Runbook_Deployment_e54dd002_50e1_4051_bc5a_c2bb008669ee"}},{"description":"System action for starting an application","message_list":[],"uuid":"f1b04023-c70a-4031-8c18-4746f8f2aeaf","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"retries":"0","description":"","type":"DAG","uuid":"50fa3b7b-c475-48f7-95b9-8e8ebd332cff","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"c8c74dd9-dc4d-4e8c-b34f-dc336c238d65"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"d85abd2b-d6d7-476a-9b7c-ab44a6d63a94"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"c8c74dd9-dc4d-4e8c-b34f-dc336c238d65"},"edge_type":"inherent","type":"","uuid":"d039e2bf-6c4d-4aa3-9d44-c5b976cc86cf","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"d85abd2b-d6d7-476a-9b7c-ab44a6d63a94"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_e54dd002_50e1_4051_bc5a_c2bb008669ee"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c8c74dd9-dc4d-4e8c-b34f-dc336c238d65","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"3d0c95eb-529e-42af-adbf-b7248e8cd33b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d85abd2b-d6d7-476a-9b7c-ab44a6d63a94","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"64e5991c-fbcd-4d1f-8b72-4b4956e9702e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"4860ae9c-d652-41fe-9271-9879c4e15954","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_e54dd002_50e1_4051_bc5a_c2bb008669ee","uuid":"50fa3b7b-c475-48f7-95b9-8e8ebd332cff"},"name":"SYS_GEN__Runbook_Deployment_e54dd002_50e1_4051_bc5a_c2bb008669ee"}},{"description":"System action for restarting an application","message_list":[],"uuid":"8ae7e9e0-64ef-4ba2-8760-d811fc3ab570","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"retries":"0","description":"","type":"DAG","uuid":"235806aa-ec95-4a52-b422-399fb3eb8cd1","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"9f5b8c9a-fb65-4f4e-a87c-c49f1a8c6ff7"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"566eefd1-342d-4d43-9f5b-df330130105e"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"9f5b8c9a-fb65-4f4e-a87c-c49f1a8c6ff7"},"edge_type":"inherent","type":"","uuid":"add13fd9-a2b0-4f1d-946a-4384bd840e33","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"566eefd1-342d-4d43-9f5b-df330130105e"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_e54dd002_50e1_4051_bc5a_c2bb008669ee"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"9f5b8c9a-fb65-4f4e-a87c-c49f1a8c6ff7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"3f4a46b1-bc49-426d-80ce-ee54ce5fd40a"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"566eefd1-342d-4d43-9f5b-df330130105e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"526cc0d4-3d9e-49c6-840b-f42e056f5d89"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"8e68dbae-2f86-4a81-b3fa-061c1450d1e3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_e54dd002_50e1_4051_bc5a_c2bb008669ee","uuid":"235806aa-ec95-4a52-b422-399fb3eb8cd1"},"name":"SYS_GEN__Runbook_Deployment_e54dd002_50e1_4051_bc5a_c2bb008669ee"}},{"description":"System action for stopping an application","message_list":[],"uuid":"337f6c39-b024-439d-9383-d29263880877","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"retries":"0","description":"","type":"DAG","uuid":"e713c22e-ebc9-4409-aaca-582250ad5832","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"66871676-8ad9-4a35-a876-d7a2a6ea60c6"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"ae1ce4ef-8c8f-4fb9-9b26-7ab88d47c961"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"66871676-8ad9-4a35-a876-d7a2a6ea60c6"},"edge_type":"inherent","type":"","uuid":"1eb13600-52e7-4ffe-a405-bef1dadbc9f0","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"ae1ce4ef-8c8f-4fb9-9b26-7ab88d47c961"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_e54dd002_50e1_4051_bc5a_c2bb008669ee"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"66871676-8ad9-4a35-a876-d7a2a6ea60c6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"1fdd3541-2eca-471a-a4be-4ef82887d4de"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ae1ce4ef-8c8f-4fb9-9b26-7ab88d47c961","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"6236dfbc-4e3e-4f48-8c7e-bc77d5eb300d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3"}],"description":"","message_list":[],"uuid":"6c240d9d-ef1b-4572-973d-8cfcfa4777bc","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_e54dd002_50e1_4051_bc5a_c2bb008669ee","uuid":"e713c22e-ebc9-4409-aaca-582250ad5832"},"name":"SYS_GEN__Runbook_Deployment_e54dd002_50e1_4051_bc5a_c2bb008669ee"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"7d09c31b-a3bb-43ee-ba07-dc2552ff672d","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"retries":"0","description":"","type":"DAG","uuid":"8170be26-0471-4dfa-a1e0-00bb55a20d96","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"eccab9bc-f811-469e-b809-b0fa507fe42a"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"444bb877-b9a2-45fd-8051-3a44179cb7a2"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"3d7f62c1-74c7-43cf-bbc7-99519960fff2"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"237e95c4-6127-405d-a369-e2ed433db8ea"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_e54dd002_50e1_4051_bc5a_c2bb008669ee","uuid":"2ad58511-d823-4914-a026-1b4fa781f05d"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"eccab9bc-f811-469e-b809-b0fa507fe42a"},"edge_type":"inherent","type":"","uuid":"cfcb1f65-3e4e-45bb-8da5-b059c916aec7","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"444bb877-b9a2-45fd-8051-3a44179cb7a2"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"444bb877-b9a2-45fd-8051-3a44179cb7a2"},"edge_type":"inherent","type":"","uuid":"83b2d76f-16f2-46ef-8fa8-54b8dcc72864","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"3d7f62c1-74c7-43cf-bbc7-99519960fff2"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"237e95c4-6127-405d-a369-e2ed433db8ea"},"edge_type":"inherent","type":"","uuid":"826088b1-4cb7-4c7f-9d1e-becaa9c611f6","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_e54dd002_50e1_4051_bc5a_c2bb008669ee","uuid":"2ad58511-d823-4914-a026-1b4fa781f05d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"3d7f62c1-74c7-43cf-bbc7-99519960fff2"},"edge_type":"inherent","type":"","uuid":"e535401a-49a8-476e-ac40-cd3a7769af38","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"237e95c4-6127-405d-a369-e2ed433db8ea"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_e54dd002_50e1_4051_bc5a_c2bb008669ee"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"eccab9bc-f811-469e-b809-b0fa507fe42a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"1fdd3541-2eca-471a-a4be-4ef82887d4de"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"444bb877-b9a2-45fd-8051-3a44179cb7a2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"a2ac512f-d272-4905-bafb-4733f7e58c9b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3d7f62c1-74c7-43cf-bbc7-99519960fff2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"6173244d-f073-4e90-a370-9f2c307d4036"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_dd402e71_0337_4f3e_9693_06781cf08182"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"237e95c4-6127-405d-a369-e2ed433db8ea","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"8b6d072e-7e87-4c04-a89f-88296a863ed8"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"2ad58511-d823-4914-a026-1b4fa781f05d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_e54dd002_50e1_4051_bc5a_c2bb008669ee"}],"description":"","message_list":[],"uuid":"b014f58e-3d62-4b98-866d-50345ffff357","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_e54dd002_50e1_4051_bc5a_c2bb008669ee","uuid":"8170be26-0471-4dfa-a1e0-00bb55a20d96"},"name":"SYS_GEN__Runbook_Deployment_e54dd002_50e1_4051_bc5a_c2bb008669ee"}},{"description":"System action for scaleout","message_list":[],"uuid":"cfc0f6b8-7ae1-4314-8af7-0bbb4cb62826","name":"action_scaleout","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"retries":"0","description":"","type":"DAG","uuid":"2cbbb656-b7c7-46e1-a104-e3600124ad62","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scaleout_e54dd002_50e1_4051_bc5a_c2bb008669ee","uuid":"39f2bcef-853c-4793-82f0-ed28851383e2"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_e54dd002_50e1_4051_bc5a_c2bb008669ee"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"retries":"0","description":"","type":"SCALING","uuid":"39f2bcef-853c-4793-82f0-ed28851383e2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scaleout_e54dd002_50e1_4051_bc5a_c2bb008669ee"}],"description":"","message_list":[],"uuid":"66179e18-4fcd-4e78-9440-d316e5f02738","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"a6178625-17e4-41ff-a278-09f5cbc0b913","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_e54dd002_50e1_4051_bc5a_c2bb008669ee","uuid":"2cbbb656-b7c7-46e1-a104-e3600124ad62"},"name":"SYS_GEN__Runbook_Deployment_e54dd002_50e1_4051_bc5a_c2bb008669ee"}},{"description":"System action for scalein","message_list":[],"uuid":"ed202fae-4b3b-414d-a2ef-dc6d9364afe5","name":"action_scalein","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"retries":"0","description":"","type":"DAG","uuid":"71509f5d-82ee-4815-bc05-54f671c85a79","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scalein_e54dd002_50e1_4051_bc5a_c2bb008669ee","uuid":"eca7f422-3a26-4eb2-abb1-cd048e962888"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_e54dd002_50e1_4051_bc5a_c2bb008669ee"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"retries":"0","description":"","type":"SCALING","uuid":"eca7f422-3a26-4eb2-abb1-cd048e962888","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scalein_e54dd002_50e1_4051_bc5a_c2bb008669ee"}],"description":"","message_list":[],"uuid":"beaedafa-06e4-4db1-9a87-9b3b704b404e","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"d3452eb3-57a7-42a8-96a5-11fb9411d67c","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_e54dd002_50e1_4051_bc5a_c2bb008669ee","uuid":"71509f5d-82ee-4815-bc05-54f671c85a79"},"name":"SYS_GEN__Runbook_Deployment_e54dd002_50e1_4051_bc5a_c2bb008669ee"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"0e7ae21d-baf1-4a49-8c42-e1700e0e31e8","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"retries":"0","description":"","type":"DAG","uuid":"9d3d77cc-8881-428b-8aba-8408bbb2331a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"d15d9e21-b11c-4b55-8304-ea540bec16b6"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"155ab02f-3e79-4997-ba89-688b72946254"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"21b103f0-5afe-4ae2-b2b8-017446ef0786"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_e54dd002_50e1_4051_bc5a_c2bb008669ee","uuid":"a2f0f525-5936-4acb-a4e9-3ccf51c64f98"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"d15d9e21-b11c-4b55-8304-ea540bec16b6"},"edge_type":"inherent","type":"","uuid":"344001e0-7602-44ec-8a0c-df3b8a78b860","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"155ab02f-3e79-4997-ba89-688b72946254"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"21b103f0-5afe-4ae2-b2b8-017446ef0786"},"edge_type":"inherent","type":"","uuid":"18ff00c0-6296-4d73-979e-9d8a099956b3","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_e54dd002_50e1_4051_bc5a_c2bb008669ee","uuid":"a2f0f525-5936-4acb-a4e9-3ccf51c64f98"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"155ab02f-3e79-4997-ba89-688b72946254"},"edge_type":"inherent","type":"","uuid":"6583db66-915f-4353-bb2e-93a34a67c6cb","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"21b103f0-5afe-4ae2-b2b8-017446ef0786"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_e54dd002_50e1_4051_bc5a_c2bb008669ee"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d15d9e21-b11c-4b55-8304-ea540bec16b6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"50a769a7-5b0a-4546-9e12-4f0a3ceff21b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"155ab02f-3e79-4997-ba89-688b72946254","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_dd402e71_0337_4f3e_9693_06781cf08182"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"21b103f0-5afe-4ae2-b2b8-017446ef0786","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"212033aa-f4d3-4ba4-82a1-a2629db48907"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"a2f0f525-5936-4acb-a4e9-3ccf51c64f98","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_e54dd002_50e1_4051_bc5a_c2bb008669ee"}],"description":"","message_list":[],"uuid":"9124283f-db65-478a-b105-1071f716fdd6","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_e54dd002_50e1_4051_bc5a_c2bb008669ee","uuid":"9d3d77cc-8881-428b-8aba-8408bbb2331a"},"name":"SYS_GEN__Runbook_Deployment_e54dd002_50e1_4051_bc5a_c2bb008669ee"}}],"message_list":[],"published_service_local_reference_list":[],"uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee","min_replicas":"3","state":"DRAFT","max_replicas":"3","depends_on_list":[],"editables":{"min_replicas":true,"max_replicas":true},"package_local_reference_list":[{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"}],"substrate_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"type":"GREENFIELD","options":{},"variable_list":[],"name":"34875daf_deployment"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"7b19d289-aeca-4dff-9eb4-34cf1de1bd47","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"retries":"0","description":"","type":"DAG","uuid":"f0277989-a1d3-43e7-83e0-9d1b790d2c22","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_3df01c9c_b48a_44c9_8500_a5d135ae0841","uuid":"792d7ad1-973c-4c7d-907d-d5ced7702040"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"d6d7bbf0-fde3-4144-be42-96b9ace0e2f6"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"0a5617a0-53cd-4d4a-a460-e58093366967"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"60426f83-64de-4af0-999d-02336e48d2c1"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"7da13c20-c7fb-49e2-be72-c4f5ecf8485f"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"60426f83-64de-4af0-999d-02336e48d2c1"},"edge_type":"inherent","type":"","uuid":"2d057d32-539d-4124-a919-09a2ccce707c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"7da13c20-c7fb-49e2-be72-c4f5ecf8485f"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"0a5617a0-53cd-4d4a-a460-e58093366967"},"edge_type":"inherent","type":"","uuid":"712ff474-defd-400a-8f2c-1686ef5a8c7f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"60426f83-64de-4af0-999d-02336e48d2c1"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_3df01c9c_b48a_44c9_8500_a5d135ae0841","uuid":"792d7ad1-973c-4c7d-907d-d5ced7702040"},"edge_type":"inherent","type":"","uuid":"604724a1-bef2-4dfb-b47e-cdecde8462aa","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"d6d7bbf0-fde3-4144-be42-96b9ace0e2f6"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"d6d7bbf0-fde3-4144-be42-96b9ace0e2f6"},"edge_type":"inherent","type":"","uuid":"5bec6c07-14f6-461b-b4b2-0fce8e473321","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"0a5617a0-53cd-4d4a-a460-e58093366967"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_3df01c9c_b48a_44c9_8500_a5d135ae0841"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"792d7ad1-973c-4c7d-907d-d5ced7702040","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_3df01c9c_b48a_44c9_8500_a5d135ae0841"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d6d7bbf0-fde3-4144-be42-96b9ace0e2f6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"0d56375e-2923-437e-bf82-3fcadfe99d53"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0a5617a0-53cd-4d4a-a460-e58093366967","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"54801dfd-81bb-487c-ae84-55bc739ded6a"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"60426f83-64de-4af0-999d-02336e48d2c1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"cabcfd41-35e6-45f0-a791-00daf17de059"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"7da13c20-c7fb-49e2-be72-c4f5ecf8485f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"91f453c1-d2fc-47b1-93d4-4b49476235be"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"8fa53a75-1be4-4f00-b08d-ac2024ec09fa","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_3df01c9c_b48a_44c9_8500_a5d135ae0841","uuid":"f0277989-a1d3-43e7-83e0-9d1b790d2c22"},"name":"SYS_GEN__Runbook_Deployment_3df01c9c_b48a_44c9_8500_a5d135ae0841"}},{"description":"System action for starting an application","message_list":[],"uuid":"69c9ca6e-f648-4c7e-abfc-2aa11f221889","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"retries":"0","description":"","type":"DAG","uuid":"8f439333-e6fe-494b-88e1-cecc2838c84d","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"34315ad3-acf4-4f01-9a81-395f1b5de4a6"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"c5d29432-e847-49c4-bfc1-ed418f73536b"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"34315ad3-acf4-4f01-9a81-395f1b5de4a6"},"edge_type":"inherent","type":"","uuid":"3401ca6e-54d5-40bc-84d4-4ca577ed74bf","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"c5d29432-e847-49c4-bfc1-ed418f73536b"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_3df01c9c_b48a_44c9_8500_a5d135ae0841"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"34315ad3-acf4-4f01-9a81-395f1b5de4a6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"d21339ff-d200-48c4-af20-6a0d4d22d471"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c5d29432-e847-49c4-bfc1-ed418f73536b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"91f453c1-d2fc-47b1-93d4-4b49476235be"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"bb539f46-cf07-4295-9d4e-8ffb0b94bc51","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_3df01c9c_b48a_44c9_8500_a5d135ae0841","uuid":"8f439333-e6fe-494b-88e1-cecc2838c84d"},"name":"SYS_GEN__Runbook_Deployment_3df01c9c_b48a_44c9_8500_a5d135ae0841"}},{"description":"System action for restarting an application","message_list":[],"uuid":"d21cd75a-47c0-47ed-bbb2-8f1f441139f6","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"retries":"0","description":"","type":"DAG","uuid":"d72fb646-79d5-4ebe-b553-348e9a03f922","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"f5a7f32f-1daa-4a3e-8f31-2f0b02018f4e"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"9094ca7c-d93f-4e1b-b636-f631675c384e"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"f5a7f32f-1daa-4a3e-8f31-2f0b02018f4e"},"edge_type":"inherent","type":"","uuid":"6db9cfaf-072d-4b35-af37-8ba857ca894c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"9094ca7c-d93f-4e1b-b636-f631675c384e"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_3df01c9c_b48a_44c9_8500_a5d135ae0841"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f5a7f32f-1daa-4a3e-8f31-2f0b02018f4e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"791cffbe-7c39-4058-b17a-4a6f9687217d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"9094ca7c-d93f-4e1b-b636-f631675c384e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"3fd75c09-a79f-4731-98fc-b65b96bc9fe7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"21b37fa3-74dd-4ce0-9b2b-b3849d42e96d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_3df01c9c_b48a_44c9_8500_a5d135ae0841","uuid":"d72fb646-79d5-4ebe-b553-348e9a03f922"},"name":"SYS_GEN__Runbook_Deployment_3df01c9c_b48a_44c9_8500_a5d135ae0841"}},{"description":"System action for stopping an application","message_list":[],"uuid":"68e227c3-ba03-4af0-8211-7a52802c0cc2","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"retries":"0","description":"","type":"DAG","uuid":"486a2d54-7e4e-4386-b532-a7ad03373f92","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"b8bb6fab-30b3-4a5c-8a86-44a58277d573"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"53723f84-3d25-4b2e-8cbd-c7437bfdb69e"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"b8bb6fab-30b3-4a5c-8a86-44a58277d573"},"edge_type":"inherent","type":"","uuid":"7514a3df-e88d-459e-94a2-e9ec3adb0088","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"53723f84-3d25-4b2e-8cbd-c7437bfdb69e"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_3df01c9c_b48a_44c9_8500_a5d135ae0841"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b8bb6fab-30b3-4a5c-8a86-44a58277d573","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12105be2-ee67-451d-8054-4546855e277c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"53723f84-3d25-4b2e-8cbd-c7437bfdb69e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"0769bd6e-10a3-4790-8366-90653ae53f9e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516"}],"description":"","message_list":[],"uuid":"01263d92-f910-48a4-b225-64c7215e75ac","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_3df01c9c_b48a_44c9_8500_a5d135ae0841","uuid":"486a2d54-7e4e-4386-b532-a7ad03373f92"},"name":"SYS_GEN__Runbook_Deployment_3df01c9c_b48a_44c9_8500_a5d135ae0841"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"9846479b-676f-4991-8898-0bc4e1314ccb","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"retries":"0","description":"","type":"DAG","uuid":"cfe160b4-ff40-43a3-90f7-75ca6b6463ba","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"60fe50ea-2109-4e5b-ae6a-64fb9763c93c"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"d87be044-3a38-4b44-9ef1-08d11bcfcf56"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"4c95f9ba-2f19-4b8f-aed1-75eb4629a908"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"81c735e0-b6ce-4592-b86e-89edcf820d73"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_3df01c9c_b48a_44c9_8500_a5d135ae0841","uuid":"93f7f69e-31a6-4dfc-a1e8-50983bc6a39d"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"60fe50ea-2109-4e5b-ae6a-64fb9763c93c"},"edge_type":"inherent","type":"","uuid":"ab188930-b390-4569-9dd9-360074596af4","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"d87be044-3a38-4b44-9ef1-08d11bcfcf56"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"d87be044-3a38-4b44-9ef1-08d11bcfcf56"},"edge_type":"inherent","type":"","uuid":"41974d45-2ef3-4bc9-bffb-65d6eb2f69de","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"4c95f9ba-2f19-4b8f-aed1-75eb4629a908"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"81c735e0-b6ce-4592-b86e-89edcf820d73"},"edge_type":"inherent","type":"","uuid":"419c409c-951e-4a6f-9b62-e06dda2d5cf1","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_3df01c9c_b48a_44c9_8500_a5d135ae0841","uuid":"93f7f69e-31a6-4dfc-a1e8-50983bc6a39d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"4c95f9ba-2f19-4b8f-aed1-75eb4629a908"},"edge_type":"inherent","type":"","uuid":"8115a55b-8c28-4eb3-b007-ac5b749c951a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"81c735e0-b6ce-4592-b86e-89edcf820d73"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_3df01c9c_b48a_44c9_8500_a5d135ae0841"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"60fe50ea-2109-4e5b-ae6a-64fb9763c93c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12105be2-ee67-451d-8054-4546855e277c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d87be044-3a38-4b44-9ef1-08d11bcfcf56","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"6b0fd64c-e97f-4968-998d-ff058e95d9e9"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4c95f9ba-2f19-4b8f-aed1-75eb4629a908","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"6158fa37-c9a9-4d57-890b-2f587cc5c20d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"81c735e0-b6ce-4592-b86e-89edcf820d73","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"f13ba8c1-6ea6-4b3f-a059-2f2a9732b44c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"93f7f69e-31a6-4dfc-a1e8-50983bc6a39d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_3df01c9c_b48a_44c9_8500_a5d135ae0841"}],"description":"","message_list":[],"uuid":"c8a3e250-85cb-4ab9-b289-3beac2fa9744","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_3df01c9c_b48a_44c9_8500_a5d135ae0841","uuid":"cfe160b4-ff40-43a3-90f7-75ca6b6463ba"},"name":"SYS_GEN__Runbook_Deployment_3df01c9c_b48a_44c9_8500_a5d135ae0841"}},{"description":"System action for scaleout","message_list":[],"uuid":"f9a24cc1-dfc7-4fd5-b0bc-d546ecd8895e","name":"action_scaleout","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"retries":"0","description":"","type":"DAG","uuid":"de397bfe-80b3-4d55-a6cf-bc2786b0b76a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scaleout_3df01c9c_b48a_44c9_8500_a5d135ae0841","uuid":"701b8c65-44cf-4a1c-bc36-3791a9041166"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_3df01c9c_b48a_44c9_8500_a5d135ae0841"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"retries":"0","description":"","type":"SCALING","uuid":"701b8c65-44cf-4a1c-bc36-3791a9041166","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scaleout_3df01c9c_b48a_44c9_8500_a5d135ae0841"}],"description":"","message_list":[],"uuid":"d7e30e96-5444-4c96-9d88-7fcfec07dcc8","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"1c9f68f5-e896-4ef8-b638-e3805af88332","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_3df01c9c_b48a_44c9_8500_a5d135ae0841","uuid":"de397bfe-80b3-4d55-a6cf-bc2786b0b76a"},"name":"SYS_GEN__Runbook_Deployment_3df01c9c_b48a_44c9_8500_a5d135ae0841"}},{"description":"System action for scalein","message_list":[],"uuid":"902a2e28-3fe7-4ab3-9570-626f8b1c2046","name":"action_scalein","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"retries":"0","description":"","type":"DAG","uuid":"622553b2-5008-474b-8362-b6c9f52a5874","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scalein_3df01c9c_b48a_44c9_8500_a5d135ae0841","uuid":"114f7748-4595-44dd-b71b-73b4dc106b5c"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_3df01c9c_b48a_44c9_8500_a5d135ae0841"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"retries":"0","description":"","type":"SCALING","uuid":"114f7748-4595-44dd-b71b-73b4dc106b5c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scalein_3df01c9c_b48a_44c9_8500_a5d135ae0841"}],"description":"","message_list":[],"uuid":"9eb34057-4897-4bc1-b1a7-35f898aab68f","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"61441aa2-8217-47bb-b02c-ec00b03caaab","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_3df01c9c_b48a_44c9_8500_a5d135ae0841","uuid":"622553b2-5008-474b-8362-b6c9f52a5874"},"name":"SYS_GEN__Runbook_Deployment_3df01c9c_b48a_44c9_8500_a5d135ae0841"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"69c7920c-29da-45ce-861f-6fa4ad522d8e","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"retries":"0","description":"","type":"DAG","uuid":"abfbe88b-90bf-4798-8946-2cc6188ac377","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"c4ffdced-3a03-4398-af54-27d51029f0d2"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"cee9cc8d-0c37-436a-96e9-6f3c67364e2c"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"556b9334-93ce-4d9d-a966-2b7245754dfd"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_3df01c9c_b48a_44c9_8500_a5d135ae0841","uuid":"323ab832-f796-4e63-b23f-74208198ca22"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"c4ffdced-3a03-4398-af54-27d51029f0d2"},"edge_type":"inherent","type":"","uuid":"fada227a-55b2-40cb-9341-378b8823078b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"cee9cc8d-0c37-436a-96e9-6f3c67364e2c"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"556b9334-93ce-4d9d-a966-2b7245754dfd"},"edge_type":"inherent","type":"","uuid":"0655ed57-eeb9-432f-a1e8-a9e5d19b8e8b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_3df01c9c_b48a_44c9_8500_a5d135ae0841","uuid":"323ab832-f796-4e63-b23f-74208198ca22"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"cee9cc8d-0c37-436a-96e9-6f3c67364e2c"},"edge_type":"inherent","type":"","uuid":"a0f5a9e7-5c46-4f7c-bc9f-01dc9fcbd502","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"556b9334-93ce-4d9d-a966-2b7245754dfd"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_3df01c9c_b48a_44c9_8500_a5d135ae0841"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c4ffdced-3a03-4398-af54-27d51029f0d2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"d44a642f-9468-432a-9b7e-e69a7c1c08e7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"cee9cc8d-0c37-436a-96e9-6f3c67364e2c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"556b9334-93ce-4d9d-a966-2b7245754dfd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"7e0d47ae-0f98-417b-954e-569e55bf9333"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"323ab832-f796-4e63-b23f-74208198ca22","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_3df01c9c_b48a_44c9_8500_a5d135ae0841"}],"description":"","message_list":[],"uuid":"0b07ef70-e554-4637-a4c5-0c88c6f436e4","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_3df01c9c_b48a_44c9_8500_a5d135ae0841","uuid":"abfbe88b-90bf-4798-8946-2cc6188ac377"},"name":"SYS_GEN__Runbook_Deployment_3df01c9c_b48a_44c9_8500_a5d135ae0841"}}],"message_list":[],"published_service_local_reference_list":[],"uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841","min_replicas":"3","state":"DRAFT","max_replicas":"9","depends_on_list":[],"editables":{"min_replicas":true,"max_replicas":true},"package_local_reference_list":[{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"}],"substrate_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"type":"GREENFIELD","options":{},"variable_list":[],"name":"77b729d5_deployment"}],"description":"","action_list":[{"description":"","message_list":[],"uuid":"7c12b2e8-751f-41e0-8ad5-32ca663403d1","name":"Upgrade","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"7cf46877-1eb7-4b27-b8f0-23398fa8a16f","child_tasks_local_reference_list":[{"kind":"app_task","name":"Upgrade Minion","uuid":"567f9e1a-e77f-4429-ad42-13f6db4494d7"},{"kind":"app_task","name":"Upgrade Controller","uuid":"50aa5efe-dc3c-4a8c-a2bc-5f2d3e5b7b37"},{"kind":"app_task","name":"Set Version Minion","uuid":"e74c2aae-b926-4345-a7b4-8ab170f553cd"},{"kind":"app_task","name":"Restart Services","uuid":"43da19be-f327-4895-bbb9-9610ee99fa79"},{"kind":"app_task","name":"Set Version Master","uuid":"c2545cf1-89c0-4be1-b73e-84b6d100f608"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Upgrade Controller","uuid":"50aa5efe-dc3c-4a8c-a2bc-5f2d3e5b7b37"},"edge_type":"user_defined","type":"","uuid":"e4c20a6c-3eaa-426e-ab33-0a966d59447a","to_task_reference":{"kind":"app_task","name":"Restart Services","uuid":"43da19be-f327-4895-bbb9-9610ee99fa79"}},{"from_task_reference":{"kind":"app_task","name":"Restart Services","uuid":"43da19be-f327-4895-bbb9-9610ee99fa79"},"edge_type":"user_defined","type":"","uuid":"2ce04844-8cec-450f-a3ae-74cbb88cae31","to_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"c2545cf1-89c0-4be1-b73e-84b6d100f608"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"567f9e1a-e77f-4429-ad42-13f6db4494d7"},"edge_type":"user_defined","type":"","uuid":"6a0e5eef-d895-4d78-b98b-5c80bfdf0e6c","to_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"e74c2aae-b926-4345-a7b4-8ab170f553cd"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"e74c2aae-b926-4345-a7b4-8ab170f553cd"},"edge_type":"user_defined","type":"","uuid":"8c15a398-4a19-4827-b3ed-436225a523fe","to_task_reference":{"kind":"app_task","name":"Restart Services","uuid":"43da19be-f327-4895-bbb9-9610ee99fa79"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"cbdb4fa8_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"567f9e1a-e77f-4429-ad42-13f6db4494d7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{KUBE_VERSION_NEW}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=gce \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Upgrade Minion"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"50aa5efe-dc3c-4a8c-a2bc-5f2d3e5b7b37","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{KUBE_VERSION_NEW}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nCONTROLLER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --cloud-provider=gce \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --cloud-provider=gce\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem  \n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --cloud-provider=gce\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Upgrade Controller"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"e74c2aae-b926-4345-a7b4-8ab170f553cd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"if \"@@{calm_array_index}@@\" == \"0\":\n\tprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Version Minion"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"43da19be-f327-4895-bbb9-9610ee99fa79","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_NAMES=\"@@{calm_array_name}@@\" \nMINION_NAMES=\"@@{GCP_Centos_K8SM.name}@@\" \nJSONPATH='{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}'\nKUBE_VERSION_NEW=\"@@{KUBE_VERSION_NEW}@@\"\nMASTER_API_HTTPS=6443\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION_NEW}\/bin\/linux\/amd64\/kubectl\nchmod +x kubectl\nsudo mv kubectl \/usr\/local\/bin\/kubectl\n\ncount=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n  echo \"Trying to reach master server https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} : sleep for 5 secs\"\n  sleep 10\n  if [[ $count -eq 10 ]]; then\n  \techo \"Unable to reach master server: https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\"\n  \texit 1\n  fi\n  count=$((count+1))\ndone\n\ncount=0\nfor name in $(echo \"${MINION_NAMES}\" | tr \",\" \"\\n\"); do\n  #kubectl drain ${name} --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no \"minion${count}\" \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 20\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=${name} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon ${name}\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n\techo \"Upgrade failed on minion nodes\"\n    exit 1\nfi\n\ncount=0\nfor name in $(echo \"${CONTROLLER_NAMES}\" | tr \",\" \"\\n\"); do\n  #kubectl drain $name --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no \"controller${count}\" \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 20\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=$name -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon $name\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n\techo \"Upgrade failed on nodes: $(kubectl get nodes -o jsonpath='$JSONPATH' | grep 'Ready=Unknown')\"\n    exit 1\nfi"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Restart Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"c2545cf1-89c0-4be1-b73e-84b6d100f608","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"if \"@@{calm_array_index}@@\" == \"0\":\n\tprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Version Master"}],"description":"","message_list":[],"uuid":"fad723fe-ae8d-41b4-8a64-5324f43d2e04","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"629eef81-ddda-4938-a430-ee1d189c1f99","value":"v1.8.14","label":"","state":"NOT_VALIDATED","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_VERSION_NEW"}],"main_task_local_reference":{"kind":"app_task","name":"cbdb4fa8_dag","uuid":"7cf46877-1eb7-4b27-b8f0-23398fa8a16f"},"name":"8d003d32_runbook"}},{"description":"","message_list":[],"uuid":"15583554-ea8e-45a3-b6e0-4f3e865c5fcf","name":"ScaleOut","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"b70bf1f8-aba2-4128-afe8-47858b7c9a47","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Out","uuid":"b7363f5b-94d9-4b54-849d-e1b62ce3dff8"},{"kind":"app_task","name":"Set Hosts File","uuid":"c14e293d-fd44-4879-b532-76e962c23c27"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Scale Out","uuid":"b7363f5b-94d9-4b54-849d-e1b62ce3dff8"},"edge_type":"user_defined","type":"","uuid":"00a49bcf-cd48-4e94-9def-127b66cc2757","to_task_reference":{"kind":"app_task","name":"Set Hosts File","uuid":"c14e293d-fd44-4879-b532-76e962c23c27"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"f3682593_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"retries":"0","description":"","type":"SCALING","uuid":"b7363f5b-94d9-4b54-849d-e1b62ce3dff8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Scale Out"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"c14e293d-fd44-4879-b532-76e962c23c27","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMINION_IPS=\"@@{GCP_Centos_K8SM.private_ip_address}@@\"\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  if ! (( $(grep -c \"${ip} minion${count}\" \/etc\/hosts) )) ; then\n  \techo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  fi\n  count=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Hosts File"}],"description":"","message_list":[],"uuid":"da0374ec-4819-4bac-8cf5-3b0b7d5607f2","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"bc65a077-eb02-462e-82d8-e68278fbdf05","value":"1","label":"","state":"NOT_VALIDATED","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"f3682593_dag","uuid":"b70bf1f8-aba2-4128-afe8-47858b7c9a47"},"name":"744583cd_runbook"}},{"description":"","message_list":[],"uuid":"7ebe37ac-bcb3-447a-a8d3-6b6cdd74335e","name":"ScaleIn","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"e5b282e1-d845-4219-ba56-760e863aa1ac","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale In","uuid":"07289a2e-2f49-4957-ab24-2ab67234edc5"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"853cb860_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"retries":"0","description":"","type":"SCALING","uuid":"07289a2e-2f49-4957-ab24-2ab67234edc5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Scale In"}],"description":"","message_list":[],"uuid":"5013737f-1fdf-4f75-bccb-4dcb1d60a4af","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"067777e1-117e-487d-a4da-4b8ef05bad44","value":"1","label":"","state":"NOT_VALIDATED","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"853cb860_dag","uuid":"e5b282e1-d845-4219-ba56-760e863aa1ac"},"name":"9331a25f_runbook"}},{"description":"System action for creating an application","message_list":[],"uuid":"9a5fd594-a827-42ad-b837-d9a466ce99bc","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"GCP","uuid":"1c0be862-70e3-4e5b-af51-c82cc7f6b22c"},"retries":"0","description":"","type":"DAG","uuid":"4e8f7a3d-01b8-4894-96ce-b183202cc7a5","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_e54dd002_50e1_4051_bc5a_c2bb008669ee","uuid":"9a4951f4-f10a-44c2-ae99-14758a79f8d5"},{"kind":"app_task","name":"SYS_GEN__DE_Provision_3df01c9c_b48a_44c9_8500_a5d135ae0841","uuid":"fc2cac49-0219-44e2-b70a-b37682ba87c2"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"0e4b0643-e61a-4ddf-849a-409efb790a2a"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"938aad82-8fce-40ce-aa31-5898c9687ecd"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"093d93a1-bfcb-4c9c-93ea-56a3e7c01b0c"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"28a64cb5-54bd-4eb2-93c6-b9ae14830ce7"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"d718ba4e-2d02-417c-a5b6-b3dc0f07ff3a"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"383ac66c-a5a2-44fd-b87d-b261b856f92f"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"6352f373-6043-493f-9f1d-e3379fbd54ee"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"d6d247a1-48b0-4e6b-9b8b-e2af06b56a5a"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"d718ba4e-2d02-417c-a5b6-b3dc0f07ff3a"},"edge_type":"inherent","type":"","uuid":"716fcf4f-80e6-40e1-90a0-fca74dca3463","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"6352f373-6043-493f-9f1d-e3379fbd54ee"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"28a64cb5-54bd-4eb2-93c6-b9ae14830ce7"},"edge_type":"inherent","type":"","uuid":"9bb60ddc-3d25-4e53-8c5b-376f8d1c18b0","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"d718ba4e-2d02-417c-a5b6-b3dc0f07ff3a"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_e54dd002_50e1_4051_bc5a_c2bb008669ee","uuid":"9a4951f4-f10a-44c2-ae99-14758a79f8d5"},"edge_type":"inherent","type":"","uuid":"4bd57ea4-cf72-4fc8-bda1-3676ac9ae321","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"0e4b0643-e61a-4ddf-849a-409efb790a2a"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"0e4b0643-e61a-4ddf-849a-409efb790a2a"},"edge_type":"inherent","type":"","uuid":"6e1d2e97-f3b2-4aa8-8f88-fff80f0f595d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"28a64cb5-54bd-4eb2-93c6-b9ae14830ce7"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"383ac66c-a5a2-44fd-b87d-b261b856f92f"},"edge_type":"inherent","type":"","uuid":"c47aedd7-4c27-4dcb-9562-7c04ab94f6af","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"d6d247a1-48b0-4e6b-9b8b-e2af06b56a5a"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"093d93a1-bfcb-4c9c-93ea-56a3e7c01b0c"},"edge_type":"inherent","type":"","uuid":"cd35bd29-41e8-4364-b06c-19e7857690a6","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"383ac66c-a5a2-44fd-b87d-b261b856f92f"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_3df01c9c_b48a_44c9_8500_a5d135ae0841","uuid":"fc2cac49-0219-44e2-b70a-b37682ba87c2"},"edge_type":"inherent","type":"","uuid":"34163165-9d7e-43c1-a1cf-514598f287f8","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"938aad82-8fce-40ce-aa31-5898c9687ecd"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"938aad82-8fce-40ce-aa31-5898c9687ecd"},"edge_type":"inherent","type":"","uuid":"609f4bea-7c66-4294-95c0-3b996973fd0f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"093d93a1-bfcb-4c9c-93ea-56a3e7c01b0c"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"938aad82-8fce-40ce-aa31-5898c9687ecd"},"edge_type":"dependency","type":"","uuid":"6dfc0435-5cb3-4992-827d-20e7edbf25d2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"28a64cb5-54bd-4eb2-93c6-b9ae14830ce7"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"0e4b0643-e61a-4ddf-849a-409efb790a2a"},"edge_type":"dependency","type":"","uuid":"6a70ab77-f254-44ad-801b-07d707cc8b0f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"093d93a1-bfcb-4c9c-93ea-56a3e7c01b0c"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_1c0be862_70e3_4e5b_af51_c82cc7f6b22c"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"9a4951f4-f10a-44c2-ae99-14758a79f8d5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_e54dd002_50e1_4051_bc5a_c2bb008669ee"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"fc2cac49-0219-44e2-b70a-b37682ba87c2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_3df01c9c_b48a_44c9_8500_a5d135ae0841"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0e4b0643-e61a-4ddf-849a-409efb790a2a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"cee442f5-479a-4b78-ac00-d34a2169f479"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"938aad82-8fce-40ce-aa31-5898c9687ecd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"0d56375e-2923-437e-bf82-3fcadfe99d53"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"093d93a1-bfcb-4c9c-93ea-56a3e7c01b0c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"54801dfd-81bb-487c-ae84-55bc739ded6a"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"28a64cb5-54bd-4eb2-93c6-b9ae14830ce7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"5549bf8a-88d8-4690-9c7d-36ab75ab6c8b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_dd402e71_0337_4f3e_9693_06781cf08182"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d718ba4e-2d02-417c-a5b6-b3dc0f07ff3a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"aa8dd27e-4bd1-4b85-86c6-750c0a49579f"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"383ac66c-a5a2-44fd-b87d-b261b856f92f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"cabcfd41-35e6-45f0-a791-00daf17de059"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6352f373-6043-493f-9f1d-e3379fbd54ee","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"64e5991c-fbcd-4d1f-8b72-4b4956e9702e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d6d247a1-48b0-4e6b-9b8b-e2af06b56a5a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"91f453c1-d2fc-47b1-93d4-4b49476235be"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"0f130c38-1a28-4ee4-88e3-1a1806f3c589","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_1c0be862_70e3_4e5b_af51_c82cc7f6b22c","uuid":"4e8f7a3d-01b8-4894-96ce-b183202cc7a5"},"name":"SYS_GEN__Runbook_Application_1c0be862_70e3_4e5b_af51_c82cc7f6b22c"}},{"description":"System action for starting an application","message_list":[],"uuid":"82888bd7-ba56-4ad1-9fd6-68be98e15c61","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"GCP","uuid":"1c0be862-70e3-4e5b-af51-c82cc7f6b22c"},"retries":"0","description":"","type":"DAG","uuid":"8d05297c-dad0-40ba-9bc0-7e66e3899fb9","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"ca1df993-98a6-49fb-85ba-ca8c3236476a"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"85558f7d-5387-4bb9-97d4-3eb8fba69e49"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"5423692c-78d4-4b6e-88cc-3c7d8bba3c02"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"bff2cf9b-6722-4d9a-867f-0ca56ec12d65"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"85558f7d-5387-4bb9-97d4-3eb8fba69e49"},"edge_type":"inherent","type":"","uuid":"402d9194-3329-408a-bfd3-9ff5cbbb654a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"bff2cf9b-6722-4d9a-867f-0ca56ec12d65"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"ca1df993-98a6-49fb-85ba-ca8c3236476a"},"edge_type":"inherent","type":"","uuid":"4c6574df-4da4-44e3-881e-7f745dfecc3f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"5423692c-78d4-4b6e-88cc-3c7d8bba3c02"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_1c0be862_70e3_4e5b_af51_c82cc7f6b22c"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ca1df993-98a6-49fb-85ba-ca8c3236476a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"d21339ff-d200-48c4-af20-6a0d4d22d471"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"85558f7d-5387-4bb9-97d4-3eb8fba69e49","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"3d0c95eb-529e-42af-adbf-b7248e8cd33b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5423692c-78d4-4b6e-88cc-3c7d8bba3c02","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"91f453c1-d2fc-47b1-93d4-4b49476235be"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"bff2cf9b-6722-4d9a-867f-0ca56ec12d65","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"64e5991c-fbcd-4d1f-8b72-4b4956e9702e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"949dd4e8-5ba3-40b3-aefa-51fd7cefe7dc","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_1c0be862_70e3_4e5b_af51_c82cc7f6b22c","uuid":"8d05297c-dad0-40ba-9bc0-7e66e3899fb9"},"name":"SYS_GEN__Runbook_Application_1c0be862_70e3_4e5b_af51_c82cc7f6b22c"}},{"description":"System action for restarting an application","message_list":[],"uuid":"15bdfefb-542f-42ab-a9af-3355fe92d81b","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"GCP","uuid":"1c0be862-70e3-4e5b-af51-c82cc7f6b22c"},"retries":"0","description":"","type":"DAG","uuid":"dc912f81-eb61-49ed-859e-460cf87de299","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"d29e57f8-c9fb-4d84-917f-22ff8f845779"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"5e577c56-ba32-42b1-830f-da560206e157"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"a88c1067-7281-4ad6-9164-6c2e2efaf1db"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"5545133f-ba01-4bf7-a42c-dc3a8cdeabc1"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"d29e57f8-c9fb-4d84-917f-22ff8f845779"},"edge_type":"inherent","type":"","uuid":"582123e4-64d2-406b-adcc-6923bef798f5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"a88c1067-7281-4ad6-9164-6c2e2efaf1db"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"5e577c56-ba32-42b1-830f-da560206e157"},"edge_type":"inherent","type":"","uuid":"77874c7e-5476-424e-bee4-8b72cd5ee83a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"5545133f-ba01-4bf7-a42c-dc3a8cdeabc1"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_1c0be862_70e3_4e5b_af51_c82cc7f6b22c"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d29e57f8-c9fb-4d84-917f-22ff8f845779","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"3f4a46b1-bc49-426d-80ce-ee54ce5fd40a"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5e577c56-ba32-42b1-830f-da560206e157","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"791cffbe-7c39-4058-b17a-4a6f9687217d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a88c1067-7281-4ad6-9164-6c2e2efaf1db","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"526cc0d4-3d9e-49c6-840b-f42e056f5d89"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5545133f-ba01-4bf7-a42c-dc3a8cdeabc1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"3fd75c09-a79f-4731-98fc-b65b96bc9fe7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"d6528cd5-6e76-4ff3-9e4e-5c59cf643e6c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_1c0be862_70e3_4e5b_af51_c82cc7f6b22c","uuid":"dc912f81-eb61-49ed-859e-460cf87de299"},"name":"SYS_GEN__Runbook_Application_1c0be862_70e3_4e5b_af51_c82cc7f6b22c"}},{"description":"System action for stopping an application","message_list":[],"uuid":"1d585612-9eed-4578-83d6-f675c7392ff6","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"GCP","uuid":"1c0be862-70e3-4e5b-af51-c82cc7f6b22c"},"retries":"0","description":"","type":"DAG","uuid":"2b588417-5041-49c7-9902-84e9074260fc","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"5f2b537d-25f9-4c06-a2a5-2275064975d7"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"8c0af344-e651-41a5-b660-6655bef2c2fc"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"46088ac4-0dbf-41bf-8f11-854bcc688344"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"c719046b-20d5-404a-bb43-a71048ba1f7b"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"5f2b537d-25f9-4c06-a2a5-2275064975d7"},"edge_type":"inherent","type":"","uuid":"c14051e4-121a-40a8-8e76-5afc63e0a227","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"c719046b-20d5-404a-bb43-a71048ba1f7b"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"8c0af344-e651-41a5-b660-6655bef2c2fc"},"edge_type":"inherent","type":"","uuid":"8e76fdd9-6154-4486-82bb-7a1b7a4c537e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"46088ac4-0dbf-41bf-8f11-854bcc688344"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_1c0be862_70e3_4e5b_af51_c82cc7f6b22c"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5f2b537d-25f9-4c06-a2a5-2275064975d7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"1fdd3541-2eca-471a-a4be-4ef82887d4de"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8c0af344-e651-41a5-b660-6655bef2c2fc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12105be2-ee67-451d-8054-4546855e277c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"46088ac4-0dbf-41bf-8f11-854bcc688344","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"0769bd6e-10a3-4790-8366-90653ae53f9e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c719046b-20d5-404a-bb43-a71048ba1f7b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"6236dfbc-4e3e-4f48-8c7e-bc77d5eb300d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3"}],"description":"","message_list":[],"uuid":"e5af92c4-366c-425b-b4cc-3c9d020340d7","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_1c0be862_70e3_4e5b_af51_c82cc7f6b22c","uuid":"2b588417-5041-49c7-9902-84e9074260fc"},"name":"SYS_GEN__Runbook_Application_1c0be862_70e3_4e5b_af51_c82cc7f6b22c"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"806659e0-5736-4407-89bd-4a026c3fb46d","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"GCP","uuid":"1c0be862-70e3-4e5b-af51-c82cc7f6b22c"},"retries":"0","description":"","type":"DAG","uuid":"e35998a7-65c9-42c1-a7f5-291d166de1f3","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"dfbe8f95-fec0-4268-934c-6b3a4ee7c330"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"c6e0df3f-17ed-4fff-b6a0-8c14161bc5b1"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"51e01cf6-4257-40d3-ad08-36742c117d30"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"ba2d9a8e-cc59-46c9-bb56-6af85f4969f4"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"7851d9f9-f02e-4656-a1f6-389a4e4ec3af"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"768c2b66-396f-4450-8a3b-fe20e2e0f7f4"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"00f7c736-e253-4fb8-b03b-57cc2067f71c"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"d46be8fc-7f28-4a1e-81f0-beed29f82045"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_e54dd002_50e1_4051_bc5a_c2bb008669ee","uuid":"c3a43768-cb94-4076-ad52-021d131fb0d8"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_3df01c9c_b48a_44c9_8500_a5d135ae0841","uuid":"b6c0c4bf-dd8d-40ee-b374-b5bf1d9c8d8e"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"c6e0df3f-17ed-4fff-b6a0-8c14161bc5b1"},"edge_type":"inherent","type":"","uuid":"d7c91df0-c5e0-434d-8b6d-58e1d7a6f295","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"ba2d9a8e-cc59-46c9-bb56-6af85f4969f4"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"ba2d9a8e-cc59-46c9-bb56-6af85f4969f4"},"edge_type":"inherent","type":"","uuid":"2c16dd8e-0387-4a80-81b8-891db4e57363","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"7851d9f9-f02e-4656-a1f6-389a4e4ec3af"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"00f7c736-e253-4fb8-b03b-57cc2067f71c"},"edge_type":"inherent","type":"","uuid":"ad84f895-6d25-46f3-91b5-cc7b54c72c8a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_e54dd002_50e1_4051_bc5a_c2bb008669ee","uuid":"c3a43768-cb94-4076-ad52-021d131fb0d8"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"7851d9f9-f02e-4656-a1f6-389a4e4ec3af"},"edge_type":"inherent","type":"","uuid":"4ece1384-709a-40ae-8cf5-0aa6333e6c17","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"00f7c736-e253-4fb8-b03b-57cc2067f71c"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"dfbe8f95-fec0-4268-934c-6b3a4ee7c330"},"edge_type":"inherent","type":"","uuid":"26862917-e3fe-4e43-90b9-e1a9b765be0b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"51e01cf6-4257-40d3-ad08-36742c117d30"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"51e01cf6-4257-40d3-ad08-36742c117d30"},"edge_type":"inherent","type":"","uuid":"4eb8fe65-61cb-44ac-937a-414c18ef1490","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"768c2b66-396f-4450-8a3b-fe20e2e0f7f4"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"d46be8fc-7f28-4a1e-81f0-beed29f82045"},"edge_type":"inherent","type":"","uuid":"f5ae7959-1fea-4f1a-8f43-eeb6e7cfa47d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_3df01c9c_b48a_44c9_8500_a5d135ae0841","uuid":"b6c0c4bf-dd8d-40ee-b374-b5bf1d9c8d8e"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"768c2b66-396f-4450-8a3b-fe20e2e0f7f4"},"edge_type":"inherent","type":"","uuid":"89f3f118-3de9-4e93-90b6-07752ee95960","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"d46be8fc-7f28-4a1e-81f0-beed29f82045"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"7851d9f9-f02e-4656-a1f6-389a4e4ec3af"},"edge_type":"create_action_edge","type":"","uuid":"c01bcd9c-cb34-4b7b-b65a-3449b1d6f982","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"d46be8fc-7f28-4a1e-81f0-beed29f82045"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"768c2b66-396f-4450-8a3b-fe20e2e0f7f4"},"edge_type":"create_action_edge","type":"","uuid":"a95d316b-67d3-4ff0-839f-065ea05c5ea8","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"00f7c736-e253-4fb8-b03b-57cc2067f71c"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"ba2d9a8e-cc59-46c9-bb56-6af85f4969f4"},"edge_type":"dependency","type":"","uuid":"78de8d00-2370-40d5-ac09-fe3bb7bcab21","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"768c2b66-396f-4450-8a3b-fe20e2e0f7f4"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_1c0be862_70e3_4e5b_af51_c82cc7f6b22c"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"dfbe8f95-fec0-4268-934c-6b3a4ee7c330","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12105be2-ee67-451d-8054-4546855e277c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c6e0df3f-17ed-4fff-b6a0-8c14161bc5b1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"1fdd3541-2eca-471a-a4be-4ef82887d4de"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"51e01cf6-4257-40d3-ad08-36742c117d30","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"6b0fd64c-e97f-4968-998d-ff058e95d9e9"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ba2d9a8e-cc59-46c9-bb56-6af85f4969f4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"a2ac512f-d272-4905-bafb-4733f7e58c9b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"7851d9f9-f02e-4656-a1f6-389a4e4ec3af","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"6173244d-f073-4e90-a370-9f2c307d4036"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_dd402e71_0337_4f3e_9693_06781cf08182"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"768c2b66-396f-4450-8a3b-fe20e2e0f7f4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"6158fa37-c9a9-4d57-890b-2f587cc5c20d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"00f7c736-e253-4fb8-b03b-57cc2067f71c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"8b6d072e-7e87-4c04-a89f-88296a863ed8"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d46be8fc-7f28-4a1e-81f0-beed29f82045","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"f13ba8c1-6ea6-4b3f-a059-2f2a9732b44c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"c3a43768-cb94-4076-ad52-021d131fb0d8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_e54dd002_50e1_4051_bc5a_c2bb008669ee"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"b6c0c4bf-dd8d-40ee-b374-b5bf1d9c8d8e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_3df01c9c_b48a_44c9_8500_a5d135ae0841"}],"description":"","message_list":[],"uuid":"915aa336-abb1-4864-9826-920f72bbf66e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_1c0be862_70e3_4e5b_af51_c82cc7f6b22c","uuid":"e35998a7-65c9-42c1-a7f5-291d166de1f3"},"name":"SYS_GEN__Runbook_Application_1c0be862_70e3_4e5b_af51_c82cc7f6b22c"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"6a1c59dc-fb34-46f2-9329-10be65f5812e","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"GCP","uuid":"1c0be862-70e3-4e5b-af51-c82cc7f6b22c"},"retries":"0","description":"","type":"DAG","uuid":"e1ae169e-a804-4d0e-9658-a22e4648213e","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"4be5dd14-a974-4fce-88b5-137f788f2e3c"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"92699932-1058-4ceb-8429-01aa3be282e1"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"07dac7ce-ad5e-4403-9e01-7c8e5bf9526a"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"011b5f65-1002-496e-967c-dabf23c2c404"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"f98a294c-a6e5-4cbb-9169-e4edd0ae8cb5"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"9d741fbd-80f8-4976-b916-556091b17d33"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_e54dd002_50e1_4051_bc5a_c2bb008669ee","uuid":"54c658d8-5b9a-42f4-accd-eb29922ba799"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_3df01c9c_b48a_44c9_8500_a5d135ae0841","uuid":"4e48f79d-525b-4553-8e94-0f9b8e6da50b"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"92699932-1058-4ceb-8429-01aa3be282e1"},"edge_type":"inherent","type":"","uuid":"17634f8b-e43e-4b05-a259-63c92d649871","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"011b5f65-1002-496e-967c-dabf23c2c404"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"f98a294c-a6e5-4cbb-9169-e4edd0ae8cb5"},"edge_type":"inherent","type":"","uuid":"fb045639-5d11-481b-8b44-2ba3e74b35fc","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_e54dd002_50e1_4051_bc5a_c2bb008669ee","uuid":"54c658d8-5b9a-42f4-accd-eb29922ba799"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"011b5f65-1002-496e-967c-dabf23c2c404"},"edge_type":"inherent","type":"","uuid":"d61c7ac9-0965-444f-bf20-3e81bb3d24e4","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"f98a294c-a6e5-4cbb-9169-e4edd0ae8cb5"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"4be5dd14-a974-4fce-88b5-137f788f2e3c"},"edge_type":"inherent","type":"","uuid":"b6d95ff4-7d60-4bc8-9314-393814eeb5f8","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"07dac7ce-ad5e-4403-9e01-7c8e5bf9526a"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"9d741fbd-80f8-4976-b916-556091b17d33"},"edge_type":"inherent","type":"","uuid":"62bc2c3f-011f-48e4-a9f8-d91dd8d6c895","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_3df01c9c_b48a_44c9_8500_a5d135ae0841","uuid":"4e48f79d-525b-4553-8e94-0f9b8e6da50b"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"07dac7ce-ad5e-4403-9e01-7c8e5bf9526a"},"edge_type":"inherent","type":"","uuid":"943df8cc-1ba3-4691-8afe-a732f3f04fb4","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"9d741fbd-80f8-4976-b916-556091b17d33"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"011b5f65-1002-496e-967c-dabf23c2c404"},"edge_type":"create_action_edge","type":"","uuid":"1bf07bc5-1094-4028-832b-1359344fb13c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"9d741fbd-80f8-4976-b916-556091b17d33"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"07dac7ce-ad5e-4403-9e01-7c8e5bf9526a"},"edge_type":"create_action_edge","type":"","uuid":"d5a2d8cb-0815-4b70-8d3d-b235b0ef628a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"f98a294c-a6e5-4cbb-9169-e4edd0ae8cb5"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_1c0be862_70e3_4e5b_af51_c82cc7f6b22c"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4be5dd14-a974-4fce-88b5-137f788f2e3c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"d44a642f-9468-432a-9b7e-e69a7c1c08e7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"92699932-1058-4ceb-8429-01aa3be282e1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"50a769a7-5b0a-4546-9e12-4f0a3ceff21b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"07dac7ce-ad5e-4403-9e01-7c8e5bf9526a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"011b5f65-1002-496e-967c-dabf23c2c404","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_dd402e71_0337_4f3e_9693_06781cf08182"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f98a294c-a6e5-4cbb-9169-e4edd0ae8cb5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3","uuid":"212033aa-f4d3-4ba4-82a1-a2629db48907"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_b970ceaa_d23f_40d6_80ae_26f475a587e3"},{"target_any_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"9d741fbd-80f8-4976-b916-556091b17d33","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516","uuid":"7e0d47ae-0f98-417b-954e-569e55bf9333"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_6b0f177a_9572_4df1_a6b8_71e996333516"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"54c658d8-5b9a-42f4-accd-eb29922ba799","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_e54dd002_50e1_4051_bc5a_c2bb008669ee"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"4e48f79d-525b-4553-8e94-0f9b8e6da50b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_3df01c9c_b48a_44c9_8500_a5d135ae0841"}],"description":"","message_list":[],"uuid":"a4942b96-7de9-44ff-8696-f008521f09d5","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_1c0be862_70e3_4e5b_af51_c82cc7f6b22c","uuid":"e1ae169e-a804-4d0e-9658-a22e4648213e"},"name":"SYS_GEN__Runbook_Application_1c0be862_70e3_4e5b_af51_c82cc7f6b22c"}}],"message_list":[],"uuid":"1c0be862-70e3-4e5b-af51-c82cc7f6b22c","state":"DRAFT","dependency_list":[{"getter_resource_kind":"PackageCfg","setter_resource_attr":"private_ip_address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"GCP_Centos_K8SM","action_name":"action_create","action_resource_name":"GCP","getter_resource_name":"GCP_Centos_K8SC_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"public_ip_address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"GCP_Centos_K8SM","action_name":"action_create","action_resource_name":"GCP","getter_resource_name":"GCP_Centos_K8SC_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"private_ip_address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"GCP_Centos_K8SC","action_name":"action_create","action_resource_name":"GCP","getter_resource_name":"GCP_Centos_K8SM_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"address","setter_resource_kind":"ServiceCfg","setter_resource_name":"Kubernetes_Master","action_name":"action_delete","action_resource_name":"GCP","getter_resource_name":"GCP_Centos_K8SM_Package","action_resource_kind":"ApplicationCfg"}],"variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"6f2833c0-9253-4f08-b7fc-678cb1d7251b","value":"kube-calm","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_CLUSTER_NAME"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"b0344744-2782-4a16-a33c-f5758e024946","value":"v1.8.0","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_VERSION"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"b808977e-cbee-473c-8e61-88c84bf91c20","value":"17.03.2.ce","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"DOCKER_VERSION"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"d8078373-3a50-4023-997b-84e679035d23","value":"10.200.0.0\/16","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_CLUSTER_SUBNET"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"df744e4d-5bb4-428c-b47e-e84bd8439e11","value":"10.32.0.0\/24","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_SERVICE_SUBNET"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"7fd1f9a4-f572-4ed2-9e60-283c5ad394a2","value":"10.32.0.10","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_DNS_IP"}],"name":"GCP"},{"deployment_create_list":[{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"5b837861-4578-4af5-944f-eac67c4cdd5c","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"retries":"0","description":"","type":"DAG","uuid":"544f534b-2eca-4ac9-81aa-952b3ddd0b7b","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_5d33c234_98e6_44ef_97c8_83771613cb91","uuid":"ae81820b-d004-454c-8401-3da91aa1bee1"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"6fc9c6ac-4607-469a-98a8-ee6f370f613e"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"f03945bf-9284-49aa-804f-2e0e1f1e5a9b"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"12d0b009-a626-46ba-a7a8-78aae678e0a9"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"9ee61c06-91c5-48f9-b38c-e95de0921ad0"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"12d0b009-a626-46ba-a7a8-78aae678e0a9"},"edge_type":"inherent","type":"","uuid":"d8af2a9d-1ce4-4883-8499-456d14c70851","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"9ee61c06-91c5-48f9-b38c-e95de0921ad0"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"f03945bf-9284-49aa-804f-2e0e1f1e5a9b"},"edge_type":"inherent","type":"","uuid":"566a9fe8-436d-4020-b708-de3ed13161d1","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"12d0b009-a626-46ba-a7a8-78aae678e0a9"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_5d33c234_98e6_44ef_97c8_83771613cb91","uuid":"ae81820b-d004-454c-8401-3da91aa1bee1"},"edge_type":"inherent","type":"","uuid":"4f419038-f0b6-4273-a4f3-62f8e1d9b0d8","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"6fc9c6ac-4607-469a-98a8-ee6f370f613e"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"6fc9c6ac-4607-469a-98a8-ee6f370f613e"},"edge_type":"inherent","type":"","uuid":"cfb4b20e-c1ce-4e55-b855-1130be48b7c3","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"f03945bf-9284-49aa-804f-2e0e1f1e5a9b"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_5d33c234_98e6_44ef_97c8_83771613cb91"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"ae81820b-d004-454c-8401-3da91aa1bee1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_5d33c234_98e6_44ef_97c8_83771613cb91"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6fc9c6ac-4607-469a-98a8-ee6f370f613e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"ab8b18aa-5c5d-4fdf-af20-5d8518c51208"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f03945bf-9284-49aa-804f-2e0e1f1e5a9b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"757c2a82-bf84-4b6f-8b71-b8d446b3208e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"12d0b009-a626-46ba-a7a8-78aae678e0a9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"aa8dd27e-4bd1-4b85-86c6-750c0a49579f"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"9ee61c06-91c5-48f9-b38c-e95de0921ad0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"64e5991c-fbcd-4d1f-8b72-4b4956e9702e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"806ecdc1-7466-4a64-9248-035185f32c5e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_5d33c234_98e6_44ef_97c8_83771613cb91","uuid":"544f534b-2eca-4ac9-81aa-952b3ddd0b7b"},"name":"SYS_GEN__Runbook_Deployment_5d33c234_98e6_44ef_97c8_83771613cb91"}},{"description":"System action for starting an application","message_list":[],"uuid":"cd77b56f-3360-44b7-b162-8012d6b9c417","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"retries":"0","description":"","type":"DAG","uuid":"fabf07ff-d683-4991-a61e-39b0526ad97f","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"81347adf-9e3f-4b56-a3ea-2e9a06b122fe"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"5401f55e-b3b2-40dc-a218-532e94670aef"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"81347adf-9e3f-4b56-a3ea-2e9a06b122fe"},"edge_type":"inherent","type":"","uuid":"0d7b137e-0ed7-47d9-8abb-7a03739a283a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"5401f55e-b3b2-40dc-a218-532e94670aef"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_5d33c234_98e6_44ef_97c8_83771613cb91"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"81347adf-9e3f-4b56-a3ea-2e9a06b122fe","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"e4bc2b12-cac9-4f26-8469-1f583923f11c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5401f55e-b3b2-40dc-a218-532e94670aef","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"64e5991c-fbcd-4d1f-8b72-4b4956e9702e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"e55a739c-1d09-46d7-982d-e8aee59ea5ac","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_5d33c234_98e6_44ef_97c8_83771613cb91","uuid":"fabf07ff-d683-4991-a61e-39b0526ad97f"},"name":"SYS_GEN__Runbook_Deployment_5d33c234_98e6_44ef_97c8_83771613cb91"}},{"description":"System action for restarting an application","message_list":[],"uuid":"8496c30f-b0e9-4bf8-b910-2f6ac194e32c","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"retries":"0","description":"","type":"DAG","uuid":"14fbc665-983e-4cc7-83b4-0697f44033d5","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"bbaf669f-8446-4603-9170-fa5159a4034b"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"2b17b192-c86b-4dbe-9831-641c590a2625"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"bbaf669f-8446-4603-9170-fa5159a4034b"},"edge_type":"inherent","type":"","uuid":"3bf19bed-2e3f-4dd4-a60e-6013d99489d9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"2b17b192-c86b-4dbe-9831-641c590a2625"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_5d33c234_98e6_44ef_97c8_83771613cb91"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"bbaf669f-8446-4603-9170-fa5159a4034b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"c04252fb-c52d-4e8e-a2ce-b575118ef155"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2b17b192-c86b-4dbe-9831-641c590a2625","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"526cc0d4-3d9e-49c6-840b-f42e056f5d89"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"88ed04db-3518-42c4-91b7-68517e9b3894","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_5d33c234_98e6_44ef_97c8_83771613cb91","uuid":"14fbc665-983e-4cc7-83b4-0697f44033d5"},"name":"SYS_GEN__Runbook_Deployment_5d33c234_98e6_44ef_97c8_83771613cb91"}},{"description":"System action for stopping an application","message_list":[],"uuid":"37ba9b33-99ac-41bd-9851-ad50aff9887e","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"retries":"0","description":"","type":"DAG","uuid":"8c7fd12a-7832-4f1c-a3e1-5f0074e52e22","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"2a2839dd-99af-4f82-a911-c46b8a1d21e2"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"4fe49b31-1331-4e26-a2de-12230646f903"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"2a2839dd-99af-4f82-a911-c46b8a1d21e2"},"edge_type":"inherent","type":"","uuid":"02f0e8e5-3c95-403e-af23-1a17c6731873","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"4fe49b31-1331-4e26-a2de-12230646f903"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_5d33c234_98e6_44ef_97c8_83771613cb91"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2a2839dd-99af-4f82-a911-c46b8a1d21e2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"1fdd3541-2eca-471a-a4be-4ef82887d4de"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4fe49b31-1331-4e26-a2de-12230646f903","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"c893037e-bcd3-4b89-93d2-c25cfa602f13"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696"}],"description":"","message_list":[],"uuid":"ec0a0b02-ecae-4863-a697-9344bcd5e60b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_5d33c234_98e6_44ef_97c8_83771613cb91","uuid":"8c7fd12a-7832-4f1c-a3e1-5f0074e52e22"},"name":"SYS_GEN__Runbook_Deployment_5d33c234_98e6_44ef_97c8_83771613cb91"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"45c15ee7-bc56-4fe7-9429-6b19860641b1","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"retries":"0","description":"","type":"DAG","uuid":"9434c3c5-642f-4ff6-87be-e2da8a4e5e33","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"90a8089d-86e1-45f3-993c-fed87ec0ce4f"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"02c4a75e-6aef-4a95-8249-6d85f0908721"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"636c1383-3e9d-4fbc-acc9-f8b4094c4d22"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"24c8774d-a9e4-4286-8441-e427bb612543"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_5d33c234_98e6_44ef_97c8_83771613cb91","uuid":"12f74f9f-383a-4b87-aafc-6d22c447fca1"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"90a8089d-86e1-45f3-993c-fed87ec0ce4f"},"edge_type":"inherent","type":"","uuid":"b16029da-2998-48c3-bab3-8bf9497903c0","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"02c4a75e-6aef-4a95-8249-6d85f0908721"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"02c4a75e-6aef-4a95-8249-6d85f0908721"},"edge_type":"inherent","type":"","uuid":"1885ae0e-6d69-4c1e-860b-9c7ebb6914db","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"636c1383-3e9d-4fbc-acc9-f8b4094c4d22"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"636c1383-3e9d-4fbc-acc9-f8b4094c4d22"},"edge_type":"inherent","type":"","uuid":"218c0578-f037-4abb-8b84-704d18f30aa2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"24c8774d-a9e4-4286-8441-e427bb612543"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"24c8774d-a9e4-4286-8441-e427bb612543"},"edge_type":"inherent","type":"","uuid":"1031db79-d213-4a24-b5f2-cd843a8397c7","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_5d33c234_98e6_44ef_97c8_83771613cb91","uuid":"12f74f9f-383a-4b87-aafc-6d22c447fca1"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_5d33c234_98e6_44ef_97c8_83771613cb91"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"90a8089d-86e1-45f3-993c-fed87ec0ce4f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"1fdd3541-2eca-471a-a4be-4ef82887d4de"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"02c4a75e-6aef-4a95-8249-6d85f0908721","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"a2ac512f-d272-4905-bafb-4733f7e58c9b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"636c1383-3e9d-4fbc-acc9-f8b4094c4d22","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"8ae59bad-2465-469a-85c0-4697785f6418"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"24c8774d-a9e4-4286-8441-e427bb612543","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"ff697210-af55-4a6f-a695-115768d31ce4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"12f74f9f-383a-4b87-aafc-6d22c447fca1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_5d33c234_98e6_44ef_97c8_83771613cb91"}],"description":"","message_list":[],"uuid":"570ddd4a-ac6d-4c05-9dc1-2de38e4c987c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_5d33c234_98e6_44ef_97c8_83771613cb91","uuid":"9434c3c5-642f-4ff6-87be-e2da8a4e5e33"},"name":"SYS_GEN__Runbook_Deployment_5d33c234_98e6_44ef_97c8_83771613cb91"}},{"description":"System action for scaleout","message_list":[],"uuid":"3017885e-5618-4986-9aaa-8cf11cb075b9","name":"action_scaleout","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"retries":"0","description":"","type":"DAG","uuid":"794b3016-4a8e-43e7-a50a-96b0d52b139a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scaleout_5d33c234_98e6_44ef_97c8_83771613cb91","uuid":"9803d600-f8b2-4e1e-b69e-e4fb6b6d342a"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_5d33c234_98e6_44ef_97c8_83771613cb91"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"retries":"0","description":"","type":"SCALING","uuid":"9803d600-f8b2-4e1e-b69e-e4fb6b6d342a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scaleout_5d33c234_98e6_44ef_97c8_83771613cb91"}],"description":"","message_list":[],"uuid":"e30c1ae5-8fd8-4726-b326-5d4565c83001","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"631ab6c9-d269-4cfc-a042-d077933df8e1","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_5d33c234_98e6_44ef_97c8_83771613cb91","uuid":"794b3016-4a8e-43e7-a50a-96b0d52b139a"},"name":"SYS_GEN__Runbook_Deployment_5d33c234_98e6_44ef_97c8_83771613cb91"}},{"description":"System action for scalein","message_list":[],"uuid":"469b94f0-08ba-4fd5-82cc-33168993c074","name":"action_scalein","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"retries":"0","description":"","type":"DAG","uuid":"8aaf2c04-4357-41cd-9822-fb2beae01a61","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scalein_5d33c234_98e6_44ef_97c8_83771613cb91","uuid":"c39feb53-28ed-49a7-a90b-d5c9ce960cec"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_5d33c234_98e6_44ef_97c8_83771613cb91"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"retries":"0","description":"","type":"SCALING","uuid":"c39feb53-28ed-49a7-a90b-d5c9ce960cec","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scalein_5d33c234_98e6_44ef_97c8_83771613cb91"}],"description":"","message_list":[],"uuid":"da7ba9ce-f1cf-4543-beeb-1a69137804b5","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"e2244059-a096-45fe-9cbc-10b15788c0fd","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_5d33c234_98e6_44ef_97c8_83771613cb91","uuid":"8aaf2c04-4357-41cd-9822-fb2beae01a61"},"name":"SYS_GEN__Runbook_Deployment_5d33c234_98e6_44ef_97c8_83771613cb91"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"5d8ef4e5-8aee-4033-971d-deda24ddd310","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"retries":"0","description":"","type":"DAG","uuid":"056fb194-64bb-4651-b807-361e612ce6bb","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"462da142-faf9-49ef-9f97-f624b1af06c6"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"5fea2f29-78b1-48b7-bccd-aacd9f75fe90"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"1fac0c56-0b27-487c-870a-6067c57be9fd"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_5d33c234_98e6_44ef_97c8_83771613cb91","uuid":"7ab62eeb-a9da-441a-80a5-b17c1e22396b"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"462da142-faf9-49ef-9f97-f624b1af06c6"},"edge_type":"inherent","type":"","uuid":"b595d067-63f2-4bc6-a7bf-ea4280f22641","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"5fea2f29-78b1-48b7-bccd-aacd9f75fe90"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"1fac0c56-0b27-487c-870a-6067c57be9fd"},"edge_type":"inherent","type":"","uuid":"9634c170-3535-4f8f-b620-05f7f0fe571b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_5d33c234_98e6_44ef_97c8_83771613cb91","uuid":"7ab62eeb-a9da-441a-80a5-b17c1e22396b"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"5fea2f29-78b1-48b7-bccd-aacd9f75fe90"},"edge_type":"inherent","type":"","uuid":"24749602-b9fc-421b-8a2f-364cbc2fddeb","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"1fac0c56-0b27-487c-870a-6067c57be9fd"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_5d33c234_98e6_44ef_97c8_83771613cb91"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"462da142-faf9-49ef-9f97-f624b1af06c6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"50a769a7-5b0a-4546-9e12-4f0a3ceff21b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"5fea2f29-78b1-48b7-bccd-aacd9f75fe90","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1fac0c56-0b27-487c-870a-6067c57be9fd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"cb24613d-b9bb-4fc9-ad8a-98a1f1f2c77a"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"7ab62eeb-a9da-441a-80a5-b17c1e22396b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_5d33c234_98e6_44ef_97c8_83771613cb91"}],"description":"","message_list":[],"uuid":"54b4a455-20f5-4060-b3e7-1516379dee18","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_5d33c234_98e6_44ef_97c8_83771613cb91","uuid":"056fb194-64bb-4651-b807-361e612ce6bb"},"name":"SYS_GEN__Runbook_Deployment_5d33c234_98e6_44ef_97c8_83771613cb91"}}],"message_list":[],"published_service_local_reference_list":[],"uuid":"5d33c234-98e6-44ef-97c8-83771613cb91","min_replicas":"3","state":"DRAFT","max_replicas":"3","depends_on_list":[],"editables":{"min_replicas":true,"max_replicas":true},"package_local_reference_list":[{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"}],"substrate_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"type":"GREENFIELD","options":{},"variable_list":[],"name":"34875daf_deployment_cloned_1"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"bcfec14e-ee3c-4d1b-ac4c-01454e3c20f0","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"retries":"0","description":"","type":"DAG","uuid":"3f54323f-d7a6-4bfd-a145-36156f2faf27","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_ee2b0f2f_ee60_48c4_b32c_da68ba12098c","uuid":"94df218e-a381-48c3-9e46-8cfadf0288cf"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"f98e2111-c9b8-433b-a9f8-eb054bcdf590"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"d19d4ae2-08c9-42ab-a1df-5e79e720fdea"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"7d1922d6-07ce-465b-b043-aa8c02fd3bbd"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"269363c7-e55f-41a2-8405-21b2fc487477"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"7d1922d6-07ce-465b-b043-aa8c02fd3bbd"},"edge_type":"inherent","type":"","uuid":"074fa060-e577-4e3a-a142-54f2efa1c33c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"269363c7-e55f-41a2-8405-21b2fc487477"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"d19d4ae2-08c9-42ab-a1df-5e79e720fdea"},"edge_type":"inherent","type":"","uuid":"e26d8f88-3dc8-4e8e-8368-65dc1039c829","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"7d1922d6-07ce-465b-b043-aa8c02fd3bbd"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_ee2b0f2f_ee60_48c4_b32c_da68ba12098c","uuid":"94df218e-a381-48c3-9e46-8cfadf0288cf"},"edge_type":"inherent","type":"","uuid":"c8312e99-715c-402b-b89a-bf8b057ab956","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"f98e2111-c9b8-433b-a9f8-eb054bcdf590"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"f98e2111-c9b8-433b-a9f8-eb054bcdf590"},"edge_type":"inherent","type":"","uuid":"da4874ce-e65d-41a1-8fcb-0bdb1c029fed","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"d19d4ae2-08c9-42ab-a1df-5e79e720fdea"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_ee2b0f2f_ee60_48c4_b32c_da68ba12098c"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"94df218e-a381-48c3-9e46-8cfadf0288cf","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_ee2b0f2f_ee60_48c4_b32c_da68ba12098c"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f98e2111-c9b8-433b-a9f8-eb054bcdf590","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"559e173f-784d-4416-bffd-385d336ac054"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d19d4ae2-08c9-42ab-a1df-5e79e720fdea","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"9b1bbd75-4d96-4806-a502-1e516f33961c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_e86d00bd_64a7_4363_884d_48ab6e49052a"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"7d1922d6-07ce-465b-b043-aa8c02fd3bbd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"cabcfd41-35e6-45f0-a791-00daf17de059"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"269363c7-e55f-41a2-8405-21b2fc487477","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"91f453c1-d2fc-47b1-93d4-4b49476235be"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"d874b5e1-bfac-44dd-be63-15f9f50ea4da","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_ee2b0f2f_ee60_48c4_b32c_da68ba12098c","uuid":"3f54323f-d7a6-4bfd-a145-36156f2faf27"},"name":"SYS_GEN__Runbook_Deployment_ee2b0f2f_ee60_48c4_b32c_da68ba12098c"}},{"description":"System action for starting an application","message_list":[],"uuid":"fb32c9bd-c80c-4775-87c0-42688c9042ef","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"retries":"0","description":"","type":"DAG","uuid":"4253f7ec-a2c1-4a2d-bdfb-a8b50ae85e73","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"0aa40f19-efac-4bd9-99e6-f23ada66ea99"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"27523797-321c-473c-9471-b2a49496dd16"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"0aa40f19-efac-4bd9-99e6-f23ada66ea99"},"edge_type":"inherent","type":"","uuid":"c87f7bdc-988c-4687-a58f-3fb928b220be","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"27523797-321c-473c-9471-b2a49496dd16"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_ee2b0f2f_ee60_48c4_b32c_da68ba12098c"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0aa40f19-efac-4bd9-99e6-f23ada66ea99","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"59d69a24-d569-4d64-9def-9d16a3593d6e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"27523797-321c-473c-9471-b2a49496dd16","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"91f453c1-d2fc-47b1-93d4-4b49476235be"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"976731d5-4411-4eec-9fc8-7dfc3cc84385","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_ee2b0f2f_ee60_48c4_b32c_da68ba12098c","uuid":"4253f7ec-a2c1-4a2d-bdfb-a8b50ae85e73"},"name":"SYS_GEN__Runbook_Deployment_ee2b0f2f_ee60_48c4_b32c_da68ba12098c"}},{"description":"System action for restarting an application","message_list":[],"uuid":"2c180aca-5e25-4c94-94b3-7644c8f8e0c2","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"retries":"0","description":"","type":"DAG","uuid":"88f855e7-ed04-4523-b71a-9cb52e3c7666","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"31b4da49-24c2-4b90-87a6-279a8d137f83"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"29893542-8c1e-40ce-b41a-1416318152e8"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"31b4da49-24c2-4b90-87a6-279a8d137f83"},"edge_type":"inherent","type":"","uuid":"7101c355-4c71-42e5-87db-2b1f81a077ff","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"29893542-8c1e-40ce-b41a-1416318152e8"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_ee2b0f2f_ee60_48c4_b32c_da68ba12098c"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"31b4da49-24c2-4b90-87a6-279a8d137f83","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"52365d7c-8b63-477b-bbbd-285320567682"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"29893542-8c1e-40ce-b41a-1416318152e8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"3fd75c09-a79f-4731-98fc-b65b96bc9fe7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"ca7fb0a2-1712-417c-b38e-40027d374548","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_ee2b0f2f_ee60_48c4_b32c_da68ba12098c","uuid":"88f855e7-ed04-4523-b71a-9cb52e3c7666"},"name":"SYS_GEN__Runbook_Deployment_ee2b0f2f_ee60_48c4_b32c_da68ba12098c"}},{"description":"System action for stopping an application","message_list":[],"uuid":"f9d7b9f6-1625-4e7e-96f0-d7c2281e9e8a","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"retries":"0","description":"","type":"DAG","uuid":"9e768951-fff2-4be4-9109-dd56e8e8685c","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"8d1a02c2-243c-48de-a969-45bc62891c09"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"8dc4b9b8-43b0-43ff-a029-2865efe1762c"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"8d1a02c2-243c-48de-a969-45bc62891c09"},"edge_type":"inherent","type":"","uuid":"08fba37f-6b14-49d4-bbee-e68b6a55b5fb","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"8dc4b9b8-43b0-43ff-a029-2865efe1762c"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_ee2b0f2f_ee60_48c4_b32c_da68ba12098c"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8d1a02c2-243c-48de-a969-45bc62891c09","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12105be2-ee67-451d-8054-4546855e277c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8dc4b9b8-43b0-43ff-a029-2865efe1762c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"62c6362d-e0ca-42f2-bbb0-5283c445eb98"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380"}],"description":"","message_list":[],"uuid":"d420ec55-02ac-487a-b752-8030c5a4b38b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_ee2b0f2f_ee60_48c4_b32c_da68ba12098c","uuid":"9e768951-fff2-4be4-9109-dd56e8e8685c"},"name":"SYS_GEN__Runbook_Deployment_ee2b0f2f_ee60_48c4_b32c_da68ba12098c"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"942278f5-8a00-482b-8a1f-cc82227df56c","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"retries":"0","description":"","type":"DAG","uuid":"1afa812f-f7d9-4dd2-abd8-27f283b4d10b","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"e2ed2483-58c0-47c3-812a-9a34d9bd05b9"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"e97eb01e-ecb7-4351-b5a5-f4d1ae426a8a"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"44efa1c4-dae4-4619-9295-1a2969e74f3d"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"b4f98195-c7dc-4475-b1c6-7afb19bc6f3c"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_ee2b0f2f_ee60_48c4_b32c_da68ba12098c","uuid":"68623ee5-d69d-4e12-8602-85ab7401ddff"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"e2ed2483-58c0-47c3-812a-9a34d9bd05b9"},"edge_type":"inherent","type":"","uuid":"9509a7ae-6e60-4211-a47f-a5657cedd95b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"e97eb01e-ecb7-4351-b5a5-f4d1ae426a8a"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"e97eb01e-ecb7-4351-b5a5-f4d1ae426a8a"},"edge_type":"inherent","type":"","uuid":"db867be1-d681-4259-8ae9-8b4690fa20b3","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"44efa1c4-dae4-4619-9295-1a2969e74f3d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"b4f98195-c7dc-4475-b1c6-7afb19bc6f3c"},"edge_type":"inherent","type":"","uuid":"3023fa31-4251-4e27-8d63-e8fde4514398","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_ee2b0f2f_ee60_48c4_b32c_da68ba12098c","uuid":"68623ee5-d69d-4e12-8602-85ab7401ddff"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"44efa1c4-dae4-4619-9295-1a2969e74f3d"},"edge_type":"inherent","type":"","uuid":"a1f43673-2605-4ff5-b35d-81018dbad81f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"b4f98195-c7dc-4475-b1c6-7afb19bc6f3c"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_ee2b0f2f_ee60_48c4_b32c_da68ba12098c"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e2ed2483-58c0-47c3-812a-9a34d9bd05b9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12105be2-ee67-451d-8054-4546855e277c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e97eb01e-ecb7-4351-b5a5-f4d1ae426a8a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"6b0fd64c-e97f-4968-998d-ff058e95d9e9"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"44efa1c4-dae4-4619-9295-1a2969e74f3d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"e1256869-0bcf-4716-b2e8-6a1bcb9847c2"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_e86d00bd_64a7_4363_884d_48ab6e49052a"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b4f98195-c7dc-4475-b1c6-7afb19bc6f3c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"f5d199f7-edb1-4ff1-b7e4-adc165c26e1d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"68623ee5-d69d-4e12-8602-85ab7401ddff","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_ee2b0f2f_ee60_48c4_b32c_da68ba12098c"}],"description":"","message_list":[],"uuid":"964d9aec-49c4-4af3-b3df-1ede8e68a4bb","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_ee2b0f2f_ee60_48c4_b32c_da68ba12098c","uuid":"1afa812f-f7d9-4dd2-abd8-27f283b4d10b"},"name":"SYS_GEN__Runbook_Deployment_ee2b0f2f_ee60_48c4_b32c_da68ba12098c"}},{"description":"System action for scaleout","message_list":[],"uuid":"7da5a505-24ca-439c-965c-a443eb3f1916","name":"action_scaleout","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"retries":"0","description":"","type":"DAG","uuid":"d86fc2f1-828c-447d-861d-a65d6b9e97b5","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scaleout_ee2b0f2f_ee60_48c4_b32c_da68ba12098c","uuid":"2d97acdc-8389-4401-be43-5da983f82df8"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_ee2b0f2f_ee60_48c4_b32c_da68ba12098c"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"retries":"0","description":"","type":"SCALING","uuid":"2d97acdc-8389-4401-be43-5da983f82df8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scaleout_ee2b0f2f_ee60_48c4_b32c_da68ba12098c"}],"description":"","message_list":[],"uuid":"6c0efebe-f0a0-4a6e-9eb8-bd46fc25a9f3","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"e97206e2-26dd-4ef0-8e5a-41c74fcf2e95","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_ee2b0f2f_ee60_48c4_b32c_da68ba12098c","uuid":"d86fc2f1-828c-447d-861d-a65d6b9e97b5"},"name":"SYS_GEN__Runbook_Deployment_ee2b0f2f_ee60_48c4_b32c_da68ba12098c"}},{"description":"System action for scalein","message_list":[],"uuid":"183a845a-2ffb-4040-9ca0-590136787d79","name":"action_scalein","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"retries":"0","description":"","type":"DAG","uuid":"0f1df6a5-0ddf-41c9-b842-081e7c3e0c37","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scalein_ee2b0f2f_ee60_48c4_b32c_da68ba12098c","uuid":"99c61b95-dc40-4096-b248-c3ec97787968"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_ee2b0f2f_ee60_48c4_b32c_da68ba12098c"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"retries":"0","description":"","type":"SCALING","uuid":"99c61b95-dc40-4096-b248-c3ec97787968","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scalein_ee2b0f2f_ee60_48c4_b32c_da68ba12098c"}],"description":"","message_list":[],"uuid":"bf3df45e-ae0a-4503-a286-3c56d3169224","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"c2cc861a-2a44-4695-98ea-a2eb80d65528","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_ee2b0f2f_ee60_48c4_b32c_da68ba12098c","uuid":"0f1df6a5-0ddf-41c9-b842-081e7c3e0c37"},"name":"SYS_GEN__Runbook_Deployment_ee2b0f2f_ee60_48c4_b32c_da68ba12098c"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"a2e06bcb-b277-40f9-81b3-a00bb4ce81ed","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"retries":"0","description":"","type":"DAG","uuid":"ec1c7807-9eae-45fd-a957-8ebfc458b3e4","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"27ded320-36f1-4def-8e27-c48e1f27a646"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"6d8e6ef3-cebe-4d03-b808-13db37fb6d19"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"1fdb9196-5594-4b2f-ab35-d6841b8c23b0"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_ee2b0f2f_ee60_48c4_b32c_da68ba12098c","uuid":"af702a4a-14cb-493f-af5f-721c1316448b"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"27ded320-36f1-4def-8e27-c48e1f27a646"},"edge_type":"inherent","type":"","uuid":"95d40c10-8eb8-45eb-981c-1b2a0473033c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"6d8e6ef3-cebe-4d03-b808-13db37fb6d19"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"1fdb9196-5594-4b2f-ab35-d6841b8c23b0"},"edge_type":"inherent","type":"","uuid":"88d24fa7-a739-47aa-9274-6580a5f39b06","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_ee2b0f2f_ee60_48c4_b32c_da68ba12098c","uuid":"af702a4a-14cb-493f-af5f-721c1316448b"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"6d8e6ef3-cebe-4d03-b808-13db37fb6d19"},"edge_type":"inherent","type":"","uuid":"bb3bd237-ddc7-4070-8b11-66a1cf833b52","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"1fdb9196-5594-4b2f-ab35-d6841b8c23b0"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_ee2b0f2f_ee60_48c4_b32c_da68ba12098c"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"27ded320-36f1-4def-8e27-c48e1f27a646","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"d44a642f-9468-432a-9b7e-e69a7c1c08e7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"6d8e6ef3-cebe-4d03-b808-13db37fb6d19","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_e86d00bd_64a7_4363_884d_48ab6e49052a"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1fdb9196-5594-4b2f-ab35-d6841b8c23b0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"340de4aa-b1bf-43d4-8e8a-3ed138af90f9"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"af702a4a-14cb-493f-af5f-721c1316448b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_ee2b0f2f_ee60_48c4_b32c_da68ba12098c"}],"description":"","message_list":[],"uuid":"44fbb89b-e866-4209-898d-bf894c8473ea","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_ee2b0f2f_ee60_48c4_b32c_da68ba12098c","uuid":"ec1c7807-9eae-45fd-a957-8ebfc458b3e4"},"name":"SYS_GEN__Runbook_Deployment_ee2b0f2f_ee60_48c4_b32c_da68ba12098c"}}],"message_list":[],"published_service_local_reference_list":[],"uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c","min_replicas":"3","state":"DRAFT","max_replicas":"9","depends_on_list":[],"editables":{"min_replicas":true,"max_replicas":true},"package_local_reference_list":[{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"}],"substrate_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"type":"GREENFIELD","options":{},"variable_list":[],"name":"77b729d5_deployment_cloned_1"}],"description":"","action_list":[{"description":"","message_list":[],"uuid":"644d9d5c-ed4c-4176-bb90-c1caf9bc25f0","name":"Upgrade","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"d2ae21ac-8095-49c4-a147-40dff0e2da6e","child_tasks_local_reference_list":[{"kind":"app_task","name":"Upgrade Minion","uuid":"aeba6135-5c91-4a34-83ab-314689e47b79"},{"kind":"app_task","name":"Upgrade Controller","uuid":"a3cdc977-cdeb-4826-9197-2070967960ed"},{"kind":"app_task","name":"Set Version Minion","uuid":"82624031-2cbc-40e5-8b63-bfb517f380c0"},{"kind":"app_task","name":"Restart Services","uuid":"61cf4fc8-5bed-4a67-b520-8125883eea87"},{"kind":"app_task","name":"Set Version Master","uuid":"05ae9a35-1127-45c7-aac2-12a4cc3e1caf"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Upgrade Controller","uuid":"a3cdc977-cdeb-4826-9197-2070967960ed"},"edge_type":"user_defined","type":"","uuid":"810c0501-da7d-4966-9fd4-9f01cec36288","to_task_reference":{"kind":"app_task","name":"Restart Services","uuid":"61cf4fc8-5bed-4a67-b520-8125883eea87"}},{"from_task_reference":{"kind":"app_task","name":"Restart Services","uuid":"61cf4fc8-5bed-4a67-b520-8125883eea87"},"edge_type":"user_defined","type":"","uuid":"6b750205-8115-4b38-8ce8-6fb93825ab26","to_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"05ae9a35-1127-45c7-aac2-12a4cc3e1caf"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"aeba6135-5c91-4a34-83ab-314689e47b79"},"edge_type":"user_defined","type":"","uuid":"5e35184b-c9ce-428f-a7bc-ab81a2146527","to_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"82624031-2cbc-40e5-8b63-bfb517f380c0"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"82624031-2cbc-40e5-8b63-bfb517f380c0"},"edge_type":"user_defined","type":"","uuid":"778766cc-5d22-44b0-b8bc-4fb19290e603","to_task_reference":{"kind":"app_task","name":"Restart Services","uuid":"61cf4fc8-5bed-4a67-b520-8125883eea87"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"cbdb4fa8_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"aeba6135-5c91-4a34-83ab-314689e47b79","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{KUBE_VERSION_NEW}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Upgrade Minion"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"a3cdc977-cdeb-4826-9197-2070967960ed","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{KUBE_VERSION_NEW}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nCONTROLLER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem  \n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Upgrade Controller"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"82624031-2cbc-40e5-8b63-bfb517f380c0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"if \"@@{calm_array_index}@@\" == \"0\":\n\tprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Version Minion"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"61cf4fc8-5bed-4a67-b520-8125883eea87","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_NAMES=\"@@{calm_array_name}@@\" \nMINION_NAMES=\"@@{Azure_Centos_K8SM.name}@@\" \nJSONPATH='{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}'\nKUBE_VERSION_NEW=\"@@{KUBE_VERSION_NEW}@@\"\nMASTER_API_HTTPS=6443\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION_NEW}\/bin\/linux\/amd64\/kubectl\nchmod +x kubectl\nsudo mv kubectl \/usr\/local\/bin\/kubectl\n\ncount=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n  echo \"Trying to reach master server https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} : sleep for 5 secs\"\n  sleep 10\n  if [[ $count -eq 10 ]]; then\n  \techo \"Unable to reach master server: https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\"\n  \texit 1\n  fi\n  count=$((count+1))\ndone\n\ncount=0\nfor name in $(echo \"${MINION_NAMES}\" | tr \",\" \"\\n\"); do\n  #kubectl drain ${name} --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no \"minion${count}\" \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 20\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=${name} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon ${name}\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n\techo \"Upgrade failed on minion nodes\"\n    exit 1\nfi\n\ncount=0\nfor name in $(echo \"${CONTROLLER_NAMES}\" | tr \",\" \"\\n\"); do\n  #kubectl drain $name --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no \"controller${count}\" \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 20\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=$name -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon $name\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n\techo \"Upgrade failed on nodes: $(kubectl get nodes -o jsonpath='$JSONPATH' | grep 'Ready=Unknown')\"\n    exit 1\nfi"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Restart Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"05ae9a35-1127-45c7-aac2-12a4cc3e1caf","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"exit_status":[],"script":"if \"@@{calm_array_index}@@\" == \"0\":\n\tprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Version Master"}],"description":"","message_list":[],"uuid":"faf1f9b1-726f-41c0-a90f-7ba3a647ef38","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"c5af32bf-ee5d-49f4-bbf9-b9a68a306245","value":"v1.8.14","label":"","state":"NOT_VALIDATED","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_VERSION_NEW"}],"main_task_local_reference":{"kind":"app_task","name":"cbdb4fa8_dag","uuid":"d2ae21ac-8095-49c4-a147-40dff0e2da6e"},"name":"8d003d32_runbook_cloned_1"}},{"description":"","message_list":[],"uuid":"75ca43f8-3fee-4ea9-9339-1c9c169d41db","name":"ScaleOut","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"5d00cf2e-e157-4e9a-bf74-aea62902c521","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Out","uuid":"f055c9d2-2414-4cb2-a653-d3a33e50cfa8"},{"kind":"app_task","name":"Set Hosts File","uuid":"a2f54fce-caad-4016-b7d7-e43a465c4cc7"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Scale Out","uuid":"f055c9d2-2414-4cb2-a653-d3a33e50cfa8"},"edge_type":"user_defined","type":"","uuid":"d0de8ee7-bbc0-4495-ba3c-42930e2dbdbe","to_task_reference":{"kind":"app_task","name":"Set Hosts File","uuid":"a2f54fce-caad-4016-b7d7-e43a465c4cc7"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"f3682593_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"retries":"0","description":"","type":"SCALING","uuid":"f055c9d2-2414-4cb2-a653-d3a33e50cfa8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Scale Out"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"a2f54fce-caad-4016-b7d7-e43a465c4cc7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMINION_IPS=\"@@{Azure_Centos_K8SM.private_ip_address}@@\"\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  if ! (( $(grep -c \"${ip} minion${count}\" \/etc\/hosts) )) ; then\n  \techo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  fi\n  count=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Hosts File"}],"description":"","message_list":[],"uuid":"c0554587-e50f-41cd-890e-029b263c0d7e","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"fa705096-83f3-4e42-a932-227a29b5b26a","value":"1","label":"","state":"NOT_VALIDATED","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"f3682593_dag","uuid":"5d00cf2e-e157-4e9a-bf74-aea62902c521"},"name":"744583cd_runbook_cloned_1"}},{"description":"","message_list":[],"uuid":"27c12472-6003-4c77-a0c3-72cf6f9608db","name":"ScaleIn","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"9a2036e4-2e70-491d-91ab-ba8c7bcc9952","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale In","uuid":"24967091-daf0-4555-b64e-3c2184412604"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"853cb860_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"retries":"0","description":"","type":"SCALING","uuid":"24967091-daf0-4555-b64e-3c2184412604","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Scale In"}],"description":"","message_list":[],"uuid":"27e66213-d97d-4cfb-a73b-68f7014eea82","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"b07e13fc-317e-4e4c-9776-304edfd14c13","value":"1","label":"","state":"NOT_VALIDATED","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"853cb860_dag","uuid":"9a2036e4-2e70-491d-91ab-ba8c7bcc9952"},"name":"9331a25f_runbook_cloned_1"}},{"description":"System action for creating an application","message_list":[],"uuid":"4838895f-262f-4434-91f3-ec8246c6d096","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Azure","uuid":"4589c966-0926-43a1-9cbe-2dbeabb98aa6"},"retries":"0","description":"","type":"DAG","uuid":"36e18695-06c3-4efd-98bf-b5844bed155c","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_ee2b0f2f_ee60_48c4_b32c_da68ba12098c","uuid":"f26a90d8-0c4f-4612-932c-6ece88eaf9d5"},{"kind":"app_task","name":"SYS_GEN__DE_Provision_5d33c234_98e6_44ef_97c8_83771613cb91","uuid":"04059d7d-029c-4b63-b483-df43daf074b5"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"1ccabc7c-b3d0-425d-b987-f0c3091be9ef"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"a1e9c2e9-12b0-408d-8c2b-918f860f16de"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"fb93a81c-fa9c-44ea-8ec6-cd49eb073f07"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"82388f3e-c9f0-47dc-9f62-c062a5631275"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"13117eca-509f-46ff-b39f-8791cb94b0de"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"ee9ba779-4e74-4660-8979-2cab47556dad"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"70d01bd2-2ca4-4c6f-ab7a-f36636a4ec6b"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"4942d73e-7c5f-421c-8c6b-dbb65bc2f07d"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"ee9ba779-4e74-4660-8979-2cab47556dad"},"edge_type":"inherent","type":"","uuid":"c87c5817-38fc-4aa7-b50c-048933d032bd","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"70d01bd2-2ca4-4c6f-ab7a-f36636a4ec6b"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"fb93a81c-fa9c-44ea-8ec6-cd49eb073f07"},"edge_type":"inherent","type":"","uuid":"ef9ec1ee-dadc-427c-b3b1-6443e6be26c3","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"ee9ba779-4e74-4660-8979-2cab47556dad"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_5d33c234_98e6_44ef_97c8_83771613cb91","uuid":"04059d7d-029c-4b63-b483-df43daf074b5"},"edge_type":"inherent","type":"","uuid":"301be2e4-4013-4a90-9cd7-36f6da93e3a8","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"a1e9c2e9-12b0-408d-8c2b-918f860f16de"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"a1e9c2e9-12b0-408d-8c2b-918f860f16de"},"edge_type":"inherent","type":"","uuid":"2786dbba-1c2a-4a7d-97f0-0d12e15609d0","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"fb93a81c-fa9c-44ea-8ec6-cd49eb073f07"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"13117eca-509f-46ff-b39f-8791cb94b0de"},"edge_type":"inherent","type":"","uuid":"71cb6e2d-d0dd-4dd5-b821-7ae1a052bb7f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"4942d73e-7c5f-421c-8c6b-dbb65bc2f07d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"82388f3e-c9f0-47dc-9f62-c062a5631275"},"edge_type":"inherent","type":"","uuid":"0c5cf7fb-7275-4529-810e-d01490bcf9a7","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"13117eca-509f-46ff-b39f-8791cb94b0de"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_ee2b0f2f_ee60_48c4_b32c_da68ba12098c","uuid":"f26a90d8-0c4f-4612-932c-6ece88eaf9d5"},"edge_type":"inherent","type":"","uuid":"527de217-fab7-4e2a-a589-d1089861970f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"1ccabc7c-b3d0-425d-b987-f0c3091be9ef"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"1ccabc7c-b3d0-425d-b987-f0c3091be9ef"},"edge_type":"inherent","type":"","uuid":"50aa71aa-2fbd-427f-9c30-13e2dbf8c0e3","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"82388f3e-c9f0-47dc-9f62-c062a5631275"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"1ccabc7c-b3d0-425d-b987-f0c3091be9ef"},"edge_type":"dependency","type":"","uuid":"6b83a39a-e508-417c-a5d8-97d60cbce4be","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"fb93a81c-fa9c-44ea-8ec6-cd49eb073f07"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"a1e9c2e9-12b0-408d-8c2b-918f860f16de"},"edge_type":"dependency","type":"","uuid":"08f0ff77-f97f-468e-9b17-ab7cb3ee9d9a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"82388f3e-c9f0-47dc-9f62-c062a5631275"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_4589c966_0926_43a1_9cbe_2dbeabb98aa6"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"f26a90d8-0c4f-4612-932c-6ece88eaf9d5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_ee2b0f2f_ee60_48c4_b32c_da68ba12098c"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"04059d7d-029c-4b63-b483-df43daf074b5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_5d33c234_98e6_44ef_97c8_83771613cb91"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1ccabc7c-b3d0-425d-b987-f0c3091be9ef","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"559e173f-784d-4416-bffd-385d336ac054"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a1e9c2e9-12b0-408d-8c2b-918f860f16de","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"ab8b18aa-5c5d-4fdf-af20-5d8518c51208"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"fb93a81c-fa9c-44ea-8ec6-cd49eb073f07","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"757c2a82-bf84-4b6f-8b71-b8d446b3208e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"82388f3e-c9f0-47dc-9f62-c062a5631275","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"9b1bbd75-4d96-4806-a502-1e516f33961c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_e86d00bd_64a7_4363_884d_48ab6e49052a"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"13117eca-509f-46ff-b39f-8791cb94b0de","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"cabcfd41-35e6-45f0-a791-00daf17de059"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ee9ba779-4e74-4660-8979-2cab47556dad","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"aa8dd27e-4bd1-4b85-86c6-750c0a49579f"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"70d01bd2-2ca4-4c6f-ab7a-f36636a4ec6b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"64e5991c-fbcd-4d1f-8b72-4b4956e9702e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4942d73e-7c5f-421c-8c6b-dbb65bc2f07d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"91f453c1-d2fc-47b1-93d4-4b49476235be"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"4592c7ba-6719-4754-bf7c-9b808060e864","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_4589c966_0926_43a1_9cbe_2dbeabb98aa6","uuid":"36e18695-06c3-4efd-98bf-b5844bed155c"},"name":"SYS_GEN__Runbook_Application_4589c966_0926_43a1_9cbe_2dbeabb98aa6"}},{"description":"System action for starting an application","message_list":[],"uuid":"3245fcb5-0153-445b-85b6-5277384e32d7","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Azure","uuid":"4589c966-0926-43a1-9cbe-2dbeabb98aa6"},"retries":"0","description":"","type":"DAG","uuid":"c2e95097-30ea-48ef-98f9-8121a2f4fce4","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"73036ca9-a301-4f44-a43a-7dc91f81c663"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"87873469-992c-4981-8e7e-b18ce2605331"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"aaed0493-5bc2-4ef8-8f65-e68911c8d5b1"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"0d6ae7b4-f87e-447f-8e3c-164263bf0eea"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"87873469-992c-4981-8e7e-b18ce2605331"},"edge_type":"inherent","type":"","uuid":"ae9e1cb6-72f8-4fa1-80dc-28143a8767c5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"aaed0493-5bc2-4ef8-8f65-e68911c8d5b1"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"73036ca9-a301-4f44-a43a-7dc91f81c663"},"edge_type":"inherent","type":"","uuid":"82713cd2-0388-4f32-a390-bd50609aaef4","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"0d6ae7b4-f87e-447f-8e3c-164263bf0eea"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_4589c966_0926_43a1_9cbe_2dbeabb98aa6"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"73036ca9-a301-4f44-a43a-7dc91f81c663","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"59d69a24-d569-4d64-9def-9d16a3593d6e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"87873469-992c-4981-8e7e-b18ce2605331","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"e4bc2b12-cac9-4f26-8469-1f583923f11c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"aaed0493-5bc2-4ef8-8f65-e68911c8d5b1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"64e5991c-fbcd-4d1f-8b72-4b4956e9702e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0d6ae7b4-f87e-447f-8e3c-164263bf0eea","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"91f453c1-d2fc-47b1-93d4-4b49476235be"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"f6bd71ee-2a8b-4445-8cde-ab032ba75ab3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_4589c966_0926_43a1_9cbe_2dbeabb98aa6","uuid":"c2e95097-30ea-48ef-98f9-8121a2f4fce4"},"name":"SYS_GEN__Runbook_Application_4589c966_0926_43a1_9cbe_2dbeabb98aa6"}},{"description":"System action for restarting an application","message_list":[],"uuid":"adac7aba-ccf8-4bc2-a5ec-b8f329f4a2aa","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Azure","uuid":"4589c966-0926-43a1-9cbe-2dbeabb98aa6"},"retries":"0","description":"","type":"DAG","uuid":"c7831970-b61f-4830-a5f9-e730f96a3cf7","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"9d92af4b-2272-4fe6-b2a0-3b2509d16c8e"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"a511a373-50d8-44ff-ab88-b6f9fcb47105"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"b6df505a-215f-4b84-b93d-1e2137830eec"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"e0291cb5-c83b-4277-9a43-e199b0453d5e"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"a511a373-50d8-44ff-ab88-b6f9fcb47105"},"edge_type":"inherent","type":"","uuid":"022f4496-8720-4c44-b68a-9097e5395e01","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"e0291cb5-c83b-4277-9a43-e199b0453d5e"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"9d92af4b-2272-4fe6-b2a0-3b2509d16c8e"},"edge_type":"inherent","type":"","uuid":"4356e38d-9223-4d6b-b95d-fecb0ade80d7","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"b6df505a-215f-4b84-b93d-1e2137830eec"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_4589c966_0926_43a1_9cbe_2dbeabb98aa6"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"9d92af4b-2272-4fe6-b2a0-3b2509d16c8e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"52365d7c-8b63-477b-bbbd-285320567682"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a511a373-50d8-44ff-ab88-b6f9fcb47105","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"c04252fb-c52d-4e8e-a2ce-b575118ef155"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b6df505a-215f-4b84-b93d-1e2137830eec","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"3fd75c09-a79f-4731-98fc-b65b96bc9fe7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e0291cb5-c83b-4277-9a43-e199b0453d5e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"526cc0d4-3d9e-49c6-840b-f42e056f5d89"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"046d15c8-be4f-49ae-92b5-587cbe7f862e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_4589c966_0926_43a1_9cbe_2dbeabb98aa6","uuid":"c7831970-b61f-4830-a5f9-e730f96a3cf7"},"name":"SYS_GEN__Runbook_Application_4589c966_0926_43a1_9cbe_2dbeabb98aa6"}},{"description":"System action for stopping an application","message_list":[],"uuid":"4987e9c0-0fd4-465b-af28-016c7a19b04d","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Azure","uuid":"4589c966-0926-43a1-9cbe-2dbeabb98aa6"},"retries":"0","description":"","type":"DAG","uuid":"a5ca5422-4d2f-4828-972b-e889c503642e","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"9cab4422-8ff9-48de-9285-a7afaa1be86a"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"8ee268e5-2843-4a46-8d85-df647f37d6c0"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"0dcfc726-5cd6-42dd-b45f-dfb966de2b60"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"1aabe2e6-ced6-4125-9436-9df8252b22b8"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"9cab4422-8ff9-48de-9285-a7afaa1be86a"},"edge_type":"inherent","type":"","uuid":"ec748410-3058-4118-b26b-b1683686594f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"1aabe2e6-ced6-4125-9436-9df8252b22b8"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"8ee268e5-2843-4a46-8d85-df647f37d6c0"},"edge_type":"inherent","type":"","uuid":"a9fac188-3fe7-43fa-8606-db40a55042d3","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"0dcfc726-5cd6-42dd-b45f-dfb966de2b60"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_4589c966_0926_43a1_9cbe_2dbeabb98aa6"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"9cab4422-8ff9-48de-9285-a7afaa1be86a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"1fdd3541-2eca-471a-a4be-4ef82887d4de"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8ee268e5-2843-4a46-8d85-df647f37d6c0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12105be2-ee67-451d-8054-4546855e277c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0dcfc726-5cd6-42dd-b45f-dfb966de2b60","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"62c6362d-e0ca-42f2-bbb0-5283c445eb98"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1aabe2e6-ced6-4125-9436-9df8252b22b8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"c893037e-bcd3-4b89-93d2-c25cfa602f13"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696"}],"description":"","message_list":[],"uuid":"5a97ef43-9cab-4e01-b971-b67bd5cd5892","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_4589c966_0926_43a1_9cbe_2dbeabb98aa6","uuid":"a5ca5422-4d2f-4828-972b-e889c503642e"},"name":"SYS_GEN__Runbook_Application_4589c966_0926_43a1_9cbe_2dbeabb98aa6"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"9d7d3f9b-c07c-46b8-bbef-051b29816c8a","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Azure","uuid":"4589c966-0926-43a1-9cbe-2dbeabb98aa6"},"retries":"0","description":"","type":"DAG","uuid":"1e9ef1f6-7c91-40f0-a650-f620d8693876","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"e8816c21-66d4-417a-a0fa-e790a3a158da"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"c2aa15b3-f4a6-4a9a-b4af-6768390aacfc"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"91190d81-a538-48a4-9f49-d2ec7fa19b08"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"0c01960b-c17d-42dc-8205-d3448b971f72"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"4b3078e5-bcd6-4789-a8aa-05503f6b4d94"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"63c4eaa8-2f0e-47f7-a545-168e86a87120"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"b158e549-2c73-4bc5-9261-79e27bb7ece0"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"023524c7-da33-462e-b937-8ce2ce7e58da"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_ee2b0f2f_ee60_48c4_b32c_da68ba12098c","uuid":"f989e035-2e02-4996-930c-0cc0ec7b0dc8"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_5d33c234_98e6_44ef_97c8_83771613cb91","uuid":"0b686aef-eadd-4c33-b0b2-717f1cec6396"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"e8816c21-66d4-417a-a0fa-e790a3a158da"},"edge_type":"inherent","type":"","uuid":"866f29ec-c99d-4302-96fa-a34fd5d70904","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"0c01960b-c17d-42dc-8205-d3448b971f72"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"0c01960b-c17d-42dc-8205-d3448b971f72"},"edge_type":"inherent","type":"","uuid":"43f9eeb0-ac70-4903-b88b-3489e1eeac48","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"4b3078e5-bcd6-4789-a8aa-05503f6b4d94"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"4b3078e5-bcd6-4789-a8aa-05503f6b4d94"},"edge_type":"inherent","type":"","uuid":"b7bc6b85-ec60-47d6-aad4-49244d1fc123","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"b158e549-2c73-4bc5-9261-79e27bb7ece0"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"b158e549-2c73-4bc5-9261-79e27bb7ece0"},"edge_type":"inherent","type":"","uuid":"3d99ed87-dced-4b32-b297-46ffe0fc76de","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_5d33c234_98e6_44ef_97c8_83771613cb91","uuid":"0b686aef-eadd-4c33-b0b2-717f1cec6396"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"c2aa15b3-f4a6-4a9a-b4af-6768390aacfc"},"edge_type":"inherent","type":"","uuid":"9e09f1c1-4dfb-45cf-9a26-2c0d7cb5b591","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"91190d81-a538-48a4-9f49-d2ec7fa19b08"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"91190d81-a538-48a4-9f49-d2ec7fa19b08"},"edge_type":"inherent","type":"","uuid":"cb40d2ef-8b67-442a-955a-3e894a82647e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"63c4eaa8-2f0e-47f7-a545-168e86a87120"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"023524c7-da33-462e-b937-8ce2ce7e58da"},"edge_type":"inherent","type":"","uuid":"ded3f902-31ce-41a8-8d16-a0f2be92f8fa","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_ee2b0f2f_ee60_48c4_b32c_da68ba12098c","uuid":"f989e035-2e02-4996-930c-0cc0ec7b0dc8"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"63c4eaa8-2f0e-47f7-a545-168e86a87120"},"edge_type":"inherent","type":"","uuid":"2ca9cbc3-5821-4eb9-b349-4186531c29dc","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"023524c7-da33-462e-b937-8ce2ce7e58da"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"4b3078e5-bcd6-4789-a8aa-05503f6b4d94"},"edge_type":"create_action_edge","type":"","uuid":"40f4d0a4-6e9c-4993-864a-7c3bfc68ef37","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"023524c7-da33-462e-b937-8ce2ce7e58da"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"63c4eaa8-2f0e-47f7-a545-168e86a87120"},"edge_type":"create_action_edge","type":"","uuid":"34b05684-811c-42c0-a662-4a9b21005e32","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"b158e549-2c73-4bc5-9261-79e27bb7ece0"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"0c01960b-c17d-42dc-8205-d3448b971f72"},"edge_type":"dependency","type":"","uuid":"01e02cc1-4842-497a-8660-d4f35b6c3441","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"63c4eaa8-2f0e-47f7-a545-168e86a87120"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_4589c966_0926_43a1_9cbe_2dbeabb98aa6"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e8816c21-66d4-417a-a0fa-e790a3a158da","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"1fdd3541-2eca-471a-a4be-4ef82887d4de"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c2aa15b3-f4a6-4a9a-b4af-6768390aacfc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12105be2-ee67-451d-8054-4546855e277c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"91190d81-a538-48a4-9f49-d2ec7fa19b08","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"6b0fd64c-e97f-4968-998d-ff058e95d9e9"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0c01960b-c17d-42dc-8205-d3448b971f72","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"a2ac512f-d272-4905-bafb-4733f7e58c9b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4b3078e5-bcd6-4789-a8aa-05503f6b4d94","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"8ae59bad-2465-469a-85c0-4697785f6418"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"63c4eaa8-2f0e-47f7-a545-168e86a87120","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"e1256869-0bcf-4716-b2e8-6a1bcb9847c2"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_e86d00bd_64a7_4363_884d_48ab6e49052a"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b158e549-2c73-4bc5-9261-79e27bb7ece0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"ff697210-af55-4a6f-a695-115768d31ce4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"023524c7-da33-462e-b937-8ce2ce7e58da","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"f5d199f7-edb1-4ff1-b7e4-adc165c26e1d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"f989e035-2e02-4996-930c-0cc0ec7b0dc8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_ee2b0f2f_ee60_48c4_b32c_da68ba12098c"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"0b686aef-eadd-4c33-b0b2-717f1cec6396","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_5d33c234_98e6_44ef_97c8_83771613cb91"}],"description":"","message_list":[],"uuid":"8943cbf4-cd32-4926-9acd-264939ca9d3a","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_4589c966_0926_43a1_9cbe_2dbeabb98aa6","uuid":"1e9ef1f6-7c91-40f0-a650-f620d8693876"},"name":"SYS_GEN__Runbook_Application_4589c966_0926_43a1_9cbe_2dbeabb98aa6"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"661a9b58-0a07-4072-8747-bffc855a9ad5","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Azure","uuid":"4589c966-0926-43a1-9cbe-2dbeabb98aa6"},"retries":"0","description":"","type":"DAG","uuid":"5819a044-2655-4061-9265-3a916a5ce5e4","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"dc4be80c-bb0c-4862-8143-f9435eb26082"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"c04be1cf-7583-4644-83c3-0bf6c7aeecdf"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"9959ebce-297f-4a38-9ecc-ac238043d3c0"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"c76d1850-2d2d-4fb6-b138-838afa0b16d0"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"a8d503ee-2b8f-4b07-bbe9-9ade87b5e340"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"61212d37-1aa7-4412-857e-e1d1cb9b51ad"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_5d33c234_98e6_44ef_97c8_83771613cb91","uuid":"2eae33ef-ce20-4cba-8373-da93bcfce56d"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_ee2b0f2f_ee60_48c4_b32c_da68ba12098c","uuid":"b944ccf0-ca0e-4a51-bff4-7c99535f2fdc"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"dc4be80c-bb0c-4862-8143-f9435eb26082"},"edge_type":"inherent","type":"","uuid":"20dd0870-11b3-41bc-bea2-1da0e0246fa2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"9959ebce-297f-4a38-9ecc-ac238043d3c0"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"61212d37-1aa7-4412-857e-e1d1cb9b51ad"},"edge_type":"inherent","type":"","uuid":"81198dfc-160f-42e2-920d-d4008a88fce3","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_5d33c234_98e6_44ef_97c8_83771613cb91","uuid":"2eae33ef-ce20-4cba-8373-da93bcfce56d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"9959ebce-297f-4a38-9ecc-ac238043d3c0"},"edge_type":"inherent","type":"","uuid":"75c75947-4763-4f64-8127-ecd3b281cca4","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"61212d37-1aa7-4412-857e-e1d1cb9b51ad"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"c04be1cf-7583-4644-83c3-0bf6c7aeecdf"},"edge_type":"inherent","type":"","uuid":"f2f657db-7c9a-4994-8927-c938ef5f8908","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"c76d1850-2d2d-4fb6-b138-838afa0b16d0"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"a8d503ee-2b8f-4b07-bbe9-9ade87b5e340"},"edge_type":"inherent","type":"","uuid":"e620c7ea-53d5-4913-83bf-a25e074401fe","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_ee2b0f2f_ee60_48c4_b32c_da68ba12098c","uuid":"b944ccf0-ca0e-4a51-bff4-7c99535f2fdc"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"c76d1850-2d2d-4fb6-b138-838afa0b16d0"},"edge_type":"inherent","type":"","uuid":"4dfb726c-8865-4520-af3d-8e4ebfac79bf","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"a8d503ee-2b8f-4b07-bbe9-9ade87b5e340"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"9959ebce-297f-4a38-9ecc-ac238043d3c0"},"edge_type":"create_action_edge","type":"","uuid":"4df038a7-9b69-4d3f-a031-a5694cf62bac","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"a8d503ee-2b8f-4b07-bbe9-9ade87b5e340"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"c76d1850-2d2d-4fb6-b138-838afa0b16d0"},"edge_type":"create_action_edge","type":"","uuid":"ba849108-c7fa-4f6d-b7b2-61608a0b4ea3","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"61212d37-1aa7-4412-857e-e1d1cb9b51ad"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_4589c966_0926_43a1_9cbe_2dbeabb98aa6"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"dc4be80c-bb0c-4862-8143-f9435eb26082","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"50a769a7-5b0a-4546-9e12-4f0a3ceff21b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c04be1cf-7583-4644-83c3-0bf6c7aeecdf","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"d44a642f-9468-432a-9b7e-e69a7c1c08e7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"9959ebce-297f-4a38-9ecc-ac238043d3c0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"c76d1850-2d2d-4fb6-b138-838afa0b16d0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_e86d00bd_64a7_4363_884d_48ab6e49052a"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a8d503ee-2b8f-4b07-bbe9-9ade87b5e340","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380","uuid":"340de4aa-b1bf-43d4-8e8a-3ed138af90f9"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_85f444bf_ac07_4e13_a199_1e98a4019380"},{"target_any_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"61212d37-1aa7-4412-857e-e1d1cb9b51ad","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696","uuid":"cb24613d-b9bb-4fc9-ad8a-98a1f1f2c77a"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_2eaf885a_749d_4746_9a1a_b532a461b696"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"34875daf_deployment_cloned_1","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"2eae33ef-ce20-4cba-8373-da93bcfce56d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_5d33c234_98e6_44ef_97c8_83771613cb91"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"b944ccf0-ca0e-4a51-bff4-7c99535f2fdc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_ee2b0f2f_ee60_48c4_b32c_da68ba12098c"}],"description":"","message_list":[],"uuid":"2a559edf-9356-4e6e-a978-48bdbee4e614","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_4589c966_0926_43a1_9cbe_2dbeabb98aa6","uuid":"5819a044-2655-4061-9265-3a916a5ce5e4"},"name":"SYS_GEN__Runbook_Application_4589c966_0926_43a1_9cbe_2dbeabb98aa6"}}],"message_list":[],"uuid":"4589c966-0926-43a1-9cbe-2dbeabb98aa6","state":"DRAFT","dependency_list":[{"getter_resource_kind":"PackageCfg","setter_resource_attr":"private_ip_address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"Azure_Centos_K8SM","action_name":"action_create","action_resource_name":"Azure","getter_resource_name":"Azure_Centos_K8SC_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"public_ip_address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"Azure_Centos_K8SM","action_name":"action_create","action_resource_name":"Azure","getter_resource_name":"Azure_Centos_K8SC_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"private_ip_address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"Azure_Centos_K8SC","action_name":"action_create","action_resource_name":"Azure","getter_resource_name":"Azure_Centos_K8SM_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"address","setter_resource_kind":"ServiceCfg","setter_resource_name":"Kubernetes_Master","action_name":"action_delete","action_resource_name":"Azure","getter_resource_name":"Azure_Centos_K8SM_Package","action_resource_kind":"ApplicationCfg"}],"variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"44b39037-4cff-4f0d-adc9-f445f9f9ce88","value":"kube-calm","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_CLUSTER_NAME"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"86616546-a630-4024-b8f8-e84dd4edd1d3","value":"v1.8.0","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_VERSION"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"43d009f3-3c1a-4cb9-ba7a-33532a4c9f26","value":"17.03.2.ce","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"DOCKER_VERSION"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"8853e625-8542-48f5-8e0d-fc1254577bb4","value":"10.200.0.0\/16","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_CLUSTER_SUBNET"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"3a1a9a60-d192-48c3-a5e1-6ac7d94462c3","value":"10.32.0.0\/24","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_SERVICE_SUBNET"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"8e5aad2c-cf33-455e-8991-5b27416b43ea","value":"10.32.0.10","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_DNS_IP"}],"name":"Azure"}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"CENTOS","uuid":"5314d554-0539-406b-95eb-faa834a6ef81"},"package_definition_list":[{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"8d1b2917-7f04-492b-a8c1-c04b657d85fb","name":"action_install","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"},"retries":"0","description":"","type":"DAG","uuid":"f0c2216c-333c-4896-ae81-cf50106e7976","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Install_Crb_56b66f14_39cc_4320_8394_17636712b055","uuid":"e67a1eb5-2ab2-47b9-aa8d-6a53a3773144"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_56b66f14_39cc_4320_8394_17636712b055"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_INSTALL","uuid":"e67a1eb5-2ab2-47b9-aa8d-6a53a3773144","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"},"retries":"0","description":"","type":"DAG","uuid":"24728f88-9810-4a3a-bf32-152349daf2ae","child_tasks_local_reference_list":[{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"b96d647b-7e55-4644-83d0-0e4d13bcfd64"},{"kind":"app_task","name":"Generate Certs","uuid":"9480345e-e748-4f3e-8044-4d72c6b82d7f"},{"kind":"app_task","name":"Configure Services","uuid":"7d270afd-0766-4d67-8693-db21adfd0084"},{"kind":"app_task","name":"Add User Roles","uuid":"8caec318-837b-4d11-a314-60c346b6932e"},{"kind":"app_task","name":"Network Configuration","uuid":"f57f0155-8057-4b75-8a74-03b15db1f9c9"},{"kind":"app_task","name":"DNS Configuration","uuid":"d455e23b-8dab-41b8-b54b-a754460064d8"},{"kind":"app_task","name":"NVP Configuration","uuid":"1e3aa1a2-a871-4dca-bcfd-eb3f1915d790"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"b96d647b-7e55-4644-83d0-0e4d13bcfd64"},"edge_type":"user_defined","type":"","uuid":"a1442b85-e6aa-4c6f-93aa-2c7b2a7103d9","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"9480345e-e748-4f3e-8044-4d72c6b82d7f"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"9480345e-e748-4f3e-8044-4d72c6b82d7f"},"edge_type":"user_defined","type":"","uuid":"e21b5be5-1f0a-464e-bff6-37a541f1dac7","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"7d270afd-0766-4d67-8693-db21adfd0084"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"7d270afd-0766-4d67-8693-db21adfd0084"},"edge_type":"user_defined","type":"","uuid":"af014c47-e9d0-406f-ae3f-a32cde0179c5","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"8caec318-837b-4d11-a314-60c346b6932e"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"8caec318-837b-4d11-a314-60c346b6932e"},"edge_type":"user_defined","type":"","uuid":"c480aad0-021c-4d79-a570-d83da0165fa1","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"f57f0155-8057-4b75-8a74-03b15db1f9c9"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"f57f0155-8057-4b75-8a74-03b15db1f9c9"},"edge_type":"user_defined","type":"","uuid":"903d6c0b-2579-4ebf-9e00-d108fb6b8baa","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"d455e23b-8dab-41b8-b54b-a754460064d8"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"d455e23b-8dab-41b8-b54b-a754460064d8"},"edge_type":"user_defined","type":"","uuid":"196a0efd-8baf-4171-8fd4-f279c00d5ae7","to_task_reference":{"kind":"app_task","name":"NVP Configuration","uuid":"1e3aa1a2-a871-4dca-bcfd-eb3f1915d790"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"dac441af_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"b96d647b-7e55-4644-83d0-0e4d13bcfd64","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nMINION_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} controller${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"controller${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')    \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate etcd \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/sd{e,f,g}\nsudo vgcreate docker \/dev\/sd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"9480345e-e748-4f3e-8044-4d72c6b82d7f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nMINION_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\n\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_NAMES},${CONTROLLER_IPS},${MINION_NAMES},${MINION_IPS},${FIRST_IP_SERVICE_SUBNET},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local -profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\ninstance=\"controller${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=controller${count}.kubeconfig\nkubectl config set-credentials system:node:controller${count} --client-certificate=controller${count}.pem --client-key=controller${count}-key.pem --embed-certs=true --kubeconfig=controller${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:controller${count} --kubeconfig=controller${count}.kubeconfig\nkubectl config use-context default --kubeconfig=controller${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"controller${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"7d270afd-0766-4d67-8693-db21adfd0084","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nCONTROLLER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,AlwaysPullImages,DenyEscalatingExec,SecurityContextDeny,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n    \necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"8caec318-837b-4d11-a314-60c346b6932e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet iscsid\nsudo systemctl enable etcd docker kubelet iscsid\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem controller* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"f57f0155-8057-4b75-8a74-03b15db1f9c9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - \/etc\/kube-flannel\/cni-conf.json\n        - \/etc\/cni\/net.d\/10-flannel.conf\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"d455e23b-8dab-41b8-b54b-a754460064d8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n    - name: dns\n      port: 53\n      protocol: UDP\n    - name: dns-tcp\n      port: 53\n      protocol: TCP\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: gcr.io\/google_containers\/k8s-dns-kube-dns-amd64:1.14.10\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: gcr.io\/google_containers\/k8s-dns-dnsmasq-nanny-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: gcr.io\/google_containers\/k8s-dns-sidecar-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local.,5,A\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local.,5,A\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy:\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n# Remove the configmaps rule once below issue is fixed:\n# kubernetes-incubator\/cluster-proportional-autoscaler#16\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.1.2-r2\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          # Should keep target in sync with cluster\/addons\/dns\/kube-dns.yaml.base\n          - --target=Deployment\/kube-dns\n          # When cluster is using large nodes(with more cores), \"coresPerReplica\" should dominate.\n          # If using small nodes, \"nodesPerReplica\" should dominate.\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"1e3aa1a2-a871-4dca-bcfd-eb3f1915d790","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nPRISM_CLUSTER_IP=\"@@{PE_CLUSTER_IP}@@\"\nPRISM_DATA_SERVICE_IP=\"@@{PE_CLUSTER_IP}@@\"\n\nif [[ (\"${PRISM_CLUSTER_IP}x\" == \"x\") && (\"${PRISM_DATA_SERVICE_IP}x\" == \"x\") ]]; then exit 0; fi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/volume_plugin\nNTNX_SECRET=$(echo -n \"@@{PE_USERNAME}@@:@@{PE_PASSWORD}@@\" | base64)\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: nutanixabs-provisioner-runner\n  namespace: kube-system\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumes\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumeclaims\"]\n    verbs: [\"get\", \"list\", \"watch\", \"update\"]\n  - apiGroups: [\"storage.k8s.io\"]\n    resources: [\"storageclasses\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"list\", \"watch\", \"create\", \"update\", \"patch\"]\n  - apiGroups: [\"\"]\n    resources: [\"services\"]\n    verbs: [\"get\"]\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"create\", \"delete\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: run-nutanixabs-provisioner\n  namespace: kube-system\nsubjects:\n  - kind: ServiceAccount\n    name: nutanixabs-provisioner\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: nutanixabs-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      labels:\n        app: nutanixabs-provisioner\n    spec:\n      serviceAccount: nutanixabs-provisioner\n      hostNetwork: true\n      containers:\n        -\n          image: \"ntnx\/nutanixabs-provisioner\"\n          name: nutanixabs-provisioner\n          args: [\"--v=4\"]\n          imagePullPolicy: IfNotPresent\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: kube-system\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\n---\nkind: StorageClass\napiVersion: storage.k8s.io\/v1\nmetadata:\n  name: silver \n  namespace: kube-system\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\nprovisioner: nutanix\/abs\nparameters:\n     prismEndPoint: @@{PE_CLUSTER_IP}@@:9440\n     dataServiceEndPoint: @@{PE_DATA_SERVICE_IP}@@:3260\n     secretName: ntnx-secret\n     storageContainer: @@{PE_CONTAINER_NAME}@@\n     fsType: ext4\n     chapAuthEnabled: \"false\"' | sudo tee \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\necho \"apiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: default\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\" | sudo tee -a \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"NVP Configuration"}],"description":"","message_list":[],"uuid":"ce8ba4ab-4797-40b3-8056-9ec1e7ae7ecd","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"dac441af_dag","uuid":"24728f88-9810-4a3a-bf32-152349daf2ae"},"name":"8e760b73_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"},"retries":"0","description":"","type":"DAG","uuid":"a15b3681-909e-4a44-b1dc-d59d7ab55280","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6324786a_dag"}],"description":"","message_list":[],"uuid":"3247fc69-ecee-4f14-98e0-99d03534ee35","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6324786a_dag","uuid":"a15b3681-909e-4a44-b1dc-d59d7ab55280"},"name":"6522ac7a_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Install_Crb_56b66f14_39cc_4320_8394_17636712b055"}],"description":"","message_list":[],"uuid":"8eda840d-20b1-4ce1-8d3d-7da38a9aee82","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"f0c2216c-333c-4896-ae81-cf50106e7976"},"name":"SYS_GEN__Runbook_Package_56b66f14_39cc_4320_8394_17636712b055"}},{"description":"System action for creating an application","message_list":[],"uuid":"86e0b5d7-84ea-440d-ad0f-b35165393843","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"},"retries":"0","description":"","type":"DAG","uuid":"fa9da170-a78d-4d74-85a8-6c8681254610","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"805c4b88-9d78-4175-a82e-7d5c557207d0"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"bd0079e0-8a76-4015-9aee-346209cac003"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"210607f3-5ec8-417b-ab2c-f0d5e71dac88"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"bd0079e0-8a76-4015-9aee-346209cac003"},"edge_type":"inherent","type":"","uuid":"7c81023d-baa8-4838-895d-67c4fd652be7","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"210607f3-5ec8-417b-ab2c-f0d5e71dac88"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"805c4b88-9d78-4175-a82e-7d5c557207d0"},"edge_type":"inherent","type":"","uuid":"44cf0627-bd13-497c-a4ad-27df407c6e14","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"bd0079e0-8a76-4015-9aee-346209cac003"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_56b66f14_39cc_4320_8394_17636712b055"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"805c4b88-9d78-4175-a82e-7d5c557207d0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"8eda840d-20b1-4ce1-8d3d-7da38a9aee82"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_56b66f14_39cc_4320_8394_17636712b055"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"bd0079e0-8a76-4015-9aee-346209cac003","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"aa8dd27e-4bd1-4b85-86c6-750c0a49579f"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"210607f3-5ec8-417b-ab2c-f0d5e71dac88","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"64e5991c-fbcd-4d1f-8b72-4b4956e9702e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"a9816b1a-798e-4bf0-94f8-0af823bd4271","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"fa9da170-a78d-4d74-85a8-6c8681254610"},"name":"SYS_GEN__Runbook_Package_56b66f14_39cc_4320_8394_17636712b055"}},{"description":"System action for uninstalling an application","message_list":[],"uuid":"607ca1ff-1d27-446b-aa31-d0ef3c6c0e11","name":"action_uninstall","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"},"retries":"0","description":"","type":"DAG","uuid":"7c5bc1f7-58af-4042-8d71-023f3043eb7a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Uninstall_Crb_56b66f14_39cc_4320_8394_17636712b055","uuid":"b860a736-2c80-4cb8-a971-a9ead1db48a5"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_56b66f14_39cc_4320_8394_17636712b055"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_UNINSTALL","uuid":"b860a736-2c80-4cb8-a971-a9ead1db48a5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"},"retries":"0","description":"","type":"DAG","uuid":"24728f88-9810-4a3a-bf32-152349daf2ae","child_tasks_local_reference_list":[{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"b96d647b-7e55-4644-83d0-0e4d13bcfd64"},{"kind":"app_task","name":"Generate Certs","uuid":"9480345e-e748-4f3e-8044-4d72c6b82d7f"},{"kind":"app_task","name":"Configure Services","uuid":"7d270afd-0766-4d67-8693-db21adfd0084"},{"kind":"app_task","name":"Add User Roles","uuid":"8caec318-837b-4d11-a314-60c346b6932e"},{"kind":"app_task","name":"Network Configuration","uuid":"f57f0155-8057-4b75-8a74-03b15db1f9c9"},{"kind":"app_task","name":"DNS Configuration","uuid":"d455e23b-8dab-41b8-b54b-a754460064d8"},{"kind":"app_task","name":"NVP Configuration","uuid":"1e3aa1a2-a871-4dca-bcfd-eb3f1915d790"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"b96d647b-7e55-4644-83d0-0e4d13bcfd64"},"edge_type":"user_defined","type":"","uuid":"a1442b85-e6aa-4c6f-93aa-2c7b2a7103d9","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"9480345e-e748-4f3e-8044-4d72c6b82d7f"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"9480345e-e748-4f3e-8044-4d72c6b82d7f"},"edge_type":"user_defined","type":"","uuid":"e21b5be5-1f0a-464e-bff6-37a541f1dac7","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"7d270afd-0766-4d67-8693-db21adfd0084"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"7d270afd-0766-4d67-8693-db21adfd0084"},"edge_type":"user_defined","type":"","uuid":"af014c47-e9d0-406f-ae3f-a32cde0179c5","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"8caec318-837b-4d11-a314-60c346b6932e"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"8caec318-837b-4d11-a314-60c346b6932e"},"edge_type":"user_defined","type":"","uuid":"c480aad0-021c-4d79-a570-d83da0165fa1","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"f57f0155-8057-4b75-8a74-03b15db1f9c9"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"f57f0155-8057-4b75-8a74-03b15db1f9c9"},"edge_type":"user_defined","type":"","uuid":"903d6c0b-2579-4ebf-9e00-d108fb6b8baa","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"d455e23b-8dab-41b8-b54b-a754460064d8"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"d455e23b-8dab-41b8-b54b-a754460064d8"},"edge_type":"user_defined","type":"","uuid":"196a0efd-8baf-4171-8fd4-f279c00d5ae7","to_task_reference":{"kind":"app_task","name":"NVP Configuration","uuid":"1e3aa1a2-a871-4dca-bcfd-eb3f1915d790"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"dac441af_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"b96d647b-7e55-4644-83d0-0e4d13bcfd64","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nMINION_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} controller${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"controller${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')    \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate etcd \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/sd{e,f,g}\nsudo vgcreate docker \/dev\/sd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"9480345e-e748-4f3e-8044-4d72c6b82d7f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nMINION_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\n\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_NAMES},${CONTROLLER_IPS},${MINION_NAMES},${MINION_IPS},${FIRST_IP_SERVICE_SUBNET},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local -profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\ninstance=\"controller${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=controller${count}.kubeconfig\nkubectl config set-credentials system:node:controller${count} --client-certificate=controller${count}.pem --client-key=controller${count}-key.pem --embed-certs=true --kubeconfig=controller${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:controller${count} --kubeconfig=controller${count}.kubeconfig\nkubectl config use-context default --kubeconfig=controller${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"controller${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"7d270afd-0766-4d67-8693-db21adfd0084","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nCONTROLLER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,AlwaysPullImages,DenyEscalatingExec,SecurityContextDeny,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n    \necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"8caec318-837b-4d11-a314-60c346b6932e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet iscsid\nsudo systemctl enable etcd docker kubelet iscsid\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem controller* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"f57f0155-8057-4b75-8a74-03b15db1f9c9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - \/etc\/kube-flannel\/cni-conf.json\n        - \/etc\/cni\/net.d\/10-flannel.conf\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"d455e23b-8dab-41b8-b54b-a754460064d8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n    - name: dns\n      port: 53\n      protocol: UDP\n    - name: dns-tcp\n      port: 53\n      protocol: TCP\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: gcr.io\/google_containers\/k8s-dns-kube-dns-amd64:1.14.10\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: gcr.io\/google_containers\/k8s-dns-dnsmasq-nanny-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: gcr.io\/google_containers\/k8s-dns-sidecar-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local.,5,A\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local.,5,A\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy:\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n# Remove the configmaps rule once below issue is fixed:\n# kubernetes-incubator\/cluster-proportional-autoscaler#16\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.1.2-r2\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          # Should keep target in sync with cluster\/addons\/dns\/kube-dns.yaml.base\n          - --target=Deployment\/kube-dns\n          # When cluster is using large nodes(with more cores), \"coresPerReplica\" should dominate.\n          # If using small nodes, \"nodesPerReplica\" should dominate.\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"1e3aa1a2-a871-4dca-bcfd-eb3f1915d790","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nPRISM_CLUSTER_IP=\"@@{PE_CLUSTER_IP}@@\"\nPRISM_DATA_SERVICE_IP=\"@@{PE_CLUSTER_IP}@@\"\n\nif [[ (\"${PRISM_CLUSTER_IP}x\" == \"x\") && (\"${PRISM_DATA_SERVICE_IP}x\" == \"x\") ]]; then exit 0; fi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/volume_plugin\nNTNX_SECRET=$(echo -n \"@@{PE_USERNAME}@@:@@{PE_PASSWORD}@@\" | base64)\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: nutanixabs-provisioner-runner\n  namespace: kube-system\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumes\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumeclaims\"]\n    verbs: [\"get\", \"list\", \"watch\", \"update\"]\n  - apiGroups: [\"storage.k8s.io\"]\n    resources: [\"storageclasses\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"list\", \"watch\", \"create\", \"update\", \"patch\"]\n  - apiGroups: [\"\"]\n    resources: [\"services\"]\n    verbs: [\"get\"]\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"create\", \"delete\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: run-nutanixabs-provisioner\n  namespace: kube-system\nsubjects:\n  - kind: ServiceAccount\n    name: nutanixabs-provisioner\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: nutanixabs-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      labels:\n        app: nutanixabs-provisioner\n    spec:\n      serviceAccount: nutanixabs-provisioner\n      hostNetwork: true\n      containers:\n        -\n          image: \"ntnx\/nutanixabs-provisioner\"\n          name: nutanixabs-provisioner\n          args: [\"--v=4\"]\n          imagePullPolicy: IfNotPresent\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: kube-system\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\n---\nkind: StorageClass\napiVersion: storage.k8s.io\/v1\nmetadata:\n  name: silver \n  namespace: kube-system\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\nprovisioner: nutanix\/abs\nparameters:\n     prismEndPoint: @@{PE_CLUSTER_IP}@@:9440\n     dataServiceEndPoint: @@{PE_DATA_SERVICE_IP}@@:3260\n     secretName: ntnx-secret\n     storageContainer: @@{PE_CONTAINER_NAME}@@\n     fsType: ext4\n     chapAuthEnabled: \"false\"' | sudo tee \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\necho \"apiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: default\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\" | sudo tee -a \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"NVP Configuration"}],"description":"","message_list":[],"uuid":"ce8ba4ab-4797-40b3-8056-9ec1e7ae7ecd","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"dac441af_dag","uuid":"24728f88-9810-4a3a-bf32-152349daf2ae"},"name":"8e760b73_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"},"retries":"0","description":"","type":"DAG","uuid":"a15b3681-909e-4a44-b1dc-d59d7ab55280","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6324786a_dag"}],"description":"","message_list":[],"uuid":"3247fc69-ecee-4f14-98e0-99d03534ee35","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6324786a_dag","uuid":"a15b3681-909e-4a44-b1dc-d59d7ab55280"},"name":"6522ac7a_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Uninstall_Crb_56b66f14_39cc_4320_8394_17636712b055"}],"description":"","message_list":[],"uuid":"f385c2c1-849a-4ea0-bb13-2a5c0a754ad3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"7c5bc1f7-58af-4042-8d71-023f3043eb7a"},"name":"SYS_GEN__Runbook_Package_56b66f14_39cc_4320_8394_17636712b055"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"42c9d43f-ee7b-4c60-baff-7712f2346525","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"},"retries":"0","description":"","type":"DAG","uuid":"0da5d8fb-3599-4c1d-a872-04bdc882b220","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"d4b90180-20b5-40b3-b370-193a06eb7e0e"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"62706ab2-95f1-4083-b058-acfcfaaf2803"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"82038464-cfc3-4fee-995d-74865516b429"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"d4b90180-20b5-40b3-b370-193a06eb7e0e"},"edge_type":"inherent","type":"","uuid":"fd88c1a3-4470-4c3a-bada-c5f9008dd27a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"62706ab2-95f1-4083-b058-acfcfaaf2803"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"62706ab2-95f1-4083-b058-acfcfaaf2803"},"edge_type":"inherent","type":"","uuid":"a045cd72-4aa3-402a-9909-8c6c6585b9c8","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"82038464-cfc3-4fee-995d-74865516b429"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_56b66f14_39cc_4320_8394_17636712b055"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d4b90180-20b5-40b3-b370-193a06eb7e0e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"1fdd3541-2eca-471a-a4be-4ef82887d4de"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"62706ab2-95f1-4083-b058-acfcfaaf2803","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"a2ac512f-d272-4905-bafb-4733f7e58c9b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"82038464-cfc3-4fee-995d-74865516b429","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"f385c2c1-849a-4ea0-bb13-2a5c0a754ad3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_56b66f14_39cc_4320_8394_17636712b055"}],"description":"","message_list":[],"uuid":"a23bca79-50a7-4d31-b181-015830c644e6","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"0da5d8fb-3599-4c1d-a872-04bdc882b220"},"name":"SYS_GEN__Runbook_Package_56b66f14_39cc_4320_8394_17636712b055"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"628054bf-ad32-4e5c-9165-e6ecdd2595f2","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"},"retries":"0","description":"","type":"DAG","uuid":"742e56dc-cbbe-4249-a23a-27d0db35c7cb","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"d03479f0-83e4-4eb7-840f-ec218634cbe8"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_56b66f14_39cc_4320_8394_17636712b055","uuid":"c2ecc24a-f3dd-4fe7-876a-bbbde460027b"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"d03479f0-83e4-4eb7-840f-ec218634cbe8"},"edge_type":"inherent","type":"","uuid":"b8a05b68-1b46-4700-a322-32cf3fac424a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_56b66f14_39cc_4320_8394_17636712b055","uuid":"c2ecc24a-f3dd-4fe7-876a-bbbde460027b"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_56b66f14_39cc_4320_8394_17636712b055"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d03479f0-83e4-4eb7-840f-ec218634cbe8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"50a769a7-5b0a-4546-9e12-4f0a3ceff21b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"c2ecc24a-f3dd-4fe7-876a-bbbde460027b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_56b66f14_39cc_4320_8394_17636712b055"}],"description":"","message_list":[],"uuid":"87c64f7d-ae6d-4923-bcb8-922e9f2acd66","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"742e56dc-cbbe-4249-a23a-27d0db35c7cb"},"name":"SYS_GEN__Runbook_Package_56b66f14_39cc_4320_8394_17636712b055"}},{"description":"System action for starting an application","message_list":[],"uuid":"93b635a4-11b1-4ea0-9203-e22824239cf5","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"},"retries":"0","description":"","type":"DAG","uuid":"403ab8e8-e4fa-466b-af56-df66b9434b08","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"6f099e95-89b8-4b4d-8b30-16a4f9670868"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_56b66f14_39cc_4320_8394_17636712b055"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6f099e95-89b8-4b4d-8b30-16a4f9670868","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"64e5991c-fbcd-4d1f-8b72-4b4956e9702e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"884872f2-1c7b-47a7-a3e8-bc5fea5e9288","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"403ab8e8-e4fa-466b-af56-df66b9434b08"},"name":"SYS_GEN__Runbook_Package_56b66f14_39cc_4320_8394_17636712b055"}},{"description":"System action for restarting an application","message_list":[],"uuid":"4b00256c-dd3a-42d5-816f-4aa58fd2255a","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"},"retries":"0","description":"","type":"DAG","uuid":"738a5131-fb98-45ed-aab4-137a55607a79","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"9d754dba-0109-44d9-90d9-84e59560a98e"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_56b66f14_39cc_4320_8394_17636712b055"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"9d754dba-0109-44d9-90d9-84e59560a98e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"526cc0d4-3d9e-49c6-840b-f42e056f5d89"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"9ddbc9da-774a-42aa-95e4-8fc5e70112b6","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"738a5131-fb98-45ed-aab4-137a55607a79"},"name":"SYS_GEN__Runbook_Package_56b66f14_39cc_4320_8394_17636712b055"}},{"description":"System action for stopping an application","message_list":[],"uuid":"ac19a0c2-449d-4818-ae33-80a0e3dd8a71","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"},"retries":"0","description":"","type":"DAG","uuid":"f82a59f4-3c75-459e-a7ba-d45bd60022b6","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"e63cd093-38b7-4c6d-8760-62571cfaba56"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_56b66f14_39cc_4320_8394_17636712b055"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e63cd093-38b7-4c6d-8760-62571cfaba56","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"1fdd3541-2eca-471a-a4be-4ef82887d4de"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"a9e31f77-7b00-418d-9d18-daf74f247a37","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_56b66f14_39cc_4320_8394_17636712b055","uuid":"f82a59f4-3c75-459e-a7ba-d45bd60022b6"},"name":"SYS_GEN__Runbook_Package_56b66f14_39cc_4320_8394_17636712b055"}}],"message_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"}],"uuid":"56b66f14-39cc-4320-8394-17636712b055","state":"ACTIVE","version":"","editables":{},"type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"},"retries":"0","description":"","type":"DAG","uuid":"24728f88-9810-4a3a-bf32-152349daf2ae","child_tasks_local_reference_list":[{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"b96d647b-7e55-4644-83d0-0e4d13bcfd64"},{"kind":"app_task","name":"Generate Certs","uuid":"9480345e-e748-4f3e-8044-4d72c6b82d7f"},{"kind":"app_task","name":"Configure Services","uuid":"7d270afd-0766-4d67-8693-db21adfd0084"},{"kind":"app_task","name":"Add User Roles","uuid":"8caec318-837b-4d11-a314-60c346b6932e"},{"kind":"app_task","name":"Network Configuration","uuid":"f57f0155-8057-4b75-8a74-03b15db1f9c9"},{"kind":"app_task","name":"DNS Configuration","uuid":"d455e23b-8dab-41b8-b54b-a754460064d8"},{"kind":"app_task","name":"NVP Configuration","uuid":"1e3aa1a2-a871-4dca-bcfd-eb3f1915d790"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"b96d647b-7e55-4644-83d0-0e4d13bcfd64"},"edge_type":"user_defined","type":"","uuid":"a1442b85-e6aa-4c6f-93aa-2c7b2a7103d9","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"9480345e-e748-4f3e-8044-4d72c6b82d7f"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"9480345e-e748-4f3e-8044-4d72c6b82d7f"},"edge_type":"user_defined","type":"","uuid":"e21b5be5-1f0a-464e-bff6-37a541f1dac7","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"7d270afd-0766-4d67-8693-db21adfd0084"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"7d270afd-0766-4d67-8693-db21adfd0084"},"edge_type":"user_defined","type":"","uuid":"af014c47-e9d0-406f-ae3f-a32cde0179c5","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"8caec318-837b-4d11-a314-60c346b6932e"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"8caec318-837b-4d11-a314-60c346b6932e"},"edge_type":"user_defined","type":"","uuid":"c480aad0-021c-4d79-a570-d83da0165fa1","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"f57f0155-8057-4b75-8a74-03b15db1f9c9"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"f57f0155-8057-4b75-8a74-03b15db1f9c9"},"edge_type":"user_defined","type":"","uuid":"903d6c0b-2579-4ebf-9e00-d108fb6b8baa","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"d455e23b-8dab-41b8-b54b-a754460064d8"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"d455e23b-8dab-41b8-b54b-a754460064d8"},"edge_type":"user_defined","type":"","uuid":"196a0efd-8baf-4171-8fd4-f279c00d5ae7","to_task_reference":{"kind":"app_task","name":"NVP Configuration","uuid":"1e3aa1a2-a871-4dca-bcfd-eb3f1915d790"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"dac441af_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"b96d647b-7e55-4644-83d0-0e4d13bcfd64","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nMINION_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} controller${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"controller${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')    \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate etcd \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/sd{e,f,g}\nsudo vgcreate docker \/dev\/sd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"9480345e-e748-4f3e-8044-4d72c6b82d7f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nMINION_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\n\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_NAMES},${CONTROLLER_IPS},${MINION_NAMES},${MINION_IPS},${FIRST_IP_SERVICE_SUBNET},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local -profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\ninstance=\"controller${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=controller${count}.kubeconfig\nkubectl config set-credentials system:node:controller${count} --client-certificate=controller${count}.pem --client-key=controller${count}-key.pem --embed-certs=true --kubeconfig=controller${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:controller${count} --kubeconfig=controller${count}.kubeconfig\nkubectl config use-context default --kubeconfig=controller${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"controller${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"7d270afd-0766-4d67-8693-db21adfd0084","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nCONTROLLER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,AlwaysPullImages,DenyEscalatingExec,SecurityContextDeny,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n    \necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"8caec318-837b-4d11-a314-60c346b6932e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet iscsid\nsudo systemctl enable etcd docker kubelet iscsid\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem controller* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"f57f0155-8057-4b75-8a74-03b15db1f9c9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - \/etc\/kube-flannel\/cni-conf.json\n        - \/etc\/cni\/net.d\/10-flannel.conf\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"d455e23b-8dab-41b8-b54b-a754460064d8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n    - name: dns\n      port: 53\n      protocol: UDP\n    - name: dns-tcp\n      port: 53\n      protocol: TCP\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: gcr.io\/google_containers\/k8s-dns-kube-dns-amd64:1.14.10\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: gcr.io\/google_containers\/k8s-dns-dnsmasq-nanny-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: gcr.io\/google_containers\/k8s-dns-sidecar-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local.,5,A\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local.,5,A\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy:\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n# Remove the configmaps rule once below issue is fixed:\n# kubernetes-incubator\/cluster-proportional-autoscaler#16\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.1.2-r2\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          # Should keep target in sync with cluster\/addons\/dns\/kube-dns.yaml.base\n          - --target=Deployment\/kube-dns\n          # When cluster is using large nodes(with more cores), \"coresPerReplica\" should dominate.\n          # If using small nodes, \"nodesPerReplica\" should dominate.\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"1e3aa1a2-a871-4dca-bcfd-eb3f1915d790","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nPRISM_CLUSTER_IP=\"@@{PE_CLUSTER_IP}@@\"\nPRISM_DATA_SERVICE_IP=\"@@{PE_CLUSTER_IP}@@\"\n\nif [[ (\"${PRISM_CLUSTER_IP}x\" == \"x\") && (\"${PRISM_DATA_SERVICE_IP}x\" == \"x\") ]]; then exit 0; fi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/volume_plugin\nNTNX_SECRET=$(echo -n \"@@{PE_USERNAME}@@:@@{PE_PASSWORD}@@\" | base64)\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: nutanixabs-provisioner-runner\n  namespace: kube-system\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumes\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumeclaims\"]\n    verbs: [\"get\", \"list\", \"watch\", \"update\"]\n  - apiGroups: [\"storage.k8s.io\"]\n    resources: [\"storageclasses\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"list\", \"watch\", \"create\", \"update\", \"patch\"]\n  - apiGroups: [\"\"]\n    resources: [\"services\"]\n    verbs: [\"get\"]\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"create\", \"delete\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: run-nutanixabs-provisioner\n  namespace: kube-system\nsubjects:\n  - kind: ServiceAccount\n    name: nutanixabs-provisioner\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: nutanixabs-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      labels:\n        app: nutanixabs-provisioner\n    spec:\n      serviceAccount: nutanixabs-provisioner\n      hostNetwork: true\n      containers:\n        -\n          image: \"ntnx\/nutanixabs-provisioner\"\n          name: nutanixabs-provisioner\n          args: [\"--v=4\"]\n          imagePullPolicy: IfNotPresent\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: kube-system\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\n---\nkind: StorageClass\napiVersion: storage.k8s.io\/v1\nmetadata:\n  name: silver \n  namespace: kube-system\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\nprovisioner: nutanix\/abs\nparameters:\n     prismEndPoint: @@{PE_CLUSTER_IP}@@:9440\n     dataServiceEndPoint: @@{PE_DATA_SERVICE_IP}@@:3260\n     secretName: ntnx-secret\n     storageContainer: @@{PE_CONTAINER_NAME}@@\n     fsType: ext4\n     chapAuthEnabled: \"false\"' | sudo tee \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\necho \"apiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: default\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\" | sudo tee -a \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"NVP Configuration"}],"description":"","message_list":[],"uuid":"ce8ba4ab-4797-40b3-8056-9ec1e7ae7ecd","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"dac441af_dag","uuid":"24728f88-9810-4a3a-bf32-152349daf2ae"},"name":"8e760b73_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"},"retries":"0","description":"","type":"DAG","uuid":"a15b3681-909e-4a44-b1dc-d59d7ab55280","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6324786a_dag"}],"description":"","message_list":[],"uuid":"3247fc69-ecee-4f14-98e0-99d03534ee35","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6324786a_dag","uuid":"a15b3681-909e-4a44-b1dc-d59d7ab55280"},"name":"6522ac7a_runbook"}},"variable_list":[],"name":"AHV_Centos_K8SC_Package"},{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"a091bc5a-338b-4e8f-ba5f-69c4a6c9f4a7","name":"action_install","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"},"retries":"0","description":"","type":"DAG","uuid":"09c52e74-5df3-4555-b1ad-0e33569eb801","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Install_Crb_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"2b986a5e-3ac2-4063-8605-fb74fb2b0f92"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_c41ebbe6_49ab_4a43_8618_22679865e405"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_INSTALL","uuid":"2b986a5e-3ac2-4063-8605-fb74fb2b0f92","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"},"retries":"0","description":"","type":"DAG","uuid":"bb4a9582-ab92-4b99-a84b-4183ad16eada","child_tasks_local_reference_list":[{"kind":"app_task","name":"Docker Kubelet Install","uuid":"c6a82db2-703c-4580-bd70-34a3c9ce330e"},{"kind":"app_task","name":"GetCerts","uuid":"ec9825be-f146-48ed-b142-3d950fe2c6cc"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"c6a82db2-703c-4580-bd70-34a3c9ce330e"},"edge_type":"user_defined","type":"","uuid":"f40eb1a7-0dff-42db-8bc5-06007da96c0c","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"ec9825be-f146-48ed-b142-3d950fe2c6cc"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"c1566b3d_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"c6a82db2-703c-4580-bd70-34a3c9ce330e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{AHV_Centos_K8SC.address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/usr\/share\/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"ec9825be-f146-48ed-b142-3d950fe2c6cc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{AHV_Centos_K8SC.address[0]}@@\"\nINSTANCE_IP=\"@@{address}@@\"\ninstance=\"minion@@{calm_array_index}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"minion@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${instance} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${instance} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"9b9829ce-5225-4cae-818e-9959bd8ff3b9","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"c1566b3d_dag","uuid":"bb4a9582-ab92-4b99-a84b-4183ad16eada"},"name":"9a6e189b_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"},"retries":"0","description":"","type":"DAG","uuid":"927d5dc8-44bf-4db6-82a6-7c23dc0e1f96","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"5132c55f-aace-49bc-9a91-d118782fb091"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"abd3357c_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"5132c55f-aace-49bc-9a91-d118782fb091","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain 'minion@@{calm_array_index}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node 'minion@@{calm_array_index}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"2ad05b39-94d1-42a2-89ae-8584e15f7d20","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"abd3357c_dag","uuid":"927d5dc8-44bf-4db6-82a6-7c23dc0e1f96"},"name":"3cb17acf_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Install_Crb_c41ebbe6_49ab_4a43_8618_22679865e405"}],"description":"","message_list":[],"uuid":"241eb780-c41d-4b86-9adb-377699867bd7","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"09c52e74-5df3-4555-b1ad-0e33569eb801"},"name":"SYS_GEN__Runbook_Package_c41ebbe6_49ab_4a43_8618_22679865e405"}},{"description":"System action for creating an application","message_list":[],"uuid":"c19e2ef6-5b84-4396-9a59-138b14457c3b","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"},"retries":"0","description":"","type":"DAG","uuid":"8c8f37d2-c792-46c4-9fcf-c070b314b03c","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"1a5d0c1d-027b-426e-9232-ee3ca55bb7c0"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"e06040b4-1f2e-4a79-815d-7dc4183a611b"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"08a6576e-bcd8-46a3-af46-5c2bf11c7dbe"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"e06040b4-1f2e-4a79-815d-7dc4183a611b"},"edge_type":"inherent","type":"","uuid":"c8aa61bb-0f10-45bc-96d2-ab9247dabc25","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"08a6576e-bcd8-46a3-af46-5c2bf11c7dbe"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"1a5d0c1d-027b-426e-9232-ee3ca55bb7c0"},"edge_type":"inherent","type":"","uuid":"d54074af-0b6f-4e2d-b7d2-04c2003e12c5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"e06040b4-1f2e-4a79-815d-7dc4183a611b"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_c41ebbe6_49ab_4a43_8618_22679865e405"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1a5d0c1d-027b-426e-9232-ee3ca55bb7c0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"241eb780-c41d-4b86-9adb-377699867bd7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_c41ebbe6_49ab_4a43_8618_22679865e405"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e06040b4-1f2e-4a79-815d-7dc4183a611b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"cabcfd41-35e6-45f0-a791-00daf17de059"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"08a6576e-bcd8-46a3-af46-5c2bf11c7dbe","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"91f453c1-d2fc-47b1-93d4-4b49476235be"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"99447e42-d80f-4646-a500-4a87e745b41f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"8c8f37d2-c792-46c4-9fcf-c070b314b03c"},"name":"SYS_GEN__Runbook_Package_c41ebbe6_49ab_4a43_8618_22679865e405"}},{"description":"System action for uninstalling an application","message_list":[],"uuid":"3e4f8f54-e42a-44a2-b210-9dc09a24b80f","name":"action_uninstall","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"},"retries":"0","description":"","type":"DAG","uuid":"2ed5bba4-ac0d-4439-ad98-639e54a2a120","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Uninstall_Crb_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"65d383af-a4c8-49b6-aaf1-af055f5c3351"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_c41ebbe6_49ab_4a43_8618_22679865e405"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_UNINSTALL","uuid":"65d383af-a4c8-49b6-aaf1-af055f5c3351","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"},"retries":"0","description":"","type":"DAG","uuid":"bb4a9582-ab92-4b99-a84b-4183ad16eada","child_tasks_local_reference_list":[{"kind":"app_task","name":"Docker Kubelet Install","uuid":"c6a82db2-703c-4580-bd70-34a3c9ce330e"},{"kind":"app_task","name":"GetCerts","uuid":"ec9825be-f146-48ed-b142-3d950fe2c6cc"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"c6a82db2-703c-4580-bd70-34a3c9ce330e"},"edge_type":"user_defined","type":"","uuid":"f40eb1a7-0dff-42db-8bc5-06007da96c0c","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"ec9825be-f146-48ed-b142-3d950fe2c6cc"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"c1566b3d_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"c6a82db2-703c-4580-bd70-34a3c9ce330e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{AHV_Centos_K8SC.address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/usr\/share\/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"ec9825be-f146-48ed-b142-3d950fe2c6cc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{AHV_Centos_K8SC.address[0]}@@\"\nINSTANCE_IP=\"@@{address}@@\"\ninstance=\"minion@@{calm_array_index}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"minion@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${instance} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${instance} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"9b9829ce-5225-4cae-818e-9959bd8ff3b9","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"c1566b3d_dag","uuid":"bb4a9582-ab92-4b99-a84b-4183ad16eada"},"name":"9a6e189b_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"},"retries":"0","description":"","type":"DAG","uuid":"927d5dc8-44bf-4db6-82a6-7c23dc0e1f96","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"5132c55f-aace-49bc-9a91-d118782fb091"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"abd3357c_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"5132c55f-aace-49bc-9a91-d118782fb091","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain 'minion@@{calm_array_index}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node 'minion@@{calm_array_index}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"2ad05b39-94d1-42a2-89ae-8584e15f7d20","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"abd3357c_dag","uuid":"927d5dc8-44bf-4db6-82a6-7c23dc0e1f96"},"name":"3cb17acf_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Uninstall_Crb_c41ebbe6_49ab_4a43_8618_22679865e405"}],"description":"","message_list":[],"uuid":"c9c66e34-5944-40a2-9d4a-9d37168ba0fc","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"2ed5bba4-ac0d-4439-ad98-639e54a2a120"},"name":"SYS_GEN__Runbook_Package_c41ebbe6_49ab_4a43_8618_22679865e405"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"a6dd08dd-7db7-41a1-b797-4d8eb930f509","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"},"retries":"0","description":"","type":"DAG","uuid":"2cbb57f0-bf98-4b34-87d2-15e203fc448a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"aad73423-c594-4bb3-88e6-7dba0ea8330d"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"c36c6d65-fc26-40b1-9953-64fa0cd7d341"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"cef1387c-b58d-4d15-bb6a-2915345809f1"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"aad73423-c594-4bb3-88e6-7dba0ea8330d"},"edge_type":"inherent","type":"","uuid":"c01db022-473c-4bcb-8e8b-4f0f6342bae2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"c36c6d65-fc26-40b1-9953-64fa0cd7d341"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"c36c6d65-fc26-40b1-9953-64fa0cd7d341"},"edge_type":"inherent","type":"","uuid":"56d2609f-4b89-4f27-80cd-6d815eb544b3","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"cef1387c-b58d-4d15-bb6a-2915345809f1"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_c41ebbe6_49ab_4a43_8618_22679865e405"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"aad73423-c594-4bb3-88e6-7dba0ea8330d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12105be2-ee67-451d-8054-4546855e277c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c36c6d65-fc26-40b1-9953-64fa0cd7d341","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"6b0fd64c-e97f-4968-998d-ff058e95d9e9"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"cef1387c-b58d-4d15-bb6a-2915345809f1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"c9c66e34-5944-40a2-9d4a-9d37168ba0fc"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_c41ebbe6_49ab_4a43_8618_22679865e405"}],"description":"","message_list":[],"uuid":"53ea1a3d-f0f9-43a1-b07a-ac5d21d3e4b9","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"2cbb57f0-bf98-4b34-87d2-15e203fc448a"},"name":"SYS_GEN__Runbook_Package_c41ebbe6_49ab_4a43_8618_22679865e405"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"756b275e-8465-4b9d-b356-29cdd14f7fb5","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"},"retries":"0","description":"","type":"DAG","uuid":"35b5b40c-74e2-4c2d-bab2-613399ce6d9c","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"f45854c2-946f-4fc0-84d1-ab23e499406c"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"04e68472-1e7a-423d-a76b-cb3162e43931"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"f45854c2-946f-4fc0-84d1-ab23e499406c"},"edge_type":"inherent","type":"","uuid":"7f99b9ac-db0b-4b8e-9bf0-10df62b61086","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"04e68472-1e7a-423d-a76b-cb3162e43931"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_c41ebbe6_49ab_4a43_8618_22679865e405"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f45854c2-946f-4fc0-84d1-ab23e499406c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"d44a642f-9468-432a-9b7e-e69a7c1c08e7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"04e68472-1e7a-423d-a76b-cb3162e43931","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_c41ebbe6_49ab_4a43_8618_22679865e405"}],"description":"","message_list":[],"uuid":"e37826eb-72f1-4d58-9bdb-abd3cbceb3db","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"35b5b40c-74e2-4c2d-bab2-613399ce6d9c"},"name":"SYS_GEN__Runbook_Package_c41ebbe6_49ab_4a43_8618_22679865e405"}},{"description":"System action for starting an application","message_list":[],"uuid":"ac6444d2-13b0-462e-9344-9fa2a39759f0","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"},"retries":"0","description":"","type":"DAG","uuid":"cac3cb2d-6131-4d6a-96fb-3ae844ce6676","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"3f10aeb3-c247-4b15-997a-f683ba6f9916"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_c41ebbe6_49ab_4a43_8618_22679865e405"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3f10aeb3-c247-4b15-997a-f683ba6f9916","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"91f453c1-d2fc-47b1-93d4-4b49476235be"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"3cd972e6-2034-4d3c-addd-a5eec2f09035","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"cac3cb2d-6131-4d6a-96fb-3ae844ce6676"},"name":"SYS_GEN__Runbook_Package_c41ebbe6_49ab_4a43_8618_22679865e405"}},{"description":"System action for restarting an application","message_list":[],"uuid":"b7a9237b-0a9e-4131-bca8-279613b24e1d","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"},"retries":"0","description":"","type":"DAG","uuid":"e0641c1c-66e3-4295-a439-7a58ee6e1a20","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"c34da162-d884-444c-bea1-0d3941b4f31f"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_c41ebbe6_49ab_4a43_8618_22679865e405"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c34da162-d884-444c-bea1-0d3941b4f31f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"3fd75c09-a79f-4731-98fc-b65b96bc9fe7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"9898633c-3240-47a9-ae8a-16d42625da8f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"e0641c1c-66e3-4295-a439-7a58ee6e1a20"},"name":"SYS_GEN__Runbook_Package_c41ebbe6_49ab_4a43_8618_22679865e405"}},{"description":"System action for stopping an application","message_list":[],"uuid":"d38621a6-6f4f-47a2-8fe5-f939cb879557","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"},"retries":"0","description":"","type":"DAG","uuid":"e34a95a1-3910-45c9-ba5a-6abdf96baa29","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"c77d01ff-c4a2-439a-a4a2-3bcd309c97fa"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_c41ebbe6_49ab_4a43_8618_22679865e405"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c77d01ff-c4a2-439a-a4a2-3bcd309c97fa","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12105be2-ee67-451d-8054-4546855e277c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"e2b02717-fb2f-4b6b-9019-ac8495bb5e6b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_c41ebbe6_49ab_4a43_8618_22679865e405","uuid":"e34a95a1-3910-45c9-ba5a-6abdf96baa29"},"name":"SYS_GEN__Runbook_Package_c41ebbe6_49ab_4a43_8618_22679865e405"}}],"message_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"}],"uuid":"c41ebbe6-49ab-4a43-8618-22679865e405","state":"ACTIVE","version":"","editables":{},"type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"},"retries":"0","description":"","type":"DAG","uuid":"bb4a9582-ab92-4b99-a84b-4183ad16eada","child_tasks_local_reference_list":[{"kind":"app_task","name":"Docker Kubelet Install","uuid":"c6a82db2-703c-4580-bd70-34a3c9ce330e"},{"kind":"app_task","name":"GetCerts","uuid":"ec9825be-f146-48ed-b142-3d950fe2c6cc"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"c6a82db2-703c-4580-bd70-34a3c9ce330e"},"edge_type":"user_defined","type":"","uuid":"f40eb1a7-0dff-42db-8bc5-06007da96c0c","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"ec9825be-f146-48ed-b142-3d950fe2c6cc"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"c1566b3d_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"c6a82db2-703c-4580-bd70-34a3c9ce330e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{AHV_Centos_K8SC.address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/usr\/share\/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"ec9825be-f146-48ed-b142-3d950fe2c6cc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{AHV_Centos_K8SC.address[0]}@@\"\nINSTANCE_IP=\"@@{address}@@\"\ninstance=\"minion@@{calm_array_index}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"minion@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${instance} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${instance} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"9b9829ce-5225-4cae-818e-9959bd8ff3b9","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"c1566b3d_dag","uuid":"bb4a9582-ab92-4b99-a84b-4183ad16eada"},"name":"9a6e189b_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"},"retries":"0","description":"","type":"DAG","uuid":"927d5dc8-44bf-4db6-82a6-7c23dc0e1f96","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"5132c55f-aace-49bc-9a91-d118782fb091"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"abd3357c_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"5132c55f-aace-49bc-9a91-d118782fb091","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain 'minion@@{calm_array_index}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node 'minion@@{calm_array_index}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"2ad05b39-94d1-42a2-89ae-8584e15f7d20","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"abd3357c_dag","uuid":"927d5dc8-44bf-4db6-82a6-7c23dc0e1f96"},"name":"3cb17acf_runbook"}},"variable_list":[],"name":"AHV_Centos_K8SM_Package"},{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"d0b0cbe2-879c-4553-b255-c5658e1b86e9","name":"action_install","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"},"retries":"0","description":"","type":"DAG","uuid":"edcc0edd-1a42-406b-9721-57d32c056c5e","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Install_Crb_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"2aefee1e-1c21-4c95-bae5-cfd4b8c7a2a0"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_INSTALL","uuid":"2aefee1e-1c21-4c95-bae5-cfd4b8c7a2a0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"},"retries":"0","description":"","type":"DAG","uuid":"3e95d365-a94c-4a54-a32a-413b3dda3bc3","child_tasks_local_reference_list":[{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"ae887c8b-07cb-406f-9e98-e754397c60f9"},{"kind":"app_task","name":"Generate Certs","uuid":"62d7cfe4-5397-4406-aac1-a04663440978"},{"kind":"app_task","name":"Configure Services","uuid":"27ab8dc0-83f9-46d6-a5fa-aeadc0a3099c"},{"kind":"app_task","name":"Add User Roles","uuid":"f68681b7-1608-4521-afb5-e9a8a7f993d5"},{"kind":"app_task","name":"Network Configuration","uuid":"2fb0bd2a-71a3-47b5-9ea3-da3b8e1657cc"},{"kind":"app_task","name":"DNS Configuration","uuid":"5aaccd3e-a910-46c4-9085-1c25c540620e"},{"kind":"app_task","name":"EBS VolumePlugin","uuid":"8ced34e7-d77e-4662-96e2-dbea387d8f6b"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"ae887c8b-07cb-406f-9e98-e754397c60f9"},"edge_type":"user_defined","type":"","uuid":"19d18e5f-cac4-46d2-ac4e-5c32c79b414f","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"62d7cfe4-5397-4406-aac1-a04663440978"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"62d7cfe4-5397-4406-aac1-a04663440978"},"edge_type":"user_defined","type":"","uuid":"451bec00-f5a5-48f0-bc68-30f4edddc953","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"27ab8dc0-83f9-46d6-a5fa-aeadc0a3099c"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"27ab8dc0-83f9-46d6-a5fa-aeadc0a3099c"},"edge_type":"user_defined","type":"","uuid":"9840707b-0116-4f30-97cd-9c853ead8ba1","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"f68681b7-1608-4521-afb5-e9a8a7f993d5"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"f68681b7-1608-4521-afb5-e9a8a7f993d5"},"edge_type":"user_defined","type":"","uuid":"317bc858-5860-4bb3-9329-606d8321c9ed","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"2fb0bd2a-71a3-47b5-9ea3-da3b8e1657cc"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"2fb0bd2a-71a3-47b5-9ea3-da3b8e1657cc"},"edge_type":"user_defined","type":"","uuid":"c87a511c-c14b-41b3-a83e-490258a14794","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"5aaccd3e-a910-46c4-9085-1c25c540620e"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"5aaccd3e-a910-46c4-9085-1c25c540620e"},"edge_type":"user_defined","type":"","uuid":"27d573a3-86b6-4b70-8b8b-72232cfe0fe8","to_task_reference":{"kind":"app_task","name":"EBS VolumePlugin","uuid":"8ced34e7-d77e-4662-96e2-dbea387d8f6b"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"84e097cf_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"ae887c8b-07cb-406f-9e98-e754397c60f9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nMINION_IPS=\"@@{AWS_Centos_K8SM.private_ip_address}@@\" # private Ip's\nCONTROLLER_DNS=\"@@{calm_array_private_dns_name}@@\" # private Dns\nMINION_DNS=\"@@{AWS_Centos_K8SM.private_dns_name}@@\" # private Dns\nPUBLIC_CONTROLLER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_MINION_IPS=\"@@{AWS_Centos_K8SM.public_ip_address}@@\"\nPUBLIC_CONTROLLER_DNS=\"@@{calm_array_public_dns_name}@@\"\nPUBLIC_MINION_DNS=\"@@{AWS_Centos_K8SM.public_dns_name}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y --quiet\nsudo yum install -y wget iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} controller${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"controller${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')    \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=aws \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/xvd{b,c,d}\nsudo vgcreate etcd \/dev\/xvd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/xvd{e,f,g}\nsudo vgcreate docker \/dev\/xvd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"62d7cfe4-5397-4406-aac1-a04663440978","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nMINION_IPS=\"@@{AWS_Centos_K8SM.private_ip_address}@@\" # private Ip's\nCONTROLLER_DNS=\"@@{calm_array_private_dns_name}@@\" # private Dns\nMINION_DNS=\"@@{AWS_Centos_K8SM.private_dns_name}@@\" # private Dns\nPUBLIC_CONTROLLER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_MINION_IPS=\"@@{AWS_Centos_K8SM.public_ip_address}@@\"\nPUBLIC_CONTROLLER_DNS=\"@@{calm_array_public_dns_name}@@\"\nPUBLIC_MINION_DNS=\"@@{AWS_Centos_K8SM.public_dns_name}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${CONTROLLER_DNS},${PUBLIC_CONTROLLER_IPS},${PUBLIC_CONTROLLER_DNS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${CONTROLLER_DNS},${PUBLIC_CONTROLLER_IPS},${PUBLIC_CONTROLLER_DNS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${CONTROLLER_DNS},${PUBLIC_CONTROLLER_IPS},${PUBLIC_CONTROLLER_DNS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json \\\n-hostname=${CONTROLLER_NAMES},${CONTROLLER_IPS},${MINION_NAMES},${MINION_IPS},${FIRST_IP_SERVICE_SUBNET},${CONTROLLER_DNS},${MINION_DNS},${PUBLIC_CONTROLLER_IPS},${PUBLIC_MINION_IPS},${PUBLIC_CONTROLLER_DNS},${PUBLIC_MINION_DNS},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local \\\n-profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor name in $(echo ${CONTROLLER_DNS} | tr \",\" \"\\n\"); do\ninstance=\"controller${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${name}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${name},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor name in $(echo ${CONTROLLER_DNS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=controller${count}.kubeconfig\nkubectl config set-credentials system:node:${name} --client-certificate=controller${count}.pem --client-key=controller${count}-key.pem --embed-certs=true --kubeconfig=controller${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${name} --kubeconfig=controller${count}.kubeconfig\nkubectl config use-context default --kubeconfig=controller${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"controller${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"27ab8dc0-83f9-46d6-a5fa-aeadc0a3099c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nCONTROLLER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,AlwaysPullImages,DenyEscalatingExec,SecurityContextDeny,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --cloud-provider=aws\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --cloud-provider=aws\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n    \necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"f68681b7-1608-4521-afb5-e9a8a7f993d5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet\nsudo systemctl enable etcd docker kubelet\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem controller* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\n\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF\n\ncat <<EOF | kubectl apply -f -\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: kube-aws:node-proxier\nsubjects:\n  - kind: User\n    name: kube-worker\n  - kind: ServiceAccount\n    name: kube-proxy\n    namespace: kube-system\n  - kind: Group\n    name: system:nodes\nroleRef:\n  kind: ClusterRole\n  name: system:node-proxier\n  apiGroup: rbac.authorization.k8s.io\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"2fb0bd2a-71a3-47b5-9ea3-da3b8e1657cc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - \/etc\/kube-flannel\/cni-conf.json\n        - \/etc\/cni\/net.d\/10-flannel.conf\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"5aaccd3e-a910-46c4-9085-1c25c540620e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n    - name: dns\n      port: 53\n      protocol: UDP\n    - name: dns-tcp\n      port: 53\n      protocol: TCP\n---\napiVersion: apps\/v1beta2\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: gcr.io\/google_containers\/k8s-dns-kube-dns-amd64:1.14.10\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: gcr.io\/google_containers\/k8s-dns-dnsmasq-nanny-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: gcr.io\/google_containers\/k8s-dns-sidecar-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local.,5,A\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local.,5,A\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy:\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n\necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n# Remove the configmaps rule once below issue is fixed:\n# kubernetes-incubator\/cluster-proportional-autoscaler#16\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.1.2-r2\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          # Should keep target in sync with cluster\/addons\/dns\/kube-dns.yaml.base\n          - --target=Deployment\/kube-dns\n          # When cluster is using large nodes(with more cores), \"coresPerReplica\" should dominate.\n          # If using small nodes, \"nodesPerReplica\" should dominate.\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"8ced34e7-d77e-4662-96e2-dbea387d8f6b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nsudo mkdir \"\/etc\/kubernetes\/addons\/volume\"\n\necho 'apiVersion: storage.k8s.io\/v1\nkind: StorageClass\nmetadata:\n  name: gp2\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: EnsureExists\nprovisioner: kubernetes.io\/aws-ebs\nparameters:\n  type: gp2' | sudo tee \/etc\/kubernetes\/addons\/volume\/default.yaml\n \nkubectl create -f \/etc\/kubernetes\/addons\/volume\/default.yaml "},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"EBS VolumePlugin"}],"description":"","message_list":[],"uuid":"d4fe484c-2c80-4d34-8b40-d04671ae922f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"84e097cf_dag","uuid":"3e95d365-a94c-4a54-a32a-413b3dda3bc3"},"name":"e836616a_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"},"retries":"0","description":"","type":"DAG","uuid":"7c5fd8e1-85a1-474f-bd6d-164c75674fd9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"4226cd9d_dag"}],"description":"","message_list":[],"uuid":"9b4b2a26-89e0-411a-8a4a-e0f6c467a260","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"4226cd9d_dag","uuid":"7c5fd8e1-85a1-474f-bd6d-164c75674fd9"},"name":"18f2756f_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Install_Crb_f5299fdf_a772_41d5_9925_c87ddaec8f1f"}],"description":"","message_list":[],"uuid":"585fde78-19e6-48c9-ba86-a4a9e5ac1e92","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"edcc0edd-1a42-406b-9721-57d32c056c5e"},"name":"SYS_GEN__Runbook_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f"}},{"description":"System action for creating an application","message_list":[],"uuid":"9934c7cf-88db-4903-bfae-5c51bed834f0","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"},"retries":"0","description":"","type":"DAG","uuid":"afcfd9eb-a68c-4667-ba0b-f4cbdcb95903","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"8b7160af-19e2-4a63-a532-e13cc0a57cc5"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"f929a38f-b267-42bb-9768-143a83a0551b"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"b85d72b5-1239-425a-a293-8fa6696231a5"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"f929a38f-b267-42bb-9768-143a83a0551b"},"edge_type":"inherent","type":"","uuid":"9e5d817c-934e-4ffe-9137-2a386c79f874","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"b85d72b5-1239-425a-a293-8fa6696231a5"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"8b7160af-19e2-4a63-a532-e13cc0a57cc5"},"edge_type":"inherent","type":"","uuid":"012572e6-3ee3-4d6a-b6f8-5ace796a5d82","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"f929a38f-b267-42bb-9768-143a83a0551b"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8b7160af-19e2-4a63-a532-e13cc0a57cc5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"585fde78-19e6-48c9-ba86-a4a9e5ac1e92"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f929a38f-b267-42bb-9768-143a83a0551b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"aa8dd27e-4bd1-4b85-86c6-750c0a49579f"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b85d72b5-1239-425a-a293-8fa6696231a5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"64e5991c-fbcd-4d1f-8b72-4b4956e9702e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"6a748f59-9e1c-4077-81f7-a5e8d1e2bd70","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"afcfd9eb-a68c-4667-ba0b-f4cbdcb95903"},"name":"SYS_GEN__Runbook_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f"}},{"description":"System action for uninstalling an application","message_list":[],"uuid":"b57b897c-3a7f-4726-9236-2061b458c376","name":"action_uninstall","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"},"retries":"0","description":"","type":"DAG","uuid":"02ecd243-6572-43bd-a917-91e24ec5206a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Uninstall_Crb_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"b7760a0f-3893-4575-aff0-ab52101cb413"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_UNINSTALL","uuid":"b7760a0f-3893-4575-aff0-ab52101cb413","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"},"retries":"0","description":"","type":"DAG","uuid":"3e95d365-a94c-4a54-a32a-413b3dda3bc3","child_tasks_local_reference_list":[{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"ae887c8b-07cb-406f-9e98-e754397c60f9"},{"kind":"app_task","name":"Generate Certs","uuid":"62d7cfe4-5397-4406-aac1-a04663440978"},{"kind":"app_task","name":"Configure Services","uuid":"27ab8dc0-83f9-46d6-a5fa-aeadc0a3099c"},{"kind":"app_task","name":"Add User Roles","uuid":"f68681b7-1608-4521-afb5-e9a8a7f993d5"},{"kind":"app_task","name":"Network Configuration","uuid":"2fb0bd2a-71a3-47b5-9ea3-da3b8e1657cc"},{"kind":"app_task","name":"DNS Configuration","uuid":"5aaccd3e-a910-46c4-9085-1c25c540620e"},{"kind":"app_task","name":"EBS VolumePlugin","uuid":"8ced34e7-d77e-4662-96e2-dbea387d8f6b"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"ae887c8b-07cb-406f-9e98-e754397c60f9"},"edge_type":"user_defined","type":"","uuid":"19d18e5f-cac4-46d2-ac4e-5c32c79b414f","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"62d7cfe4-5397-4406-aac1-a04663440978"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"62d7cfe4-5397-4406-aac1-a04663440978"},"edge_type":"user_defined","type":"","uuid":"451bec00-f5a5-48f0-bc68-30f4edddc953","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"27ab8dc0-83f9-46d6-a5fa-aeadc0a3099c"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"27ab8dc0-83f9-46d6-a5fa-aeadc0a3099c"},"edge_type":"user_defined","type":"","uuid":"9840707b-0116-4f30-97cd-9c853ead8ba1","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"f68681b7-1608-4521-afb5-e9a8a7f993d5"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"f68681b7-1608-4521-afb5-e9a8a7f993d5"},"edge_type":"user_defined","type":"","uuid":"317bc858-5860-4bb3-9329-606d8321c9ed","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"2fb0bd2a-71a3-47b5-9ea3-da3b8e1657cc"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"2fb0bd2a-71a3-47b5-9ea3-da3b8e1657cc"},"edge_type":"user_defined","type":"","uuid":"c87a511c-c14b-41b3-a83e-490258a14794","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"5aaccd3e-a910-46c4-9085-1c25c540620e"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"5aaccd3e-a910-46c4-9085-1c25c540620e"},"edge_type":"user_defined","type":"","uuid":"27d573a3-86b6-4b70-8b8b-72232cfe0fe8","to_task_reference":{"kind":"app_task","name":"EBS VolumePlugin","uuid":"8ced34e7-d77e-4662-96e2-dbea387d8f6b"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"84e097cf_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"ae887c8b-07cb-406f-9e98-e754397c60f9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nMINION_IPS=\"@@{AWS_Centos_K8SM.private_ip_address}@@\" # private Ip's\nCONTROLLER_DNS=\"@@{calm_array_private_dns_name}@@\" # private Dns\nMINION_DNS=\"@@{AWS_Centos_K8SM.private_dns_name}@@\" # private Dns\nPUBLIC_CONTROLLER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_MINION_IPS=\"@@{AWS_Centos_K8SM.public_ip_address}@@\"\nPUBLIC_CONTROLLER_DNS=\"@@{calm_array_public_dns_name}@@\"\nPUBLIC_MINION_DNS=\"@@{AWS_Centos_K8SM.public_dns_name}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y --quiet\nsudo yum install -y wget iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} controller${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"controller${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')    \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=aws \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/xvd{b,c,d}\nsudo vgcreate etcd \/dev\/xvd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/xvd{e,f,g}\nsudo vgcreate docker \/dev\/xvd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"62d7cfe4-5397-4406-aac1-a04663440978","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nMINION_IPS=\"@@{AWS_Centos_K8SM.private_ip_address}@@\" # private Ip's\nCONTROLLER_DNS=\"@@{calm_array_private_dns_name}@@\" # private Dns\nMINION_DNS=\"@@{AWS_Centos_K8SM.private_dns_name}@@\" # private Dns\nPUBLIC_CONTROLLER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_MINION_IPS=\"@@{AWS_Centos_K8SM.public_ip_address}@@\"\nPUBLIC_CONTROLLER_DNS=\"@@{calm_array_public_dns_name}@@\"\nPUBLIC_MINION_DNS=\"@@{AWS_Centos_K8SM.public_dns_name}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${CONTROLLER_DNS},${PUBLIC_CONTROLLER_IPS},${PUBLIC_CONTROLLER_DNS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${CONTROLLER_DNS},${PUBLIC_CONTROLLER_IPS},${PUBLIC_CONTROLLER_DNS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${CONTROLLER_DNS},${PUBLIC_CONTROLLER_IPS},${PUBLIC_CONTROLLER_DNS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json \\\n-hostname=${CONTROLLER_NAMES},${CONTROLLER_IPS},${MINION_NAMES},${MINION_IPS},${FIRST_IP_SERVICE_SUBNET},${CONTROLLER_DNS},${MINION_DNS},${PUBLIC_CONTROLLER_IPS},${PUBLIC_MINION_IPS},${PUBLIC_CONTROLLER_DNS},${PUBLIC_MINION_DNS},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local \\\n-profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor name in $(echo ${CONTROLLER_DNS} | tr \",\" \"\\n\"); do\ninstance=\"controller${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${name}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${name},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor name in $(echo ${CONTROLLER_DNS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=controller${count}.kubeconfig\nkubectl config set-credentials system:node:${name} --client-certificate=controller${count}.pem --client-key=controller${count}-key.pem --embed-certs=true --kubeconfig=controller${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${name} --kubeconfig=controller${count}.kubeconfig\nkubectl config use-context default --kubeconfig=controller${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"controller${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"27ab8dc0-83f9-46d6-a5fa-aeadc0a3099c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nCONTROLLER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,AlwaysPullImages,DenyEscalatingExec,SecurityContextDeny,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --cloud-provider=aws\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --cloud-provider=aws\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n    \necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"f68681b7-1608-4521-afb5-e9a8a7f993d5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet\nsudo systemctl enable etcd docker kubelet\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem controller* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\n\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF\n\ncat <<EOF | kubectl apply -f -\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: kube-aws:node-proxier\nsubjects:\n  - kind: User\n    name: kube-worker\n  - kind: ServiceAccount\n    name: kube-proxy\n    namespace: kube-system\n  - kind: Group\n    name: system:nodes\nroleRef:\n  kind: ClusterRole\n  name: system:node-proxier\n  apiGroup: rbac.authorization.k8s.io\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"2fb0bd2a-71a3-47b5-9ea3-da3b8e1657cc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - \/etc\/kube-flannel\/cni-conf.json\n        - \/etc\/cni\/net.d\/10-flannel.conf\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"5aaccd3e-a910-46c4-9085-1c25c540620e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n    - name: dns\n      port: 53\n      protocol: UDP\n    - name: dns-tcp\n      port: 53\n      protocol: TCP\n---\napiVersion: apps\/v1beta2\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: gcr.io\/google_containers\/k8s-dns-kube-dns-amd64:1.14.10\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: gcr.io\/google_containers\/k8s-dns-dnsmasq-nanny-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: gcr.io\/google_containers\/k8s-dns-sidecar-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local.,5,A\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local.,5,A\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy:\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n\necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n# Remove the configmaps rule once below issue is fixed:\n# kubernetes-incubator\/cluster-proportional-autoscaler#16\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.1.2-r2\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          # Should keep target in sync with cluster\/addons\/dns\/kube-dns.yaml.base\n          - --target=Deployment\/kube-dns\n          # When cluster is using large nodes(with more cores), \"coresPerReplica\" should dominate.\n          # If using small nodes, \"nodesPerReplica\" should dominate.\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"8ced34e7-d77e-4662-96e2-dbea387d8f6b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nsudo mkdir \"\/etc\/kubernetes\/addons\/volume\"\n\necho 'apiVersion: storage.k8s.io\/v1\nkind: StorageClass\nmetadata:\n  name: gp2\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: EnsureExists\nprovisioner: kubernetes.io\/aws-ebs\nparameters:\n  type: gp2' | sudo tee \/etc\/kubernetes\/addons\/volume\/default.yaml\n \nkubectl create -f \/etc\/kubernetes\/addons\/volume\/default.yaml "},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"EBS VolumePlugin"}],"description":"","message_list":[],"uuid":"d4fe484c-2c80-4d34-8b40-d04671ae922f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"84e097cf_dag","uuid":"3e95d365-a94c-4a54-a32a-413b3dda3bc3"},"name":"e836616a_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"},"retries":"0","description":"","type":"DAG","uuid":"7c5fd8e1-85a1-474f-bd6d-164c75674fd9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"4226cd9d_dag"}],"description":"","message_list":[],"uuid":"9b4b2a26-89e0-411a-8a4a-e0f6c467a260","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"4226cd9d_dag","uuid":"7c5fd8e1-85a1-474f-bd6d-164c75674fd9"},"name":"18f2756f_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Uninstall_Crb_f5299fdf_a772_41d5_9925_c87ddaec8f1f"}],"description":"","message_list":[],"uuid":"db7bd1e1-71d4-4755-8088-596bc82d1960","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"02ecd243-6572-43bd-a917-91e24ec5206a"},"name":"SYS_GEN__Runbook_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"0b7522b8-8eea-4903-94b8-2c4bbd1a8867","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"},"retries":"0","description":"","type":"DAG","uuid":"0b2ddc92-3d76-480e-bb33-c47c62789a1c","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"e43becff-604a-4925-819c-3ba29094c857"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"52b017e8-0815-43e8-9dc6-547ae311632e"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"9a8c9e9b-b475-4274-a929-3aacabbb7f12"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"e43becff-604a-4925-819c-3ba29094c857"},"edge_type":"inherent","type":"","uuid":"d69b475c-d680-41c2-9798-1ba8775962b1","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"52b017e8-0815-43e8-9dc6-547ae311632e"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"52b017e8-0815-43e8-9dc6-547ae311632e"},"edge_type":"inherent","type":"","uuid":"04084bde-68c5-46cc-b164-96f556ee66bb","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"9a8c9e9b-b475-4274-a929-3aacabbb7f12"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e43becff-604a-4925-819c-3ba29094c857","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"1fdd3541-2eca-471a-a4be-4ef82887d4de"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"52b017e8-0815-43e8-9dc6-547ae311632e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"a2ac512f-d272-4905-bafb-4733f7e58c9b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"9a8c9e9b-b475-4274-a929-3aacabbb7f12","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"db7bd1e1-71d4-4755-8088-596bc82d1960"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f"}],"description":"","message_list":[],"uuid":"a7eab232-4221-423d-ac6d-00dcf330cb1d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"0b2ddc92-3d76-480e-bb33-c47c62789a1c"},"name":"SYS_GEN__Runbook_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"e7fbef8c-7f50-48e5-9812-34e07b36a4d1","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"},"retries":"0","description":"","type":"DAG","uuid":"dc5bf7e0-2309-440d-9b60-954dfe78f38e","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"4be45fac-3983-45aa-855a-de7ea01cca40"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"98f8724f-6386-4023-82d5-7a24a74b9197"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"4be45fac-3983-45aa-855a-de7ea01cca40"},"edge_type":"inherent","type":"","uuid":"caf01e2b-0d5f-4ebe-b64f-77b6ad621d2e","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"98f8724f-6386-4023-82d5-7a24a74b9197"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4be45fac-3983-45aa-855a-de7ea01cca40","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"50a769a7-5b0a-4546-9e12-4f0a3ceff21b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"98f8724f-6386-4023-82d5-7a24a74b9197","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_f5299fdf_a772_41d5_9925_c87ddaec8f1f"}],"description":"","message_list":[],"uuid":"a2a6978c-a5a6-452f-bcf6-f400091fed67","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"dc5bf7e0-2309-440d-9b60-954dfe78f38e"},"name":"SYS_GEN__Runbook_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f"}},{"description":"System action for starting an application","message_list":[],"uuid":"18448e09-2ffa-469d-8a5f-52127c866659","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"},"retries":"0","description":"","type":"DAG","uuid":"ec4c206b-48d0-4dfd-869e-3d082169aa07","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"2448be5b-e228-4243-84ae-27fa1094fe32"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2448be5b-e228-4243-84ae-27fa1094fe32","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"64e5991c-fbcd-4d1f-8b72-4b4956e9702e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"8a308a2e-ac3d-48ec-96ce-39d0c9a7b134","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"ec4c206b-48d0-4dfd-869e-3d082169aa07"},"name":"SYS_GEN__Runbook_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f"}},{"description":"System action for restarting an application","message_list":[],"uuid":"61143c5d-ea33-449b-a5f3-2b9cf21a9157","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"},"retries":"0","description":"","type":"DAG","uuid":"eaad4346-af24-44a3-801f-d14fd7e62cbe","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"0527b3f1-17f1-4af0-acd7-ab21f3260131"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0527b3f1-17f1-4af0-acd7-ab21f3260131","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"526cc0d4-3d9e-49c6-840b-f42e056f5d89"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"e64eef3f-a772-439e-8b64-04a286e9dd7d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"eaad4346-af24-44a3-801f-d14fd7e62cbe"},"name":"SYS_GEN__Runbook_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f"}},{"description":"System action for stopping an application","message_list":[],"uuid":"da0f0ba1-4cda-48a9-8a78-30b5f63f233e","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"},"retries":"0","description":"","type":"DAG","uuid":"639468e7-3cd5-46e5-b925-6207d47b97e6","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"6bb81773-eb1a-4318-86ed-99afb43f52ce"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6bb81773-eb1a-4318-86ed-99afb43f52ce","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"1fdd3541-2eca-471a-a4be-4ef82887d4de"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"ca372e28-793f-4893-82e3-c07ec1dcee48","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f","uuid":"639468e7-3cd5-46e5-b925-6207d47b97e6"},"name":"SYS_GEN__Runbook_Package_f5299fdf_a772_41d5_9925_c87ddaec8f1f"}}],"message_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"}],"uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f","state":"ACTIVE","version":"","editables":{},"type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"},"retries":"0","description":"","type":"DAG","uuid":"3e95d365-a94c-4a54-a32a-413b3dda3bc3","child_tasks_local_reference_list":[{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"ae887c8b-07cb-406f-9e98-e754397c60f9"},{"kind":"app_task","name":"Generate Certs","uuid":"62d7cfe4-5397-4406-aac1-a04663440978"},{"kind":"app_task","name":"Configure Services","uuid":"27ab8dc0-83f9-46d6-a5fa-aeadc0a3099c"},{"kind":"app_task","name":"Add User Roles","uuid":"f68681b7-1608-4521-afb5-e9a8a7f993d5"},{"kind":"app_task","name":"Network Configuration","uuid":"2fb0bd2a-71a3-47b5-9ea3-da3b8e1657cc"},{"kind":"app_task","name":"DNS Configuration","uuid":"5aaccd3e-a910-46c4-9085-1c25c540620e"},{"kind":"app_task","name":"EBS VolumePlugin","uuid":"8ced34e7-d77e-4662-96e2-dbea387d8f6b"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"ae887c8b-07cb-406f-9e98-e754397c60f9"},"edge_type":"user_defined","type":"","uuid":"19d18e5f-cac4-46d2-ac4e-5c32c79b414f","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"62d7cfe4-5397-4406-aac1-a04663440978"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"62d7cfe4-5397-4406-aac1-a04663440978"},"edge_type":"user_defined","type":"","uuid":"451bec00-f5a5-48f0-bc68-30f4edddc953","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"27ab8dc0-83f9-46d6-a5fa-aeadc0a3099c"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"27ab8dc0-83f9-46d6-a5fa-aeadc0a3099c"},"edge_type":"user_defined","type":"","uuid":"9840707b-0116-4f30-97cd-9c853ead8ba1","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"f68681b7-1608-4521-afb5-e9a8a7f993d5"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"f68681b7-1608-4521-afb5-e9a8a7f993d5"},"edge_type":"user_defined","type":"","uuid":"317bc858-5860-4bb3-9329-606d8321c9ed","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"2fb0bd2a-71a3-47b5-9ea3-da3b8e1657cc"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"2fb0bd2a-71a3-47b5-9ea3-da3b8e1657cc"},"edge_type":"user_defined","type":"","uuid":"c87a511c-c14b-41b3-a83e-490258a14794","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"5aaccd3e-a910-46c4-9085-1c25c540620e"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"5aaccd3e-a910-46c4-9085-1c25c540620e"},"edge_type":"user_defined","type":"","uuid":"27d573a3-86b6-4b70-8b8b-72232cfe0fe8","to_task_reference":{"kind":"app_task","name":"EBS VolumePlugin","uuid":"8ced34e7-d77e-4662-96e2-dbea387d8f6b"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"84e097cf_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"ae887c8b-07cb-406f-9e98-e754397c60f9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nMINION_IPS=\"@@{AWS_Centos_K8SM.private_ip_address}@@\" # private Ip's\nCONTROLLER_DNS=\"@@{calm_array_private_dns_name}@@\" # private Dns\nMINION_DNS=\"@@{AWS_Centos_K8SM.private_dns_name}@@\" # private Dns\nPUBLIC_CONTROLLER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_MINION_IPS=\"@@{AWS_Centos_K8SM.public_ip_address}@@\"\nPUBLIC_CONTROLLER_DNS=\"@@{calm_array_public_dns_name}@@\"\nPUBLIC_MINION_DNS=\"@@{AWS_Centos_K8SM.public_dns_name}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y --quiet\nsudo yum install -y wget iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} controller${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"controller${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')    \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=aws \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/xvd{b,c,d}\nsudo vgcreate etcd \/dev\/xvd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/xvd{e,f,g}\nsudo vgcreate docker \/dev\/xvd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"62d7cfe4-5397-4406-aac1-a04663440978","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nMINION_IPS=\"@@{AWS_Centos_K8SM.private_ip_address}@@\" # private Ip's\nCONTROLLER_DNS=\"@@{calm_array_private_dns_name}@@\" # private Dns\nMINION_DNS=\"@@{AWS_Centos_K8SM.private_dns_name}@@\" # private Dns\nPUBLIC_CONTROLLER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_MINION_IPS=\"@@{AWS_Centos_K8SM.public_ip_address}@@\"\nPUBLIC_CONTROLLER_DNS=\"@@{calm_array_public_dns_name}@@\"\nPUBLIC_MINION_DNS=\"@@{AWS_Centos_K8SM.public_dns_name}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${CONTROLLER_DNS},${PUBLIC_CONTROLLER_IPS},${PUBLIC_CONTROLLER_DNS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${CONTROLLER_DNS},${PUBLIC_CONTROLLER_IPS},${PUBLIC_CONTROLLER_DNS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${CONTROLLER_DNS},${PUBLIC_CONTROLLER_IPS},${PUBLIC_CONTROLLER_DNS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json \\\n-hostname=${CONTROLLER_NAMES},${CONTROLLER_IPS},${MINION_NAMES},${MINION_IPS},${FIRST_IP_SERVICE_SUBNET},${CONTROLLER_DNS},${MINION_DNS},${PUBLIC_CONTROLLER_IPS},${PUBLIC_MINION_IPS},${PUBLIC_CONTROLLER_DNS},${PUBLIC_MINION_DNS},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local \\\n-profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor name in $(echo ${CONTROLLER_DNS} | tr \",\" \"\\n\"); do\ninstance=\"controller${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${name}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${name},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor name in $(echo ${CONTROLLER_DNS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=controller${count}.kubeconfig\nkubectl config set-credentials system:node:${name} --client-certificate=controller${count}.pem --client-key=controller${count}-key.pem --embed-certs=true --kubeconfig=controller${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${name} --kubeconfig=controller${count}.kubeconfig\nkubectl config use-context default --kubeconfig=controller${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"controller${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"27ab8dc0-83f9-46d6-a5fa-aeadc0a3099c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nCONTROLLER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,AlwaysPullImages,DenyEscalatingExec,SecurityContextDeny,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --cloud-provider=aws\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --cloud-provider=aws\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n    \necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"f68681b7-1608-4521-afb5-e9a8a7f993d5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet\nsudo systemctl enable etcd docker kubelet\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem controller* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\n\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF\n\ncat <<EOF | kubectl apply -f -\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: kube-aws:node-proxier\nsubjects:\n  - kind: User\n    name: kube-worker\n  - kind: ServiceAccount\n    name: kube-proxy\n    namespace: kube-system\n  - kind: Group\n    name: system:nodes\nroleRef:\n  kind: ClusterRole\n  name: system:node-proxier\n  apiGroup: rbac.authorization.k8s.io\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"2fb0bd2a-71a3-47b5-9ea3-da3b8e1657cc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - \/etc\/kube-flannel\/cni-conf.json\n        - \/etc\/cni\/net.d\/10-flannel.conf\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"5aaccd3e-a910-46c4-9085-1c25c540620e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n    - name: dns\n      port: 53\n      protocol: UDP\n    - name: dns-tcp\n      port: 53\n      protocol: TCP\n---\napiVersion: apps\/v1beta2\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: gcr.io\/google_containers\/k8s-dns-kube-dns-amd64:1.14.10\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: gcr.io\/google_containers\/k8s-dns-dnsmasq-nanny-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: gcr.io\/google_containers\/k8s-dns-sidecar-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local.,5,A\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local.,5,A\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy:\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n\necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n# Remove the configmaps rule once below issue is fixed:\n# kubernetes-incubator\/cluster-proportional-autoscaler#16\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.1.2-r2\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          # Should keep target in sync with cluster\/addons\/dns\/kube-dns.yaml.base\n          - --target=Deployment\/kube-dns\n          # When cluster is using large nodes(with more cores), \"coresPerReplica\" should dominate.\n          # If using small nodes, \"nodesPerReplica\" should dominate.\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"8ced34e7-d77e-4662-96e2-dbea387d8f6b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nsudo mkdir \"\/etc\/kubernetes\/addons\/volume\"\n\necho 'apiVersion: storage.k8s.io\/v1\nkind: StorageClass\nmetadata:\n  name: gp2\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: EnsureExists\nprovisioner: kubernetes.io\/aws-ebs\nparameters:\n  type: gp2' | sudo tee \/etc\/kubernetes\/addons\/volume\/default.yaml\n \nkubectl create -f \/etc\/kubernetes\/addons\/volume\/default.yaml "},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"EBS VolumePlugin"}],"description":"","message_list":[],"uuid":"d4fe484c-2c80-4d34-8b40-d04671ae922f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"84e097cf_dag","uuid":"3e95d365-a94c-4a54-a32a-413b3dda3bc3"},"name":"e836616a_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"},"retries":"0","description":"","type":"DAG","uuid":"7c5fd8e1-85a1-474f-bd6d-164c75674fd9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"4226cd9d_dag"}],"description":"","message_list":[],"uuid":"9b4b2a26-89e0-411a-8a4a-e0f6c467a260","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"4226cd9d_dag","uuid":"7c5fd8e1-85a1-474f-bd6d-164c75674fd9"},"name":"18f2756f_runbook"}},"variable_list":[],"name":"AWS_Centos_K8SC_Package"},{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"7fd986a9-6f4d-4af8-837a-fc4c4faf30c4","name":"action_install","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"},"retries":"0","description":"","type":"DAG","uuid":"02340a62-1f81-4d47-9846-4c9e36ab0e24","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Install_Crb_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"211b289a-077d-41c6-bb4b-bb78668f7a5c"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_50dfc849_7772_4832_9398_4cd2048be3e7"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_INSTALL","uuid":"211b289a-077d-41c6-bb4b-bb78668f7a5c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"},"retries":"0","description":"","type":"DAG","uuid":"e6840876-1b4b-4c0d-a518-2e4bf606a471","child_tasks_local_reference_list":[{"kind":"app_task","name":"Docker Kubelet Install","uuid":"dde6d5e1-f54d-4fcc-b213-182e395ba3e8"},{"kind":"app_task","name":"GetCerts","uuid":"30c2402c-7460-4eae-a119-643e34f435a4"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"dde6d5e1-f54d-4fcc-b213-182e395ba3e8"},"edge_type":"user_defined","type":"","uuid":"a558b11d-a6f1-40d7-92ed-84faed5f4838","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"30c2402c-7460-4eae-a119-643e34f435a4"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"a4ecbecd_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"dde6d5e1-f54d-4fcc-b213-182e395ba3e8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{AWS_Centos_K8SC.private_ip_address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y --quiet\nsudo yum install -y wget socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\n\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=aws \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/usr\/share\/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/xvd{b,c,d}\nsudo vgcreate docker \/dev\/xvd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"30c2402c-7460-4eae-a119-643e34f435a4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{AWS_Centos_K8SC.private_ip_address[0]}@@\"\nINSTANCE_NAME=\"@@{private_dns_name}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nINSTANCE_IP=\"@@{private_ip_address}@@\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"minion@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${INSTANCE_NAME}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_NAME},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${INSTANCE_NAME} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${INSTANCE_NAME} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"6cab3c7d-2fa0-4fcb-82ee-4235185a4eef","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"a4ecbecd_dag","uuid":"e6840876-1b4b-4c0d-a518-2e4bf606a471"},"name":"dca27b9e_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"},"retries":"0","description":"","type":"DAG","uuid":"f7f78e88-c191-4734-983e-1c60616a57e8","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"46373590-3ec0-4217-8d9c-b5c658658ac7"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"9e5b50bc_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"46373590-3ec0-4217-8d9c-b5c658658ac7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain '@@{private_dns_name}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node '@@{private_dns_name}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"32c49af5-cd7c-401d-9bf4-4446c7582641","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"9e5b50bc_dag","uuid":"f7f78e88-c191-4734-983e-1c60616a57e8"},"name":"137c8a73_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Install_Crb_50dfc849_7772_4832_9398_4cd2048be3e7"}],"description":"","message_list":[],"uuid":"fb9ba7b7-3d51-4c90-9bbc-47181df49fd4","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"02340a62-1f81-4d47-9846-4c9e36ab0e24"},"name":"SYS_GEN__Runbook_Package_50dfc849_7772_4832_9398_4cd2048be3e7"}},{"description":"System action for creating an application","message_list":[],"uuid":"03c00697-bada-4983-8cda-afeadba67965","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"},"retries":"0","description":"","type":"DAG","uuid":"4e73f0fe-1111-4d4e-87e2-540310f1fcc3","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"3502c59d-ef74-4bc2-8376-a888fc44a558"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"dc32e48f-b079-4ab1-93ac-347dd8fe050a"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"62695b72-7a4e-477c-9bcb-f2362f326cd7"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"dc32e48f-b079-4ab1-93ac-347dd8fe050a"},"edge_type":"inherent","type":"","uuid":"6fb4180a-c2cd-4808-aab6-3635d7b258c6","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"62695b72-7a4e-477c-9bcb-f2362f326cd7"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"3502c59d-ef74-4bc2-8376-a888fc44a558"},"edge_type":"inherent","type":"","uuid":"f1fcc047-657c-4831-aab2-0b762238c4df","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"dc32e48f-b079-4ab1-93ac-347dd8fe050a"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_50dfc849_7772_4832_9398_4cd2048be3e7"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3502c59d-ef74-4bc2-8376-a888fc44a558","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"fb9ba7b7-3d51-4c90-9bbc-47181df49fd4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_50dfc849_7772_4832_9398_4cd2048be3e7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"dc32e48f-b079-4ab1-93ac-347dd8fe050a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"cabcfd41-35e6-45f0-a791-00daf17de059"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"62695b72-7a4e-477c-9bcb-f2362f326cd7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"91f453c1-d2fc-47b1-93d4-4b49476235be"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"7be6be70-de88-421a-a13f-24033931db50","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"4e73f0fe-1111-4d4e-87e2-540310f1fcc3"},"name":"SYS_GEN__Runbook_Package_50dfc849_7772_4832_9398_4cd2048be3e7"}},{"description":"System action for uninstalling an application","message_list":[],"uuid":"fa8437b9-5cd9-4271-8e87-74aa482552ee","name":"action_uninstall","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"},"retries":"0","description":"","type":"DAG","uuid":"fb17d879-8e53-4d08-a9a5-a439310f30b9","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Uninstall_Crb_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"cd43a5f9-c5c6-4638-972d-171e8254d78d"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_50dfc849_7772_4832_9398_4cd2048be3e7"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_UNINSTALL","uuid":"cd43a5f9-c5c6-4638-972d-171e8254d78d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"},"retries":"0","description":"","type":"DAG","uuid":"e6840876-1b4b-4c0d-a518-2e4bf606a471","child_tasks_local_reference_list":[{"kind":"app_task","name":"Docker Kubelet Install","uuid":"dde6d5e1-f54d-4fcc-b213-182e395ba3e8"},{"kind":"app_task","name":"GetCerts","uuid":"30c2402c-7460-4eae-a119-643e34f435a4"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"dde6d5e1-f54d-4fcc-b213-182e395ba3e8"},"edge_type":"user_defined","type":"","uuid":"a558b11d-a6f1-40d7-92ed-84faed5f4838","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"30c2402c-7460-4eae-a119-643e34f435a4"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"a4ecbecd_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"dde6d5e1-f54d-4fcc-b213-182e395ba3e8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{AWS_Centos_K8SC.private_ip_address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y --quiet\nsudo yum install -y wget socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\n\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=aws \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/usr\/share\/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/xvd{b,c,d}\nsudo vgcreate docker \/dev\/xvd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"30c2402c-7460-4eae-a119-643e34f435a4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{AWS_Centos_K8SC.private_ip_address[0]}@@\"\nINSTANCE_NAME=\"@@{private_dns_name}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nINSTANCE_IP=\"@@{private_ip_address}@@\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"minion@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${INSTANCE_NAME}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_NAME},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${INSTANCE_NAME} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${INSTANCE_NAME} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"6cab3c7d-2fa0-4fcb-82ee-4235185a4eef","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"a4ecbecd_dag","uuid":"e6840876-1b4b-4c0d-a518-2e4bf606a471"},"name":"dca27b9e_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"},"retries":"0","description":"","type":"DAG","uuid":"f7f78e88-c191-4734-983e-1c60616a57e8","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"46373590-3ec0-4217-8d9c-b5c658658ac7"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"9e5b50bc_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"46373590-3ec0-4217-8d9c-b5c658658ac7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain '@@{private_dns_name}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node '@@{private_dns_name}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"32c49af5-cd7c-401d-9bf4-4446c7582641","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"9e5b50bc_dag","uuid":"f7f78e88-c191-4734-983e-1c60616a57e8"},"name":"137c8a73_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Uninstall_Crb_50dfc849_7772_4832_9398_4cd2048be3e7"}],"description":"","message_list":[],"uuid":"ae954a62-63c8-4a91-8fa4-1cf584c94f3e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"fb17d879-8e53-4d08-a9a5-a439310f30b9"},"name":"SYS_GEN__Runbook_Package_50dfc849_7772_4832_9398_4cd2048be3e7"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"7c6747d3-3ec2-46ff-a8a6-32d220d6bb96","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"},"retries":"0","description":"","type":"DAG","uuid":"7726171e-afc6-489f-850d-6d069d94b1e7","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"a4012bc7-9d11-4594-879f-0985cb1f4c5f"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"a3e1c133-beba-4b60-9c05-195e528a6cb7"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"4e6e7999-c32e-4043-bacd-8b506914e555"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"a4012bc7-9d11-4594-879f-0985cb1f4c5f"},"edge_type":"inherent","type":"","uuid":"c9984fae-67f8-49a2-9242-354c142af118","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"a3e1c133-beba-4b60-9c05-195e528a6cb7"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"a3e1c133-beba-4b60-9c05-195e528a6cb7"},"edge_type":"inherent","type":"","uuid":"9460f5f4-5975-485c-bcb2-8ad93db841f8","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"4e6e7999-c32e-4043-bacd-8b506914e555"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_50dfc849_7772_4832_9398_4cd2048be3e7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a4012bc7-9d11-4594-879f-0985cb1f4c5f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12105be2-ee67-451d-8054-4546855e277c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a3e1c133-beba-4b60-9c05-195e528a6cb7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"6b0fd64c-e97f-4968-998d-ff058e95d9e9"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4e6e7999-c32e-4043-bacd-8b506914e555","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"ae954a62-63c8-4a91-8fa4-1cf584c94f3e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_50dfc849_7772_4832_9398_4cd2048be3e7"}],"description":"","message_list":[],"uuid":"1dbafa1d-d8de-492c-b7d9-b97fce8db8c0","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"7726171e-afc6-489f-850d-6d069d94b1e7"},"name":"SYS_GEN__Runbook_Package_50dfc849_7772_4832_9398_4cd2048be3e7"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"3f2f0238-46b7-4bca-83dc-2686d632954e","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"},"retries":"0","description":"","type":"DAG","uuid":"f6fa906f-2bf8-4864-96b7-1265f71aba8e","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"687848d3-8145-4ab6-ae74-a3fe4cbdf0b8"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"a8440260-5648-42f6-8e3b-8c34b26bbd8b"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"687848d3-8145-4ab6-ae74-a3fe4cbdf0b8"},"edge_type":"inherent","type":"","uuid":"be671a41-de4c-494c-96c9-cec1119f0ae4","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"a8440260-5648-42f6-8e3b-8c34b26bbd8b"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_50dfc849_7772_4832_9398_4cd2048be3e7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"687848d3-8145-4ab6-ae74-a3fe4cbdf0b8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"d44a642f-9468-432a-9b7e-e69a7c1c08e7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"a8440260-5648-42f6-8e3b-8c34b26bbd8b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_50dfc849_7772_4832_9398_4cd2048be3e7"}],"description":"","message_list":[],"uuid":"b22c0468-88fb-45b8-ab3b-c8b5ce2be6d9","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"f6fa906f-2bf8-4864-96b7-1265f71aba8e"},"name":"SYS_GEN__Runbook_Package_50dfc849_7772_4832_9398_4cd2048be3e7"}},{"description":"System action for starting an application","message_list":[],"uuid":"34f10c40-bd7f-48b9-b177-41e05882b15b","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"},"retries":"0","description":"","type":"DAG","uuid":"107202d8-9a53-4fa3-af7b-b58b82abc00a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"14417373-48cf-4263-a7a1-a828875e9bb8"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_50dfc849_7772_4832_9398_4cd2048be3e7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"14417373-48cf-4263-a7a1-a828875e9bb8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"91f453c1-d2fc-47b1-93d4-4b49476235be"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"018e0d82-8bd2-4178-90f9-767ebd2d8af4","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"107202d8-9a53-4fa3-af7b-b58b82abc00a"},"name":"SYS_GEN__Runbook_Package_50dfc849_7772_4832_9398_4cd2048be3e7"}},{"description":"System action for restarting an application","message_list":[],"uuid":"6184ff8b-a5bd-4515-b6ab-2f5d3677f1ca","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"},"retries":"0","description":"","type":"DAG","uuid":"87d8fb2d-6fc2-4f6f-a4ec-15dcabf4f41a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"cb9339db-36ab-4325-b547-f7b236ea064b"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_50dfc849_7772_4832_9398_4cd2048be3e7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"cb9339db-36ab-4325-b547-f7b236ea064b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"3fd75c09-a79f-4731-98fc-b65b96bc9fe7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"7c050351-8a21-4155-97dd-f5ff99e4c9b3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"87d8fb2d-6fc2-4f6f-a4ec-15dcabf4f41a"},"name":"SYS_GEN__Runbook_Package_50dfc849_7772_4832_9398_4cd2048be3e7"}},{"description":"System action for stopping an application","message_list":[],"uuid":"1ce90bce-d887-4759-a8b1-00d6b1c7b963","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"},"retries":"0","description":"","type":"DAG","uuid":"4ca2afb8-5f16-4ae6-92c6-e834333205dd","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"66721222-841c-41fe-951b-e8677266c3f3"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_50dfc849_7772_4832_9398_4cd2048be3e7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"66721222-841c-41fe-951b-e8677266c3f3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12105be2-ee67-451d-8054-4546855e277c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"c268208c-607b-4794-8ac9-2dc7cca7783f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_50dfc849_7772_4832_9398_4cd2048be3e7","uuid":"4ca2afb8-5f16-4ae6-92c6-e834333205dd"},"name":"SYS_GEN__Runbook_Package_50dfc849_7772_4832_9398_4cd2048be3e7"}}],"message_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"}],"uuid":"50dfc849-7772-4832-9398-4cd2048be3e7","state":"ACTIVE","version":"","editables":{},"type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"},"retries":"0","description":"","type":"DAG","uuid":"e6840876-1b4b-4c0d-a518-2e4bf606a471","child_tasks_local_reference_list":[{"kind":"app_task","name":"Docker Kubelet Install","uuid":"dde6d5e1-f54d-4fcc-b213-182e395ba3e8"},{"kind":"app_task","name":"GetCerts","uuid":"30c2402c-7460-4eae-a119-643e34f435a4"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"dde6d5e1-f54d-4fcc-b213-182e395ba3e8"},"edge_type":"user_defined","type":"","uuid":"a558b11d-a6f1-40d7-92ed-84faed5f4838","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"30c2402c-7460-4eae-a119-643e34f435a4"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"a4ecbecd_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"dde6d5e1-f54d-4fcc-b213-182e395ba3e8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{AWS_Centos_K8SC.private_ip_address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y --quiet\nsudo yum install -y wget socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\n\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=aws \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/usr\/share\/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/xvd{b,c,d}\nsudo vgcreate docker \/dev\/xvd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"30c2402c-7460-4eae-a119-643e34f435a4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{AWS_Centos_K8SC.private_ip_address[0]}@@\"\nINSTANCE_NAME=\"@@{private_dns_name}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nINSTANCE_IP=\"@@{private_ip_address}@@\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"minion@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${INSTANCE_NAME}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_NAME},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${INSTANCE_NAME} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${INSTANCE_NAME} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"6cab3c7d-2fa0-4fcb-82ee-4235185a4eef","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"a4ecbecd_dag","uuid":"e6840876-1b4b-4c0d-a518-2e4bf606a471"},"name":"dca27b9e_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"},"retries":"0","description":"","type":"DAG","uuid":"f7f78e88-c191-4734-983e-1c60616a57e8","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"46373590-3ec0-4217-8d9c-b5c658658ac7"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"9e5b50bc_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"46373590-3ec0-4217-8d9c-b5c658658ac7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain '@@{private_dns_name}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node '@@{private_dns_name}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"32c49af5-cd7c-401d-9bf4-4446c7582641","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"9e5b50bc_dag","uuid":"f7f78e88-c191-4734-983e-1c60616a57e8"},"name":"137c8a73_runbook"}},"variable_list":[],"name":"AWS_Centos_K8SM_Package"},{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"39845d02-f2b3-417a-9c62-202ac535568a","name":"action_install","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"},"retries":"0","description":"","type":"DAG","uuid":"e7b1dac6-fff8-4642-8baa-4b3627662e72","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Install_Crb_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"c95b7860-52a7-40de-b44e-de5db90d8e90"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_dd402e71_0337_4f3e_9693_06781cf08182"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_INSTALL","uuid":"c95b7860-52a7-40de-b44e-de5db90d8e90","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"},"retries":"0","description":"","type":"DAG","uuid":"559eed77-3aff-4acb-802d-f1ed459e873f","child_tasks_local_reference_list":[{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"da04bba9-146d-4e18-887a-da37740f264e"},{"kind":"app_task","name":"Generate Certs","uuid":"568fdbc4-b2b6-448c-b6ee-0f2b9cc0830b"},{"kind":"app_task","name":"Configure Services","uuid":"2254df0e-6a95-4e2c-9d28-5f2cdf5bddb4"},{"kind":"app_task","name":"Add User Roles","uuid":"74151a22-4838-4f85-ab0e-6e5b0ae55088"},{"kind":"app_task","name":"Network Configuration","uuid":"683e1064-65b1-429f-b3b9-50b47af2f850"},{"kind":"app_task","name":"DNS Configuration","uuid":"50ba6666-c348-4cd0-8ef8-a5952614f6ee"},{"kind":"app_task","name":"GCE VolumePlugin","uuid":"e16e35ed-1a7b-48f0-ba1f-708571cb5f79"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"da04bba9-146d-4e18-887a-da37740f264e"},"edge_type":"user_defined","type":"","uuid":"1706f67b-16c9-4a24-88c9-0c2c298462b6","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"568fdbc4-b2b6-448c-b6ee-0f2b9cc0830b"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"568fdbc4-b2b6-448c-b6ee-0f2b9cc0830b"},"edge_type":"user_defined","type":"","uuid":"9fb57511-54fc-46a5-891b-5e44f9806be4","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"2254df0e-6a95-4e2c-9d28-5f2cdf5bddb4"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"2254df0e-6a95-4e2c-9d28-5f2cdf5bddb4"},"edge_type":"user_defined","type":"","uuid":"a735c78b-6cc2-4522-88f9-ef4e0e484fda","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"74151a22-4838-4f85-ab0e-6e5b0ae55088"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"74151a22-4838-4f85-ab0e-6e5b0ae55088"},"edge_type":"user_defined","type":"","uuid":"2e425ea2-2648-41b2-9d71-2c15732129ae","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"683e1064-65b1-429f-b3b9-50b47af2f850"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"683e1064-65b1-429f-b3b9-50b47af2f850"},"edge_type":"user_defined","type":"","uuid":"72ef2452-716e-40d1-8e87-f2ee0b02eddf","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"50ba6666-c348-4cd0-8ef8-a5952614f6ee"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"50ba6666-c348-4cd0-8ef8-a5952614f6ee"},"edge_type":"user_defined","type":"","uuid":"43e357fd-01ad-4210-8422-aceab81cb29e","to_task_reference":{"kind":"app_task","name":"GCE VolumePlugin","uuid":"e16e35ed-1a7b-48f0-ba1f-708571cb5f79"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"e07e43b0_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"da04bba9-146d-4e18-887a-da37740f264e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nMINION_IPS=\"@@{GCP_Centos_K8SM.private_ip_address}@@\" # private Ip's\nPUBLIC_CONTROLLER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_MINION_IPS=\"@@{GCP_Centos_K8SM.public_ip_address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} controller${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"controller${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')    \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=gce \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate etcd \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/sd{e,f,g}\nsudo vgcreate docker \/dev\/sd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"568fdbc4-b2b6-448c-b6ee-0f2b9cc0830b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nMINION_IPS=\"@@{GCP_Centos_K8SM.private_ip_address}@@\" # private Ip's\nPUBLIC_CONTROLLER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_MINION_IPS=\"@@{GCP_Centos_K8SM.public_ip_address}@@\"\nCONTROLLER_HOSTNAMES=\"@@{calm_array_name}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${PUBLIC_CONTROLLER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${PUBLIC_CONTROLLER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${PUBLIC_CONTROLLER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json \\\n-hostname=${CONTROLLER_NAMES},${CONTROLLER_IPS},${MINION_NAMES},${MINION_IPS},${FIRST_IP_SERVICE_SUBNET},${PUBLIC_CONTROLLER_IPS},${PUBLIC_MINION_IPS},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local \\\n-profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor name in $(echo ${CONTROLLER_HOSTNAMES} | tr \",\" \"\\n\"); do\ninstance=\"controller${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${name}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${name},${INTERNAL_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor name in $(echo ${CONTROLLER_HOSTNAMES} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=controller${count}.kubeconfig\nkubectl config set-credentials system:node:${name} --client-certificate=controller${count}.pem --client-key=controller${count}-key.pem --embed-certs=true --kubeconfig=controller${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${name} --kubeconfig=controller${count}.kubeconfig\nkubectl config use-context default --kubeconfig=controller${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"controller${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"2254df0e-6a95-4e2c-9d28-5f2cdf5bddb4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nCONTROLLER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${NODE_NAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,AlwaysPullImages,DenyEscalatingExec,SecurityContextDeny,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --cloud-provider=gce\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --cloud-provider=gce\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n\necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"74151a22-4838-4f85-ab0e-6e5b0ae55088","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet\nsudo systemctl enable etcd docker kubelet\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem controller* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\n\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF\n\ncat <<EOF | kubectl apply -f -\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: kube-aws:node-proxier\nsubjects:\n  - kind: User\n    name: kube-worker\n  - kind: ServiceAccount\n    name: kube-proxy\n    namespace: kube-system\n  - kind: Group\n    name: system:nodes\nroleRef:\n  kind: ClusterRole\n  name: system:node-proxier\n  apiGroup: rbac.authorization.k8s.io\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"683e1064-65b1-429f-b3b9-50b47af2f850","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - \/etc\/kube-flannel\/cni-conf.json\n        - \/etc\/cni\/net.d\/10-flannel.conf\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"50ba6666-c348-4cd0-8ef8-a5952614f6ee","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n    - name: dns\n      port: 53\n      protocol: UDP\n    - name: dns-tcp\n      port: 53\n      protocol: TCP\n---\napiVersion: apps\/v1beta2\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: gcr.io\/google_containers\/k8s-dns-kube-dns-amd64:1.14.10\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: gcr.io\/google_containers\/k8s-dns-dnsmasq-nanny-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: gcr.io\/google_containers\/k8s-dns-sidecar-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local.,5,A\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local.,5,A\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy:\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n\necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n# Remove the configmaps rule once below issue is fixed:\n# kubernetes-incubator\/cluster-proportional-autoscaler#16\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.1.2-r2\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          # Should keep target in sync with cluster\/addons\/dns\/kube-dns.yaml.base\n          - --target=Deployment\/kube-dns\n          # When cluster is using large nodes(with more cores), \"coresPerReplica\" should dominate.\n          # If using small nodes, \"nodesPerReplica\" should dominate.\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"e16e35ed-1a7b-48f0-ba1f-708571cb5f79","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nsudo mkdir \"\/etc\/kubernetes\/addons\/volume\"\n\necho 'apiVersion: storage.k8s.io\/v1\nkind: StorageClass\nmetadata:\n  name: standard\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: EnsureExists\nprovisioner: kubernetes.io\/gce-pd\nparameters:\n  type: pd-standard' | sudo tee \/etc\/kubernetes\/addons\/volume\/default.yaml\n \nkubectl create -f \/etc\/kubernetes\/addons\/volume\/default.yaml "},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GCE VolumePlugin"}],"description":"","message_list":[],"uuid":"e25e73be-d602-4882-9b83-a4fbbebf963f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"e07e43b0_dag","uuid":"559eed77-3aff-4acb-802d-f1ed459e873f"},"name":"26c82c77_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"},"retries":"0","description":"","type":"DAG","uuid":"ad8e500e-fd6a-4d77-9d83-0103207f1663","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6bbde6e8_dag"}],"description":"","message_list":[],"uuid":"09ccd797-748f-4106-922e-b40a194592fe","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6bbde6e8_dag","uuid":"ad8e500e-fd6a-4d77-9d83-0103207f1663"},"name":"6eaeef4c_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Install_Crb_dd402e71_0337_4f3e_9693_06781cf08182"}],"description":"","message_list":[],"uuid":"5549bf8a-88d8-4690-9c7d-36ab75ab6c8b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"e7b1dac6-fff8-4642-8baa-4b3627662e72"},"name":"SYS_GEN__Runbook_Package_dd402e71_0337_4f3e_9693_06781cf08182"}},{"description":"System action for creating an application","message_list":[],"uuid":"6414132f-8fcb-4610-a339-83f1c51fac56","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"},"retries":"0","description":"","type":"DAG","uuid":"e308672b-acf0-4cb7-91a2-b9e7863abacd","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"2ccdb828-1cf8-4324-b37f-13464b44553c"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"17580d7a-e9c8-4fd9-ac07-f2cae9b8aac1"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"37c42be4-13cd-45db-b8cd-77dcdf56dbd0"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"17580d7a-e9c8-4fd9-ac07-f2cae9b8aac1"},"edge_type":"inherent","type":"","uuid":"4ae85e9b-e070-4698-9e42-93b3ae6812c2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"37c42be4-13cd-45db-b8cd-77dcdf56dbd0"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"2ccdb828-1cf8-4324-b37f-13464b44553c"},"edge_type":"inherent","type":"","uuid":"f197c460-c78d-424a-8aa6-5b4944ea2b37","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"17580d7a-e9c8-4fd9-ac07-f2cae9b8aac1"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_dd402e71_0337_4f3e_9693_06781cf08182"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2ccdb828-1cf8-4324-b37f-13464b44553c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"5549bf8a-88d8-4690-9c7d-36ab75ab6c8b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_dd402e71_0337_4f3e_9693_06781cf08182"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"17580d7a-e9c8-4fd9-ac07-f2cae9b8aac1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"aa8dd27e-4bd1-4b85-86c6-750c0a49579f"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"37c42be4-13cd-45db-b8cd-77dcdf56dbd0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"64e5991c-fbcd-4d1f-8b72-4b4956e9702e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"adffe0f9-f16d-4fe5-a148-3a9ea0d2ee9f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"e308672b-acf0-4cb7-91a2-b9e7863abacd"},"name":"SYS_GEN__Runbook_Package_dd402e71_0337_4f3e_9693_06781cf08182"}},{"description":"System action for uninstalling an application","message_list":[],"uuid":"df4d65bd-5fdf-4e53-979a-87e4f3d0261b","name":"action_uninstall","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"},"retries":"0","description":"","type":"DAG","uuid":"694728b4-2c46-4122-87a4-2ebbfaafcfc6","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Uninstall_Crb_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"95c3b1d4-5e6c-4167-a8cb-06ab37c9f519"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_dd402e71_0337_4f3e_9693_06781cf08182"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_UNINSTALL","uuid":"95c3b1d4-5e6c-4167-a8cb-06ab37c9f519","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"},"retries":"0","description":"","type":"DAG","uuid":"559eed77-3aff-4acb-802d-f1ed459e873f","child_tasks_local_reference_list":[{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"da04bba9-146d-4e18-887a-da37740f264e"},{"kind":"app_task","name":"Generate Certs","uuid":"568fdbc4-b2b6-448c-b6ee-0f2b9cc0830b"},{"kind":"app_task","name":"Configure Services","uuid":"2254df0e-6a95-4e2c-9d28-5f2cdf5bddb4"},{"kind":"app_task","name":"Add User Roles","uuid":"74151a22-4838-4f85-ab0e-6e5b0ae55088"},{"kind":"app_task","name":"Network Configuration","uuid":"683e1064-65b1-429f-b3b9-50b47af2f850"},{"kind":"app_task","name":"DNS Configuration","uuid":"50ba6666-c348-4cd0-8ef8-a5952614f6ee"},{"kind":"app_task","name":"GCE VolumePlugin","uuid":"e16e35ed-1a7b-48f0-ba1f-708571cb5f79"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"da04bba9-146d-4e18-887a-da37740f264e"},"edge_type":"user_defined","type":"","uuid":"1706f67b-16c9-4a24-88c9-0c2c298462b6","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"568fdbc4-b2b6-448c-b6ee-0f2b9cc0830b"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"568fdbc4-b2b6-448c-b6ee-0f2b9cc0830b"},"edge_type":"user_defined","type":"","uuid":"9fb57511-54fc-46a5-891b-5e44f9806be4","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"2254df0e-6a95-4e2c-9d28-5f2cdf5bddb4"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"2254df0e-6a95-4e2c-9d28-5f2cdf5bddb4"},"edge_type":"user_defined","type":"","uuid":"a735c78b-6cc2-4522-88f9-ef4e0e484fda","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"74151a22-4838-4f85-ab0e-6e5b0ae55088"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"74151a22-4838-4f85-ab0e-6e5b0ae55088"},"edge_type":"user_defined","type":"","uuid":"2e425ea2-2648-41b2-9d71-2c15732129ae","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"683e1064-65b1-429f-b3b9-50b47af2f850"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"683e1064-65b1-429f-b3b9-50b47af2f850"},"edge_type":"user_defined","type":"","uuid":"72ef2452-716e-40d1-8e87-f2ee0b02eddf","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"50ba6666-c348-4cd0-8ef8-a5952614f6ee"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"50ba6666-c348-4cd0-8ef8-a5952614f6ee"},"edge_type":"user_defined","type":"","uuid":"43e357fd-01ad-4210-8422-aceab81cb29e","to_task_reference":{"kind":"app_task","name":"GCE VolumePlugin","uuid":"e16e35ed-1a7b-48f0-ba1f-708571cb5f79"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"e07e43b0_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"da04bba9-146d-4e18-887a-da37740f264e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nMINION_IPS=\"@@{GCP_Centos_K8SM.private_ip_address}@@\" # private Ip's\nPUBLIC_CONTROLLER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_MINION_IPS=\"@@{GCP_Centos_K8SM.public_ip_address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} controller${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"controller${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')    \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=gce \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate etcd \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/sd{e,f,g}\nsudo vgcreate docker \/dev\/sd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"568fdbc4-b2b6-448c-b6ee-0f2b9cc0830b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nMINION_IPS=\"@@{GCP_Centos_K8SM.private_ip_address}@@\" # private Ip's\nPUBLIC_CONTROLLER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_MINION_IPS=\"@@{GCP_Centos_K8SM.public_ip_address}@@\"\nCONTROLLER_HOSTNAMES=\"@@{calm_array_name}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${PUBLIC_CONTROLLER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${PUBLIC_CONTROLLER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${PUBLIC_CONTROLLER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json \\\n-hostname=${CONTROLLER_NAMES},${CONTROLLER_IPS},${MINION_NAMES},${MINION_IPS},${FIRST_IP_SERVICE_SUBNET},${PUBLIC_CONTROLLER_IPS},${PUBLIC_MINION_IPS},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local \\\n-profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor name in $(echo ${CONTROLLER_HOSTNAMES} | tr \",\" \"\\n\"); do\ninstance=\"controller${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${name}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${name},${INTERNAL_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor name in $(echo ${CONTROLLER_HOSTNAMES} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=controller${count}.kubeconfig\nkubectl config set-credentials system:node:${name} --client-certificate=controller${count}.pem --client-key=controller${count}-key.pem --embed-certs=true --kubeconfig=controller${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${name} --kubeconfig=controller${count}.kubeconfig\nkubectl config use-context default --kubeconfig=controller${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"controller${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"2254df0e-6a95-4e2c-9d28-5f2cdf5bddb4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nCONTROLLER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${NODE_NAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,AlwaysPullImages,DenyEscalatingExec,SecurityContextDeny,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --cloud-provider=gce\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --cloud-provider=gce\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n\necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"74151a22-4838-4f85-ab0e-6e5b0ae55088","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet\nsudo systemctl enable etcd docker kubelet\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem controller* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\n\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF\n\ncat <<EOF | kubectl apply -f -\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: kube-aws:node-proxier\nsubjects:\n  - kind: User\n    name: kube-worker\n  - kind: ServiceAccount\n    name: kube-proxy\n    namespace: kube-system\n  - kind: Group\n    name: system:nodes\nroleRef:\n  kind: ClusterRole\n  name: system:node-proxier\n  apiGroup: rbac.authorization.k8s.io\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"683e1064-65b1-429f-b3b9-50b47af2f850","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - \/etc\/kube-flannel\/cni-conf.json\n        - \/etc\/cni\/net.d\/10-flannel.conf\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"50ba6666-c348-4cd0-8ef8-a5952614f6ee","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n    - name: dns\n      port: 53\n      protocol: UDP\n    - name: dns-tcp\n      port: 53\n      protocol: TCP\n---\napiVersion: apps\/v1beta2\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: gcr.io\/google_containers\/k8s-dns-kube-dns-amd64:1.14.10\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: gcr.io\/google_containers\/k8s-dns-dnsmasq-nanny-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: gcr.io\/google_containers\/k8s-dns-sidecar-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local.,5,A\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local.,5,A\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy:\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n\necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n# Remove the configmaps rule once below issue is fixed:\n# kubernetes-incubator\/cluster-proportional-autoscaler#16\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.1.2-r2\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          # Should keep target in sync with cluster\/addons\/dns\/kube-dns.yaml.base\n          - --target=Deployment\/kube-dns\n          # When cluster is using large nodes(with more cores), \"coresPerReplica\" should dominate.\n          # If using small nodes, \"nodesPerReplica\" should dominate.\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"e16e35ed-1a7b-48f0-ba1f-708571cb5f79","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nsudo mkdir \"\/etc\/kubernetes\/addons\/volume\"\n\necho 'apiVersion: storage.k8s.io\/v1\nkind: StorageClass\nmetadata:\n  name: standard\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: EnsureExists\nprovisioner: kubernetes.io\/gce-pd\nparameters:\n  type: pd-standard' | sudo tee \/etc\/kubernetes\/addons\/volume\/default.yaml\n \nkubectl create -f \/etc\/kubernetes\/addons\/volume\/default.yaml "},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GCE VolumePlugin"}],"description":"","message_list":[],"uuid":"e25e73be-d602-4882-9b83-a4fbbebf963f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"e07e43b0_dag","uuid":"559eed77-3aff-4acb-802d-f1ed459e873f"},"name":"26c82c77_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"},"retries":"0","description":"","type":"DAG","uuid":"ad8e500e-fd6a-4d77-9d83-0103207f1663","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6bbde6e8_dag"}],"description":"","message_list":[],"uuid":"09ccd797-748f-4106-922e-b40a194592fe","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6bbde6e8_dag","uuid":"ad8e500e-fd6a-4d77-9d83-0103207f1663"},"name":"6eaeef4c_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Uninstall_Crb_dd402e71_0337_4f3e_9693_06781cf08182"}],"description":"","message_list":[],"uuid":"6173244d-f073-4e90-a370-9f2c307d4036","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"694728b4-2c46-4122-87a4-2ebbfaafcfc6"},"name":"SYS_GEN__Runbook_Package_dd402e71_0337_4f3e_9693_06781cf08182"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"584fe05a-057b-429e-95f2-a9499b18cb45","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"},"retries":"0","description":"","type":"DAG","uuid":"02b74cb7-e912-44eb-b75c-33a11ed25ca3","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"73a64861-64a4-4247-ae2c-c1131ebb154d"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"f9a93902-e00d-46d5-baf6-74f097440e7c"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"8369e386-58ea-4225-80cf-8f31411fe451"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"73a64861-64a4-4247-ae2c-c1131ebb154d"},"edge_type":"inherent","type":"","uuid":"71dc2239-05d4-412e-8205-9f77c341c1ee","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"f9a93902-e00d-46d5-baf6-74f097440e7c"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"f9a93902-e00d-46d5-baf6-74f097440e7c"},"edge_type":"inherent","type":"","uuid":"c96266dd-229e-4254-a921-8ac81f900864","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"8369e386-58ea-4225-80cf-8f31411fe451"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_dd402e71_0337_4f3e_9693_06781cf08182"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"73a64861-64a4-4247-ae2c-c1131ebb154d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"1fdd3541-2eca-471a-a4be-4ef82887d4de"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f9a93902-e00d-46d5-baf6-74f097440e7c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"a2ac512f-d272-4905-bafb-4733f7e58c9b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8369e386-58ea-4225-80cf-8f31411fe451","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"6173244d-f073-4e90-a370-9f2c307d4036"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_dd402e71_0337_4f3e_9693_06781cf08182"}],"description":"","message_list":[],"uuid":"91fe307a-29ef-49f9-817c-bbfc817afda8","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"02b74cb7-e912-44eb-b75c-33a11ed25ca3"},"name":"SYS_GEN__Runbook_Package_dd402e71_0337_4f3e_9693_06781cf08182"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"771081e0-7c4e-499f-a3f4-1a7e15d8b001","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"},"retries":"0","description":"","type":"DAG","uuid":"c603b46b-043e-42d4-960d-88fcba4f4a6c","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"85f5c893-20a7-4301-bede-415afe05fd44"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"21c085ba-ef33-4d06-b428-9de66a87cfec"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"85f5c893-20a7-4301-bede-415afe05fd44"},"edge_type":"inherent","type":"","uuid":"1d854db2-29ba-406d-bb1d-1b1a9084bb47","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"21c085ba-ef33-4d06-b428-9de66a87cfec"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_dd402e71_0337_4f3e_9693_06781cf08182"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"85f5c893-20a7-4301-bede-415afe05fd44","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"50a769a7-5b0a-4546-9e12-4f0a3ceff21b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"21c085ba-ef33-4d06-b428-9de66a87cfec","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_dd402e71_0337_4f3e_9693_06781cf08182"}],"description":"","message_list":[],"uuid":"5ad2689c-f394-46cd-8900-4175ee01a457","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"c603b46b-043e-42d4-960d-88fcba4f4a6c"},"name":"SYS_GEN__Runbook_Package_dd402e71_0337_4f3e_9693_06781cf08182"}},{"description":"System action for starting an application","message_list":[],"uuid":"d6ffea47-1a50-47ba-aa9c-b8fbbc15f96a","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"},"retries":"0","description":"","type":"DAG","uuid":"31865ce0-6c3c-40cb-8d45-559714eed125","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"81cbf044-254f-4365-906b-2df84f583bf9"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_dd402e71_0337_4f3e_9693_06781cf08182"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"81cbf044-254f-4365-906b-2df84f583bf9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"64e5991c-fbcd-4d1f-8b72-4b4956e9702e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"3ea05190-10d3-4e2c-83ad-bee65aef17c8","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"31865ce0-6c3c-40cb-8d45-559714eed125"},"name":"SYS_GEN__Runbook_Package_dd402e71_0337_4f3e_9693_06781cf08182"}},{"description":"System action for restarting an application","message_list":[],"uuid":"46cb2fb2-30bd-475e-9fcf-5876daadc238","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"},"retries":"0","description":"","type":"DAG","uuid":"493d8f2c-46e8-4fe9-a1b9-981dfd7c6ab5","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"eb2e75e7-5f97-4dd3-99a5-c8b805fe0691"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_dd402e71_0337_4f3e_9693_06781cf08182"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"eb2e75e7-5f97-4dd3-99a5-c8b805fe0691","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"526cc0d4-3d9e-49c6-840b-f42e056f5d89"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"5828e761-475d-441f-814d-47965bc5578b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"493d8f2c-46e8-4fe9-a1b9-981dfd7c6ab5"},"name":"SYS_GEN__Runbook_Package_dd402e71_0337_4f3e_9693_06781cf08182"}},{"description":"System action for stopping an application","message_list":[],"uuid":"477ea989-01fa-4e4a-8afa-a31e48f38eac","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"},"retries":"0","description":"","type":"DAG","uuid":"a372de27-2c17-41a2-aa3d-5733785df352","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"0a687e44-650f-4a9d-b610-3c85699d5a21"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_dd402e71_0337_4f3e_9693_06781cf08182"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0a687e44-650f-4a9d-b610-3c85699d5a21","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"1fdd3541-2eca-471a-a4be-4ef82887d4de"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"878341fc-042a-4b85-b206-94e560994c44","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_dd402e71_0337_4f3e_9693_06781cf08182","uuid":"a372de27-2c17-41a2-aa3d-5733785df352"},"name":"SYS_GEN__Runbook_Package_dd402e71_0337_4f3e_9693_06781cf08182"}}],"message_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"}],"uuid":"dd402e71-0337-4f3e-9693-06781cf08182","state":"ACTIVE","version":"","editables":{},"type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"},"retries":"0","description":"","type":"DAG","uuid":"559eed77-3aff-4acb-802d-f1ed459e873f","child_tasks_local_reference_list":[{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"da04bba9-146d-4e18-887a-da37740f264e"},{"kind":"app_task","name":"Generate Certs","uuid":"568fdbc4-b2b6-448c-b6ee-0f2b9cc0830b"},{"kind":"app_task","name":"Configure Services","uuid":"2254df0e-6a95-4e2c-9d28-5f2cdf5bddb4"},{"kind":"app_task","name":"Add User Roles","uuid":"74151a22-4838-4f85-ab0e-6e5b0ae55088"},{"kind":"app_task","name":"Network Configuration","uuid":"683e1064-65b1-429f-b3b9-50b47af2f850"},{"kind":"app_task","name":"DNS Configuration","uuid":"50ba6666-c348-4cd0-8ef8-a5952614f6ee"},{"kind":"app_task","name":"GCE VolumePlugin","uuid":"e16e35ed-1a7b-48f0-ba1f-708571cb5f79"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"da04bba9-146d-4e18-887a-da37740f264e"},"edge_type":"user_defined","type":"","uuid":"1706f67b-16c9-4a24-88c9-0c2c298462b6","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"568fdbc4-b2b6-448c-b6ee-0f2b9cc0830b"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"568fdbc4-b2b6-448c-b6ee-0f2b9cc0830b"},"edge_type":"user_defined","type":"","uuid":"9fb57511-54fc-46a5-891b-5e44f9806be4","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"2254df0e-6a95-4e2c-9d28-5f2cdf5bddb4"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"2254df0e-6a95-4e2c-9d28-5f2cdf5bddb4"},"edge_type":"user_defined","type":"","uuid":"a735c78b-6cc2-4522-88f9-ef4e0e484fda","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"74151a22-4838-4f85-ab0e-6e5b0ae55088"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"74151a22-4838-4f85-ab0e-6e5b0ae55088"},"edge_type":"user_defined","type":"","uuid":"2e425ea2-2648-41b2-9d71-2c15732129ae","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"683e1064-65b1-429f-b3b9-50b47af2f850"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"683e1064-65b1-429f-b3b9-50b47af2f850"},"edge_type":"user_defined","type":"","uuid":"72ef2452-716e-40d1-8e87-f2ee0b02eddf","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"50ba6666-c348-4cd0-8ef8-a5952614f6ee"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"50ba6666-c348-4cd0-8ef8-a5952614f6ee"},"edge_type":"user_defined","type":"","uuid":"43e357fd-01ad-4210-8422-aceab81cb29e","to_task_reference":{"kind":"app_task","name":"GCE VolumePlugin","uuid":"e16e35ed-1a7b-48f0-ba1f-708571cb5f79"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"e07e43b0_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"da04bba9-146d-4e18-887a-da37740f264e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nMINION_IPS=\"@@{GCP_Centos_K8SM.private_ip_address}@@\" # private Ip's\nPUBLIC_CONTROLLER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_MINION_IPS=\"@@{GCP_Centos_K8SM.public_ip_address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} controller${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"controller${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')    \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=gce \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate etcd \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/sd{e,f,g}\nsudo vgcreate docker \/dev\/sd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"568fdbc4-b2b6-448c-b6ee-0f2b9cc0830b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nMINION_IPS=\"@@{GCP_Centos_K8SM.private_ip_address}@@\" # private Ip's\nPUBLIC_CONTROLLER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_MINION_IPS=\"@@{GCP_Centos_K8SM.public_ip_address}@@\"\nCONTROLLER_HOSTNAMES=\"@@{calm_array_name}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${PUBLIC_CONTROLLER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${PUBLIC_CONTROLLER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${PUBLIC_CONTROLLER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json \\\n-hostname=${CONTROLLER_NAMES},${CONTROLLER_IPS},${MINION_NAMES},${MINION_IPS},${FIRST_IP_SERVICE_SUBNET},${PUBLIC_CONTROLLER_IPS},${PUBLIC_MINION_IPS},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local \\\n-profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor name in $(echo ${CONTROLLER_HOSTNAMES} | tr \",\" \"\\n\"); do\ninstance=\"controller${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${name}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${name},${INTERNAL_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor name in $(echo ${CONTROLLER_HOSTNAMES} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=controller${count}.kubeconfig\nkubectl config set-credentials system:node:${name} --client-certificate=controller${count}.pem --client-key=controller${count}-key.pem --embed-certs=true --kubeconfig=controller${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${name} --kubeconfig=controller${count}.kubeconfig\nkubectl config use-context default --kubeconfig=controller${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"controller${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"2254df0e-6a95-4e2c-9d28-5f2cdf5bddb4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nCONTROLLER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${NODE_NAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,AlwaysPullImages,DenyEscalatingExec,SecurityContextDeny,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --cloud-provider=gce\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --cloud-provider=gce\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n\necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"74151a22-4838-4f85-ab0e-6e5b0ae55088","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet\nsudo systemctl enable etcd docker kubelet\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem controller* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\n\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF\n\ncat <<EOF | kubectl apply -f -\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: kube-aws:node-proxier\nsubjects:\n  - kind: User\n    name: kube-worker\n  - kind: ServiceAccount\n    name: kube-proxy\n    namespace: kube-system\n  - kind: Group\n    name: system:nodes\nroleRef:\n  kind: ClusterRole\n  name: system:node-proxier\n  apiGroup: rbac.authorization.k8s.io\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"683e1064-65b1-429f-b3b9-50b47af2f850","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - \/etc\/kube-flannel\/cni-conf.json\n        - \/etc\/cni\/net.d\/10-flannel.conf\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"50ba6666-c348-4cd0-8ef8-a5952614f6ee","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n    - name: dns\n      port: 53\n      protocol: UDP\n    - name: dns-tcp\n      port: 53\n      protocol: TCP\n---\napiVersion: apps\/v1beta2\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: gcr.io\/google_containers\/k8s-dns-kube-dns-amd64:1.14.10\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: gcr.io\/google_containers\/k8s-dns-dnsmasq-nanny-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: gcr.io\/google_containers\/k8s-dns-sidecar-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local.,5,A\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local.,5,A\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy:\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n\necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n# Remove the configmaps rule once below issue is fixed:\n# kubernetes-incubator\/cluster-proportional-autoscaler#16\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.1.2-r2\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          # Should keep target in sync with cluster\/addons\/dns\/kube-dns.yaml.base\n          - --target=Deployment\/kube-dns\n          # When cluster is using large nodes(with more cores), \"coresPerReplica\" should dominate.\n          # If using small nodes, \"nodesPerReplica\" should dominate.\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"e16e35ed-1a7b-48f0-ba1f-708571cb5f79","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nsudo mkdir \"\/etc\/kubernetes\/addons\/volume\"\n\necho 'apiVersion: storage.k8s.io\/v1\nkind: StorageClass\nmetadata:\n  name: standard\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: EnsureExists\nprovisioner: kubernetes.io\/gce-pd\nparameters:\n  type: pd-standard' | sudo tee \/etc\/kubernetes\/addons\/volume\/default.yaml\n \nkubectl create -f \/etc\/kubernetes\/addons\/volume\/default.yaml "},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GCE VolumePlugin"}],"description":"","message_list":[],"uuid":"e25e73be-d602-4882-9b83-a4fbbebf963f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"e07e43b0_dag","uuid":"559eed77-3aff-4acb-802d-f1ed459e873f"},"name":"26c82c77_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"},"retries":"0","description":"","type":"DAG","uuid":"ad8e500e-fd6a-4d77-9d83-0103207f1663","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6bbde6e8_dag"}],"description":"","message_list":[],"uuid":"09ccd797-748f-4106-922e-b40a194592fe","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6bbde6e8_dag","uuid":"ad8e500e-fd6a-4d77-9d83-0103207f1663"},"name":"6eaeef4c_runbook"}},"variable_list":[],"name":"GCP_Centos_K8SC_Package"},{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"a2500af9-91c2-4565-a50d-fbd6d7202e65","name":"action_install","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"},"retries":"0","description":"","type":"DAG","uuid":"1fc90d70-0084-48f3-9e69-b47d8fc08f30","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Install_Crb_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"58520446-219c-4458-a1af-994dd57a6174"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_INSTALL","uuid":"58520446-219c-4458-a1af-994dd57a6174","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"},"retries":"0","description":"","type":"DAG","uuid":"8f5ad9c9-8e6d-4b1e-8268-1917a1ae85a3","child_tasks_local_reference_list":[{"kind":"app_task","name":"Docker Kubelet Install","uuid":"e5f2c484-b93e-4ac8-a174-87a95eb7a763"},{"kind":"app_task","name":"GetCerts","uuid":"e9f3aa03-aca4-44dd-b361-8f8182f6f985"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"e5f2c484-b93e-4ac8-a174-87a95eb7a763"},"edge_type":"user_defined","type":"","uuid":"620ef3f5-4f05-4eda-b27e-b05ceab8f969","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"e9f3aa03-aca4-44dd-b361-8f8182f6f985"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"709f9264_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"e5f2c484-b93e-4ac8-a174-87a95eb7a763","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{GCP_Centos_K8SC.private_ip_address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\n\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=gce \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/usr\/share\/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"e9f3aa03-aca4-44dd-b361-8f8182f6f985","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{GCP_Centos_K8SC.private_ip_address[0]}@@\"\nINSTANCE_IP=\"@@{private_ip_address}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"minion@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${HOSTNAME}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${HOSTNAME},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${HOSTNAME} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${HOSTNAME} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"db6899f7-707f-458d-bc65-c104ed29f99f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"709f9264_dag","uuid":"8f5ad9c9-8e6d-4b1e-8268-1917a1ae85a3"},"name":"927472a7_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"},"retries":"0","description":"","type":"DAG","uuid":"9bd60227-c678-4c9d-b4d4-0b6ac9e4e9ba","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"406548b2-4327-4062-a2a6-2c8700cfad8e"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"fef85962_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"406548b2-4327-4062-a2a6-2c8700cfad8e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nNODE_NAME=${HOSTNAME}\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain '${NODE_NAME}' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node '${NODE_NAME}'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"1539e5db-916b-4a29-b617-aa92e68201bd","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"fef85962_dag","uuid":"9bd60227-c678-4c9d-b4d4-0b6ac9e4e9ba"},"name":"435393f9_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Install_Crb_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa"}],"description":"","message_list":[],"uuid":"54801dfd-81bb-487c-ae84-55bc739ded6a","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"1fc90d70-0084-48f3-9e69-b47d8fc08f30"},"name":"SYS_GEN__Runbook_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa"}},{"description":"System action for creating an application","message_list":[],"uuid":"10868cbc-4c35-4816-8a74-c285a7c93b4d","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"},"retries":"0","description":"","type":"DAG","uuid":"4f4f3809-4b3c-47fe-8e8b-b1572fc34c15","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"7ee882eb-ed9b-4efb-9642-514d14224edd"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"3fbbe7ae-6257-4158-a740-54cf69a52f5d"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"67ed4bb2-433b-4229-a755-33ae7a24927c"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"3fbbe7ae-6257-4158-a740-54cf69a52f5d"},"edge_type":"inherent","type":"","uuid":"7f9d4128-6288-4e2f-838d-d4cab1fe5aac","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"67ed4bb2-433b-4229-a755-33ae7a24927c"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"7ee882eb-ed9b-4efb-9642-514d14224edd"},"edge_type":"inherent","type":"","uuid":"25239987-1b6f-4220-9496-fecb100d9306","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"3fbbe7ae-6257-4158-a740-54cf69a52f5d"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"7ee882eb-ed9b-4efb-9642-514d14224edd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"54801dfd-81bb-487c-ae84-55bc739ded6a"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3fbbe7ae-6257-4158-a740-54cf69a52f5d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"cabcfd41-35e6-45f0-a791-00daf17de059"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"67ed4bb2-433b-4229-a755-33ae7a24927c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"91f453c1-d2fc-47b1-93d4-4b49476235be"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"931b95b2-7ada-4028-9bb1-918503149d4f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"4f4f3809-4b3c-47fe-8e8b-b1572fc34c15"},"name":"SYS_GEN__Runbook_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa"}},{"description":"System action for uninstalling an application","message_list":[],"uuid":"3fa70375-d2f1-4937-8370-a8de130d4697","name":"action_uninstall","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"},"retries":"0","description":"","type":"DAG","uuid":"a8d92d4a-ce1c-495a-af6f-30b1e5198582","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Uninstall_Crb_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"eb4cc862-68d7-41c5-8f5f-f24ed5dfb472"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_UNINSTALL","uuid":"eb4cc862-68d7-41c5-8f5f-f24ed5dfb472","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"},"retries":"0","description":"","type":"DAG","uuid":"8f5ad9c9-8e6d-4b1e-8268-1917a1ae85a3","child_tasks_local_reference_list":[{"kind":"app_task","name":"Docker Kubelet Install","uuid":"e5f2c484-b93e-4ac8-a174-87a95eb7a763"},{"kind":"app_task","name":"GetCerts","uuid":"e9f3aa03-aca4-44dd-b361-8f8182f6f985"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"e5f2c484-b93e-4ac8-a174-87a95eb7a763"},"edge_type":"user_defined","type":"","uuid":"620ef3f5-4f05-4eda-b27e-b05ceab8f969","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"e9f3aa03-aca4-44dd-b361-8f8182f6f985"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"709f9264_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"e5f2c484-b93e-4ac8-a174-87a95eb7a763","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{GCP_Centos_K8SC.private_ip_address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\n\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=gce \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/usr\/share\/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"e9f3aa03-aca4-44dd-b361-8f8182f6f985","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{GCP_Centos_K8SC.private_ip_address[0]}@@\"\nINSTANCE_IP=\"@@{private_ip_address}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"minion@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${HOSTNAME}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${HOSTNAME},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${HOSTNAME} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${HOSTNAME} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"db6899f7-707f-458d-bc65-c104ed29f99f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"709f9264_dag","uuid":"8f5ad9c9-8e6d-4b1e-8268-1917a1ae85a3"},"name":"927472a7_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"},"retries":"0","description":"","type":"DAG","uuid":"9bd60227-c678-4c9d-b4d4-0b6ac9e4e9ba","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"406548b2-4327-4062-a2a6-2c8700cfad8e"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"fef85962_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"406548b2-4327-4062-a2a6-2c8700cfad8e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nNODE_NAME=${HOSTNAME}\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain '${NODE_NAME}' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node '${NODE_NAME}'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"1539e5db-916b-4a29-b617-aa92e68201bd","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"fef85962_dag","uuid":"9bd60227-c678-4c9d-b4d4-0b6ac9e4e9ba"},"name":"435393f9_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Uninstall_Crb_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa"}],"description":"","message_list":[],"uuid":"6158fa37-c9a9-4d57-890b-2f587cc5c20d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"a8d92d4a-ce1c-495a-af6f-30b1e5198582"},"name":"SYS_GEN__Runbook_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"e92cb1fe-5bae-420d-b453-7806d3b5a501","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"},"retries":"0","description":"","type":"DAG","uuid":"24557bef-22f3-4603-a301-c6613e5fdbdd","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"79126083-3770-40e9-989d-ac9cc685a993"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"8e75c871-4fab-431d-ae6c-4093ed342e1e"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"ab19ae34-6f48-46f5-b7bc-d13bdb5fbeaa"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"79126083-3770-40e9-989d-ac9cc685a993"},"edge_type":"inherent","type":"","uuid":"10056606-be22-448d-b2c7-20bfdfb813ac","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"8e75c871-4fab-431d-ae6c-4093ed342e1e"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"8e75c871-4fab-431d-ae6c-4093ed342e1e"},"edge_type":"inherent","type":"","uuid":"fcd943e4-fb73-438b-b143-e5c911b47066","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"ab19ae34-6f48-46f5-b7bc-d13bdb5fbeaa"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"79126083-3770-40e9-989d-ac9cc685a993","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12105be2-ee67-451d-8054-4546855e277c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8e75c871-4fab-431d-ae6c-4093ed342e1e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"6b0fd64c-e97f-4968-998d-ff058e95d9e9"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ab19ae34-6f48-46f5-b7bc-d13bdb5fbeaa","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"6158fa37-c9a9-4d57-890b-2f587cc5c20d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa"}],"description":"","message_list":[],"uuid":"d70d162f-61e5-439d-b4a3-5dfcc8520a68","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"24557bef-22f3-4603-a301-c6613e5fdbdd"},"name":"SYS_GEN__Runbook_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"44d299fd-68a7-4b65-b6fa-b349da2c2d20","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"},"retries":"0","description":"","type":"DAG","uuid":"129d6e5c-1a61-488a-b3de-9701e87c64a6","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"87a47625-43f9-44ad-8395-0dce1294b087"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"90b4348b-0bba-40b9-bf16-3745b0da8e1b"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"87a47625-43f9-44ad-8395-0dce1294b087"},"edge_type":"inherent","type":"","uuid":"5e4b319e-5c6c-4296-bcfd-cbecf6bdeaa9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"90b4348b-0bba-40b9-bf16-3745b0da8e1b"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"87a47625-43f9-44ad-8395-0dce1294b087","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"d44a642f-9468-432a-9b7e-e69a7c1c08e7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"90b4348b-0bba-40b9-bf16-3745b0da8e1b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa"}],"description":"","message_list":[],"uuid":"8be2f46d-74aa-450a-ae3f-d92e96e91efa","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"129d6e5c-1a61-488a-b3de-9701e87c64a6"},"name":"SYS_GEN__Runbook_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa"}},{"description":"System action for starting an application","message_list":[],"uuid":"536aad01-5bf3-40cb-8917-3312144ae2cb","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"},"retries":"0","description":"","type":"DAG","uuid":"c5c416a1-7a7d-44ea-aade-332bd2be2ea7","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"3fe41959-b938-4bd5-8799-2e9f60b42d48"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3fe41959-b938-4bd5-8799-2e9f60b42d48","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"91f453c1-d2fc-47b1-93d4-4b49476235be"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"1d444756-1e76-4cbd-96d5-b6db1da04ae3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"c5c416a1-7a7d-44ea-aade-332bd2be2ea7"},"name":"SYS_GEN__Runbook_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa"}},{"description":"System action for restarting an application","message_list":[],"uuid":"f36bd7b9-18e4-4e5e-b132-ccce3aaddbd5","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"},"retries":"0","description":"","type":"DAG","uuid":"a0486342-f128-4180-86c4-a7f1c2f3a82e","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"f9923408-ebd6-4124-8e86-fc1ba4a22751"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f9923408-ebd6-4124-8e86-fc1ba4a22751","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"3fd75c09-a79f-4731-98fc-b65b96bc9fe7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"271a10be-817b-4e32-8a62-69f772787f64","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"a0486342-f128-4180-86c4-a7f1c2f3a82e"},"name":"SYS_GEN__Runbook_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa"}},{"description":"System action for stopping an application","message_list":[],"uuid":"d65f804e-63ac-44f5-9e5a-f2de8196e6fa","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"},"retries":"0","description":"","type":"DAG","uuid":"b534508d-fb54-42b9-9afa-a5da37436966","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"c2bc010a-3e12-4d3c-b59c-efa78d98cb03"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c2bc010a-3e12-4d3c-b59c-efa78d98cb03","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12105be2-ee67-451d-8054-4546855e277c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"70d2e0c6-8afe-4481-b00d-73a9cd610b96","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa","uuid":"b534508d-fb54-42b9-9afa-a5da37436966"},"name":"SYS_GEN__Runbook_Package_22066004_dfcf_4ce2_ba9e_2f1be8f04eaa"}}],"message_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"}],"uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa","state":"ACTIVE","version":"","editables":{},"type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"},"retries":"0","description":"","type":"DAG","uuid":"8f5ad9c9-8e6d-4b1e-8268-1917a1ae85a3","child_tasks_local_reference_list":[{"kind":"app_task","name":"Docker Kubelet Install","uuid":"e5f2c484-b93e-4ac8-a174-87a95eb7a763"},{"kind":"app_task","name":"GetCerts","uuid":"e9f3aa03-aca4-44dd-b361-8f8182f6f985"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"e5f2c484-b93e-4ac8-a174-87a95eb7a763"},"edge_type":"user_defined","type":"","uuid":"620ef3f5-4f05-4eda-b27e-b05ceab8f969","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"e9f3aa03-aca4-44dd-b361-8f8182f6f985"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"709f9264_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"e5f2c484-b93e-4ac8-a174-87a95eb7a763","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{GCP_Centos_K8SC.private_ip_address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\n\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=gce \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/usr\/share\/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"e9f3aa03-aca4-44dd-b361-8f8182f6f985","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{GCP_Centos_K8SC.private_ip_address[0]}@@\"\nINSTANCE_IP=\"@@{private_ip_address}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"minion@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${HOSTNAME}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${HOSTNAME},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${HOSTNAME} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${HOSTNAME} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"db6899f7-707f-458d-bc65-c104ed29f99f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"709f9264_dag","uuid":"8f5ad9c9-8e6d-4b1e-8268-1917a1ae85a3"},"name":"927472a7_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"},"retries":"0","description":"","type":"DAG","uuid":"9bd60227-c678-4c9d-b4d4-0b6ac9e4e9ba","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"406548b2-4327-4062-a2a6-2c8700cfad8e"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"fef85962_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"406548b2-4327-4062-a2a6-2c8700cfad8e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nNODE_NAME=${HOSTNAME}\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain '${NODE_NAME}' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node '${NODE_NAME}'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"1539e5db-916b-4a29-b617-aa92e68201bd","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"fef85962_dag","uuid":"9bd60227-c678-4c9d-b4d4-0b6ac9e4e9ba"},"name":"435393f9_runbook"}},"variable_list":[],"name":"GCP_Centos_K8SM_Package"},{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"5e16c05d-7ff4-45d1-983a-7d7cefa11def","name":"action_install","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"CENTOS_74","uuid":"6cbb9b5f-3255-4d45-8d8f-0891f27ac147"},"retries":"0","description":"","type":"DAG","uuid":"05216933-b742-4a3b-a151-4d9a2d503ae5","child_tasks_local_reference_list":[{"kind":"app_task","name":"Image Fetch task for VM","uuid":"b3051c66-d09d-4887-87ee-d4833a57fdba"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147"},{"target_any_local_reference":{"kind":"app_package","name":"CENTOS_74","uuid":"6cbb9b5f-3255-4d45-8d8f-0891f27ac147"},"retries":"0","description":"","type":"SUBSTRATE_IMAGE_FETCH","uuid":"b3051c66-d09d-4887-87ee-d4833a57fdba","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"","name":"CENTOS_74","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-GenericCloud.qcow2","version":{"product_version":"","type":"","product_name":""},"architecture":"X86_64","type":""},"description":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Image Fetch task for VM"}],"description":"","message_list":[],"uuid":"d428ae02-ea02-4587-b9ee-8020e81686c6","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147","uuid":"05216933-b742-4a3b-a151-4d9a2d503ae5"},"name":"SYS_GEN__Runbook_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147"}},{"description":"System action for creating an application","message_list":[],"uuid":"03329707-4f55-43d5-a764-81a0c8cd6227","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"CENTOS_74","uuid":"6cbb9b5f-3255-4d45-8d8f-0891f27ac147"},"retries":"0","description":"","type":"DAG","uuid":"71c99f47-457d-47be-a4da-c2d237700d94","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147","uuid":"a3c0e2d6-c145-4a51-93af-3fa4efde75b9"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147"},{"target_any_local_reference":{"kind":"app_package","name":"CENTOS_74","uuid":"6cbb9b5f-3255-4d45-8d8f-0891f27ac147"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a3c0e2d6-c145-4a51-93af-3fa4efde75b9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147","uuid":"d428ae02-ea02-4587-b9ee-8020e81686c6"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147"}],"description":"","message_list":[],"uuid":"2e58e543-e8f0-4f21-8ca4-b77c82ddd514","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147","uuid":"71c99f47-457d-47be-a4da-c2d237700d94"},"name":"SYS_GEN__Runbook_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147"}},{"description":"System action for starting an application","message_list":[],"uuid":"47971c20-700b-4b3a-80b7-8e9122341dc5","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"CENTOS_74","uuid":"6cbb9b5f-3255-4d45-8d8f-0891f27ac147"},"retries":"0","description":"","type":"DAG","uuid":"80176065-e139-4ab4-8580-68af07a8d7dc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147"}],"description":"","message_list":[],"uuid":"c5980806-52a1-478f-9293-cc67b363bdb6","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147","uuid":"80176065-e139-4ab4-8580-68af07a8d7dc"},"name":"SYS_GEN__Runbook_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147"}},{"description":"System action for restarting an application","message_list":[],"uuid":"9de1a0b7-097c-4f26-a4a1-5adb0301ded2","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"CENTOS_74","uuid":"6cbb9b5f-3255-4d45-8d8f-0891f27ac147"},"retries":"0","description":"","type":"DAG","uuid":"396e8c21-cd62-4efb-8aae-e0c389c6570c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147"}],"description":"","message_list":[],"uuid":"afe6ba3d-6a86-44e5-a8e6-b52e07433e3f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147","uuid":"396e8c21-cd62-4efb-8aae-e0c389c6570c"},"name":"SYS_GEN__Runbook_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147"}},{"description":"System action for stopping an application","message_list":[],"uuid":"bb354975-91c2-4cd9-a561-6b9956542135","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"CENTOS_74","uuid":"6cbb9b5f-3255-4d45-8d8f-0891f27ac147"},"retries":"0","description":"","type":"DAG","uuid":"1de36089-1e46-4184-a6b3-62ca8a7581e8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147"}],"description":"","message_list":[],"uuid":"a13addc1-9f16-4887-9f71-83a98f384e08","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147","uuid":"1de36089-1e46-4184-a6b3-62ca8a7581e8"},"name":"SYS_GEN__Runbook_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"450879af-0ae0-4191-9cc0-b219fa672b58","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"CENTOS_74","uuid":"6cbb9b5f-3255-4d45-8d8f-0891f27ac147"},"retries":"0","description":"","type":"DAG","uuid":"10aceb44-b384-42b9-a99c-5ad5d30acbf2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147"}],"description":"","message_list":[],"uuid":"a8e872b6-f91e-4248-89d4-cc65d1fdaf8e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147","uuid":"10aceb44-b384-42b9-a99c-5ad5d30acbf2"},"name":"SYS_GEN__Runbook_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"e38cf066-27ae-489a-9115-76d76d07c6f6","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"CENTOS_74","uuid":"6cbb9b5f-3255-4d45-8d8f-0891f27ac147"},"retries":"0","description":"","type":"DAG","uuid":"aceaa04f-1e65-4d73-a8a2-f9384acf2b62","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147"}],"description":"","message_list":[],"uuid":"9d36b307-eb87-4067-b14e-fedd85e466c7","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147","uuid":"aceaa04f-1e65-4d73-a8a2-f9384acf2b62"},"name":"SYS_GEN__Runbook_Package_6cbb9b5f_3255_4d45_8d8f_0891f27ac147"}}],"message_list":[],"service_local_reference_list":[],"uuid":"6cbb9b5f-3255-4d45-8d8f-0891f27ac147","state":"ACTIVE","version":"","editables":{},"type":"SUBSTRATE_IMAGE","options":{"type":"","name":"CENTOS_74","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-GenericCloud.qcow2","version":{"product_version":"","type":"","product_name":""},"architecture":"X86_64","type":""},"description":""},"variable_list":[],"name":"CENTOS_74"},{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"3a299072-fa85-4aa6-9733-e65d9e229453","name":"action_install","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"},"retries":"0","description":"","type":"DAG","uuid":"456ce0db-8bfe-4623-a3e2-303608c2f1f0","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Install_Crb_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"eb91cb6b-3b6c-4d9d-8871-418056f039d7"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_INSTALL","uuid":"eb91cb6b-3b6c-4d9d-8871-418056f039d7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"},"retries":"0","description":"","type":"DAG","uuid":"9bf883f6-282f-4cf6-9b19-aed35f8bb527","child_tasks_local_reference_list":[{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"108da788-0194-4cec-87f2-0250d202852e"},{"kind":"app_task","name":"Generate Certs","uuid":"e355815d-10ee-465a-83ac-bc774265a4e9"},{"kind":"app_task","name":"Configure Services","uuid":"aa624606-b7bf-4f09-ab41-c1b3963e631c"},{"kind":"app_task","name":"Add User Roles","uuid":"502da776-3896-4819-8b10-451ffb94a826"},{"kind":"app_task","name":"Network Configuration","uuid":"d60f09d7-e474-4378-85ef-d5424970b641"},{"kind":"app_task","name":"DNS Configuration","uuid":"1783456e-ce2d-42e2-b78e-2eb763ef16ad"},{"kind":"app_task","name":"GCE VolumePlugin","uuid":"b47115ba-e12d-4e9d-b1cc-c9405eceb342"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"108da788-0194-4cec-87f2-0250d202852e"},"edge_type":"user_defined","type":"","uuid":"61dfa542-e635-49cc-8093-d941b2abab8b","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"e355815d-10ee-465a-83ac-bc774265a4e9"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"e355815d-10ee-465a-83ac-bc774265a4e9"},"edge_type":"user_defined","type":"","uuid":"48851258-6707-4509-a77f-8f2bc2570fb5","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"aa624606-b7bf-4f09-ab41-c1b3963e631c"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"aa624606-b7bf-4f09-ab41-c1b3963e631c"},"edge_type":"user_defined","type":"","uuid":"382ea989-cb89-47de-aef9-79345407022b","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"502da776-3896-4819-8b10-451ffb94a826"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"502da776-3896-4819-8b10-451ffb94a826"},"edge_type":"user_defined","type":"","uuid":"9a33a5cc-6360-47c3-b2ad-11403d0f7fa6","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"d60f09d7-e474-4378-85ef-d5424970b641"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"d60f09d7-e474-4378-85ef-d5424970b641"},"edge_type":"user_defined","type":"","uuid":"8a95b44f-bc71-4079-9264-9c50ad915977","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"1783456e-ce2d-42e2-b78e-2eb763ef16ad"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"1783456e-ce2d-42e2-b78e-2eb763ef16ad"},"edge_type":"user_defined","type":"","uuid":"48a7ec54-a0ce-4c20-8374-e1e17faefeea","to_task_reference":{"kind":"app_task","name":"GCE VolumePlugin","uuid":"b47115ba-e12d-4e9d-b1cc-c9405eceb342"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"e07e43b0_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"108da788-0194-4cec-87f2-0250d202852e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo yum install -y python-setuptools --quiet\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nMINION_IPS=\"@@{Azure_Centos_K8SM.private_ip_address}@@\" # private Ip's\nPUBLIC_CONTROLLER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_MINION_IPS=\"@@{Azure_Centos_K8SM.public_ip_address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} controller${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"controller${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')    \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"e355815d-10ee-465a-83ac-bc774265a4e9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nMINION_IPS=\"@@{Azure_Centos_K8SM.private_ip_address}@@\" # private Ip's\nPUBLIC_CONTROLLER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_MINION_IPS=\"@@{Azure_Centos_K8SM.public_ip_address}@@\"\nCONTROLLER_HOSTNAMES=\"@@{calm_array_name}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${PUBLIC_CONTROLLER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${PUBLIC_CONTROLLER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${PUBLIC_CONTROLLER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json \\\n-hostname=${CONTROLLER_NAMES},${CONTROLLER_IPS},${MINION_NAMES},${MINION_IPS},${FIRST_IP_SERVICE_SUBNET},${PUBLIC_CONTROLLER_IPS},${PUBLIC_MINION_IPS},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local \\\n-profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor name in $(echo ${CONTROLLER_NAMES} | tr \",\" \"\\n\"); do\ninstance=\"controller${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${name}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INTERNAL_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor name in $(echo ${CONTROLLER_NAMES} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=controller${count}.kubeconfig\nkubectl config set-credentials system:node:${name} --client-certificate=controller${count}.pem --client-key=controller${count}-key.pem --embed-certs=true --kubeconfig=controller${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${name} --kubeconfig=controller${count}.kubeconfig\nkubectl config use-context default --kubeconfig=controller${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"controller${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"aa624606-b7bf-4f09-ab41-c1b3963e631c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nCONTROLLER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${NODE_NAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,AlwaysPullImages,DenyEscalatingExec,SecurityContextDeny,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n\necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"502da776-3896-4819-8b10-451ffb94a826","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet\nsudo systemctl enable etcd docker kubelet\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem controller* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\n\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF\n\ncat <<EOF | kubectl apply -f -\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: kube-aws:node-proxier\nsubjects:\n  - kind: User\n    name: kube-worker\n  - kind: ServiceAccount\n    name: kube-proxy\n    namespace: kube-system\n  - kind: Group\n    name: system:nodes\nroleRef:\n  kind: ClusterRole\n  name: system:node-proxier\n  apiGroup: rbac.authorization.k8s.io\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"d60f09d7-e474-4378-85ef-d5424970b641","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - \/etc\/kube-flannel\/cni-conf.json\n        - \/etc\/cni\/net.d\/10-flannel.conf\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"1783456e-ce2d-42e2-b78e-2eb763ef16ad","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n    - name: dns\n      port: 53\n      protocol: UDP\n    - name: dns-tcp\n      port: 53\n      protocol: TCP\n---\napiVersion: apps\/v1beta2\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: gcr.io\/google_containers\/k8s-dns-kube-dns-amd64:1.14.10\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: gcr.io\/google_containers\/k8s-dns-dnsmasq-nanny-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: gcr.io\/google_containers\/k8s-dns-sidecar-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local.,5,A\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local.,5,A\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy:\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n\necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n# Remove the configmaps rule once below issue is fixed:\n# kubernetes-incubator\/cluster-proportional-autoscaler#16\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.1.2-r2\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          # Should keep target in sync with cluster\/addons\/dns\/kube-dns.yaml.base\n          - --target=Deployment\/kube-dns\n          # When cluster is using large nodes(with more cores), \"coresPerReplica\" should dominate.\n          # If using small nodes, \"nodesPerReplica\" should dominate.\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"b47115ba-e12d-4e9d-b1cc-c9405eceb342","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nsudo mkdir \"\/etc\/kubernetes\/addons\/volume\"\n\necho 'apiVersion: storage.k8s.io\/v1\nkind: StorageClass\nmetadata:\n  name: standard\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: EnsureExists\nprovisioner: kubernetes.io\/gce-pd\nparameters:\n  type: pd-standard' | sudo tee \/etc\/kubernetes\/addons\/volume\/default.yaml\n \nkubectl create -f \/etc\/kubernetes\/addons\/volume\/default.yaml "},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GCE VolumePlugin"}],"description":"","message_list":[],"uuid":"b52935f0-a02f-403f-8fa5-13d97384fbb3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"e07e43b0_dag","uuid":"9bf883f6-282f-4cf6-9b19-aed35f8bb527"},"name":"26c82c77_runbook_cloned_1"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"},"retries":"0","description":"","type":"DAG","uuid":"8533354a-5a57-4d62-bc44-836a35710de3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6bbde6e8_dag"}],"description":"","message_list":[],"uuid":"e3f431b6-5fd2-40e5-976a-9746c1f88c59","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6bbde6e8_dag","uuid":"8533354a-5a57-4d62-bc44-836a35710de3"},"name":"6eaeef4c_runbook_cloned_1"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Install_Crb_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671"}],"description":"","message_list":[],"uuid":"757c2a82-bf84-4b6f-8b71-b8d446b3208e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"456ce0db-8bfe-4623-a3e2-303608c2f1f0"},"name":"SYS_GEN__Runbook_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671"}},{"description":"System action for creating an application","message_list":[],"uuid":"4900bb7a-139d-47de-928c-99a5d10966cc","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"},"retries":"0","description":"","type":"DAG","uuid":"b7764873-2ff2-4316-8f48-4ca1e67d850f","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"e5c85753-10b7-49ef-a83a-3bbaf5bb4149"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"3e60ff61-3e2e-4e12-bc13-11325d4cab28"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"f94402b4-d3b5-48ff-8ea4-9388d1d7d1ea"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"3e60ff61-3e2e-4e12-bc13-11325d4cab28"},"edge_type":"inherent","type":"","uuid":"98dd6331-3bf4-4728-b3c1-7d8212f2cd6a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"f94402b4-d3b5-48ff-8ea4-9388d1d7d1ea"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"e5c85753-10b7-49ef-a83a-3bbaf5bb4149"},"edge_type":"inherent","type":"","uuid":"12b9ea20-b623-4614-87b6-22d0dadef411","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"3e60ff61-3e2e-4e12-bc13-11325d4cab28"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e5c85753-10b7-49ef-a83a-3bbaf5bb4149","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"757c2a82-bf84-4b6f-8b71-b8d446b3208e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3e60ff61-3e2e-4e12-bc13-11325d4cab28","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"aa8dd27e-4bd1-4b85-86c6-750c0a49579f"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f94402b4-d3b5-48ff-8ea4-9388d1d7d1ea","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"64e5991c-fbcd-4d1f-8b72-4b4956e9702e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"83c2e646-1b69-4a4f-bde7-62dccd9a3cfe","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"b7764873-2ff2-4316-8f48-4ca1e67d850f"},"name":"SYS_GEN__Runbook_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671"}},{"description":"System action for uninstalling an application","message_list":[],"uuid":"25d017b8-b4a8-470c-b4c5-5a0ebf47f68f","name":"action_uninstall","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"},"retries":"0","description":"","type":"DAG","uuid":"874ef4e3-124d-418f-8bf8-53e08326d1f1","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Uninstall_Crb_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"fa60d576-575a-4200-a11b-067f112eb7ac"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_UNINSTALL","uuid":"fa60d576-575a-4200-a11b-067f112eb7ac","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"},"retries":"0","description":"","type":"DAG","uuid":"9bf883f6-282f-4cf6-9b19-aed35f8bb527","child_tasks_local_reference_list":[{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"108da788-0194-4cec-87f2-0250d202852e"},{"kind":"app_task","name":"Generate Certs","uuid":"e355815d-10ee-465a-83ac-bc774265a4e9"},{"kind":"app_task","name":"Configure Services","uuid":"aa624606-b7bf-4f09-ab41-c1b3963e631c"},{"kind":"app_task","name":"Add User Roles","uuid":"502da776-3896-4819-8b10-451ffb94a826"},{"kind":"app_task","name":"Network Configuration","uuid":"d60f09d7-e474-4378-85ef-d5424970b641"},{"kind":"app_task","name":"DNS Configuration","uuid":"1783456e-ce2d-42e2-b78e-2eb763ef16ad"},{"kind":"app_task","name":"GCE VolumePlugin","uuid":"b47115ba-e12d-4e9d-b1cc-c9405eceb342"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"108da788-0194-4cec-87f2-0250d202852e"},"edge_type":"user_defined","type":"","uuid":"61dfa542-e635-49cc-8093-d941b2abab8b","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"e355815d-10ee-465a-83ac-bc774265a4e9"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"e355815d-10ee-465a-83ac-bc774265a4e9"},"edge_type":"user_defined","type":"","uuid":"48851258-6707-4509-a77f-8f2bc2570fb5","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"aa624606-b7bf-4f09-ab41-c1b3963e631c"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"aa624606-b7bf-4f09-ab41-c1b3963e631c"},"edge_type":"user_defined","type":"","uuid":"382ea989-cb89-47de-aef9-79345407022b","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"502da776-3896-4819-8b10-451ffb94a826"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"502da776-3896-4819-8b10-451ffb94a826"},"edge_type":"user_defined","type":"","uuid":"9a33a5cc-6360-47c3-b2ad-11403d0f7fa6","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"d60f09d7-e474-4378-85ef-d5424970b641"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"d60f09d7-e474-4378-85ef-d5424970b641"},"edge_type":"user_defined","type":"","uuid":"8a95b44f-bc71-4079-9264-9c50ad915977","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"1783456e-ce2d-42e2-b78e-2eb763ef16ad"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"1783456e-ce2d-42e2-b78e-2eb763ef16ad"},"edge_type":"user_defined","type":"","uuid":"48a7ec54-a0ce-4c20-8374-e1e17faefeea","to_task_reference":{"kind":"app_task","name":"GCE VolumePlugin","uuid":"b47115ba-e12d-4e9d-b1cc-c9405eceb342"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"e07e43b0_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"108da788-0194-4cec-87f2-0250d202852e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo yum install -y python-setuptools --quiet\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nMINION_IPS=\"@@{Azure_Centos_K8SM.private_ip_address}@@\" # private Ip's\nPUBLIC_CONTROLLER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_MINION_IPS=\"@@{Azure_Centos_K8SM.public_ip_address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} controller${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"controller${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')    \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"e355815d-10ee-465a-83ac-bc774265a4e9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nMINION_IPS=\"@@{Azure_Centos_K8SM.private_ip_address}@@\" # private Ip's\nPUBLIC_CONTROLLER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_MINION_IPS=\"@@{Azure_Centos_K8SM.public_ip_address}@@\"\nCONTROLLER_HOSTNAMES=\"@@{calm_array_name}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${PUBLIC_CONTROLLER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${PUBLIC_CONTROLLER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${PUBLIC_CONTROLLER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json \\\n-hostname=${CONTROLLER_NAMES},${CONTROLLER_IPS},${MINION_NAMES},${MINION_IPS},${FIRST_IP_SERVICE_SUBNET},${PUBLIC_CONTROLLER_IPS},${PUBLIC_MINION_IPS},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local \\\n-profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor name in $(echo ${CONTROLLER_NAMES} | tr \",\" \"\\n\"); do\ninstance=\"controller${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${name}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INTERNAL_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor name in $(echo ${CONTROLLER_NAMES} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=controller${count}.kubeconfig\nkubectl config set-credentials system:node:${name} --client-certificate=controller${count}.pem --client-key=controller${count}-key.pem --embed-certs=true --kubeconfig=controller${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${name} --kubeconfig=controller${count}.kubeconfig\nkubectl config use-context default --kubeconfig=controller${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"controller${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"aa624606-b7bf-4f09-ab41-c1b3963e631c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nCONTROLLER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${NODE_NAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,AlwaysPullImages,DenyEscalatingExec,SecurityContextDeny,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n\necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"502da776-3896-4819-8b10-451ffb94a826","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet\nsudo systemctl enable etcd docker kubelet\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem controller* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\n\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF\n\ncat <<EOF | kubectl apply -f -\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: kube-aws:node-proxier\nsubjects:\n  - kind: User\n    name: kube-worker\n  - kind: ServiceAccount\n    name: kube-proxy\n    namespace: kube-system\n  - kind: Group\n    name: system:nodes\nroleRef:\n  kind: ClusterRole\n  name: system:node-proxier\n  apiGroup: rbac.authorization.k8s.io\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"d60f09d7-e474-4378-85ef-d5424970b641","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - \/etc\/kube-flannel\/cni-conf.json\n        - \/etc\/cni\/net.d\/10-flannel.conf\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"1783456e-ce2d-42e2-b78e-2eb763ef16ad","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n    - name: dns\n      port: 53\n      protocol: UDP\n    - name: dns-tcp\n      port: 53\n      protocol: TCP\n---\napiVersion: apps\/v1beta2\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: gcr.io\/google_containers\/k8s-dns-kube-dns-amd64:1.14.10\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: gcr.io\/google_containers\/k8s-dns-dnsmasq-nanny-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: gcr.io\/google_containers\/k8s-dns-sidecar-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local.,5,A\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local.,5,A\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy:\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n\necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n# Remove the configmaps rule once below issue is fixed:\n# kubernetes-incubator\/cluster-proportional-autoscaler#16\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.1.2-r2\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          # Should keep target in sync with cluster\/addons\/dns\/kube-dns.yaml.base\n          - --target=Deployment\/kube-dns\n          # When cluster is using large nodes(with more cores), \"coresPerReplica\" should dominate.\n          # If using small nodes, \"nodesPerReplica\" should dominate.\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"b47115ba-e12d-4e9d-b1cc-c9405eceb342","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nsudo mkdir \"\/etc\/kubernetes\/addons\/volume\"\n\necho 'apiVersion: storage.k8s.io\/v1\nkind: StorageClass\nmetadata:\n  name: standard\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: EnsureExists\nprovisioner: kubernetes.io\/gce-pd\nparameters:\n  type: pd-standard' | sudo tee \/etc\/kubernetes\/addons\/volume\/default.yaml\n \nkubectl create -f \/etc\/kubernetes\/addons\/volume\/default.yaml "},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GCE VolumePlugin"}],"description":"","message_list":[],"uuid":"b52935f0-a02f-403f-8fa5-13d97384fbb3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"e07e43b0_dag","uuid":"9bf883f6-282f-4cf6-9b19-aed35f8bb527"},"name":"26c82c77_runbook_cloned_1"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"},"retries":"0","description":"","type":"DAG","uuid":"8533354a-5a57-4d62-bc44-836a35710de3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6bbde6e8_dag"}],"description":"","message_list":[],"uuid":"e3f431b6-5fd2-40e5-976a-9746c1f88c59","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6bbde6e8_dag","uuid":"8533354a-5a57-4d62-bc44-836a35710de3"},"name":"6eaeef4c_runbook_cloned_1"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Uninstall_Crb_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671"}],"description":"","message_list":[],"uuid":"8ae59bad-2465-469a-85c0-4697785f6418","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"874ef4e3-124d-418f-8bf8-53e08326d1f1"},"name":"SYS_GEN__Runbook_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"765ef5b1-4800-4624-8bfa-5d2ce893c763","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"},"retries":"0","description":"","type":"DAG","uuid":"ddecc578-1c4b-4ac8-b853-44c296b273b5","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"af3b794f-6d06-466e-974b-7fcbc1f5acd2"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"18015c75-7b6f-45a1-9ab1-c3e9d65fd60f"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"d81063d2-6154-4e09-a0f1-abfcccc76f6a"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"af3b794f-6d06-466e-974b-7fcbc1f5acd2"},"edge_type":"inherent","type":"","uuid":"15249c0d-d273-4fad-b16c-d925c2201284","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"18015c75-7b6f-45a1-9ab1-c3e9d65fd60f"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"18015c75-7b6f-45a1-9ab1-c3e9d65fd60f"},"edge_type":"inherent","type":"","uuid":"308968a1-2221-4468-b873-6230bcb68223","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"d81063d2-6154-4e09-a0f1-abfcccc76f6a"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"af3b794f-6d06-466e-974b-7fcbc1f5acd2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"1fdd3541-2eca-471a-a4be-4ef82887d4de"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"18015c75-7b6f-45a1-9ab1-c3e9d65fd60f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"a2ac512f-d272-4905-bafb-4733f7e58c9b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d81063d2-6154-4e09-a0f1-abfcccc76f6a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"8ae59bad-2465-469a-85c0-4697785f6418"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671"}],"description":"","message_list":[],"uuid":"cfc7d4b0-6555-45f7-ae22-6f0a2e6147b1","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"ddecc578-1c4b-4ac8-b853-44c296b273b5"},"name":"SYS_GEN__Runbook_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"10fa5cd6-0407-4fb8-9e78-1de8a2b7987c","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"},"retries":"0","description":"","type":"DAG","uuid":"c23f590d-5ce2-4f9d-95e0-dd1831b2862c","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"affc7ebc-a5df-4dab-9901-0685deb73323"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"fa1a2603-a3e0-4664-85c2-d91829168a56"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"affc7ebc-a5df-4dab-9901-0685deb73323"},"edge_type":"inherent","type":"","uuid":"bbe479c2-017b-471d-966d-ebbb648fe6c9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"fa1a2603-a3e0-4664-85c2-d91829168a56"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"affc7ebc-a5df-4dab-9901-0685deb73323","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"50a769a7-5b0a-4546-9e12-4f0a3ceff21b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"fa1a2603-a3e0-4664-85c2-d91829168a56","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671"}],"description":"","message_list":[],"uuid":"573f66b4-f4dd-47e2-b162-73c44b125062","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"c23f590d-5ce2-4f9d-95e0-dd1831b2862c"},"name":"SYS_GEN__Runbook_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671"}},{"description":"System action for starting an application","message_list":[],"uuid":"beb35bdc-ec61-40c5-8883-6baf84b52fd9","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"},"retries":"0","description":"","type":"DAG","uuid":"cc9dd8be-9c76-477f-ac00-1f668c9f638a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"c3470f30-d1d3-4bc7-b832-501cb5776957"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c3470f30-d1d3-4bc7-b832-501cb5776957","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"64e5991c-fbcd-4d1f-8b72-4b4956e9702e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"746194e4-d0c7-49fb-b057-3f1fd42df296","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"cc9dd8be-9c76-477f-ac00-1f668c9f638a"},"name":"SYS_GEN__Runbook_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671"}},{"description":"System action for restarting an application","message_list":[],"uuid":"cf6f24dc-f588-4089-8e74-2447ac101dbe","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"},"retries":"0","description":"","type":"DAG","uuid":"cad4cd27-1dad-48e6-8317-bce4596ae956","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"91ef2c70-bbc0-4a7a-bf5b-04b61eece1ae"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"91ef2c70-bbc0-4a7a-bf5b-04b61eece1ae","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"526cc0d4-3d9e-49c6-840b-f42e056f5d89"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"39ec3c15-0bc6-42cf-9e7d-bf210fe772c0","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"cad4cd27-1dad-48e6-8317-bce4596ae956"},"name":"SYS_GEN__Runbook_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671"}},{"description":"System action for stopping an application","message_list":[],"uuid":"ae7f5dcd-6287-41f3-becf-5467bff08b7e","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"},"retries":"0","description":"","type":"DAG","uuid":"b6c9d190-c4e8-4eb7-91bb-df4dbdd55c80","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7","uuid":"2281c047-6f0b-48da-800b-1c448ac19a0b"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2281c047-6f0b-48da-800b-1c448ac19a0b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"1fdd3541-2eca-471a-a4be-4ef82887d4de"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_54a464e1_414d_4d9c_acf5_92a61d43e4f7"}],"description":"","message_list":[],"uuid":"aaea51aa-8d8f-4b9d-97be-6b660d644c97","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671","uuid":"b6c9d190-c4e8-4eb7-91bb-df4dbdd55c80"},"name":"SYS_GEN__Runbook_Package_e33bbdd9_3f5c_46cd_bc77_15e06fe0e671"}}],"message_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"}],"uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671","state":"ACTIVE","version":"","editables":{},"type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"},"retries":"0","description":"","type":"DAG","uuid":"9bf883f6-282f-4cf6-9b19-aed35f8bb527","child_tasks_local_reference_list":[{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"108da788-0194-4cec-87f2-0250d202852e"},{"kind":"app_task","name":"Generate Certs","uuid":"e355815d-10ee-465a-83ac-bc774265a4e9"},{"kind":"app_task","name":"Configure Services","uuid":"aa624606-b7bf-4f09-ab41-c1b3963e631c"},{"kind":"app_task","name":"Add User Roles","uuid":"502da776-3896-4819-8b10-451ffb94a826"},{"kind":"app_task","name":"Network Configuration","uuid":"d60f09d7-e474-4378-85ef-d5424970b641"},{"kind":"app_task","name":"DNS Configuration","uuid":"1783456e-ce2d-42e2-b78e-2eb763ef16ad"},{"kind":"app_task","name":"GCE VolumePlugin","uuid":"b47115ba-e12d-4e9d-b1cc-c9405eceb342"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"108da788-0194-4cec-87f2-0250d202852e"},"edge_type":"user_defined","type":"","uuid":"61dfa542-e635-49cc-8093-d941b2abab8b","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"e355815d-10ee-465a-83ac-bc774265a4e9"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"e355815d-10ee-465a-83ac-bc774265a4e9"},"edge_type":"user_defined","type":"","uuid":"48851258-6707-4509-a77f-8f2bc2570fb5","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"aa624606-b7bf-4f09-ab41-c1b3963e631c"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"aa624606-b7bf-4f09-ab41-c1b3963e631c"},"edge_type":"user_defined","type":"","uuid":"382ea989-cb89-47de-aef9-79345407022b","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"502da776-3896-4819-8b10-451ffb94a826"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"502da776-3896-4819-8b10-451ffb94a826"},"edge_type":"user_defined","type":"","uuid":"9a33a5cc-6360-47c3-b2ad-11403d0f7fa6","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"d60f09d7-e474-4378-85ef-d5424970b641"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"d60f09d7-e474-4378-85ef-d5424970b641"},"edge_type":"user_defined","type":"","uuid":"8a95b44f-bc71-4079-9264-9c50ad915977","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"1783456e-ce2d-42e2-b78e-2eb763ef16ad"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"1783456e-ce2d-42e2-b78e-2eb763ef16ad"},"edge_type":"user_defined","type":"","uuid":"48a7ec54-a0ce-4c20-8374-e1e17faefeea","to_task_reference":{"kind":"app_task","name":"GCE VolumePlugin","uuid":"b47115ba-e12d-4e9d-b1cc-c9405eceb342"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"e07e43b0_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"108da788-0194-4cec-87f2-0250d202852e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo yum install -y python-setuptools --quiet\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nMINION_IPS=\"@@{Azure_Centos_K8SM.private_ip_address}@@\" # private Ip's\nPUBLIC_CONTROLLER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_MINION_IPS=\"@@{Azure_Centos_K8SM.public_ip_address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} controller${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"controller${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')    \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"e355815d-10ee-465a-83ac-bc774265a4e9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nMINION_IPS=\"@@{Azure_Centos_K8SM.private_ip_address}@@\" # private Ip's\nPUBLIC_CONTROLLER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_MINION_IPS=\"@@{Azure_Centos_K8SM.public_ip_address}@@\"\nCONTROLLER_HOSTNAMES=\"@@{calm_array_name}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${PUBLIC_CONTROLLER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${PUBLIC_CONTROLLER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${PUBLIC_CONTROLLER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json \\\n-hostname=${CONTROLLER_NAMES},${CONTROLLER_IPS},${MINION_NAMES},${MINION_IPS},${FIRST_IP_SERVICE_SUBNET},${PUBLIC_CONTROLLER_IPS},${PUBLIC_MINION_IPS},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local \\\n-profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor name in $(echo ${CONTROLLER_NAMES} | tr \",\" \"\\n\"); do\ninstance=\"controller${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${name}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INTERNAL_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor name in $(echo ${CONTROLLER_NAMES} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=controller${count}.kubeconfig\nkubectl config set-credentials system:node:${name} --client-certificate=controller${count}.pem --client-key=controller${count}-key.pem --embed-certs=true --kubeconfig=controller${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${name} --kubeconfig=controller${count}.kubeconfig\nkubectl config use-context default --kubeconfig=controller${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"controller${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"aa624606-b7bf-4f09-ab41-c1b3963e631c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nCONTROLLER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${NODE_NAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,AlwaysPullImages,DenyEscalatingExec,SecurityContextDeny,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n\necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"502da776-3896-4819-8b10-451ffb94a826","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet\nsudo systemctl enable etcd docker kubelet\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem controller* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\n\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF\n\ncat <<EOF | kubectl apply -f -\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: kube-aws:node-proxier\nsubjects:\n  - kind: User\n    name: kube-worker\n  - kind: ServiceAccount\n    name: kube-proxy\n    namespace: kube-system\n  - kind: Group\n    name: system:nodes\nroleRef:\n  kind: ClusterRole\n  name: system:node-proxier\n  apiGroup: rbac.authorization.k8s.io\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"d60f09d7-e474-4378-85ef-d5424970b641","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - \/etc\/kube-flannel\/cni-conf.json\n        - \/etc\/cni\/net.d\/10-flannel.conf\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"1783456e-ce2d-42e2-b78e-2eb763ef16ad","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n    - name: dns\n      port: 53\n      protocol: UDP\n    - name: dns-tcp\n      port: 53\n      protocol: TCP\n---\napiVersion: apps\/v1beta2\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: gcr.io\/google_containers\/k8s-dns-kube-dns-amd64:1.14.10\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: gcr.io\/google_containers\/k8s-dns-dnsmasq-nanny-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: gcr.io\/google_containers\/k8s-dns-sidecar-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local.,5,A\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local.,5,A\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy:\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n\necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n# Remove the configmaps rule once below issue is fixed:\n# kubernetes-incubator\/cluster-proportional-autoscaler#16\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.1.2-r2\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          # Should keep target in sync with cluster\/addons\/dns\/kube-dns.yaml.base\n          - --target=Deployment\/kube-dns\n          # When cluster is using large nodes(with more cores), \"coresPerReplica\" should dominate.\n          # If using small nodes, \"nodesPerReplica\" should dominate.\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","type":"EXEC","uuid":"b47115ba-e12d-4e9d-b1cc-c9405eceb342","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nsudo mkdir \"\/etc\/kubernetes\/addons\/volume\"\n\necho 'apiVersion: storage.k8s.io\/v1\nkind: StorageClass\nmetadata:\n  name: standard\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: EnsureExists\nprovisioner: kubernetes.io\/gce-pd\nparameters:\n  type: pd-standard' | sudo tee \/etc\/kubernetes\/addons\/volume\/default.yaml\n \nkubectl create -f \/etc\/kubernetes\/addons\/volume\/default.yaml "},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GCE VolumePlugin"}],"description":"","message_list":[],"uuid":"b52935f0-a02f-403f-8fa5-13d97384fbb3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"e07e43b0_dag","uuid":"9bf883f6-282f-4cf6-9b19-aed35f8bb527"},"name":"26c82c77_runbook_cloned_1"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"},"retries":"0","description":"","type":"DAG","uuid":"8533354a-5a57-4d62-bc44-836a35710de3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6bbde6e8_dag"}],"description":"","message_list":[],"uuid":"e3f431b6-5fd2-40e5-976a-9746c1f88c59","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6bbde6e8_dag","uuid":"8533354a-5a57-4d62-bc44-836a35710de3"},"name":"6eaeef4c_runbook_cloned_1"}},"variable_list":[],"name":"Azure_Centos_K8SC_Package"},{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"98f2c2e9-b764-4b3c-b2f1-1d355ccb8f3d","name":"action_install","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"},"retries":"0","description":"","type":"DAG","uuid":"ded201c6-7f3b-4a74-bee5-6a74cc52ec1a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Install_Crb_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"3613bb14-f1e2-41fd-b847-159c1745a484"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_e86d00bd_64a7_4363_884d_48ab6e49052a"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_INSTALL","uuid":"3613bb14-f1e2-41fd-b847-159c1745a484","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"},"retries":"0","description":"","type":"DAG","uuid":"e83bda7e-ed8a-4ecf-9207-f85f0d784a8c","child_tasks_local_reference_list":[{"kind":"app_task","name":"Docker Kubelet Install","uuid":"48e1e88d-5ff4-4b68-94fd-0615f4a3dec3"},{"kind":"app_task","name":"GetCerts","uuid":"4ca0cbb9-c32f-4fd7-818e-e7d34b91c576"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"48e1e88d-5ff4-4b68-94fd-0615f4a3dec3"},"edge_type":"user_defined","type":"","uuid":"4de3d3d1-bf6c-4cf6-804c-f54954d037c5","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"4ca0cbb9-c32f-4fd7-818e-e7d34b91c576"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"709f9264_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"48e1e88d-5ff4-4b68-94fd-0615f4a3dec3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{Azure_Centos_K8SC.private_ip_address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\n\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/usr\/share\/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"4ca0cbb9-c32f-4fd7-818e-e7d34b91c576","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{Azure_Centos_K8SC.private_ip_address[0]}@@\"\nINSTANCE_IP=\"@@{private_ip_address}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"minion@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${HOSTNAME}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${HOSTNAME},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${HOSTNAME} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${HOSTNAME} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"2b5e609f-9b5e-492a-9416-2f336c962f2e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"709f9264_dag","uuid":"e83bda7e-ed8a-4ecf-9207-f85f0d784a8c"},"name":"927472a7_runbook_cloned_1"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"},"retries":"0","description":"","type":"DAG","uuid":"dbf0f4d7-4ff8-4600-a05b-cc87d39d3199","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"e965f669-dba2-46fd-a707-6d92cb40aec3"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"fef85962_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"e965f669-dba2-46fd-a707-6d92cb40aec3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain 'minion@@{calm_array_index}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node 'minion@@{calm_array_index}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"6f16c9a9-e56a-453f-a2af-55e7433f9d66","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"fef85962_dag","uuid":"dbf0f4d7-4ff8-4600-a05b-cc87d39d3199"},"name":"435393f9_runbook_cloned_1"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Install_Crb_e86d00bd_64a7_4363_884d_48ab6e49052a"}],"description":"","message_list":[],"uuid":"9b1bbd75-4d96-4806-a502-1e516f33961c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"ded201c6-7f3b-4a74-bee5-6a74cc52ec1a"},"name":"SYS_GEN__Runbook_Package_e86d00bd_64a7_4363_884d_48ab6e49052a"}},{"description":"System action for creating an application","message_list":[],"uuid":"409ba471-ce73-4121-9386-edf2965d19c7","name":"action_create","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"},"retries":"0","description":"","type":"DAG","uuid":"a5826936-27a5-456a-8c1c-724508812009","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"e191032e-62c3-4764-98a1-110cbcc4acde"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"3632bf67-aa91-4c29-a948-0507198c5fcf"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"c7910855-8b5b-4b38-bffd-f8ba9236cb72"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"3632bf67-aa91-4c29-a948-0507198c5fcf"},"edge_type":"inherent","type":"","uuid":"3dc939ce-ac37-47d0-b488-3c87b041805b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"c7910855-8b5b-4b38-bffd-f8ba9236cb72"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"e191032e-62c3-4764-98a1-110cbcc4acde"},"edge_type":"inherent","type":"","uuid":"2b7b9ef9-6ac3-4b29-8772-dca303502dbc","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"3632bf67-aa91-4c29-a948-0507198c5fcf"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_e86d00bd_64a7_4363_884d_48ab6e49052a"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e191032e-62c3-4764-98a1-110cbcc4acde","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"9b1bbd75-4d96-4806-a502-1e516f33961c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_e86d00bd_64a7_4363_884d_48ab6e49052a"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3632bf67-aa91-4c29-a948-0507198c5fcf","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"cabcfd41-35e6-45f0-a791-00daf17de059"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c7910855-8b5b-4b38-bffd-f8ba9236cb72","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"91f453c1-d2fc-47b1-93d4-4b49476235be"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"f02165e6-622e-4008-b4a0-f0255e403a34","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"a5826936-27a5-456a-8c1c-724508812009"},"name":"SYS_GEN__Runbook_Package_e86d00bd_64a7_4363_884d_48ab6e49052a"}},{"description":"System action for uninstalling an application","message_list":[],"uuid":"52d55d24-061a-4f3e-ae13-0c17c70d4334","name":"action_uninstall","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"},"retries":"0","description":"","type":"DAG","uuid":"a4509aac-841d-49f6-a230-7e73eb0547bd","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Uninstall_Crb_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"ce579861-4426-438e-856f-7cfe00b5c3c2"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_e86d00bd_64a7_4363_884d_48ab6e49052a"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_UNINSTALL","uuid":"ce579861-4426-438e-856f-7cfe00b5c3c2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"},"retries":"0","description":"","type":"DAG","uuid":"e83bda7e-ed8a-4ecf-9207-f85f0d784a8c","child_tasks_local_reference_list":[{"kind":"app_task","name":"Docker Kubelet Install","uuid":"48e1e88d-5ff4-4b68-94fd-0615f4a3dec3"},{"kind":"app_task","name":"GetCerts","uuid":"4ca0cbb9-c32f-4fd7-818e-e7d34b91c576"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"48e1e88d-5ff4-4b68-94fd-0615f4a3dec3"},"edge_type":"user_defined","type":"","uuid":"4de3d3d1-bf6c-4cf6-804c-f54954d037c5","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"4ca0cbb9-c32f-4fd7-818e-e7d34b91c576"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"709f9264_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"48e1e88d-5ff4-4b68-94fd-0615f4a3dec3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{Azure_Centos_K8SC.private_ip_address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\n\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/usr\/share\/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"4ca0cbb9-c32f-4fd7-818e-e7d34b91c576","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{Azure_Centos_K8SC.private_ip_address[0]}@@\"\nINSTANCE_IP=\"@@{private_ip_address}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"minion@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${HOSTNAME}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${HOSTNAME},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${HOSTNAME} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${HOSTNAME} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"2b5e609f-9b5e-492a-9416-2f336c962f2e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"709f9264_dag","uuid":"e83bda7e-ed8a-4ecf-9207-f85f0d784a8c"},"name":"927472a7_runbook_cloned_1"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"},"retries":"0","description":"","type":"DAG","uuid":"dbf0f4d7-4ff8-4600-a05b-cc87d39d3199","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"e965f669-dba2-46fd-a707-6d92cb40aec3"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"fef85962_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"e965f669-dba2-46fd-a707-6d92cb40aec3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain 'minion@@{calm_array_index}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node 'minion@@{calm_array_index}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"6f16c9a9-e56a-453f-a2af-55e7433f9d66","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"fef85962_dag","uuid":"dbf0f4d7-4ff8-4600-a05b-cc87d39d3199"},"name":"435393f9_runbook_cloned_1"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Uninstall_Crb_e86d00bd_64a7_4363_884d_48ab6e49052a"}],"description":"","message_list":[],"uuid":"e1256869-0bcf-4716-b2e8-6a1bcb9847c2","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"a4509aac-841d-49f6-a230-7e73eb0547bd"},"name":"SYS_GEN__Runbook_Package_e86d00bd_64a7_4363_884d_48ab6e49052a"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"160e8305-7566-4204-ba43-cce8fc8bd4bf","name":"action_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"},"retries":"0","description":"","type":"DAG","uuid":"b176ae47-c76a-4721-9ae4-322839cea2dc","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"05955fbf-e80e-471d-a9da-3d8642d30087"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"f491817a-e0db-43ca-9ab3-76016bae0a7d"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"2c12059d-e5ba-40a2-8c8b-ceae0f5d9e6d"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"05955fbf-e80e-471d-a9da-3d8642d30087"},"edge_type":"inherent","type":"","uuid":"273079ac-7ba3-4387-9e2f-a506ba299a33","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"f491817a-e0db-43ca-9ab3-76016bae0a7d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"f491817a-e0db-43ca-9ab3-76016bae0a7d"},"edge_type":"inherent","type":"","uuid":"cb728e79-1560-4c76-b0ab-1618c92e2cc0","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"2c12059d-e5ba-40a2-8c8b-ceae0f5d9e6d"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_e86d00bd_64a7_4363_884d_48ab6e49052a"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"05955fbf-e80e-471d-a9da-3d8642d30087","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12105be2-ee67-451d-8054-4546855e277c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f491817a-e0db-43ca-9ab3-76016bae0a7d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"6b0fd64c-e97f-4968-998d-ff058e95d9e9"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2c12059d-e5ba-40a2-8c8b-ceae0f5d9e6d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"e1256869-0bcf-4716-b2e8-6a1bcb9847c2"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_e86d00bd_64a7_4363_884d_48ab6e49052a"}],"description":"","message_list":[],"uuid":"88506958-b5b3-4868-be0e-905ad6507a67","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"b176ae47-c76a-4721-9ae4-322839cea2dc"},"name":"SYS_GEN__Runbook_Package_e86d00bd_64a7_4363_884d_48ab6e49052a"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"70a93145-154a-4099-9db6-9b6d48d49703","name":"action_soft_delete","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"},"retries":"0","description":"","type":"DAG","uuid":"c539ba4d-778f-41f0-b25b-8f444f8ab136","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"cbe3c2f7-7b69-4690-86cd-dd2c4d2ceb86"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"38d7b5a8-43ef-43e9-b856-0c89997083ff"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"cbe3c2f7-7b69-4690-86cd-dd2c4d2ceb86"},"edge_type":"inherent","type":"","uuid":"bf8d187f-4348-4a37-9639-bc1706ea191f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"38d7b5a8-43ef-43e9-b856-0c89997083ff"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_e86d00bd_64a7_4363_884d_48ab6e49052a"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"cbe3c2f7-7b69-4690-86cd-dd2c4d2ceb86","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"d44a642f-9468-432a-9b7e-e69a7c1c08e7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"},{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"38d7b5a8-43ef-43e9-b856-0c89997083ff","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_e86d00bd_64a7_4363_884d_48ab6e49052a"}],"description":"","message_list":[],"uuid":"a6f3c0b0-a1c9-4c4b-a19a-fde94ab0b8c2","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"c539ba4d-778f-41f0-b25b-8f444f8ab136"},"name":"SYS_GEN__Runbook_Package_e86d00bd_64a7_4363_884d_48ab6e49052a"}},{"description":"System action for starting an application","message_list":[],"uuid":"d411bd2b-6a6b-403a-a94b-ac8487000d34","name":"action_start","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"},"retries":"0","description":"","type":"DAG","uuid":"47a9441b-64c4-4f8a-8990-0abb1feadfb8","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"116df881-3e18-4d6a-93c5-7b4a443dcbc9"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_e86d00bd_64a7_4363_884d_48ab6e49052a"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"116df881-3e18-4d6a-93c5-7b4a443dcbc9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"91f453c1-d2fc-47b1-93d4-4b49476235be"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"5f3d28b0-b061-436d-8cc3-c6379a65dcda","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"47a9441b-64c4-4f8a-8990-0abb1feadfb8"},"name":"SYS_GEN__Runbook_Package_e86d00bd_64a7_4363_884d_48ab6e49052a"}},{"description":"System action for restarting an application","message_list":[],"uuid":"63c0f241-b7c6-4c7e-8f64-0c03394c9218","name":"action_restart","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"},"retries":"0","description":"","type":"DAG","uuid":"c05cbd37-c648-4945-84f2-80f3353544e5","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"3ff77d74-ee0b-44e1-b239-bf5133e1cb53"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_e86d00bd_64a7_4363_884d_48ab6e49052a"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3ff77d74-ee0b-44e1-b239-bf5133e1cb53","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"3fd75c09-a79f-4731-98fc-b65b96bc9fe7"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"b36b5a11-c7fa-4f4a-b86e-e29671645909","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"c05cbd37-c648-4945-84f2-80f3353544e5"},"name":"SYS_GEN__Runbook_Package_e86d00bd_64a7_4363_884d_48ab6e49052a"}},{"description":"System action for stopping an application","message_list":[],"uuid":"12233a9f-6de0-4f47-88b0-e298de13bdef","name":"action_stop","state":"ACTIVE","critical":true,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"},"retries":"0","description":"","type":"DAG","uuid":"772352ca-5fda-4396-8f0e-6ca2f562cd59","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68","uuid":"58ce0ed1-c69c-4968-b330-1ae9bd09d4ac"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_e86d00bd_64a7_4363_884d_48ab6e49052a"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"58ce0ed1-c69c-4968-b330-1ae9bd09d4ac","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12105be2-ee67-451d-8054-4546855e277c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_78c73ade_3c79_4294_81ba_e9b738f6ee68"}],"description":"","message_list":[],"uuid":"953e29b4-e457-484f-b465-14a48c34290a","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_e86d00bd_64a7_4363_884d_48ab6e49052a","uuid":"772352ca-5fda-4396-8f0e-6ca2f562cd59"},"name":"SYS_GEN__Runbook_Package_e86d00bd_64a7_4363_884d_48ab6e49052a"}}],"message_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"}],"uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a","state":"ACTIVE","version":"","editables":{},"type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"},"retries":"0","description":"","type":"DAG","uuid":"e83bda7e-ed8a-4ecf-9207-f85f0d784a8c","child_tasks_local_reference_list":[{"kind":"app_task","name":"Docker Kubelet Install","uuid":"48e1e88d-5ff4-4b68-94fd-0615f4a3dec3"},{"kind":"app_task","name":"GetCerts","uuid":"4ca0cbb9-c32f-4fd7-818e-e7d34b91c576"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"48e1e88d-5ff4-4b68-94fd-0615f4a3dec3"},"edge_type":"user_defined","type":"","uuid":"4de3d3d1-bf6c-4cf6-804c-f54954d037c5","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"4ca0cbb9-c32f-4fd7-818e-e7d34b91c576"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"709f9264_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"48e1e88d-5ff4-4b68-94fd-0615f4a3dec3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{Azure_Centos_K8SC.private_ip_address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\n\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/usr\/share\/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"4ca0cbb9-c32f-4fd7-818e-e7d34b91c576","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{Azure_Centos_K8SC.private_ip_address[0]}@@\"\nINSTANCE_IP=\"@@{private_ip_address}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"minion@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${HOSTNAME}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${HOSTNAME},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${HOSTNAME} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${HOSTNAME} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"2b5e609f-9b5e-492a-9416-2f336c962f2e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"709f9264_dag","uuid":"e83bda7e-ed8a-4ecf-9207-f85f0d784a8c"},"name":"927472a7_runbook_cloned_1"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"},"retries":"0","description":"","type":"DAG","uuid":"dbf0f4d7-4ff8-4600-a05b-cc87d39d3199","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"e965f669-dba2-46fd-a707-6d92cb40aec3"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"fef85962_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","type":"EXEC","uuid":"e965f669-dba2-46fd-a707-6d92cb40aec3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain 'minion@@{calm_array_index}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node 'minion@@{calm_array_index}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"6f16c9a9-e56a-453f-a2af-55e7433f9d66","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"fef85962_dag","uuid":"dbf0f4d7-4ff8-4600-a05b-cc87d39d3199"},"name":"435393f9_runbook_cloned_1"}},"variable_list":[],"name":"Azure_Centos_K8SM_Package"}]},"name":"k8"},"spec":{"name":"k8","resources":{"service_definition_list":[{"singleton":false,"uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7","action_list":[{"uuid":"6ac8a4aa-5d2d-4872-a3ea-f8fc1fa8522e","name":"action_create","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","uuid":"f9a1754f-f3f5-48ff-a8c5-3dfca6be79c1","child_tasks_local_reference_list":[{"kind":"app_task","name":"Dashboard","uuid":"178fbbc4-9358-4da6-a35e-df59c4559bad"},{"kind":"app_task","name":"HELM","uuid":"79484302-2775-40aa-9bc2-ba3bfa323998"},{"kind":"app_task","name":"Heapster","uuid":"d459078d-b4f5-49ad-bf25-6e0d880053a0"}],"attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Dashboard","uuid":"178fbbc4-9358-4da6-a35e-df59c4559bad"},"edge_type":"user_defined","type":"","uuid":"a416ccf0-d63b-4697-8e7e-9f2a9b69ee62","to_task_reference":{"kind":"app_task","name":"HELM","uuid":"79484302-2775-40aa-9bc2-ba3bfa323998"}},{"from_task_reference":{"kind":"app_task","name":"HELM","uuid":"79484302-2775-40aa-9bc2-ba3bfa323998"},"edge_type":"user_defined","type":"","uuid":"343bc895-a0b1-417c-9f69-9e2dd5f2b296","to_task_reference":{"kind":"app_task","name":"Heapster","uuid":"d459078d-b4f5-49ad-bf25-6e0d880053a0"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"f33eac3f_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","uuid":"178fbbc4-9358-4da6-a35e-df59c4559bad","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/dashboard\necho '# Copyright 2015 Google Inc. All Rights Reserved.\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#     http:\/\/www.apache.org\/licenses\/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\n# Configuration to deploy release version of the Dashboard UI compatible with\n# Kubernetes 1.7.\n#\n# Example usage: kubectl create -f <this_file>\n\n# ------------------- Dashboard Secret ------------------- #\n\napiVersion: v1\nkind: Secret\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard-certs\n  namespace: kube-system\ntype: Opaque\n\n---\n# ------------------- Dashboard Service Account ------------------- #\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\n\n---\n# ------------------- Dashboard Role & Role Binding ------------------- #\n\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: kubernetes-full-access\n  namespace: kube-system\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: kubernetes-dashboard\n  namespace: kube-system\n\n---\n# ------------------- Dashboard Deployment ------------------- #\n\nkind: Deployment\napiVersion: apps\/v1beta2\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\nspec:\n  replicas: 1\n  revisionHistoryLimit: 10\n  selector:\n    matchLabels:\n      k8s-app: kubernetes-dashboard\n  template:\n    metadata:\n      labels:\n        k8s-app: kubernetes-dashboard\n    spec:\n      containers:\n      - name: kubernetes-dashboard\n        image: k8s.gcr.io\/kubernetes-dashboard-amd64:v1.8.3\n        ports:\n        - containerPort: 8443\n          protocol: TCP\n        args:\n          - --auto-generate-certificates\n          # Uncomment the following line to manually specify Kubernetes API server Host\n          # If not specified, Dashboard will attempt to auto discover the API server and connect\n          # to it. Uncomment only if the default does not work.\n          # - --apiserver-host=http:\/\/my-address:port\n        volumeMounts:\n        - name: kubernetes-dashboard-certs\n          mountPath: \/certs\n          # Create on-disk volume to store exec logs\n        - mountPath: \/tmp\n          name: tmp-volume\n        livenessProbe:\n          httpGet:\n            scheme: HTTPS\n            path: \/\n            port: 8443\n          initialDelaySeconds: 30\n          timeoutSeconds: 30\n      volumes:\n      - name: kubernetes-dashboard-certs\n        secret:\n          secretName: kubernetes-dashboard-certs\n      - name: tmp-volume\n        emptyDir: {}\n      serviceAccountName: kubernetes-dashboard\n      # Comment the following tolerations if Dashboard must not be deployed on master\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        effect: NoSchedule\n\n---\n# ------------------- Dashboard Service ------------------- #\n\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\nspec:\n  type: NodePort\n  ports:\n    - port: 8443\n      nodePort: 30443\n  selector:\n    k8s-app: kubernetes-dashboard' | sudo tee \/etc\/kubernetes\/addons\/dashboard\/kubernetes-dashboard.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/dashboard\/kubernetes-dashboard.yaml\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Dashboard"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","uuid":"79484302-2775-40aa-9bc2-ba3bfa323998","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir \/etc\/kubernetes\/addons\/helm\necho \"#helm init --service-account helm\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: helm\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: helm\n  namespace: kube-system\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: helm\n  namespace: kube-system\" | sudo tee \/etc\/kubernetes\/addons\/helm\/helm.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/helm\/helm.yaml\nhelm init --service-account helm\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"HELM"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","uuid":"d459078d-b4f5-49ad-bf25-6e0d880053a0","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir \/etc\/kubernetes\/addons\/heapster\nkubectl delete ClusterRole system:heapster -n kube-system\n\necho 'apiVersion: rbac.authorization.k8s.io\/v1\nkind: ClusterRole\nmetadata:\n  name: system:heapster\n  namespace: kube-system\nrules:\n- apiGroups:\n  - \"\"\n  resources:\n  - events\n  - namespaces\n  - nodes\n  - pods\n  verbs:\n  - get\n  - list\n  - watch\n- apiGroups:\n  - \"\"\n  resources:\n  - nodes\/stats\n  verbs:\n  - get\n- apiGroups:\n  - extensions\n  resources:\n  - deployments\n  verbs:\n  - get\n  - list\n  - watch\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: heapster\n  namespace: kube-system\n  labels:\n    k8s-app: heapster\n    module: apiserver\n    version: v6\nspec:\n  selector:\n    matchLabels:\n      k8s-app: heapster\n      module: apiserver\n      version: v6\n  template:\n    metadata:\n      name: heapster\n      labels:\n        k8s-app: heapster\n        module: apiserver\n        version: v6\n    spec:\n      serviceAccountName: heapster\n      containers:\n      - name: heapster\n        image: k8s.gcr.io\/heapster-amd64:v1.5.3\n        command:\n        - \/heapster\n        - --source=kubernetes.summary_api:\"\"?useServiceAccount=true&kubeletHttps=true&kubeletPort=10250&insecure=true\n        ports:\n        - containerPort: 6443\n          name: https\n        - containerPort: 8080\n          name: http\n        volumeMounts:\n        - name: ssl-certs\n          mountPath: \/etc\/ssl\/certs\n          readOnly: true\n      volumes:\n      - name: ssl-certs\n        hostPath:\n          path: \/etc\/ssl\/certs\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: heapster\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n---\nkind: Service\napiVersion: v1\nmetadata:\n  name: heapster\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    kubernetes.io\/name: \"Heapster\"\n    k8s-app: heapster\nspec:\n  ports:\n    - port: 80\n      targetPort: 8082\n  selector:\n    k8s-app: heapster\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: heapster\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: heapster\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/heapster\/heapster.yaml\n  \nkubectl create -f \/etc\/kubernetes\/addons\/heapster\/heapster.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Heapster"}],"uuid":"aa8dd27e-4bd1-4b85-86c6-750c0a49579f","description":"","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"f33eac3f_dag","uuid":"f9a1754f-f3f5-48ff-a8c5-3dfca6be79c1"},"name":"a9639da1_runbook"},"type":"system","description":"System action for creating an application"},{"uuid":"d424376b-92ac-4c83-b463-acaccddb4b01","name":"action_delete","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","uuid":"2b96e4c1-d55e-4878-b250-cfdb20a314ec","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"62a92d34_dag"}],"uuid":"a2ac512f-d272-4905-bafb-4733f7e58c9b","description":"","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"62a92d34_dag","uuid":"2b96e4c1-d55e-4878-b250-cfdb20a314ec"},"name":"8c4aa276_runbook"},"type":"system","description":"System action for deleting an application. Deletes created VMs as well"},{"uuid":"16704805-0ac9-49ef-b7ed-70b5f8c96531","name":"action_start","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","uuid":"6b1e66ab-fa56-478b-89b0-e46bbaad3abb","child_tasks_local_reference_list":[{"kind":"app_task","name":"Start","uuid":"e106bccf-2588-4947-984e-4241ff723ddc"}],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"334b4484_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","uuid":"e106bccf-2588-4947-984e-4241ff723ddc","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\nsudo systemctl start etcd docker kubelet\nsudo systemctl enable etcd docker kubelet\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Start"}],"uuid":"64e5991c-fbcd-4d1f-8b72-4b4956e9702e","description":"","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"334b4484_dag","uuid":"6b1e66ab-fa56-478b-89b0-e46bbaad3abb"},"name":"daee30ae_runbook"},"type":"system","description":"System action for starting an application"},{"uuid":"522b46ec-3b21-4daf-b761-9681c508a498","name":"action_stop","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","uuid":"a482f42b-56cb-4b17-801b-c6468ee259a8","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"9713c3d0_dag"}],"uuid":"1fdd3541-2eca-471a-a4be-4ef82887d4de","description":"","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"9713c3d0_dag","uuid":"a482f42b-56cb-4b17-801b-c6468ee259a8"},"name":"6407a345_runbook"},"type":"system","description":"System action for stopping an application"},{"uuid":"49e1c7a2-6b20-414a-a1f0-094c07a6ac3e","name":"action_restart","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","uuid":"c65cf6b8-285b-4fb7-9fee-dcaa5191015e","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"414912df_dag"}],"uuid":"526cc0d4-3d9e-49c6-840b-f42e056f5d89","description":"","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"414912df_dag","uuid":"c65cf6b8-285b-4fb7-9fee-dcaa5191015e"},"name":"d5c8316f_runbook"},"type":"system","description":"System action for restarting an application"}],"description":"","depends_on_list":[],"port_list":[],"tier":"","variable_list":[{"val_type":"STRING","description":"","uuid":"a5c98a70-c80a-423d-9638-18a88919ec40","value":"@@{KUBE_VERSION}@@","label":"","attrs":{"type":""},"type":"LOCAL","name":"VERSION"}],"name":"Kubernetes_Master"},{"singleton":false,"uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68","action_list":[{"uuid":"4904165e-6133-4e59-8c7b-cbf36b00a799","name":"action_create","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","uuid":"6742ec8c-3ab9-4b02-b7ef-5aafd6fad055","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"4af7c45f_dag"}],"uuid":"cabcfd41-35e6-45f0-a791-00daf17de059","description":"","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"4af7c45f_dag","uuid":"6742ec8c-3ab9-4b02-b7ef-5aafd6fad055"},"name":"7c6e4932_runbook"},"type":"system","description":"System action for creating an application"},{"uuid":"652b8beb-e3fb-4448-917c-0dff4ac4ff3f","name":"action_delete","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","uuid":"4ebfba89-7616-4bcd-b24f-bcf58292f826","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"1e2c50bb_dag"}],"uuid":"6b0fd64c-e97f-4968-998d-ff058e95d9e9","description":"","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"1e2c50bb_dag","uuid":"4ebfba89-7616-4bcd-b24f-bcf58292f826"},"name":"1d794193_runbook"},"type":"system","description":"System action for deleting an application. Deletes created VMs as well"},{"uuid":"5af53d26-a260-4688-b49d-f2d46247a174","name":"action_start","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","uuid":"cb741869-4ba2-49cd-9ac6-7a842f4a2277","child_tasks_local_reference_list":[{"kind":"app_task","name":"Start","uuid":"1e8228fb-5b7d-452e-a343-3366b1f324bc"}],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"970128c7_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","uuid":"1e8228fb-5b7d-452e-a343-3366b1f324bc","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nsudo systemctl start docker kubelet\nsudo systemctl enable docker kubelet","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Start"}],"uuid":"91f453c1-d2fc-47b1-93d4-4b49476235be","description":"","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"970128c7_dag","uuid":"cb741869-4ba2-49cd-9ac6-7a842f4a2277"},"name":"884352cf_runbook"},"type":"system","description":"System action for starting an application"},{"uuid":"0947a9b2-f508-445d-bba0-f319d80147e4","name":"action_stop","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","uuid":"0c3f910c-af0d-4ecf-a673-f4ae4ae0a8ad","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"6c01dc28_dag"}],"uuid":"12105be2-ee67-451d-8054-4546855e277c","description":"","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6c01dc28_dag","uuid":"0c3f910c-af0d-4ecf-a673-f4ae4ae0a8ad"},"name":"0cb172a7_runbook"},"type":"system","description":"System action for stopping an application"},{"uuid":"d52f5f4f-caef-49b7-a035-87aae7738a48","name":"action_restart","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","uuid":"9eda0f35-503d-4766-b93b-4e14968b559b","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"1d66b5be_dag"}],"uuid":"3fd75c09-a79f-4731-98fc-b65b96bc9fe7","description":"","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"1d66b5be_dag","uuid":"9eda0f35-503d-4766-b93b-4e14968b559b"},"name":"3a6f587d_runbook"},"type":"system","description":"System action for restarting an application"}],"description":"","depends_on_list":[],"port_list":[],"tier":"","variable_list":[{"val_type":"STRING","description":"","uuid":"c35b595e-283b-45c2-8512-071ad2d372ec","value":"@@{KUBE_VERSION}@@","label":"","attrs":{"type":""},"type":"LOCAL","name":"VERSION"}],"name":"Kubernetes_Minion"}],"substrate_definition_list":[{"description":"","action_list":[],"uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"timeout_secs":"300","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"0","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS","uuid":"5314d554-0539-406b-95eb-faa834a6ef81"}},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"name":true,"resources":{"nic_list":{"0":{"subnet_reference":true}},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"guest_customization":true,"disk_list":{"1":{"disk_size_mib":true},"3":{"disk_size_mib":true},"2":{"disk_size_mib":true},"5":{"disk_size_mib":true},"4":{"disk_size_mib":true},"6":{"disk_size_mib":true}}}}},"os_type":"Linux","type":"AHV_VM","create_spec":{"name":"K8SC-@@{calm_array_index}@@-@@{calm_time}@@","resources":{"nic_list":[],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"gpu_list":[],"memory_size_mib":2048,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{INSTANCE_PUBLIC_KEY}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","boot_config":{"boot_device":{"type":"","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CENTOS_74","uuid":"6cbb9b5f-3255-4d45-8d8f-0891f27ac147"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":1,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":2,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":3,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":4,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":5,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":6,"type":""}}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[],"name":"AHV_Centos_K8SC"},{"description":"","action_list":[],"uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"timeout_secs":"300","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"0","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS","uuid":"5314d554-0539-406b-95eb-faa834a6ef81"}},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"name":true,"resources":{"nic_list":{"0":{"subnet_reference":true}},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"guest_customization":true,"disk_list":{"1":{"disk_size_mib":true},"3":{"disk_size_mib":true},"2":{"disk_size_mib":true}}}}},"os_type":"Linux","type":"AHV_VM","create_spec":{"name":"K8SM-@@{calm_array_index}@@-@@{calm_time}@@","resources":{"nic_list":[],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"gpu_list":[],"memory_size_mib":2048,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{INSTANCE_PUBLIC_KEY}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","boot_config":{"boot_device":{"type":"","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CENTOS_74","uuid":"6cbb9b5f-3255-4d45-8d8f-0891f27ac147"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":1,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":2,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":3,"type":""}}}]},"availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"categories":""},"variable_list":[],"name":"AHV_Centos_K8SM"},{"description":"","action_list":[],"uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"timeout_secs":"300","address":"@@{public_ip_address}@@","delay_secs":"0","connection_port":22},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"name":true,"resources":{"instance_profile_name":true,"availability_zone":true,"subnet_id":true,"key_name":true,"region":true,"user_data":true,"image_id":true,"instance_type":true,"security_group_list":true,"block_device_map":{"data_disk_list":{"1":{"size_gb":true},"0":{"size_gb":true},"3":{"size_gb":true},"2":{"size_gb":true},"5":{"size_gb":true},"4":{"size_gb":true}},"root_disk":{"size_gb":true}},"associate_public_ip_address":true,"vpc_id":true,"tag_list":true}}},"os_type":"Linux","type":"AWS_VM","create_spec":{"name":"K8SC-@@{calm_array_index}@@-@@{calm_time}@@","availability_zone_reference":null,"backup_policy":null,"type":"PROVISION_AWS_VM","cluster_reference":null,"resources":{"instance_profile_name":"","availability_zone":"","subnet_id":"","key_name":"","region":"","instance_initiated_shutdown_behavior":"","user_data":"","image_id":"","instance_type":"","state":"RUNNING","security_group_list":[{"type":"","security_group_id":""}],"block_device_map":{"data_disk_list":[{"size_gb":10,"volume_type":"GP2","device_name":"\/dev\/sdb","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"GP2","device_name":"\/dev\/sdc","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"GP2","device_name":"\/dev\/sdd","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"STANDARD","device_name":"\/dev\/sde","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"STANDARD","device_name":"\/dev\/sdf","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":10,"volume_type":"STANDARD","device_name":"\/dev\/sdg","iops":1,"snapshot_id":"","type":"","delete_on_termination":true}],"type":"","root_disk":{"size_gb":10,"volume_type":"GP2","device_name":"\/dev\/sda1","iops":1,"snapshot_id":"","type":"","delete_on_termination":true}},"private_ip_address":"","vpc_id":"","tag_list":[{"type":"","value":"true","key":"kubernetes.io\/cluster\/@@{KUBE_CLUSTER_NAME}@@"}],"type":"","account_uuid":"8c2e0a6b-620a-c62a-c3f4-e58b101dfd0d","associate_public_ip_address":true}},"variable_list":[],"name":"AWS_Centos_K8SC"},{"description":"","action_list":[],"uuid":"a1988180-74c0-4c96-8ef4-78df7d762950","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"timeout_secs":"300","address":"@@{public_ip_address}@@","delay_secs":"0","connection_port":22},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"name":true,"resources":{"instance_profile_name":true,"availability_zone":true,"subnet_id":true,"key_name":true,"region":true,"user_data":true,"image_id":true,"instance_type":true,"security_group_list":true,"block_device_map":{"data_disk_list":{"1":{"size_gb":true},"0":{"size_gb":true},"2":{"size_gb":true}},"root_disk":{"size_gb":true}},"associate_public_ip_address":true,"vpc_id":true,"tag_list":true}}},"os_type":"Linux","type":"AWS_VM","create_spec":{"name":"K8SM-@@{calm_array_index}@@-@@{calm_time}@@","availability_zone_reference":null,"backup_policy":null,"type":"PROVISION_AWS_VM","cluster_reference":null,"resources":{"instance_profile_name":"","availability_zone":"","subnet_id":"","key_name":"","region":"","instance_initiated_shutdown_behavior":"","user_data":"","image_id":"","instance_type":"","state":"RUNNING","security_group_list":[{"type":"","security_group_id":""}],"block_device_map":{"data_disk_list":[{"size_gb":8,"volume_type":"GP2","device_name":"\/dev\/sdb","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":8,"volume_type":"GP2","device_name":"\/dev\/sdc","iops":1,"snapshot_id":"","type":"","delete_on_termination":true},{"size_gb":8,"volume_type":"GP2","device_name":"\/dev\/sdd","iops":1,"snapshot_id":"","type":"","delete_on_termination":true}],"type":"","root_disk":{"size_gb":8,"volume_type":"GP2","device_name":"\/dev\/sda1","iops":1,"snapshot_id":"","type":"","delete_on_termination":true}},"private_ip_address":"","vpc_id":"","tag_list":[{"type":"","value":"owned","key":"kubernetes.io\/cluster\/@@{KUBE_CLUSTER_NAME}@@"}],"type":"","account_uuid":"8c2e0a6b-620a-c62a-c3f4-e58b101dfd0d","associate_public_ip_address":true}},"variable_list":[],"name":"AWS_Centos_K8SM"},{"description":"","action_list":[],"uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"timeout_secs":"300","address":"@@{public_ip_address}@@","delay_secs":"0","connection_port":22},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"resources":{"labels":true,"machineType":true,"name":true,"zone":true,"tags":{"items":true},"guestCustomization":{"startupScript":true},"disks":{"0":{"initializeParams":{"diskSizeGb":true,"sourceImage":true,"diskType":true},"autoDelete":true}},"blankDisks":{"1":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true},"0":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true},"3":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true},"2":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true},"5":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true},"4":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true}},"networkInterfaces":{"0":{"accessConfigs":{"0":{"config_type":true,"name":true}},"network":true,"subnetwork":true}},"sshKeys":{"0":true},"serviceAccounts":{"0":{"scopes":true,"email":true}},"metadata":{"items":true}}}},"os_type":"Linux","type":"GCP_VM","create_spec":{"type":"PROVISION_GCP_VM","resources":{"labels":[],"machineType":"","description":"","zone":"","tags":{"items":[],"type":"","fingerprint":""},"guestCustomization":{"type":"","sysprep":"","startupScript":""},"labelFingerprint":"","disks":[{"diskEncryptionKey":{"rawKey":"","type":""},"deviceName":"","initializeParams":{"sourceImageEncryptionKey":{"rawKey":"","type":""},"diskName":"","diskType":"","diskSizeGb":10,"sourceImage":"","type":""},"autoDelete":true,"boot":true,"source":"","mode":"","interface":"","disk_type":"PERSISTENT","type":""}],"name":"k8sc-@@{calm_array_index}@@-@@{calm_time}@@","sshKeys":["centos:ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDMGAS\/K0Mb\/uwFXwD+hkjguy7VMZk2hpuhwPl9FUZwVBrURf\/i9QMJ5\/paPEZixu8VlRx7Inu4iun7rQfrnfeIYInmBwspXHYiTK3oHJAgZnrAHVEf1p6YaxLINlT1NI5yOAGPRWW6of8rBDBH1ObwU2+wcSx\/1H0uIs3aZNLufr+Rh628ACxAum2Gt8AVRj6ua2BPFyt5VTdclyysAmeh1AiixNgOZXOz6y\/i4TbzpY78I3isuKpxsUeXX6jxEMQol406jHDUF6njEOPIQG2zVZ3QJlTG9OlN+NiyZG9WkZz0VG\/6M8ixxIHHI2dNwUbBFv2HUu+8X9LTLFq2O7KjX9Hp7uZKBAySHA3eKaKHIp2bZuU1bT5PRPkggngX86xg+T+OMNnutbAiMnRJ8+FvD5So+5TIx4b9GgxAxure3x2yRPT9lOiQOB+CVpJPxR0Rn9bOI+wiPnD0kAGvK\/fHT+pqL4PM+hTnJtp9rrCRzIQApBx1263jEcYffhW2epZQRO+he5CMawFJ5TBe08om2AaDJ8GQdrpF6YA3W8DzHbmL3DPVVHdmqPLn10o+LX4gv5SdIIDVGdjKOc1BCnLTRmM28d5+sLDt\/M+kvcQgf0y0yDjMVjGECZkt39hbm4ELMHzZtzYLmHNhBZxRqHeJ7qFTuv1kx88OW3Xc5mbBNQ== centos@nutanix.com\n"],"canIpForward":false,"scheduling":{"automaticRestart":true,"type":"","preemptible":false,"onHostMaintenance":"TERMINATE"},"minCpuPlatform":"","blankDisks":[{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk1-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk2-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk3-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk4-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk5-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sc-disk6-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true}],"metadata":{"items":[],"type":"","fingerprint":""},"type":"","account_uuid":"84213a31-4fe8-7e39-3799-e093e5d0dc2e","serviceAccounts":[{"scopes":[],"type":"","email":"108048128720-compute@developer.gserviceaccount.com"}],"networkInterfaces":[{"aliasIpRanges":[],"network":"","accessConfigs":[{"config_type":"ONE_TO_ONE_NAT","type":"","name":"k8sc-acn-@@{calm_array_index}@@-@@{calm_time}@@","natIP":""}],"networkIP":"","subnetwork":"","type":""}]}},"variable_list":[],"name":"GCP_Centos_K8SC"},{"description":"","action_list":[],"uuid":"6b0f177a-9572-4df1-a6b8-71e996333516","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"timeout_secs":"300","address":"@@{public_ip_address}@@","delay_secs":"0","connection_port":22},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"resources":{"labels":true,"machineType":true,"name":true,"zone":true,"tags":{"items":true},"guestCustomization":{"startupScript":true},"disks":{"0":{"initializeParams":{"diskSizeGb":true,"sourceImage":true,"diskType":true},"autoDelete":true}},"blankDisks":{"1":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true},"0":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true},"2":{"disk_type":true,"name":true,"sizeGb":true,"autoDelete":true}},"networkInterfaces":{"0":{"accessConfigs":{"0":{"config_type":true,"name":true}},"network":true,"subnetwork":true}},"sshKeys":{"0":true},"serviceAccounts":{"0":{"scopes":true,"email":true}},"metadata":{"items":true}}}},"os_type":"Linux","type":"GCP_VM","create_spec":{"type":"PROVISION_GCP_VM","resources":{"labels":[],"machineType":"","description":"","zone":"","tags":{"items":[],"type":"","fingerprint":""},"guestCustomization":{"type":"","sysprep":"","startupScript":""},"labelFingerprint":"","disks":[{"diskEncryptionKey":{"rawKey":"","type":""},"deviceName":"","initializeParams":{"sourceImageEncryptionKey":{"rawKey":"","type":""},"diskName":"","diskType":"","diskSizeGb":10,"sourceImage":"","type":""},"autoDelete":true,"boot":true,"source":"","mode":"","interface":"","disk_type":"PERSISTENT","type":""}],"name":"k8sm-@@{calm_array_index}@@-@@{calm_time}@@","sshKeys":["centos:ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDMGAS\/K0Mb\/uwFXwD+hkjguy7VMZk2hpuhwPl9FUZwVBrURf\/i9QMJ5\/paPEZixu8VlRx7Inu4iun7rQfrnfeIYInmBwspXHYiTK3oHJAgZnrAHVEf1p6YaxLINlT1NI5yOAGPRWW6of8rBDBH1ObwU2+wcSx\/1H0uIs3aZNLufr+Rh628ACxAum2Gt8AVRj6ua2BPFyt5VTdclyysAmeh1AiixNgOZXOz6y\/i4TbzpY78I3isuKpxsUeXX6jxEMQol406jHDUF6njEOPIQG2zVZ3QJlTG9OlN+NiyZG9WkZz0VG\/6M8ixxIHHI2dNwUbBFv2HUu+8X9LTLFq2O7KjX9Hp7uZKBAySHA3eKaKHIp2bZuU1bT5PRPkggngX86xg+T+OMNnutbAiMnRJ8+FvD5So+5TIx4b9GgxAxure3x2yRPT9lOiQOB+CVpJPxR0Rn9bOI+wiPnD0kAGvK\/fHT+pqL4PM+hTnJtp9rrCRzIQApBx1263jEcYffhW2epZQRO+he5CMawFJ5TBe08om2AaDJ8GQdrpF6YA3W8DzHbmL3DPVVHdmqPLn10o+LX4gv5SdIIDVGdjKOc1BCnLTRmM28d5+sLDt\/M+kvcQgf0y0yDjMVjGECZkt39hbm4ELMHzZtzYLmHNhBZxRqHeJ7qFTuv1kx88OW3Xc5mbBNQ== centos@nutanix.com\n"],"canIpForward":false,"scheduling":{"automaticRestart":true,"type":"","preemptible":false,"onHostMaintenance":"TERMINATE"},"minCpuPlatform":"","blankDisks":[{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sm-disk1-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sm-disk2-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true},{"disk_type":"https:\/\/www.googleapis.com\/compute\/v1\/projects\/nucalm-devopos\/zones\/us-central1-c\/diskTypes\/pd-ssd","type":"","name":"k8sm-disk3-@@{calm_array_index}@@-@@{calm_time}@@","sizeGb":10,"autoDelete":true}],"metadata":{"items":[],"type":"","fingerprint":""},"type":"","account_uuid":"84213a31-4fe8-7e39-3799-e093e5d0dc2e","serviceAccounts":[{"scopes":[],"type":"","email":"108048128720-compute@developer.gserviceaccount.com"}],"networkInterfaces":[{"aliasIpRanges":[],"network":"","accessConfigs":[{"config_type":"ONE_TO_ONE_NAT","type":"","name":"k8sm-acm-@@{calm_array_index}@@-@@{calm_time}@@","natIP":""}],"networkIP":"","subnetwork":"","type":""}]}},"variable_list":[],"name":"GCP_Centos_K8SM"},{"description":"","action_list":[],"uuid":"2eaf885a-749d-4746-9a1a-b532a461b696","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"timeout_secs":"300","address":"@@{platform.publicIPAddressList[0]}@@","delay_secs":"0","connection_port":22},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":null},"create_spec":{"resources":{"vm_name":true,"storage_profile":{"is_managed":true,"image_details":{"sku":true,"publisher":true,"version":true,"use_custom_image":true,"offer":true},"os_disk_details":{"storage_type":true,"name":true,"caching_type":true,"create_option":true}},"nw_profile":{"nic_list":{"0":{"nsg_name":true,"vnet_name":true,"private_ip_info":{"ip_allocation_method":true},"nic_name":true,"subnet_name":true,"public_ip_info":{"ip_name":true,"dns_label":true,"ip_allocation_method":true}}}},"resource_group":true,"os_profile":{"linux_config":{"custom_data":true}},"hw_profile":{"vm_size":true},"location":true,"availability_set_id":true,"tag_list":true}}},"os_type":"Linux","type":"AZURE_VM","create_spec":{"type":"PROVISION_AZURE_VM","name":"","resources":{"vm_name":"K8SC-@@{calm_unique_hash}@@-@@{calm_array_index}@@","storage_profile":{"is_managed":true,"image_details":{"sku":"","publisher":"","offer":"","source_image_id":"","use_custom_image":false,"version":"","type":""},"type":"","os_disk_details":{"size_in_gb":127,"name":"os-@@{calm_unique_hash}@@-@@{calm_array_index}@@-disk","storage_name":"","storage_type":"Standard_LRS","lun":-1,"type":"","create_option":"FromImage","caching_type":"ReadWrite"},"data_disk_list":[]},"nw_profile":{"nic_list":[{"nsg_name":"","vnet_name":"","private_ip_info":{"ip_address":"","ip_allocation_method":"Dynamic","type":""},"nic_name":"nic-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","subnet_name":"","type":"","public_ip_info":{"ip_name":"public-ip-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","dns_label":"dns-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","ip_allocation_method":"Dynamic","type":""}}],"primary_nic":-1,"type":""},"resource_group":"","os_profile":{"secrets":[],"type":"","windows_config":{"winrm_listeners":[],"time_zone":"","additional_unattend_content":[],"provision_vm_agent":true,"auto_updates":false,"type":""},"linux_config":null},"hw_profile":{"max_data_disk_count":0,"vm_size":"","type":""},"location":"","availability_set_id":"","tag_list":[],"type":"","account_uuid":""}},"variable_list":[],"name":"Azure_Centos_K8SC"},{"description":"","action_list":[],"uuid":"85f444bf-ac07-4e13-a199-1e98a4019380","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"timeout_secs":"300","address":"@@{platform.publicIPAddressList[0]}@@","delay_secs":"0","connection_port":22},"editables":{"readiness_probe":{"connection_type":true,"delay_secs":true,"connection_port":true,"timeout_secs":null},"create_spec":{"resources":{"vm_name":true,"storage_profile":{"is_managed":true,"image_details":{"sku":true,"publisher":true,"version":true,"use_custom_image":true,"offer":true},"os_disk_details":{"storage_type":true,"name":true,"caching_type":true,"create_option":true}},"nw_profile":{"nic_list":{"0":{"nsg_name":true,"vnet_name":true,"private_ip_info":{"ip_allocation_method":true},"nic_name":true,"subnet_name":true,"public_ip_info":{"ip_allocation_method":true,"dns_label":true,"ip_name":true}}}},"resource_group":true,"os_profile":{"linux_config":{"custom_data":true}},"hw_profile":{"vm_size":true},"location":true,"availability_set_id":true,"tag_list":true}}},"os_type":"Linux","type":"AZURE_VM","create_spec":{"type":"PROVISION_AZURE_VM","name":"","resources":{"vm_name":"K8SM-@@{calm_unique_hash}@@-@@{calm_array_index}@@","storage_profile":{"is_managed":true,"image_details":{"sku":"","publisher":"","offer":"","source_image_id":"","use_custom_image":false,"version":"","type":""},"type":"","os_disk_details":{"size_in_gb":127,"name":"os-@@{calm_unique_hash}@@-@@{calm_array_index}@@-disk","storage_name":"","storage_type":"Standard_LRS","lun":-1,"type":"","create_option":"FromImage","caching_type":"ReadWrite"},"data_disk_list":[]},"nw_profile":{"nic_list":[{"nsg_name":"","vnet_name":"","private_ip_info":{"ip_address":"","ip_allocation_method":"Dynamic","type":""},"nic_name":"nic-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","subnet_name":"","type":"","public_ip_info":{"ip_name":"public-ip-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","dns_label":"dns-@@{calm_unique_hash}@@-@@{calm_array_index}@@-0","ip_allocation_method":"Dynamic","type":""}}],"primary_nic":-1,"type":""},"resource_group":"","os_profile":{"secrets":[],"type":"","windows_config":{"winrm_listeners":[],"time_zone":"","additional_unattend_content":[],"provision_vm_agent":true,"auto_updates":false,"type":""},"linux_config":null},"hw_profile":{"max_data_disk_count":0,"vm_size":"","type":""},"location":"","availability_set_id":"","tag_list":[],"type":"","account_uuid":""}},"variable_list":[],"name":"Azure_Centos_K8SM"}],"credential_definition_list":[{"username":"centos","description":"","uuid":"5314d554-0539-406b-95eb-faa834a6ef81","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{"uuid":"89e1dbfc-5655-40fd-ab74-6196d54aeb30"}}},"editables":{"username":true,"secret":true},"type":"KEY","name":"CENTOS"}],"type":"USER","app_profile_list":[{"deployment_create_list":[{"max_replicas":"3","action_list":[],"package_local_reference_list":[{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"}],"description":"","uuid":"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778","min_replicas":"3","editables":{"min_replicas":true,"max_replicas":true},"substrate_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"36dbce6d-ca23-448a-91ee-69ef8735b2cf"},"type":"GREENFIELD","variable_list":[],"name":"2cbb2f6a_deployment"},{"max_replicas":"9","action_list":[],"package_local_reference_list":[{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"}],"description":"","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418","min_replicas":"2","editables":{"min_replicas":true,"max_replicas":true},"substrate_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"da1cd62d-f7f6-48ee-b6fb-63c633eae3d1"},"type":"GREENFIELD","variable_list":[],"name":"39cf7283_deployment"}],"uuid":"67de5c53-dd3c-4c6a-8503-d5ee5a087af3","action_list":[{"uuid":"8df48e43-7721-4abd-8683-ae43bc5d9a15","name":"Upgrade","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"52ef32b7-658e-44bf-b409-9c4b0e259927","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Version Master","uuid":"b1165af4-fc50-45af-aca6-b3a6da147144"},{"kind":"app_task","name":"Set Version Minion","uuid":"9d38d3ff-c4e3-4e19-9af8-a33bd77c59ee"},{"kind":"app_task","name":"Upgrade Master","uuid":"e7ed1437-3bed-4981-96a6-5c9cf02f8920"},{"kind":"app_task","name":"Upgrade Minion","uuid":"6b7804fd-ef9c-45b0-b0f9-a47c0d4a0d13"},{"kind":"app_task","name":"RestartServices","uuid":"7bdf0e2b-5a44-4196-8c32-295d5481bf5a"}],"attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"b1165af4-fc50-45af-aca6-b3a6da147144"},"edge_type":"user_defined","type":"","uuid":"9aed1018-f53d-4e41-b8b2-eafd2482f3e8","to_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"e7ed1437-3bed-4981-96a6-5c9cf02f8920"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"e7ed1437-3bed-4981-96a6-5c9cf02f8920"},"edge_type":"user_defined","type":"","uuid":"58a5f2b7-f87c-44b6-9eaf-2a0146eb3264","to_task_reference":{"kind":"app_task","name":"RestartServices","uuid":"7bdf0e2b-5a44-4196-8c32-295d5481bf5a"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"b1165af4-fc50-45af-aca6-b3a6da147144"},"edge_type":"user_defined","type":"","uuid":"608fca6e-9d32-4497-a872-f88272162ac2","to_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"9d38d3ff-c4e3-4e19-9af8-a33bd77c59ee"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"9d38d3ff-c4e3-4e19-9af8-a33bd77c59ee"},"edge_type":"user_defined","type":"","uuid":"c2a52bd3-1a83-47bb-bff6-10989b039704","to_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"6b7804fd-ef9c-45b0-b0f9-a47c0d4a0d13"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"6b7804fd-ef9c-45b0-b0f9-a47c0d4a0d13"},"edge_type":"user_defined","type":"","uuid":"3888636f-e123-41bd-a551-5ce993657ce0","to_task_reference":{"kind":"app_task","name":"RestartServices","uuid":"7bdf0e2b-5a44-4196-8c32-295d5481bf5a"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"6ee65d8a_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","uuid":"b1165af4-fc50-45af-aca6-b3a6da147144","child_tasks_local_reference_list":[],"attrs":{"exit_status":[],"script":"if \"@@{calm_array_index}@@\" == \"0\":\n\tprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[],"name":"Set Version Master"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","uuid":"9d38d3ff-c4e3-4e19-9af8-a33bd77c59ee","child_tasks_local_reference_list":[],"attrs":{"exit_status":[],"script":"if \"@@{calm_array_index}@@\" == \"0\":\n\tprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[],"name":"Set Version Minion"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","uuid":"e7ed1437-3bed-4981-96a6-5c9cf02f8920","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{KUBE_VERSION_NEW}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nCONTROLLER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,AlwaysPullImages,DenyEscalatingExec,SecurityContextDeny,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false \n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Upgrade Master"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","uuid":"6b7804fd-ef9c-45b0-b0f9-a47c0d4a0d13","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{KUBE_VERSION_NEW}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Upgrade Minion"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","uuid":"7bdf0e2b-5a44-4196-8c32-295d5481bf5a","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nMINION_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nJSONPATH='{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}'\nKUBE_VERSION_NEW=\"@@{KUBE_VERSION_NEW}@@\"\nMASTER_API_HTTPS=6443\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION_NEW}\/bin\/linux\/amd64\/kubectl\nchmod +x kubectl\nsudo mv kubectl \/usr\/local\/bin\/kubectl\n\ncount=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n  echo \"Trying to reach master server https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} : sleep for 5 secs\"\n  sleep 10\n  if [[ $count -eq 10 ]]; then\n  \techo \"Unable to reach master server: https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\"\n  \texit 1\n  fi\n  count=$((count+1))\ndone\n\ncount=0\nfor ip in $(echo \"${MINION_IPS}\" | tr \",\" \"\\n\"); do\n  #kubectl drain \"minion${count}\" --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no $ip \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 10\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=minion${count} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon minion${count}\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n\techo \"Upgrade failed on minion nodes\"\n    exit 1\nfi\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  #kubectl drain \"controller${count}\" --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no $ip \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 10\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=controller${count} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon controller${count}\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n\techo \"Upgrade failed on nodes: $(kubectl get nodes -o jsonpath='$JSONPATH' | grep 'Ready=Unknown')\"\n    exit 1\nfi","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"RestartServices"}],"uuid":"c3ec0eab-79cc-4b1a-b51f-0e71968588ab","description":"","variable_list":[{"val_type":"STRING","description":"","uuid":"49b2515e-dd46-4b17-9eab-39b2a6b3acf7","value":"v1.8.14","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_VERSION_NEW"}],"main_task_local_reference":{"kind":"app_task","name":"6ee65d8a_dag","uuid":"52ef32b7-658e-44bf-b409-9c4b0e259927"},"name":"68a7ffd0_runbook"},"type":"user","description":""},{"uuid":"541eae7e-8d41-442b-ae29-81192fb1af0d","name":"ScaleOut","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"8266d7d6-332f-4928-aafa-f3f13a7bd0ac","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Out","uuid":"baa95372-5ba8-4cd6-ba97-9f8957aac695"},{"kind":"app_task","name":"Set Hosts file","uuid":"20c45d3c-7c3a-4538-a5aa-954b7cbe4176"}],"attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Scale Out","uuid":"baa95372-5ba8-4cd6-ba97-9f8957aac695"},"edge_type":"user_defined","type":"","uuid":"9a82a174-70af-4dce-87ae-117fd9ab5921","to_task_reference":{"kind":"app_task","name":"Set Hosts file","uuid":"20c45d3c-7c3a-4538-a5aa-954b7cbe4176"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"03b33121_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"retries":"0","description":"","uuid":"baa95372-5ba8-4cd6-ba97-9f8957aac695","child_tasks_local_reference_list":[],"attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","type":"SCALING","variable_list":[],"name":"Scale Out"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","uuid":"20c45d3c-7c3a-4538-a5aa-954b7cbe4176","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nMINION_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  if ! (( $(grep -c \"${ip} minion${count}\" \/etc\/hosts) )) ; then\n  \techo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  fi\n  count=$((count+1))\ndone","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Set Hosts file"}],"uuid":"4af27fbc-fada-4b75-986a-176445a6d03a","description":"","variable_list":[{"val_type":"STRING","description":"","uuid":"1f237a1b-8194-4967-9180-eb4006e0c3a1","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"03b33121_dag","uuid":"8266d7d6-332f-4928-aafa-f3f13a7bd0ac"},"name":"00cf5417_runbook"},"type":"user","description":""},{"uuid":"d0b6b1e1-1f41-4f0a-989f-e2509ff10cb1","name":"ScaleIn","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"b51fe409-5ef5-4ce7-b393-565bcdcff1af","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale In","uuid":"aa58b812-afd5-4a10-9d6f-f231897f722e"}],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"e72a9133_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"fc3bf5ce-7070-4a40-bc68-179c74c82418"},"retries":"0","description":"","uuid":"aa58b812-afd5-4a10-9d6f-f231897f722e","child_tasks_local_reference_list":[],"attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","type":"SCALING","variable_list":[],"name":"Scale In"}],"uuid":"012e53d8-3810-46d2-9085-a56d149b39de","description":"","variable_list":[{"val_type":"STRING","description":"","uuid":"b9748588-8d49-4c60-aa12-1344ac24da84","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"e72a9133_dag","uuid":"b51fe409-5ef5-4ce7-b393-565bcdcff1af"},"name":"96546f6c_runbook"},"type":"user","description":""}],"description":"","variable_list":[{"val_type":"STRING","description":"","uuid":"a9cde443-81ca-4b3f-a241-7b5c329f0268","value":"kube-calm","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_CLUSTER_NAME"},{"val_type":"STRING","description":"","uuid":"c9a4bd83-ff61-4e3e-9958-3319e13db038","value":"v1.8.0","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_VERSION"},{"val_type":"STRING","description":"","uuid":"c90d50cf-add7-4e47-817b-2669b4db4769","value":"17.03.2.ce","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"DOCKER_VERSION"},{"val_type":"STRING","description":"","uuid":"ea654b1b-ec70-46fa-b61d-9bb5eb09e85f","value":"10.200.0.0\/16","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_CLUSTER_SUBNET"},{"val_type":"STRING","description":"","uuid":"73c62af9-dd56-4e4b-9db4-625389f88503","value":"10.32.0.0\/24","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_SERVICE_SUBNET"},{"val_type":"STRING","description":"","uuid":"92475432-f8e5-4223-8b36-76200cae509c","value":"10.32.0.10","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_DNS_IP"},{"val_type":"STRING","description":"","uuid":"ba461b6f-30da-4ed6-9f71-c8142415a9bf","value":"10.5.68.20","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"PE_CLUSTER_IP"},{"val_type":"STRING","description":"","uuid":"ca26ae6f-5fd0-403b-9775-79913a485449","value":"10.5.68.27","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"PE_DATA_SERVICE_IP"},{"val_type":"STRING","description":"","uuid":"62338d48-f33f-4301-83c0-f98a6a1983f2","value":"admin","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"PE_USERNAME"},{"val_type":"STRING","description":"","uuid":"3d9f1936-188f-4d49-b5e2-66bd547ddc24","label":"","attrs":{"is_secret_modified":true,"secret_reference":{"uuid":"79103a36-5e49-4bae-a1a8-3989015061a0"}},"editables":{"value":true},"type":"SECRET","name":"PE_PASSWORD"},{"val_type":"STRING","description":"","uuid":"f5ef95f1-2154-4590-8254-ba9aac7eebe4","value":"default-container-71229","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"PE_CONTAINER_NAME"},{"val_type":"STRING","description":"","uuid":"a1bd93c4-dcc6-4cff-b427-7daf72c06768","value":"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDMGAS\/K0Mb\/uwFXwD+hkjguy7VMZk2hpuhwPl9FUZwVBrURf\/i9QMJ5\/paPEZixu8VlRx7Inu4iun7rQfrnfeIYInmBwspXHYiTK3oHJAgZnrAHVEf1p6YaxLINlT1NI5yOAGPRWW6of8rBDBH1ObwU2+wcSx\/1H0uIs3aZNLufr+Rh628ACxAum2Gt8AVRj6ua2BPFyt5VTdclyysAmeh1AiixNgOZXOz6y\/i4TbzpY78I3isuKpxsUeXX6jxEMQol406jHDUF6njEOPIQG2zVZ3QJlTG9OlN+NiyZG9WkZz0VG\/6M8ixxIHHI2dNwUbBFv2HUu+8X9LTLFq2O7KjX9Hp7uZKBAySHA3eKaKHIp2bZuU1bT5PRPkggngX86xg+T+OMNnutbAiMnRJ8+FvD5So+5TIx4b9GgxAxure3x2yRPT9lOiQOB+CVpJPxR0Rn9bOI+wiPnD0kAGvK\/fHT+pqL4PM+hTnJtp9rrCRzIQApBx1263jEcYffhW2epZQRO+he5CMawFJ5TBe08om2AaDJ8GQdrpF6YA3W8DzHbmL3DPVVHdmqPLn10o+LX4gv5SdIIDVGdjKOc1BCnLTRmM28d5+sLDt\/M+kvcQgf0y0yDjMVjGECZkt39hbm4ELMHzZtzYLmHNhBZxRqHeJ7qFTuv1kx88OW3Xc5mbBNQ== centos@nutanix.com","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"INSTANCE_PUBLIC_KEY"}],"name":"Nutanix"},{"deployment_create_list":[{"max_replicas":"3","action_list":[],"package_local_reference_list":[{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"}],"description":"","uuid":"f5bcb26d-6a13-4eb5-91c5-202d025130f0","min_replicas":"3","editables":{"min_replicas":true,"max_replicas":true},"substrate_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SC","uuid":"038d0ef5-037e-4ca6-a9c6-fa4afe0c2b61"},"type":"GREENFIELD","variable_list":[],"name":"85fa2262_deployment"},{"max_replicas":"9","action_list":[],"package_local_reference_list":[{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"}],"description":"","uuid":"a49dec52-b184-47d2-b1db-43be87961d75","min_replicas":"3","editables":{"min_replicas":true,"max_replicas":true},"substrate_local_reference":{"kind":"app_substrate","name":"AWS_Centos_K8SM","uuid":"a1988180-74c0-4c96-8ef4-78df7d762950"},"type":"GREENFIELD","variable_list":[],"name":"d6584f2e_deployment"}],"uuid":"8fb0934d-e5f1-467c-8890-2714d6fae8ab","action_list":[{"uuid":"814c5c05-42be-4bb3-817f-8b2199915599","name":"Upgrade","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"66458b52-fd26-4e25-b2f9-14799bbd5147","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Version Master","uuid":"11db2829-cbc1-48ad-92a6-78a3d3900b4c"},{"kind":"app_task","name":"Set Version Minion","uuid":"bd4414b2-8ba3-4f55-8612-98d1fcda2984"},{"kind":"app_task","name":"Upgrade Controller","uuid":"931e4355-5d87-4674-83e3-4cbd3c611a9b"},{"kind":"app_task","name":"Upgrade Minion","uuid":"00da6f94-0f2d-44ac-b0bf-6bdb5beed842"},{"kind":"app_task","name":"Restart Services","uuid":"187c3f31-ca02-4b04-8b27-d4c27e205019"}],"attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"11db2829-cbc1-48ad-92a6-78a3d3900b4c"},"edge_type":"user_defined","type":"","uuid":"28870c3f-d312-42a1-baa6-fafdaf04a236","to_task_reference":{"kind":"app_task","name":"Upgrade Controller","uuid":"931e4355-5d87-4674-83e3-4cbd3c611a9b"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Controller","uuid":"931e4355-5d87-4674-83e3-4cbd3c611a9b"},"edge_type":"user_defined","type":"","uuid":"50e19759-aa38-4886-af0d-288dd3c32a21","to_task_reference":{"kind":"app_task","name":"Restart Services","uuid":"187c3f31-ca02-4b04-8b27-d4c27e205019"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"bd4414b2-8ba3-4f55-8612-98d1fcda2984"},"edge_type":"user_defined","type":"","uuid":"f2d61f9e-4d5c-4691-8a4f-e577747dfd7b","to_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"00da6f94-0f2d-44ac-b0bf-6bdb5beed842"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"11db2829-cbc1-48ad-92a6-78a3d3900b4c"},"edge_type":"user_defined","type":"","uuid":"51f29400-d1a5-4ec9-89b8-d3c71372c73f","to_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"bd4414b2-8ba3-4f55-8612-98d1fcda2984"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"00da6f94-0f2d-44ac-b0bf-6bdb5beed842"},"edge_type":"user_defined","type":"","uuid":"9a48f57f-3bdc-4408-81aa-d0f55b3a305c","to_task_reference":{"kind":"app_task","name":"Restart Services","uuid":"187c3f31-ca02-4b04-8b27-d4c27e205019"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"17adda9e_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","uuid":"11db2829-cbc1-48ad-92a6-78a3d3900b4c","child_tasks_local_reference_list":[],"attrs":{"exit_status":[],"script":"if \"@@{calm_array_index}@@\" == \"0\":\n\tprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[],"name":"Set Version Master"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","uuid":"bd4414b2-8ba3-4f55-8612-98d1fcda2984","child_tasks_local_reference_list":[],"attrs":{"exit_status":[],"script":"if \"@@{calm_array_index}@@\" == \"0\":\n\tprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[],"name":"Set Version Minion"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","uuid":"931e4355-5d87-4674-83e3-4cbd3c611a9b","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{KUBE_VERSION_NEW}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nCONTROLLER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=aws \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,AlwaysPullImages,DenyEscalatingExec,SecurityContextDeny,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --cloud-provider=aws\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --cloud-provider=aws\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Upgrade Controller"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","uuid":"00da6f94-0f2d-44ac-b0bf-6bdb5beed842","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{KUBE_VERSION_NEW}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=aws \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Upgrade Minion"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","uuid":"187c3f31-ca02-4b04-8b27-d4c27e205019","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_DNS=\"@@{calm_array_private_dns_name}@@\" \nMINION_DNS=\"@@{AWS_Centos_K8SM.private_dns_name}@@\" \nJSONPATH='{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}'\nKUBE_VERSION_NEW=\"@@{KUBE_VERSION_NEW}@@\"\nMASTER_API_HTTPS=6443\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION_NEW}\/bin\/linux\/amd64\/kubectl\nchmod +x kubectl\nsudo mv kubectl \/usr\/local\/bin\/kubectl\n\ncount=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n  echo \"Trying to reach master server https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} : sleep for 5 secs\"\n  sleep 10\n  if [[ $count -eq 10 ]]; then\n  \techo \"Unable to reach master server: https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\"\n  \texit 1\n  fi\n  count=$((count+1))\ndone\n\nfor name in $(echo \"${MINION_DNS}\" | tr \",\" \"\\n\"); do\n  #kubectl drain \"$name\" --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no $name \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 20\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=${name} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon $name\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n\techo \"Upgrade failed on minion nodes\"\n    exit 1\nfi\n\nfor name in $(echo \"${CONTROLLER_DNS}\" | tr \",\" \"\\n\"); do\n  #kubectl drain \"${name}\" --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no $name \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 20\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=$name -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon $name\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n\techo \"Upgrade failed on nodes: $(kubectl get nodes -o jsonpath='$JSONPATH' | grep 'Ready=Unknown')\"\n    exit 1\nfi","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Restart Services"}],"uuid":"ce36d34b-264d-451e-8c48-dedecfab3d5d","description":"","variable_list":[{"val_type":"STRING","description":"","uuid":"b30d62a2-4a8a-48c6-9d0d-e6c3ee8dee5a","value":"v1.8.14","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_VERSION_NEW"}],"main_task_local_reference":{"kind":"app_task","name":"17adda9e_dag","uuid":"66458b52-fd26-4e25-b2f9-14799bbd5147"},"name":"dfce2dff_runbook"},"type":"user","description":""},{"uuid":"bfe6e048-4c25-4c65-85b5-c9dd46d4d40d","name":"ScaleOut","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"c109e84a-7bac-452c-92a2-4627ba9e456d","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Out","uuid":"88866b4c-6846-4482-b0e6-1253a167a3de"},{"kind":"app_task","name":"Set Hosts File","uuid":"690492f7-8a10-4c0e-80c2-abaef54f4d0c"}],"attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Scale Out","uuid":"88866b4c-6846-4482-b0e6-1253a167a3de"},"edge_type":"user_defined","type":"","uuid":"8df80031-b4db-4d2b-87ea-9c7c93888b81","to_task_reference":{"kind":"app_task","name":"Set Hosts File","uuid":"690492f7-8a10-4c0e-80c2-abaef54f4d0c"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"a0fb1ecf_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"retries":"0","description":"","uuid":"88866b4c-6846-4482-b0e6-1253a167a3de","child_tasks_local_reference_list":[],"attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","type":"SCALING","variable_list":[],"name":"Scale Out"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","uuid":"690492f7-8a10-4c0e-80c2-abaef54f4d0c","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nMINION_IPS=\"@@{AWS_Centos_K8SM.private_ip_address}@@\"\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  if ! (( $(grep -c \"${ip} minion${count}\" \/etc\/hosts) )) ; then\n  \techo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  fi\n  count=$((count+1))\ndone","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Set Hosts File"}],"uuid":"5382e080-a744-4549-a47e-df5b01c0f8ff","description":"","variable_list":[{"val_type":"STRING","description":"","uuid":"fa4b3882-c2b1-4221-9bf8-a50f0e65a56c","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"a0fb1ecf_dag","uuid":"c109e84a-7bac-452c-92a2-4627ba9e456d"},"name":"55139b34_runbook"},"type":"user","description":""},{"uuid":"d2e6cd45-c6bc-42a2-a450-c5263ec4d5bd","name":"ScaleIn","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"164394ee-9b15-4edb-b0a7-79df3f7b3c17","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale In","uuid":"7eaa902d-3fe0-4bc8-a12a-428e0160386f"}],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"adfef604_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"d6584f2e_deployment","uuid":"a49dec52-b184-47d2-b1db-43be87961d75"},"retries":"0","description":"","uuid":"7eaa902d-3fe0-4bc8-a12a-428e0160386f","child_tasks_local_reference_list":[],"attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","type":"SCALING","variable_list":[],"name":"Scale In"}],"uuid":"6ee7fb3c-91ca-4bdb-abf7-6b6c6819c5b6","description":"","variable_list":[{"val_type":"STRING","description":"","uuid":"1aca702d-a358-44c2-ba91-00eabc9eab26","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"adfef604_dag","uuid":"164394ee-9b15-4edb-b0a7-79df3f7b3c17"},"name":"65df2c70_runbook"},"type":"user","description":""}],"description":"","variable_list":[{"val_type":"STRING","description":"","uuid":"31cc8396-d8fa-47fc-b27c-c4c613939d70","value":"kube-calm-aws1","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_CLUSTER_NAME"},{"val_type":"STRING","description":"","uuid":"c1afae35-4f4c-4cfe-aed6-a1f81295308b","value":"v1.8.0","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_VERSION"},{"val_type":"STRING","description":"","uuid":"a8daabf3-fc53-4eb5-8942-fc391003738a","value":"17.03.2.ce","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"DOCKER_VERSION"},{"val_type":"STRING","description":"","uuid":"d3303548-5cee-4aca-abe8-f33502bf36a6","value":"10.200.0.0\/16","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_CLUSTER_SUBNET"},{"val_type":"STRING","description":"","uuid":"966538d4-ce8b-4ce8-817a-4c40419bfb97","value":"10.32.0.0\/24","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_SERVICE_SUBNET"},{"val_type":"STRING","description":"","uuid":"ef6cf7dc-8a0e-4ddd-9085-230d2af6e897","value":"10.32.0.10","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_DNS_IP"}],"name":"AWS"},{"deployment_create_list":[{"max_replicas":"3","action_list":[],"package_local_reference_list":[{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"}],"description":"","uuid":"e54dd002-50e1-4051-bc5a-c2bb008669ee","min_replicas":"3","editables":{"min_replicas":true,"max_replicas":true},"substrate_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SC","uuid":"b970ceaa-d23f-40d6-80ae-26f475a587e3"},"type":"GREENFIELD","variable_list":[],"name":"34875daf_deployment"},{"max_replicas":"9","action_list":[],"package_local_reference_list":[{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"}],"description":"","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841","min_replicas":"3","editables":{"min_replicas":true,"max_replicas":true},"substrate_local_reference":{"kind":"app_substrate","name":"GCP_Centos_K8SM","uuid":"6b0f177a-9572-4df1-a6b8-71e996333516"},"type":"GREENFIELD","variable_list":[],"name":"77b729d5_deployment"}],"uuid":"1c0be862-70e3-4e5b-af51-c82cc7f6b22c","action_list":[{"uuid":"7c12b2e8-751f-41e0-8ad5-32ca663403d1","name":"Upgrade","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"7cf46877-1eb7-4b27-b8f0-23398fa8a16f","child_tasks_local_reference_list":[{"kind":"app_task","name":"Upgrade Minion","uuid":"567f9e1a-e77f-4429-ad42-13f6db4494d7"},{"kind":"app_task","name":"Upgrade Controller","uuid":"50aa5efe-dc3c-4a8c-a2bc-5f2d3e5b7b37"},{"kind":"app_task","name":"Set Version Minion","uuid":"e74c2aae-b926-4345-a7b4-8ab170f553cd"},{"kind":"app_task","name":"Restart Services","uuid":"43da19be-f327-4895-bbb9-9610ee99fa79"},{"kind":"app_task","name":"Set Version Master","uuid":"c2545cf1-89c0-4be1-b73e-84b6d100f608"}],"attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Upgrade Controller","uuid":"50aa5efe-dc3c-4a8c-a2bc-5f2d3e5b7b37"},"edge_type":"user_defined","type":"","uuid":"e4c20a6c-3eaa-426e-ab33-0a966d59447a","to_task_reference":{"kind":"app_task","name":"Restart Services","uuid":"43da19be-f327-4895-bbb9-9610ee99fa79"}},{"from_task_reference":{"kind":"app_task","name":"Restart Services","uuid":"43da19be-f327-4895-bbb9-9610ee99fa79"},"edge_type":"user_defined","type":"","uuid":"2ce04844-8cec-450f-a3ae-74cbb88cae31","to_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"c2545cf1-89c0-4be1-b73e-84b6d100f608"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"567f9e1a-e77f-4429-ad42-13f6db4494d7"},"edge_type":"user_defined","type":"","uuid":"6a0e5eef-d895-4d78-b98b-5c80bfdf0e6c","to_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"e74c2aae-b926-4345-a7b4-8ab170f553cd"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"e74c2aae-b926-4345-a7b4-8ab170f553cd"},"edge_type":"user_defined","type":"","uuid":"8c15a398-4a19-4827-b3ed-436225a523fe","to_task_reference":{"kind":"app_task","name":"Restart Services","uuid":"43da19be-f327-4895-bbb9-9610ee99fa79"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"cbdb4fa8_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","uuid":"567f9e1a-e77f-4429-ad42-13f6db4494d7","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{KUBE_VERSION_NEW}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=gce \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Upgrade Minion"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","uuid":"50aa5efe-dc3c-4a8c-a2bc-5f2d3e5b7b37","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{KUBE_VERSION_NEW}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nCONTROLLER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --cloud-provider=gce \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --cloud-provider=gce\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem  \n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --cloud-provider=gce\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Upgrade Controller"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","uuid":"e74c2aae-b926-4345-a7b4-8ab170f553cd","child_tasks_local_reference_list":[],"attrs":{"exit_status":[],"script":"if \"@@{calm_array_index}@@\" == \"0\":\n\tprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[],"name":"Set Version Minion"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","uuid":"43da19be-f327-4895-bbb9-9610ee99fa79","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_NAMES=\"@@{calm_array_name}@@\" \nMINION_NAMES=\"@@{GCP_Centos_K8SM.name}@@\" \nJSONPATH='{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}'\nKUBE_VERSION_NEW=\"@@{KUBE_VERSION_NEW}@@\"\nMASTER_API_HTTPS=6443\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION_NEW}\/bin\/linux\/amd64\/kubectl\nchmod +x kubectl\nsudo mv kubectl \/usr\/local\/bin\/kubectl\n\ncount=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n  echo \"Trying to reach master server https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} : sleep for 5 secs\"\n  sleep 10\n  if [[ $count -eq 10 ]]; then\n  \techo \"Unable to reach master server: https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\"\n  \texit 1\n  fi\n  count=$((count+1))\ndone\n\ncount=0\nfor name in $(echo \"${MINION_NAMES}\" | tr \",\" \"\\n\"); do\n  #kubectl drain ${name} --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no \"minion${count}\" \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 20\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=${name} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon ${name}\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n\techo \"Upgrade failed on minion nodes\"\n    exit 1\nfi\n\ncount=0\nfor name in $(echo \"${CONTROLLER_NAMES}\" | tr \",\" \"\\n\"); do\n  #kubectl drain $name --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no \"controller${count}\" \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 20\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=$name -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon $name\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n\techo \"Upgrade failed on nodes: $(kubectl get nodes -o jsonpath='$JSONPATH' | grep 'Ready=Unknown')\"\n    exit 1\nfi","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Restart Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","uuid":"c2545cf1-89c0-4be1-b73e-84b6d100f608","child_tasks_local_reference_list":[],"attrs":{"exit_status":[],"script":"if \"@@{calm_array_index}@@\" == \"0\":\n\tprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[],"name":"Set Version Master"}],"uuid":"fad723fe-ae8d-41b4-8a64-5324f43d2e04","description":"","variable_list":[{"val_type":"STRING","description":"","uuid":"629eef81-ddda-4938-a430-ee1d189c1f99","value":"v1.8.14","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_VERSION_NEW"}],"main_task_local_reference":{"kind":"app_task","name":"cbdb4fa8_dag","uuid":"7cf46877-1eb7-4b27-b8f0-23398fa8a16f"},"name":"8d003d32_runbook"},"type":"user","description":""},{"uuid":"15583554-ea8e-45a3-b6e0-4f3e865c5fcf","name":"ScaleOut","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"b70bf1f8-aba2-4128-afe8-47858b7c9a47","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Out","uuid":"b7363f5b-94d9-4b54-849d-e1b62ce3dff8"},{"kind":"app_task","name":"Set Hosts File","uuid":"c14e293d-fd44-4879-b532-76e962c23c27"}],"attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Scale Out","uuid":"b7363f5b-94d9-4b54-849d-e1b62ce3dff8"},"edge_type":"user_defined","type":"","uuid":"00a49bcf-cd48-4e94-9def-127b66cc2757","to_task_reference":{"kind":"app_task","name":"Set Hosts File","uuid":"c14e293d-fd44-4879-b532-76e962c23c27"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"f3682593_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"retries":"0","description":"","uuid":"b7363f5b-94d9-4b54-849d-e1b62ce3dff8","child_tasks_local_reference_list":[],"attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","type":"SCALING","variable_list":[],"name":"Scale Out"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","uuid":"c14e293d-fd44-4879-b532-76e962c23c27","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nMINION_IPS=\"@@{GCP_Centos_K8SM.private_ip_address}@@\"\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  if ! (( $(grep -c \"${ip} minion${count}\" \/etc\/hosts) )) ; then\n  \techo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  fi\n  count=$((count+1))\ndone","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Set Hosts File"}],"uuid":"da0374ec-4819-4bac-8cf5-3b0b7d5607f2","description":"","variable_list":[{"val_type":"STRING","description":"","uuid":"bc65a077-eb02-462e-82d8-e68278fbdf05","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"f3682593_dag","uuid":"b70bf1f8-aba2-4128-afe8-47858b7c9a47"},"name":"744583cd_runbook"},"type":"user","description":""},{"uuid":"7ebe37ac-bcb3-447a-a8d3-6b6cdd74335e","name":"ScaleIn","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"e5b282e1-d845-4219-ba56-760e863aa1ac","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale In","uuid":"07289a2e-2f49-4957-ab24-2ab67234edc5"}],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"853cb860_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment","uuid":"3df01c9c-b48a-44c9-8500-a5d135ae0841"},"retries":"0","description":"","uuid":"07289a2e-2f49-4957-ab24-2ab67234edc5","child_tasks_local_reference_list":[],"attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","type":"SCALING","variable_list":[],"name":"Scale In"}],"uuid":"5013737f-1fdf-4f75-bccb-4dcb1d60a4af","description":"","variable_list":[{"val_type":"STRING","description":"","uuid":"067777e1-117e-487d-a4da-4b8ef05bad44","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"853cb860_dag","uuid":"e5b282e1-d845-4219-ba56-760e863aa1ac"},"name":"9331a25f_runbook"},"type":"user","description":""}],"description":"","variable_list":[{"val_type":"STRING","description":"","uuid":"6f2833c0-9253-4f08-b7fc-678cb1d7251b","value":"kube-calm","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_CLUSTER_NAME"},{"val_type":"STRING","description":"","uuid":"b0344744-2782-4a16-a33c-f5758e024946","value":"v1.8.0","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_VERSION"},{"val_type":"STRING","description":"","uuid":"b808977e-cbee-473c-8e61-88c84bf91c20","value":"17.03.2.ce","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"DOCKER_VERSION"},{"val_type":"STRING","description":"","uuid":"d8078373-3a50-4023-997b-84e679035d23","value":"10.200.0.0\/16","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_CLUSTER_SUBNET"},{"val_type":"STRING","description":"","uuid":"df744e4d-5bb4-428c-b47e-e84bd8439e11","value":"10.32.0.0\/24","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_SERVICE_SUBNET"},{"val_type":"STRING","description":"","uuid":"7fd1f9a4-f572-4ed2-9e60-283c5ad394a2","value":"10.32.0.10","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_DNS_IP"}],"name":"GCP"},{"deployment_create_list":[{"max_replicas":"3","action_list":[],"package_local_reference_list":[{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"}],"description":"","uuid":"5d33c234-98e6-44ef-97c8-83771613cb91","min_replicas":"3","editables":{"min_replicas":true,"max_replicas":true},"substrate_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SC","uuid":"2eaf885a-749d-4746-9a1a-b532a461b696"},"type":"GREENFIELD","variable_list":[],"name":"34875daf_deployment_cloned_1"},{"max_replicas":"9","action_list":[],"package_local_reference_list":[{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"}],"description":"","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c","min_replicas":"3","editables":{"min_replicas":true,"max_replicas":true},"substrate_local_reference":{"kind":"app_substrate","name":"Azure_Centos_K8SM","uuid":"85f444bf-ac07-4e13-a199-1e98a4019380"},"type":"GREENFIELD","variable_list":[],"name":"77b729d5_deployment_cloned_1"}],"uuid":"4589c966-0926-43a1-9cbe-2dbeabb98aa6","action_list":[{"uuid":"644d9d5c-ed4c-4176-bb90-c1caf9bc25f0","name":"Upgrade","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"d2ae21ac-8095-49c4-a147-40dff0e2da6e","child_tasks_local_reference_list":[{"kind":"app_task","name":"Upgrade Minion","uuid":"aeba6135-5c91-4a34-83ab-314689e47b79"},{"kind":"app_task","name":"Upgrade Controller","uuid":"a3cdc977-cdeb-4826-9197-2070967960ed"},{"kind":"app_task","name":"Set Version Minion","uuid":"82624031-2cbc-40e5-8b63-bfb517f380c0"},{"kind":"app_task","name":"Restart Services","uuid":"61cf4fc8-5bed-4a67-b520-8125883eea87"},{"kind":"app_task","name":"Set Version Master","uuid":"05ae9a35-1127-45c7-aac2-12a4cc3e1caf"}],"attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Upgrade Controller","uuid":"a3cdc977-cdeb-4826-9197-2070967960ed"},"edge_type":"user_defined","type":"","uuid":"810c0501-da7d-4966-9fd4-9f01cec36288","to_task_reference":{"kind":"app_task","name":"Restart Services","uuid":"61cf4fc8-5bed-4a67-b520-8125883eea87"}},{"from_task_reference":{"kind":"app_task","name":"Restart Services","uuid":"61cf4fc8-5bed-4a67-b520-8125883eea87"},"edge_type":"user_defined","type":"","uuid":"6b750205-8115-4b38-8ce8-6fb93825ab26","to_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"05ae9a35-1127-45c7-aac2-12a4cc3e1caf"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"aeba6135-5c91-4a34-83ab-314689e47b79"},"edge_type":"user_defined","type":"","uuid":"5e35184b-c9ce-428f-a7bc-ab81a2146527","to_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"82624031-2cbc-40e5-8b63-bfb517f380c0"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"82624031-2cbc-40e5-8b63-bfb517f380c0"},"edge_type":"user_defined","type":"","uuid":"778766cc-5d22-44b0-b8bc-4fb19290e603","to_task_reference":{"kind":"app_task","name":"Restart Services","uuid":"61cf4fc8-5bed-4a67-b520-8125883eea87"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"cbdb4fa8_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","uuid":"aeba6135-5c91-4a34-83ab-314689e47b79","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{KUBE_VERSION_NEW}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Upgrade Minion"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","uuid":"a3cdc977-cdeb-4826-9197-2070967960ed","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{KUBE_VERSION_NEW}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nCONTROLLER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem  \n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Upgrade Controller"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","description":"","uuid":"82624031-2cbc-40e5-8b63-bfb517f380c0","child_tasks_local_reference_list":[],"attrs":{"exit_status":[],"script":"if \"@@{calm_array_index}@@\" == \"0\":\n\tprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[],"name":"Set Version Minion"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","uuid":"61cf4fc8-5bed-4a67-b520-8125883eea87","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_NAMES=\"@@{calm_array_name}@@\" \nMINION_NAMES=\"@@{Azure_Centos_K8SM.name}@@\" \nJSONPATH='{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}'\nKUBE_VERSION_NEW=\"@@{KUBE_VERSION_NEW}@@\"\nMASTER_API_HTTPS=6443\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION_NEW}\/bin\/linux\/amd64\/kubectl\nchmod +x kubectl\nsudo mv kubectl \/usr\/local\/bin\/kubectl\n\ncount=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n  echo \"Trying to reach master server https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} : sleep for 5 secs\"\n  sleep 10\n  if [[ $count -eq 10 ]]; then\n  \techo \"Unable to reach master server: https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\"\n  \texit 1\n  fi\n  count=$((count+1))\ndone\n\ncount=0\nfor name in $(echo \"${MINION_NAMES}\" | tr \",\" \"\\n\"); do\n  #kubectl drain ${name} --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no \"minion${count}\" \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 20\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=${name} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon ${name}\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n\techo \"Upgrade failed on minion nodes\"\n    exit 1\nfi\n\ncount=0\nfor name in $(echo \"${CONTROLLER_NAMES}\" | tr \",\" \"\\n\"); do\n  #kubectl drain $name --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no \"controller${count}\" \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 20\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=$name -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon $name\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n\techo \"Upgrade failed on nodes: $(kubectl get nodes -o jsonpath='$JSONPATH' | grep 'Ready=Unknown')\"\n    exit 1\nfi","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Restart Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","uuid":"05ae9a35-1127-45c7-aac2-12a4cc3e1caf","child_tasks_local_reference_list":[],"attrs":{"exit_status":[],"script":"if \"@@{calm_array_index}@@\" == \"0\":\n\tprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[],"name":"Set Version Master"}],"uuid":"faf1f9b1-726f-41c0-a90f-7ba3a647ef38","description":"","variable_list":[{"val_type":"STRING","description":"","uuid":"c5af32bf-ee5d-49f4-bbf9-b9a68a306245","value":"v1.8.14","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_VERSION_NEW"}],"main_task_local_reference":{"kind":"app_task","name":"cbdb4fa8_dag","uuid":"d2ae21ac-8095-49c4-a147-40dff0e2da6e"},"name":"8d003d32_runbook_cloned_1"},"type":"user","description":""},{"uuid":"75ca43f8-3fee-4ea9-9339-1c9c169d41db","name":"ScaleOut","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"5d00cf2e-e157-4e9a-bf74-aea62902c521","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Out","uuid":"f055c9d2-2414-4cb2-a653-d3a33e50cfa8"},{"kind":"app_task","name":"Set Hosts File","uuid":"a2f54fce-caad-4016-b7d7-e43a465c4cc7"}],"attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Scale Out","uuid":"f055c9d2-2414-4cb2-a653-d3a33e50cfa8"},"edge_type":"user_defined","type":"","uuid":"d0de8ee7-bbc0-4495-ba3c-42930e2dbdbe","to_task_reference":{"kind":"app_task","name":"Set Hosts File","uuid":"a2f54fce-caad-4016-b7d7-e43a465c4cc7"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"f3682593_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"retries":"0","description":"","uuid":"f055c9d2-2414-4cb2-a653-d3a33e50cfa8","child_tasks_local_reference_list":[],"attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","type":"SCALING","variable_list":[],"name":"Scale Out"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","description":"","uuid":"a2f54fce-caad-4016-b7d7-e43a465c4cc7","child_tasks_local_reference_list":[],"attrs":{"script":"#!\/bin\/bash\nset -ex\n\nMINION_IPS=\"@@{Azure_Centos_K8SM.private_ip_address}@@\"\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  if ! (( $(grep -c \"${ip} minion${count}\" \/etc\/hosts) )) ; then\n  \techo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  fi\n  count=$((count+1))\ndone","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Set Hosts File"}],"uuid":"c0554587-e50f-41cd-890e-029b263c0d7e","description":"","variable_list":[{"val_type":"STRING","description":"","uuid":"fa705096-83f3-4e42-a932-227a29b5b26a","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"f3682593_dag","uuid":"5d00cf2e-e157-4e9a-bf74-aea62902c521"},"name":"744583cd_runbook_cloned_1"},"type":"user","description":""},{"uuid":"27c12472-6003-4c77-a0c3-72cf6f9608db","name":"ScaleIn","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"9a2036e4-2e70-491d-91ab-ba8c7bcc9952","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale In","uuid":"24967091-daf0-4555-b64e-3c2184412604"}],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"853cb860_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"77b729d5_deployment_cloned_1","uuid":"ee2b0f2f-ee60-48c4-b32c-da68ba12098c"},"retries":"0","description":"","uuid":"24967091-daf0-4555-b64e-3c2184412604","child_tasks_local_reference_list":[],"attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","type":"SCALING","variable_list":[],"name":"Scale In"}],"uuid":"27e66213-d97d-4cfb-a73b-68f7014eea82","description":"","variable_list":[{"val_type":"STRING","description":"","uuid":"b07e13fc-317e-4e4c-9776-304edfd14c13","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"853cb860_dag","uuid":"9a2036e4-2e70-491d-91ab-ba8c7bcc9952"},"name":"9331a25f_runbook_cloned_1"},"type":"user","description":""}],"description":"","variable_list":[{"val_type":"STRING","description":"","uuid":"44b39037-4cff-4f0d-adc9-f445f9f9ce88","value":"kube-calm","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_CLUSTER_NAME"},{"val_type":"STRING","description":"","uuid":"86616546-a630-4024-b8f8-e84dd4edd1d3","value":"v1.8.0","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_VERSION"},{"val_type":"STRING","description":"","uuid":"43d009f3-3c1a-4cb9-ba7a-33532a4c9f26","value":"17.03.2.ce","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"DOCKER_VERSION"},{"val_type":"STRING","description":"","uuid":"8853e625-8542-48f5-8e0d-fc1254577bb4","value":"10.200.0.0\/16","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_CLUSTER_SUBNET"},{"val_type":"STRING","description":"","uuid":"3a1a9a60-d192-48c3-a5e1-6ac7d94462c3","value":"10.32.0.0\/24","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_SERVICE_SUBNET"},{"val_type":"STRING","description":"","uuid":"8e5aad2c-cf33-455e-8991-5b27416b43ea","value":"10.32.0.10","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_DNS_IP"}],"name":"Azure"}],"default_credential_local_reference":{"kind":"app_credential","name":"CENTOS","uuid":"5314d554-0539-406b-95eb-faa834a6ef81"},"package_definition_list":[{"description":"","action_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"}],"uuid":"56b66f14-39cc-4320-8394-17636712b055","version":"","type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"},"retries":"0","name":"dac441af_dag","type":"DAG","uuid":"24728f88-9810-4a3a-bf32-152349daf2ae","child_tasks_local_reference_list":[{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"b96d647b-7e55-4644-83d0-0e4d13bcfd64"},{"kind":"app_task","name":"Generate Certs","uuid":"9480345e-e748-4f3e-8044-4d72c6b82d7f"},{"kind":"app_task","name":"Configure Services","uuid":"7d270afd-0766-4d67-8693-db21adfd0084"},{"kind":"app_task","name":"Add User Roles","uuid":"8caec318-837b-4d11-a314-60c346b6932e"},{"kind":"app_task","name":"Network Configuration","uuid":"f57f0155-8057-4b75-8a74-03b15db1f9c9"},{"kind":"app_task","name":"DNS Configuration","uuid":"d455e23b-8dab-41b8-b54b-a754460064d8"},{"kind":"app_task","name":"NVP Configuration","uuid":"1e3aa1a2-a871-4dca-bcfd-eb3f1915d790"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"b96d647b-7e55-4644-83d0-0e4d13bcfd64"},"edge_type":"user_defined","type":"","uuid":"a1442b85-e6aa-4c6f-93aa-2c7b2a7103d9","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"9480345e-e748-4f3e-8044-4d72c6b82d7f"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"9480345e-e748-4f3e-8044-4d72c6b82d7f"},"edge_type":"user_defined","type":"","uuid":"e21b5be5-1f0a-464e-bff6-37a541f1dac7","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"7d270afd-0766-4d67-8693-db21adfd0084"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"7d270afd-0766-4d67-8693-db21adfd0084"},"edge_type":"user_defined","type":"","uuid":"af014c47-e9d0-406f-ae3f-a32cde0179c5","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"8caec318-837b-4d11-a314-60c346b6932e"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"8caec318-837b-4d11-a314-60c346b6932e"},"edge_type":"user_defined","type":"","uuid":"c480aad0-021c-4d79-a570-d83da0165fa1","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"f57f0155-8057-4b75-8a74-03b15db1f9c9"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"f57f0155-8057-4b75-8a74-03b15db1f9c9"},"edge_type":"user_defined","type":"","uuid":"903d6c0b-2579-4ebf-9e00-d108fb6b8baa","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"d455e23b-8dab-41b8-b54b-a754460064d8"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"d455e23b-8dab-41b8-b54b-a754460064d8"},"edge_type":"user_defined","type":"","uuid":"196a0efd-8baf-4171-8fd4-f279c00d5ae7","to_task_reference":{"kind":"app_task","name":"NVP Configuration","uuid":"1e3aa1a2-a871-4dca-bcfd-eb3f1915d790"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","name":"ETCD Docker Kubelet Install","type":"EXEC","uuid":"b96d647b-7e55-4644-83d0-0e4d13bcfd64","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nMINION_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} controller${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"controller${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')    \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate etcd \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/sd{e,f,g}\nsudo vgcreate docker \/dev\/sd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","name":"Generate Certs","type":"EXEC","uuid":"9480345e-e748-4f3e-8044-4d72c6b82d7f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nMINION_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\n\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_NAMES},${CONTROLLER_IPS},${MINION_NAMES},${MINION_IPS},${FIRST_IP_SERVICE_SUBNET},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local -profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\ninstance=\"controller${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=controller${count}.kubeconfig\nkubectl config set-credentials system:node:controller${count} --client-certificate=controller${count}.pem --client-key=controller${count}-key.pem --embed-certs=true --kubeconfig=controller${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:controller${count} --kubeconfig=controller${count}.kubeconfig\nkubectl config use-context default --kubeconfig=controller${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"controller${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","name":"Configure Services","type":"EXEC","uuid":"7d270afd-0766-4d67-8693-db21adfd0084","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nCONTROLLER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,AlwaysPullImages,DenyEscalatingExec,SecurityContextDeny,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n    \necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","name":"Add User Roles","type":"EXEC","uuid":"8caec318-837b-4d11-a314-60c346b6932e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet iscsid\nsudo systemctl enable etcd docker kubelet iscsid\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem controller* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","name":"Network Configuration","type":"EXEC","uuid":"f57f0155-8057-4b75-8a74-03b15db1f9c9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - \/etc\/kube-flannel\/cni-conf.json\n        - \/etc\/cni\/net.d\/10-flannel.conf\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","name":"DNS Configuration","type":"EXEC","uuid":"d455e23b-8dab-41b8-b54b-a754460064d8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n    - name: dns\n      port: 53\n      protocol: UDP\n    - name: dns-tcp\n      port: 53\n      protocol: TCP\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: gcr.io\/google_containers\/k8s-dns-kube-dns-amd64:1.14.10\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: gcr.io\/google_containers\/k8s-dns-dnsmasq-nanny-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: gcr.io\/google_containers\/k8s-dns-sidecar-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local.,5,A\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local.,5,A\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy:\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n# Remove the configmaps rule once below issue is fixed:\n# kubernetes-incubator\/cluster-proportional-autoscaler#16\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.1.2-r2\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          # Should keep target in sync with cluster\/addons\/dns\/kube-dns.yaml.base\n          - --target=Deployment\/kube-dns\n          # When cluster is using large nodes(with more cores), \"coresPerReplica\" should dominate.\n          # If using small nodes, \"nodesPerReplica\" should dominate.\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","name":"NVP Configuration","type":"EXEC","uuid":"1e3aa1a2-a871-4dca-bcfd-eb3f1915d790","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nPRISM_CLUSTER_IP=\"@@{PE_CLUSTER_IP}@@\"\nPRISM_DATA_SERVICE_IP=\"@@{PE_CLUSTER_IP}@@\"\n\nif [[ (\"${PRISM_CLUSTER_IP}x\" == \"x\") && (\"${PRISM_DATA_SERVICE_IP}x\" == \"x\") ]]; then exit 0; fi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/volume_plugin\nNTNX_SECRET=$(echo -n \"@@{PE_USERNAME}@@:@@{PE_PASSWORD}@@\" | base64)\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: nutanixabs-provisioner-runner\n  namespace: kube-system\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumes\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumeclaims\"]\n    verbs: [\"get\", \"list\", \"watch\", \"update\"]\n  - apiGroups: [\"storage.k8s.io\"]\n    resources: [\"storageclasses\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"list\", \"watch\", \"create\", \"update\", \"patch\"]\n  - apiGroups: [\"\"]\n    resources: [\"services\"]\n    verbs: [\"get\"]\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"create\", \"delete\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: run-nutanixabs-provisioner\n  namespace: kube-system\nsubjects:\n  - kind: ServiceAccount\n    name: nutanixabs-provisioner\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: nutanixabs-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      labels:\n        app: nutanixabs-provisioner\n    spec:\n      serviceAccount: nutanixabs-provisioner\n      hostNetwork: true\n      containers:\n        -\n          image: \"ntnx\/nutanixabs-provisioner\"\n          name: nutanixabs-provisioner\n          args: [\"--v=4\"]\n          imagePullPolicy: IfNotPresent\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: kube-system\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\n---\nkind: StorageClass\napiVersion: storage.k8s.io\/v1\nmetadata:\n  name: silver \n  namespace: kube-system\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\nprovisioner: nutanix\/abs\nparameters:\n     prismEndPoint: @@{PE_CLUSTER_IP}@@:9440\n     dataServiceEndPoint: @@{PE_DATA_SERVICE_IP}@@:3260\n     secretName: ntnx-secret\n     storageContainer: @@{PE_CONTAINER_NAME}@@\n     fsType: ext4\n     chapAuthEnabled: \"false\"' | sudo tee \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\necho \"apiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: default\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\" | sudo tee -a \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""}],"description":"","uuid":"ce8ba4ab-4797-40b3-8056-9ec1e7ae7ecd","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"dac441af_dag","uuid":"24728f88-9810-4a3a-bf32-152349daf2ae"},"name":"8e760b73_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"56b66f14-39cc-4320-8394-17636712b055"},"retries":"0","name":"6324786a_dag","type":"DAG","uuid":"a15b3681-909e-4a44-b1dc-d59d7ab55280","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""}],"description":"","uuid":"3247fc69-ecee-4f14-98e0-99d03534ee35","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"6324786a_dag","uuid":"a15b3681-909e-4a44-b1dc-d59d7ab55280"},"name":"6522ac7a_runbook"}},"variable_list":[],"name":"AHV_Centos_K8SC_Package"},{"description":"","action_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"}],"uuid":"c41ebbe6-49ab-4a43-8618-22679865e405","version":"","type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"},"retries":"0","name":"c1566b3d_dag","type":"DAG","uuid":"bb4a9582-ab92-4b99-a84b-4183ad16eada","child_tasks_local_reference_list":[{"kind":"app_task","name":"Docker Kubelet Install","uuid":"c6a82db2-703c-4580-bd70-34a3c9ce330e"},{"kind":"app_task","name":"GetCerts","uuid":"ec9825be-f146-48ed-b142-3d950fe2c6cc"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"c6a82db2-703c-4580-bd70-34a3c9ce330e"},"edge_type":"user_defined","type":"","uuid":"f40eb1a7-0dff-42db-8bc5-06007da96c0c","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"ec9825be-f146-48ed-b142-3d950fe2c6cc"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","name":"Docker Kubelet Install","type":"EXEC","uuid":"c6a82db2-703c-4580-bd70-34a3c9ce330e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{AHV_Centos_K8SC.address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/usr\/share\/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","name":"GetCerts","type":"EXEC","uuid":"ec9825be-f146-48ed-b142-3d950fe2c6cc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{AHV_Centos_K8SC.address[0]}@@\"\nINSTANCE_IP=\"@@{address}@@\"\ninstance=\"minion@@{calm_array_index}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"minion@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${instance} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${instance} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""}],"description":"","uuid":"9b9829ce-5225-4cae-818e-9959bd8ff3b9","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"c1566b3d_dag","uuid":"bb4a9582-ab92-4b99-a84b-4183ad16eada"},"name":"9a6e189b_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"c41ebbe6-49ab-4a43-8618-22679865e405"},"retries":"0","name":"abd3357c_dag","type":"DAG","uuid":"927d5dc8-44bf-4db6-82a6-7c23dc0e1f96","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"5132c55f-aace-49bc-9a91-d118782fb091"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","name":"Remove Node","type":"EXEC","uuid":"5132c55f-aace-49bc-9a91-d118782fb091","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain 'minion@@{calm_array_index}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node 'minion@@{calm_array_index}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""}],"description":"","uuid":"2ad05b39-94d1-42a2-89ae-8584e15f7d20","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"abd3357c_dag","uuid":"927d5dc8-44bf-4db6-82a6-7c23dc0e1f96"},"name":"3cb17acf_runbook"}},"variable_list":[],"name":"AHV_Centos_K8SM_Package"},{"description":"","action_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"}],"uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f","version":"","type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"},"retries":"0","name":"84e097cf_dag","type":"DAG","uuid":"3e95d365-a94c-4a54-a32a-413b3dda3bc3","child_tasks_local_reference_list":[{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"ae887c8b-07cb-406f-9e98-e754397c60f9"},{"kind":"app_task","name":"Generate Certs","uuid":"62d7cfe4-5397-4406-aac1-a04663440978"},{"kind":"app_task","name":"Configure Services","uuid":"27ab8dc0-83f9-46d6-a5fa-aeadc0a3099c"},{"kind":"app_task","name":"Add User Roles","uuid":"f68681b7-1608-4521-afb5-e9a8a7f993d5"},{"kind":"app_task","name":"Network Configuration","uuid":"2fb0bd2a-71a3-47b5-9ea3-da3b8e1657cc"},{"kind":"app_task","name":"DNS Configuration","uuid":"5aaccd3e-a910-46c4-9085-1c25c540620e"},{"kind":"app_task","name":"EBS VolumePlugin","uuid":"8ced34e7-d77e-4662-96e2-dbea387d8f6b"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"ae887c8b-07cb-406f-9e98-e754397c60f9"},"edge_type":"user_defined","type":"","uuid":"19d18e5f-cac4-46d2-ac4e-5c32c79b414f","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"62d7cfe4-5397-4406-aac1-a04663440978"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"62d7cfe4-5397-4406-aac1-a04663440978"},"edge_type":"user_defined","type":"","uuid":"451bec00-f5a5-48f0-bc68-30f4edddc953","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"27ab8dc0-83f9-46d6-a5fa-aeadc0a3099c"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"27ab8dc0-83f9-46d6-a5fa-aeadc0a3099c"},"edge_type":"user_defined","type":"","uuid":"9840707b-0116-4f30-97cd-9c853ead8ba1","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"f68681b7-1608-4521-afb5-e9a8a7f993d5"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"f68681b7-1608-4521-afb5-e9a8a7f993d5"},"edge_type":"user_defined","type":"","uuid":"317bc858-5860-4bb3-9329-606d8321c9ed","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"2fb0bd2a-71a3-47b5-9ea3-da3b8e1657cc"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"2fb0bd2a-71a3-47b5-9ea3-da3b8e1657cc"},"edge_type":"user_defined","type":"","uuid":"c87a511c-c14b-41b3-a83e-490258a14794","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"5aaccd3e-a910-46c4-9085-1c25c540620e"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"5aaccd3e-a910-46c4-9085-1c25c540620e"},"edge_type":"user_defined","type":"","uuid":"27d573a3-86b6-4b70-8b8b-72232cfe0fe8","to_task_reference":{"kind":"app_task","name":"EBS VolumePlugin","uuid":"8ced34e7-d77e-4662-96e2-dbea387d8f6b"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","name":"ETCD Docker Kubelet Install","type":"EXEC","uuid":"ae887c8b-07cb-406f-9e98-e754397c60f9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nMINION_IPS=\"@@{AWS_Centos_K8SM.private_ip_address}@@\" # private Ip's\nCONTROLLER_DNS=\"@@{calm_array_private_dns_name}@@\" # private Dns\nMINION_DNS=\"@@{AWS_Centos_K8SM.private_dns_name}@@\" # private Dns\nPUBLIC_CONTROLLER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_MINION_IPS=\"@@{AWS_Centos_K8SM.public_ip_address}@@\"\nPUBLIC_CONTROLLER_DNS=\"@@{calm_array_public_dns_name}@@\"\nPUBLIC_MINION_DNS=\"@@{AWS_Centos_K8SM.public_dns_name}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y --quiet\nsudo yum install -y wget iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} controller${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"controller${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')    \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=aws \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/xvd{b,c,d}\nsudo vgcreate etcd \/dev\/xvd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/xvd{e,f,g}\nsudo vgcreate docker \/dev\/xvd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","name":"Generate Certs","type":"EXEC","uuid":"62d7cfe4-5397-4406-aac1-a04663440978","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nMINION_IPS=\"@@{AWS_Centos_K8SM.private_ip_address}@@\" # private Ip's\nCONTROLLER_DNS=\"@@{calm_array_private_dns_name}@@\" # private Dns\nMINION_DNS=\"@@{AWS_Centos_K8SM.private_dns_name}@@\" # private Dns\nPUBLIC_CONTROLLER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_MINION_IPS=\"@@{AWS_Centos_K8SM.public_ip_address}@@\"\nPUBLIC_CONTROLLER_DNS=\"@@{calm_array_public_dns_name}@@\"\nPUBLIC_MINION_DNS=\"@@{AWS_Centos_K8SM.public_dns_name}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${CONTROLLER_DNS},${PUBLIC_CONTROLLER_IPS},${PUBLIC_CONTROLLER_DNS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${CONTROLLER_DNS},${PUBLIC_CONTROLLER_IPS},${PUBLIC_CONTROLLER_DNS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${CONTROLLER_DNS},${PUBLIC_CONTROLLER_IPS},${PUBLIC_CONTROLLER_DNS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json \\\n-hostname=${CONTROLLER_NAMES},${CONTROLLER_IPS},${MINION_NAMES},${MINION_IPS},${FIRST_IP_SERVICE_SUBNET},${CONTROLLER_DNS},${MINION_DNS},${PUBLIC_CONTROLLER_IPS},${PUBLIC_MINION_IPS},${PUBLIC_CONTROLLER_DNS},${PUBLIC_MINION_DNS},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local \\\n-profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor name in $(echo ${CONTROLLER_DNS} | tr \",\" \"\\n\"); do\ninstance=\"controller${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${name}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${name},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor name in $(echo ${CONTROLLER_DNS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=controller${count}.kubeconfig\nkubectl config set-credentials system:node:${name} --client-certificate=controller${count}.pem --client-key=controller${count}-key.pem --embed-certs=true --kubeconfig=controller${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${name} --kubeconfig=controller${count}.kubeconfig\nkubectl config use-context default --kubeconfig=controller${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"controller${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","name":"Configure Services","type":"EXEC","uuid":"27ab8dc0-83f9-46d6-a5fa-aeadc0a3099c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nCONTROLLER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,AlwaysPullImages,DenyEscalatingExec,SecurityContextDeny,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --cloud-provider=aws\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --cloud-provider=aws\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n    \necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","name":"Add User Roles","type":"EXEC","uuid":"f68681b7-1608-4521-afb5-e9a8a7f993d5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet\nsudo systemctl enable etcd docker kubelet\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem controller* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\n\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF\n\ncat <<EOF | kubectl apply -f -\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: kube-aws:node-proxier\nsubjects:\n  - kind: User\n    name: kube-worker\n  - kind: ServiceAccount\n    name: kube-proxy\n    namespace: kube-system\n  - kind: Group\n    name: system:nodes\nroleRef:\n  kind: ClusterRole\n  name: system:node-proxier\n  apiGroup: rbac.authorization.k8s.io\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","name":"Network Configuration","type":"EXEC","uuid":"2fb0bd2a-71a3-47b5-9ea3-da3b8e1657cc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - \/etc\/kube-flannel\/cni-conf.json\n        - \/etc\/cni\/net.d\/10-flannel.conf\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","name":"DNS Configuration","type":"EXEC","uuid":"5aaccd3e-a910-46c4-9085-1c25c540620e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n    - name: dns\n      port: 53\n      protocol: UDP\n    - name: dns-tcp\n      port: 53\n      protocol: TCP\n---\napiVersion: apps\/v1beta2\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: gcr.io\/google_containers\/k8s-dns-kube-dns-amd64:1.14.10\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: gcr.io\/google_containers\/k8s-dns-dnsmasq-nanny-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: gcr.io\/google_containers\/k8s-dns-sidecar-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local.,5,A\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local.,5,A\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy:\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n\necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n# Remove the configmaps rule once below issue is fixed:\n# kubernetes-incubator\/cluster-proportional-autoscaler#16\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.1.2-r2\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          # Should keep target in sync with cluster\/addons\/dns\/kube-dns.yaml.base\n          - --target=Deployment\/kube-dns\n          # When cluster is using large nodes(with more cores), \"coresPerReplica\" should dominate.\n          # If using small nodes, \"nodesPerReplica\" should dominate.\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","name":"EBS VolumePlugin","type":"EXEC","uuid":"8ced34e7-d77e-4662-96e2-dbea387d8f6b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nsudo mkdir \"\/etc\/kubernetes\/addons\/volume\"\n\necho 'apiVersion: storage.k8s.io\/v1\nkind: StorageClass\nmetadata:\n  name: gp2\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: EnsureExists\nprovisioner: kubernetes.io\/aws-ebs\nparameters:\n  type: gp2' | sudo tee \/etc\/kubernetes\/addons\/volume\/default.yaml\n \nkubectl create -f \/etc\/kubernetes\/addons\/volume\/default.yaml "},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""}],"description":"","uuid":"d4fe484c-2c80-4d34-8b40-d04671ae922f","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"84e097cf_dag","uuid":"3e95d365-a94c-4a54-a32a-413b3dda3bc3"},"name":"e836616a_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SC_Package","uuid":"f5299fdf-a772-41d5-9925-c87ddaec8f1f"},"retries":"0","name":"4226cd9d_dag","type":"DAG","uuid":"7c5fd8e1-85a1-474f-bd6d-164c75674fd9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""}],"description":"","uuid":"9b4b2a26-89e0-411a-8a4a-e0f6c467a260","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"4226cd9d_dag","uuid":"7c5fd8e1-85a1-474f-bd6d-164c75674fd9"},"name":"18f2756f_runbook"}},"variable_list":[],"name":"AWS_Centos_K8SC_Package"},{"description":"","action_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"}],"uuid":"50dfc849-7772-4832-9398-4cd2048be3e7","version":"","type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"},"retries":"0","name":"a4ecbecd_dag","type":"DAG","uuid":"e6840876-1b4b-4c0d-a518-2e4bf606a471","child_tasks_local_reference_list":[{"kind":"app_task","name":"Docker Kubelet Install","uuid":"dde6d5e1-f54d-4fcc-b213-182e395ba3e8"},{"kind":"app_task","name":"GetCerts","uuid":"30c2402c-7460-4eae-a119-643e34f435a4"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"dde6d5e1-f54d-4fcc-b213-182e395ba3e8"},"edge_type":"user_defined","type":"","uuid":"a558b11d-a6f1-40d7-92ed-84faed5f4838","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"30c2402c-7460-4eae-a119-643e34f435a4"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","name":"Docker Kubelet Install","type":"EXEC","uuid":"dde6d5e1-f54d-4fcc-b213-182e395ba3e8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{AWS_Centos_K8SC.private_ip_address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y --quiet\nsudo yum install -y wget socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\n\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=aws \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/usr\/share\/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/xvd{b,c,d}\nsudo vgcreate docker \/dev\/xvd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","name":"GetCerts","type":"EXEC","uuid":"30c2402c-7460-4eae-a119-643e34f435a4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{AWS_Centos_K8SC.private_ip_address[0]}@@\"\nINSTANCE_NAME=\"@@{private_dns_name}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nINSTANCE_IP=\"@@{private_ip_address}@@\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"minion@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${INSTANCE_NAME}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_NAME},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${INSTANCE_NAME} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${INSTANCE_NAME} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""}],"description":"","uuid":"6cab3c7d-2fa0-4fcb-82ee-4235185a4eef","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"a4ecbecd_dag","uuid":"e6840876-1b4b-4c0d-a518-2e4bf606a471"},"name":"dca27b9e_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AWS_Centos_K8SM_Package","uuid":"50dfc849-7772-4832-9398-4cd2048be3e7"},"retries":"0","name":"9e5b50bc_dag","type":"DAG","uuid":"f7f78e88-c191-4734-983e-1c60616a57e8","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"46373590-3ec0-4217-8d9c-b5c658658ac7"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","name":"Remove Node","type":"EXEC","uuid":"46373590-3ec0-4217-8d9c-b5c658658ac7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain '@@{private_dns_name}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node '@@{private_dns_name}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""}],"description":"","uuid":"32c49af5-cd7c-401d-9bf4-4446c7582641","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"9e5b50bc_dag","uuid":"f7f78e88-c191-4734-983e-1c60616a57e8"},"name":"137c8a73_runbook"}},"variable_list":[],"name":"AWS_Centos_K8SM_Package"},{"description":"","action_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"}],"uuid":"dd402e71-0337-4f3e-9693-06781cf08182","version":"","type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"},"retries":"0","name":"e07e43b0_dag","type":"DAG","uuid":"559eed77-3aff-4acb-802d-f1ed459e873f","child_tasks_local_reference_list":[{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"da04bba9-146d-4e18-887a-da37740f264e"},{"kind":"app_task","name":"Generate Certs","uuid":"568fdbc4-b2b6-448c-b6ee-0f2b9cc0830b"},{"kind":"app_task","name":"Configure Services","uuid":"2254df0e-6a95-4e2c-9d28-5f2cdf5bddb4"},{"kind":"app_task","name":"Add User Roles","uuid":"74151a22-4838-4f85-ab0e-6e5b0ae55088"},{"kind":"app_task","name":"Network Configuration","uuid":"683e1064-65b1-429f-b3b9-50b47af2f850"},{"kind":"app_task","name":"DNS Configuration","uuid":"50ba6666-c348-4cd0-8ef8-a5952614f6ee"},{"kind":"app_task","name":"GCE VolumePlugin","uuid":"e16e35ed-1a7b-48f0-ba1f-708571cb5f79"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"da04bba9-146d-4e18-887a-da37740f264e"},"edge_type":"user_defined","type":"","uuid":"1706f67b-16c9-4a24-88c9-0c2c298462b6","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"568fdbc4-b2b6-448c-b6ee-0f2b9cc0830b"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"568fdbc4-b2b6-448c-b6ee-0f2b9cc0830b"},"edge_type":"user_defined","type":"","uuid":"9fb57511-54fc-46a5-891b-5e44f9806be4","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"2254df0e-6a95-4e2c-9d28-5f2cdf5bddb4"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"2254df0e-6a95-4e2c-9d28-5f2cdf5bddb4"},"edge_type":"user_defined","type":"","uuid":"a735c78b-6cc2-4522-88f9-ef4e0e484fda","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"74151a22-4838-4f85-ab0e-6e5b0ae55088"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"74151a22-4838-4f85-ab0e-6e5b0ae55088"},"edge_type":"user_defined","type":"","uuid":"2e425ea2-2648-41b2-9d71-2c15732129ae","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"683e1064-65b1-429f-b3b9-50b47af2f850"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"683e1064-65b1-429f-b3b9-50b47af2f850"},"edge_type":"user_defined","type":"","uuid":"72ef2452-716e-40d1-8e87-f2ee0b02eddf","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"50ba6666-c348-4cd0-8ef8-a5952614f6ee"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"50ba6666-c348-4cd0-8ef8-a5952614f6ee"},"edge_type":"user_defined","type":"","uuid":"43e357fd-01ad-4210-8422-aceab81cb29e","to_task_reference":{"kind":"app_task","name":"GCE VolumePlugin","uuid":"e16e35ed-1a7b-48f0-ba1f-708571cb5f79"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","name":"ETCD Docker Kubelet Install","type":"EXEC","uuid":"da04bba9-146d-4e18-887a-da37740f264e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nMINION_IPS=\"@@{GCP_Centos_K8SM.private_ip_address}@@\" # private Ip's\nPUBLIC_CONTROLLER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_MINION_IPS=\"@@{GCP_Centos_K8SM.public_ip_address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} controller${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"controller${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')    \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=gce \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate etcd \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/sd{e,f,g}\nsudo vgcreate docker \/dev\/sd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","name":"Generate Certs","type":"EXEC","uuid":"568fdbc4-b2b6-448c-b6ee-0f2b9cc0830b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nMINION_IPS=\"@@{GCP_Centos_K8SM.private_ip_address}@@\" # private Ip's\nPUBLIC_CONTROLLER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_MINION_IPS=\"@@{GCP_Centos_K8SM.public_ip_address}@@\"\nCONTROLLER_HOSTNAMES=\"@@{calm_array_name}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${PUBLIC_CONTROLLER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${PUBLIC_CONTROLLER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${PUBLIC_CONTROLLER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json \\\n-hostname=${CONTROLLER_NAMES},${CONTROLLER_IPS},${MINION_NAMES},${MINION_IPS},${FIRST_IP_SERVICE_SUBNET},${PUBLIC_CONTROLLER_IPS},${PUBLIC_MINION_IPS},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local \\\n-profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor name in $(echo ${CONTROLLER_HOSTNAMES} | tr \",\" \"\\n\"); do\ninstance=\"controller${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${name}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${name},${INTERNAL_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor name in $(echo ${CONTROLLER_HOSTNAMES} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=controller${count}.kubeconfig\nkubectl config set-credentials system:node:${name} --client-certificate=controller${count}.pem --client-key=controller${count}-key.pem --embed-certs=true --kubeconfig=controller${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${name} --kubeconfig=controller${count}.kubeconfig\nkubectl config use-context default --kubeconfig=controller${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"controller${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","name":"Configure Services","type":"EXEC","uuid":"2254df0e-6a95-4e2c-9d28-5f2cdf5bddb4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nCONTROLLER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${NODE_NAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,AlwaysPullImages,DenyEscalatingExec,SecurityContextDeny,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --cloud-provider=gce\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --cloud-provider=gce\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n\necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","name":"Add User Roles","type":"EXEC","uuid":"74151a22-4838-4f85-ab0e-6e5b0ae55088","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet\nsudo systemctl enable etcd docker kubelet\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem controller* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\n\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF\n\ncat <<EOF | kubectl apply -f -\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: kube-aws:node-proxier\nsubjects:\n  - kind: User\n    name: kube-worker\n  - kind: ServiceAccount\n    name: kube-proxy\n    namespace: kube-system\n  - kind: Group\n    name: system:nodes\nroleRef:\n  kind: ClusterRole\n  name: system:node-proxier\n  apiGroup: rbac.authorization.k8s.io\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","name":"Network Configuration","type":"EXEC","uuid":"683e1064-65b1-429f-b3b9-50b47af2f850","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - \/etc\/kube-flannel\/cni-conf.json\n        - \/etc\/cni\/net.d\/10-flannel.conf\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","name":"DNS Configuration","type":"EXEC","uuid":"50ba6666-c348-4cd0-8ef8-a5952614f6ee","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n    - name: dns\n      port: 53\n      protocol: UDP\n    - name: dns-tcp\n      port: 53\n      protocol: TCP\n---\napiVersion: apps\/v1beta2\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: gcr.io\/google_containers\/k8s-dns-kube-dns-amd64:1.14.10\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: gcr.io\/google_containers\/k8s-dns-dnsmasq-nanny-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: gcr.io\/google_containers\/k8s-dns-sidecar-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local.,5,A\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local.,5,A\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy:\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n\necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n# Remove the configmaps rule once below issue is fixed:\n# kubernetes-incubator\/cluster-proportional-autoscaler#16\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.1.2-r2\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          # Should keep target in sync with cluster\/addons\/dns\/kube-dns.yaml.base\n          - --target=Deployment\/kube-dns\n          # When cluster is using large nodes(with more cores), \"coresPerReplica\" should dominate.\n          # If using small nodes, \"nodesPerReplica\" should dominate.\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","name":"GCE VolumePlugin","type":"EXEC","uuid":"e16e35ed-1a7b-48f0-ba1f-708571cb5f79","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nsudo mkdir \"\/etc\/kubernetes\/addons\/volume\"\n\necho 'apiVersion: storage.k8s.io\/v1\nkind: StorageClass\nmetadata:\n  name: standard\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: EnsureExists\nprovisioner: kubernetes.io\/gce-pd\nparameters:\n  type: pd-standard' | sudo tee \/etc\/kubernetes\/addons\/volume\/default.yaml\n \nkubectl create -f \/etc\/kubernetes\/addons\/volume\/default.yaml "},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""}],"description":"","uuid":"e25e73be-d602-4882-9b83-a4fbbebf963f","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"e07e43b0_dag","uuid":"559eed77-3aff-4acb-802d-f1ed459e873f"},"name":"26c82c77_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SC_Package","uuid":"dd402e71-0337-4f3e-9693-06781cf08182"},"retries":"0","name":"6bbde6e8_dag","type":"DAG","uuid":"ad8e500e-fd6a-4d77-9d83-0103207f1663","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""}],"description":"","uuid":"09ccd797-748f-4106-922e-b40a194592fe","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"6bbde6e8_dag","uuid":"ad8e500e-fd6a-4d77-9d83-0103207f1663"},"name":"6eaeef4c_runbook"}},"variable_list":[],"name":"GCP_Centos_K8SC_Package"},{"description":"","action_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"}],"uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa","version":"","type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"},"retries":"0","name":"709f9264_dag","type":"DAG","uuid":"8f5ad9c9-8e6d-4b1e-8268-1917a1ae85a3","child_tasks_local_reference_list":[{"kind":"app_task","name":"Docker Kubelet Install","uuid":"e5f2c484-b93e-4ac8-a174-87a95eb7a763"},{"kind":"app_task","name":"GetCerts","uuid":"e9f3aa03-aca4-44dd-b361-8f8182f6f985"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"e5f2c484-b93e-4ac8-a174-87a95eb7a763"},"edge_type":"user_defined","type":"","uuid":"620ef3f5-4f05-4eda-b27e-b05ceab8f969","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"e9f3aa03-aca4-44dd-b361-8f8182f6f985"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","name":"Docker Kubelet Install","type":"EXEC","uuid":"e5f2c484-b93e-4ac8-a174-87a95eb7a763","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{GCP_Centos_K8SC.private_ip_address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\n\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --cloud-provider=gce \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/usr\/share\/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","name":"GetCerts","type":"EXEC","uuid":"e9f3aa03-aca4-44dd-b361-8f8182f6f985","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{GCP_Centos_K8SC.private_ip_address[0]}@@\"\nINSTANCE_IP=\"@@{private_ip_address}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"minion@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${HOSTNAME}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${HOSTNAME},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${HOSTNAME} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${HOSTNAME} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""}],"description":"","uuid":"db6899f7-707f-458d-bc65-c104ed29f99f","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"709f9264_dag","uuid":"8f5ad9c9-8e6d-4b1e-8268-1917a1ae85a3"},"name":"927472a7_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"GCP_Centos_K8SM_Package","uuid":"22066004-dfcf-4ce2-ba9e-2f1be8f04eaa"},"retries":"0","name":"fef85962_dag","type":"DAG","uuid":"9bd60227-c678-4c9d-b4d4-0b6ac9e4e9ba","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"406548b2-4327-4062-a2a6-2c8700cfad8e"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","name":"Remove Node","type":"EXEC","uuid":"406548b2-4327-4062-a2a6-2c8700cfad8e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nNODE_NAME=${HOSTNAME}\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain '${NODE_NAME}' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node '${NODE_NAME}'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""}],"description":"","uuid":"1539e5db-916b-4a29-b617-aa92e68201bd","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"fef85962_dag","uuid":"9bd60227-c678-4c9d-b4d4-0b6ac9e4e9ba"},"name":"435393f9_runbook"}},"variable_list":[],"name":"GCP_Centos_K8SM_Package"},{"description":"","action_list":[],"service_local_reference_list":[],"uuid":"6cbb9b5f-3255-4d45-8d8f-0891f27ac147","version":"","type":"SUBSTRATE_IMAGE","options":{"type":"","name":"CENTOS_74","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-GenericCloud.qcow2","version":{"product_version":"","type":"","product_name":""},"architecture":"X86_64","type":""},"description":""},"variable_list":[],"name":"CENTOS_74"},{"description":"","action_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"}],"uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671","version":"","type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"},"retries":"0","name":"e07e43b0_dag","type":"DAG","uuid":"9bf883f6-282f-4cf6-9b19-aed35f8bb527","child_tasks_local_reference_list":[{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"108da788-0194-4cec-87f2-0250d202852e"},{"kind":"app_task","name":"Generate Certs","uuid":"e355815d-10ee-465a-83ac-bc774265a4e9"},{"kind":"app_task","name":"Configure Services","uuid":"aa624606-b7bf-4f09-ab41-c1b3963e631c"},{"kind":"app_task","name":"Add User Roles","uuid":"502da776-3896-4819-8b10-451ffb94a826"},{"kind":"app_task","name":"Network Configuration","uuid":"d60f09d7-e474-4378-85ef-d5424970b641"},{"kind":"app_task","name":"DNS Configuration","uuid":"1783456e-ce2d-42e2-b78e-2eb763ef16ad"},{"kind":"app_task","name":"GCE VolumePlugin","uuid":"b47115ba-e12d-4e9d-b1cc-c9405eceb342"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"108da788-0194-4cec-87f2-0250d202852e"},"edge_type":"user_defined","type":"","uuid":"61dfa542-e635-49cc-8093-d941b2abab8b","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"e355815d-10ee-465a-83ac-bc774265a4e9"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"e355815d-10ee-465a-83ac-bc774265a4e9"},"edge_type":"user_defined","type":"","uuid":"48851258-6707-4509-a77f-8f2bc2570fb5","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"aa624606-b7bf-4f09-ab41-c1b3963e631c"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"aa624606-b7bf-4f09-ab41-c1b3963e631c"},"edge_type":"user_defined","type":"","uuid":"382ea989-cb89-47de-aef9-79345407022b","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"502da776-3896-4819-8b10-451ffb94a826"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"502da776-3896-4819-8b10-451ffb94a826"},"edge_type":"user_defined","type":"","uuid":"9a33a5cc-6360-47c3-b2ad-11403d0f7fa6","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"d60f09d7-e474-4378-85ef-d5424970b641"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"d60f09d7-e474-4378-85ef-d5424970b641"},"edge_type":"user_defined","type":"","uuid":"8a95b44f-bc71-4079-9264-9c50ad915977","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"1783456e-ce2d-42e2-b78e-2eb763ef16ad"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"1783456e-ce2d-42e2-b78e-2eb763ef16ad"},"edge_type":"user_defined","type":"","uuid":"48a7ec54-a0ce-4c20-8374-e1e17faefeea","to_task_reference":{"kind":"app_task","name":"GCE VolumePlugin","uuid":"b47115ba-e12d-4e9d-b1cc-c9405eceb342"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","name":"ETCD Docker Kubelet Install","type":"EXEC","uuid":"108da788-0194-4cec-87f2-0250d202852e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo yum install -y python-setuptools --quiet\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nMINION_IPS=\"@@{Azure_Centos_K8SM.private_ip_address}@@\" # private Ip's\nPUBLIC_CONTROLLER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_MINION_IPS=\"@@{Azure_Centos_K8SM.public_ip_address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} controller${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"controller${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')    \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","name":"Generate Certs","type":"EXEC","uuid":"e355815d-10ee-465a-83ac-bc774265a4e9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\" # private Ip's\nMINION_IPS=\"@@{Azure_Centos_K8SM.private_ip_address}@@\" # private Ip's\nPUBLIC_CONTROLLER_IPS=\"@@{calm_array_public_ip_address}@@\"\nPUBLIC_MINION_IPS=\"@@{Azure_Centos_K8SM.public_ip_address}@@\"\nCONTROLLER_HOSTNAMES=\"@@{calm_array_name}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${PUBLIC_CONTROLLER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${PUBLIC_CONTROLLER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS},${PUBLIC_CONTROLLER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json \\\n-hostname=${CONTROLLER_NAMES},${CONTROLLER_IPS},${MINION_NAMES},${MINION_IPS},${FIRST_IP_SERVICE_SUBNET},${PUBLIC_CONTROLLER_IPS},${PUBLIC_MINION_IPS},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local \\\n-profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor name in $(echo ${CONTROLLER_NAMES} | tr \",\" \"\\n\"); do\ninstance=\"controller${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${name}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INTERNAL_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor name in $(echo ${CONTROLLER_NAMES} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=controller${count}.kubeconfig\nkubectl config set-credentials system:node:${name} --client-certificate=controller${count}.pem --client-key=controller${count}-key.pem --embed-certs=true --kubeconfig=controller${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${name} --kubeconfig=controller${count}.kubeconfig\nkubectl config use-context default --kubeconfig=controller${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"controller${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","name":"Configure Services","type":"EXEC","uuid":"aa624606-b7bf-4f09-ab41-c1b3963e631c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_private_ip_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nCONTROLLER_COUNT=$(echo \"@@{calm_array_private_ip_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${NODE_NAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,AlwaysPullImages,DenyEscalatingExec,SecurityContextDeny,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n\necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","name":"Add User Roles","type":"EXEC","uuid":"502da776-3896-4819-8b10-451ffb94a826","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet\nsudo systemctl enable etcd docker kubelet\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem controller* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\n\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF\n\ncat <<EOF | kubectl apply -f -\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: kube-aws:node-proxier\nsubjects:\n  - kind: User\n    name: kube-worker\n  - kind: ServiceAccount\n    name: kube-proxy\n    namespace: kube-system\n  - kind: Group\n    name: system:nodes\nroleRef:\n  kind: ClusterRole\n  name: system:node-proxier\n  apiGroup: rbac.authorization.k8s.io\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","name":"Network Configuration","type":"EXEC","uuid":"d60f09d7-e474-4378-85ef-d5424970b641","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - \/etc\/kube-flannel\/cni-conf.json\n        - \/etc\/cni\/net.d\/10-flannel.conf\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","name":"DNS Configuration","type":"EXEC","uuid":"1783456e-ce2d-42e2-b78e-2eb763ef16ad","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n    - name: dns\n      port: 53\n      protocol: UDP\n    - name: dns-tcp\n      port: 53\n      protocol: TCP\n---\napiVersion: apps\/v1beta2\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: gcr.io\/google_containers\/k8s-dns-kube-dns-amd64:1.14.10\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: gcr.io\/google_containers\/k8s-dns-dnsmasq-nanny-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: gcr.io\/google_containers\/k8s-dns-sidecar-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local.,5,A\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local.,5,A\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy:\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n\necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n# Remove the configmaps rule once below issue is fixed:\n# kubernetes-incubator\/cluster-proportional-autoscaler#16\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.1.2-r2\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          # Should keep target in sync with cluster\/addons\/dns\/kube-dns.yaml.base\n          - --target=Deployment\/kube-dns\n          # When cluster is using large nodes(with more cores), \"coresPerReplica\" should dominate.\n          # If using small nodes, \"nodesPerReplica\" should dominate.\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"54a464e1-414d-4d9c-acf5-92a61d43e4f7"},"retries":"0","name":"GCE VolumePlugin","type":"EXEC","uuid":"b47115ba-e12d-4e9d-b1cc-c9405eceb342","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\n\nsudo mkdir \"\/etc\/kubernetes\/addons\/volume\"\n\necho 'apiVersion: storage.k8s.io\/v1\nkind: StorageClass\nmetadata:\n  name: standard\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: EnsureExists\nprovisioner: kubernetes.io\/gce-pd\nparameters:\n  type: pd-standard' | sudo tee \/etc\/kubernetes\/addons\/volume\/default.yaml\n \nkubectl create -f \/etc\/kubernetes\/addons\/volume\/default.yaml "},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""}],"description":"","uuid":"b52935f0-a02f-403f-8fa5-13d97384fbb3","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"e07e43b0_dag","uuid":"9bf883f6-282f-4cf6-9b19-aed35f8bb527"},"name":"26c82c77_runbook_cloned_1"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SC_Package","uuid":"e33bbdd9-3f5c-46cd-bc77-15e06fe0e671"},"retries":"0","name":"6bbde6e8_dag","type":"DAG","uuid":"8533354a-5a57-4d62-bc44-836a35710de3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""}],"description":"","uuid":"e3f431b6-5fd2-40e5-976a-9746c1f88c59","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"6bbde6e8_dag","uuid":"8533354a-5a57-4d62-bc44-836a35710de3"},"name":"6eaeef4c_runbook_cloned_1"}},"variable_list":[],"name":"Azure_Centos_K8SC_Package"},{"description":"","action_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"}],"uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a","version":"","type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"},"retries":"0","name":"709f9264_dag","type":"DAG","uuid":"e83bda7e-ed8a-4ecf-9207-f85f0d784a8c","child_tasks_local_reference_list":[{"kind":"app_task","name":"Docker Kubelet Install","uuid":"48e1e88d-5ff4-4b68-94fd-0615f4a3dec3"},{"kind":"app_task","name":"GetCerts","uuid":"4ca0cbb9-c32f-4fd7-818e-e7d34b91c576"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"48e1e88d-5ff4-4b68-94fd-0615f4a3dec3"},"edge_type":"user_defined","type":"","uuid":"4de3d3d1-bf6c-4cf6-804c-f54954d037c5","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"4ca0cbb9-c32f-4fd7-818e-e7d34b91c576"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","name":"Docker Kubelet Install","type":"EXEC","uuid":"48e1e88d-5ff4-4b68-94fd-0615f4a3dec3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{private_ip_address}@@\"\nCONTROLLER_IPS=\"@@{Azure_Centos_K8SC.private_ip_address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\n\nsudo yum update -y --quiet\nsudo yum install -y wget socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\n\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/usr\/share\/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","name":"GetCerts","type":"EXEC","uuid":"4ca0cbb9-c32f-4fd7-818e-e7d34b91c576","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{Azure_Centos_K8SC.private_ip_address[0]}@@\"\nINSTANCE_IP=\"@@{private_ip_address}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"minion@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${HOSTNAME}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${HOSTNAME},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${HOSTNAME} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${HOSTNAME} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""}],"description":"","uuid":"2b5e609f-9b5e-492a-9416-2f336c962f2e","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"709f9264_dag","uuid":"e83bda7e-ed8a-4ecf-9207-f85f0d784a8c"},"name":"927472a7_runbook_cloned_1"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"Azure_Centos_K8SM_Package","uuid":"e86d00bd-64a7-4363-884d-48ab6e49052a"},"retries":"0","name":"fef85962_dag","type":"DAG","uuid":"dbf0f4d7-4ff8-4600-a05b-cc87d39d3199","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"e965f669-dba2-46fd-a707-6d92cb40aec3"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"78c73ade-3c79-4294-81ba-e9b738f6ee68"},"retries":"0","name":"Remove Node","type":"EXEC","uuid":"e965f669-dba2-46fd-a707-6d92cb40aec3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain 'minion@@{calm_array_index}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node 'minion@@{calm_array_index}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"description":""}],"description":"","uuid":"6f16c9a9-e56a-453f-a2af-55e7433f9d66","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"fef85962_dag","uuid":"dbf0f4d7-4ff8-4600-a05b-cc87d39d3199"},"name":"435393f9_runbook_cloned_1"}},"variable_list":[],"name":"Azure_Centos_K8SM_Package"}],"client_attrs":{"ac3359e0-f3f0-4bcf-8ff9-9483b0ae2778":{"y":151.1603651085,"x":418},"ee2b0f2f-ee60-48c4-b32c-da68ba12098c":{"y":413.0940071326,"x":768.9612911807},"fc3bf5ce-7070-4a40-bc68-179c74c82418":{"y":413.0940071326,"x":768.9612911807},"3df01c9c-b48a-44c9-8500-a5d135ae0841":{"y":413.0940071326,"x":768.9612911807},"5d33c234-98e6-44ef-97c8-83771613cb91":{"y":151.1603651085,"x":418},"e54dd002-50e1-4051-bc5a-c2bb008669ee":{"y":151.1603651085,"x":418},"f5bcb26d-6a13-4eb5-91c5-202d025130f0":{"y":151.1603651085,"x":418},"a49dec52-b184-47d2-b1db-43be87961d75":{"y":413.0940071326,"x":768.9612911807}}},"description":"* [Kubernetes API](https:\/\/@@{Kubernetes_Master.address[0]}@@:6443)"},"api_version":"3.0","metadata":{"last_update_time":"1548744911325379","owner_reference":{"kind":"user","uuid":"00000000-0000-0000-0000-000000000000","name":"admin"},"kind":"blueprint","uuid":"98a1b42d-5551-40e3-9847-bc392887a65d","project_reference":{"kind":"project","name":"default","uuid":"209e0a42-6f2d-4999-9a9b-5aa705d25661"},"spec_version":0,"creation_time":"1548744911325379","name":"k8"}}