{"status":{"description":"* [Kubernetes API](https:\/\/@@{Kubernetes_Master.address[0]}@@:6443)","source_mpi":"","state":"ACTIVE","is_cloned":false,"message_list":[],"resources":{"service_definition_list":[{"port_list":[],"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"8a9b5e05-8367-44e0-8f3d-4a3302858e84","name":"action_create","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"DAG","uuid":"0a1f89bb-e4b9-4b3b-b3d2-9bd00ca65b6c","child_tasks_local_reference_list":[{"kind":"app_task","name":"Dashboard","uuid":"80177559-713f-477e-aaf9-dcb3af1c04eb"},{"kind":"app_task","name":"HELM","uuid":"0a1e1ea1-e796-42c9-9a31-8e988a40bb09"},{"kind":"app_task","name":"Heapster","uuid":"061fa633-494f-4134-aa20-9c59399ab12e"}],"state":"NOT_VALIDATED","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Dashboard","uuid":"80177559-713f-477e-aaf9-dcb3af1c04eb"},"edge_type":"user_defined","type":"","uuid":"0ce4edc2-0e12-45a1-b28b-f5a56601b8d7","to_task_reference":{"kind":"app_task","name":"HELM","uuid":"0a1e1ea1-e796-42c9-9a31-8e988a40bb09"}},{"from_task_reference":{"kind":"app_task","name":"HELM","uuid":"0a1e1ea1-e796-42c9-9a31-8e988a40bb09"},"edge_type":"user_defined","type":"","uuid":"935e34c1-a8c8-4b30-8746-cfecab3b72ea","to_task_reference":{"kind":"app_task","name":"Heapster","uuid":"061fa633-494f-4134-aa20-9c59399ab12e"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"f33eac3f_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"EXEC","uuid":"80177559-713f-477e-aaf9-dcb3af1c04eb","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/dashboard\necho '# Copyright 2015 Google Inc. All Rights Reserved.\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#     http:\/\/www.apache.org\/licenses\/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\n# Configuration to deploy release version of the Dashboard UI compatible with\n# Kubernetes 1.7.\n#\n# Example usage: kubectl create -f <this_file>\n\n# ------------------- Dashboard Secret ------------------- #\n\napiVersion: v1\nkind: Secret\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard-certs\n  namespace: kube-system\ntype: Opaque\n\n---\n# ------------------- Dashboard Service Account ------------------- #\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\n\n---\n# ------------------- Dashboard Role & Role Binding ------------------- #\n\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: kubernetes-full-access\n  namespace: kube-system\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: kubernetes-dashboard\n  namespace: kube-system\n\n---\n# ------------------- Dashboard Deployment ------------------- #\n\nkind: Deployment\napiVersion: apps\/v1beta2\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\nspec:\n  replicas: 1\n  revisionHistoryLimit: 10\n  selector:\n    matchLabels:\n      k8s-app: kubernetes-dashboard\n  template:\n    metadata:\n      labels:\n        k8s-app: kubernetes-dashboard\n    spec:\n      containers:\n      - name: kubernetes-dashboard\n        image: k8s.gcr.io\/kubernetes-dashboard-amd64:v1.8.3\n        ports:\n        - containerPort: 8443\n          protocol: TCP\n        args:\n          - --auto-generate-certificates\n          # Uncomment the following line to manually specify Kubernetes API server Host\n          # If not specified, Dashboard will attempt to auto discover the API server and connect\n          # to it. Uncomment only if the default does not work.\n          # - --apiserver-host=http:\/\/my-address:port\n        volumeMounts:\n        - name: kubernetes-dashboard-certs\n          mountPath: \/certs\n          # Create on-disk volume to store exec logs\n        - mountPath: \/tmp\n          name: tmp-volume\n        livenessProbe:\n          httpGet:\n            scheme: HTTPS\n            path: \/\n            port: 8443\n          initialDelaySeconds: 30\n          timeoutSeconds: 30\n      volumes:\n      - name: kubernetes-dashboard-certs\n        secret:\n          secretName: kubernetes-dashboard-certs\n      - name: tmp-volume\n        emptyDir: {}\n      serviceAccountName: kubernetes-dashboard\n      # Comment the following tolerations if Dashboard must not be deployed on master\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        effect: NoSchedule\n\n---\n# ------------------- Dashboard Service ------------------- #\n\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\nspec:\n  type: NodePort\n  ports:\n    - port: 8443\n      nodePort: 30443\n  selector:\n    k8s-app: kubernetes-dashboard' | sudo tee \/etc\/kubernetes\/addons\/dashboard\/kubernetes-dashboard.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/dashboard\/kubernetes-dashboard.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Dashboard"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"EXEC","uuid":"0a1e1ea1-e796-42c9-9a31-8e988a40bb09","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir \/etc\/kubernetes\/addons\/helm\necho \"#helm init --service-account helm\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: helm\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: helm\n  namespace: kube-system\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: helm\n  namespace: kube-system\" | sudo tee \/etc\/kubernetes\/addons\/helm\/helm.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/helm\/helm.yaml\nhelm init --service-account helm\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"HELM"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"EXEC","uuid":"061fa633-494f-4134-aa20-9c59399ab12e","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir \/etc\/kubernetes\/addons\/heapster\nkubectl delete ClusterRole system:heapster -n kube-system\n\necho 'apiVersion: rbac.authorization.k8s.io\/v1\nkind: ClusterRole\nmetadata:\n  name: system:heapster\n  namespace: kube-system\nrules:\n- apiGroups:\n  - \"\"\n  resources:\n  - events\n  - namespaces\n  - nodes\n  - pods\n  verbs:\n  - get\n  - list\n  - watch\n- apiGroups:\n  - \"\"\n  resources:\n  - nodes\/stats\n  verbs:\n  - get\n- apiGroups:\n  - extensions\n  resources:\n  - deployments\n  verbs:\n  - get\n  - list\n  - watch\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: heapster\n  namespace: kube-system\n  labels:\n    k8s-app: heapster\n    module: apiserver\n    version: v6\nspec:\n  selector:\n    matchLabels:\n      k8s-app: heapster\n      module: apiserver\n      version: v6\n  template:\n    metadata:\n      name: heapster\n      labels:\n        k8s-app: heapster\n        module: apiserver\n        version: v6\n    spec:\n      serviceAccountName: heapster\n      containers:\n      - name: heapster\n        image: k8s.gcr.io\/heapster-amd64:v1.5.3\n        command:\n        - \/heapster\n        - --source=kubernetes.summary_api:\"\"?useServiceAccount=true&kubeletHttps=true&kubeletPort=10250&insecure=true\n        ports:\n        - containerPort: 6443\n          name: https\n        - containerPort: 8080\n          name: http\n        volumeMounts:\n        - name: ssl-certs\n          mountPath: \/etc\/ssl\/certs\n          readOnly: true\n      volumes:\n      - name: ssl-certs\n        hostPath:\n          path: \/etc\/ssl\/certs\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: heapster\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n---\nkind: Service\napiVersion: v1\nmetadata:\n  name: heapster\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    kubernetes.io\/name: \"Heapster\"\n    k8s-app: heapster\nspec:\n  ports:\n    - port: 80\n      targetPort: 8082\n  selector:\n    k8s-app: heapster\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: heapster\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: heapster\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/heapster\/heapster.yaml\n  \nkubectl create -f \/etc\/kubernetes\/addons\/heapster\/heapster.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Heapster"}],"description":"","message_list":[],"uuid":"36b81be1-9b70-44f2-ac4f-e5e42e86d24d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"f33eac3f_dag","uuid":"0a1f89bb-e4b9-4b3b-b3d2-9bd00ca65b6c"},"name":"a9639da1_runbook"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"7f927285-aae0-434c-af5e-545af719c7fb","name":"action_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"DAG","uuid":"562fa0af-4de4-4dbb-9747-b85dbc7cc052","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"62a92d34_dag"}],"description":"","message_list":[],"uuid":"85f228cd-f200-4441-9bc8-4e7603c42c02","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"62a92d34_dag","uuid":"562fa0af-4de4-4dbb-9747-b85dbc7cc052"},"name":"8c4aa276_runbook"}},{"description":"System action for starting an application","message_list":[],"uuid":"56f4ab29-8474-4a4e-a582-31796b54c15c","name":"action_start","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"DAG","uuid":"edca597f-ac1c-4757-8577-f468212b3c52","child_tasks_local_reference_list":[{"kind":"app_task","name":"Start","uuid":"700fce46-e79f-4755-8c65-998de1d91400"}],"state":"NOT_VALIDATED","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"334b4484_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"EXEC","uuid":"700fce46-e79f-4755-8c65-998de1d91400","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\nsudo systemctl start etcd docker kubelet\nsudo systemctl enable etcd docker kubelet\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Start"}],"description":"","message_list":[],"uuid":"794616f8-d231-4aae-af7d-7fd616f436d6","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"334b4484_dag","uuid":"edca597f-ac1c-4757-8577-f468212b3c52"},"name":"daee30ae_runbook"}},{"description":"System action for stopping an application","message_list":[],"uuid":"ac2503ef-57c8-4356-9e66-b20adabd5b45","name":"action_stop","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"DAG","uuid":"5af4c38b-1c89-4650-b8d2-f1647967761a","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"9713c3d0_dag"}],"description":"","message_list":[],"uuid":"771f76f2-789f-491b-addb-d55d2828070c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"9713c3d0_dag","uuid":"5af4c38b-1c89-4650-b8d2-f1647967761a"},"name":"6407a345_runbook"}},{"description":"System action for restarting an application","message_list":[],"uuid":"35583c38-f460-4271-b925-c993528cf482","name":"action_restart","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"DAG","uuid":"ffd4f6e1-15c7-4696-83f8-ed9b3c692d63","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"414912df_dag"}],"description":"","message_list":[],"uuid":"f0ee4c38-2566-4ac8-a103-898e3321c63e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"414912df_dag","uuid":"ffd4f6e1-15c7-4696-83f8-ed9b3c692d63"},"name":"d5c8316f_runbook"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"56a62c10-3117-4cdb-bb55-6c1abd069f71","name":"action_soft_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"DAG","uuid":"8e2a48fb-013d-423f-b4a0-0ca1d51719ea","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Service_Element_Delete_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"e444b2c7-3b6d-4aba-aafe-748a828eb076"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"e444b2c7-3b6d-4aba-aafe-748a828eb076","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Service_Element_Delete_1ff7322f_9ca1_454d_9740_9159ef5c5cae"}],"description":"","message_list":[],"uuid":"60ca2419-d6c4-46d4-8874-868b0dfba380","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"8e2a48fb-013d-423f-b4a0-0ca1d51719ea"},"name":"SYS_GEN__Runbook_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae"}}],"message_list":[],"uuid":"a6884701-5550-48f4-9496-c3d2271862cf","state":"ACTIVE","depends_on_list":[],"editables":{},"tier":"","singleton":false,"variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"5adc0c69-7b62-4117-bea8-ab7d5105eb6c","value":"@@{KUBE_VERSION}@@","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{},"is_hidden":false,"type":"LOCAL","options":{},"name":"VERSION"}],"name":"Kubernetes_Master"},{"port_list":[],"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"007c97ef-4660-40dd-861b-c0aa2afbfb82","name":"action_create","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"DAG","uuid":"e96f34a2-dc2d-45ef-9796-9f0696de88e1","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"4af7c45f_dag"}],"description":"","message_list":[],"uuid":"60e21428-ac74-4abe-b320-037ba471fa8a","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"4af7c45f_dag","uuid":"e96f34a2-dc2d-45ef-9796-9f0696de88e1"},"name":"7c6e4932_runbook"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"d520126d-f52e-4d69-a060-9c79608eab97","name":"action_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"DAG","uuid":"0e446c7b-adfe-4f7a-8fc5-65e77c56e70c","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"1e2c50bb_dag"}],"description":"","message_list":[],"uuid":"f85195a9-d884-4e50-8289-d75bab4a4905","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"1e2c50bb_dag","uuid":"0e446c7b-adfe-4f7a-8fc5-65e77c56e70c"},"name":"1d794193_runbook"}},{"description":"System action for starting an application","message_list":[],"uuid":"5da7a8b6-9616-4680-b825-ba26951071f6","name":"action_start","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"DAG","uuid":"c5eb4a5f-82b0-4e37-ac16-45788670258e","child_tasks_local_reference_list":[{"kind":"app_task","name":"Start","uuid":"f7d50bef-9035-4bc2-ad18-37aeace1630a"}],"state":"NOT_VALIDATED","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"970128c7_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"EXEC","uuid":"f7d50bef-9035-4bc2-ad18-37aeace1630a","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo systemctl start docker kubelet\nsudo systemctl enable docker kubelet"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Start"}],"description":"","message_list":[],"uuid":"cd012624-ef9b-48e9-9ab2-62a0fb5731e3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"970128c7_dag","uuid":"c5eb4a5f-82b0-4e37-ac16-45788670258e"},"name":"884352cf_runbook"}},{"description":"System action for stopping an application","message_list":[],"uuid":"2c2b11d6-3cf0-4f22-9b7b-1720caf66f80","name":"action_stop","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"DAG","uuid":"f2f3f905-13ed-4133-b5c3-04ec5f6ec827","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6c01dc28_dag"}],"description":"","message_list":[],"uuid":"12f2e944-b309-4629-a81b-5dc93622becc","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6c01dc28_dag","uuid":"f2f3f905-13ed-4133-b5c3-04ec5f6ec827"},"name":"0cb172a7_runbook"}},{"description":"System action for restarting an application","message_list":[],"uuid":"b9a8f5ab-6a31-4bad-8f56-89f3f45006b9","name":"action_restart","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"DAG","uuid":"e787f548-aa17-410d-8b97-188f6fb2a8c0","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"1d66b5be_dag"}],"description":"","message_list":[],"uuid":"7ec57533-22f0-4437-a50a-5c62a08fe445","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"1d66b5be_dag","uuid":"e787f548-aa17-410d-8b97-188f6fb2a8c0"},"name":"3a6f587d_runbook"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"9c34e84e-c5ca-470c-b65f-a9baf914dd02","name":"action_soft_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"DAG","uuid":"02dff25d-38d2-489f-8a73-0150b6d6beba","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Service_Element_Delete_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"df6e489e-3db7-4c66-8a2b-4ce4aa1e15e2"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"df6e489e-3db7-4c66-8a2b-4ce4aa1e15e2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Service_Element_Delete_f13b4e44_6ce8_4869_b1c2_117ef592db73"}],"description":"","message_list":[],"uuid":"ab6d68fd-7950-4e2e-b8ee-720996847d75","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"02dff25d-38d2-489f-8a73-0150b6d6beba"},"name":"SYS_GEN__Runbook_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73"}}],"message_list":[],"uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354","state":"ACTIVE","depends_on_list":[],"editables":{},"tier":"","singleton":false,"variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"3ee501df-a692-4ea9-9709-ebe7f0bbfb9e","value":"@@{KUBE_VERSION}@@","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{},"is_hidden":false,"type":"LOCAL","options":{},"name":"VERSION"}],"name":"Kubernetes_Minion"}],"substrate_definition_list":[{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"177955fe-46d8-4790-b5ca-e4bffff9483e","name":"action_create","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"DAG","uuid":"4e35e8bc-02d9-4d6e-9e0a-2e1b5216ab88","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Provision_b892fcce_be27_4102_80c7_94b12311354b","uuid":"4c31dc6d-ed1b-45dd-8505-d8f785ffa6bb"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SC_b892fcce_be27_4102_80c7_94b12311354b","uuid":"6eb46ee0-7034-4898-879b-816e3280b8c7"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Provision_b892fcce_be27_4102_80c7_94b12311354b","uuid":"4c31dc6d-ed1b-45dd-8505-d8f785ffa6bb"},"edge_type":"inherent","type":"","uuid":"ead6c2b0-b7bf-4a09-89e8-03005d376198","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SC_b892fcce_be27_4102_80c7_94b12311354b","uuid":"6eb46ee0-7034-4898-879b-816e3280b8c7"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_b892fcce_be27_4102_80c7_94b12311354b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"PROVISION_NUTANIX","uuid":"4c31dc6d-ed1b-45dd-8505-d8f785ffa6bb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"name":"K8SC-@@{calm_array_index}@@-@@{calm_time}@@","categories":"","availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"4ad0b85f-6a89-459b-a62f-73eb0e88bb1a"},"type":""}],"parent_reference":null,"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"serial_port_list":[],"gpu_list":[],"memory_size_mib":2048,"power_state":"ON","hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"type":"","boot_config":{"boot_device":{"type":"","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CENTOS_74","uuid":"7861473c-3123-4a72-bf45-329a774d3fd6"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":1,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":2,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":3,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":4,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":5,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":6,"type":""}}}]}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Provision_b892fcce_be27_4102_80c7_94b12311354b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"6eb46ee0-7034-4898-879b-816e3280b8c7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_Centos_K8SC_b892fcce_be27_4102_80c7_94b12311354b"}],"description":"","message_list":[],"uuid":"9807d9d2-7955-4610-845a-b4654049b8de","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"4e35e8bc-02d9-4d6e-9e0a-2e1b5216ab88"},"name":"SYS_GEN__Runbook_Substrate_b892fcce_be27_4102_80c7_94b12311354b"}},{"description":"System action for powering on an application","message_list":[],"uuid":"3d830a3c-a5a9-4c76-a480-49551de357f6","name":"action_poweron","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"DAG","uuid":"9cc3ee8d-ad25-46c7-b3cc-4df7e9984661","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOn_b892fcce_be27_4102_80c7_94b12311354b","uuid":"16b118f4-8672-4e4c-b7ba-076c1d87c474"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SC_b892fcce_be27_4102_80c7_94b12311354b","uuid":"a770ba00-5b3f-4087-a10b-447685098560"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOn_b892fcce_be27_4102_80c7_94b12311354b","uuid":"16b118f4-8672-4e4c-b7ba-076c1d87c474"},"edge_type":"inherent","type":"","uuid":"873928b6-1e69-4bb9-a6db-838f2b680956","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SC_b892fcce_be27_4102_80c7_94b12311354b","uuid":"a770ba00-5b3f-4087-a10b-447685098560"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_b892fcce_be27_4102_80c7_94b12311354b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"16b118f4-8672-4e4c-b7ba-076c1d87c474","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_PowerOn_b892fcce_be27_4102_80c7_94b12311354b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"a770ba00-5b3f-4087-a10b-447685098560","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_Centos_K8SC_b892fcce_be27_4102_80c7_94b12311354b"}],"description":"","message_list":[],"uuid":"a4eb0eb4-7ce9-47d4-bfde-2cf4ae64076d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"9cc3ee8d-ad25-46c7-b3cc-4df7e9984661"},"name":"SYS_GEN__Runbook_Substrate_b892fcce_be27_4102_80c7_94b12311354b"}},{"description":"System action for restarting an application","message_list":[],"uuid":"09ff6e4b-8b1f-410f-b9e9-f02f9f978c51","name":"action_restart","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"DAG","uuid":"03d063db-a9f3-422c-9ec9-fce13a763fc6","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_Restart_b892fcce_be27_4102_80c7_94b12311354b","uuid":"82faa048-b2a7-4e99-8983-4a6ca38e6469"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SC_b892fcce_be27_4102_80c7_94b12311354b","uuid":"47921b5b-c479-4e26-ac67-1a135cd3b2d3"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_Restart_b892fcce_be27_4102_80c7_94b12311354b","uuid":"82faa048-b2a7-4e99-8983-4a6ca38e6469"},"edge_type":"inherent","type":"","uuid":"ab2f1b23-7f57-491d-a4a3-4d882c6a1a93","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SC_b892fcce_be27_4102_80c7_94b12311354b","uuid":"47921b5b-c479-4e26-ac67-1a135cd3b2d3"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_b892fcce_be27_4102_80c7_94b12311354b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"82faa048-b2a7-4e99-8983-4a6ca38e6469","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_Restart_b892fcce_be27_4102_80c7_94b12311354b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"47921b5b-c479-4e26-ac67-1a135cd3b2d3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_Centos_K8SC_b892fcce_be27_4102_80c7_94b12311354b"}],"description":"","message_list":[],"uuid":"9cda6eff-7a1b-43dd-96cd-d8f374753805","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"03d063db-a9f3-422c-9ec9-fce13a763fc6"},"name":"SYS_GEN__Runbook_Substrate_b892fcce_be27_4102_80c7_94b12311354b"}},{"description":"System action for suspending an application","message_list":[],"uuid":"deb73d7b-7668-4150-a5e3-d85d722dd127","name":"action_suspend","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"DAG","uuid":"f23e6c30-88c8-4b07-b2a9-13ff3c5526f5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_b892fcce_be27_4102_80c7_94b12311354b"}],"description":"","message_list":[],"uuid":"cd1f7ebf-b72b-4193-9381-15407f40bffb","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"f23e6c30-88c8-4b07-b2a9-13ff3c5526f5"},"name":"SYS_GEN__Runbook_Substrate_b892fcce_be27_4102_80c7_94b12311354b"}},{"description":"System action for modifying an application","message_list":[],"uuid":"7b872d1c-e6b9-4398-a30f-cb07aa801b1d","name":"action_modify","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"DAG","uuid":"dfee1c38-55ad-40f8-8eb0-e0a06b8b39a7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_b892fcce_be27_4102_80c7_94b12311354b"}],"description":"","message_list":[],"uuid":"6beaff9d-6fb3-4f79-b3db-c96a9ab3b4b6","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"dfee1c38-55ad-40f8-8eb0-e0a06b8b39a7"},"name":"SYS_GEN__Runbook_Substrate_b892fcce_be27_4102_80c7_94b12311354b"}},{"description":"System action for powering off an application","message_list":[],"uuid":"dd09a62a-98ff-4964-9236-3f7a53b762d7","name":"action_poweroff","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"DAG","uuid":"cfaf8235-7934-45be-a1b0-1a5e0a219937","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOff_b892fcce_be27_4102_80c7_94b12311354b","uuid":"d29a3b7b-7d2f-47a0-b202-a15ed197ef6a"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_b892fcce_be27_4102_80c7_94b12311354b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"d29a3b7b-7d2f-47a0-b202-a15ed197ef6a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_PowerOff_b892fcce_be27_4102_80c7_94b12311354b"}],"description":"","message_list":[],"uuid":"679d1986-0926-431c-8651-2d912b5bda24","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"cfaf8235-7934-45be-a1b0-1a5e0a219937"},"name":"SYS_GEN__Runbook_Substrate_b892fcce_be27_4102_80c7_94b12311354b"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"0227303c-ca62-4ec6-a4e0-acf5f81871ff","name":"action_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"DAG","uuid":"acc5183b-b0c3-49b0-8fa8-c680fb6865e7","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Delete_b892fcce_be27_4102_80c7_94b12311354b","uuid":"c7c101bf-f5d6-4b92-8298-89ee9a7d8a98"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_b892fcce_be27_4102_80c7_94b12311354b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"DELETE_NUTANIX","uuid":"c7c101bf-f5d6-4b92-8298-89ee9a7d8a98","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Delete_b892fcce_be27_4102_80c7_94b12311354b"}],"description":"","message_list":[],"uuid":"059459d3-370f-4dbd-a8af-ff32643303eb","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"acc5183b-b0c3-49b0-8fa8-c680fb6865e7"},"name":"SYS_GEN__Runbook_Substrate_b892fcce_be27_4102_80c7_94b12311354b"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"5511e9c8-85da-4d66-b1d1-3250f4b50f20","name":"action_soft_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"DAG","uuid":"38a7e548-f134-427e-876a-cb1950de4090","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Substrate_Element_Delete_b892fcce_be27_4102_80c7_94b12311354b","uuid":"77ccb5b4-eb23-454a-8639-ea595ad66d89"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_b892fcce_be27_4102_80c7_94b12311354b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"77ccb5b4-eb23-454a-8639-ea595ad66d89","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Substrate_Element_Delete_b892fcce_be27_4102_80c7_94b12311354b"}],"description":"","message_list":[],"uuid":"c267afa8-57ca-4fba-b874-7c4827d1fe56","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"38a7e548-f134-427e-876a-cb1950de4090"},"name":"SYS_GEN__Runbook_Substrate_b892fcce_be27_4102_80c7_94b12311354b"}}],"message_list":[],"uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0","state":"ACTIVE","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"0","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS","uuid":"abeffc51-2124-413f-a3db-ded3c10ad1f2"}},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"name":true,"resources":{"nic_list":{"0":{"subnet_reference":true}},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"guest_customization":true,"disk_list":{"1":{"disk_size_mib":true},"3":{"disk_size_mib":true},"2":{"disk_size_mib":true},"5":{"disk_size_mib":true},"4":{"disk_size_mib":true},"6":{"disk_size_mib":true}}}}},"os_type":"Linux","type":"AHV_VM","create_spec":{"name":"K8SC-@@{calm_array_index}@@-@@{calm_time}@@","categories":"","availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"4ad0b85f-6a89-459b-a62f-73eb0e88bb1a"},"type":""}],"parent_reference":null,"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"serial_port_list":[],"gpu_list":[],"memory_size_mib":2048,"power_state":"ON","hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"type":"","boot_config":{"boot_device":{"type":"","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CENTOS_74","uuid":"7861473c-3123-4a72-bf45-329a774d3fd6"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":1,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":2,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":3,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":4,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":5,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":6,"type":""}}}]}},"variable_list":[],"name":"AHV_Centos_K8SC"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"442901b7-f501-4cae-8780-2e0621d8424a","name":"action_create","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"DAG","uuid":"42271249-5afd-44f6-b622-f9ef223e91ee","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Provision_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"a60cf299-214b-4b7c-8c08-9dad0a6840cb"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"a34b3174-c1e9-41d2-8beb-9e048e29cc41"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Provision_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"a60cf299-214b-4b7c-8c08-9dad0a6840cb"},"edge_type":"inherent","type":"","uuid":"c6c9bd69-b055-4aa0-8844-4e81e1b863fb","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"a34b3174-c1e9-41d2-8beb-9e048e29cc41"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"PROVISION_NUTANIX","uuid":"a60cf299-214b-4b7c-8c08-9dad0a6840cb","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"name":"K8SM-@@{calm_array_index}@@-@@{calm_time}@@","categories":"","availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"4ad0b85f-6a89-459b-a62f-73eb0e88bb1a"},"type":""}],"parent_reference":null,"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"serial_port_list":[],"gpu_list":[],"memory_size_mib":2048,"power_state":"ON","hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"type":"","boot_config":{"boot_device":{"type":"","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CENTOS_74","uuid":"7861473c-3123-4a72-bf45-329a774d3fd6"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":1,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":2,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":3,"type":""}}}]}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Provision_95ef6117_e2c6_4f06_b430_6884339df05f"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"a34b3174-c1e9-41d2-8beb-9e048e29cc41","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_95ef6117_e2c6_4f06_b430_6884339df05f"}],"description":"","message_list":[],"uuid":"7fdf183f-79e9-4d38-aa1e-1ced9421e13e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"42271249-5afd-44f6-b622-f9ef223e91ee"},"name":"SYS_GEN__Runbook_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f"}},{"description":"System action for powering on an application","message_list":[],"uuid":"f5fd84f3-fb84-4cfa-8d21-2e03b80ce5af","name":"action_poweron","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"DAG","uuid":"0b26034d-2abd-4da0-9660-d42bab1cacb2","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOn_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"5db0ac71-8721-481a-8560-d157f9b03b29"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"b4047dd9-f267-41ca-b562-821fc5f3c8be"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOn_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"5db0ac71-8721-481a-8560-d157f9b03b29"},"edge_type":"inherent","type":"","uuid":"0b6586df-8016-483b-a8d9-81895dfd4b50","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"b4047dd9-f267-41ca-b562-821fc5f3c8be"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"5db0ac71-8721-481a-8560-d157f9b03b29","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_PowerOn_95ef6117_e2c6_4f06_b430_6884339df05f"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"b4047dd9-f267-41ca-b562-821fc5f3c8be","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_95ef6117_e2c6_4f06_b430_6884339df05f"}],"description":"","message_list":[],"uuid":"9c6fca4c-3f2d-4f85-bfe3-2a2a047ced8f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"0b26034d-2abd-4da0-9660-d42bab1cacb2"},"name":"SYS_GEN__Runbook_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f"}},{"description":"System action for restarting an application","message_list":[],"uuid":"3507c357-7632-45e2-a506-41886383b7ff","name":"action_restart","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"DAG","uuid":"0e3f723b-cb21-41cd-bf3f-935718626f8c","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_Restart_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"b47c5eeb-182d-4ccc-a822-55b61ff5245f"},{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"191abb91-0758-439e-b6c0-228b52f7631b"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_Restart_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"b47c5eeb-182d-4ccc-a822-55b61ff5245f"},"edge_type":"inherent","type":"","uuid":"cbdadf2b-f942-41ae-897b-f97d077b2771","to_task_reference":{"kind":"app_task","name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"191abb91-0758-439e-b6c0-228b52f7631b"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"b47c5eeb-182d-4ccc-a822-55b61ff5245f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_Restart_95ef6117_e2c6_4f06_b430_6884339df05f"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"CHECK_LOGIN","uuid":"191abb91-0758-439e-b6c0-228b52f7631b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"retries":"5","dial_timeout":"","timeout":"60","address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","type":"CHECK_LOGIN","sleep_time":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__check_login_for_AHV_Centos_K8SM_95ef6117_e2c6_4f06_b430_6884339df05f"}],"description":"","message_list":[],"uuid":"31092b28-7525-41c9-ae51-9f628b9fcd38","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"0e3f723b-cb21-41cd-bf3f-935718626f8c"},"name":"SYS_GEN__Runbook_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f"}},{"description":"System action for suspending an application","message_list":[],"uuid":"2245dbec-0536-4c47-9e0a-4057e74c1673","name":"action_suspend","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"DAG","uuid":"8dd2f8a6-1be1-4885-84cd-9eb0f5a23ee0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f"}],"description":"","message_list":[],"uuid":"1c8ac511-a1ef-4c57-8697-b656b7787501","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"8dd2f8a6-1be1-4885-84cd-9eb0f5a23ee0"},"name":"SYS_GEN__Runbook_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f"}},{"description":"System action for modifying an application","message_list":[],"uuid":"ca69bf0d-2fa4-4093-a27a-bb10b5852e66","name":"action_modify","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"DAG","uuid":"589debcb-78d5-4fec-8cd3-7713e15ae4c3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f"}],"description":"","message_list":[],"uuid":"8dc8c1ea-e27f-4043-a5ec-abaf0850644a","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"589debcb-78d5-4fec-8cd3-7713e15ae4c3"},"name":"SYS_GEN__Runbook_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f"}},{"description":"System action for powering off an application","message_list":[],"uuid":"8f2d196b-bba9-4d38-bbe4-17a1287a5bf1","name":"action_poweroff","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"DAG","uuid":"4a337bf8-e77b-434b-8221-bad4a6901ba3","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Operation_PowerOff_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"1108b23e-81e6-4ffb-b8b0-fae4994583db"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"VMOPERATION_NUTANIX","uuid":"1108b23e-81e6-4ffb-b8b0-fae4994583db","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"GENERIC_OPERATION"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Operation_PowerOff_95ef6117_e2c6_4f06_b430_6884339df05f"}],"description":"","message_list":[],"uuid":"026fb924-73d1-4ea7-8044-0d135bd6d4df","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"4a337bf8-e77b-434b-8221-bad4a6901ba3"},"name":"SYS_GEN__Runbook_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"509e928c-98a3-4de2-ae3b-375bfdcc2ed9","name":"action_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"DAG","uuid":"bd4c826c-4148-4103-8d34-9fa1c76ef495","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Nutanix_Delete_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"c3489e8b-55e4-427a-b199-9232a676a0f1"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"DELETE_NUTANIX","uuid":"c3489e8b-55e4-427a-b199-9232a676a0f1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Nutanix_Delete_95ef6117_e2c6_4f06_b430_6884339df05f"}],"description":"","message_list":[],"uuid":"cd11b3bb-014c-48d0-bf89-fda26307a107","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"bd4c826c-4148-4103-8d34-9fa1c76ef495"},"name":"SYS_GEN__Runbook_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"d56ea2d7-18a4-416f-ac20-5891f633a28a","name":"action_soft_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"DAG","uuid":"291925c5-b5dd-48fd-b244-187926f79e2e","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Substrate_Element_Delete_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"830e4ba1-450c-402e-8985-1a270d0e8039"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"830e4ba1-450c-402e-8985-1a270d0e8039","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Substrate_Element_Delete_95ef6117_e2c6_4f06_b430_6884339df05f"}],"description":"","message_list":[],"uuid":"a1d4d347-4d01-4a9a-98e3-81d109b69157","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"291925c5-b5dd-48fd-b244-187926f79e2e"},"name":"SYS_GEN__Runbook_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f"}}],"message_list":[],"uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b","state":"ACTIVE","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"0","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS","uuid":"abeffc51-2124-413f-a3db-ded3c10ad1f2"}},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"name":true,"resources":{"nic_list":{"0":{"subnet_reference":true}},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"guest_customization":true,"disk_list":{"1":{"disk_size_mib":true},"3":{"disk_size_mib":true},"2":{"disk_size_mib":true}}}}},"os_type":"Linux","type":"AHV_VM","create_spec":{"name":"K8SM-@@{calm_array_index}@@-@@{calm_time}@@","categories":"","availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"4ad0b85f-6a89-459b-a62f-73eb0e88bb1a"},"type":""}],"parent_reference":null,"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"serial_port_list":[],"gpu_list":[],"memory_size_mib":2048,"power_state":"ON","hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"type":"","boot_config":{"boot_device":{"type":"","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CENTOS_74","uuid":"7861473c-3123-4a72-bf45-329a774d3fd6"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":0,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":1,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":2,"type":""}}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","device_type":"DISK","disk_address":{"adapter_type":"SCSI","device_index":3,"type":""}}}]}},"variable_list":[],"name":"AHV_Centos_K8SM"}],"credential_definition_list":[{"username":"centos","description":"","state":"ACTIVE","message_list":[],"uuid":"abeffc51-2124-413f-a3db-ded3c10ad1f2","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{}}},"editables":{"username":true,"secret":true},"type":"KEY","name":"CENTOS"}],"type":"USER","app_profile_list":[{"deployment_create_list":[{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"88fb0867-1df7-47e2-b660-00136dd08592","name":"action_create","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"retries":"0","description":"","type":"DAG","uuid":"ee7174b8-ab4f-4c6d-adfe-79992954b52e","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_2c42014a_de10_409a_a2a6_97248f9d365d","uuid":"ff463123-086b-40fa-994d-7a6049b86cd1"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_0716f35c_8078_4d72_9805_ae2e239afab5","uuid":"5f812add-5d3e-4918-ad7d-9b64185ee6c3"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"96513dd6-59e5-4a30-8462-69584c7d54e8"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"6e33a39b-fd95-4419-93f4-409f8684e686"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"a1bf3285-5f92-4707-a403-74ba7c623a6f"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"6561e852-b9b5-4aa4-85ab-8c9241692c66"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"a1bf3285-5f92-4707-a403-74ba7c623a6f"},"edge_type":"inherent","type":"","uuid":"80725747-9a16-4257-87e5-163213b9647b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"6561e852-b9b5-4aa4-85ab-8c9241692c66"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"6e33a39b-fd95-4419-93f4-409f8684e686"},"edge_type":"inherent","type":"","uuid":"3bba42f7-d3be-4ccf-ac57-7e6591700397","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"a1bf3285-5f92-4707-a403-74ba7c623a6f"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_2c42014a_de10_409a_a2a6_97248f9d365d","uuid":"ff463123-086b-40fa-994d-7a6049b86cd1"},"edge_type":"inherent","type":"","uuid":"1f48b4f5-d244-4aa7-b556-173f6097d1ac","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"96513dd6-59e5-4a30-8462-69584c7d54e8"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"96513dd6-59e5-4a30-8462-69584c7d54e8"},"edge_type":"inherent","type":"","uuid":"97a06e76-7572-42c5-8f5b-5627ee2416e9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"6e33a39b-fd95-4419-93f4-409f8684e686"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_2c42014a_de10_409a_a2a6_97248f9d365d","uuid":"ff463123-086b-40fa-994d-7a6049b86cd1"},"edge_type":"inherent","type":"","uuid":"94b0508e-22a5-4165-a2c4-378361bd364d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_0716f35c_8078_4d72_9805_ae2e239afab5","uuid":"5f812add-5d3e-4918-ad7d-9b64185ee6c3"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_0716f35c_8078_4d72_9805_ae2e239afab5","uuid":"5f812add-5d3e-4918-ad7d-9b64185ee6c3"},"edge_type":"inherent","type":"","uuid":"a8bbfad3-4545-40b7-a1c1-63afa1c9805c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"96513dd6-59e5-4a30-8462-69584c7d54e8"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_2c42014a_de10_409a_a2a6_97248f9d365d"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"ff463123-086b-40fa-994d-7a6049b86cd1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_2c42014a_de10_409a_a2a6_97248f9d365d"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_CENTOS_76","uuid":"7861473c-3123-4a72-bf45-329a774d3fd6"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5f812add-5d3e-4918-ad7d-9b64185ee6c3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_0716f35c_8078_4d72_9805_ae2e239afab5","uuid":"6a44ff20-ebce-4764-848d-db34b3af1a36"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_0716f35c_8078_4d72_9805_ae2e239afab5"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"96513dd6-59e5-4a30-8462-69584c7d54e8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"9807d9d2-7955-4610-845a-b4654049b8de"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6e33a39b-fd95-4419-93f4-409f8684e686","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"0944279b-ed88-4bb6-b4d4-daea52512cc4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_e8686f95_a315_4943_b875_c3b61bca1ffb"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a1bf3285-5f92-4707-a403-74ba7c623a6f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"36b81be1-9b70-44f2-ac4f-e5e42e86d24d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6561e852-b9b5-4aa4-85ab-8c9241692c66","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"794616f8-d231-4aae-af7d-7fd616f436d6"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae"}],"description":"","message_list":[],"uuid":"6b6d0702-edfd-45b9-b87f-6223a32c0d2b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_2c42014a_de10_409a_a2a6_97248f9d365d","uuid":"ee7174b8-ab4f-4c6d-adfe-79992954b52e"},"name":"SYS_GEN__Runbook_Deployment_2c42014a_de10_409a_a2a6_97248f9d365d"}},{"description":"System action for starting an application","message_list":[],"uuid":"28a3ba16-a9d0-403c-af57-e801057b7b8b","name":"action_start","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"retries":"0","description":"","type":"DAG","uuid":"681c6f02-cae3-49b8-8093-eaab59851152","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"cd1f795b-a9dc-4989-bd1c-0c37a24cbc2c"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"96d79206-e201-48c0-86bd-0556275808e1"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"cd1f795b-a9dc-4989-bd1c-0c37a24cbc2c"},"edge_type":"inherent","type":"","uuid":"011aaba2-629a-4b7c-b0b4-36a777ab0d89","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"96d79206-e201-48c0-86bd-0556275808e1"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_2c42014a_de10_409a_a2a6_97248f9d365d"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"cd1f795b-a9dc-4989-bd1c-0c37a24cbc2c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"a4eb0eb4-7ce9-47d4-bfde-2cf4ae64076d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"96d79206-e201-48c0-86bd-0556275808e1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"794616f8-d231-4aae-af7d-7fd616f436d6"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae"}],"description":"","message_list":[],"uuid":"3cd76982-72fe-4487-ac33-63efb81d431b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_2c42014a_de10_409a_a2a6_97248f9d365d","uuid":"681c6f02-cae3-49b8-8093-eaab59851152"},"name":"SYS_GEN__Runbook_Deployment_2c42014a_de10_409a_a2a6_97248f9d365d"}},{"description":"System action for restarting an application","message_list":[],"uuid":"bcd2896b-1738-4543-bb40-e43778675901","name":"action_restart","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"retries":"0","description":"","type":"DAG","uuid":"bf029426-6d23-423d-8861-ceb44489db3f","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"580b65c7-5f58-4750-8860-ee421c3a2c58"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"ad986304-67db-45ae-a091-74cff42064b8"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"580b65c7-5f58-4750-8860-ee421c3a2c58"},"edge_type":"inherent","type":"","uuid":"c6f6f9f2-f0f0-4cc8-b069-a367e4bdb538","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"ad986304-67db-45ae-a091-74cff42064b8"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_2c42014a_de10_409a_a2a6_97248f9d365d"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"580b65c7-5f58-4750-8860-ee421c3a2c58","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"9cda6eff-7a1b-43dd-96cd-d8f374753805"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ad986304-67db-45ae-a091-74cff42064b8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"f0ee4c38-2566-4ac8-a103-898e3321c63e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae"}],"description":"","message_list":[],"uuid":"ec89b890-9cab-4e3d-b437-3683ef39c4b1","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_2c42014a_de10_409a_a2a6_97248f9d365d","uuid":"bf029426-6d23-423d-8861-ceb44489db3f"},"name":"SYS_GEN__Runbook_Deployment_2c42014a_de10_409a_a2a6_97248f9d365d"}},{"description":"System action for stopping an application","message_list":[],"uuid":"2315dd38-3b3c-467d-8577-7a0315e6b2af","name":"action_stop","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"retries":"0","description":"","type":"DAG","uuid":"09294f5f-4987-4ae2-a6c0-7cd9485d2a0c","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"8d02666c-a77f-4b6b-8a43-78ad3b71b88b"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"d6a3933b-42fa-4f00-bcdd-b22c9f5883d2"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"8d02666c-a77f-4b6b-8a43-78ad3b71b88b"},"edge_type":"inherent","type":"","uuid":"a03203bd-1965-4022-9469-566144ea28ef","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"d6a3933b-42fa-4f00-bcdd-b22c9f5883d2"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_2c42014a_de10_409a_a2a6_97248f9d365d"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8d02666c-a77f-4b6b-8a43-78ad3b71b88b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"771f76f2-789f-491b-addb-d55d2828070c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d6a3933b-42fa-4f00-bcdd-b22c9f5883d2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"679d1986-0926-431c-8651-2d912b5bda24"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b"}],"description":"","message_list":[],"uuid":"4106dfe3-d7f8-4964-93be-324258eedd03","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_2c42014a_de10_409a_a2a6_97248f9d365d","uuid":"09294f5f-4987-4ae2-a6c0-7cd9485d2a0c"},"name":"SYS_GEN__Runbook_Deployment_2c42014a_de10_409a_a2a6_97248f9d365d"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"88abc668-2495-4026-8f9c-2fafb3d919b4","name":"action_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"retries":"0","description":"","type":"DAG","uuid":"757c2f45-6230-41ec-b737-fa28f6508868","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"ab858e46-d37e-4392-b1cd-f0e3a67c1112"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"3c186b65-5fbe-4d73-a82c-5fd154e51183"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"4ecc1590-1186-4e5c-b4d2-7e0b94d6b65f"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"275eda56-4235-48bb-8441-a6a99f7882e6"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_2c42014a_de10_409a_a2a6_97248f9d365d","uuid":"1ffdc6d2-94d4-4461-a4f6-6ed5733fd1dd"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"ab858e46-d37e-4392-b1cd-f0e3a67c1112"},"edge_type":"inherent","type":"","uuid":"3cc7a9d4-90f7-46bd-9321-c290efbc2ddf","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"3c186b65-5fbe-4d73-a82c-5fd154e51183"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"3c186b65-5fbe-4d73-a82c-5fd154e51183"},"edge_type":"inherent","type":"","uuid":"a9ee41b3-1e01-4169-90d9-b046c0b801f3","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"4ecc1590-1186-4e5c-b4d2-7e0b94d6b65f"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"4ecc1590-1186-4e5c-b4d2-7e0b94d6b65f"},"edge_type":"inherent","type":"","uuid":"5edb6793-d28c-45d8-9ebe-199d557f5336","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"275eda56-4235-48bb-8441-a6a99f7882e6"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"275eda56-4235-48bb-8441-a6a99f7882e6"},"edge_type":"inherent","type":"","uuid":"397006dc-a723-4e11-92bb-a23a671826e2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_2c42014a_de10_409a_a2a6_97248f9d365d","uuid":"1ffdc6d2-94d4-4461-a4f6-6ed5733fd1dd"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_2c42014a_de10_409a_a2a6_97248f9d365d"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ab858e46-d37e-4392-b1cd-f0e3a67c1112","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"771f76f2-789f-491b-addb-d55d2828070c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3c186b65-5fbe-4d73-a82c-5fd154e51183","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"85f228cd-f200-4441-9bc8-4e7603c42c02"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4ecc1590-1186-4e5c-b4d2-7e0b94d6b65f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"fa9409d0-ebbb-4062-8f57-e1cc0475bf06"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_e8686f95_a315_4943_b875_c3b61bca1ffb"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"275eda56-4235-48bb-8441-a6a99f7882e6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"059459d3-370f-4dbd-a8af-ff32643303eb"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"1ffdc6d2-94d4-4461-a4f6-6ed5733fd1dd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_2c42014a_de10_409a_a2a6_97248f9d365d"}],"description":"","message_list":[],"uuid":"1b4a163b-a897-4449-8fa3-1f270283d44d","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_2c42014a_de10_409a_a2a6_97248f9d365d","uuid":"757c2f45-6230-41ec-b737-fa28f6508868"},"name":"SYS_GEN__Runbook_Deployment_2c42014a_de10_409a_a2a6_97248f9d365d"}},{"description":"System action for scaleout","message_list":[],"uuid":"e2ca3204-401f-4192-9d7d-bd7e9ffdb7e9","name":"action_scaleout","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"retries":"0","description":"","type":"DAG","uuid":"1cb0f1b6-5878-473a-b11f-34b7826a8994","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scaleout_2c42014a_de10_409a_a2a6_97248f9d365d","uuid":"2dbfd587-91ae-433a-af16-037964349864"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_2c42014a_de10_409a_a2a6_97248f9d365d"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"retries":"0","description":"","type":"SCALING","uuid":"2dbfd587-91ae-433a-af16-037964349864","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scaleout_2c42014a_de10_409a_a2a6_97248f9d365d"}],"description":"","message_list":[],"uuid":"4bc4d1d4-f4fa-4e72-965c-ccd0a963b65d","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"8ca36d66-96b8-4d76-ba69-aa5d681aa1a7","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_2c42014a_de10_409a_a2a6_97248f9d365d","uuid":"1cb0f1b6-5878-473a-b11f-34b7826a8994"},"name":"SYS_GEN__Runbook_Deployment_2c42014a_de10_409a_a2a6_97248f9d365d"}},{"description":"System action for scalein","message_list":[],"uuid":"0339da75-2b04-40cb-ae18-bb5d0fe6c5d3","name":"action_scalein","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"retries":"0","description":"","type":"DAG","uuid":"2930b6f9-a096-4559-ac1d-998b5716767c","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scalein_2c42014a_de10_409a_a2a6_97248f9d365d","uuid":"edf100d4-28f7-45fe-bb15-1899804a1196"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_2c42014a_de10_409a_a2a6_97248f9d365d"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"retries":"0","description":"","type":"SCALING","uuid":"edf100d4-28f7-45fe-bb15-1899804a1196","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scalein_2c42014a_de10_409a_a2a6_97248f9d365d"}],"description":"","message_list":[],"uuid":"821b60d8-6a64-44ec-8841-d7f57124ef19","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"fd3f6373-b946-46a4-bcec-4fbccf28c5c8","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_2c42014a_de10_409a_a2a6_97248f9d365d","uuid":"2930b6f9-a096-4559-ac1d-998b5716767c"},"name":"SYS_GEN__Runbook_Deployment_2c42014a_de10_409a_a2a6_97248f9d365d"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"f58e79e8-3cfd-4713-b9b1-8a8a4866111b","name":"action_soft_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"retries":"0","description":"","type":"DAG","uuid":"b0695f45-737c-405b-8f35-fbbf6303aa78","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"7b01e528-94ca-448d-8b39-7bf104c70add"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"104ad0bb-79c2-4c35-bb2b-42635e92bcac"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"8b1a4809-598c-44a2-acdf-be78d021d380"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_2c42014a_de10_409a_a2a6_97248f9d365d","uuid":"3b4e06e4-6399-4dbf-a27b-c72566e90aad"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"7b01e528-94ca-448d-8b39-7bf104c70add"},"edge_type":"inherent","type":"","uuid":"4c5c4911-ff98-42ae-a2b2-562661b0b74d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"104ad0bb-79c2-4c35-bb2b-42635e92bcac"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"8b1a4809-598c-44a2-acdf-be78d021d380"},"edge_type":"inherent","type":"","uuid":"ec903b17-1430-473a-b45b-e097c22a20b0","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_2c42014a_de10_409a_a2a6_97248f9d365d","uuid":"3b4e06e4-6399-4dbf-a27b-c72566e90aad"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"104ad0bb-79c2-4c35-bb2b-42635e92bcac"},"edge_type":"inherent","type":"","uuid":"1a030154-331b-4e06-ad2b-79577e642b4a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"8b1a4809-598c-44a2-acdf-be78d021d380"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_2c42014a_de10_409a_a2a6_97248f9d365d"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"7b01e528-94ca-448d-8b39-7bf104c70add","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"60ca2419-d6c4-46d4-8874-868b0dfba380"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"104ad0bb-79c2-4c35-bb2b-42635e92bcac","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_e8686f95_a315_4943_b875_c3b61bca1ffb"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"8b1a4809-598c-44a2-acdf-be78d021d380","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"c267afa8-57ca-4fba-b874-7c4827d1fe56"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"3b4e06e4-6399-4dbf-a27b-c72566e90aad","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_2c42014a_de10_409a_a2a6_97248f9d365d"}],"description":"","message_list":[],"uuid":"0cab7b68-2788-4000-adb1-be97ebd47566","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_2c42014a_de10_409a_a2a6_97248f9d365d","uuid":"b0695f45-737c-405b-8f35-fbbf6303aa78"},"name":"SYS_GEN__Runbook_Deployment_2c42014a_de10_409a_a2a6_97248f9d365d"}}],"message_list":[],"published_service_local_reference_list":[],"uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1","min_replicas":"3","state":"ACTIVE","max_replicas":"3","depends_on_list":[],"editables":{"min_replicas":true,"max_replicas":true},"package_local_reference_list":[{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"}],"substrate_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"type":"GREENFIELD","options":{},"variable_list":[],"name":"2cbb2f6a_deployment"},{"description":"","action_list":[{"description":"System action for creating an application","message_list":[],"uuid":"57344442-4e5e-4d82-8658-b3e501698312","name":"action_create","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"retries":"0","description":"","type":"DAG","uuid":"4381c4c6-57fe-4098-a1ef-9270f90a5d2d","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_7864df96_0b9c_4e9d_a1c9_22b5f8094601","uuid":"419101b2-963a-4ec6-b8a0-e9ef65fd87e8"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_0716f35c_8078_4d72_9805_ae2e239afab5","uuid":"f8fb1ec8-890b-4c4c-9450-b939130c4931"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"f3924195-cfa0-44e5-973e-3c80a7eb4324"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"138b527b-231b-40f8-b0c6-f387ff2e63f0"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"a3f9b48a-9ccd-4220-96af-07c0044e9ddd"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"5426157a-6214-49ef-a5a7-ae2c4f78eec8"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"a3f9b48a-9ccd-4220-96af-07c0044e9ddd"},"edge_type":"inherent","type":"","uuid":"d28ebc7e-c899-46b3-a036-9319fb842ea8","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"5426157a-6214-49ef-a5a7-ae2c4f78eec8"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"138b527b-231b-40f8-b0c6-f387ff2e63f0"},"edge_type":"inherent","type":"","uuid":"06ba8bcc-4bda-440e-8aab-683dd98dfb18","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"a3f9b48a-9ccd-4220-96af-07c0044e9ddd"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_7864df96_0b9c_4e9d_a1c9_22b5f8094601","uuid":"419101b2-963a-4ec6-b8a0-e9ef65fd87e8"},"edge_type":"inherent","type":"","uuid":"c791c97e-d536-45b8-b7a5-2e02f61f5b84","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_0716f35c_8078_4d72_9805_ae2e239afab5","uuid":"f8fb1ec8-890b-4c4c-9450-b939130c4931"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"f3924195-cfa0-44e5-973e-3c80a7eb4324"},"edge_type":"inherent","type":"","uuid":"08375058-5044-4226-a446-38a825f0fbc1","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"138b527b-231b-40f8-b0c6-f387ff2e63f0"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_7864df96_0b9c_4e9d_a1c9_22b5f8094601","uuid":"419101b2-963a-4ec6-b8a0-e9ef65fd87e8"},"edge_type":"inherent","type":"","uuid":"40522be2-f358-41fe-8335-57c49e5d5c6a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"f3924195-cfa0-44e5-973e-3c80a7eb4324"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_0716f35c_8078_4d72_9805_ae2e239afab5","uuid":"f8fb1ec8-890b-4c4c-9450-b939130c4931"},"edge_type":"inherent","type":"","uuid":"433af448-a915-42bd-9706-902b680a2981","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"f3924195-cfa0-44e5-973e-3c80a7eb4324"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_7864df96_0b9c_4e9d_a1c9_22b5f8094601"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"419101b2-963a-4ec6-b8a0-e9ef65fd87e8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_7864df96_0b9c_4e9d_a1c9_22b5f8094601"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_CENTOS_76","uuid":"7861473c-3123-4a72-bf45-329a774d3fd6"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f8fb1ec8-890b-4c4c-9450-b939130c4931","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_0716f35c_8078_4d72_9805_ae2e239afab5","uuid":"6a44ff20-ebce-4764-848d-db34b3af1a36"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_0716f35c_8078_4d72_9805_ae2e239afab5"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f3924195-cfa0-44e5-973e-3c80a7eb4324","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"7fdf183f-79e9-4d38-aa1e-1ced9421e13e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"138b527b-231b-40f8-b0c6-f387ff2e63f0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"e9f48991-7851-4e0d-aba5-b6ba6d3a7283"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a3f9b48a-9ccd-4220-96af-07c0044e9ddd","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"60e21428-ac74-4abe-b320-037ba471fa8a"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5426157a-6214-49ef-a5a7-ae2c4f78eec8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"cd012624-ef9b-48e9-9ab2-62a0fb5731e3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73"}],"description":"","message_list":[],"uuid":"35e47b13-2660-4988-b20f-6e760cb52f59","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_7864df96_0b9c_4e9d_a1c9_22b5f8094601","uuid":"4381c4c6-57fe-4098-a1ef-9270f90a5d2d"},"name":"SYS_GEN__Runbook_Deployment_7864df96_0b9c_4e9d_a1c9_22b5f8094601"}},{"description":"System action for starting an application","message_list":[],"uuid":"0938fe65-b557-4dfe-a712-dbd5699e5c60","name":"action_start","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"retries":"0","description":"","type":"DAG","uuid":"13418ac2-972d-4a59-b368-8cfa60ea20dd","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"6e20792d-33e2-4beb-bd19-8714be3b3845"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"4219d56e-b161-4c28-9b70-821a62448567"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"6e20792d-33e2-4beb-bd19-8714be3b3845"},"edge_type":"inherent","type":"","uuid":"cdf239c9-fd5c-4449-b8e3-28300580940f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"4219d56e-b161-4c28-9b70-821a62448567"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_7864df96_0b9c_4e9d_a1c9_22b5f8094601"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6e20792d-33e2-4beb-bd19-8714be3b3845","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"9c6fca4c-3f2d-4f85-bfe3-2a2a047ced8f"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4219d56e-b161-4c28-9b70-821a62448567","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"cd012624-ef9b-48e9-9ab2-62a0fb5731e3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73"}],"description":"","message_list":[],"uuid":"e9b1b940-b293-4875-a82d-03158e5e2894","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_7864df96_0b9c_4e9d_a1c9_22b5f8094601","uuid":"13418ac2-972d-4a59-b368-8cfa60ea20dd"},"name":"SYS_GEN__Runbook_Deployment_7864df96_0b9c_4e9d_a1c9_22b5f8094601"}},{"description":"System action for restarting an application","message_list":[],"uuid":"f637f848-2f26-4233-bba9-a5275f3f4ad7","name":"action_restart","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"retries":"0","description":"","type":"DAG","uuid":"0e7a2499-3cf8-4769-95a8-98b7916b2a9c","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"917c4406-2b38-4ea8-987c-e78f65fbdf41"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"17a606b2-356a-4049-a9ce-cf8d1c484882"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"917c4406-2b38-4ea8-987c-e78f65fbdf41"},"edge_type":"inherent","type":"","uuid":"d932e8b0-ab45-4b55-9c35-4b2fa8905b30","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"17a606b2-356a-4049-a9ce-cf8d1c484882"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_7864df96_0b9c_4e9d_a1c9_22b5f8094601"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"917c4406-2b38-4ea8-987c-e78f65fbdf41","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"31092b28-7525-41c9-ae51-9f628b9fcd38"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"17a606b2-356a-4049-a9ce-cf8d1c484882","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"7ec57533-22f0-4437-a50a-5c62a08fe445"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73"}],"description":"","message_list":[],"uuid":"c433db94-de47-4ca9-9e93-0030ef02633a","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_7864df96_0b9c_4e9d_a1c9_22b5f8094601","uuid":"0e7a2499-3cf8-4769-95a8-98b7916b2a9c"},"name":"SYS_GEN__Runbook_Deployment_7864df96_0b9c_4e9d_a1c9_22b5f8094601"}},{"description":"System action for stopping an application","message_list":[],"uuid":"b9a41bbd-a9c4-4285-9c2b-a14755f38a73","name":"action_stop","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"retries":"0","description":"","type":"DAG","uuid":"17af655e-b7f1-45ba-b0f3-01ffd53facd1","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"91ddff2e-4a21-4d1c-9a39-6d06c91fecd8"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"d54be244-8f64-4550-8c7a-54cf435cacc3"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"91ddff2e-4a21-4d1c-9a39-6d06c91fecd8"},"edge_type":"inherent","type":"","uuid":"0da3f741-73d2-4148-a8d5-a5bc51ad8764","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"d54be244-8f64-4550-8c7a-54cf435cacc3"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_7864df96_0b9c_4e9d_a1c9_22b5f8094601"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"91ddff2e-4a21-4d1c-9a39-6d06c91fecd8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12f2e944-b309-4629-a81b-5dc93622becc"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d54be244-8f64-4550-8c7a-54cf435cacc3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"026fb924-73d1-4ea7-8044-0d135bd6d4df"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f"}],"description":"","message_list":[],"uuid":"4eb448fc-f4d7-4073-99ca-2e7878cc0547","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_7864df96_0b9c_4e9d_a1c9_22b5f8094601","uuid":"17af655e-b7f1-45ba-b0f3-01ffd53facd1"},"name":"SYS_GEN__Runbook_Deployment_7864df96_0b9c_4e9d_a1c9_22b5f8094601"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"f6001884-bd3a-4b77-a6bc-086796ed62a1","name":"action_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"retries":"0","description":"","type":"DAG","uuid":"7db07b31-223f-4c3d-ae8f-298492775706","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"932cf385-7f62-41f3-a0bc-b8ffd4dfba3b"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"ceeb3833-c177-474e-87b6-132b66882a9d"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"6876d69c-a4d9-48a6-abd5-ffc7a7b8c6f6"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"309a1799-f2f9-45af-ac5c-a0f840ba5dc5"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_7864df96_0b9c_4e9d_a1c9_22b5f8094601","uuid":"3546616a-9ab1-43aa-9327-e212a5dd96ff"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"932cf385-7f62-41f3-a0bc-b8ffd4dfba3b"},"edge_type":"inherent","type":"","uuid":"f670ab7d-bfac-4a8c-bfa4-b976915acfd7","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"ceeb3833-c177-474e-87b6-132b66882a9d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"ceeb3833-c177-474e-87b6-132b66882a9d"},"edge_type":"inherent","type":"","uuid":"f5cf01a7-8757-4bed-a73c-5a165e728f74","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"6876d69c-a4d9-48a6-abd5-ffc7a7b8c6f6"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"309a1799-f2f9-45af-ac5c-a0f840ba5dc5"},"edge_type":"inherent","type":"","uuid":"1cb0f2de-79e5-422c-a131-b86dff22a2f5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_7864df96_0b9c_4e9d_a1c9_22b5f8094601","uuid":"3546616a-9ab1-43aa-9327-e212a5dd96ff"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"6876d69c-a4d9-48a6-abd5-ffc7a7b8c6f6"},"edge_type":"inherent","type":"","uuid":"f925cb0d-8736-4c89-8a24-496c11cfbe93","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"309a1799-f2f9-45af-ac5c-a0f840ba5dc5"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_7864df96_0b9c_4e9d_a1c9_22b5f8094601"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"932cf385-7f62-41f3-a0bc-b8ffd4dfba3b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12f2e944-b309-4629-a81b-5dc93622becc"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ceeb3833-c177-474e-87b6-132b66882a9d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"f85195a9-d884-4e50-8289-d75bab4a4905"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6876d69c-a4d9-48a6-abd5-ffc7a7b8c6f6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"9d2110c5-86a1-49fe-b657-ebf2e4ce048b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"309a1799-f2f9-45af-ac5c-a0f840ba5dc5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"cd11b3bb-014c-48d0-bf89-fda26307a107"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"3546616a-9ab1-43aa-9327-e212a5dd96ff","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_7864df96_0b9c_4e9d_a1c9_22b5f8094601"}],"description":"","message_list":[],"uuid":"0661a9ad-6c2a-496e-8f02-e6b499834610","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_7864df96_0b9c_4e9d_a1c9_22b5f8094601","uuid":"7db07b31-223f-4c3d-ae8f-298492775706"},"name":"SYS_GEN__Runbook_Deployment_7864df96_0b9c_4e9d_a1c9_22b5f8094601"}},{"description":"System action for scaleout","message_list":[],"uuid":"a6ee29f2-b66e-4746-ac1d-65e0eabdf9ac","name":"action_scaleout","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"retries":"0","description":"","type":"DAG","uuid":"ca79649c-11c2-4efd-ac56-a88a55cf7de3","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scaleout_7864df96_0b9c_4e9d_a1c9_22b5f8094601","uuid":"1e97fd8e-cd0f-4cdb-9f11-4bf740396b0e"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_7864df96_0b9c_4e9d_a1c9_22b5f8094601"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"retries":"0","description":"","type":"SCALING","uuid":"1e97fd8e-cd0f-4cdb-9f11-4bf740396b0e","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scaleout_7864df96_0b9c_4e9d_a1c9_22b5f8094601"}],"description":"","message_list":[],"uuid":"394f5ee5-0482-4100-9efe-36f5588aff95","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"4ad81782-8f85-4842-af4c-617048137c6f","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_7864df96_0b9c_4e9d_a1c9_22b5f8094601","uuid":"ca79649c-11c2-4efd-ac56-a88a55cf7de3"},"name":"SYS_GEN__Runbook_Deployment_7864df96_0b9c_4e9d_a1c9_22b5f8094601"}},{"description":"System action for scalein","message_list":[],"uuid":"80a35ac7-08d6-4fee-a006-bc01f22cb096","name":"action_scalein","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"retries":"0","description":"","type":"DAG","uuid":"d35de0ae-e0ec-4a73-a30b-71a3745721ee","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Deployment_Scalein_7864df96_0b9c_4e9d_a1c9_22b5f8094601","uuid":"96c33bf3-54bd-4ecd-b40b-e5ec326e4524"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_7864df96_0b9c_4e9d_a1c9_22b5f8094601"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"retries":"0","description":"","type":"SCALING","uuid":"96c33bf3-54bd-4ecd-b40b-e5ec326e4524","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"scaling_count":"@@{scaling_count}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Deployment_Scalein_7864df96_0b9c_4e9d_a1c9_22b5f8094601"}],"description":"","message_list":[],"uuid":"d93c435e-3966-48dc-96a2-0ed25cac2579","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"03e0d9cf-a8f4-4d53-bb50-2e4f021dbc9e","value":"0","label":"","state":"NOT_VALIDATED","attrs":{},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"scaling_count"}],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_7864df96_0b9c_4e9d_a1c9_22b5f8094601","uuid":"d35de0ae-e0ec-4a73-a30b-71a3745721ee"},"name":"SYS_GEN__Runbook_Deployment_7864df96_0b9c_4e9d_a1c9_22b5f8094601"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"aa95514b-1819-4bb6-8c39-ea33297752f4","name":"action_soft_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"retries":"0","description":"","type":"DAG","uuid":"db78ee24-a018-4004-bf9f-e3079d1a8259","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"0239ba87-d990-4126-8585-80c3d3b1abd1"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"1e11c27f-4e5d-4308-b1cc-4262e51e3016"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"36cad914-f4dc-424c-a45d-6e50e06bb26c"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_7864df96_0b9c_4e9d_a1c9_22b5f8094601","uuid":"7ac4efd2-09bb-4f9f-b2ac-bdf48c871dff"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"0239ba87-d990-4126-8585-80c3d3b1abd1"},"edge_type":"inherent","type":"","uuid":"3096bb90-6a6c-4091-9af8-75b5f69be586","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"1e11c27f-4e5d-4308-b1cc-4262e51e3016"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"36cad914-f4dc-424c-a45d-6e50e06bb26c"},"edge_type":"inherent","type":"","uuid":"655eabd7-2f03-403c-b5d6-9da3688cf530","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_7864df96_0b9c_4e9d_a1c9_22b5f8094601","uuid":"7ac4efd2-09bb-4f9f-b2ac-bdf48c871dff"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"1e11c27f-4e5d-4308-b1cc-4262e51e3016"},"edge_type":"inherent","type":"","uuid":"d4fecdb7-e6b0-479c-8812-47ff67927225","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"36cad914-f4dc-424c-a45d-6e50e06bb26c"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Deployment_7864df96_0b9c_4e9d_a1c9_22b5f8094601"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"0239ba87-d990-4126-8585-80c3d3b1abd1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"ab6d68fd-7950-4e2e-b8ee-720996847d75"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"1e11c27f-4e5d-4308-b1cc-4262e51e3016","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"36cad914-f4dc-424c-a45d-6e50e06bb26c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"a1d4d347-4d01-4a9a-98e3-81d109b69157"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"7ac4efd2-09bb-4f9f-b2ac-bdf48c871dff","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_7864df96_0b9c_4e9d_a1c9_22b5f8094601"}],"description":"","message_list":[],"uuid":"c26e3568-6750-419c-8453-5a9bc958963b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Deployment_7864df96_0b9c_4e9d_a1c9_22b5f8094601","uuid":"db78ee24-a018-4004-bf9f-e3079d1a8259"},"name":"SYS_GEN__Runbook_Deployment_7864df96_0b9c_4e9d_a1c9_22b5f8094601"}}],"message_list":[],"published_service_local_reference_list":[],"uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2","min_replicas":"2","state":"ACTIVE","max_replicas":"9","depends_on_list":[],"editables":{"min_replicas":true,"max_replicas":true},"package_local_reference_list":[{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"}],"substrate_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"type":"GREENFIELD","options":{},"variable_list":[],"name":"39cf7283_deployment"}],"description":"","action_list":[{"description":"","message_list":[],"uuid":"f32f0734-1e55-4538-bb3c-9cb626c7b1bf","name":"Upgrade","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"4271eb31-c16e-4d3d-a377-b1d1eabeb4c1","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Version Master","uuid":"a34ca171-1719-49fd-809c-e1fe984e770c"},{"kind":"app_task","name":"Set Version Minion","uuid":"8436b7c6-fcbf-410d-b66f-6387729cb0c9"},{"kind":"app_task","name":"Upgrade Master","uuid":"513f7163-cf86-4ec0-a71c-4f40a98c0f17"},{"kind":"app_task","name":"Upgrade Minion","uuid":"7ff0837f-e2b6-4077-87d9-4cf12062a605"},{"kind":"app_task","name":"RestartServices","uuid":"32e4f097-3b2e-493f-9034-8dcd2ec18fb1"}],"state":"NOT_VALIDATED","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"a34ca171-1719-49fd-809c-e1fe984e770c"},"edge_type":"user_defined","type":"","uuid":"2b1aed5d-74d7-47dd-a6d7-9465f96e136f","to_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"513f7163-cf86-4ec0-a71c-4f40a98c0f17"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"513f7163-cf86-4ec0-a71c-4f40a98c0f17"},"edge_type":"user_defined","type":"","uuid":"741d3c71-714f-431d-bf40-b36077c16b2a","to_task_reference":{"kind":"app_task","name":"RestartServices","uuid":"32e4f097-3b2e-493f-9034-8dcd2ec18fb1"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"a34ca171-1719-49fd-809c-e1fe984e770c"},"edge_type":"user_defined","type":"","uuid":"9f92ce8c-edef-4b46-a105-08f5fe996561","to_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"8436b7c6-fcbf-410d-b66f-6387729cb0c9"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"8436b7c6-fcbf-410d-b66f-6387729cb0c9"},"edge_type":"user_defined","type":"","uuid":"c79e2adc-8b70-4d94-a7db-272713890ee1","to_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"7ff0837f-e2b6-4077-87d9-4cf12062a605"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"7ff0837f-e2b6-4077-87d9-4cf12062a605"},"edge_type":"user_defined","type":"","uuid":"c85f10b1-c506-4656-86f1-049b37eab22b","to_task_reference":{"kind":"app_task","name":"RestartServices","uuid":"32e4f097-3b2e-493f-9034-8dcd2ec18fb1"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6ee65d8a_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"a34ca171-1719-49fd-809c-e1fe984e770c","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"exit_status":[],"script":"if \"@@{calm_array_index}@@\" == \"0\":\n\tprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Version Master"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"SET_VARIABLE","uuid":"8436b7c6-fcbf-410d-b66f-6387729cb0c9","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"exit_status":[],"script":"if \"@@{calm_array_index}@@\" == \"0\":\n\tprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Version Minion"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"EXEC","uuid":"513f7163-cf86-4ec0-a71c-4f40a98c0f17","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{KUBE_VERSION_NEW}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nCONTROLLER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,AlwaysPullImages,DenyEscalatingExec,SecurityContextDeny,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false \n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Upgrade Master"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"EXEC","uuid":"7ff0837f-e2b6-4077-87d9-4cf12062a605","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{KUBE_VERSION_NEW}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Upgrade Minion"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"EXEC","uuid":"32e4f097-3b2e-493f-9034-8dcd2ec18fb1","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nMINION_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nJSONPATH='{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}'\nKUBE_VERSION_NEW=\"@@{KUBE_VERSION_NEW}@@\"\nMASTER_API_HTTPS=6443\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION_NEW}\/bin\/linux\/amd64\/kubectl\nchmod +x kubectl\nsudo mv kubectl \/usr\/local\/bin\/kubectl\n\ncount=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n  echo \"Trying to reach master server https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} : sleep for 5 secs\"\n  sleep 10\n  if [[ $count -eq 10 ]]; then\n  \techo \"Unable to reach master server: https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\"\n  \texit 1\n  fi\n  count=$((count+1))\ndone\n\ncount=0\nfor ip in $(echo \"${MINION_IPS}\" | tr \",\" \"\\n\"); do\n  #kubectl drain \"minion${count}\" --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no $ip \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 10\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=minion${count} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon minion${count}\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n\techo \"Upgrade failed on minion nodes\"\n    exit 1\nfi\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  #kubectl drain \"controller${count}\" --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no $ip \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 10\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=controller${count} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon controller${count}\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n\techo \"Upgrade failed on nodes: $(kubectl get nodes -o jsonpath='$JSONPATH' | grep 'Ready=Unknown')\"\n    exit 1\nfi"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"RestartServices"}],"description":"","message_list":[],"uuid":"f389b1ae-c548-43cd-a1d0-94aeba9f02f6","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"668c20a8-e45d-4b01-946a-2dcf433ee07b","value":"v1.8.14","label":"","state":"NOT_VALIDATED","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_VERSION_NEW"}],"main_task_local_reference":{"kind":"app_task","name":"6ee65d8a_dag","uuid":"4271eb31-c16e-4d3d-a377-b1d1eabeb4c1"},"name":"68a7ffd0_runbook"}},{"description":"","message_list":[],"uuid":"306c1576-b694-42ef-a20c-a4d1a914d005","name":"ScaleOut","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"0cd3bf74-81d0-4b5c-a23a-aeaa11f8565b","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Out","uuid":"a4f8e707-211d-49fe-8f9d-dee7bc716213"},{"kind":"app_task","name":"Set Hosts file","uuid":"3c214722-255f-42b6-a128-5d313778dc60"}],"state":"NOT_VALIDATED","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Scale Out","uuid":"a4f8e707-211d-49fe-8f9d-dee7bc716213"},"edge_type":"user_defined","type":"","uuid":"c50981dd-8d59-4e89-890f-79a1111a77c2","to_task_reference":{"kind":"app_task","name":"Set Hosts file","uuid":"3c214722-255f-42b6-a128-5d313778dc60"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"03b33121_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"retries":"0","description":"","type":"SCALING","uuid":"a4f8e707-211d-49fe-8f9d-dee7bc716213","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Scale Out"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"EXEC","uuid":"3c214722-255f-42b6-a128-5d313778dc60","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMINION_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  if ! (( $(grep -c \"${ip} minion${count}\" \/etc\/hosts) )) ; then\n  \techo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  fi\n  count=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Set Hosts file"}],"description":"","message_list":[],"uuid":"046a63bf-2d47-4999-b494-f3542705531f","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"e2c83db1-4a44-42c0-8222-1852f321b5eb","value":"1","label":"","state":"NOT_VALIDATED","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"03b33121_dag","uuid":"0cd3bf74-81d0-4b5c-a23a-aeaa11f8565b"},"name":"00cf5417_runbook"}},{"description":"","message_list":[],"uuid":"0064bbb4-c6af-4241-b704-4d1802c15ffc","name":"ScaleIn","state":"ACTIVE","critical":false,"attrs":{},"type":"user","runbook":{"task_definition_list":[{"retries":"0","description":"","type":"DAG","uuid":"91140d58-9284-49a6-bdb4-357f9e63c550","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale In","uuid":"90f5f734-2bcd-4485-8771-3a1bc33c3056"}],"state":"NOT_VALIDATED","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"e72a9133_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"retries":"0","description":"","type":"SCALING","uuid":"90f5f734-2bcd-4485-8771-3a1bc33c3056","child_tasks_local_reference_list":[],"state":"NOT_VALIDATED","attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Scale In"}],"description":"","message_list":[],"uuid":"132d363c-529b-460c-970e-241d1ee4c43c","state":"ACTIVE","variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"6d1af7d5-584a-4032-a7db-b811fdf97530","value":"1","label":"","state":"NOT_VALIDATED","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"e72a9133_dag","uuid":"91140d58-9284-49a6-bdb4-357f9e63c550"},"name":"96546f6c_runbook"}},{"description":"System action for creating an application","message_list":[],"uuid":"c49241de-5a3b-4f27-8118-b787541f43fc","name":"action_create","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"028fe36c-9b2b-48f7-b30b-932ce81366e2"},"retries":"0","description":"","type":"DAG","uuid":"b794cf85-bbf8-4b0b-ad9d-54f0bbc3cc2a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__DE_Provision_7864df96_0b9c_4e9d_a1c9_22b5f8094601","uuid":"62ac8ff2-2b9d-486c-a26e-4f681d0281b1"},{"kind":"app_task","name":"SYS_GEN__DE_Provision_2c42014a_de10_409a_a2a6_97248f9d365d","uuid":"0300bff3-2f58-4033-aa07-2289f19763ec"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_0716f35c_8078_4d72_9805_ae2e239afab5","uuid":"c3572d0e-ccc8-4995-b4b1-a0e4c6d23bdc"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_0716f35c_8078_4d72_9805_ae2e239afab5_1","uuid":"9e9c3370-b0fa-4e5b-be1c-ce34c78476be"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"7a192d45-62a7-453a-b8a2-2b27f32f8315"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"cb0d2e07-6e05-4a93-9a5b-39ae6301cf27"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"514b6f46-e9d1-45db-ab6a-143917667cee"},{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"ce4c902d-9215-48de-aaf7-7c00855c0346"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"159bfe65-d1d4-4e1d-9a2b-1b4e1ae31840"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"ed11dc0b-d609-4bdb-82e6-19ff371558db"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"50ec3e7d-19fe-4ee7-96c5-c256842dcea0"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"ae501a1f-9669-4a7c-b137-2fb4503e1f3d"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"ed11dc0b-d609-4bdb-82e6-19ff371558db"},"edge_type":"inherent","type":"","uuid":"87e6079d-29e4-43fe-a847-20ba30e69cd9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"50ec3e7d-19fe-4ee7-96c5-c256842dcea0"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"ce4c902d-9215-48de-aaf7-7c00855c0346"},"edge_type":"inherent","type":"","uuid":"228c91c7-5bf4-4388-8c49-46e9de65469d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"ed11dc0b-d609-4bdb-82e6-19ff371558db"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_2c42014a_de10_409a_a2a6_97248f9d365d","uuid":"0300bff3-2f58-4033-aa07-2289f19763ec"},"edge_type":"inherent","type":"","uuid":"921c9441-af8e-4c5b-b25f-9b45e63a4ba9","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"cb0d2e07-6e05-4a93-9a5b-39ae6301cf27"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"cb0d2e07-6e05-4a93-9a5b-39ae6301cf27"},"edge_type":"inherent","type":"","uuid":"a1732e9a-0d75-4abf-884f-85383f2977a5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"ce4c902d-9215-48de-aaf7-7c00855c0346"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_2c42014a_de10_409a_a2a6_97248f9d365d","uuid":"0300bff3-2f58-4033-aa07-2289f19763ec"},"edge_type":"inherent","type":"","uuid":"46867e79-496c-4e79-b23b-8d00a81b0860","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_0716f35c_8078_4d72_9805_ae2e239afab5","uuid":"c3572d0e-ccc8-4995-b4b1-a0e4c6d23bdc"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_0716f35c_8078_4d72_9805_ae2e239afab5","uuid":"c3572d0e-ccc8-4995-b4b1-a0e4c6d23bdc"},"edge_type":"inherent","type":"","uuid":"d51ad416-a507-41aa-8ce7-6798c1a1e3ba","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"cb0d2e07-6e05-4a93-9a5b-39ae6301cf27"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"159bfe65-d1d4-4e1d-9a2b-1b4e1ae31840"},"edge_type":"inherent","type":"","uuid":"72bc2015-6456-43c5-b585-302edeb5b1b5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"ae501a1f-9669-4a7c-b137-2fb4503e1f3d"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"514b6f46-e9d1-45db-ab6a-143917667cee"},"edge_type":"inherent","type":"","uuid":"8d768f52-fe2a-45af-8cae-cdb097b033ae","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"159bfe65-d1d4-4e1d-9a2b-1b4e1ae31840"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_7864df96_0b9c_4e9d_a1c9_22b5f8094601","uuid":"62ac8ff2-2b9d-486c-a26e-4f681d0281b1"},"edge_type":"inherent","type":"","uuid":"8a78f137-6583-4037-b929-ea4a97967a4d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_0716f35c_8078_4d72_9805_ae2e239afab5_1","uuid":"9e9c3370-b0fa-4e5b-be1c-ce34c78476be"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"7a192d45-62a7-453a-b8a2-2b27f32f8315"},"edge_type":"inherent","type":"","uuid":"47fd66ae-c141-4184-b87a-6972df5ed5af","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"514b6f46-e9d1-45db-ab6a-143917667cee"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Provision_7864df96_0b9c_4e9d_a1c9_22b5f8094601","uuid":"62ac8ff2-2b9d-486c-a26e-4f681d0281b1"},"edge_type":"inherent","type":"","uuid":"f05354b2-0dea-42ef-89a7-3015447cf863","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"7a192d45-62a7-453a-b8a2-2b27f32f8315"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_0716f35c_8078_4d72_9805_ae2e239afab5_1","uuid":"9e9c3370-b0fa-4e5b-be1c-ce34c78476be"},"edge_type":"inherent","type":"","uuid":"bf118afa-e7bf-4816-9102-0314089ccc53","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"7a192d45-62a7-453a-b8a2-2b27f32f8315"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"7a192d45-62a7-453a-b8a2-2b27f32f8315"},"edge_type":"dependency","type":"","uuid":"07ffa625-76cd-4ac9-b345-cab6fbba8242","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"ce4c902d-9215-48de-aaf7-7c00855c0346"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"cb0d2e07-6e05-4a93-9a5b-39ae6301cf27"},"edge_type":"dependency","type":"","uuid":"6d6b5802-89e2-42f8-a78a-389077b57aa1","to_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"514b6f46-e9d1-45db-ab6a-143917667cee"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_248eeae0_6b4f_4c18_8b29_6270a363f51a"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"62ac8ff2-2b9d-486c-a26e-4f681d0281b1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_7864df96_0b9c_4e9d_a1c9_22b5f8094601"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"retries":"0","description":"","type":"CREATE_DEPLOYMENT_ELEMENT","uuid":"0300bff3-2f58-4033-aa07-2289f19763ec","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Provision_2c42014a_de10_409a_a2a6_97248f9d365d"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_CENTOS_76","uuid":"7861473c-3123-4a72-bf45-329a774d3fd6"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c3572d0e-ccc8-4995-b4b1-a0e4c6d23bdc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_0716f35c_8078_4d72_9805_ae2e239afab5","uuid":"6a44ff20-ebce-4764-848d-db34b3af1a36"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_0716f35c_8078_4d72_9805_ae2e239afab5"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_CENTOS_76","uuid":"7861473c-3123-4a72-bf45-329a774d3fd6"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"9e9c3370-b0fa-4e5b-be1c-ce34c78476be","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_0716f35c_8078_4d72_9805_ae2e239afab5","uuid":"6a44ff20-ebce-4764-848d-db34b3af1a36"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_0716f35c_8078_4d72_9805_ae2e239afab5_1"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"7a192d45-62a7-453a-b8a2-2b27f32f8315","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"7fdf183f-79e9-4d38-aa1e-1ced9421e13e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"cb0d2e07-6e05-4a93-9a5b-39ae6301cf27","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"9807d9d2-7955-4610-845a-b4654049b8de"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"514b6f46-e9d1-45db-ab6a-143917667cee","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"e9f48991-7851-4e0d-aba5-b6ba6d3a7283"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ce4c902d-9215-48de-aaf7-7c00855c0346","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"0944279b-ed88-4bb6-b4d4-daea52512cc4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_e8686f95_a315_4943_b875_c3b61bca1ffb"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"159bfe65-d1d4-4e1d-9a2b-1b4e1ae31840","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"60e21428-ac74-4abe-b320-037ba471fa8a"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ed11dc0b-d609-4bdb-82e6-19ff371558db","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"36b81be1-9b70-44f2-ac4f-e5e42e86d24d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"50ec3e7d-19fe-4ee7-96c5-c256842dcea0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"794616f8-d231-4aae-af7d-7fd616f436d6"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ae501a1f-9669-4a7c-b137-2fb4503e1f3d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"cd012624-ef9b-48e9-9ab2-62a0fb5731e3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73"}],"description":"","message_list":[],"uuid":"ff8d3236-7fdf-4474-9460-5900f7d7a897","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_248eeae0_6b4f_4c18_8b29_6270a363f51a","uuid":"b794cf85-bbf8-4b0b-ad9d-54f0bbc3cc2a"},"name":"SYS_GEN__Runbook_Application_248eeae0_6b4f_4c18_8b29_6270a363f51a"}},{"description":"System action for starting an application","message_list":[],"uuid":"154f87ea-dd33-4c77-b281-5d3ee220167c","name":"action_start","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"028fe36c-9b2b-48f7-b30b-932ce81366e2"},"retries":"0","description":"","type":"DAG","uuid":"2deb2634-36d7-4cf5-a3e0-9945dd3d245c","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"53e66951-2418-44f2-b296-0f26f63cad18"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"a21fa2c6-eb47-4a0f-a688-02fca88a31e0"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"9fd2d902-bf3b-4c1d-a766-1bd5ba894162"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"320a43ad-6d03-49ce-8d4e-2bd0112cb0e7"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"a21fa2c6-eb47-4a0f-a688-02fca88a31e0"},"edge_type":"inherent","type":"","uuid":"0062f96c-edc9-463f-b643-f6bba00d506c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"320a43ad-6d03-49ce-8d4e-2bd0112cb0e7"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"53e66951-2418-44f2-b296-0f26f63cad18"},"edge_type":"inherent","type":"","uuid":"dd7ba474-c8f1-4be6-9e6c-cde7d77a4284","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"9fd2d902-bf3b-4c1d-a766-1bd5ba894162"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_248eeae0_6b4f_4c18_8b29_6270a363f51a"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"53e66951-2418-44f2-b296-0f26f63cad18","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"9c6fca4c-3f2d-4f85-bfe3-2a2a047ced8f"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a21fa2c6-eb47-4a0f-a688-02fca88a31e0","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"a4eb0eb4-7ce9-47d4-bfde-2cf4ae64076d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"9fd2d902-bf3b-4c1d-a766-1bd5ba894162","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"cd012624-ef9b-48e9-9ab2-62a0fb5731e3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"320a43ad-6d03-49ce-8d4e-2bd0112cb0e7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"794616f8-d231-4aae-af7d-7fd616f436d6"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae"}],"description":"","message_list":[],"uuid":"028d8841-75b6-4755-8f1a-284851910f58","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_248eeae0_6b4f_4c18_8b29_6270a363f51a","uuid":"2deb2634-36d7-4cf5-a3e0-9945dd3d245c"},"name":"SYS_GEN__Runbook_Application_248eeae0_6b4f_4c18_8b29_6270a363f51a"}},{"description":"System action for restarting an application","message_list":[],"uuid":"bbe79db8-2006-424b-9205-b081d69975b3","name":"action_restart","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"028fe36c-9b2b-48f7-b30b-932ce81366e2"},"retries":"0","description":"","type":"DAG","uuid":"764626e7-fb7b-4ab2-ac7e-9e47aa97f6df","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"6b3e73c8-515a-4ba3-82bc-a7612b399bb4"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"c0073da9-2b70-4f1d-a01f-3d392748c240"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"c11c82f2-633f-45b8-b8a5-9df732e89acf"},{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"7588f91d-f39d-4eee-9d28-4b0fd9c51c6f"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"6b3e73c8-515a-4ba3-82bc-a7612b399bb4"},"edge_type":"inherent","type":"","uuid":"64ad9618-2145-4b5c-8334-0a8c08c0ea8c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"c11c82f2-633f-45b8-b8a5-9df732e89acf"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"c0073da9-2b70-4f1d-a01f-3d392748c240"},"edge_type":"inherent","type":"","uuid":"0cbedc0a-38dc-4f15-bd66-5ffd2b5a80bb","to_task_reference":{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"7588f91d-f39d-4eee-9d28-4b0fd9c51c6f"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_248eeae0_6b4f_4c18_8b29_6270a363f51a"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"6b3e73c8-515a-4ba3-82bc-a7612b399bb4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"9cda6eff-7a1b-43dd-96cd-d8f374753805"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c0073da9-2b70-4f1d-a01f-3d392748c240","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"31092b28-7525-41c9-ae51-9f628b9fcd38"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c11c82f2-633f-45b8-b8a5-9df732e89acf","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"f0ee4c38-2566-4ac8-a103-898e3321c63e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"7588f91d-f39d-4eee-9d28-4b0fd9c51c6f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"7ec57533-22f0-4437-a50a-5c62a08fe445"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73"}],"description":"","message_list":[],"uuid":"682e79dc-04ea-4711-89bd-7148f6e52a3c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_248eeae0_6b4f_4c18_8b29_6270a363f51a","uuid":"764626e7-fb7b-4ab2-ac7e-9e47aa97f6df"},"name":"SYS_GEN__Runbook_Application_248eeae0_6b4f_4c18_8b29_6270a363f51a"}},{"description":"System action for stopping an application","message_list":[],"uuid":"fabc5e3d-c349-4f03-bf67-5f420c8d1d4a","name":"action_stop","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"028fe36c-9b2b-48f7-b30b-932ce81366e2"},"retries":"0","description":"","type":"DAG","uuid":"b89bab11-157d-40f1-b9ff-e7a53b657102","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"e7fc9d52-19b2-4e9c-bd03-ece8bb5673a5"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"e26f6a60-f9e0-462b-ad4c-dce023cf60e2"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"e02011d5-dc55-40de-a5b2-b4952eccfef2"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"b6aa0d3e-fe53-4ca9-a5ca-9a5ec58f9688"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"e7fc9d52-19b2-4e9c-bd03-ece8bb5673a5"},"edge_type":"inherent","type":"","uuid":"4973f95f-1dfd-42a5-841d-9fd163eb6fb2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"b6aa0d3e-fe53-4ca9-a5ca-9a5ec58f9688"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"e26f6a60-f9e0-462b-ad4c-dce023cf60e2"},"edge_type":"inherent","type":"","uuid":"41a41eec-86f1-4174-bed7-ccc33b4b6f60","to_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"e02011d5-dc55-40de-a5b2-b4952eccfef2"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_248eeae0_6b4f_4c18_8b29_6270a363f51a"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e7fc9d52-19b2-4e9c-bd03-ece8bb5673a5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"771f76f2-789f-491b-addb-d55d2828070c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e26f6a60-f9e0-462b-ad4c-dce023cf60e2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12f2e944-b309-4629-a81b-5dc93622becc"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e02011d5-dc55-40de-a5b2-b4952eccfef2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"026fb924-73d1-4ea7-8044-0d135bd6d4df"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"b6aa0d3e-fe53-4ca9-a5ca-9a5ec58f9688","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"679d1986-0926-431c-8651-2d912b5bda24"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b"}],"description":"","message_list":[],"uuid":"6bc9a347-65af-4a19-bb4e-3d648432a185","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_248eeae0_6b4f_4c18_8b29_6270a363f51a","uuid":"b89bab11-157d-40f1-b9ff-e7a53b657102"},"name":"SYS_GEN__Runbook_Application_248eeae0_6b4f_4c18_8b29_6270a363f51a"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"2d9e9cc2-a25d-43ef-adbf-7d0d46392243","name":"action_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"028fe36c-9b2b-48f7-b30b-932ce81366e2"},"retries":"0","description":"","type":"DAG","uuid":"2be1121c-53ac-472c-a046-1c18b333dc2a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"5bb3d5ac-22ad-43ac-9897-fdc4787d3259"},{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"9cff190c-79ca-4905-967a-45020e7f739a"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"37420e16-722d-45cc-a367-c5df5c81597c"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"a9a3789d-7b07-4ad9-8c13-3331cc13016f"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"01763e7e-4468-4813-ad35-030fda5a4641"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"313e0304-a64a-4a31-b4e8-a7a8fb8eb6ea"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"20df7b1c-1a79-4379-9901-b8bd3c22e30c"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"52aa5a7e-98d2-4308-8689-4a80b7ff6cdc"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_7864df96_0b9c_4e9d_a1c9_22b5f8094601","uuid":"8921b055-c380-402d-b41f-2949e2a28a18"},{"kind":"app_task","name":"SYS_GEN__DE_Delete_2c42014a_de10_409a_a2a6_97248f9d365d","uuid":"a9d4dc85-3e99-4f5b-ab0d-fc07d6c92bf3"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"9cff190c-79ca-4905-967a-45020e7f739a"},"edge_type":"inherent","type":"","uuid":"4e0d9197-f1b5-4c22-80a4-4365777c8475","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"a9a3789d-7b07-4ad9-8c13-3331cc13016f"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"a9a3789d-7b07-4ad9-8c13-3331cc13016f"},"edge_type":"inherent","type":"","uuid":"2b8ad2c9-0939-49a9-b395-d4434b0d8527","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"01763e7e-4468-4813-ad35-030fda5a4641"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"01763e7e-4468-4813-ad35-030fda5a4641"},"edge_type":"inherent","type":"","uuid":"c009f89e-783e-4d26-b948-3422d8fb4354","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"52aa5a7e-98d2-4308-8689-4a80b7ff6cdc"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"52aa5a7e-98d2-4308-8689-4a80b7ff6cdc"},"edge_type":"inherent","type":"","uuid":"85855061-aece-40cb-8997-425a232d41fb","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_2c42014a_de10_409a_a2a6_97248f9d365d","uuid":"a9d4dc85-3e99-4f5b-ab0d-fc07d6c92bf3"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"5bb3d5ac-22ad-43ac-9897-fdc4787d3259"},"edge_type":"inherent","type":"","uuid":"09b4c0be-e8a1-433f-a9c3-6d8edf6ce937","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"37420e16-722d-45cc-a367-c5df5c81597c"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"37420e16-722d-45cc-a367-c5df5c81597c"},"edge_type":"inherent","type":"","uuid":"c9c58cf2-2220-449f-9b62-7411337bd2b2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"313e0304-a64a-4a31-b4e8-a7a8fb8eb6ea"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"20df7b1c-1a79-4379-9901-b8bd3c22e30c"},"edge_type":"inherent","type":"","uuid":"d54645db-579d-4861-be7f-24474a9f366f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Delete_7864df96_0b9c_4e9d_a1c9_22b5f8094601","uuid":"8921b055-c380-402d-b41f-2949e2a28a18"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"313e0304-a64a-4a31-b4e8-a7a8fb8eb6ea"},"edge_type":"inherent","type":"","uuid":"f9a9d966-6186-48c1-bd0e-43d09afce47d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"20df7b1c-1a79-4379-9901-b8bd3c22e30c"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"01763e7e-4468-4813-ad35-030fda5a4641"},"edge_type":"create_action_edge","type":"","uuid":"ba82242b-9db8-4202-b32a-0604eed14d61","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"20df7b1c-1a79-4379-9901-b8bd3c22e30c"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"313e0304-a64a-4a31-b4e8-a7a8fb8eb6ea"},"edge_type":"create_action_edge","type":"","uuid":"8fd12367-03b2-4ada-bc2a-01428f87b9fd","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"52aa5a7e-98d2-4308-8689-4a80b7ff6cdc"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"a9a3789d-7b07-4ad9-8c13-3331cc13016f"},"edge_type":"dependency","type":"","uuid":"ff6f7aa5-9849-40f4-9700-41d42b214509","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"313e0304-a64a-4a31-b4e8-a7a8fb8eb6ea"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_248eeae0_6b4f_4c18_8b29_6270a363f51a"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"5bb3d5ac-22ad-43ac-9897-fdc4787d3259","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12f2e944-b309-4629-a81b-5dc93622becc"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"9cff190c-79ca-4905-967a-45020e7f739a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"771f76f2-789f-491b-addb-d55d2828070c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"37420e16-722d-45cc-a367-c5df5c81597c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"f85195a9-d884-4e50-8289-d75bab4a4905"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"a9a3789d-7b07-4ad9-8c13-3331cc13016f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"85f228cd-f200-4441-9bc8-4e7603c42c02"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"01763e7e-4468-4813-ad35-030fda5a4641","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"fa9409d0-ebbb-4062-8f57-e1cc0475bf06"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_e8686f95_a315_4943_b875_c3b61bca1ffb"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"313e0304-a64a-4a31-b4e8-a7a8fb8eb6ea","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"9d2110c5-86a1-49fe-b657-ebf2e4ce048b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"20df7b1c-1a79-4379-9901-b8bd3c22e30c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"cd11b3bb-014c-48d0-bf89-fda26307a107"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"52aa5a7e-98d2-4308-8689-4a80b7ff6cdc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"059459d3-370f-4dbd-a8af-ff32643303eb"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"8921b055-c380-402d-b41f-2949e2a28a18","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_7864df96_0b9c_4e9d_a1c9_22b5f8094601"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"retries":"0","description":"","type":"DELETE_DEPLOYMENT_ELEMENT","uuid":"a9d4dc85-3e99-4f5b-ab0d-fc07d6c92bf3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Delete_2c42014a_de10_409a_a2a6_97248f9d365d"}],"description":"","message_list":[],"uuid":"24d6622a-09ce-416b-8ab5-bee7301631be","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_248eeae0_6b4f_4c18_8b29_6270a363f51a","uuid":"2be1121c-53ac-472c-a046-1c18b333dc2a"},"name":"SYS_GEN__Runbook_Application_248eeae0_6b4f_4c18_8b29_6270a363f51a"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"4cae4be9-4578-4e48-a6b4-4a86bd48bd0e","name":"action_soft_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_profile","name":"Nutanix","uuid":"028fe36c-9b2b-48f7-b30b-932ce81366e2"},"retries":"0","description":"","type":"DAG","uuid":"fd7e92f6-3999-4c9c-b0ab-5a4c869f927a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"4a6e927d-36b6-4076-8149-5087087b3e4c"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"e9ad6722-b777-4994-8986-9a3ce9c8098a"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"1da759d6-d977-4bd3-be3e-35d8b4d36d9b"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"dabcae90-8d04-488c-bea2-eb62cc660fe8"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"3c2c6cd2-fee1-4557-b10e-98420b07eb19"},{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"72679710-60cd-45de-98df-a66c8c2c9c46"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_7864df96_0b9c_4e9d_a1c9_22b5f8094601","uuid":"ed4a5a53-b6a2-4a11-a438-70138cc8d867"},{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_2c42014a_de10_409a_a2a6_97248f9d365d","uuid":"ba1d1958-bc63-444a-b660-00e5fbb5d139"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"4a6e927d-36b6-4076-8149-5087087b3e4c"},"edge_type":"inherent","type":"","uuid":"d1898033-f40a-4f3a-a432-7ce5666dba5b","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"dabcae90-8d04-488c-bea2-eb62cc660fe8"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"3c2c6cd2-fee1-4557-b10e-98420b07eb19"},"edge_type":"inherent","type":"","uuid":"d365c857-17a1-4a6c-b68d-36947792cb3d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_2c42014a_de10_409a_a2a6_97248f9d365d","uuid":"ba1d1958-bc63-444a-b660-00e5fbb5d139"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"dabcae90-8d04-488c-bea2-eb62cc660fe8"},"edge_type":"inherent","type":"","uuid":"02967295-3722-42e6-838b-d5e62a84cb7a","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"3c2c6cd2-fee1-4557-b10e-98420b07eb19"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"e9ad6722-b777-4994-8986-9a3ce9c8098a"},"edge_type":"inherent","type":"","uuid":"223474d2-00af-4866-958b-43ce06b9863c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"1da759d6-d977-4bd3-be3e-35d8b4d36d9b"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"72679710-60cd-45de-98df-a66c8c2c9c46"},"edge_type":"inherent","type":"","uuid":"c87f3163-638c-44da-a1e5-659ad0513715","to_task_reference":{"kind":"app_task","name":"SYS_GEN__DE_Soft_Delete_7864df96_0b9c_4e9d_a1c9_22b5f8094601","uuid":"ed4a5a53-b6a2-4a11-a438-70138cc8d867"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"1da759d6-d977-4bd3-be3e-35d8b4d36d9b"},"edge_type":"inherent","type":"","uuid":"9c4ac45a-d8c0-4bf2-91aa-a72d2992d208","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"72679710-60cd-45de-98df-a66c8c2c9c46"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"dabcae90-8d04-488c-bea2-eb62cc660fe8"},"edge_type":"create_action_edge","type":"","uuid":"f762ed13-7bd8-427f-a70e-fc1aca65f31f","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"72679710-60cd-45de-98df-a66c8c2c9c46"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"1da759d6-d977-4bd3-be3e-35d8b4d36d9b"},"edge_type":"create_action_edge","type":"","uuid":"65334250-2a9f-412f-81b3-41e952548fc5","to_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"3c2c6cd2-fee1-4557-b10e-98420b07eb19"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Application_248eeae0_6b4f_4c18_8b29_6270a363f51a"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4a6e927d-36b6-4076-8149-5087087b3e4c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"60ca2419-d6c4-46d4-8874-868b0dfba380"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e9ad6722-b777-4994-8986-9a3ce9c8098a","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"ab6d68fd-7950-4e2e-b8ee-720996847d75"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"1da759d6-d977-4bd3-be3e-35d8b4d36d9b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"dabcae90-8d04-488c-bea2-eb62cc660fe8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_e8686f95_a315_4943_b875_c3b61bca1ffb"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3c2c6cd2-fee1-4557-b10e-98420b07eb19","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_b892fcce_be27_4102_80c7_94b12311354b","uuid":"c267afa8-57ca-4fba-b874-7c4827d1fe56"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_b892fcce_be27_4102_80c7_94b12311354b"},{"target_any_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"72679710-60cd-45de-98df-a66c8c2c9c46","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"deployment_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f","uuid":"a1d4d347-4d01-4a9a-98e3-81d109b69157"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Substrate_95ef6117_e2c6_4f06_b430_6884339df05f"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"39cf7283_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"ed4a5a53-b6a2-4a11-a438-70138cc8d867","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_7864df96_0b9c_4e9d_a1c9_22b5f8094601"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"2cbb2f6a_deployment","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1"},"retries":"0","description":"","type":"SOFT_DELETE_DEPLOYMENT_ELEMENT","uuid":"ba1d1958-bc63-444a-b660-00e5fbb5d139","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DE_Soft_Delete_2c42014a_de10_409a_a2a6_97248f9d365d"}],"description":"","message_list":[],"uuid":"e474c7ac-cf90-489d-87bf-8fb909750d4b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Application_248eeae0_6b4f_4c18_8b29_6270a363f51a","uuid":"fd7e92f6-3999-4c9c-b0ab-5a4c869f927a"},"name":"SYS_GEN__Runbook_Application_248eeae0_6b4f_4c18_8b29_6270a363f51a"}}],"message_list":[],"uuid":"028fe36c-9b2b-48f7-b30b-932ce81366e2","state":"ACTIVE","dependency_list":[{"getter_resource_kind":"PackageCfg","setter_resource_attr":"address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"AHV_Centos_K8SM","action_name":"action_create","action_resource_name":"Nutanix","getter_resource_name":"AHV_Centos_K8SC_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"address","setter_resource_kind":"SubstrateCfg","setter_resource_name":"AHV_Centos_K8SC","action_name":"action_create","action_resource_name":"Nutanix","getter_resource_name":"AHV_Centos_K8SM_Package","action_resource_kind":"ApplicationCfg"},{"getter_resource_kind":"PackageCfg","setter_resource_attr":"address","setter_resource_kind":"ServiceCfg","setter_resource_name":"Kubernetes_Master","action_name":"action_delete","action_resource_name":"Nutanix","getter_resource_name":"AHV_Centos_K8SM_Package","action_resource_kind":"ApplicationCfg"}],"variable_list":[{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"87df8cb4-04ec-4f51-88c4-6071ea2aac98","value":"ahv-kubenetes-cluster","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_CLUSTER_NAME"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"6697d85f-20f7-4a17-b7f4-1bb115f29f3b","value":"v1.9.11","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_VERSION"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"21ff6cfc-364f-4069-ba6f-88a7ab241f99","value":"17.03.2.ce","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"DOCKER_VERSION"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"a8587f57-264b-443f-914f-b27b3f957568","value":"10.200.0.0\/16","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_CLUSTER_SUBNET"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"fff3c561-3658-43cd-9fbb-d0dd868fcaf8","value":"10.32.0.0\/24","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_SERVICE_SUBNET"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"0ec90e87-d842-4f2f-b29e-7d855729c414","value":"10.32.0.10","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_DNS_IP"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"f63637e3-0d39-4679-b519-33888c13f345","value":"10.46.34.88","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"PE_CLUSTER_IP"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"ecb55ba6-79d2-48c5-95ee-00e4d882fbed","value":"10.46.34.96","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"PE_DATA_SERVICE_IP"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"d809e136-d9e5-4f1b-b2f0-ee412dbfc3a4","value":"admin","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"PE_USERNAME"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"04447eb2-cf5b-4221-b0c8-a4c417aa09bf","value":"","label":"","state":"ACTIVE","attrs":{"is_secret_modified":false,"secret_reference":{"uuid":"a2f3c26a-52ab-4df2-b33c-9b285c959416"},"type":""},"editables":{"value":true},"is_hidden":false,"type":"SECRET","options":{},"name":"PE_PASSWORD"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"f900c078-4b06-4a16-b492-511f6edabb52","value":"default-container-69049036518763","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"PE_CONTAINER_NAME"},{"regex":{},"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","message_list":[],"uuid":"e2034784-8241-73c4-5f19-45e2cc9962e4","value":"canal","label":"","state":"ACTIVE","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"type":"LOCAL","options":{},"name":"KUBE_CNI_PLUGIN"}],"name":"Nutanix"}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"CENTOS","uuid":"abeffc51-2124-413f-a3db-ded3c10ad1f2"},"package_definition_list":[{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"54c2f797-3d9e-497a-9b27-253db5ceabd5","name":"action_install","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"},"retries":"0","description":"","type":"DAG","uuid":"a9c2fade-2f32-4fe5-9522-40d0751af37a","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Install_Crb_b5279f4c_5d74_460e_bc8e_9c1acbba4b7c","uuid":"27d10522-0e44-4a22-a862-bcca3fdf09f3"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_e8686f95_a315_4943_b875_c3b61bca1ffb"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_INSTALL","uuid":"27d10522-0e44-4a22-a862-bcca3fdf09f3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"},"retries":"0","description":"","type":"DAG","uuid":"bb53b796-9bff-4e6c-8a32-5a8d2668e3b8","child_tasks_local_reference_list":[{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"4e470a95-f83e-4fd6-888d-999b4ab5df3b"},{"kind":"app_task","name":"Generate Certs","uuid":"4c3b5b20-9dc5-429a-98a9-99517139b5b8"},{"kind":"app_task","name":"Configure Services","uuid":"51b2a424-33e3-4825-b34d-b89f3a67836c"},{"kind":"app_task","name":"Add User Roles","uuid":"006be5a2-000d-47a3-90ca-1171154f17cf"},{"kind":"app_task","name":"Network Configuration","uuid":"31ef4473-24ef-4463-aa5d-0167d3070fc4"},{"kind":"app_task","name":"DNS Configuration","uuid":"cd1e1d76-eac6-48db-be27-4ff3051dce0d"},{"kind":"app_task","name":"NVP Configuration","uuid":"2621bd3c-48cf-43c5-aa48-8fd4ddf4f2a3"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"4e470a95-f83e-4fd6-888d-999b4ab5df3b"},"edge_type":"user_defined","type":"","uuid":"db94874b-6b07-4d08-8781-b7e8b2eb29f0","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"4c3b5b20-9dc5-429a-98a9-99517139b5b8"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"4c3b5b20-9dc5-429a-98a9-99517139b5b8"},"edge_type":"user_defined","type":"","uuid":"5fe97a48-5f28-4617-b2d7-51b23f6ad04f","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"51b2a424-33e3-4825-b34d-b89f3a67836c"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"51b2a424-33e3-4825-b34d-b89f3a67836c"},"edge_type":"user_defined","type":"","uuid":"01340b87-3e2b-4fc9-a4ca-b7ad845e9b78","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"006be5a2-000d-47a3-90ca-1171154f17cf"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"006be5a2-000d-47a3-90ca-1171154f17cf"},"edge_type":"user_defined","type":"","uuid":"ef86b66a-e65b-4c6a-8275-2c6b73aa8317","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"31ef4473-24ef-4463-aa5d-0167d3070fc4"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"31ef4473-24ef-4463-aa5d-0167d3070fc4"},"edge_type":"user_defined","type":"","uuid":"911c33bb-85f4-4961-be4b-b7849e4878b9","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"cd1e1d76-eac6-48db-be27-4ff3051dce0d"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"cd1e1d76-eac6-48db-be27-4ff3051dce0d"},"edge_type":"user_defined","type":"","uuid":"33663eda-58fe-472e-ad65-8a5fbe45d877","to_task_reference":{"kind":"app_task","name":"NVP Configuration","uuid":"2621bd3c-48cf-43c5-aa48-8fd4ddf4f2a3"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"dac441af_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"EXEC","uuid":"4e470a95-f83e-4fd6-888d-999b4ab5df3b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nMINION_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} controller${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"controller${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')    \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate etcd \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/sd{e,f,g}\nsudo vgcreate docker \/dev\/sd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"EXEC","uuid":"4c3b5b20-9dc5-429a-98a9-99517139b5b8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nMINION_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\n\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_NAMES},${CONTROLLER_IPS},${MINION_NAMES},${MINION_IPS},${FIRST_IP_SERVICE_SUBNET},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local -profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\ninstance=\"controller${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=controller${count}.kubeconfig\nkubectl config set-credentials system:node:controller${count} --client-certificate=controller${count}.pem --client-key=controller${count}-key.pem --embed-certs=true --kubeconfig=controller${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:controller${count} --kubeconfig=controller${count}.kubeconfig\nkubectl config use-context default --kubeconfig=controller${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"controller${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"EXEC","uuid":"51b2a424-33e3-4825-b34d-b89f3a67836c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nCONTROLLER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,AlwaysPullImages,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n    \necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"EXEC","uuid":"006be5a2-000d-47a3-90ca-1171154f17cf","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet iscsid\nsudo systemctl enable etcd docker kubelet iscsid\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem controller* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"EXEC","uuid":"31ef4473-24ef-4463-aa5d-0167d3070fc4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ]]; then\nsudo mkdir -p \/etc\/kubernetes\/addons\/canal\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: canal-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  canal_iface: \"\"\n\n  masquerade: \"true\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: canal\n  namespace: kube-system\n  labels:\n    k8s-app: canal\nspec:\n  selector:\n    matchLabels:\n      k8s-app: canal\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: canal\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: canal\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.1\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-canal.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.1\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              value: \"none\"\n            - name: CLUSTER_TYPE\n              value: \"k8s,canal\"\n            - name: FELIX_IPTABLESREFRESHINTERVAL\n              value: \"60\"\n            - name: IP\n              value: \"\"\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"192.168.0.0\/16\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: \/readiness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n        - name: kube-flannel\n          image: quay.io\/coreos\/flannel:v0.9.1\n          command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n          securityContext:\n            privileged: true\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: FLANNELD_IFACE\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: canal_iface\n            - name: FLANNELD_IP_MASQ\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: masquerade\n          volumeMounts:\n          - mountPath: \/run\/xtables.lock\n            name: xtables-lock\n            readOnly: false\n          - name: flannel-cfg\n            mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: flannel-cfg\n          configMap:\n            name: canal-config\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: canal\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: canal-flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: canal-calico\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/canal\/canal.yml\nkubectl create -f \/etc\/kubernetes\/addons\/canal\/canal.yml\n\nelif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]];then\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/calico\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  calico_backend: \"bird\"\n\n  veth_mtu: \"1440\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: calico-node\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.1\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-calico.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CNI_MTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.1\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s,bgp\"\n            - name: IP\n              value: \"autodetect\"\n            - name: CALICO_IPV4POOL_IPIP\n              value: \"Always\"\n            - name: FELIX_IPINIPMTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"@@{KUBE_CLUSTER_SUBNET}@@\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            exec:\n              command:\n              - \/bin\/calico-node\n              - -bird-ready\n              - -felix-ready\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPPeer\n    plural: bgppeers\n    singular: bgppeer\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/calico\/calico.yml\nkubectl create -f \/etc\/kubernetes\/addons\/calico\/calico.yml  \n\nelse\n  echo \"Invalid `KUBE_CNI_PLUGIN : @@{KUBE_CNI_PLUGIN}@@` Defaulting to flannel\"\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - \/etc\/kube-flannel\/cni-conf.json\n        - \/etc\/cni\/net.d\/10-flannel.conf\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nfi\n\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"EXEC","uuid":"cd1e1d76-eac6-48db-be27-4ff3051dce0d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n    - name: dns\n      port: 53\n      protocol: UDP\n    - name: dns-tcp\n      port: 53\n      protocol: TCP\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: gcr.io\/google_containers\/k8s-dns-kube-dns-amd64:1.14.10\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: gcr.io\/google_containers\/k8s-dns-dnsmasq-nanny-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: gcr.io\/google_containers\/k8s-dns-sidecar-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local.,5,A\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local.,5,A\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy:\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n# Remove the configmaps rule once below issue is fixed:\n# kubernetes-incubator\/cluster-proportional-autoscaler#16\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.1.2-r2\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          # Should keep target in sync with cluster\/addons\/dns\/kube-dns.yaml.base\n          - --target=Deployment\/kube-dns\n          # When cluster is using large nodes(with more cores), \"coresPerReplica\" should dominate.\n          # If using small nodes, \"nodesPerReplica\" should dominate.\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"EXEC","uuid":"2621bd3c-48cf-43c5-aa48-8fd4ddf4f2a3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nPRISM_CLUSTER_IP=\"@@{PE_CLUSTER_IP}@@\"\nPRISM_DATA_SERVICE_IP=\"@@{PE_CLUSTER_IP}@@\"\n\nif [[ (\"${PRISM_CLUSTER_IP}x\" == \"x\") && (\"${PRISM_DATA_SERVICE_IP}x\" == \"x\") ]]; then exit 0; fi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/volume_plugin\nNTNX_SECRET=$(echo -n \"@@{PE_USERNAME}@@:@@{PE_PASSWORD}@@\" | base64)\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: nutanixabs-provisioner-runner\n  namespace: kube-system\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumes\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumeclaims\"]\n    verbs: [\"get\", \"list\", \"watch\", \"update\"]\n  - apiGroups: [\"storage.k8s.io\"]\n    resources: [\"storageclasses\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"list\", \"watch\", \"create\", \"update\", \"patch\"]\n  - apiGroups: [\"\"]\n    resources: [\"services\"]\n    verbs: [\"get\"]\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"create\", \"delete\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: run-nutanixabs-provisioner\n  namespace: kube-system\nsubjects:\n  - kind: ServiceAccount\n    name: nutanixabs-provisioner\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: nutanixabs-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      labels:\n        app: nutanixabs-provisioner\n    spec:\n      serviceAccount: nutanixabs-provisioner\n      hostNetwork: true\n      containers:\n        -\n          image: \"ntnx\/nutanixabs-provisioner\"\n          name: nutanixabs-provisioner\n          args: [\"--v=4\"]\n          imagePullPolicy: IfNotPresent\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: kube-system\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\n---\nkind: StorageClass\napiVersion: storage.k8s.io\/v1\nmetadata:\n  name: silver \n  namespace: kube-system\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\nprovisioner: nutanix\/abs\nparameters:\n     prismEndPoint: @@{PE_CLUSTER_IP}@@:9440\n     dataServiceEndPoint: @@{PE_DATA_SERVICE_IP}@@:3260\n     secretName: ntnx-secret\n     storageContainer: @@{PE_CONTAINER_NAME}@@\n     fsType: ext4\n     chapAuthEnabled: \"false\"' | sudo tee \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\necho \"apiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: default\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\" | sudo tee -a \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"NVP Configuration"}],"description":"","message_list":[],"uuid":"975efffc-8364-46b9-84d8-0b1b08e563b4","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"dac441af_dag","uuid":"bb53b796-9bff-4e6c-8a32-5a8d2668e3b8"},"name":"8e760b73_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"},"retries":"0","description":"","type":"DAG","uuid":"6d567c82-e48f-4838-883a-73a6bb8e31b4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6324786a_dag"}],"description":"","message_list":[],"uuid":"175c3cc1-502d-4622-9f8b-6d5c4ca3b336","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6324786a_dag","uuid":"6d567c82-e48f-4838-883a-73a6bb8e31b4"},"name":"6522ac7a_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Install_Crb_b5279f4c_5d74_460e_bc8e_9c1acbba4b7c"}],"description":"","message_list":[],"uuid":"0944279b-ed88-4bb6-b4d4-daea52512cc4","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"a9c2fade-2f32-4fe5-9522-40d0751af37a"},"name":"SYS_GEN__Runbook_Package_e8686f95_a315_4943_b875_c3b61bca1ffb"}},{"description":"System action for creating an application","message_list":[],"uuid":"5d886011-f24b-4a70-a90e-02d090af66b1","name":"action_create","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"},"retries":"0","description":"","type":"DAG","uuid":"798cc54f-9375-4930-adb1-a10852125c1e","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"e35a3901-98f4-40af-9328-747971b184f7"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"bf04a031-9f3a-4cba-a9fa-fd5760617799"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"c57328f9-18e5-4cbe-9422-05ac01bae638"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"bf04a031-9f3a-4cba-a9fa-fd5760617799"},"edge_type":"inherent","type":"","uuid":"121ab7be-4868-4b6e-9e53-1487b7cd79d2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"c57328f9-18e5-4cbe-9422-05ac01bae638"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"e35a3901-98f4-40af-9328-747971b184f7"},"edge_type":"inherent","type":"","uuid":"62c64891-cb94-426f-a437-32e75df28562","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"bf04a031-9f3a-4cba-a9fa-fd5760617799"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_e8686f95_a315_4943_b875_c3b61bca1ffb"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e35a3901-98f4-40af-9328-747971b184f7","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"0944279b-ed88-4bb6-b4d4-daea52512cc4"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_e8686f95_a315_4943_b875_c3b61bca1ffb"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"bf04a031-9f3a-4cba-a9fa-fd5760617799","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"a9639da1_runbook","uuid":"36b81be1-9b70-44f2-ac4f-e5e42e86d24d"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c57328f9-18e5-4cbe-9422-05ac01bae638","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"794616f8-d231-4aae-af7d-7fd616f436d6"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae"}],"description":"","message_list":[],"uuid":"2db8b80c-bb30-4fe2-b238-ac2ddef68a24","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"798cc54f-9375-4930-adb1-a10852125c1e"},"name":"SYS_GEN__Runbook_Package_e8686f95_a315_4943_b875_c3b61bca1ffb"}},{"description":"System action for uninstalling an application","message_list":[],"uuid":"dd3e3464-2bfa-4641-b7f7-de913f2916c8","name":"action_uninstall","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"},"retries":"0","description":"","type":"DAG","uuid":"aac0d833-0cf6-4332-8102-86c4aa8dceae","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Uninstall_Crb_b5279f4c_5d74_460e_bc8e_9c1acbba4b7c","uuid":"cc8c98f7-5d82-46d3-bf1a-9bd1c2d823a9"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_e8686f95_a315_4943_b875_c3b61bca1ffb"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_UNINSTALL","uuid":"cc8c98f7-5d82-46d3-bf1a-9bd1c2d823a9","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"},"retries":"0","description":"","type":"DAG","uuid":"bb53b796-9bff-4e6c-8a32-5a8d2668e3b8","child_tasks_local_reference_list":[{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"4e470a95-f83e-4fd6-888d-999b4ab5df3b"},{"kind":"app_task","name":"Generate Certs","uuid":"4c3b5b20-9dc5-429a-98a9-99517139b5b8"},{"kind":"app_task","name":"Configure Services","uuid":"51b2a424-33e3-4825-b34d-b89f3a67836c"},{"kind":"app_task","name":"Add User Roles","uuid":"006be5a2-000d-47a3-90ca-1171154f17cf"},{"kind":"app_task","name":"Network Configuration","uuid":"31ef4473-24ef-4463-aa5d-0167d3070fc4"},{"kind":"app_task","name":"DNS Configuration","uuid":"cd1e1d76-eac6-48db-be27-4ff3051dce0d"},{"kind":"app_task","name":"NVP Configuration","uuid":"2621bd3c-48cf-43c5-aa48-8fd4ddf4f2a3"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"4e470a95-f83e-4fd6-888d-999b4ab5df3b"},"edge_type":"user_defined","type":"","uuid":"db94874b-6b07-4d08-8781-b7e8b2eb29f0","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"4c3b5b20-9dc5-429a-98a9-99517139b5b8"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"4c3b5b20-9dc5-429a-98a9-99517139b5b8"},"edge_type":"user_defined","type":"","uuid":"5fe97a48-5f28-4617-b2d7-51b23f6ad04f","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"51b2a424-33e3-4825-b34d-b89f3a67836c"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"51b2a424-33e3-4825-b34d-b89f3a67836c"},"edge_type":"user_defined","type":"","uuid":"01340b87-3e2b-4fc9-a4ca-b7ad845e9b78","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"006be5a2-000d-47a3-90ca-1171154f17cf"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"006be5a2-000d-47a3-90ca-1171154f17cf"},"edge_type":"user_defined","type":"","uuid":"ef86b66a-e65b-4c6a-8275-2c6b73aa8317","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"31ef4473-24ef-4463-aa5d-0167d3070fc4"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"31ef4473-24ef-4463-aa5d-0167d3070fc4"},"edge_type":"user_defined","type":"","uuid":"911c33bb-85f4-4961-be4b-b7849e4878b9","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"cd1e1d76-eac6-48db-be27-4ff3051dce0d"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"cd1e1d76-eac6-48db-be27-4ff3051dce0d"},"edge_type":"user_defined","type":"","uuid":"33663eda-58fe-472e-ad65-8a5fbe45d877","to_task_reference":{"kind":"app_task","name":"NVP Configuration","uuid":"2621bd3c-48cf-43c5-aa48-8fd4ddf4f2a3"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"dac441af_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"EXEC","uuid":"4e470a95-f83e-4fd6-888d-999b4ab5df3b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nMINION_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} controller${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"controller${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')    \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate etcd \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/sd{e,f,g}\nsudo vgcreate docker \/dev\/sd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"EXEC","uuid":"4c3b5b20-9dc5-429a-98a9-99517139b5b8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nMINION_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\n\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_NAMES},${CONTROLLER_IPS},${MINION_NAMES},${MINION_IPS},${FIRST_IP_SERVICE_SUBNET},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local -profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\ninstance=\"controller${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=controller${count}.kubeconfig\nkubectl config set-credentials system:node:controller${count} --client-certificate=controller${count}.pem --client-key=controller${count}-key.pem --embed-certs=true --kubeconfig=controller${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:controller${count} --kubeconfig=controller${count}.kubeconfig\nkubectl config use-context default --kubeconfig=controller${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"controller${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"EXEC","uuid":"51b2a424-33e3-4825-b34d-b89f3a67836c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nCONTROLLER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,AlwaysPullImages,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n    \necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"EXEC","uuid":"006be5a2-000d-47a3-90ca-1171154f17cf","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet iscsid\nsudo systemctl enable etcd docker kubelet iscsid\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem controller* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"EXEC","uuid":"31ef4473-24ef-4463-aa5d-0167d3070fc4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ]]; then\nsudo mkdir -p \/etc\/kubernetes\/addons\/canal\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: canal-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  canal_iface: \"\"\n\n  masquerade: \"true\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: canal\n  namespace: kube-system\n  labels:\n    k8s-app: canal\nspec:\n  selector:\n    matchLabels:\n      k8s-app: canal\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: canal\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: canal\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.1\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-canal.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.1\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              value: \"none\"\n            - name: CLUSTER_TYPE\n              value: \"k8s,canal\"\n            - name: FELIX_IPTABLESREFRESHINTERVAL\n              value: \"60\"\n            - name: IP\n              value: \"\"\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"192.168.0.0\/16\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: \/readiness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n        - name: kube-flannel\n          image: quay.io\/coreos\/flannel:v0.9.1\n          command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n          securityContext:\n            privileged: true\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: FLANNELD_IFACE\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: canal_iface\n            - name: FLANNELD_IP_MASQ\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: masquerade\n          volumeMounts:\n          - mountPath: \/run\/xtables.lock\n            name: xtables-lock\n            readOnly: false\n          - name: flannel-cfg\n            mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: flannel-cfg\n          configMap:\n            name: canal-config\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: canal\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: canal-flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: canal-calico\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/canal\/canal.yml\nkubectl create -f \/etc\/kubernetes\/addons\/canal\/canal.yml\n\nelif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]];then\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/calico\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  calico_backend: \"bird\"\n\n  veth_mtu: \"1440\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: calico-node\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.1\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-calico.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CNI_MTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.1\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s,bgp\"\n            - name: IP\n              value: \"autodetect\"\n            - name: CALICO_IPV4POOL_IPIP\n              value: \"Always\"\n            - name: FELIX_IPINIPMTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"@@{KUBE_CLUSTER_SUBNET}@@\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            exec:\n              command:\n              - \/bin\/calico-node\n              - -bird-ready\n              - -felix-ready\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPPeer\n    plural: bgppeers\n    singular: bgppeer\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/calico\/calico.yml\nkubectl create -f \/etc\/kubernetes\/addons\/calico\/calico.yml  \n\nelse\n  echo \"Invalid `KUBE_CNI_PLUGIN : @@{KUBE_CNI_PLUGIN}@@` Defaulting to flannel\"\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - \/etc\/kube-flannel\/cni-conf.json\n        - \/etc\/cni\/net.d\/10-flannel.conf\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nfi\n\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"EXEC","uuid":"cd1e1d76-eac6-48db-be27-4ff3051dce0d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n    - name: dns\n      port: 53\n      protocol: UDP\n    - name: dns-tcp\n      port: 53\n      protocol: TCP\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: gcr.io\/google_containers\/k8s-dns-kube-dns-amd64:1.14.10\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: gcr.io\/google_containers\/k8s-dns-dnsmasq-nanny-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: gcr.io\/google_containers\/k8s-dns-sidecar-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local.,5,A\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local.,5,A\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy:\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n# Remove the configmaps rule once below issue is fixed:\n# kubernetes-incubator\/cluster-proportional-autoscaler#16\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.1.2-r2\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          # Should keep target in sync with cluster\/addons\/dns\/kube-dns.yaml.base\n          - --target=Deployment\/kube-dns\n          # When cluster is using large nodes(with more cores), \"coresPerReplica\" should dominate.\n          # If using small nodes, \"nodesPerReplica\" should dominate.\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"EXEC","uuid":"2621bd3c-48cf-43c5-aa48-8fd4ddf4f2a3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nPRISM_CLUSTER_IP=\"@@{PE_CLUSTER_IP}@@\"\nPRISM_DATA_SERVICE_IP=\"@@{PE_CLUSTER_IP}@@\"\n\nif [[ (\"${PRISM_CLUSTER_IP}x\" == \"x\") && (\"${PRISM_DATA_SERVICE_IP}x\" == \"x\") ]]; then exit 0; fi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/volume_plugin\nNTNX_SECRET=$(echo -n \"@@{PE_USERNAME}@@:@@{PE_PASSWORD}@@\" | base64)\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: nutanixabs-provisioner-runner\n  namespace: kube-system\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumes\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumeclaims\"]\n    verbs: [\"get\", \"list\", \"watch\", \"update\"]\n  - apiGroups: [\"storage.k8s.io\"]\n    resources: [\"storageclasses\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"list\", \"watch\", \"create\", \"update\", \"patch\"]\n  - apiGroups: [\"\"]\n    resources: [\"services\"]\n    verbs: [\"get\"]\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"create\", \"delete\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: run-nutanixabs-provisioner\n  namespace: kube-system\nsubjects:\n  - kind: ServiceAccount\n    name: nutanixabs-provisioner\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: nutanixabs-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      labels:\n        app: nutanixabs-provisioner\n    spec:\n      serviceAccount: nutanixabs-provisioner\n      hostNetwork: true\n      containers:\n        -\n          image: \"ntnx\/nutanixabs-provisioner\"\n          name: nutanixabs-provisioner\n          args: [\"--v=4\"]\n          imagePullPolicy: IfNotPresent\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: kube-system\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\n---\nkind: StorageClass\napiVersion: storage.k8s.io\/v1\nmetadata:\n  name: silver \n  namespace: kube-system\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\nprovisioner: nutanix\/abs\nparameters:\n     prismEndPoint: @@{PE_CLUSTER_IP}@@:9440\n     dataServiceEndPoint: @@{PE_DATA_SERVICE_IP}@@:3260\n     secretName: ntnx-secret\n     storageContainer: @@{PE_CONTAINER_NAME}@@\n     fsType: ext4\n     chapAuthEnabled: \"false\"' | sudo tee \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\necho \"apiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: default\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\" | sudo tee -a \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"NVP Configuration"}],"description":"","message_list":[],"uuid":"975efffc-8364-46b9-84d8-0b1b08e563b4","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"dac441af_dag","uuid":"bb53b796-9bff-4e6c-8a32-5a8d2668e3b8"},"name":"8e760b73_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"},"retries":"0","description":"","type":"DAG","uuid":"6d567c82-e48f-4838-883a-73a6bb8e31b4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6324786a_dag"}],"description":"","message_list":[],"uuid":"175c3cc1-502d-4622-9f8b-6d5c4ca3b336","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6324786a_dag","uuid":"6d567c82-e48f-4838-883a-73a6bb8e31b4"},"name":"6522ac7a_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Uninstall_Crb_b5279f4c_5d74_460e_bc8e_9c1acbba4b7c"}],"description":"","message_list":[],"uuid":"fa9409d0-ebbb-4062-8f57-e1cc0475bf06","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"aac0d833-0cf6-4332-8102-86c4aa8dceae"},"name":"SYS_GEN__Runbook_Package_e8686f95_a315_4943_b875_c3b61bca1ffb"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"8f6f579b-aadc-4bac-873e-ec5512906d1d","name":"action_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"},"retries":"0","description":"","type":"DAG","uuid":"3c870e86-3305-4af4-83f3-e006b85e159c","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"f57146b7-7b95-496d-9f45-456e541bfeee"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"cf3aaf4b-f9e5-4018-9524-78cebd404284"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"e455d7db-07e8-4020-bee4-90bda2bebd21"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"f57146b7-7b95-496d-9f45-456e541bfeee"},"edge_type":"inherent","type":"","uuid":"85a48d4c-4512-409b-9e5a-92d1c23f1512","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"cf3aaf4b-f9e5-4018-9524-78cebd404284"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"cf3aaf4b-f9e5-4018-9524-78cebd404284"},"edge_type":"inherent","type":"","uuid":"70c1015c-ef3b-46c8-85f3-13fc66efd8eb","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"e455d7db-07e8-4020-bee4-90bda2bebd21"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_e8686f95_a315_4943_b875_c3b61bca1ffb"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f57146b7-7b95-496d-9f45-456e541bfeee","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"771f76f2-789f-491b-addb-d55d2828070c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"cf3aaf4b-f9e5-4018-9524-78cebd404284","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"8c4aa276_runbook","uuid":"85f228cd-f200-4441-9bc8-4e7603c42c02"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e455d7db-07e8-4020-bee4-90bda2bebd21","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"fa9409d0-ebbb-4062-8f57-e1cc0475bf06"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_e8686f95_a315_4943_b875_c3b61bca1ffb"}],"description":"","message_list":[],"uuid":"21ca8aa5-6aa1-4536-a5eb-f4ba9f91d11f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"3c870e86-3305-4af4-83f3-e006b85e159c"},"name":"SYS_GEN__Runbook_Package_e8686f95_a315_4943_b875_c3b61bca1ffb"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"6160f74b-d73e-4574-9816-527a06941308","name":"action_soft_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"},"retries":"0","description":"","type":"DAG","uuid":"981d10e1-ce8c-4978-9257-42fccfc01c92","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"59ed07a4-157f-4727-a4a4-e3a6dd4e4931"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"1856d129-3755-46ea-8848-f7861f5b67ba"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"59ed07a4-157f-4727-a4a4-e3a6dd4e4931"},"edge_type":"inherent","type":"","uuid":"8a6d24cb-9633-4afc-9c60-93db0dea7247","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"1856d129-3755-46ea-8848-f7861f5b67ba"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_e8686f95_a315_4943_b875_c3b61bca1ffb"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"59ed07a4-157f-4727-a4a4-e3a6dd4e4931","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"60ca2419-d6c4-46d4-8874-868b0dfba380"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"1856d129-3755-46ea-8848-f7861f5b67ba","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_e8686f95_a315_4943_b875_c3b61bca1ffb"}],"description":"","message_list":[],"uuid":"f21aa51b-b748-4fc4-a7df-142197a24f9f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"981d10e1-ce8c-4978-9257-42fccfc01c92"},"name":"SYS_GEN__Runbook_Package_e8686f95_a315_4943_b875_c3b61bca1ffb"}},{"description":"System action for starting an application","message_list":[],"uuid":"592a98c0-bece-415e-b56a-c8e324d5a96d","name":"action_start","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"},"retries":"0","description":"","type":"DAG","uuid":"3a90e495-9b90-4baf-87f0-97629526987f","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"1f560109-2943-4727-8ada-75b5a319d0ee"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_e8686f95_a315_4943_b875_c3b61bca1ffb"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1f560109-2943-4727-8ada-75b5a319d0ee","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"daee30ae_runbook","uuid":"794616f8-d231-4aae-af7d-7fd616f436d6"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae"}],"description":"","message_list":[],"uuid":"004ab2dc-ee84-48d1-a7f0-8984956c6cb3","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"3a90e495-9b90-4baf-87f0-97629526987f"},"name":"SYS_GEN__Runbook_Package_e8686f95_a315_4943_b875_c3b61bca1ffb"}},{"description":"System action for restarting an application","message_list":[],"uuid":"5bffa988-ac44-47a7-bf59-207896ece8e4","name":"action_restart","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"},"retries":"0","description":"","type":"DAG","uuid":"271f89fc-7d67-467c-a088-657cf483e026","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"ae701182-3faf-4cc3-a605-feff44a2f628"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_e8686f95_a315_4943_b875_c3b61bca1ffb"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ae701182-3faf-4cc3-a605-feff44a2f628","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"d5c8316f_runbook","uuid":"f0ee4c38-2566-4ac8-a103-898e3321c63e"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae"}],"description":"","message_list":[],"uuid":"a5ffb62d-8103-49cb-8e87-eb476e7ac6b2","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"271f89fc-7d67-467c-a088-657cf483e026"},"name":"SYS_GEN__Runbook_Package_e8686f95_a315_4943_b875_c3b61bca1ffb"}},{"description":"System action for stopping an application","message_list":[],"uuid":"396d2aec-d662-4b50-93c8-31a16d12ee08","name":"action_stop","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"},"retries":"0","description":"","type":"DAG","uuid":"a5fbfa02-ecd3-4b07-9fdf-e059a84ae628","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae","uuid":"ec724f16-f186-4859-9c9a-68403d5ba61f"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_e8686f95_a315_4943_b875_c3b61bca1ffb"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"ec724f16-f186-4859-9c9a-68403d5ba61f","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"6407a345_runbook","uuid":"771f76f2-789f-491b-addb-d55d2828070c"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_1ff7322f_9ca1_454d_9740_9159ef5c5cae"}],"description":"","message_list":[],"uuid":"73b3f34a-a5c6-4263-ba45-30c58208338e","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_e8686f95_a315_4943_b875_c3b61bca1ffb","uuid":"a5fbfa02-ecd3-4b07-9fdf-e059a84ae628"},"name":"SYS_GEN__Runbook_Package_e8686f95_a315_4943_b875_c3b61bca1ffb"}}],"message_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"}],"uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c","state":"ACTIVE","version":"","editables":{},"type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"},"retries":"0","description":"","type":"DAG","uuid":"bb53b796-9bff-4e6c-8a32-5a8d2668e3b8","child_tasks_local_reference_list":[{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"4e470a95-f83e-4fd6-888d-999b4ab5df3b"},{"kind":"app_task","name":"Generate Certs","uuid":"4c3b5b20-9dc5-429a-98a9-99517139b5b8"},{"kind":"app_task","name":"Configure Services","uuid":"51b2a424-33e3-4825-b34d-b89f3a67836c"},{"kind":"app_task","name":"Add User Roles","uuid":"006be5a2-000d-47a3-90ca-1171154f17cf"},{"kind":"app_task","name":"Network Configuration","uuid":"31ef4473-24ef-4463-aa5d-0167d3070fc4"},{"kind":"app_task","name":"DNS Configuration","uuid":"cd1e1d76-eac6-48db-be27-4ff3051dce0d"},{"kind":"app_task","name":"NVP Configuration","uuid":"2621bd3c-48cf-43c5-aa48-8fd4ddf4f2a3"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"4e470a95-f83e-4fd6-888d-999b4ab5df3b"},"edge_type":"user_defined","type":"","uuid":"db94874b-6b07-4d08-8781-b7e8b2eb29f0","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"4c3b5b20-9dc5-429a-98a9-99517139b5b8"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"4c3b5b20-9dc5-429a-98a9-99517139b5b8"},"edge_type":"user_defined","type":"","uuid":"5fe97a48-5f28-4617-b2d7-51b23f6ad04f","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"51b2a424-33e3-4825-b34d-b89f3a67836c"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"51b2a424-33e3-4825-b34d-b89f3a67836c"},"edge_type":"user_defined","type":"","uuid":"01340b87-3e2b-4fc9-a4ca-b7ad845e9b78","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"006be5a2-000d-47a3-90ca-1171154f17cf"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"006be5a2-000d-47a3-90ca-1171154f17cf"},"edge_type":"user_defined","type":"","uuid":"ef86b66a-e65b-4c6a-8275-2c6b73aa8317","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"31ef4473-24ef-4463-aa5d-0167d3070fc4"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"31ef4473-24ef-4463-aa5d-0167d3070fc4"},"edge_type":"user_defined","type":"","uuid":"911c33bb-85f4-4961-be4b-b7849e4878b9","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"cd1e1d76-eac6-48db-be27-4ff3051dce0d"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"cd1e1d76-eac6-48db-be27-4ff3051dce0d"},"edge_type":"user_defined","type":"","uuid":"33663eda-58fe-472e-ad65-8a5fbe45d877","to_task_reference":{"kind":"app_task","name":"NVP Configuration","uuid":"2621bd3c-48cf-43c5-aa48-8fd4ddf4f2a3"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"dac441af_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"EXEC","uuid":"4e470a95-f83e-4fd6-888d-999b4ab5df3b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nMINION_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} controller${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"controller${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')    \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate etcd \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/sd{e,f,g}\nsudo vgcreate docker \/dev\/sd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"ETCD Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"EXEC","uuid":"4c3b5b20-9dc5-429a-98a9-99517139b5b8","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nMINION_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\n\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_NAMES},${CONTROLLER_IPS},${MINION_NAMES},${MINION_IPS},${FIRST_IP_SERVICE_SUBNET},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local -profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\ninstance=\"controller${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=controller${count}.kubeconfig\nkubectl config set-credentials system:node:controller${count} --client-certificate=controller${count}.pem --client-key=controller${count}-key.pem --embed-certs=true --kubeconfig=controller${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:controller${count} --kubeconfig=controller${count}.kubeconfig\nkubectl config use-context default --kubeconfig=controller${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"controller${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Generate Certs"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"EXEC","uuid":"51b2a424-33e3-4825-b34d-b89f3a67836c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nCONTROLLER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,AlwaysPullImages,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n    \necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Configure Services"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"EXEC","uuid":"006be5a2-000d-47a3-90ca-1171154f17cf","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet iscsid\nsudo systemctl enable etcd docker kubelet iscsid\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem controller* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Add User Roles"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"EXEC","uuid":"31ef4473-24ef-4463-aa5d-0167d3070fc4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ]]; then\nsudo mkdir -p \/etc\/kubernetes\/addons\/canal\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: canal-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  canal_iface: \"\"\n\n  masquerade: \"true\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: canal\n  namespace: kube-system\n  labels:\n    k8s-app: canal\nspec:\n  selector:\n    matchLabels:\n      k8s-app: canal\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: canal\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: canal\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.1\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-canal.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.1\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              value: \"none\"\n            - name: CLUSTER_TYPE\n              value: \"k8s,canal\"\n            - name: FELIX_IPTABLESREFRESHINTERVAL\n              value: \"60\"\n            - name: IP\n              value: \"\"\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"192.168.0.0\/16\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: \/readiness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n        - name: kube-flannel\n          image: quay.io\/coreos\/flannel:v0.9.1\n          command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n          securityContext:\n            privileged: true\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: FLANNELD_IFACE\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: canal_iface\n            - name: FLANNELD_IP_MASQ\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: masquerade\n          volumeMounts:\n          - mountPath: \/run\/xtables.lock\n            name: xtables-lock\n            readOnly: false\n          - name: flannel-cfg\n            mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: flannel-cfg\n          configMap:\n            name: canal-config\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: canal\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: canal-flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: canal-calico\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/canal\/canal.yml\nkubectl create -f \/etc\/kubernetes\/addons\/canal\/canal.yml\n\nelif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]];then\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/calico\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  calico_backend: \"bird\"\n\n  veth_mtu: \"1440\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: calico-node\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.1\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-calico.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CNI_MTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.1\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s,bgp\"\n            - name: IP\n              value: \"autodetect\"\n            - name: CALICO_IPV4POOL_IPIP\n              value: \"Always\"\n            - name: FELIX_IPINIPMTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"@@{KUBE_CLUSTER_SUBNET}@@\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            exec:\n              command:\n              - \/bin\/calico-node\n              - -bird-ready\n              - -felix-ready\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPPeer\n    plural: bgppeers\n    singular: bgppeer\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/calico\/calico.yml\nkubectl create -f \/etc\/kubernetes\/addons\/calico\/calico.yml  \n\nelse\n  echo \"Invalid `KUBE_CNI_PLUGIN : @@{KUBE_CNI_PLUGIN}@@` Defaulting to flannel\"\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - \/etc\/kube-flannel\/cni-conf.json\n        - \/etc\/cni\/net.d\/10-flannel.conf\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nfi\n\nsleep 15\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Network Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"EXEC","uuid":"cd1e1d76-eac6-48db-be27-4ff3051dce0d","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n    - name: dns\n      port: 53\n      protocol: UDP\n    - name: dns-tcp\n      port: 53\n      protocol: TCP\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: gcr.io\/google_containers\/k8s-dns-kube-dns-amd64:1.14.10\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: gcr.io\/google_containers\/k8s-dns-dnsmasq-nanny-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: gcr.io\/google_containers\/k8s-dns-sidecar-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local.,5,A\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local.,5,A\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy:\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n# Remove the configmaps rule once below issue is fixed:\n# kubernetes-incubator\/cluster-proportional-autoscaler#16\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.1.2-r2\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          # Should keep target in sync with cluster\/addons\/dns\/kube-dns.yaml.base\n          - --target=Deployment\/kube-dns\n          # When cluster is using large nodes(with more cores), \"coresPerReplica\" should dominate.\n          # If using small nodes, \"nodesPerReplica\" should dominate.\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"DNS Configuration"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","description":"","type":"EXEC","uuid":"2621bd3c-48cf-43c5-aa48-8fd4ddf4f2a3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nPRISM_CLUSTER_IP=\"@@{PE_CLUSTER_IP}@@\"\nPRISM_DATA_SERVICE_IP=\"@@{PE_CLUSTER_IP}@@\"\n\nif [[ (\"${PRISM_CLUSTER_IP}x\" == \"x\") && (\"${PRISM_DATA_SERVICE_IP}x\" == \"x\") ]]; then exit 0; fi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/volume_plugin\nNTNX_SECRET=$(echo -n \"@@{PE_USERNAME}@@:@@{PE_PASSWORD}@@\" | base64)\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: nutanixabs-provisioner-runner\n  namespace: kube-system\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumes\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumeclaims\"]\n    verbs: [\"get\", \"list\", \"watch\", \"update\"]\n  - apiGroups: [\"storage.k8s.io\"]\n    resources: [\"storageclasses\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"list\", \"watch\", \"create\", \"update\", \"patch\"]\n  - apiGroups: [\"\"]\n    resources: [\"services\"]\n    verbs: [\"get\"]\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"create\", \"delete\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: run-nutanixabs-provisioner\n  namespace: kube-system\nsubjects:\n  - kind: ServiceAccount\n    name: nutanixabs-provisioner\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: nutanixabs-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      labels:\n        app: nutanixabs-provisioner\n    spec:\n      serviceAccount: nutanixabs-provisioner\n      hostNetwork: true\n      containers:\n        -\n          image: \"ntnx\/nutanixabs-provisioner\"\n          name: nutanixabs-provisioner\n          args: [\"--v=4\"]\n          imagePullPolicy: IfNotPresent\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: kube-system\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\n---\nkind: StorageClass\napiVersion: storage.k8s.io\/v1\nmetadata:\n  name: silver \n  namespace: kube-system\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\nprovisioner: nutanix\/abs\nparameters:\n     prismEndPoint: @@{PE_CLUSTER_IP}@@:9440\n     dataServiceEndPoint: @@{PE_DATA_SERVICE_IP}@@:3260\n     secretName: ntnx-secret\n     storageContainer: @@{PE_CONTAINER_NAME}@@\n     fsType: ext4\n     chapAuthEnabled: \"false\"' | sudo tee \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\necho \"apiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: default\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\" | sudo tee -a \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\n"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"NVP Configuration"}],"description":"","message_list":[],"uuid":"975efffc-8364-46b9-84d8-0b1b08e563b4","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"dac441af_dag","uuid":"bb53b796-9bff-4e6c-8a32-5a8d2668e3b8"},"name":"8e760b73_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"},"retries":"0","description":"","type":"DAG","uuid":"6d567c82-e48f-4838-883a-73a6bb8e31b4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"6324786a_dag"}],"description":"","message_list":[],"uuid":"175c3cc1-502d-4622-9f8b-6d5c4ca3b336","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6324786a_dag","uuid":"6d567c82-e48f-4838-883a-73a6bb8e31b4"},"name":"6522ac7a_runbook"}},"variable_list":[],"name":"AHV_Centos_K8SC_Package"},{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"2873c9f5-4558-4674-b2f1-676814439ea3","name":"action_install","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"},"retries":"0","description":"","type":"DAG","uuid":"4680527c-aa85-4a9e-b723-1451ab097793","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Install_Crb_fcda64d0_b13e_4cec_b7b1_ad1058680125","uuid":"2da2241a-dcad-4b01-8bd0-8b7748c96624"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_INSTALL","uuid":"2da2241a-dcad-4b01-8bd0-8b7748c96624","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"},"retries":"0","description":"","type":"DAG","uuid":"1570df20-64fd-400b-ab81-7b72edfd5203","child_tasks_local_reference_list":[{"kind":"app_task","name":"Docker Kubelet Install","uuid":"064cf6df-3da3-4a90-943b-dc21937c9a18"},{"kind":"app_task","name":"GetCerts","uuid":"2ecd77aa-cadd-489a-a745-dfa0a9045b12"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"064cf6df-3da3-4a90-943b-dc21937c9a18"},"edge_type":"user_defined","type":"","uuid":"f74f3a63-c76f-4cbc-85cc-e44aef39f7d9","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"2ecd77aa-cadd-489a-a745-dfa0a9045b12"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"c1566b3d_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"EXEC","uuid":"064cf6df-3da3-4a90-943b-dc21937c9a18","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{AHV_Centos_K8SC.address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/usr\/share\/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"EXEC","uuid":"2ecd77aa-cadd-489a-a745-dfa0a9045b12","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{AHV_Centos_K8SC.address[0]}@@\"\nINSTANCE_IP=\"@@{address}@@\"\ninstance=\"minion@@{calm_array_index}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"minion@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${instance} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${instance} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"b1edafbd-6625-4377-96a3-374d256c2af8","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"c1566b3d_dag","uuid":"1570df20-64fd-400b-ab81-7b72edfd5203"},"name":"9a6e189b_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"},"retries":"0","description":"","type":"DAG","uuid":"c8708f56-a2f1-49fb-b8e8-3226448e0c8c","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"1527b81f-7e8a-419a-b44f-67dc71bfa666"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"abd3357c_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"EXEC","uuid":"1527b81f-7e8a-419a-b44f-67dc71bfa666","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain 'minion@@{calm_array_index}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node 'minion@@{calm_array_index}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"de124173-a951-49b3-aaa6-455bb1f0c1d7","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"abd3357c_dag","uuid":"c8708f56-a2f1-49fb-b8e8-3226448e0c8c"},"name":"3cb17acf_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Install_Crb_fcda64d0_b13e_4cec_b7b1_ad1058680125"}],"description":"","message_list":[],"uuid":"e9f48991-7851-4e0d-aba5-b6ba6d3a7283","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"4680527c-aa85-4a9e-b723-1451ab097793"},"name":"SYS_GEN__Runbook_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f"}},{"description":"System action for creating an application","message_list":[],"uuid":"0346cf7d-9b6f-4c24-8845-5f75f8c99501","name":"action_create","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"},"retries":"0","description":"","type":"DAG","uuid":"876244b5-52e8-4e8a-b409-febe845b96c9","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"e115c845-bde5-4d62-9337-4b14dca46d95"},{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"2128ecec-a4b5-4260-b41e-6ea5d3416115"},{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"3a9e39d4-d0bf-4051-b433-390bc577f20b"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"2128ecec-a4b5-4260-b41e-6ea5d3416115"},"edge_type":"inherent","type":"","uuid":"2b52ce0f-ae09-4762-b282-fb82efac82e3","to_task_reference":{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"3a9e39d4-d0bf-4051-b433-390bc577f20b"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"e115c845-bde5-4d62-9337-4b14dca46d95"},"edge_type":"inherent","type":"","uuid":"03623dd6-3268-43cb-8d38-7dbbaa0b70b6","to_task_reference":{"kind":"app_task","name":"SYS_GEN__create_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"2128ecec-a4b5-4260-b41e-6ea5d3416115"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e115c845-bde5-4d62-9337-4b14dca46d95","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"e9f48991-7851-4e0d-aba5-b6ba6d3a7283"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"2128ecec-a4b5-4260-b41e-6ea5d3416115","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"7c6e4932_runbook","uuid":"60e21428-ac74-4abe-b320-037ba471fa8a"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__create_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"3a9e39d4-d0bf-4051-b433-390bc577f20b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"cd012624-ef9b-48e9-9ab2-62a0fb5731e3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73"}],"description":"","message_list":[],"uuid":"dd0310b8-4a93-4a7a-a982-0dd989674eea","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"876244b5-52e8-4e8a-b409-febe845b96c9"},"name":"SYS_GEN__Runbook_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f"}},{"description":"System action for uninstalling an application","message_list":[],"uuid":"6e1547a1-b943-4c0f-b300-cacce39139ab","name":"action_uninstall","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"},"retries":"0","description":"","type":"DAG","uuid":"f5ed0d7c-e4e8-4896-9bff-b2848161e418","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__Uninstall_Crb_fcda64d0_b13e_4cec_b7b1_ad1058680125","uuid":"36716464-88b2-439b-ba40-e08f9797a840"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"},"retries":"0","description":"","type":"CUSTOM_PACKAGE_UNINSTALL","uuid":"36716464-88b2-439b-ba40-e08f9797a840","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"},"retries":"0","description":"","type":"DAG","uuid":"1570df20-64fd-400b-ab81-7b72edfd5203","child_tasks_local_reference_list":[{"kind":"app_task","name":"Docker Kubelet Install","uuid":"064cf6df-3da3-4a90-943b-dc21937c9a18"},{"kind":"app_task","name":"GetCerts","uuid":"2ecd77aa-cadd-489a-a745-dfa0a9045b12"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"064cf6df-3da3-4a90-943b-dc21937c9a18"},"edge_type":"user_defined","type":"","uuid":"f74f3a63-c76f-4cbc-85cc-e44aef39f7d9","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"2ecd77aa-cadd-489a-a745-dfa0a9045b12"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"c1566b3d_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"EXEC","uuid":"064cf6df-3da3-4a90-943b-dc21937c9a18","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{AHV_Centos_K8SC.address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/usr\/share\/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"EXEC","uuid":"2ecd77aa-cadd-489a-a745-dfa0a9045b12","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{AHV_Centos_K8SC.address[0]}@@\"\nINSTANCE_IP=\"@@{address}@@\"\ninstance=\"minion@@{calm_array_index}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"minion@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${instance} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${instance} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"b1edafbd-6625-4377-96a3-374d256c2af8","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"c1566b3d_dag","uuid":"1570df20-64fd-400b-ab81-7b72edfd5203"},"name":"9a6e189b_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"},"retries":"0","description":"","type":"DAG","uuid":"c8708f56-a2f1-49fb-b8e8-3226448e0c8c","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"1527b81f-7e8a-419a-b44f-67dc71bfa666"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"abd3357c_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"EXEC","uuid":"1527b81f-7e8a-419a-b44f-67dc71bfa666","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain 'minion@@{calm_array_index}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node 'minion@@{calm_array_index}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"de124173-a951-49b3-aaa6-455bb1f0c1d7","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"abd3357c_dag","uuid":"c8708f56-a2f1-49fb-b8e8-3226448e0c8c"},"name":"3cb17acf_runbook"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Uninstall_Crb_fcda64d0_b13e_4cec_b7b1_ad1058680125"}],"description":"","message_list":[],"uuid":"9d2110c5-86a1-49fe-b657-ebf2e4ce048b","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"f5ed0d7c-e4e8-4896-9bff-b2848161e418"},"name":"SYS_GEN__Runbook_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"51f553f7-6211-4311-954d-5450522ef930","name":"action_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"},"retries":"0","description":"","type":"DAG","uuid":"0332de6b-3361-4938-9e2a-f08d417547a5","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"055272e0-f093-43f1-853a-55664de18193"},{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"4f9edaf0-5cad-41b2-ab8f-20b75c27dd43"},{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"c0f9dab0-5c45-4725-9edb-5138730c1a02"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"055272e0-f093-43f1-853a-55664de18193"},"edge_type":"inherent","type":"","uuid":"1a6afbf8-a13f-4c35-a347-4c4936effa1d","to_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"4f9edaf0-5cad-41b2-ab8f-20b75c27dd43"}},{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__delete_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"4f9edaf0-5cad-41b2-ab8f-20b75c27dd43"},"edge_type":"inherent","type":"","uuid":"8985a1f9-a845-4136-b234-015063cfc84c","to_task_reference":{"kind":"app_task","name":"SYS_GEN__uninstall_CRb_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"c0f9dab0-5c45-4725-9edb-5138730c1a02"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"055272e0-f093-43f1-853a-55664de18193","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12f2e944-b309-4629-a81b-5dc93622becc"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"4f9edaf0-5cad-41b2-ab8f-20b75c27dd43","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"1d794193_runbook","uuid":"f85195a9-d884-4e50-8289-d75bab4a4905"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__delete_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"c0f9dab0-5c45-4725-9edb-5138730c1a02","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"9d2110c5-86a1-49fe-b657-ebf2e4ce048b"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__uninstall_CRb_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f"}],"description":"","message_list":[],"uuid":"99587ea4-33c4-4d44-8962-ccfa2047f819","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"0332de6b-3361-4938-9e2a-f08d417547a5"},"name":"SYS_GEN__Runbook_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"2179e511-c9f2-40bf-98ab-1e662a9f8fe8","name":"action_soft_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"},"retries":"0","description":"","type":"DAG","uuid":"fd0420a9-03b2-4741-8b41-f861425c1bbf","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"f454e322-c8f8-4ed9-8714-8f40c4e6afc4"},{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"7324baea-4293-491d-adfe-ee235689c593"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"SYS_GEN__soft_delete_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"f454e322-c8f8-4ed9-8714-8f40c4e6afc4"},"edge_type":"inherent","type":"","uuid":"a0b46b8d-b258-4645-8308-b84246b109d2","to_task_reference":{"kind":"app_task","name":"SYS_GEN__Package_Element_Delete_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"7324baea-4293-491d-adfe-ee235689c593"}}],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"f454e322-c8f8-4ed9-8714-8f40c4e6afc4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"ab6d68fd-7950-4e2e-b8ee-720996847d75"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__soft_delete_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"},"retries":"0","description":"","type":"SOFT_DELETE_ELEMENT","uuid":"7324baea-4293-491d-adfe-ee235689c593","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Package_Element_Delete_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f"}],"description":"","message_list":[],"uuid":"96cb5ff4-48d4-403e-ae17-6af337f173cf","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"fd0420a9-03b2-4741-8b41-f861425c1bbf"},"name":"SYS_GEN__Runbook_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f"}},{"description":"System action for starting an application","message_list":[],"uuid":"cb2829aa-448f-48b0-9ea7-7830ccda8c46","name":"action_start","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"},"retries":"0","description":"","type":"DAG","uuid":"8eda6a95-7cf5-4f9e-ba02-82bbae9dbdc7","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__start_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"d0617f02-ab41-449b-bb5a-2c754c949a53"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"d0617f02-ab41-449b-bb5a-2c754c949a53","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"884352cf_runbook","uuid":"cd012624-ef9b-48e9-9ab2-62a0fb5731e3"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__start_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73"}],"description":"","message_list":[],"uuid":"bcedfbf8-4829-464c-869a-c4941960e8b4","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"8eda6a95-7cf5-4f9e-ba02-82bbae9dbdc7"},"name":"SYS_GEN__Runbook_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f"}},{"description":"System action for restarting an application","message_list":[],"uuid":"a03372b0-7d8f-4743-b5c8-8ebef7da3007","name":"action_restart","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"},"retries":"0","description":"","type":"DAG","uuid":"298589a6-b541-45f5-a852-367aabb7363e","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__restart_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"368bcb3e-641f-49f9-bbdf-633a41aebfbe"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"368bcb3e-641f-49f9-bbdf-633a41aebfbe","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"3a6f587d_runbook","uuid":"7ec57533-22f0-4437-a50a-5c62a08fe445"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__restart_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73"}],"description":"","message_list":[],"uuid":"29fd8c56-aff3-4a11-ba05-bfd913063c31","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"298589a6-b541-45f5-a852-367aabb7363e"},"name":"SYS_GEN__Runbook_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f"}},{"description":"System action for stopping an application","message_list":[],"uuid":"e016a996-26ec-4163-b596-69a18a7092bd","name":"action_stop","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"},"retries":"0","description":"","type":"DAG","uuid":"31ba3fa4-e702-43d4-af2b-9ec6ec97261f","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__stop_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73","uuid":"1545a57a-4db3-405c-ae86-43be2b72a8d4"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"1545a57a-4db3-405c-ae86-43be2b72a8d4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"0cb172a7_runbook","uuid":"12f2e944-b309-4629-a81b-5dc93622becc"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__stop_CRb_Service_f13b4e44_6ce8_4869_b1c2_117ef592db73"}],"description":"","message_list":[],"uuid":"b904c106-ff38-4301-9460-4c3e59c38d37","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f","uuid":"31ba3fa4-e702-43d4-af2b-9ec6ec97261f"},"name":"SYS_GEN__Runbook_Package_7aa406a4_6aa3_48a3_9779_bc97b7fb4e7f"}}],"message_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"}],"uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125","state":"ACTIVE","version":"","editables":{},"type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"},"retries":"0","description":"","type":"DAG","uuid":"1570df20-64fd-400b-ab81-7b72edfd5203","child_tasks_local_reference_list":[{"kind":"app_task","name":"Docker Kubelet Install","uuid":"064cf6df-3da3-4a90-943b-dc21937c9a18"},{"kind":"app_task","name":"GetCerts","uuid":"2ecd77aa-cadd-489a-a745-dfa0a9045b12"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"064cf6df-3da3-4a90-943b-dc21937c9a18"},"edge_type":"user_defined","type":"","uuid":"f74f3a63-c76f-4cbc-85cc-e44aef39f7d9","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"2ecd77aa-cadd-489a-a745-dfa0a9045b12"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"c1566b3d_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"EXEC","uuid":"064cf6df-3da3-4a90-943b-dc21937c9a18","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{AHV_Centos_K8SC.address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/usr\/share\/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Docker Kubelet Install"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"EXEC","uuid":"2ecd77aa-cadd-489a-a745-dfa0a9045b12","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{AHV_Centos_K8SC.address[0]}@@\"\nINSTANCE_IP=\"@@{address}@@\"\ninstance=\"minion@@{calm_array_index}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"minion@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${instance} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${instance} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"GetCerts"}],"description":"","message_list":[],"uuid":"b1edafbd-6625-4377-96a3-374d256c2af8","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"c1566b3d_dag","uuid":"1570df20-64fd-400b-ab81-7b72edfd5203"},"name":"9a6e189b_runbook"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"},"retries":"0","description":"","type":"DAG","uuid":"c8708f56-a2f1-49fb-b8e8-3226448e0c8c","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"1527b81f-7e8a-419a-b44f-67dc71bfa666"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"abd3357c_dag"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","description":"","type":"EXEC","uuid":"1527b81f-7e8a-419a-b44f-67dc71bfa666","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain 'minion@@{calm_array_index}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node 'minion@@{calm_array_index}@@'\""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Remove Node"}],"description":"","message_list":[],"uuid":"de124173-a951-49b3-aaa6-455bb1f0c1d7","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"abd3357c_dag","uuid":"c8708f56-a2f1-49fb-b8e8-3226448e0c8c"},"name":"3cb17acf_runbook"}},"variable_list":[],"name":"AHV_Centos_K8SM_Package"},{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"013484e3-82e9-4004-9f76-f9b4f6a574a6","name":"action_install","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_CENTOS_76","uuid":"7861473c-3123-4a72-bf45-329a774d3fd6"},"retries":"0","description":"","type":"DAG","uuid":"a93295d4-76a3-4ce2-88c2-20f8e79ec906","child_tasks_local_reference_list":[{"kind":"app_task","name":"Image Fetch task for VM","uuid":"c88f62d3-15d5-4b31-91f0-4bfab485f0bc"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_0716f35c_8078_4d72_9805_ae2e239afab5"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_CENTOS_76","uuid":"7861473c-3123-4a72-bf45-329a774d3fd6"},"retries":"0","description":"","type":"SUBSTRATE_IMAGE_FETCH","uuid":"c88f62d3-15d5-4b31-91f0-4bfab485f0bc","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"","name":"CentOS-7-x86_64-1810","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-1810.qcow2","version":{"product_version":"","type":"","product_name":""},"architecture":"X86_64","type":""},"description":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Image Fetch task for VM"}],"description":"","message_list":[],"uuid":"6a44ff20-ebce-4764-848d-db34b3af1a36","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_0716f35c_8078_4d72_9805_ae2e239afab5","uuid":"a93295d4-76a3-4ce2-88c2-20f8e79ec906"},"name":"SYS_GEN__Runbook_Package_0716f35c_8078_4d72_9805_ae2e239afab5"}},{"description":"System action for creating an application","message_list":[],"uuid":"81ace190-4c61-4334-9c14-e5e3aad97562","name":"action_create","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_CENTOS_76","uuid":"7861473c-3123-4a72-bf45-329a774d3fd6"},"retries":"0","description":"","type":"DAG","uuid":"7828eddd-3061-43bb-892d-a76febf0c0bd","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_0716f35c_8078_4d72_9805_ae2e239afab5","uuid":"e0215261-6587-4b28-b17f-bcef5513740b"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_0716f35c_8078_4d72_9805_ae2e239afab5"},{"target_any_local_reference":{"kind":"app_package","name":"AHV_CENTOS_76","uuid":"7861473c-3123-4a72-bf45-329a774d3fd6"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"e0215261-6587-4b28-b17f-bcef5513740b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_0716f35c_8078_4d72_9805_ae2e239afab5","uuid":"6a44ff20-ebce-4764-848d-db34b3af1a36"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_0716f35c_8078_4d72_9805_ae2e239afab5"}],"description":"","message_list":[],"uuid":"2b581e32-fc5b-40ba-bd54-87200fe852cc","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_0716f35c_8078_4d72_9805_ae2e239afab5","uuid":"7828eddd-3061-43bb-892d-a76febf0c0bd"},"name":"SYS_GEN__Runbook_Package_0716f35c_8078_4d72_9805_ae2e239afab5"}},{"description":"System action for starting an application","message_list":[],"uuid":"3401ca4b-ebed-4b7d-acec-652317ee668d","name":"action_start","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_CENTOS_76","uuid":"7861473c-3123-4a72-bf45-329a774d3fd6"},"retries":"0","description":"","type":"DAG","uuid":"b6e5e6a4-bfa6-475c-b5e4-3fca0f2520f5","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_0716f35c_8078_4d72_9805_ae2e239afab5"}],"description":"","message_list":[],"uuid":"681787cd-83b4-49bc-9e0e-88f7e7c69a53","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_0716f35c_8078_4d72_9805_ae2e239afab5","uuid":"b6e5e6a4-bfa6-475c-b5e4-3fca0f2520f5"},"name":"SYS_GEN__Runbook_Package_0716f35c_8078_4d72_9805_ae2e239afab5"}},{"description":"System action for restarting an application","message_list":[],"uuid":"173088b4-7db1-49e4-bb50-79af46a386bb","name":"action_restart","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_CENTOS_76","uuid":"7861473c-3123-4a72-bf45-329a774d3fd6"},"retries":"0","description":"","type":"DAG","uuid":"1c1c9050-d325-42a9-bba0-3ba3f5dcaadf","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_0716f35c_8078_4d72_9805_ae2e239afab5"}],"description":"","message_list":[],"uuid":"14799541-b5a5-4769-99f4-a9e99b50530f","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_0716f35c_8078_4d72_9805_ae2e239afab5","uuid":"1c1c9050-d325-42a9-bba0-3ba3f5dcaadf"},"name":"SYS_GEN__Runbook_Package_0716f35c_8078_4d72_9805_ae2e239afab5"}},{"description":"System action for stopping an application","message_list":[],"uuid":"14256377-db7c-49a8-90d5-4b005db1eb1c","name":"action_stop","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_CENTOS_76","uuid":"7861473c-3123-4a72-bf45-329a774d3fd6"},"retries":"0","description":"","type":"DAG","uuid":"2bf9b333-924d-47c4-8587-d95852c22972","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_0716f35c_8078_4d72_9805_ae2e239afab5"}],"description":"","message_list":[],"uuid":"d276ca99-193a-4ab4-8413-8d37c2ab0c0a","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_0716f35c_8078_4d72_9805_ae2e239afab5","uuid":"2bf9b333-924d-47c4-8587-d95852c22972"},"name":"SYS_GEN__Runbook_Package_0716f35c_8078_4d72_9805_ae2e239afab5"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"8d47cc12-2b49-4d80-99d5-66d4398fae60","name":"action_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_CENTOS_76","uuid":"7861473c-3123-4a72-bf45-329a774d3fd6"},"retries":"0","description":"","type":"DAG","uuid":"cec62da2-d96d-451c-a89e-6e5cf1a85bb6","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_0716f35c_8078_4d72_9805_ae2e239afab5"}],"description":"","message_list":[],"uuid":"c36cc7ba-9465-4c15-95b2-f7d0f04d9313","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_0716f35c_8078_4d72_9805_ae2e239afab5","uuid":"cec62da2-d96d-451c-a89e-6e5cf1a85bb6"},"name":"SYS_GEN__Runbook_Package_0716f35c_8078_4d72_9805_ae2e239afab5"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"95254a2e-e092-44af-be1e-3eec27f17020","name":"action_soft_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_CENTOS_76","uuid":"7861473c-3123-4a72-bf45-329a774d3fd6"},"retries":"0","description":"","type":"DAG","uuid":"f38643ee-43fe-4082-bf94-7822ebf429d3","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_0716f35c_8078_4d72_9805_ae2e239afab5"}],"description":"","message_list":[],"uuid":"d8da1c3b-2c64-4376-8941-3ccc512b72d2","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_0716f35c_8078_4d72_9805_ae2e239afab5","uuid":"f38643ee-43fe-4082-bf94-7822ebf429d3"},"name":"SYS_GEN__Runbook_Package_0716f35c_8078_4d72_9805_ae2e239afab5"}}],"message_list":[],"service_local_reference_list":[],"uuid":"7861473c-3123-4a72-bf45-329a774d3fd6","state":"ACTIVE","version":"","editables":{},"type":"SUBSTRATE_IMAGE","options":{"type":"","name":"CentOS-7-x86_64-1810","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-1810.qcow2","version":{"product_version":"","type":"","product_name":""},"architecture":"X86_64","type":""},"description":""},"variable_list":[],"name":"AHV_CENTOS_76"},{"description":"","action_list":[{"description":"System action for installing an application","message_list":[],"uuid":"c2c61f45-94ca-442b-a39d-9052ef2fd7d7","name":"action_install","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"ESX_CENTOS_76","uuid":"40192df2-d29d-4b46-b0ec-c05ffecc3d5a"},"retries":"0","description":"","type":"DAG","uuid":"9032dc88-1b4f-4f87-b616-5f65adb586f9","child_tasks_local_reference_list":[{"kind":"app_task","name":"Image Fetch task for VM","uuid":"038c762e-104a-43eb-b02f-91c6e898aed4"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__DAG_Package_aea088d7_ea75_e078_2d13_537036b0e89f"},{"target_any_local_reference":{"kind":"app_package","name":"ESX_CENTOS_76","uuid":"40192df2-d29d-4b46-b0ec-c05ffecc3d5a"},"retries":"0","description":"","type":"SUBSTRATE_IMAGE_FETCH","uuid":"038c762e-104a-43eb-b02f-91c6e898aed4","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"type":"","name":"CENTOS_76","resources":{"image_type":"DISK_IMAGE","checksum":{},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-1810.ova","version":{},"architecture":"X86_64","type":""},"description":""},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"Image Fetch task for VM"}],"description":"","message_list":[],"uuid":"12fdfd19-c981-48a4-ae67-e8ee6bb6a736","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__DAG_Package_aea088d7_ea75_e078_2d13_537036b0e89f","uuid":"9032dc88-1b4f-4f87-b616-5f65adb586f9"},"name":"SYS_GEN__Runbook_Package_aea088d7_ea75_e078_2d13_537036b0e89f"}},{"description":"System action for creating an application","message_list":[],"uuid":"ce2c2a93-311e-4efe-ae74-8b2f8c307b3e","name":"action_create","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"ESX_CENTOS_76","uuid":"40192df2-d29d-4b46-b0ec-c05ffecc3d5a"},"retries":"0","description":"","type":"DAG","uuid":"5ded69e0-f05b-4a50-886f-ed458fb56d0e","child_tasks_local_reference_list":[{"kind":"app_task","name":"SYS_GEN__install_CRb_Package_aea088d7_ea75_e078_2d13_537036b0e89f","uuid":"97e41c88-cfd4-487d-abeb-08e474de9e52"}],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_aea088d7_ea75_e078_2d13_537036b0e89f"},{"target_any_local_reference":{"kind":"app_package","name":"ESX_CENTOS_76","uuid":"40192df2-d29d-4b46-b0ec-c05ffecc3d5a"},"retries":"0","description":"","type":"CALL_RUNBOOK","uuid":"97e41c88-cfd4-487d-abeb-08e474de9e52","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"inarg_list":[],"type":"CALL_RUNBOOK","runbook_reference":{"kind":"app_runbook","name":"SYS_GEN__Runbook_Package_aea088d7_ea75_e078_2d13_537036b0e89f","uuid":"12fdfd19-c981-48a4-ae67-e8ee6bb6a736"}},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__install_CRb_Package_aea088d7_ea75_e078_2d13_537036b0e89f"}],"description":"","message_list":[],"uuid":"8284c62a-f33e-41a5-864f-e4b342708aad","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_aea088d7_ea75_e078_2d13_537036b0e89f","uuid":"5ded69e0-f05b-4a50-886f-ed458fb56d0e"},"name":"SYS_GEN__Runbook_Package_aea088d7_ea75_e078_2d13_537036b0e89f"}},{"description":"System action for starting an application","message_list":[],"uuid":"548ae26c-f0e3-4cca-b3d6-cd467286e3ea","name":"action_start","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"ESX_CENTOS_76","uuid":"40192df2-d29d-4b46-b0ec-c05ffecc3d5a"},"retries":"0","description":"","type":"DAG","uuid":"696b2476-faec-40aa-a953-f061e1d2cba1","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_aea088d7_ea75_e078_2d13_537036b0e89f"}],"description":"","message_list":[],"uuid":"9b1d95eb-21a3-4c64-a645-ec46c54252c6","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_aea088d7_ea75_e078_2d13_537036b0e89f","uuid":"696b2476-faec-40aa-a953-f061e1d2cba1"},"name":"SYS_GEN__Runbook_Package_aea088d7_ea75_e078_2d13_537036b0e89f"}},{"description":"System action for restarting an application","message_list":[],"uuid":"f8c22908-5155-4a58-ab4d-b7ada6c28155","name":"action_restart","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"ESX_CENTOS_76","uuid":"40192df2-d29d-4b46-b0ec-c05ffecc3d5a"},"retries":"0","description":"","type":"DAG","uuid":"6e213e7f-90b4-4ce9-b21c-67a42bbe8a1b","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_aea088d7_ea75_e078_2d13_537036b0e89f"}],"description":"","message_list":[],"uuid":"0c242161-920a-4352-b2a2-4dcfd079b3b0","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_aea088d7_ea75_e078_2d13_537036b0e89f","uuid":"6e213e7f-90b4-4ce9-b21c-67a42bbe8a1b"},"name":"SYS_GEN__Runbook_Package_aea088d7_ea75_e078_2d13_537036b0e89f"}},{"description":"System action for stopping an application","message_list":[],"uuid":"27092bb7-fdb2-4d13-a0f0-88dcf292e898","name":"action_stop","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"ESX_CENTOS_76","uuid":"40192df2-d29d-4b46-b0ec-c05ffecc3d5a"},"retries":"0","description":"","type":"DAG","uuid":"02e2de88-5326-44e5-a46f-849e633d3c19","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_aea088d7_ea75_e078_2d13_537036b0e89f"}],"description":"","message_list":[],"uuid":"1761f03c-19b0-46f9-ab09-925c83a9723c","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_aea088d7_ea75_e078_2d13_537036b0e89f","uuid":"02e2de88-5326-44e5-a46f-849e633d3c19"},"name":"SYS_GEN__Runbook_Package_aea088d7_ea75_e078_2d13_537036b0e89f"}},{"description":"System action for deleting an application. Deletes created VMs as well","message_list":[],"uuid":"3afff8ee-cf67-482d-bd6f-c80c7f6ab3b4","name":"action_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"ESX_CENTOS_76","uuid":"40192df2-d29d-4b46-b0ec-c05ffecc3d5a"},"retries":"0","description":"","type":"DAG","uuid":"9dcf3d52-fb98-4279-b1b7-9cbaa1745ef2","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_aea088d7_ea75_e078_2d13_537036b0e89f"}],"description":"","message_list":[],"uuid":"6a478dce-be78-465e-8f0b-d1dca05d8d59","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_aea088d7_ea75_e078_2d13_537036b0e89f","uuid":"9dcf3d52-fb98-4279-b1b7-9cbaa1745ef2"},"name":"SYS_GEN__Runbook_Package_aea088d7_ea75_e078_2d13_537036b0e89f"}},{"description":"System action for deleting an application. Does not delete created VMs","message_list":[],"uuid":"1c6b5996-47e8-42ed-b125-5bfe15e07307","name":"action_soft_delete","state":"ACTIVE","critical":false,"attrs":{},"type":"system","runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"ESX_CENTOS_76","uuid":"40192df2-d29d-4b46-b0ec-c05ffecc3d5a"},"retries":"0","description":"","type":"DAG","uuid":"2215f035-a2b3-48d3-9c38-ceb7bd7cbd2c","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":"DAG"},"timeout_secs":"0","message_list":[],"variable_list":[],"name":"SYS_GEN__Composite_DAG_Package_aea088d7_ea75_e078_2d13_537036b0e89f"}],"description":"","message_list":[],"uuid":"1111dcd4-3dbc-46be-8388-ee85e36751e1","state":"ACTIVE","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"SYS_GEN__Composite_DAG_Package_aea088d7_ea75_e078_2d13_537036b0e89f","uuid":"2215f035-a2b3-48d3-9c38-ceb7bd7cbd2c"},"name":"SYS_GEN__Runbook_Package_aea088d7_ea75_e078_2d13_537036b0e89f"}}],"message_list":[],"service_local_reference_list":[],"uuid":"40192df2-d29d-4b46-b0ec-c05ffecc3d5a","state":"ACTIVE","version":"","editables":{},"type":"SUBSTRATE_IMAGE","options":{"type":"","name":"CENTOS_76","resources":{"image_type":"DISK_IMAGE","checksum":{},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-1810.ova","version":{},"architecture":"X86_64","type":""},"description":""},"variable_list":[],"name":"ESX_CENTOS_76"}]},"name":"Kubernetes_temp"},"spec":{"name":"Kubernetes_temp","resources":{"service_definition_list":[{"singleton":false,"name":"Kubernetes_Master","action_list":[{"description":"System action for creating an application","name":"action_create","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"a6884701-5550-48f4-9496-c3d2271862cf","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"0a1f89bb-e4b9-4b3b-b3d2-9bd00ca65b6c","child_tasks_local_reference_list":[{"kind":"app_task","name":"Dashboard","uuid":"80177559-713f-477e-aaf9-dcb3af1c04eb"},{"kind":"app_task","name":"HELM","uuid":"0a1e1ea1-e796-42c9-9a31-8e988a40bb09"},{"kind":"app_task","name":"Heapster","uuid":"061fa633-494f-4134-aa20-9c59399ab12e"}],"attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Dashboard","uuid":"80177559-713f-477e-aaf9-dcb3af1c04eb"},"edge_type":"user_defined","type":"","uuid":"0ce4edc2-0e12-45a1-b28b-f5a56601b8d7","to_task_reference":{"kind":"app_task","name":"HELM","uuid":"0a1e1ea1-e796-42c9-9a31-8e988a40bb09"}},{"from_task_reference":{"kind":"app_task","name":"HELM","uuid":"0a1e1ea1-e796-42c9-9a31-8e988a40bb09"},"edge_type":"user_defined","type":"","uuid":"935e34c1-a8c8-4b30-8746-cfecab3b72ea","to_task_reference":{"kind":"app_task","name":"Heapster","uuid":"061fa633-494f-4134-aa20-9c59399ab12e"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"f33eac3f_dag"},{"target_any_local_reference":{"kind":"app_service","uuid":"a6884701-5550-48f4-9496-c3d2271862cf","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"80177559-713f-477e-aaf9-dcb3af1c04eb","child_tasks_local_reference_list":[],"attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/dashboard\necho '# Copyright 2015 Google Inc. All Rights Reserved.\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#     http:\/\/www.apache.org\/licenses\/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\n# Configuration to deploy release version of the Dashboard UI compatible with\n# Kubernetes 1.7.\n#\n# Example usage: kubectl create -f <this_file>\n\n# ------------------- Dashboard Secret ------------------- #\n\napiVersion: v1\nkind: Secret\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard-certs\n  namespace: kube-system\ntype: Opaque\n\n---\n# ------------------- Dashboard Service Account ------------------- #\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\n\n---\n# ------------------- Dashboard Role & Role Binding ------------------- #\n\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: kubernetes-full-access\n  namespace: kube-system\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: kubernetes-dashboard\n  namespace: kube-system\n\n---\n# ------------------- Dashboard Deployment ------------------- #\n\nkind: Deployment\napiVersion: apps\/v1beta2\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\nspec:\n  replicas: 1\n  revisionHistoryLimit: 10\n  selector:\n    matchLabels:\n      k8s-app: kubernetes-dashboard\n  template:\n    metadata:\n      labels:\n        k8s-app: kubernetes-dashboard\n    spec:\n      containers:\n      - name: kubernetes-dashboard\n        image: k8s.gcr.io\/kubernetes-dashboard-amd64:v1.8.3\n        ports:\n        - containerPort: 8443\n          protocol: TCP\n        args:\n          - --auto-generate-certificates\n          # Uncomment the following line to manually specify Kubernetes API server Host\n          # If not specified, Dashboard will attempt to auto discover the API server and connect\n          # to it. Uncomment only if the default does not work.\n          # - --apiserver-host=http:\/\/my-address:port\n        volumeMounts:\n        - name: kubernetes-dashboard-certs\n          mountPath: \/certs\n          # Create on-disk volume to store exec logs\n        - mountPath: \/tmp\n          name: tmp-volume\n        livenessProbe:\n          httpGet:\n            scheme: HTTPS\n            path: \/\n            port: 8443\n          initialDelaySeconds: 30\n          timeoutSeconds: 30\n      volumes:\n      - name: kubernetes-dashboard-certs\n        secret:\n          secretName: kubernetes-dashboard-certs\n      - name: tmp-volume\n        emptyDir: {}\n      serviceAccountName: kubernetes-dashboard\n      # Comment the following tolerations if Dashboard must not be deployed on master\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        effect: NoSchedule\n\n---\n# ------------------- Dashboard Service ------------------- #\n\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kube-system\nspec:\n  type: NodePort\n  ports:\n    - port: 8443\n      nodePort: 30443\n  selector:\n    k8s-app: kubernetes-dashboard' | sudo tee \/etc\/kubernetes\/addons\/dashboard\/kubernetes-dashboard.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/dashboard\/kubernetes-dashboard.yaml\n"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Dashboard"},{"target_any_local_reference":{"kind":"app_service","uuid":"a6884701-5550-48f4-9496-c3d2271862cf","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"0a1e1ea1-e796-42c9-9a31-8e988a40bb09","child_tasks_local_reference_list":[],"attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir \/etc\/kubernetes\/addons\/helm\necho \"#helm init --service-account helm\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: helm\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: helm\n  namespace: kube-system\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: helm\n  namespace: kube-system\" | sudo tee \/etc\/kubernetes\/addons\/helm\/helm.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/helm\/helm.yaml\nhelm init --service-account helm\n"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"HELM"},{"target_any_local_reference":{"kind":"app_service","uuid":"a6884701-5550-48f4-9496-c3d2271862cf","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"061fa633-494f-4134-aa20-9c59399ab12e","child_tasks_local_reference_list":[],"attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nsudo mkdir \/etc\/kubernetes\/addons\/heapster\nkubectl delete ClusterRole system:heapster -n kube-system\n\necho 'apiVersion: rbac.authorization.k8s.io\/v1\nkind: ClusterRole\nmetadata:\n  name: system:heapster\n  namespace: kube-system\nrules:\n- apiGroups:\n  - \"\"\n  resources:\n  - events\n  - namespaces\n  - nodes\n  - pods\n  verbs:\n  - get\n  - list\n  - watch\n- apiGroups:\n  - \"\"\n  resources:\n  - nodes\/stats\n  verbs:\n  - get\n- apiGroups:\n  - extensions\n  resources:\n  - deployments\n  verbs:\n  - get\n  - list\n  - watch\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: heapster\n  namespace: kube-system\n  labels:\n    k8s-app: heapster\n    module: apiserver\n    version: v6\nspec:\n  selector:\n    matchLabels:\n      k8s-app: heapster\n      module: apiserver\n      version: v6\n  template:\n    metadata:\n      name: heapster\n      labels:\n        k8s-app: heapster\n        module: apiserver\n        version: v6\n    spec:\n      serviceAccountName: heapster\n      containers:\n      - name: heapster\n        image: k8s.gcr.io\/heapster-amd64:v1.5.3\n        command:\n        - \/heapster\n        - --source=kubernetes.summary_api:\"\"?useServiceAccount=true&kubeletHttps=true&kubeletPort=10250&insecure=true\n        ports:\n        - containerPort: 6443\n          name: https\n        - containerPort: 8080\n          name: http\n        volumeMounts:\n        - name: ssl-certs\n          mountPath: \/etc\/ssl\/certs\n          readOnly: true\n      volumes:\n      - name: ssl-certs\n        hostPath:\n          path: \/etc\/ssl\/certs\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: heapster\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n---\nkind: Service\napiVersion: v1\nmetadata:\n  name: heapster\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    kubernetes.io\/name: \"Heapster\"\n    k8s-app: heapster\nspec:\n  ports:\n    - port: 80\n      targetPort: 8082\n  selector:\n    k8s-app: heapster\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: heapster\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: cluster-admin\nsubjects:\n- kind: ServiceAccount\n  name: heapster\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/heapster\/heapster.yaml\n  \nkubectl create -f \/etc\/kubernetes\/addons\/heapster\/heapster.yaml"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Heapster"}],"description":"","uuid":"36b81be1-9b70-44f2-ac4f-e5e42e86d24d","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"f33eac3f_dag","uuid":"0a1f89bb-e4b9-4b3b-b3d2-9bd00ca65b6c"},"name":"a9639da1_runbook"},"type":"system","uuid":"8a9b5e05-8367-44e0-8f3d-4a3302858e84"},{"description":"System action for deleting an application. Deletes created VMs as well","name":"action_delete","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"a6884701-5550-48f4-9496-c3d2271862cf","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"562fa0af-4de4-4dbb-9747-b85dbc7cc052","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"62a92d34_dag"}],"description":"","uuid":"85f228cd-f200-4441-9bc8-4e7603c42c02","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"62a92d34_dag","uuid":"562fa0af-4de4-4dbb-9747-b85dbc7cc052"},"name":"8c4aa276_runbook"},"type":"system","uuid":"7f927285-aae0-434c-af5e-545af719c7fb"},{"description":"System action for starting an application","name":"action_start","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"a6884701-5550-48f4-9496-c3d2271862cf","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"edca597f-ac1c-4757-8577-f468212b3c52","child_tasks_local_reference_list":[{"kind":"app_task","name":"Start","uuid":"700fce46-e79f-4755-8c65-998de1d91400"}],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"334b4484_dag"},{"target_any_local_reference":{"kind":"app_service","uuid":"a6884701-5550-48f4-9496-c3d2271862cf","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"700fce46-e79f-4755-8c65-998de1d91400","child_tasks_local_reference_list":[],"attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\nsudo systemctl start etcd docker kubelet\nsudo systemctl enable etcd docker kubelet\n"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Start"}],"description":"","uuid":"794616f8-d231-4aae-af7d-7fd616f436d6","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"334b4484_dag","uuid":"edca597f-ac1c-4757-8577-f468212b3c52"},"name":"daee30ae_runbook"},"type":"system","uuid":"56f4ab29-8474-4a4e-a582-31796b54c15c"},{"description":"System action for stopping an application","name":"action_stop","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"a6884701-5550-48f4-9496-c3d2271862cf","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"5af4c38b-1c89-4650-b8d2-f1647967761a","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"9713c3d0_dag"}],"description":"","uuid":"771f76f2-789f-491b-addb-d55d2828070c","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"9713c3d0_dag","uuid":"5af4c38b-1c89-4650-b8d2-f1647967761a"},"name":"6407a345_runbook"},"type":"system","uuid":"ac2503ef-57c8-4356-9e66-b20adabd5b45"},{"description":"System action for restarting an application","name":"action_restart","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"a6884701-5550-48f4-9496-c3d2271862cf","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"ffd4f6e1-15c7-4696-83f8-ed9b3c692d63","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"414912df_dag"}],"description":"","uuid":"f0ee4c38-2566-4ac8-a103-898e3321c63e","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"414912df_dag","uuid":"ffd4f6e1-15c7-4696-83f8-ed9b3c692d63"},"name":"d5c8316f_runbook"},"type":"system","uuid":"35583c38-f460-4271-b925-c993528cf482"}],"description":"","uuid":"a6884701-5550-48f4-9496-c3d2271862cf","port_list":[],"tier":"","variable_list":[{"val_type":"STRING","description":"","uuid":"5adc0c69-7b62-4117-bea8-ab7d5105eb6c","value":"@@{KUBE_VERSION}@@","label":"","attrs":{"type":""},"type":"LOCAL","name":"VERSION"}],"depends_on_list":[]},{"singleton":false,"name":"Kubernetes_Minion","action_list":[{"description":"System action for creating an application","name":"action_create","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354","name":"Kubernetes_Minion"},"retries":"0","description":"","uuid":"e96f34a2-dc2d-45ef-9796-9f0696de88e1","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"4af7c45f_dag"}],"description":"","uuid":"60e21428-ac74-4abe-b320-037ba471fa8a","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"4af7c45f_dag","uuid":"e96f34a2-dc2d-45ef-9796-9f0696de88e1"},"name":"7c6e4932_runbook"},"type":"system","uuid":"007c97ef-4660-40dd-861b-c0aa2afbfb82"},{"description":"System action for deleting an application. Deletes created VMs as well","name":"action_delete","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354","name":"Kubernetes_Minion"},"retries":"0","description":"","uuid":"0e446c7b-adfe-4f7a-8fc5-65e77c56e70c","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"1e2c50bb_dag"}],"description":"","uuid":"f85195a9-d884-4e50-8289-d75bab4a4905","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"1e2c50bb_dag","uuid":"0e446c7b-adfe-4f7a-8fc5-65e77c56e70c"},"name":"1d794193_runbook"},"type":"system","uuid":"d520126d-f52e-4d69-a060-9c79608eab97"},{"description":"System action for starting an application","name":"action_start","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354","name":"Kubernetes_Minion"},"retries":"0","description":"","uuid":"c5eb4a5f-82b0-4e37-ac16-45788670258e","child_tasks_local_reference_list":[{"kind":"app_task","name":"Start","uuid":"f7d50bef-9035-4bc2-ad18-37aeace1630a"}],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"970128c7_dag"},{"target_any_local_reference":{"kind":"app_service","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354","name":"Kubernetes_Minion"},"retries":"0","description":"","uuid":"f7d50bef-9035-4bc2-ad18-37aeace1630a","child_tasks_local_reference_list":[],"attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nsudo systemctl start docker kubelet\nsudo systemctl enable docker kubelet"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Start"}],"description":"","uuid":"cd012624-ef9b-48e9-9ab2-62a0fb5731e3","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"970128c7_dag","uuid":"c5eb4a5f-82b0-4e37-ac16-45788670258e"},"name":"884352cf_runbook"},"type":"system","uuid":"5da7a8b6-9616-4680-b825-ba26951071f6"},{"description":"System action for stopping an application","name":"action_stop","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354","name":"Kubernetes_Minion"},"retries":"0","description":"","uuid":"f2f3f905-13ed-4133-b5c3-04ec5f6ec827","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"6c01dc28_dag"}],"description":"","uuid":"12f2e944-b309-4629-a81b-5dc93622becc","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"6c01dc28_dag","uuid":"f2f3f905-13ed-4133-b5c3-04ec5f6ec827"},"name":"0cb172a7_runbook"},"type":"system","uuid":"2c2b11d6-3cf0-4f22-9b7b-1720caf66f80"},{"description":"System action for restarting an application","name":"action_restart","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354","name":"Kubernetes_Minion"},"retries":"0","description":"","uuid":"e787f548-aa17-410d-8b97-188f6fb2a8c0","child_tasks_local_reference_list":[],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"1d66b5be_dag"}],"description":"","uuid":"7ec57533-22f0-4437-a50a-5c62a08fe445","variable_list":[],"main_task_local_reference":{"kind":"app_task","name":"1d66b5be_dag","uuid":"e787f548-aa17-410d-8b97-188f6fb2a8c0"},"name":"3a6f587d_runbook"},"type":"system","uuid":"b9a8f5ab-6a31-4bad-8f56-89f3f45006b9"}],"description":"","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354","port_list":[],"tier":"","variable_list":[{"val_type":"STRING","description":"","uuid":"3ee501df-a692-4ea9-9709-ebe7f0bbfb9e","value":"@@{KUBE_VERSION}@@","label":"","attrs":{"type":""},"type":"LOCAL","name":"VERSION"}],"depends_on_list":[]}],"substrate_definition_list":[{"name":"AHV_Centos_K8SC","action_list":[],"uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"0","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS","uuid":"abeffc51-2124-413f-a3db-ded3c10ad1f2"}},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"name":true,"resources":{"nic_list":{"0":{"subnet_reference":true}},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"guest_customization":true,"disk_list":{"1":{"disk_size_mib":true},"3":{"disk_size_mib":true},"2":{"disk_size_mib":true},"5":{"disk_size_mib":true},"4":{"disk_size_mib":true},"6":{"disk_size_mib":true}}}}},"os_type":"Linux","type":"AHV_VM","create_spec":{"name":"K8SC-@@{calm_array_index}@@-@@{calm_time}@@","categories":"","availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"resources":{"nic_list":[{"nic_type":"NORMAL_NIC","network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"4ad0b85f-6a89-459b-a62f-73eb0e88bb1a"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":2,"gpu_list":[],"memory_size_mib":2048,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"efc034e3-b50e-4a48-b02d-25036aeb8bd3","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CENTOS_74","uuid":"7861473c-3123-4a72-bf45-329a774d3fd6"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":1,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":2,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":3,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":4,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":5,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":6,"adapter_type":"SCSI"},"device_type":"DISK"}}]}},"variable_list":[],"description":""},{"name":"AHV_Centos_K8SM","action_list":[],"uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b","readiness_probe":{"connection_type":"SSH","retries":"5","disable_readiness_probe":false,"address":"@@{platform.status.resources.nic_list[0].ip_endpoint_list[0].ip}@@","delay_secs":"0","connection_port":22,"login_credential_local_reference":{"kind":"app_credential","name":"CENTOS","uuid":"abeffc51-2124-413f-a3db-ded3c10ad1f2"}},"editables":{"readiness_probe":{"connection_type":true,"retries":true,"delay_secs":true,"connection_port":true,"timeout_secs":true},"create_spec":{"name":true,"resources":{"nic_list":{"0":{"subnet_reference":true}},"serial_port_list":{},"num_vcpus_per_socket":true,"num_sockets":true,"memory_size_mib":true,"guest_customization":true,"disk_list":{"1":{"disk_size_mib":true},"3":{"disk_size_mib":true},"2":{"disk_size_mib":true}}}}},"os_type":"Linux","type":"AHV_VM","create_spec":{"name":"K8SM-@@{calm_array_index}@@-@@{calm_time}@@","categories":"","availability_zone_reference":null,"backup_policy":null,"type":"","cluster_reference":null,"resources":{"nic_list":[{"nic_type":"NORMAL_NIC","ip_endpoint_list":[],"network_function_chain_reference":null,"network_function_nic_type":"INGRESS","mac_address":"","subnet_reference":{"kind":"subnet","type":"","name":"","uuid":"4ad0b85f-6a89-459b-a62f-73eb0e88bb1a"},"type":""}],"serial_port_list":[],"guest_tools":null,"num_vcpus_per_socket":1,"num_sockets":4,"gpu_list":[],"memory_size_mib":2048,"parent_reference":null,"hardware_clock_timezone":"","guest_customization":{"cloud_init":{"meta_data":"","type":"","user_data":"#cloud-config\nusers:\n  - name: centos\n    ssh-authorized-keys:\n      - @@{CENTOS.public_key}@@\n    sudo: ['ALL=(ALL) NOPASSWD:ALL']"},"type":"","sysprep":null},"power_state":"ON","type":"","account_uuid":"efc034e3-b50e-4a48-b02d-25036aeb8bd3","boot_config":{"boot_device":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"}},"type":"","mac_address":""},"disk_list":[{"data_source_reference":{"kind":"app_package","type":"","name":"CENTOS_74","uuid":"7861473c-3123-4a72-bf45-329a774d3fd6"},"type":"","disk_size_mib":0,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":0,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":1,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":2,"adapter_type":"SCSI"},"device_type":"DISK"}},{"data_source_reference":null,"type":"","disk_size_mib":10240,"volume_group_reference":null,"device_properties":{"type":"","disk_address":{"type":"","device_index":3,"adapter_type":"SCSI"},"device_type":"DISK"}}]}},"variable_list":[],"description":""}],"credential_definition_list":[{"username":"centos","description":"","uuid":"abeffc51-2124-413f-a3db-ded3c10ad1f2","secret":{"attrs":{"is_secret_modified":false,"secret_reference":{"uuid":"dd0f664e-8964-498b-a46d-696554343055"}}},"editables":{"username":true,"secret":true},"type":"KEY","name":"CENTOS"}],"type":"USER","app_profile_list":[{"deployment_create_list":[{"max_replicas":"3","action_list":[],"package_local_reference_list":[{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"}],"description":"","uuid":"9729fa9d-0439-4ef1-b68a-b100ee3536a1","min_replicas":"3","editables":{"min_replicas":true,"max_replicas":true},"substrate_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SC","uuid":"31a7bf2f-f905-47b8-b5a5-c69408417ec0"},"type":"GREENFIELD","variable_list":[],"name":"2cbb2f6a_deployment"},{"max_replicas":"9","action_list":[],"package_local_reference_list":[{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"}],"description":"","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2","min_replicas":"2","editables":{"min_replicas":true,"max_replicas":true},"substrate_local_reference":{"kind":"app_substrate","name":"AHV_Centos_K8SM","uuid":"eed35f1a-0b8e-48c6-8b4c-d0e75b200e1b"},"type":"GREENFIELD","variable_list":[],"name":"39cf7283_deployment"}],"description":"","action_list":[{"description":"","name":"Upgrade","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"4271eb31-c16e-4d3d-a377-b1d1eabeb4c1","child_tasks_local_reference_list":[{"kind":"app_task","name":"Set Version Master","uuid":"a34ca171-1719-49fd-809c-e1fe984e770c"},{"kind":"app_task","name":"Set Version Minion","uuid":"8436b7c6-fcbf-410d-b66f-6387729cb0c9"},{"kind":"app_task","name":"Upgrade Master","uuid":"513f7163-cf86-4ec0-a71c-4f40a98c0f17"},{"kind":"app_task","name":"Upgrade Minion","uuid":"7ff0837f-e2b6-4077-87d9-4cf12062a605"},{"kind":"app_task","name":"RestartServices","uuid":"32e4f097-3b2e-493f-9034-8dcd2ec18fb1"}],"attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"a34ca171-1719-49fd-809c-e1fe984e770c"},"edge_type":"user_defined","type":"","uuid":"2b1aed5d-74d7-47dd-a6d7-9465f96e136f","to_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"513f7163-cf86-4ec0-a71c-4f40a98c0f17"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Master","uuid":"513f7163-cf86-4ec0-a71c-4f40a98c0f17"},"edge_type":"user_defined","type":"","uuid":"741d3c71-714f-431d-bf40-b36077c16b2a","to_task_reference":{"kind":"app_task","name":"RestartServices","uuid":"32e4f097-3b2e-493f-9034-8dcd2ec18fb1"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Master","uuid":"a34ca171-1719-49fd-809c-e1fe984e770c"},"edge_type":"user_defined","type":"","uuid":"9f92ce8c-edef-4b46-a105-08f5fe996561","to_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"8436b7c6-fcbf-410d-b66f-6387729cb0c9"}},{"from_task_reference":{"kind":"app_task","name":"Set Version Minion","uuid":"8436b7c6-fcbf-410d-b66f-6387729cb0c9"},"edge_type":"user_defined","type":"","uuid":"c79e2adc-8b70-4d94-a7db-272713890ee1","to_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"7ff0837f-e2b6-4077-87d9-4cf12062a605"}},{"from_task_reference":{"kind":"app_task","name":"Upgrade Minion","uuid":"7ff0837f-e2b6-4077-87d9-4cf12062a605"},"edge_type":"user_defined","type":"","uuid":"c85f10b1-c506-4656-86f1-049b37eab22b","to_task_reference":{"kind":"app_task","name":"RestartServices","uuid":"32e4f097-3b2e-493f-9034-8dcd2ec18fb1"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"6ee65d8a_dag"},{"target_any_local_reference":{"kind":"app_service","uuid":"a6884701-5550-48f4-9496-c3d2271862cf","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"a34ca171-1719-49fd-809c-e1fe984e770c","child_tasks_local_reference_list":[],"attrs":{"exit_status":[],"script":"if \"@@{calm_array_index}@@\" == \"0\":\n\tprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[],"name":"Set Version Master"},{"target_any_local_reference":{"kind":"app_service","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354","name":"Kubernetes_Minion"},"retries":"0","description":"","uuid":"8436b7c6-fcbf-410d-b66f-6387729cb0c9","child_tasks_local_reference_list":[],"attrs":{"exit_status":[],"script":"if \"@@{calm_array_index}@@\" == \"0\":\n\tprint \"VERSION=@@{KUBE_VERSION_NEW}@@\"","eval_variables":["VERSION"],"eval_scope":"local","type":"","script_type":"static"},"timeout_secs":"0","type":"SET_VARIABLE","variable_list":[],"name":"Set Version Minion"},{"target_any_local_reference":{"kind":"app_service","uuid":"a6884701-5550-48f4-9496-c3d2271862cf","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"513f7163-cf86-4ec0-a71c-4f40a98c0f17","child_tasks_local_reference_list":[],"attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{KUBE_VERSION_NEW}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nCONTROLLER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,AlwaysPullImages,DenyEscalatingExec,SecurityContextDeny,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false \n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Upgrade Master"},{"target_any_local_reference":{"kind":"app_service","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354","name":"Kubernetes_Minion"},"retries":"0","description":"","uuid":"7ff0837f-e2b6-4077-87d9-4cf12062a605","child_tasks_local_reference_list":[],"attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{KUBE_VERSION_NEW}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --masquerade-all=true\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Upgrade Minion"},{"target_any_local_reference":{"kind":"app_service","uuid":"a6884701-5550-48f4-9496-c3d2271862cf","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"32e4f097-3b2e-493f-9034-8dcd2ec18fb1","child_tasks_local_reference_list":[],"attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nMINION_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nJSONPATH='{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}'\nKUBE_VERSION_NEW=\"@@{KUBE_VERSION_NEW}@@\"\nMASTER_API_HTTPS=6443\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION_NEW}\/bin\/linux\/amd64\/kubectl\nchmod +x kubectl\nsudo mv kubectl \/usr\/local\/bin\/kubectl\n\ncount=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n  echo \"Trying to reach master server https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} : sleep for 5 secs\"\n  sleep 10\n  if [[ $count -eq 10 ]]; then\n  \techo \"Unable to reach master server: https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\"\n  \texit 1\n  fi\n  count=$((count+1))\ndone\n\ncount=0\nfor ip in $(echo \"${MINION_IPS}\" | tr \",\" \"\\n\"); do\n  #kubectl drain \"minion${count}\" --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no $ip \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 10\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=minion${count} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon minion${count}\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n\techo \"Upgrade failed on minion nodes\"\n    exit 1\nfi\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  #kubectl drain \"controller${count}\" --ignore-daemonsets --delete-local-data --force\n  #sleep 20\n  ssh -o stricthostkeychecking=no $ip \"sudo yum update -y --quiet && sudo systemctl daemon-reload && sudo systemctl restart kubelet\"\n  sleep 10\n  while [[ `kubectl get nodes -l kubernetes.io\/hostname=controller${count} -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\" 2>\/dev\/null` ]]; do sleep 10 ; done\n  #kubectl uncordon controller${count}\n  count=$((count+1))\ndone\n\n\nif [[ `kubectl get nodes -o jsonpath=\"$JSONPATH\" | grep \"Ready=Unknown\"` ]]; then \n\techo \"Upgrade failed on nodes: $(kubectl get nodes -o jsonpath='$JSONPATH' | grep 'Ready=Unknown')\"\n    exit 1\nfi"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"RestartServices"}],"description":"","uuid":"f389b1ae-c548-43cd-a1d0-94aeba9f02f6","variable_list":[{"val_type":"STRING","description":"","uuid":"668c20a8-e45d-4b01-946a-2dcf433ee07b","value":"v1.8.14","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_VERSION_NEW"}],"main_task_local_reference":{"kind":"app_task","name":"6ee65d8a_dag","uuid":"4271eb31-c16e-4d3d-a377-b1d1eabeb4c1"},"name":"68a7ffd0_runbook"},"type":"user","uuid":"f32f0734-1e55-4538-bb3c-9cb626c7b1bf"},{"description":"","name":"ScaleOut","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"0cd3bf74-81d0-4b5c-a23a-aeaa11f8565b","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale Out","uuid":"a4f8e707-211d-49fe-8f9d-dee7bc716213"},{"kind":"app_task","name":"Set Hosts file","uuid":"3c214722-255f-42b6-a128-5d313778dc60"}],"attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Scale Out","uuid":"a4f8e707-211d-49fe-8f9d-dee7bc716213"},"edge_type":"user_defined","type":"","uuid":"c50981dd-8d59-4e89-890f-79a1111a77c2","to_task_reference":{"kind":"app_task","name":"Set Hosts file","uuid":"3c214722-255f-42b6-a128-5d313778dc60"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"03b33121_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2","name":"39cf7283_deployment"},"retries":"0","description":"","uuid":"a4f8e707-211d-49fe-8f9d-dee7bc716213","child_tasks_local_reference_list":[],"attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","type":"SCALING","variable_list":[],"name":"Scale Out"},{"target_any_local_reference":{"kind":"app_service","uuid":"a6884701-5550-48f4-9496-c3d2271862cf","name":"Kubernetes_Master"},"retries":"0","description":"","uuid":"3c214722-255f-42b6-a128-5d313778dc60","child_tasks_local_reference_list":[],"attrs":{"script_type":"sh","type":"","command_line_args":"","exit_status":[],"script":"#!\/bin\/bash\nset -ex\n\nMINION_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  if ! (( $(grep -c \"${ip} minion${count}\" \/etc\/hosts) )) ; then\n  \techo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  fi\n  count=$((count+1))\ndone"},"timeout_secs":"0","type":"EXEC","variable_list":[],"name":"Set Hosts file"}],"description":"","uuid":"046a63bf-2d47-4999-b494-f3542705531f","variable_list":[{"val_type":"STRING","description":"","uuid":"e2c83db1-4a44-42c0-8222-1852f321b5eb","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"03b33121_dag","uuid":"0cd3bf74-81d0-4b5c-a23a-aeaa11f8565b"},"name":"00cf5417_runbook"},"type":"user","uuid":"306c1576-b694-42ef-a20c-a4d1a914d005"},{"description":"","name":"ScaleIn","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","uuid":"91140d58-9284-49a6-bdb4-357f9e63c550","child_tasks_local_reference_list":[{"kind":"app_task","name":"Scale In","uuid":"90f5f734-2bcd-4485-8771-3a1bc33c3056"}],"attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[],"name":"e72a9133_dag"},{"target_any_local_reference":{"kind":"app_blueprint_deployment","uuid":"bac12f83-11de-4904-9a3d-256f39fecfa2","name":"39cf7283_deployment"},"retries":"0","description":"","uuid":"90f5f734-2bcd-4485-8771-3a1bc33c3056","child_tasks_local_reference_list":[],"attrs":{"scaling_count":"@@{COUNT}@@","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","type":"SCALING","variable_list":[],"name":"Scale In"}],"description":"","uuid":"132d363c-529b-460c-970e-241d1ee4c43c","variable_list":[{"val_type":"STRING","description":"","uuid":"6d1af7d5-584a-4032-a7db-b811fdf97530","value":"1","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"COUNT"}],"main_task_local_reference":{"kind":"app_task","name":"e72a9133_dag","uuid":"91140d58-9284-49a6-bdb4-357f9e63c550"},"name":"96546f6c_runbook"},"type":"user","uuid":"0064bbb4-c6af-4241-b704-4d1802c15ffc"}],"name":"Nutanix","variable_list":[{"val_type":"STRING","description":"","uuid":"87df8cb4-04ec-4f51-88c4-6071ea2aac98","value":"ahv-kubenetes-cluster","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_CLUSTER_NAME"},{"val_type":"STRING","description":"","uuid":"6697d85f-20f7-4a17-b7f4-1bb115f29f3b","value":"v1.9.11","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_VERSION"},{"val_type":"STRING","description":"","uuid":"21ff6cfc-364f-4069-ba6f-88a7ab241f99","value":"17.03.2.ce","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"DOCKER_VERSION"},{"val_type":"STRING","description":"","uuid":"a8587f57-264b-443f-914f-b27b3f957568","value":"10.200.0.0\/16","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_CLUSTER_SUBNET"},{"val_type":"STRING","description":"","uuid":"fff3c561-3658-43cd-9fbb-d0dd868fcaf8","value":"10.32.0.0\/24","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_SERVICE_SUBNET"},{"val_type":"STRING","description":"","uuid":"0ec90e87-d842-4f2f-b29e-7d855729c414","value":"10.32.0.10","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"KUBE_DNS_IP"},{"val_type":"STRING","description":"","uuid":"f63637e3-0d39-4679-b519-33888c13f345","value":"10.46.34.88","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"PE_CLUSTER_IP"},{"val_type":"STRING","description":"","uuid":"ecb55ba6-79d2-48c5-95ee-00e4d882fbed","value":"10.46.34.96","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"PE_DATA_SERVICE_IP"},{"val_type":"STRING","description":"","uuid":"d809e136-d9e5-4f1b-b2f0-ee412dbfc3a4","value":"admin","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"PE_USERNAME"},{"val_type":"STRING","description":"","uuid":"04447eb2-cf5b-4221-b0c8-a4c417aa09bf","label":"","attrs":{"is_secret_modified":false,"secret_reference":{"uuid":"04297c44-31d0-4c79-a80f-c733a2acdbee"}},"editables":{"value":true},"type":"SECRET","name":"PE_PASSWORD"},{"val_type":"STRING","description":"","uuid":"f900c078-4b06-4a16-b492-511f6edabb52","value":"default-container-69049036518763","label":"","attrs":{"type":""},"editables":{"value":true},"type":"LOCAL","name":"PE_CONTAINER_NAME"},{"val_type":"STRING","description":"","uuid":"e2034784-8241-73c4-5f19-45e2cc9962e4","value":"canal","label":"","attrs":{},"editables":{"value":true},"type":"LOCAL","name":"KUBE_CNI_PLUGIN"}],"uuid":"028fe36c-9b2b-48f7-b30b-932ce81366e2"}],"default_credential_local_reference":{"kind":"app_credential","name":"CENTOS","uuid":"abeffc51-2124-413f-a3db-ded3c10ad1f2"},"package_definition_list":[{"uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c","action_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"}],"name":"AHV_Centos_K8SC_Package","version":"","type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"},"retries":"0","name":"dac441af_dag","type":"DAG","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"4e470a95-f83e-4fd6-888d-999b4ab5df3b"},{"kind":"app_task","name":"Generate Certs","uuid":"4c3b5b20-9dc5-429a-98a9-99517139b5b8"},{"kind":"app_task","name":"Configure Services","uuid":"51b2a424-33e3-4825-b34d-b89f3a67836c"},{"kind":"app_task","name":"Add User Roles","uuid":"006be5a2-000d-47a3-90ca-1171154f17cf"},{"kind":"app_task","name":"Network Configuration","uuid":"31ef4473-24ef-4463-aa5d-0167d3070fc4"},{"kind":"app_task","name":"DNS Configuration","uuid":"cd1e1d76-eac6-48db-be27-4ff3051dce0d"},{"kind":"app_task","name":"NVP Configuration","uuid":"2621bd3c-48cf-43c5-aa48-8fd4ddf4f2a3"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"ETCD Docker Kubelet Install","uuid":"4e470a95-f83e-4fd6-888d-999b4ab5df3b"},"edge_type":"user_defined","type":"","uuid":"db94874b-6b07-4d08-8781-b7e8b2eb29f0","to_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"4c3b5b20-9dc5-429a-98a9-99517139b5b8"}},{"from_task_reference":{"kind":"app_task","name":"Generate Certs","uuid":"4c3b5b20-9dc5-429a-98a9-99517139b5b8"},"edge_type":"user_defined","type":"","uuid":"5fe97a48-5f28-4617-b2d7-51b23f6ad04f","to_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"51b2a424-33e3-4825-b34d-b89f3a67836c"}},{"from_task_reference":{"kind":"app_task","name":"Configure Services","uuid":"51b2a424-33e3-4825-b34d-b89f3a67836c"},"edge_type":"user_defined","type":"","uuid":"01340b87-3e2b-4fc9-a4ca-b7ad845e9b78","to_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"006be5a2-000d-47a3-90ca-1171154f17cf"}},{"from_task_reference":{"kind":"app_task","name":"Add User Roles","uuid":"006be5a2-000d-47a3-90ca-1171154f17cf"},"edge_type":"user_defined","type":"","uuid":"ef86b66a-e65b-4c6a-8275-2c6b73aa8317","to_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"31ef4473-24ef-4463-aa5d-0167d3070fc4"}},{"from_task_reference":{"kind":"app_task","name":"Network Configuration","uuid":"31ef4473-24ef-4463-aa5d-0167d3070fc4"},"edge_type":"user_defined","type":"","uuid":"911c33bb-85f4-4961-be4b-b7849e4878b9","to_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"cd1e1d76-eac6-48db-be27-4ff3051dce0d"}},{"from_task_reference":{"kind":"app_task","name":"DNS Configuration","uuid":"cd1e1d76-eac6-48db-be27-4ff3051dce0d"},"edge_type":"user_defined","type":"","uuid":"33663eda-58fe-472e-ad65-8a5fbe45d877","to_task_reference":{"kind":"app_task","name":"NVP Configuration","uuid":"2621bd3c-48cf-43c5-aa48-8fd4ddf4f2a3"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"bb53b796-9bff-4e6c-8a32-5a8d2668e3b8"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","name":"ETCD Docker Kubelet Install","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nsudo easy_install netaddr\n\nETCD_VERSION=\"v3.2.11\"\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nMINION_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nNODE_NAME=\"controller@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nETCD_CLIENT_PORT=2380\nMASTER_API_PORT=8080\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\nsudo mkdir -p \/opt\/kube-ssl ${KUBE_CERT_PATH} ${KUBE_CNI_BIN_PATH} ${ETCD_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH}\n\nsudo hostnamectl set-hostname --static ${NODE_NAME}\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  echo \"${ip} controller${count}\" | sudo tee -a \/etc\/hosts\n  CON+=\"controller${count}=https:\/\/${ip}:${ETCD_CLIENT_PORT}\",\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\nETCD_ALL_CONTROLLERS=$(echo $CON | sed  's\/,$\/\/')\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  echo \"${ip} minion${count}\" | sudo tee -a \/etc\/hosts\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')    \n    \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/github.com\/coreos\/etcd\/releases\/download\/${ETCD_VERSION}\/etcd-${ETCD_VERSION}-linux-amd64.tar.gz\"\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\nchmod +x kubelet\nsudo mv kubelet \/usr\/bin\/kubelet\n\n# -*- Bootstrapping a H\/A etcd cluster.\ntar -xvf etcd-${ETCD_VERSION}-linux-amd64.tar.gz\nsudo mv etcd-${ETCD_VERSION}-linux-amd64\/etcd* \/usr\/bin\/\nrm -rf etcd-${ETCD_VERSION}-linux-amd64*\n\necho \"[Unit]\nDescription=etcd\nDocumentation=https:\/\/github.com\/coreos\n\n[Service]\nExecStart=\/usr\/bin\/etcd \\\\\n  --name ${NODE_NAME} \\\\\n  --cert-file=${ETCD_CERT_PATH}\/etcd-server.pem \\\\\n  --key-file=${ETCD_CERT_PATH}\/etcd-server-key.pem \\\\\n  --peer-cert-file=${ETCD_CERT_PATH}\/etcd-peer.pem \\\\\n  --peer-key-file=${ETCD_CERT_PATH}\/etcd-peer-key.pem \\\\\n  --trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-trusted-ca-file=${ETCD_CERT_PATH}\/etcd-ca.pem \\\\\n  --peer-client-cert-auth \\\\\n  --client-cert-auth \\\\\n  --initial-advertise-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-peer-urls https:\/\/${INTERNAL_IP}:${ETCD_CLIENT_PORT} \\\\\n  --listen-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT},http:\/\/127.0.0.1:${ETCD_SERVER_PORT} \\\\\n  --advertise-client-urls https:\/\/${INTERNAL_IP}:${ETCD_SERVER_PORT} \\\\\n  --initial-cluster-token etcd-cluster-0 \\\\\n  --initial-cluster ${ETCD_ALL_CONTROLLERS} \\\\\n  --initial-cluster-state new \\\\\n  --data-dir=\/var\/lib\/etcd \\\\\n  --wal-dir=\/var\/lib\/etcd\/wal \\\\\n  --max-wals=0\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/etcd.service\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --node-labels 'node-role.kubernetes.io\/master=true' \\\\\n  --node-labels 'node-role.kubernetes.io\/etcd=true' \\\\\n  --register-with-taints=node-role.kubernetes.io\/master=true:NoSchedule \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\nsudo mkdir -p \/var\/lib\/docker \/var\/lib\/etcd\/wal\n\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate etcd \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n etcd_lvm etcd\nsudo mkfs.xfs \/dev\/etcd\/etcd_lvm\n\nsudo pvcreate \/dev\/sd{e,f,g}\nsudo vgcreate docker \/dev\/sd{e,f,g}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/etcd\/etcd_lvm \\t \/var\/lib\/etcd \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error \"https:\/\/storage.googleapis.com\/kubernetes-helm\/helm-v2.8.2-linux-amd64.tar.gz\"\n\ntar -zxvf helm-v2.8.2-linux-amd64.tar.gz\nchmod +x cfssl_linux-amd64 cfssljson_linux-amd64 kubectl linux-amd64\/helm\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\nsudo mv kubectl linux-amd64\/helm \/usr\/local\/bin\/\nrm -rf helm-v2.8.2-linux-amd64.tar.gz linux-amd64","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"4e470a95-f83e-4fd6-888d-999b4ab5df3b"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","name":"Generate Certs","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nMINION_IPS=\"@@{AHV_Centos_K8SM.address}@@\"\nMASTER_API_HTTPS=6443\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nFIRST_IP_SERVICE_SUBNET=$(python -c \"from netaddr import * ; print IPNetwork('${SERVICE_SUBNET}')[1]\")\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  CONS_NAMES+=\"controller${count}\",\n  count=$((count+1))\ndone\n\nCONTROLLER_NAMES=$(echo $CONS_NAMES | sed  's\/,$\/\/')\n  \ncount=0\nfor ip in $(echo ${MINION_IPS} | tr \",\" \"\\n\"); do\n  MIN_NAMES+=\"minion${count}\",\n  count=$((count+1))\ndone\nMINION_NAMES=$(echo $MIN_NAMES | sed  's\/,$\/\/')  \n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\nsudo chown -R $USER:$USER \/opt\/kube-ssl && cd \/opt\/kube-ssl\necho '{\n  \"signing\": {\n    \"default\": {\n      \"expiry\": \"8760h\"\n    },\n    \"profiles\": {\n      \"server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"signing\", \"key encipherment\", \"server auth\", \"client auth\" ]\n      },\n      \"client\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"client auth\" ]\n      },\n      \"client-server\": {\n        \"expiry\": \"8760h\",\n        \"usages\": [ \"key encipherment\", \"server auth\", \"client auth\" ]\n      }\n    }\n  }\n}' | tee ca-config.json\n\necho '{\n  \"CN\": \"etcd-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-ca-csr.json\n\ncfssl gencert -initca etcd-ca-csr.json | cfssljson -bare etcd-ca\n\necho '{\n  \"CN\": \"etcd\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"etcd\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee etcd-csr.json\n\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=server etcd-csr.json | cfssljson -bare etcd-server\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client-server etcd-csr.json | cfssljson -bare etcd-peer\ncfssl gencert -ca=etcd-ca.pem -ca-key=etcd-ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_IPS} -profile=client etcd-csr.json | cfssljson -bare etcd-client\n\necho '{\n  \"CN\": \"kube-ca\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"CA\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-ca-csr.json\n\ncfssl gencert -initca kube-ca-csr.json | cfssljson -bare ca\n\necho '{\n  \"CN\": \"kubernetes\",\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"kube\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kubernetes-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${CONTROLLER_NAMES},${CONTROLLER_IPS},${MINION_NAMES},${MINION_IPS},${FIRST_IP_SERVICE_SUBNET},127.0.0.1,kubernetes.default,kubernetes,kubernetes.default.svc,kubernetes.default.svc.cluster.local -profile=server kubernetes-csr.json | cfssljson -bare kubernetes\n\necho '{\n  \"CN\": \"system:kube-controller-manager\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-controller-manager\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-controller-manager-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-controller-manager-csr.json | cfssljson -bare kube-controller-manager\n\necho '{\n  \"CN\": \"system:kube-scheduler\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:kube-scheduler\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-scheduler-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=server kube-scheduler-csr.json | cfssljson -bare kube-scheduler\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\ninstance=\"controller${count}\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${ip} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\ncount=$((count+1))\ndone \n\n# -*- Creating kube-proxy certificates\necho '{\n  \"CN\": \"system:kube-proxy\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:node-proxier\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee kube-proxy-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client kube-proxy-csr.json | cfssljson -bare kube-proxy\n\necho '{\n  \"CN\": \"admin\",\n  \"hosts\": [],\n  \"key\": {\n    \"algo\": \"rsa\",\n    \"size\": 2048\n  },\n  \"names\": [\n    {\n      \"C\": \"US\",\n      \"L\": \"San Jose\",\n      \"O\": \"system:masters\",\n      \"OU\": \"Cluster\",\n      \"ST\": \"California\"\n    }\n  ]\n}' | tee admin-csr.json\n\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=client admin-csr.json | cfssljson -bare admin\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=controller${count}.kubeconfig\nkubectl config set-credentials system:node:controller${count} --client-certificate=controller${count}.pem --client-key=controller${count}-key.pem --embed-certs=true --kubeconfig=controller${count}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:controller${count} --kubeconfig=controller${count}.kubeconfig\nkubectl config use-context default --kubeconfig=controller${count}.kubeconfig\ncount=$((count+1))\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-credentials kube-controller-manager --client-certificate=kube-controller-manager.pem --client-key=kube-controller-manager-key.pem --embed-certs=true --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-controller-manager --kubeconfig=kube-controller-manager.kubeconfig\nkubectl config use-context default --kubeconfig=kube-controller-manager.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-credentials kube-scheduler --client-certificate=kube-scheduler.pem --client-key=kube-scheduler-key.pem --embed-certs=true --kubeconfig=kube-scheduler.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-scheduler --kubeconfig=kube-scheduler.kubeconfig\nkubectl config use-context default --kubeconfig=kube-scheduler.kubeconfig\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS} --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-credentials kube-proxy --client-certificate=kube-proxy.pem --client-key=kube-proxy-key.pem --embed-certs=true --kubeconfig=kube-proxy.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=kube-proxy --kubeconfig=kube-proxy.kubeconfig\nkubectl config use-context default --kubeconfig=kube-proxy.kubeconfig\n\nENCRYPTION_KEY=$(head -c 32 \/dev\/urandom | base64)\necho \"kind: EncryptionConfig\napiVersion: v1\nresources:\n  - resources:\n      - secrets\n    providers:\n      - aescbc:\n          keys:\n            - name: key1\n              secret: ${ENCRYPTION_KEY}\n      - identity: {}\" | tee encryption-config.yaml\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa\n\ncount=0\nfor ip in $(echo ${CONTROLLER_IPS} | tr \",\" \"\\n\"); do\n  instance=\"controller${count}\"\n  scp -o stricthostkeychecking=no admin*.pem ca*.pem etcd*.pem kubernetes*.pem ${instance}* kube-proxy.kubeconfig kube-controller-manager.kubeconfig kube-scheduler.kubeconfig encryption-config.yaml ${instance}:\ncount=$((count+1))\ndone","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"4c3b5b20-9dc5-429a-98a9-99517139b5b8"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","name":"Configure Services","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{calm_array_address}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nETCD_CERT_PATH=\"\/etc\/ssl\/certs\/etcd\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nMASTER_API_HTTPS=6443\nETCD_SERVER_PORT=2379\nVERSION=$(echo \"${KUBELET_IMAGE_TAG}\" | tr \"_\" \" \" | awk '{print $1}')\nCONTROLLER_COUNT=$(echo \"@@{calm_array_address}@@\" | tr ',' '\\n' | wc -l)\n\nsudo cp ca*.pem etcd-*.pem kubernetes*.pem ${HOSTNAME}* kube-*.kubeconfig encryption-config.yaml ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nsudo cp etcd-*.pem ${ETCD_CERT_PATH}\/\nsudo chmod +r ${ETCD_CERT_PATH}\/*\n\ncount=0\nfor ip in $(echo \"${CONTROLLER_IPS}\" | tr \",\" \"\\n\"); do\n  ETCD+=\"https:\/\/${ip}:${ETCD_SERVER_PORT}\",\n  count=$((count+1))\ndone\nETCD_SERVERS=$(echo $ETCD | sed  's\/,$\/\/')\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-apiserver\n  namespace: kube-system\n  labels:\n    k8s-app: kube-apiserver\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-apiserver\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - apiserver\n    - --admission-control=Initializers,NamespaceLifecycle,NodeRestriction,LimitRanger,ServiceAccount,DefaultStorageClass,ResourceQuota,AlwaysPullImages,DenyEscalatingExec,EventRateLimit\n    - --advertise-address=${INTERNAL_IP}\n    - --allow-privileged=true\n    - --anonymous-auth=false\n    - --insecure-port=0\n    - --secure-port=${MASTER_API_HTTPS}\n    - --profiling=false\n    - --repair-malformed-updates=false\n    - --apiserver-count=${CONTROLLER_COUNT}\n    - --audit-log-maxage=30\n    - --audit-log-maxbackup=10\n    - --audit-log-maxsize=100\n    - --audit-log-path=\/var\/lib\/audit.log\n    - --authorization-mode=Node,RBAC\n    - --bind-address=0.0.0.0\n    - --kubelet-preferred-address-types=InternalIP,Hostname,ExternalIP\n    - --event-ttl=1h\n    - --service-account-lookup=true\n    - --enable-swagger-ui=true\n    - --storage-backend=etcd3\n    - --etcd-cafile=${ETCD_CERT_PATH}\/etcd-ca.pem\n    - --etcd-certfile=${ETCD_CERT_PATH}\/etcd-client.pem\n    - --etcd-keyfile=${ETCD_CERT_PATH}\/etcd-client-key.pem\n    - --etcd-servers=${ETCD_SERVERS}\n    - --experimental-encryption-provider-config=${KUBE_CERT_PATH}\/encryption-config.yaml\n    - --admission-control-config-file=${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n    - --tls-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --tls-cert-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --tls-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-certificate-authority=${KUBE_CERT_PATH}\/ca.pem\n    - --kubelet-client-certificate=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --kubelet-client-key=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --kubelet-https=true\n    - --runtime-config=api\/all\n    - --service-account-key-file=${KUBE_CERT_PATH}\/kubernetes.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --service-node-port-range=30000-32767\n    - --client-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --v=2\n    ports:\n    - containerPort: ${MASTER_API_HTTPS}\n      hostPort: ${MASTER_API_HTTPS}\n      name: https\n    - containerPort: 8080\n      hostPort: 8080\n      name: local\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-apiserver.yaml\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\n  labels:\n    k8s-app: kube-proxy\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-controller-manager\n  namespace: kube-system\n  labels:\n    k8s-app: kube-controller-manager\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-controller-manager\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - controller-manager\n    - --address=0.0.0.0  \n    - --allocate-node-cidrs=true  \n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --cluster-name=kubernetes-prod-cluster  \n    - --leader-elect=true  \n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-controller-manager.kubeconfig  \n    - --service-account-private-key-file=${KUBE_CERT_PATH}\/kubernetes-key.pem\n    - --root-ca-file=${KUBE_CERT_PATH}\/ca.pem\n    - --service-cluster-ip-range=${SERVICE_SUBNET}\n    - --terminated-pod-gc-threshold=100  \n    - --profiling=false  \n    - --use-service-account-credentials=true\n    - --horizontal-pod-autoscaler-use-rest-clients=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10252\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n    - mountPath: \/etc\/pki\n      name: ca-certs-etc-pki\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/etc\/ssl\/certs\n    name: ssl-certs-host\n  - hostPath:\n      path: \/etc\/pki\n    name: ca-certs-etc-pki\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-controller-manager.yaml\n    \necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-scheduler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-scheduler\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-scheduler\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - scheduler\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-scheduler.kubeconfig\n    - --leader-elect=true\n    - --profiling=false\n    - --v=2\n    livenessProbe:\n      httpGet:\n        host: 127.0.0.1\n        path: \/healthz\n        port: 10251\n      initialDelaySeconds: 15\n      timeoutSeconds: 1\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-scheduler.yaml\n    \necho \"kind: AdmissionConfiguration\napiVersion: apiserver.k8s.io\/v1alpha1\nplugins:\n- name: EventRateLimit\n  path: eventconfig.yaml\" | sudo tee ${KUBE_CERT_PATH}\/admission-control-config-file.yaml\n  \necho \"kind: Configuration\napiVersion: eventratelimit.admission.k8s.io\/v1alpha1\nlimits:\n- type: Namespace\n  qps: 50\n  burst: 100\n  cacheSize: 2000\n- type: User\n  qps: 10\n  burst: 50\" | sudo tee ${KUBE_CERT_PATH}\/eventconfig.yaml","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"51b2a424-33e3-4825-b34d-b89f3a67836c"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","name":"Add User Roles","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nMASTER_API_HTTPS=6443\nINTERNAL_IP=\"@@{address}@@\"\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\n\nsudo systemctl start etcd docker kubelet iscsid\nsudo systemctl enable etcd docker kubelet iscsid\n\nexport PATH=$PATH:\/opt\/bin\n\nmkdir CA\nmv admin*.pem ca*.pem etcd-*.pem kubernetes*.pem controller* kube-*.kubeconfig encryption-config.yaml CA\/\nif [ @@{calm_array_index}@@ -ne 0 ];then\n  exit\nfi\ncp \/opt\/kube-ssl\/admin*.pem CA\/\nCOUNT=0\nwhile [[ $(curl --key CA\/admin-key.pem --cert CA\/admin.pem --cacert CA\/ca.pem https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\/healthz) != \"ok\" ]] ; do\n    echo \"sleep for 5 secs\"\n  sleep 5\n  COUNT=$(($COUNT+1))\n  if [[ $COUNT -eq 50 ]]; then\n  \techo \"Error: creating cluster\"\n    exit 1\n  fi\ndone\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME}  --certificate-authority=$HOME\/CA\/ca.pem  --embed-certs=true --server=https:\/\/${INTERNAL_IP}:${MASTER_API_HTTPS}\nkubectl config set-credentials admin  --client-certificate=$HOME\/CA\/admin.pem  --client-key=$HOME\/CA\/admin-key.pem\nkubectl config set-context ${KUBE_CLUSTER_NAME}  --cluster=${KUBE_CLUSTER_NAME}  --user=admin\nkubectl config use-context ${KUBE_CLUSTER_NAME}\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRole\nmetadata:\n  annotations:\n    rbac.authorization.kubernetes.io\/autoupdate: \"true\"\n  labels:\n    kubernetes.io\/bootstrapping: rbac-defaults\n  name: system:kube-apiserver-to-kubelet\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/proxy\n      - nodes\/stats\n      - nodes\/log\n      - nodes\/spec\n      - nodes\/metrics\n    verbs:\n      - \"*\"\nEOF\n\ncat <<EOF | kubectl apply -f -\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: system:kube-apiserver\n  namespace: \"\"\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: system:kube-apiserver-to-kubelet\nsubjects:\n  - apiGroup: rbac.authorization.k8s.io\n    kind: User\n    name: kubernetes\nEOF","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"006be5a2-000d-47a3-90ca-1171154f17cf"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","name":"Network Configuration","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\nif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"canal\" ]]; then\nsudo mkdir -p \/etc\/kubernetes\/addons\/canal\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: canal-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  canal_iface: \"\"\n\n  masquerade: \"true\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: canal\n  namespace: kube-system\n  labels:\n    k8s-app: canal\nspec:\n  selector:\n    matchLabels:\n      k8s-app: canal\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: canal\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: canal\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.1\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-canal.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.1\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              value: \"none\"\n            - name: CLUSTER_TYPE\n              value: \"k8s,canal\"\n            - name: FELIX_IPTABLESREFRESHINTERVAL\n              value: \"60\"\n            - name: IP\n              value: \"\"\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"192.168.0.0\/16\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            httpGet:\n              path: \/readiness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n        - name: kube-flannel\n          image: quay.io\/coreos\/flannel:v0.9.1\n          command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n          securityContext:\n            privileged: true\n          env:\n            - name: POD_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.name\n            - name: POD_NAMESPACE\n              valueFrom:\n                fieldRef:\n                  fieldPath: metadata.namespace\n            - name: FLANNELD_IFACE\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: canal_iface\n            - name: FLANNELD_IP_MASQ\n              valueFrom:\n                configMapKeyRef:\n                  name: canal-config\n                  key: masquerade\n          volumeMounts:\n          - mountPath: \/run\/xtables.lock\n            name: xtables-lock\n            readOnly: false\n          - name: flannel-cfg\n            mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: flannel-cfg\n          configMap:\n            name: canal-config\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: canal\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: canal-flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: canal-calico\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: canal\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/canal\/canal.yml\nkubectl create -f \/etc\/kubernetes\/addons\/canal\/canal.yml\n\nelif [[ \"@@{KUBE_CNI_PLUGIN}@@\" == \"calico\" ]];then\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/calico\necho 'kind: ConfigMap\napiVersion: v1\nmetadata:\n  name: calico-config\n  namespace: kube-system\ndata:\n  typha_service_name: \"none\"\n  calico_backend: \"bird\"\n\n  veth_mtu: \"1440\"\n\n  cni_network_config: |-\n    {\n      \"name\": \"k8s-pod-network\",\n      \"cniVersion\": \"0.3.0\",\n      \"plugins\": [\n        {\n          \"type\": \"calico\",\n          \"log_level\": \"info\",\n          \"datastore_type\": \"kubernetes\",\n          \"nodename\": \"__KUBERNETES_NODE_NAME__\",\n          \"mtu\": __CNI_MTU__,\n          \"ipam\": {\n            \"type\": \"host-local\",\n            \"subnet\": \"usePodCidr\"\n          },\n          \"policy\": {\n              \"type\": \"k8s\"\n          },\n          \"kubernetes\": {\n              \"kubeconfig\": \"__KUBECONFIG_FILEPATH__\"\n          }\n        },\n        {\n          \"type\": \"portmap\",\n          \"snat\": true,\n          \"capabilities\": {\"portMappings\": true}\n        }\n      ]\n    }\n\n---\n\nkind: DaemonSet\napiVersion: extensions\/v1beta1\nmetadata:\n  name: calico-node\n  namespace: kube-system\n  labels:\n    k8s-app: calico-node\nspec:\n  selector:\n    matchLabels:\n      k8s-app: calico-node\n  updateStrategy:\n    type: RollingUpdate\n    rollingUpdate:\n      maxUnavailable: 1\n  template:\n    metadata:\n      labels:\n        k8s-app: calico-node\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      nodeSelector:\n        beta.kubernetes.io\/os: linux\n      hostNetwork: true\n      tolerations:\n        - effect: NoSchedule\n          operator: Exists\n        - key: CriticalAddonsOnly\n          operator: Exists\n        - effect: NoExecute\n          operator: Exists\n      serviceAccountName: calico-node\n      terminationGracePeriodSeconds: 0\n      initContainers:\n        - name: install-cni\n          image: calico\/cni:v3.5.1\n          command: [\"\/install-cni.sh\"]\n          env:\n            - name: CNI_CONF_NAME\n              value: \"10-calico.conflist\"\n            - name: CNI_NETWORK_CONFIG\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: cni_network_config\n            - name: KUBERNETES_NODE_NAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CNI_MTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: SLEEP\n              value: \"false\"\n          volumeMounts:\n            - mountPath: \/host\/opt\/cni\/bin\n              name: cni-bin-dir\n            - mountPath: \/host\/etc\/cni\/net.d\n              name: cni-net-dir\n      containers:\n        - name: calico-node\n          image: calico\/node:v3.5.1\n          env:\n            - name: DATASTORE_TYPE\n              value: \"kubernetes\"\n            - name: WAIT_FOR_DATASTORE\n              value: \"true\"\n            - name: NODENAME\n              valueFrom:\n                fieldRef:\n                  fieldPath: spec.nodeName\n            - name: CALICO_NETWORKING_BACKEND\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: calico_backend\n            - name: CLUSTER_TYPE\n              value: \"k8s,bgp\"\n            - name: IP\n              value: \"autodetect\"\n            - name: CALICO_IPV4POOL_IPIP\n              value: \"Always\"\n            - name: FELIX_IPINIPMTU\n              valueFrom:\n                configMapKeyRef:\n                  name: calico-config\n                  key: veth_mtu\n            - name: CALICO_IPV4POOL_CIDR\n              value: \"@@{KUBE_CLUSTER_SUBNET}@@\"\n            - name: CALICO_DISABLE_FILE_LOGGING\n              value: \"true\"\n            - name: FELIX_DEFAULTENDPOINTTOHOSTACTION\n              value: \"ACCEPT\"\n            - name: FELIX_IPV6SUPPORT\n              value: \"false\"\n            - name: FELIX_LOGSEVERITYSCREEN\n              value: \"info\"\n            - name: FELIX_HEALTHENABLED\n              value: \"true\"\n          securityContext:\n            privileged: true\n          resources:\n            requests:\n              cpu: 250m\n          livenessProbe:\n            httpGet:\n              path: \/liveness\n              port: 9099\n              host: localhost\n            periodSeconds: 10\n            initialDelaySeconds: 10\n            failureThreshold: 6\n          readinessProbe:\n            exec:\n              command:\n              - \/bin\/calico-node\n              - -bird-ready\n              - -felix-ready\n            periodSeconds: 10\n          volumeMounts:\n            - mountPath: \/lib\/modules\n              name: lib-modules\n              readOnly: true\n            - mountPath: \/run\/xtables.lock\n              name: xtables-lock\n              readOnly: false\n            - mountPath: \/var\/run\/calico\n              name: var-run-calico\n              readOnly: false\n            - mountPath: \/var\/lib\/calico\n              name: var-lib-calico\n              readOnly: false\n      volumes:\n        - name: lib-modules\n          hostPath:\n            path: \/lib\/modules\n        - name: var-run-calico\n          hostPath:\n            path: \/var\/run\/calico\n        - name: var-lib-calico\n          hostPath:\n            path: \/var\/lib\/calico\n        - name: xtables-lock\n          hostPath:\n            path: \/run\/xtables.lock\n            type: FileOrCreate\n        - name: cni-bin-dir\n          hostPath:\n            path: \/opt\/cni\/bin\n        - name: cni-net-dir\n          hostPath:\n            path: \/etc\/cni\/net.d\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: calico-node\n  namespace: kube-system\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n   name: felixconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: FelixConfiguration\n    plural: felixconfigurations\n    singular: felixconfiguration\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgppeers.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPPeer\n    plural: bgppeers\n    singular: bgppeer\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: bgpconfigurations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: BGPConfiguration\n    plural: bgpconfigurations\n    singular: bgpconfiguration\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: ippools.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: IPPool\n    plural: ippools\n    singular: ippool\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: hostendpoints.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: HostEndpoint\n    plural: hostendpoints\n    singular: hostendpoint\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: clusterinformations.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: ClusterInformation\n    plural: clusterinformations\n    singular: clusterinformation\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworkpolicies.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkPolicy\n    plural: globalnetworkpolicies\n    singular: globalnetworkpolicy\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: globalnetworksets.crd.projectcalico.org\nspec:\n  scope: Cluster\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: GlobalNetworkSet\n    plural: globalnetworksets\n    singular: globalnetworkset\n\n---\n\napiVersion: apiextensions.k8s.io\/v1beta1\nkind: CustomResourceDefinition\nmetadata:\n  name: networkpolicies.crd.projectcalico.org\nspec:\n  scope: Namespaced\n  group: crd.projectcalico.org\n  version: v1\n  names:\n    kind: NetworkPolicy\n    plural: networkpolicies\n    singular: networkpolicy\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: calico-node\nrules:\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - nodes\n      - namespaces\n    verbs:\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - endpoints\n      - services\n    verbs:\n      - watch\n      - list\n      - get\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n      - update\n  - apiGroups: [\"networking.k8s.io\"]\n    resources:\n      - networkpolicies\n    verbs:\n      - watch\n      - list\n  - apiGroups: [\"\"]\n    resources:\n      - pods\n      - namespaces\n      - serviceaccounts\n    verbs:\n      - list\n      - watch\n  - apiGroups: [\"\"]\n    resources:\n      - pods\/status\n    verbs:\n      - patch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - globalfelixconfigs\n      - felixconfigurations\n      - bgppeers\n      - globalbgpconfigs\n      - bgpconfigurations\n      - ippools\n      - globalnetworkpolicies\n      - globalnetworksets\n      - networkpolicies\n      - clusterinformations\n      - hostendpoints\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - ippools\n      - felixconfigurations\n      - clusterinformations\n    verbs:\n      - create\n      - update\n  - apiGroups: [\"\"]\n    resources:\n      - nodes\n    verbs:\n      - get\n      - list\n      - watch\n  - apiGroups: [\"crd.projectcalico.org\"]\n    resources:\n      - bgpconfigurations\n      - bgppeers\n    verbs:\n      - create\n      - update\n---\napiVersion: rbac.authorization.k8s.io\/v1beta1\nkind: ClusterRoleBinding\nmetadata:\n  name: calico-node\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: calico-node\nsubjects:\n- kind: ServiceAccount\n  name: calico-node\n  namespace: kube-system' | sudo tee \/etc\/kubernetes\/addons\/calico\/calico.yml\nkubectl create -f \/etc\/kubernetes\/addons\/calico\/calico.yml  \n\nelse\n  echo \"Invalid `KUBE_CNI_PLUGIN : @@{KUBE_CNI_PLUGIN}@@` Defaulting to flannel\"\n\nsudo mkdir -p \/etc\/kubernetes\/addons\/flannel\necho '---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - pods\n    verbs:\n      - get\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\n    verbs:\n      - list\n      - watch\n  - apiGroups:\n      - \"\"\n    resources:\n      - nodes\/status\n    verbs:\n      - patch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-system\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: flannel\n  namespace: kube-system\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      \"name\": \"cbr0\",\n      \"type\": \"flannel\",\n      \"delegate\": {\n        \"isDefaultGateway\": true\n      }\n    }\n  net-conf.json: |\n    {\n      \"Network\": \"@@{KUBE_CLUSTER_SUBNET}@@\",\n      \"Backend\": {\n        \"Type\": \"vxlan\"\n      }\n    }\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-system\n  labels:\n    tier: node\n    app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      hostNetwork: true\n      nodeSelector:\n        beta.kubernetes.io\/arch: amd64\n      tolerations:\n      - key: node-role.kubernetes.io\/master\n        operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command:\n        - cp\n        args:\n        - -f\n        - \/etc\/kube-flannel\/cni-conf.json\n        - \/etc\/cni\/net.d\/10-flannel.conf\n        volumeMounts:\n        - name: cni\n          mountPath: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      containers:\n      - name: kube-flannel\n        image: quay.io\/coreos\/flannel:v0.10.0-amd64\n        command: [ \"\/opt\/bin\/flanneld\", \"--ip-masq\", \"--kube-subnet-mgr\" ]\n        securityContext:\n          privileged: true\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        volumeMounts:\n        - name: run\n          mountPath: \/run\n        - name: flannel-cfg\n          mountPath: \/etc\/kube-flannel\/\n      volumes:\n        - name: run\n          hostPath:\n            path: \/run\n        - name: cni\n          hostPath:\n            path: \/etc\/cni\/net.d\n        - name: flannel-cfg\n          configMap:\n            name: kube-flannel-cfg' | sudo tee \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nkubectl create -f \/etc\/kubernetes\/addons\/flannel\/kube-flannel.yml\nfi\n\nsleep 15\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"31ef4473-24ef-4463-aa5d-0167d3070fc4"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","name":"DNS Configuration","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/kubedns\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: EnsureExists\ndata:\n  upstreamNameservers: |\n    [\"8.8.8.8\", \"4.2.2.2\"]\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    kubernetes.io\/name: \"KubeDNS\"\nspec:\n  selector:\n    k8s-app: kube-dns\n  clusterIP: @@{KUBE_DNS_IP}@@\n  ports:\n    - name: dns\n      port: 53\n      protocol: UDP\n    - name: dns-tcp\n      port: 53\n      protocol: TCP\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  strategy:\n    rollingUpdate:\n      maxSurge: 10%\n      maxUnavailable: 0\n  selector:\n    matchLabels:\n      k8s-app: kube-dns\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      volumes:\n      - name: kube-dns-config\n        configMap:\n          name: kube-dns\n          optional: true\n      containers:\n      - name: kubedns\n        image: gcr.io\/google_containers\/k8s-dns-kube-dns-amd64:1.14.10\n        resources:\n          limits:\n            memory: 170Mi\n          requests:\n            cpu: 100m\n            memory: 70Mi\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/kubedns\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        readinessProbe:\n          httpGet:\n            path: \/readiness\n            port: 8081\n            scheme: HTTP\n          initialDelaySeconds: 3\n          timeoutSeconds: 5\n        args:\n        - --domain=cluster.local.\n        - --dns-port=10053\n        - --config-dir=\/kube-dns-config\n        - --v=2\n        env:\n        - name: PROMETHEUS_PORT\n          value: \"10055\"\n        ports:\n        - containerPort: 10053\n          name: dns-local\n          protocol: UDP\n        - containerPort: 10053\n          name: dns-tcp-local\n          protocol: TCP\n        - containerPort: 10055\n          name: metrics\n          protocol: TCP\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/kube-dns-config\n      - name: dnsmasq\n        image: gcr.io\/google_containers\/k8s-dns-dnsmasq-nanny-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/healthcheck\/dnsmasq\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - -v=2\n        - -logtostderr\n        - -configDir=\/etc\/k8s\/dns\/dnsmasq-nanny\n        - -restartDnsmasq=true\n        - --\n        - -k\n        - --cache-size=1000\n        - --log-facility=-\n        - --server=\/cluster.local.\/127.0.0.1#10053\n        - --server=\/in-addr.arpa\/127.0.0.1#10053\n        - --server=\/ip6.arpa\/127.0.0.1#10053\n        ports:\n        - containerPort: 53\n          name: dns\n          protocol: UDP\n        - containerPort: 53\n          name: dns-tcp\n          protocol: TCP\n        resources:\n          requests:\n            cpu: 150m\n            memory: 20Mi\n        volumeMounts:\n        - name: kube-dns-config\n          mountPath: \/etc\/k8s\/dns\/dnsmasq-nanny\n      - name: sidecar\n        image: gcr.io\/google_containers\/k8s-dns-sidecar-amd64:1.14.10\n        livenessProbe:\n          httpGet:\n            path: \/metrics\n            port: 10054\n            scheme: HTTP\n          initialDelaySeconds: 60\n          timeoutSeconds: 5\n          successThreshold: 1\n          failureThreshold: 5\n        args:\n        - --v=2\n        - --logtostderr\n        - --probe=kubedns,127.0.0.1:10053,kubernetes.default.svc.cluster.local.,5,A\n        - --probe=dnsmasq,127.0.0.1:53,kubernetes.default.svc.cluster.local.,5,A\n        ports:\n        - containerPort: 10054\n          name: metrics\n          protocol: TCP\n        resources:\n          requests:\n            memory: 20Mi\n            cpu: 10m\n      dnsPolicy:\n      serviceAccountName: kube-dns' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\n      \necho 'kind: ServiceAccount\napiVersion: v1\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"nodes\"]\n    verbs: [\"list\"]\n  - apiGroups: [\"\"]\n    resources: [\"replicationcontrollers\/scale\"]\n    verbs: [\"get\", \"update\"]\n  - apiGroups: [\"extensions\"]\n    resources: [\"deployments\/scale\", \"replicasets\/scale\"]\n    verbs: [\"get\", \"update\"]\n# Remove the configmaps rule once below issue is fixed:\n# kubernetes-incubator\/cluster-proportional-autoscaler#16\n  - apiGroups: [\"\"]\n    resources: [\"configmaps\"]\n    verbs: [\"get\", \"create\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1\nmetadata:\n  name: system:kube-dns-autoscaler\n  labels:\n    addonmanager.kubernetes.io\/mode: Reconcile\nsubjects:\n  - kind: ServiceAccount\n    name: kube-dns-autoscaler\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: system:kube-dns-autoscaler\n  apiGroup: rbac.authorization.k8s.io\n\n---\napiVersion: apps\/v1beta2 #extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: kube-dns-autoscaler\n  namespace: kube-system\n  labels:\n    k8s-app: kube-dns-autoscaler\n    kubernetes.io\/cluster-service: \"true\"\n    addonmanager.kubernetes.io\/mode: Reconcile\nspec:\n  selector:\n    matchLabels:\n      k8s-app: kube-dns-autoscaler\n  template:\n    metadata:\n      labels:\n        k8s-app: kube-dns-autoscaler\n      annotations:\n        scheduler.alpha.kubernetes.io\/critical-pod: \"\"\n    spec:\n      priorityClassName: system-cluster-critical\n      containers:\n      - name: autoscaler\n        image: k8s.gcr.io\/cluster-proportional-autoscaler-amd64:1.1.2-r2\n        resources:\n            requests:\n                cpu: \"20m\"\n                memory: \"10Mi\"\n        command:\n          - \/cluster-proportional-autoscaler\n          - --namespace=kube-system\n          - --configmap=kube-dns-autoscaler\n          # Should keep target in sync with cluster\/addons\/dns\/kube-dns.yaml.base\n          - --target=Deployment\/kube-dns\n          # When cluster is using large nodes(with more cores), \"coresPerReplica\" should dominate.\n          # If using small nodes, \"nodesPerReplica\" should dominate.\n          - --default-params={\"linear\":{\"coresPerReplica\":256,\"nodesPerReplica\":16,\"preventSinglePointFailure\":true}}\n          - --logtostderr=true\n          - --v=2\n      tolerations:\n      - key: \"CriticalAddonsOnly\"\n        operator: \"Exists\"\n      serviceAccountName: kube-dns-autoscaler' | sudo tee \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/kubedns\/kube-dns-autoscaler.yaml\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"cd1e1d76-eac6-48db-be27-4ff3051dce0d"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Master","uuid":"a6884701-5550-48f4-9496-c3d2271862cf"},"retries":"0","name":"NVP Configuration","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nif [ @@{calm_array_index}@@ -ne 0 ];then\n\texit\nfi\n\nPRISM_CLUSTER_IP=\"@@{PE_CLUSTER_IP}@@\"\nPRISM_DATA_SERVICE_IP=\"@@{PE_CLUSTER_IP}@@\"\n\nif [[ (\"${PRISM_CLUSTER_IP}x\" == \"x\") && (\"${PRISM_DATA_SERVICE_IP}x\" == \"x\") ]]; then exit 0; fi\nexport PATH=$PATH:\/opt\/bin\n\nsudo mkdir \/etc\/kubernetes\/addons\/volume_plugin\nNTNX_SECRET=$(echo -n \"@@{PE_USERNAME}@@:@@{PE_PASSWORD}@@\" | base64)\necho 'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: nutanixabs-provisioner-runner\n  namespace: kube-system\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumes\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"persistentvolumeclaims\"]\n    verbs: [\"get\", \"list\", \"watch\", \"update\"]\n  - apiGroups: [\"storage.k8s.io\"]\n    resources: [\"storageclasses\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"list\", \"watch\", \"create\", \"update\", \"patch\"]\n  - apiGroups: [\"\"]\n    resources: [\"services\"]\n    verbs: [\"get\"]\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"create\", \"delete\"]\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io\/v1beta1\nmetadata:\n  name: run-nutanixabs-provisioner\n  namespace: kube-system\nsubjects:\n  - kind: ServiceAccount\n    name: nutanixabs-provisioner\n    namespace: kube-system\nroleRef:\n  kind: ClusterRole\n  name: nutanixabs-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n---\napiVersion: extensions\/v1beta1\nkind: Deployment\nmetadata:\n  name: nutanixabs-provisioner\n  namespace: kube-system\nspec:\n  replicas: 1\n  strategy:\n    type: Recreate\n  template:\n    metadata:\n      labels:\n        app: nutanixabs-provisioner\n    spec:\n      serviceAccount: nutanixabs-provisioner\n      hostNetwork: true\n      containers:\n        -\n          image: \"ntnx\/nutanixabs-provisioner\"\n          name: nutanixabs-provisioner\n          args: [\"--v=4\"]\n          imagePullPolicy: IfNotPresent\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: kube-system\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\n---\nkind: StorageClass\napiVersion: storage.k8s.io\/v1\nmetadata:\n  name: silver \n  namespace: kube-system\n  annotations:\n    storageclass.beta.kubernetes.io\/is-default-class: \"true\"\nprovisioner: nutanix\/abs\nparameters:\n     prismEndPoint: @@{PE_CLUSTER_IP}@@:9440\n     dataServiceEndPoint: @@{PE_DATA_SERVICE_IP}@@:3260\n     secretName: ntnx-secret\n     storageContainer: @@{PE_CONTAINER_NAME}@@\n     fsType: ext4\n     chapAuthEnabled: \"false\"' | sudo tee \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/nutanix-provisioner.yaml\n\necho \"apiVersion: v1\nkind: Secret\nmetadata:\n  name: ntnx-secret\n  namespace: default\ndata:\n  key: <SECRET>\ntype: nutanix\/abs\" | sudo tee -a \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nsudo sed -i \"s\/<SECRET>\/${NTNX_SECRET}\/\" \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\nkubectl create -f \/etc\/kubernetes\/addons\/volume_plugin\/ntnx-secret.yaml\n","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"2621bd3c-48cf-43c5-aa48-8fd4ddf4f2a3"}],"name":"8e760b73_runbook","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"dac441af_dag","uuid":"bb53b796-9bff-4e6c-8a32-5a8d2668e3b8"},"uuid":"975efffc-8364-46b9-84d8-0b1b08e563b4"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SC_Package","uuid":"b5279f4c-5d74-460e-bc8e-9c1acbba4b7c"},"retries":"0","name":"6324786a_dag","type":"DAG","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"6d567c82-e48f-4838-883a-73a6bb8e31b4"}],"name":"6522ac7a_runbook","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"6324786a_dag","uuid":"6d567c82-e48f-4838-883a-73a6bb8e31b4"},"uuid":"175c3cc1-502d-4622-9f8b-6d5c4ca3b336"}},"variable_list":[],"description":""},{"uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125","action_list":[],"service_local_reference_list":[{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"}],"name":"AHV_Centos_K8SM_Package","version":"","type":"DEB","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"},"retries":"0","name":"c1566b3d_dag","type":"DAG","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Docker Kubelet Install","uuid":"064cf6df-3da3-4a90-943b-dc21937c9a18"},{"kind":"app_task","name":"GetCerts","uuid":"2ecd77aa-cadd-489a-a745-dfa0a9045b12"}],"state":"ACTIVE","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Docker Kubelet Install","uuid":"064cf6df-3da3-4a90-943b-dc21937c9a18"},"edge_type":"user_defined","type":"","uuid":"f74f3a63-c76f-4cbc-85cc-e44aef39f7d9","to_task_reference":{"kind":"app_task","name":"GetCerts","uuid":"2ecd77aa-cadd-489a-a745-dfa0a9045b12"}}],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"1570df20-64fd-400b-ab81-7b72edfd5203"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","name":"Docker Kubelet Install","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nKUBE_VERSION=\"@@{VERSION}@@\"\nKUBELET_IMAGE_TAG=\"${KUBE_VERSION}_coreos.0\"\nINTERNAL_IP=\"@@{address}@@\"\nCONTROLLER_IPS=\"@@{AHV_Centos_K8SC.address}@@\"\nNODE_NAME=\"minion@@{calm_array_index}@@\"\nCLUSTER_SUBNET=\"@@{KUBE_CLUSTER_SUBNET}@@\"\nSERVICE_SUBNET=\"@@{KUBE_SERVICE_SUBNET}@@\"\nKUBE_CLUSTER_DNS=\"@@{KUBE_DNS_IP}@@\"\nDOCKER_VERSION=\"@@{DOCKER_VERSION}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nKUBE_MANIFEST_PATH=\"\/etc\/kubernetes\/manifests\"\nKUBE_CNI_BIN_PATH=\"\/opt\/cni\/bin\"\nKUBE_CNI_CONF_PATH=\"\/etc\/cni\/net.d\"\nETCD_SERVER_PORT=2379\n\nsudo mkdir -p ${KUBE_CERT_PATH} ${KUBE_MANIFEST_PATH} ${KUBE_CNI_CONF_PATH} ${KUBE_CNI_BIN_PATH}\nsudo hostnamectl set-hostname --static ${NODE_NAME}\n\nsudo yum update -y --quiet\nsudo yum install -y iscsi-initiator-utils socat --quiet\n\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/github.com\/containernetworking\/plugins\/releases\/download\/v0.6.0\/cni-plugins-amd64-v0.6.0.tgz\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubelet\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/storage.googleapis.com\/kubernetes-release\/release\/${KUBE_VERSION}\/bin\/linux\/amd64\/kubectl\ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssl_linux-amd64 \ncurl -C - -L -O --retry 6 --retry-max-time 60 --retry-delay 60 --silent --show-error https:\/\/pkg.cfssl.org\/R1.2\/cfssljson_linux-amd64\nchmod +x kubelet kubectl cfssl_linux-amd64 cfssljson_linux-amd64\nsudo mv kubelet kubectl \/usr\/bin\/\nsudo mv cfssl_linux-amd64 \/usr\/local\/bin\/cfssl\nsudo mv cfssljson_linux-amd64 \/usr\/local\/bin\/cfssljson\n\nsudo yum install -y --quiet yum-utils\nsudo yum-config-manager --add-repo https:\/\/download.docker.com\/linux\/centos\/docker-ce.repo\nsudo yum install -y --quiet --setopt=obsoletes=0 docker-ce-${DOCKER_VERSION} docker-ce-selinux-${DOCKER_VERSION}\n\nsudo sed -i '\/ExecStart=\/c\\\\ExecStart=\/usr\/bin\/dockerd -H tcp:\/\/0.0.0.0:2375 -H unix:\/\/\/var\/run\/docker.sock' \/usr\/lib\/systemd\/system\/docker.service\nsudo systemctl enable docker\nsudo usermod -a -G docker $USER\n\nsudo mkdir -p \/etc\/docker\necho '{\n  \"storage-driver\": \"overlay\"\n}' | sudo tee \/etc\/docker\/daemon.json\n\necho '{\n  \"name\": \"cbr0\",\n  \"type\": \"flannel\",\n  \"delegate\": {\n    \"isDefaultGateway\": true\n  }\n}' | sudo tee ${KUBE_CNI_CONF_PATH}\/10-flannel.conf\n\nsudo tar -zxvf cni-plugins-amd64-v0.6.0.tgz -C ${KUBE_CNI_BIN_PATH}\nrm -rf cni-plugins-amd64-v0.6.0.tgz\n\necho \"[Unit]\nDescription=Kubernetes Kubelet\nDocumentation=https:\/\/github.com\/GoogleCloudPlatform\/kubernetes\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nExecStart=\/usr\/bin\/kubelet \\\\\n  --allow-privileged=true \\\\\n  --anonymous-auth=false \\\\\n  --authentication-token-webhook \\\\\n  --authorization-mode=Webhook \\\\\n  --cluster-dns=${KUBE_CLUSTER_DNS} \\\\\n  --cluster-domain=cluster.local \\\\\n  --container-runtime=docker \\\\\n  --enable-custom-metrics \\\\\n  --kubeconfig=${KUBE_CERT_PATH}\/${NODE_NAME}.kubeconfig \\\\\n  --network-plugin=cni \\\\\n  --pod-cidr=${CLUSTER_SUBNET} \\\\\n  --register-node=true \\\\\n  --runtime-request-timeout=10m \\\\\n  --client-ca-file=${KUBE_CERT_PATH}\/ca.pem \\\\\n  --tls-cert-file=${KUBE_CERT_PATH}\/${NODE_NAME}.pem \\\\\n  --tls-private-key-file=${KUBE_CERT_PATH}\/${NODE_NAME}-key.pem \\\\\n  --pod-manifest-path=${KUBE_MANIFEST_PATH} \\\\\n  --read-only-port=0 \\\\\n  --protect-kernel-defaults=false \\\\\n  --make-iptables-util-chains=true \\\\\n  --keep-terminated-pod-volumes=false \\\\\n  --event-qps=0 \\\\\n  --cadvisor-port=0 \\\\\n  --runtime-cgroups=\/systemd\/system.slice \\\\\n  --kubelet-cgroups=\/systemd\/system.slice \\\\\n  --eviction-hard=memory.available<100Mi,nodefs.available<10%,nodefs.inodesFree<5% \\\\\n  --node-labels 'node-role.kubernetes.io\/worker=true' \\\\\n  --node-labels 'beta.kubernetes.io\/fluentd-ds-ready=true' \\\\\n  --v=2\nRestart=on-failure\nRestartSec=5\n\n[Install]\nWantedBy=multi-user.target\" | sudo tee \/etc\/systemd\/system\/kubelet.service\n\necho \"apiVersion: v1\nkind: Pod\nmetadata:\n  name: kube-proxy\n  namespace: kube-system\nspec:\n  hostNetwork: true\n  containers:\n  - name: kube-proxy\n    image: quay.io\/coreos\/hyperkube:${KUBELET_IMAGE_TAG}\n    command:\n    - \/hyperkube\n    - proxy\n    - --cluster-cidr=${CLUSTER_SUBNET}\n    - --kubeconfig=${KUBE_CERT_PATH}\/kube-proxy.kubeconfig\n    - --proxy-mode=iptables\n    securityContext:\n      privileged: true\n    volumeMounts:\n    - mountPath: ${KUBE_CERT_PATH}\n      name: ssl-certs-kubernetes\n      readOnly: true\n    - mountPath: \/etc\/ssl\/certs\n      name: ssl-certs-host\n      readOnly: true\n  volumes:\n  - hostPath:\n      path: ${KUBE_CERT_PATH}\n    name: ssl-certs-kubernetes\n  - hostPath:\n      path: \/usr\/share\/ca-certificates\n    name: ssl-certs-host\" | sudo tee ${KUBE_MANIFEST_PATH}\/kube-proxy.yaml\n\necho \"InitiatorName=iqn.1994-05.com.nutanix:k8s-worker\" | sudo tee \/etc\/iscsi\/initiatorname.iscsi\n\nsudo mkdir -p \/var\/lib\/docker\nsudo yum install -y lvm2 --quiet\nsudo pvcreate \/dev\/sd{b,c,d}\nsudo vgcreate docker \/dev\/sd{b,c,d}\nsleep 3\nsudo lvcreate -l 100%VG -n docker_lvm docker\nsudo mkfs.xfs \/dev\/docker\/docker_lvm\n\necho -e \"\/dev\/docker\/docker_lvm \\t \/var\/lib\/docker \\t xfs \\t defaults \\t 0 0\" | sudo tee -a \/etc\/fstab\nsudo mount -a\n\necho 'exclude=docker*' | sudo tee -a \/etc\/yum.conf\n\necho \"@@{CENTOS.secret}@@\" | tee ~\/.ssh\/id_rsa\nchmod 400 ~\/.ssh\/id_rsa","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"064cf6df-3da3-4a90-943b-dc21937c9a18"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","name":"GetCerts","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nKUBE_CLUSTER_NAME=\"@@{KUBE_CLUSTER_NAME}@@\"\nMASTER_IP=\"@@{AHV_Centos_K8SC.address[0]}@@\"\nINSTANCE_IP=\"@@{address}@@\"\ninstance=\"minion@@{calm_array_index}@@\"\nKUBE_CERT_PATH=\"\/etc\/kubernetes\/ssl\"\nMASTER_API_HTTPS=6443\n\nwhile [ ! $(ssh -o stricthostkeychecking=no $MASTER_IP \"ls \/opt\/kube-ssl\/encryption-config.yaml 2>\/dev\/null\") ] ; do  echo \"waiting for certs sleeping 5\" && sleep 5; done\n\nscp -o stricthostkeychecking=no ${MASTER_IP}:\/opt\/kube-ssl\/{ca*.pem,kubernetes*.pem,kube-proxy.kubeconfig,ca-config.json} .\n\ninstance=\"minion@@{calm_array_index}@@\"\necho \"{\n  \\\"CN\\\": \\\"system:node:${instance}\\\",\n  \\\"key\\\": {\n    \\\"algo\\\": \\\"rsa\\\",\n    \\\"size\\\": 2048\n  },\n  \\\"names\\\": [\n    {\n      \\\"C\\\": \\\"US\\\",\n      \\\"L\\\": \\\"San Jose\\\",\n      \\\"O\\\": \\\"system:nodes\\\",\n      \\\"OU\\\": \\\"Kubernetes The Hard Way\\\",\n      \\\"ST\\\": \\\"California\\\"\n    }\n  ]\n}\" | tee ${instance}-csr.json\ncfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -hostname=${instance},${INSTANCE_IP} -profile=client-server ${instance}-csr.json | cfssljson -bare ${instance}\n\nkubectl config set-cluster ${KUBE_CLUSTER_NAME} --certificate-authority=ca.pem --embed-certs=true --server=https:\/\/${MASTER_IP}:${MASTER_API_HTTPS} --kubeconfig=${instance}.kubeconfig\nkubectl config set-credentials system:node:${instance} --client-certificate=${instance}.pem --client-key=${instance}-key.pem --embed-certs=true --kubeconfig=${instance}.kubeconfig\nkubectl config set-context default --cluster=${KUBE_CLUSTER_NAME} --user=system:node:${instance} --kubeconfig=${instance}.kubeconfig\nkubectl config use-context default --kubeconfig=${instance}.kubeconfig\n\nsudo cp *.pem *.kubeconfig ${KUBE_CERT_PATH}\/\nsudo chmod +r ${KUBE_CERT_PATH}\/*\n\nrm -rf ${instance}-csr.json","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"2ecd77aa-cadd-489a-a745-dfa0a9045b12"}],"name":"9a6e189b_runbook","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"c1566b3d_dag","uuid":"1570df20-64fd-400b-ab81-7b72edfd5203"},"uuid":"b1edafbd-6625-4377-96a3-374d256c2af8"},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"AHV_Centos_K8SM_Package","uuid":"fcda64d0-b13e-4cec-b7b1-ad1058680125"},"retries":"0","name":"abd3357c_dag","type":"DAG","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Remove Node","uuid":"1527b81f-7e8a-419a-b44f-67dc71bfa666"}],"state":"ACTIVE","attrs":{"edges":[],"type":""},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"c8708f56-a2f1-49fb-b8e8-3226448e0c8c"},{"target_any_local_reference":{"kind":"app_service","name":"Kubernetes_Minion","uuid":"a9ce4890-0d79-4a9c-bac0-eb2ad5d99354"},"retries":"0","name":"Remove Node","type":"EXEC","description":"","child_tasks_local_reference_list":[],"state":"ACTIVE","attrs":{"script":"#!\/bin\/bash\nset -ex\n\nMASTER_IP=\"@@{Kubernetes_Master.address[0]}@@\"\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl drain 'minion@@{calm_array_index}@@' --ignore-daemonsets --delete-local-data --force\"\nsleep 10\nssh -o stricthostkeychecking=no ${MASTER_IP} \"kubectl delete node 'minion@@{calm_array_index}@@'\"","type":"","command_line_args":"","exit_status":[],"script_type":"sh"},"timeout_secs":"0","message_list":[],"variable_list":[],"uuid":"1527b81f-7e8a-419a-b44f-67dc71bfa666"}],"name":"3cb17acf_runbook","description":"","state":"ACTIVE","variable_list":[],"message_list":[],"main_task_local_reference":{"kind":"app_task","name":"abd3357c_dag","uuid":"c8708f56-a2f1-49fb-b8e8-3226448e0c8c"},"uuid":"de124173-a951-49b3-aaa6-455bb1f0c1d7"}},"variable_list":[],"description":""},{"uuid":"7861473c-3123-4a72-bf45-329a774d3fd6","action_list":[],"service_local_reference_list":[],"name":"AHV_CENTOS_76","version":"","type":"SUBSTRATE_IMAGE","options":{"type":"","name":"CentOS-7-x86_64-1810","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-1810.qcow2","version":{"product_version":"","type":"","product_name":""},"architecture":"X86_64","type":""},"description":""},"variable_list":[],"description":""},{"name":"ESX_CENTOS_76","type":"SUBSTRATE_IMAGE","uuid":"40192df2-d29d-4b46-b0ec-c05ffecc3d5a","variable_list":[],"options":{"name":"CENTOS_76","resources":{"image_type":"DISK_IMAGE","source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-1810.ova","architecture":"X86_64"}}}],"client_attrs":{"4751454d-7ed9-41c1-9766-0adc07aceee6":{"y":413.0940071326,"x":768.9612911807},"c14d1e09-b412-441e-a685-b3780bacb8e9":{"y":151.1603651085,"x":418},"19397879-a0f1-46bb-a96d-a7bddc21a19f":{"y":413.0940071326,"x":768.9612911807},"216f1292-0017-4fef-9b62-621ed3543813":{"y":151.1603651085,"x":418},"9772d4b7-59c5-4a8b-b964-1b274d96de9e":{"y":413.0940071326,"x":768.9612911807},"026a38d1-db21-40e4-8c71-73a0c5433cb2":{"y":151.1603651085,"x":418},"8242f058-3d6c-432c-81cb-9a0b0d91dbe3":{"y":151.1603651085,"x":418},"9729fa9d-0439-4ef1-b68a-b100ee3536a1":{"y":151.1603651085,"x":418},"bac12f83-11de-4904-9a3d-256f39fecfa2":{"y":413.0940071326,"x":768.9612911807},"32bc5ae2-f007-474c-b3b4-e9bc57c4b3f2":{"y":413.0940071326,"x":768.9612911807}}},"description":"* [Kubernetes API](https:\/\/@@{Kubernetes_Master.address[0]}@@:6443)"},"api_version":"3.0","metadata":{"last_update_time":"1551089364582721","owner_reference":{"kind":"user","uuid":"00000000-0000-0000-0000-000000000000","name":"admin"},"kind":"blueprint","uuid":"b3282977-b9f4-480c-bcd9-2396ee281101","project_reference":{"kind":"project","name":"default","uuid":"209e0a42-6f2d-4999-9a9b-5aa705d25661"},"spec_version":14,"creation_time":"1550553559269952","name":"Kubernetes_temp"}}